import{j as e}from"./vendor-tiptap-CPIgDqZu.js";import{f as z,u as J,r as o}from"./vendor-react-BadUDqtX.js";import{u as Q}from"./index-C0aebke8.js";import{v as j}from"./slugify-BrmacSpC.js";import"./vendor-firebase-D65FIcPE.js";const te=()=>{const{id:p}=z(),r=J(),{addBlog:F,updateBlog:D,blogs:x}=Q(),a=!!p,[c,E]=o.useState(null),[d,f]=o.useState(""),[u,b]=o.useState(""),[N,y]=o.useState(""),[C,T]=o.useState(""),[S,k]=o.useState("H∆∞·ªõng D·∫´n"),[L,H]=o.useState(""),[w,B]=o.useState(5),[$,R]=o.useState(""),l=o.useRef(null),h=o.useRef(null),[G,U]=o.useState("image");o.useEffect(()=>{var t;if(a&&x.length>0){const n=x.find(s=>s.id==p);n?(E(n),f(n.title||""),b(n.slug||""),y(n.excerpt||""),T(n.coverImage||""),k(n.category||"H∆∞·ªõng D·∫´n"),H(((t=n.tags)==null?void 0:t.join(", "))||""),B(n.readTime||5),R(n.content||""),l.current&&(l.current.innerHTML=n.content||"")):(alert("Kh√¥ng t√¨m th·∫•y b√†i vi·∫øt!"),r("/blog"))}},[a,p,x,r]);const A=t=>{const n=t.target.value;f(n);const s=j(n);(!u||u===j(d))&&b(s)},V=async t=>{t.preventDefault(),console.log("üü° Blog form submission started");const n={title:d,slug:u||j(d),excerpt:N,coverImage:C||"https://images.unsplash.com/photo-1593062096033-9a26b09da705?w=1200",content:$,category:S,tags:L.split(",").map(s=>s.trim()).filter(Boolean),readTime:parseInt(w)||5};if(console.log("üü° Blog data to save:",n),a&&c){console.log("üü° Updating blog:",c.id);const s=await D(c.id,n);console.log("üü° Update response:",s),s.success?(alert("ƒê√£ c·∫≠p nh·∫≠t b√†i vi·∫øt th√†nh c√¥ng!"),r(`/blog/${c.id}`)):alert(`L·ªói: ${s.message||"C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t!"}`)}else{console.log("üü° Creating new blog");const s=await F(n);console.log("üü° Create response:",s),s.success?(alert("ƒê√£ ƒëƒÉng b√†i vi·∫øt th√†nh c√¥ng!"),r("/blog")):alert(`L·ªói: ${s.message||"C√≥ l·ªói x·∫£y ra!"}`)}},i=(t,n=null)=>{var s;document.execCommand(t,!1,n),(s=l.current)==null||s.focus(),g()},q=t=>{const n=window.getSelection();if(n.rangeCount>0){const s=n.getRangeAt(0),m=document.createElement(`h${t}`);m.textContent=n.toString()||`Ti√™u ƒë·ªÅ ${t}`,s.deleteContents(),s.insertNode(m),g()}},I=t=>{U(t),h.current&&(h.current.accept=t==="image"?"image/*":"video/*",h.current.click())},K=t=>{const n=t.target.files[0];if(n){const s=new FileReader;s.onload=m=>{const M=m.target.result;if(G==="image"){const v=`<img src="${M}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 10px 0;" alt="Uploaded image" />`;document.execCommand("insertHTML",!1,v)}else{const v=`<div class="video-container" style="margin: 10px 0;"><video controls width="100%" style="border-radius: 8px;"><source src="${M}" type="${n.type}">Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ th·∫ª video.</video></div><p><br/></p>`;document.execCommand("insertHTML",!1,v)}g()},s.readAsDataURL(n)}t.target.value=""},X=()=>{const t=prompt("Nh·∫≠p ƒë∆∞·ªùng d·∫´n (URL):");t&&i("createLink",t)},O=t=>{i("fontName",t)},P=t=>{i("foreColor",t)},g=()=>{l.current&&R(l.current.innerHTML)};return e.jsxs("div",{className:"blog-editor",children:[e.jsx("input",{type:"file",ref:h,style:{display:"none"},onChange:K}),e.jsxs("div",{className:"editor-header",children:[e.jsx("h1",{children:a?"Ch·ªânh S·ª≠a B√†i Vi·∫øt":"T·∫°o B√†i Vi·∫øt M·ªõi"}),e.jsx("p",{children:a?"C·∫≠p nh·∫≠t n·ªôi dung b√†i vi·∫øt c·ªßa b·∫°n":"Chia s·∫ª ki·∫øn th·ª©c v√† c·∫£m h·ª©ng setup c·ªßa b·∫°n"})]}),e.jsxs("form",{onSubmit:V,className:"editor-form",children:[e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"Th√¥ng Tin C∆° B·∫£n"}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"title",children:"Ti√™u ƒê·ªÅ *"}),e.jsx("input",{id:"title",type:"text",className:"input",value:d,onChange:A,placeholder:"Nh·∫≠p ti√™u ƒë·ªÅ b√†i vi·∫øt",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"slug",children:"URL / Slug"}),e.jsx("input",{id:"slug",type:"text",className:"input",value:u,onChange:t=>b(t.target.value),placeholder:"tu-dong-tao-tu-tieu-de"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"category",children:"Danh M·ª•c *"}),e.jsxs("select",{id:"category",className:"input",value:S,onChange:t=>k(t.target.value),required:!0,children:[e.jsx("option",{value:"H∆∞·ªõng D·∫´n",children:"H∆∞·ªõng D·∫´n"}),e.jsx("option",{value:"Thi·∫øt K·∫ø",children:"Thi·∫øt K·∫ø"}),e.jsx("option",{value:"ƒê√°nh Gi√°",children:"ƒê√°nh Gi√°"}),e.jsx("option",{value:"Xu H∆∞·ªõng",children:"Xu H∆∞·ªõng"}),e.jsx("option",{value:"M·∫πo",children:"M·∫πo"})]})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"excerpt",children:"M√¥ T·∫£ Ng·∫Øn *"}),e.jsx("textarea",{id:"excerpt",className:"input",value:N,onChange:t=>y(t.target.value),placeholder:"M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ n·ªôi dung b√†i vi·∫øt",rows:"3",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"coverImage",children:"·∫¢nh B√¨a (URL ho·∫∑c Upload b√™n d∆∞·ªõi)"}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("input",{id:"coverImage",type:"url",className:"input",value:C,onChange:t=>T(t.target.value),placeholder:"https://example.com/image.jpg",style:{flex:1}}),e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{U("image"),alert("Hi·ªán t·∫°i ·∫£nh b√¨a h·ªó tr·ª£ URL. T√≠nh nƒÉng upload ·∫£nh b√¨a ƒëang ph√°t tri·ªÉn.")},children:"URL"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"readTime",children:"Th·ªùi Gian ƒê·ªçc (ph√∫t)"}),e.jsx("input",{id:"readTime",type:"number",className:"input",value:w,onChange:t=>B(t.target.value),min:"1",max:"60"})]}),e.jsxs("div",{className:"form-group full-width",children:[e.jsx("label",{htmlFor:"tags",children:"Th·∫ª (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y)"}),e.jsx("input",{id:"tags",type:"text",className:"input",value:L,onChange:t=>H(t.target.value),placeholder:"desk, productivity, ergonomics"})]})]})]}),e.jsxs("div",{className:"form-section",children:[e.jsx("h3",{children:"N·ªôi Dung B√†i Vi·∫øt"}),e.jsxs("div",{className:"editor-toolbar",children:[e.jsxs("div",{className:"toolbar-group",children:[e.jsxs("select",{onChange:t=>q(t.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"",children:"Ti√™u ƒë·ªÅ"}),e.jsx("option",{value:"2",children:"Heading 2"}),e.jsx("option",{value:"3",children:"Heading 3"}),e.jsx("option",{value:"4",children:"Heading 4"})]}),e.jsxs("select",{onChange:t=>O(t.target.value),className:"toolbar-select",children:[e.jsx("option",{value:"Arial",children:"Arial"}),e.jsx("option",{value:"Georgia",children:"Georgia"}),e.jsx("option",{value:"Courier New",children:"Courier New"}),e.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),e.jsx("option",{value:"System-ui",children:"System UI"})]})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>i("bold"),title:"In ƒë·∫≠m",children:e.jsx("strong",{children:"B"})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>i("italic"),title:"In nghi√™ng",children:e.jsx("em",{children:"I"})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>i("underline"),title:"G·∫°ch ch√¢n",children:e.jsx("u",{children:"U"})}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>X(),title:"Ch√®n Link",children:"üîó"})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>i("insertUnorderedList"),title:"Danh s√°ch",children:"‚Ä¢ List"}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>i("insertOrderedList"),title:"S·ªë th·ª© t·ª±",children:"1. List"})]}),e.jsxs("div",{className:"toolbar-group",children:[e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>I("image"),title:"T·∫£i ·∫£nh l√™n",children:"üì∑ ·∫¢nh"}),e.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>I("video"),title:"T·∫£i video l√™n",children:"üé• Video"})]}),e.jsx("div",{className:"toolbar-group",children:e.jsx("input",{type:"color",onChange:t=>P(t.target.value),title:"M√†u ch·ªØ",className:"toolbar-color-picker"})})]}),e.jsx("div",{ref:l,className:"content-editor",contentEditable:!0,onInput:g,"data-placeholder":"B·∫Øt ƒë·∫ßu vi·∫øt b√†i t·∫°i ƒë√¢y..."})]}),e.jsxs("div",{className:"editor-actions",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>r("/blog"),children:"H·ªßy"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:a?"C·∫≠p Nh·∫≠t":"ƒêƒÉng B√†i"})]})]})]})};export{te as default};
