import{j as e}from"./vendor-tiptap-CPIgDqZu.js";import{r as d}from"./vendor-react-BadUDqtX.js";import{t as N,h as T,j as w}from"./vendor-firebase-D65FIcPE.js";import{u as k,c as C,d as u,e as L}from"./index-DYQWwx0r.js";const G=()=>{const{showProfileModal:x,setShowProfileModal:f,refreshUser:g,currentUser:a,logout:j}=k(),[i,c]=d.useState((a==null?void 0:a.displayName)||""),[l,v]=d.useState((a==null?void 0:a.avatar)||""),[h,n]=d.useState("");if(!x)return null;const r=()=>{f(!1),n("")},m=async s=>{if(s.preventDefault(),n(""),a!=null&&a.isGuest)C(i),g(),n("ÄÃ£ cáº­p nháº­t tÃªn hiá»ƒn thá»‹!"),setTimeout(()=>r(),1500);else try{const t=l&&l.startsWith("data:");if(u.currentUser){const p={displayName:i};t||(p.photoURL=l),await N(u.currentUser,p)}const o=T(L,"users",a.id);await w(o,{displayName:i,avatar:l}),n("Cáº­p nháº­t thÃ nh cÃ´ng! Äang táº£i láº¡i..."),setTimeout(()=>window.location.reload(),500)}catch(t){console.error(t),n("Lá»—i: "+t.message)}},b=s=>{const t=s.target.files[0];if(t){if(t.size>2e6)return alert("File quÃ¡ lá»›n (>2MB)");const o=new FileReader;o.onloadend=()=>{v(o.result)},o.readAsDataURL(t)}},y=async()=>{confirm("Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?")&&(await j(),r())};return e.jsx("div",{className:"modal-overlay",onClick:s=>s.target===s.currentTarget&&r(),children:e.jsxs("div",{className:"profile-modal modal-content",children:[e.jsx("button",{className:"modal-close-btn",onClick:r,children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),e.jsxs("div",{className:"profile-content",children:[e.jsxs("div",{className:"profile-header",children:[e.jsx("img",{src:a==null?void 0:a.avatar,alt:a==null?void 0:a.displayName,className:"profile-avatar-large"}),e.jsx("h2",{children:a==null?void 0:a.displayName}),e.jsx("p",{className:"profile-role",children:a!=null&&a.isGuest?"ğŸ‘¤ TÃ i khoáº£n KhÃ¡ch":"âœ¨ ThÃ nh viÃªn"})]}),h&&e.jsx("div",{className:"profile-message success",children:h}),a!=null&&a.isGuest?e.jsxs("form",{onSubmit:m,className:"profile-form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"TÃªn hiá»ƒn thá»‹"}),e.jsx("input",{type:"text",className:"input",value:i,onChange:s=>c(s.target.value),placeholder:"TÃªn cá»§a báº¡n",required:!0})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"LÆ°u Thay Äá»•i"})]}):e.jsxs("form",{onSubmit:m,className:"profile-form",children:[e.jsxs("div",{className:"form-group profile-avatar-edit",children:[e.jsx("label",{children:"áº¢nh Äáº¡i Diá»‡n"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("img",{src:l||a.photoURL,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover",border:"2px solid var(--border-color)"},alt:"Avatar"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"avatar-upload",className:"btn btn-primary",style:{padding:"0.4rem 0.8rem",fontSize:"0.85rem"},children:"Thay Ä‘á»•i"}),e.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:b,style:{display:"none"}})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"TÃªn hiá»ƒn thá»‹"}),e.jsx("input",{type:"text",className:"input",value:i,onChange:s=>c(s.target.value),placeholder:"TÃªn cá»§a báº¡n",required:!0})]}),e.jsxs("div",{className:"profile-info-readonly",style:{margin:"1rem 0",opacity:.8,fontSize:"0.9rem",background:"var(--bg-secondary)",padding:"0.75rem",borderRadius:"8px"},children:[e.jsxs("div",{style:{marginBottom:"0.5rem"},children:[e.jsx("strong",{children:"Email:"})," ",a.email]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Vai trÃ²:"})," ",(a==null?void 0:a.role)==="admin"?"Quáº£n trá»‹ viÃªn":"ThÃ nh viÃªn"]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},children:"LÆ°u Thay Äá»•i"})]}),!(a!=null&&a.isGuest)&&e.jsx("button",{className:"btn btn-secondary logout-btn",onClick:y,children:"ÄÄƒng Xuáº¥t"}),e.jsx("div",{className:"profile-note",children:e.jsx("small",{children:a!=null&&a.isGuest?"Dá»¯ liá»‡u cá»§a báº¡n Ä‘Æ°á»£c lÆ°u trÃªn thiáº¿t bá»‹ nÃ y. Táº¡o tÃ i khoáº£n Ä‘á»ƒ Ä‘á»“ng bá»™ trÃªn nhiá»u thiáº¿t bá»‹.":"TÃ i khoáº£n cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘Äƒng kÃ½ vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng trÃªn nhiá»u thiáº¿t bá»‹."})})]})]})})};export{G as default};
