var NV=Object.defineProperty;var RV=(t,e,n)=>e in t?NV(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Ds=(t,e,n)=>RV(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Io(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var wA={exports:{}},Ng={},xA={exports:{}},Oe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xd=Symbol.for("react.element"),PV=Symbol.for("react.portal"),MV=Symbol.for("react.fragment"),OV=Symbol.for("react.strict_mode"),DV=Symbol.for("react.profiler"),LV=Symbol.for("react.provider"),jV=Symbol.for("react.context"),VV=Symbol.for("react.forward_ref"),FV=Symbol.for("react.suspense"),BV=Symbol.for("react.memo"),zV=Symbol.for("react.lazy"),UE=Symbol.iterator;function $V(t){return t===null||typeof t!="object"?null:(t=UE&&t[UE]||t["@@iterator"],typeof t=="function"?t:null)}var _A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},bA=Object.assign,TA={};function Hc(t,e,n){this.props=t,this.context=e,this.refs=TA,this.updater=n||_A}Hc.prototype.isReactComponent={};Hc.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Hc.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function EA(){}EA.prototype=Hc.prototype;function s_(t,e,n){this.props=t,this.context=e,this.refs=TA,this.updater=n||_A}var i_=s_.prototype=new EA;i_.constructor=s_;bA(i_,Hc.prototype);i_.isPureReactComponent=!0;var HE=Array.isArray,SA=Object.prototype.hasOwnProperty,o_={current:null},kA={key:!0,ref:!0,__self:!0,__source:!0};function CA(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)SA.call(e,r)&&!kA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:xd,type:t,key:i,ref:o,props:s,_owner:o_.current}}function UV(t,e){return{$$typeof:xd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function a_(t){return typeof t=="object"&&t!==null&&t.$$typeof===xd}function HV(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var WE=/\/+/g;function ov(t,e){return typeof t=="object"&&t!==null&&t.key!=null?HV(""+t.key):e.toString(36)}function tp(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xd:case PV:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+ov(o,0):r,HE(s)?(n="",t!=null&&(n=t.replace(WE,"$&/")+"/"),tp(s,e,n,"",function(c){return c})):s!=null&&(a_(s)&&(s=UV(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(WE,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",HE(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+ov(i,a);o+=tp(i,e,n,l,s)}else if(l=$V(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+ov(i,a++),o+=tp(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function af(t,e,n){if(t==null)return t;var r=[],s=0;return tp(t,r,"","",function(i){return e.call(n,i,s++)}),r}function WV(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var zn={current:null},np={transition:null},qV={ReactCurrentDispatcher:zn,ReactCurrentBatchConfig:np,ReactCurrentOwner:o_};function IA(){throw Error("act(...) is not supported in production builds of React.")}Oe.Children={map:af,forEach:function(t,e,n){af(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return af(t,function(){e++}),e},toArray:function(t){return af(t,function(e){return e})||[]},only:function(t){if(!a_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Oe.Component=Hc;Oe.Fragment=MV;Oe.Profiler=DV;Oe.PureComponent=s_;Oe.StrictMode=OV;Oe.Suspense=FV;Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=qV;Oe.act=IA;Oe.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=bA({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=o_.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)SA.call(e,l)&&!kA.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:xd,type:t.type,key:s,ref:i,props:r,_owner:o}};Oe.createContext=function(t){return t={$$typeof:jV,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:LV,_context:t},t.Consumer=t};Oe.createElement=CA;Oe.createFactory=function(t){var e=CA.bind(null,t);return e.type=t,e};Oe.createRef=function(){return{current:null}};Oe.forwardRef=function(t){return{$$typeof:VV,render:t}};Oe.isValidElement=a_;Oe.lazy=function(t){return{$$typeof:zV,_payload:{_status:-1,_result:t},_init:WV}};Oe.memo=function(t,e){return{$$typeof:BV,type:t,compare:e===void 0?null:e}};Oe.startTransition=function(t){var e=np.transition;np.transition={};try{t()}finally{np.transition=e}};Oe.unstable_act=IA;Oe.useCallback=function(t,e){return zn.current.useCallback(t,e)};Oe.useContext=function(t){return zn.current.useContext(t)};Oe.useDebugValue=function(){};Oe.useDeferredValue=function(t){return zn.current.useDeferredValue(t)};Oe.useEffect=function(t,e){return zn.current.useEffect(t,e)};Oe.useId=function(){return zn.current.useId()};Oe.useImperativeHandle=function(t,e,n){return zn.current.useImperativeHandle(t,e,n)};Oe.useInsertionEffect=function(t,e){return zn.current.useInsertionEffect(t,e)};Oe.useLayoutEffect=function(t,e){return zn.current.useLayoutEffect(t,e)};Oe.useMemo=function(t,e){return zn.current.useMemo(t,e)};Oe.useReducer=function(t,e,n){return zn.current.useReducer(t,e,n)};Oe.useRef=function(t){return zn.current.useRef(t)};Oe.useState=function(t){return zn.current.useState(t)};Oe.useSyncExternalStore=function(t,e,n){return zn.current.useSyncExternalStore(t,e,n)};Oe.useTransition=function(){return zn.current.useTransition()};Oe.version="18.3.1";xA.exports=Oe;var A=xA.exports;const qe=Io(A);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KV=A,GV=Symbol.for("react.element"),QV=Symbol.for("react.fragment"),JV=Object.prototype.hasOwnProperty,YV=KV.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,XV={key:!0,ref:!0,__self:!0,__source:!0};function AA(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)JV.call(e,r)&&!XV.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:GV,type:t,key:i,ref:o,props:s,_owner:YV.current}}Ng.Fragment=QV;Ng.jsx=AA;Ng.jsxs=AA;wA.exports=Ng;var d=wA.exports,j0={},NA={exports:{}},gr={},RA={exports:{}},PA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,V){var Z=W.length;W.push(V);e:for(;0<Z;){var ce=Z-1>>>1,U=W[ce];if(0<s(U,V))W[ce]=V,W[Z]=U,Z=ce;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var V=W[0],Z=W.pop();if(Z!==V){W[0]=Z;e:for(var ce=0,U=W.length,he=U>>>1;ce<he;){var we=2*(ce+1)-1,dt=W[we],st=we+1,it=W[st];if(0>s(dt,Z))st<U&&0>s(it,dt)?(W[ce]=it,W[st]=Z,ce=st):(W[ce]=dt,W[we]=Z,ce=we);else if(st<U&&0>s(it,Z))W[ce]=it,W[st]=Z,ce=st;else break e}}return V}function s(W,V){var Z=W.sortIndex-V.sortIndex;return Z!==0?Z:W.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,m=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(W){for(var V=n(c);V!==null;){if(V.callback===null)r(c);else if(V.startTime<=W)r(c),V.sortIndex=V.expirationTime,e(l,V);else break;V=n(c)}}function N(W){if(y=!1,E(W),!g)if(n(l)!==null)g=!0,je(R);else{var V=n(c);V!==null&&oe(N,V.startTime-W)}}function R(W,V){g=!1,y&&(y=!1,w(T),T=-1),m=!0;var Z=f;try{for(E(V),h=n(l);h!==null&&(!(h.expirationTime>V)||W&&!M());){var ce=h.callback;if(typeof ce=="function"){h.callback=null,f=h.priorityLevel;var U=ce(h.expirationTime<=V);V=t.unstable_now(),typeof U=="function"?h.callback=U:h===n(l)&&r(l),E(V)}else r(l);h=n(l)}if(h!==null)var he=!0;else{var we=n(c);we!==null&&oe(N,we.startTime-V),he=!1}return he}finally{h=null,f=Z,m=!1}}var O=!1,S=null,T=-1,k=5,I=-1;function M(){return!(t.unstable_now()-I<k)}function D(){if(S!==null){var W=t.unstable_now();I=W;var V=!0;try{V=S(!0,W)}finally{V?P():(O=!1,S=null)}}else O=!1}var P;if(typeof _=="function")P=function(){_(D)};else if(typeof MessageChannel<"u"){var pe=new MessageChannel,Ee=pe.port2;pe.port1.onmessage=D,P=function(){Ee.postMessage(null)}}else P=function(){v(D,0)};function je(W){S=W,O||(O=!0,P())}function oe(W,V){T=v(function(){W(t.unstable_now())},V)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){g||m||(g=!0,je(R))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(W){switch(f){case 1:case 2:case 3:var V=3;break;default:V=f}var Z=f;f=V;try{return W()}finally{f=Z}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,V){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=f;f=W;try{return V()}finally{f=Z}},t.unstable_scheduleCallback=function(W,V,Z){var ce=t.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?ce+Z:ce):Z=ce,W){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=Z+U,W={id:u++,callback:V,priorityLevel:W,startTime:Z,expirationTime:U,sortIndex:-1},Z>ce?(W.sortIndex=Z,e(c,W),n(l)===null&&W===n(c)&&(y?(w(T),T=-1):y=!0,oe(N,Z-ce))):(W.sortIndex=U,e(l,W),g||m||(g=!0,je(R))),W},t.unstable_shouldYield=M,t.unstable_wrapCallback=function(W){var V=f;return function(){var Z=f;f=V;try{return W.apply(this,arguments)}finally{f=Z}}}})(PA);RA.exports=PA;var ZV=RA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var e4=A,pr=ZV;function Y(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var MA=new Set,Ih={};function el(t,e){pc(t,e),pc(t+"Capture",e)}function pc(t,e){for(Ih[t]=e,t=0;t<e.length;t++)MA.add(e[t])}var ii=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),V0=Object.prototype.hasOwnProperty,t4=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,qE={},KE={};function n4(t){return V0.call(KE,t)?!0:V0.call(qE,t)?!1:t4.test(t)?KE[t]=!0:(qE[t]=!0,!1)}function r4(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function s4(t,e,n,r){if(e===null||typeof e>"u"||r4(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function $n(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var gn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){gn[t]=new $n(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];gn[e]=new $n(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){gn[t]=new $n(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){gn[t]=new $n(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){gn[t]=new $n(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){gn[t]=new $n(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){gn[t]=new $n(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){gn[t]=new $n(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){gn[t]=new $n(t,5,!1,t.toLowerCase(),null,!1,!1)});var l_=/[\-:]([a-z])/g;function c_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(l_,c_);gn[e]=new $n(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(l_,c_);gn[e]=new $n(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(l_,c_);gn[e]=new $n(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){gn[t]=new $n(t,1,!1,t.toLowerCase(),null,!1,!1)});gn.xlinkHref=new $n("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){gn[t]=new $n(t,1,!1,t.toLowerCase(),null,!0,!0)});function u_(t,e,n,r){var s=gn.hasOwnProperty(e)?gn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(s4(e,n,s,r)&&(n=null),r||s===null?n4(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var pi=e4.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lf=Symbol.for("react.element"),Ll=Symbol.for("react.portal"),jl=Symbol.for("react.fragment"),h_=Symbol.for("react.strict_mode"),F0=Symbol.for("react.profiler"),OA=Symbol.for("react.provider"),DA=Symbol.for("react.context"),d_=Symbol.for("react.forward_ref"),B0=Symbol.for("react.suspense"),z0=Symbol.for("react.suspense_list"),f_=Symbol.for("react.memo"),Di=Symbol.for("react.lazy"),LA=Symbol.for("react.offscreen"),GE=Symbol.iterator;function du(t){return t===null||typeof t!="object"?null:(t=GE&&t[GE]||t["@@iterator"],typeof t=="function"?t:null)}var bt=Object.assign,av;function ju(t){if(av===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);av=e&&e[1]||""}return`
`+av+t}var lv=!1;function cv(t,e){if(!t||lv)return"";lv=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{lv=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?ju(t):""}function i4(t){switch(t.tag){case 5:return ju(t.type);case 16:return ju("Lazy");case 13:return ju("Suspense");case 19:return ju("SuspenseList");case 0:case 2:case 15:return t=cv(t.type,!1),t;case 11:return t=cv(t.type.render,!1),t;case 1:return t=cv(t.type,!0),t;default:return""}}function $0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case jl:return"Fragment";case Ll:return"Portal";case F0:return"Profiler";case h_:return"StrictMode";case B0:return"Suspense";case z0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case DA:return(t.displayName||"Context")+".Consumer";case OA:return(t._context.displayName||"Context")+".Provider";case d_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case f_:return e=t.displayName||null,e!==null?e:$0(t.type)||"Memo";case Di:e=t._payload,t=t._init;try{return $0(t(e))}catch{}}return null}function o4(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return $0(e);case 8:return e===h_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function wo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function jA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function a4(t){var e=jA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function cf(t){t._valueTracker||(t._valueTracker=a4(t))}function VA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=jA(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function zp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function U0(t,e){var n=e.checked;return bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function QE(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=wo(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function FA(t,e){e=e.checked,e!=null&&u_(t,"checked",e,!1)}function H0(t,e){FA(t,e);var n=wo(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?W0(t,e.type,n):e.hasOwnProperty("defaultValue")&&W0(t,e.type,wo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function JE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function W0(t,e,n){(e!=="number"||zp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Vu=Array.isArray;function Yl(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+wo(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function q0(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Y(91));return bt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function YE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Y(92));if(Vu(n)){if(1<n.length)throw Error(Y(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:wo(n)}}function BA(t,e){var n=wo(e.value),r=wo(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function XE(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function zA(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function K0(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?zA(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var uf,$A=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(uf=uf||document.createElement("div"),uf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=uf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Ah(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Xu={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},l4=["Webkit","ms","Moz","O"];Object.keys(Xu).forEach(function(t){l4.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Xu[e]=Xu[t]})});function UA(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Xu.hasOwnProperty(t)&&Xu[t]?(""+e).trim():e+"px"}function HA(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=UA(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var c4=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function G0(t,e){if(e){if(c4[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Y(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Y(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Y(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Y(62))}}function Q0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var J0=null;function p_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Y0=null,Xl=null,Zl=null;function ZE(t){if(t=Td(t)){if(typeof Y0!="function")throw Error(Y(280));var e=t.stateNode;e&&(e=Dg(e),Y0(t.stateNode,t.type,e))}}function WA(t){Xl?Zl?Zl.push(t):Zl=[t]:Xl=t}function qA(){if(Xl){var t=Xl,e=Zl;if(Zl=Xl=null,ZE(t),e)for(t=0;t<e.length;t++)ZE(e[t])}}function KA(t,e){return t(e)}function GA(){}var uv=!1;function QA(t,e,n){if(uv)return t(e,n);uv=!0;try{return KA(t,e,n)}finally{uv=!1,(Xl!==null||Zl!==null)&&(GA(),qA())}}function Nh(t,e){var n=t.stateNode;if(n===null)return null;var r=Dg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Y(231,e,typeof n));return n}var X0=!1;if(ii)try{var fu={};Object.defineProperty(fu,"passive",{get:function(){X0=!0}}),window.addEventListener("test",fu,fu),window.removeEventListener("test",fu,fu)}catch{X0=!1}function u4(t,e,n,r,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Zu=!1,$p=null,Up=!1,Z0=null,h4={onError:function(t){Zu=!0,$p=t}};function d4(t,e,n,r,s,i,o,a,l){Zu=!1,$p=null,u4.apply(h4,arguments)}function f4(t,e,n,r,s,i,o,a,l){if(d4.apply(this,arguments),Zu){if(Zu){var c=$p;Zu=!1,$p=null}else throw Error(Y(198));Up||(Up=!0,Z0=c)}}function tl(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function JA(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function e1(t){if(tl(t)!==t)throw Error(Y(188))}function p4(t){var e=t.alternate;if(!e){if(e=tl(t),e===null)throw Error(Y(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return e1(s),t;if(i===r)return e1(s),e;i=i.sibling}throw Error(Y(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(Y(189))}}if(n.alternate!==r)throw Error(Y(190))}if(n.tag!==3)throw Error(Y(188));return n.stateNode.current===n?t:e}function YA(t){return t=p4(t),t!==null?XA(t):null}function XA(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=XA(t);if(e!==null)return e;t=t.sibling}return null}var ZA=pr.unstable_scheduleCallback,t1=pr.unstable_cancelCallback,m4=pr.unstable_shouldYield,g4=pr.unstable_requestPaint,Ot=pr.unstable_now,y4=pr.unstable_getCurrentPriorityLevel,m_=pr.unstable_ImmediatePriority,eN=pr.unstable_UserBlockingPriority,Hp=pr.unstable_NormalPriority,v4=pr.unstable_LowPriority,tN=pr.unstable_IdlePriority,Rg=null,_s=null;function w4(t){if(_s&&typeof _s.onCommitFiberRoot=="function")try{_s.onCommitFiberRoot(Rg,t,void 0,(t.current.flags&128)===128)}catch{}}var es=Math.clz32?Math.clz32:b4,x4=Math.log,_4=Math.LN2;function b4(t){return t>>>=0,t===0?32:31-(x4(t)/_4|0)|0}var hf=64,df=4194304;function Fu(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Wp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=Fu(a):(i&=o,i!==0&&(r=Fu(i)))}else o=n&~s,o!==0?r=Fu(o):i!==0&&(r=Fu(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-es(e),s=1<<n,r|=t[n],e&=~s;return r}function T4(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function E4(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-es(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=T4(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function ew(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function nN(){var t=hf;return hf<<=1,!(hf&4194240)&&(hf=64),t}function hv(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function _d(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-es(e),t[e]=n}function S4(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-es(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function g_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-es(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Ge=0;function rN(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var sN,y_,iN,oN,aN,tw=!1,ff=[],to=null,no=null,ro=null,Rh=new Map,Ph=new Map,Bi=[],k4="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function n1(t,e){switch(t){case"focusin":case"focusout":to=null;break;case"dragenter":case"dragleave":no=null;break;case"mouseover":case"mouseout":ro=null;break;case"pointerover":case"pointerout":Rh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ph.delete(e.pointerId)}}function pu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Td(e),e!==null&&y_(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function C4(t,e,n,r,s){switch(e){case"focusin":return to=pu(to,t,e,n,r,s),!0;case"dragenter":return no=pu(no,t,e,n,r,s),!0;case"mouseover":return ro=pu(ro,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Rh.set(i,pu(Rh.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,Ph.set(i,pu(Ph.get(i)||null,t,e,n,r,s)),!0}return!1}function lN(t){var e=oa(t.target);if(e!==null){var n=tl(e);if(n!==null){if(e=n.tag,e===13){if(e=JA(n),e!==null){t.blockedOn=e,aN(t.priority,function(){iN(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function rp(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=nw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);J0=r,n.target.dispatchEvent(r),J0=null}else return e=Td(n),e!==null&&y_(e),t.blockedOn=n,!1;e.shift()}return!0}function r1(t,e,n){rp(t)&&n.delete(e)}function I4(){tw=!1,to!==null&&rp(to)&&(to=null),no!==null&&rp(no)&&(no=null),ro!==null&&rp(ro)&&(ro=null),Rh.forEach(r1),Ph.forEach(r1)}function mu(t,e){t.blockedOn===e&&(t.blockedOn=null,tw||(tw=!0,pr.unstable_scheduleCallback(pr.unstable_NormalPriority,I4)))}function Mh(t){function e(s){return mu(s,t)}if(0<ff.length){mu(ff[0],t);for(var n=1;n<ff.length;n++){var r=ff[n];r.blockedOn===t&&(r.blockedOn=null)}}for(to!==null&&mu(to,t),no!==null&&mu(no,t),ro!==null&&mu(ro,t),Rh.forEach(e),Ph.forEach(e),n=0;n<Bi.length;n++)r=Bi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Bi.length&&(n=Bi[0],n.blockedOn===null);)lN(n),n.blockedOn===null&&Bi.shift()}var ec=pi.ReactCurrentBatchConfig,qp=!0;function A4(t,e,n,r){var s=Ge,i=ec.transition;ec.transition=null;try{Ge=1,v_(t,e,n,r)}finally{Ge=s,ec.transition=i}}function N4(t,e,n,r){var s=Ge,i=ec.transition;ec.transition=null;try{Ge=4,v_(t,e,n,r)}finally{Ge=s,ec.transition=i}}function v_(t,e,n,r){if(qp){var s=nw(t,e,n,r);if(s===null)_v(t,e,r,Kp,n),n1(t,r);else if(C4(s,t,e,n,r))r.stopPropagation();else if(n1(t,r),e&4&&-1<k4.indexOf(t)){for(;s!==null;){var i=Td(s);if(i!==null&&sN(i),i=nw(t,e,n,r),i===null&&_v(t,e,r,Kp,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else _v(t,e,r,null,n)}}var Kp=null;function nw(t,e,n,r){if(Kp=null,t=p_(r),t=oa(t),t!==null)if(e=tl(t),e===null)t=null;else if(n=e.tag,n===13){if(t=JA(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Kp=t,null}function cN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(y4()){case m_:return 1;case eN:return 4;case Hp:case v4:return 16;case tN:return 536870912;default:return 16}default:return 16}}var Qi=null,w_=null,sp=null;function uN(){if(sp)return sp;var t,e=w_,n=e.length,r,s="value"in Qi?Qi.value:Qi.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return sp=s.slice(t,1<r?1-r:void 0)}function ip(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function pf(){return!0}function s1(){return!1}function yr(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?pf:s1,this.isPropagationStopped=s1,this}return bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=pf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=pf)},persist:function(){},isPersistent:pf}),e}var Wc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},x_=yr(Wc),bd=bt({},Wc,{view:0,detail:0}),R4=yr(bd),dv,fv,gu,Pg=bt({},bd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:__,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==gu&&(gu&&t.type==="mousemove"?(dv=t.screenX-gu.screenX,fv=t.screenY-gu.screenY):fv=dv=0,gu=t),dv)},movementY:function(t){return"movementY"in t?t.movementY:fv}}),i1=yr(Pg),P4=bt({},Pg,{dataTransfer:0}),M4=yr(P4),O4=bt({},bd,{relatedTarget:0}),pv=yr(O4),D4=bt({},Wc,{animationName:0,elapsedTime:0,pseudoElement:0}),L4=yr(D4),j4=bt({},Wc,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),V4=yr(j4),F4=bt({},Wc,{data:0}),o1=yr(F4),B4={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},z4={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$4={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function U4(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=$4[t])?!!e[t]:!1}function __(){return U4}var H4=bt({},bd,{key:function(t){if(t.key){var e=B4[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=ip(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?z4[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:__,charCode:function(t){return t.type==="keypress"?ip(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ip(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),W4=yr(H4),q4=bt({},Pg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),a1=yr(q4),K4=bt({},bd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:__}),G4=yr(K4),Q4=bt({},Wc,{propertyName:0,elapsedTime:0,pseudoElement:0}),J4=yr(Q4),Y4=bt({},Pg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),X4=yr(Y4),Z4=[9,13,27,32],b_=ii&&"CompositionEvent"in window,eh=null;ii&&"documentMode"in document&&(eh=document.documentMode);var eF=ii&&"TextEvent"in window&&!eh,hN=ii&&(!b_||eh&&8<eh&&11>=eh),l1=" ",c1=!1;function dN(t,e){switch(t){case"keyup":return Z4.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Vl=!1;function tF(t,e){switch(t){case"compositionend":return fN(e);case"keypress":return e.which!==32?null:(c1=!0,l1);case"textInput":return t=e.data,t===l1&&c1?null:t;default:return null}}function nF(t,e){if(Vl)return t==="compositionend"||!b_&&dN(t,e)?(t=uN(),sp=w_=Qi=null,Vl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return hN&&e.locale!=="ko"?null:e.data;default:return null}}var rF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function u1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!rF[t.type]:e==="textarea"}function pN(t,e,n,r){WA(r),e=Gp(e,"onChange"),0<e.length&&(n=new x_("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var th=null,Oh=null;function sF(t){SN(t,0)}function Mg(t){var e=zl(t);if(VA(e))return t}function iF(t,e){if(t==="change")return e}var mN=!1;if(ii){var mv;if(ii){var gv="oninput"in document;if(!gv){var h1=document.createElement("div");h1.setAttribute("oninput","return;"),gv=typeof h1.oninput=="function"}mv=gv}else mv=!1;mN=mv&&(!document.documentMode||9<document.documentMode)}function d1(){th&&(th.detachEvent("onpropertychange",gN),Oh=th=null)}function gN(t){if(t.propertyName==="value"&&Mg(Oh)){var e=[];pN(e,Oh,t,p_(t)),QA(sF,e)}}function oF(t,e,n){t==="focusin"?(d1(),th=e,Oh=n,th.attachEvent("onpropertychange",gN)):t==="focusout"&&d1()}function aF(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Mg(Oh)}function lF(t,e){if(t==="click")return Mg(e)}function cF(t,e){if(t==="input"||t==="change")return Mg(e)}function uF(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var rs=typeof Object.is=="function"?Object.is:uF;function Dh(t,e){if(rs(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!V0.call(e,s)||!rs(t[s],e[s]))return!1}return!0}function f1(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function p1(t,e){var n=f1(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=f1(n)}}function yN(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?yN(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function vN(){for(var t=window,e=zp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=zp(t.document)}return e}function T_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function hF(t){var e=vN(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&yN(n.ownerDocument.documentElement,n)){if(r!==null&&T_(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=p1(n,i);var o=p1(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var dF=ii&&"documentMode"in document&&11>=document.documentMode,Fl=null,rw=null,nh=null,sw=!1;function m1(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;sw||Fl==null||Fl!==zp(r)||(r=Fl,"selectionStart"in r&&T_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),nh&&Dh(nh,r)||(nh=r,r=Gp(rw,"onSelect"),0<r.length&&(e=new x_("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Fl)))}function mf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var Bl={animationend:mf("Animation","AnimationEnd"),animationiteration:mf("Animation","AnimationIteration"),animationstart:mf("Animation","AnimationStart"),transitionend:mf("Transition","TransitionEnd")},yv={},wN={};ii&&(wN=document.createElement("div").style,"AnimationEvent"in window||(delete Bl.animationend.animation,delete Bl.animationiteration.animation,delete Bl.animationstart.animation),"TransitionEvent"in window||delete Bl.transitionend.transition);function Og(t){if(yv[t])return yv[t];if(!Bl[t])return t;var e=Bl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in wN)return yv[t]=e[n];return t}var xN=Og("animationend"),_N=Og("animationiteration"),bN=Og("animationstart"),TN=Og("transitionend"),EN=new Map,g1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ao(t,e){EN.set(t,e),el(e,[t])}for(var vv=0;vv<g1.length;vv++){var wv=g1[vv],fF=wv.toLowerCase(),pF=wv[0].toUpperCase()+wv.slice(1);Ao(fF,"on"+pF)}Ao(xN,"onAnimationEnd");Ao(_N,"onAnimationIteration");Ao(bN,"onAnimationStart");Ao("dblclick","onDoubleClick");Ao("focusin","onFocus");Ao("focusout","onBlur");Ao(TN,"onTransitionEnd");pc("onMouseEnter",["mouseout","mouseover"]);pc("onMouseLeave",["mouseout","mouseover"]);pc("onPointerEnter",["pointerout","pointerover"]);pc("onPointerLeave",["pointerout","pointerover"]);el("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));el("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));el("onBeforeInput",["compositionend","keypress","textInput","paste"]);el("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));el("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));el("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Bu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mF=new Set("cancel close invalid load scroll toggle".split(" ").concat(Bu));function y1(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,f4(r,e,void 0,t),t.currentTarget=null}function SN(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;y1(s,a,c),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;y1(s,a,c),i=l}}}if(Up)throw t=Z0,Up=!1,Z0=null,t}function at(t,e){var n=e[cw];n===void 0&&(n=e[cw]=new Set);var r=t+"__bubble";n.has(r)||(kN(e,t,2,!1),n.add(r))}function xv(t,e,n){var r=0;e&&(r|=4),kN(n,t,r,e)}var gf="_reactListening"+Math.random().toString(36).slice(2);function Lh(t){if(!t[gf]){t[gf]=!0,MA.forEach(function(n){n!=="selectionchange"&&(mF.has(n)||xv(n,!1,t),xv(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[gf]||(e[gf]=!0,xv("selectionchange",!1,e))}}function kN(t,e,n,r){switch(cN(e)){case 1:var s=A4;break;case 4:s=N4;break;default:s=v_}n=s.bind(null,e,n,t),s=void 0,!X0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function _v(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=oa(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}QA(function(){var c=i,u=p_(n),h=[];e:{var f=EN.get(t);if(f!==void 0){var m=x_,g=t;switch(t){case"keypress":if(ip(n)===0)break e;case"keydown":case"keyup":m=W4;break;case"focusin":g="focus",m=pv;break;case"focusout":g="blur",m=pv;break;case"beforeblur":case"afterblur":m=pv;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":m=i1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":m=M4;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":m=G4;break;case xN:case _N:case bN:m=L4;break;case TN:m=J4;break;case"scroll":m=R4;break;case"wheel":m=X4;break;case"copy":case"cut":case"paste":m=V4;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":m=a1}var y=(e&4)!==0,v=!y&&t==="scroll",w=y?f!==null?f+"Capture":null:f;y=[];for(var _=c,E;_!==null;){E=_;var N=E.stateNode;if(E.tag===5&&N!==null&&(E=N,w!==null&&(N=Nh(_,w),N!=null&&y.push(jh(_,N,E)))),v)break;_=_.return}0<y.length&&(f=new m(f,g,null,n,u),h.push({event:f,listeners:y}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",m=t==="mouseout"||t==="pointerout",f&&n!==J0&&(g=n.relatedTarget||n.fromElement)&&(oa(g)||g[oi]))break e;if((m||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,m?(g=n.relatedTarget||n.toElement,m=c,g=g?oa(g):null,g!==null&&(v=tl(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(m=null,g=c),m!==g)){if(y=i1,N="onMouseLeave",w="onMouseEnter",_="mouse",(t==="pointerout"||t==="pointerover")&&(y=a1,N="onPointerLeave",w="onPointerEnter",_="pointer"),v=m==null?f:zl(m),E=g==null?f:zl(g),f=new y(N,_+"leave",m,n,u),f.target=v,f.relatedTarget=E,N=null,oa(u)===c&&(y=new y(w,_+"enter",g,n,u),y.target=E,y.relatedTarget=v,N=y),v=N,m&&g)t:{for(y=m,w=g,_=0,E=y;E;E=fl(E))_++;for(E=0,N=w;N;N=fl(N))E++;for(;0<_-E;)y=fl(y),_--;for(;0<E-_;)w=fl(w),E--;for(;_--;){if(y===w||w!==null&&y===w.alternate)break t;y=fl(y),w=fl(w)}y=null}else y=null;m!==null&&v1(h,f,m,y,!1),g!==null&&v!==null&&v1(h,v,g,y,!0)}}e:{if(f=c?zl(c):window,m=f.nodeName&&f.nodeName.toLowerCase(),m==="select"||m==="input"&&f.type==="file")var R=iF;else if(u1(f))if(mN)R=cF;else{R=aF;var O=oF}else(m=f.nodeName)&&m.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(R=lF);if(R&&(R=R(t,c))){pN(h,R,n,u);break e}O&&O(t,f,c),t==="focusout"&&(O=f._wrapperState)&&O.controlled&&f.type==="number"&&W0(f,"number",f.value)}switch(O=c?zl(c):window,t){case"focusin":(u1(O)||O.contentEditable==="true")&&(Fl=O,rw=c,nh=null);break;case"focusout":nh=rw=Fl=null;break;case"mousedown":sw=!0;break;case"contextmenu":case"mouseup":case"dragend":sw=!1,m1(h,n,u);break;case"selectionchange":if(dF)break;case"keydown":case"keyup":m1(h,n,u)}var S;if(b_)e:{switch(t){case"compositionstart":var T="onCompositionStart";break e;case"compositionend":T="onCompositionEnd";break e;case"compositionupdate":T="onCompositionUpdate";break e}T=void 0}else Vl?dN(t,n)&&(T="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(T="onCompositionStart");T&&(hN&&n.locale!=="ko"&&(Vl||T!=="onCompositionStart"?T==="onCompositionEnd"&&Vl&&(S=uN()):(Qi=u,w_="value"in Qi?Qi.value:Qi.textContent,Vl=!0)),O=Gp(c,T),0<O.length&&(T=new o1(T,t,null,n,u),h.push({event:T,listeners:O}),S?T.data=S:(S=fN(n),S!==null&&(T.data=S)))),(S=eF?tF(t,n):nF(t,n))&&(c=Gp(c,"onBeforeInput"),0<c.length&&(u=new o1("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=S))}SN(h,e)})}function jh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Gp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Nh(t,n),i!=null&&r.unshift(jh(t,i,s)),i=Nh(t,e),i!=null&&r.push(jh(t,i,s))),t=t.return}return r}function fl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function v1(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,s?(l=Nh(n,i),l!=null&&o.unshift(jh(n,l,a))):s||(l=Nh(n,i),l!=null&&o.push(jh(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var gF=/\r\n?/g,yF=/\u0000|\uFFFD/g;function w1(t){return(typeof t=="string"?t:""+t).replace(gF,`
`).replace(yF,"")}function yf(t,e,n){if(e=w1(e),w1(t)!==e&&n)throw Error(Y(425))}function Qp(){}var iw=null,ow=null;function aw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var lw=typeof setTimeout=="function"?setTimeout:void 0,vF=typeof clearTimeout=="function"?clearTimeout:void 0,x1=typeof Promise=="function"?Promise:void 0,wF=typeof queueMicrotask=="function"?queueMicrotask:typeof x1<"u"?function(t){return x1.resolve(null).then(t).catch(xF)}:lw;function xF(t){setTimeout(function(){throw t})}function bv(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Mh(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Mh(e)}function so(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function _1(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qc=Math.random().toString(36).slice(2),ys="__reactFiber$"+qc,Vh="__reactProps$"+qc,oi="__reactContainer$"+qc,cw="__reactEvents$"+qc,_F="__reactListeners$"+qc,bF="__reactHandles$"+qc;function oa(t){var e=t[ys];if(e)return e;for(var n=t.parentNode;n;){if(e=n[oi]||n[ys]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=_1(t);t!==null;){if(n=t[ys])return n;t=_1(t)}return e}t=n,n=t.parentNode}return null}function Td(t){return t=t[ys]||t[oi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function zl(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Y(33))}function Dg(t){return t[Vh]||null}var uw=[],$l=-1;function No(t){return{current:t}}function ct(t){0>$l||(t.current=uw[$l],uw[$l]=null,$l--)}function nt(t,e){$l++,uw[$l]=t.current,t.current=e}var xo={},Cn=No(xo),Yn=No(!1),Aa=xo;function mc(t,e){var n=t.type.contextTypes;if(!n)return xo;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function Xn(t){return t=t.childContextTypes,t!=null}function Jp(){ct(Yn),ct(Cn)}function b1(t,e,n){if(Cn.current!==xo)throw Error(Y(168));nt(Cn,e),nt(Yn,n)}function CN(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(Y(108,o4(t)||"Unknown",s));return bt({},n,r)}function Yp(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||xo,Aa=Cn.current,nt(Cn,t),nt(Yn,Yn.current),!0}function T1(t,e,n){var r=t.stateNode;if(!r)throw Error(Y(169));n?(t=CN(t,e,Aa),r.__reactInternalMemoizedMergedChildContext=t,ct(Yn),ct(Cn),nt(Cn,t)):ct(Yn),nt(Yn,n)}var Hs=null,Lg=!1,Tv=!1;function IN(t){Hs===null?Hs=[t]:Hs.push(t)}function TF(t){Lg=!0,IN(t)}function Ro(){if(!Tv&&Hs!==null){Tv=!0;var t=0,e=Ge;try{var n=Hs;for(Ge=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Hs=null,Lg=!1}catch(s){throw Hs!==null&&(Hs=Hs.slice(t+1)),ZA(m_,Ro),s}finally{Ge=e,Tv=!1}}return null}var Ul=[],Hl=0,Xp=null,Zp=0,Cr=[],Ir=0,Na=null,Ks=1,Gs="";function Go(t,e){Ul[Hl++]=Zp,Ul[Hl++]=Xp,Xp=t,Zp=e}function AN(t,e,n){Cr[Ir++]=Ks,Cr[Ir++]=Gs,Cr[Ir++]=Na,Na=t;var r=Ks;t=Gs;var s=32-es(r)-1;r&=~(1<<s),n+=1;var i=32-es(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ks=1<<32-es(e)+s|n<<s|r,Gs=i+t}else Ks=1<<i|n<<s|r,Gs=t}function E_(t){t.return!==null&&(Go(t,1),AN(t,1,0))}function S_(t){for(;t===Xp;)Xp=Ul[--Hl],Ul[Hl]=null,Zp=Ul[--Hl],Ul[Hl]=null;for(;t===Na;)Na=Cr[--Ir],Cr[Ir]=null,Gs=Cr[--Ir],Cr[Ir]=null,Ks=Cr[--Ir],Cr[Ir]=null}var dr=null,cr=null,gt=!1,Gr=null;function NN(t,e){var n=Rr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function E1(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,dr=t,cr=so(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,dr=t,cr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Na!==null?{id:Ks,overflow:Gs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Rr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,dr=t,cr=null,!0):!1;default:return!1}}function hw(t){return(t.mode&1)!==0&&(t.flags&128)===0}function dw(t){if(gt){var e=cr;if(e){var n=e;if(!E1(t,e)){if(hw(t))throw Error(Y(418));e=so(n.nextSibling);var r=dr;e&&E1(t,e)?NN(r,n):(t.flags=t.flags&-4097|2,gt=!1,dr=t)}}else{if(hw(t))throw Error(Y(418));t.flags=t.flags&-4097|2,gt=!1,dr=t}}}function S1(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;dr=t}function vf(t){if(t!==dr)return!1;if(!gt)return S1(t),gt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!aw(t.type,t.memoizedProps)),e&&(e=cr)){if(hw(t))throw RN(),Error(Y(418));for(;e;)NN(t,e),e=so(e.nextSibling)}if(S1(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Y(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){cr=so(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}cr=null}}else cr=dr?so(t.stateNode.nextSibling):null;return!0}function RN(){for(var t=cr;t;)t=so(t.nextSibling)}function gc(){cr=dr=null,gt=!1}function k_(t){Gr===null?Gr=[t]:Gr.push(t)}var EF=pi.ReactCurrentBatchConfig;function yu(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Y(309));var r=n.stateNode}if(!r)throw Error(Y(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(Y(284));if(!n._owner)throw Error(Y(290,t))}return t}function wf(t,e){throw t=Object.prototype.toString.call(e),Error(Y(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function k1(t){var e=t._init;return e(t._payload)}function PN(t){function e(w,_){if(t){var E=w.deletions;E===null?(w.deletions=[_],w.flags|=16):E.push(_)}}function n(w,_){if(!t)return null;for(;_!==null;)e(w,_),_=_.sibling;return null}function r(w,_){for(w=new Map;_!==null;)_.key!==null?w.set(_.key,_):w.set(_.index,_),_=_.sibling;return w}function s(w,_){return w=lo(w,_),w.index=0,w.sibling=null,w}function i(w,_,E){return w.index=E,t?(E=w.alternate,E!==null?(E=E.index,E<_?(w.flags|=2,_):E):(w.flags|=2,_)):(w.flags|=1048576,_)}function o(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,_,E,N){return _===null||_.tag!==6?(_=Nv(E,w.mode,N),_.return=w,_):(_=s(_,E),_.return=w,_)}function l(w,_,E,N){var R=E.type;return R===jl?u(w,_,E.props.children,N,E.key):_!==null&&(_.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Di&&k1(R)===_.type)?(N=s(_,E.props),N.ref=yu(w,_,E),N.return=w,N):(N=dp(E.type,E.key,E.props,null,w.mode,N),N.ref=yu(w,_,E),N.return=w,N)}function c(w,_,E,N){return _===null||_.tag!==4||_.stateNode.containerInfo!==E.containerInfo||_.stateNode.implementation!==E.implementation?(_=Rv(E,w.mode,N),_.return=w,_):(_=s(_,E.children||[]),_.return=w,_)}function u(w,_,E,N,R){return _===null||_.tag!==7?(_=ya(E,w.mode,N,R),_.return=w,_):(_=s(_,E),_.return=w,_)}function h(w,_,E){if(typeof _=="string"&&_!==""||typeof _=="number")return _=Nv(""+_,w.mode,E),_.return=w,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case lf:return E=dp(_.type,_.key,_.props,null,w.mode,E),E.ref=yu(w,null,_),E.return=w,E;case Ll:return _=Rv(_,w.mode,E),_.return=w,_;case Di:var N=_._init;return h(w,N(_._payload),E)}if(Vu(_)||du(_))return _=ya(_,w.mode,E,null),_.return=w,_;wf(w,_)}return null}function f(w,_,E,N){var R=_!==null?_.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return R!==null?null:a(w,_,""+E,N);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case lf:return E.key===R?l(w,_,E,N):null;case Ll:return E.key===R?c(w,_,E,N):null;case Di:return R=E._init,f(w,_,R(E._payload),N)}if(Vu(E)||du(E))return R!==null?null:u(w,_,E,N,null);wf(w,E)}return null}function m(w,_,E,N,R){if(typeof N=="string"&&N!==""||typeof N=="number")return w=w.get(E)||null,a(_,w,""+N,R);if(typeof N=="object"&&N!==null){switch(N.$$typeof){case lf:return w=w.get(N.key===null?E:N.key)||null,l(_,w,N,R);case Ll:return w=w.get(N.key===null?E:N.key)||null,c(_,w,N,R);case Di:var O=N._init;return m(w,_,E,O(N._payload),R)}if(Vu(N)||du(N))return w=w.get(E)||null,u(_,w,N,R,null);wf(_,N)}return null}function g(w,_,E,N){for(var R=null,O=null,S=_,T=_=0,k=null;S!==null&&T<E.length;T++){S.index>T?(k=S,S=null):k=S.sibling;var I=f(w,S,E[T],N);if(I===null){S===null&&(S=k);break}t&&S&&I.alternate===null&&e(w,S),_=i(I,_,T),O===null?R=I:O.sibling=I,O=I,S=k}if(T===E.length)return n(w,S),gt&&Go(w,T),R;if(S===null){for(;T<E.length;T++)S=h(w,E[T],N),S!==null&&(_=i(S,_,T),O===null?R=S:O.sibling=S,O=S);return gt&&Go(w,T),R}for(S=r(w,S);T<E.length;T++)k=m(S,w,T,E[T],N),k!==null&&(t&&k.alternate!==null&&S.delete(k.key===null?T:k.key),_=i(k,_,T),O===null?R=k:O.sibling=k,O=k);return t&&S.forEach(function(M){return e(w,M)}),gt&&Go(w,T),R}function y(w,_,E,N){var R=du(E);if(typeof R!="function")throw Error(Y(150));if(E=R.call(E),E==null)throw Error(Y(151));for(var O=R=null,S=_,T=_=0,k=null,I=E.next();S!==null&&!I.done;T++,I=E.next()){S.index>T?(k=S,S=null):k=S.sibling;var M=f(w,S,I.value,N);if(M===null){S===null&&(S=k);break}t&&S&&M.alternate===null&&e(w,S),_=i(M,_,T),O===null?R=M:O.sibling=M,O=M,S=k}if(I.done)return n(w,S),gt&&Go(w,T),R;if(S===null){for(;!I.done;T++,I=E.next())I=h(w,I.value,N),I!==null&&(_=i(I,_,T),O===null?R=I:O.sibling=I,O=I);return gt&&Go(w,T),R}for(S=r(w,S);!I.done;T++,I=E.next())I=m(S,w,T,I.value,N),I!==null&&(t&&I.alternate!==null&&S.delete(I.key===null?T:I.key),_=i(I,_,T),O===null?R=I:O.sibling=I,O=I);return t&&S.forEach(function(D){return e(w,D)}),gt&&Go(w,T),R}function v(w,_,E,N){if(typeof E=="object"&&E!==null&&E.type===jl&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case lf:e:{for(var R=E.key,O=_;O!==null;){if(O.key===R){if(R=E.type,R===jl){if(O.tag===7){n(w,O.sibling),_=s(O,E.props.children),_.return=w,w=_;break e}}else if(O.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===Di&&k1(R)===O.type){n(w,O.sibling),_=s(O,E.props),_.ref=yu(w,O,E),_.return=w,w=_;break e}n(w,O);break}else e(w,O);O=O.sibling}E.type===jl?(_=ya(E.props.children,w.mode,N,E.key),_.return=w,w=_):(N=dp(E.type,E.key,E.props,null,w.mode,N),N.ref=yu(w,_,E),N.return=w,w=N)}return o(w);case Ll:e:{for(O=E.key;_!==null;){if(_.key===O)if(_.tag===4&&_.stateNode.containerInfo===E.containerInfo&&_.stateNode.implementation===E.implementation){n(w,_.sibling),_=s(_,E.children||[]),_.return=w,w=_;break e}else{n(w,_);break}else e(w,_);_=_.sibling}_=Rv(E,w.mode,N),_.return=w,w=_}return o(w);case Di:return O=E._init,v(w,_,O(E._payload),N)}if(Vu(E))return g(w,_,E,N);if(du(E))return y(w,_,E,N);wf(w,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,_!==null&&_.tag===6?(n(w,_.sibling),_=s(_,E),_.return=w,w=_):(n(w,_),_=Nv(E,w.mode,N),_.return=w,w=_),o(w)):n(w,_)}return v}var yc=PN(!0),MN=PN(!1),em=No(null),tm=null,Wl=null,C_=null;function I_(){C_=Wl=tm=null}function A_(t){var e=em.current;ct(em),t._currentValue=e}function fw(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function tc(t,e){tm=t,C_=Wl=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Qn=!0),t.firstContext=null)}function jr(t){var e=t._currentValue;if(C_!==t)if(t={context:t,memoizedValue:e,next:null},Wl===null){if(tm===null)throw Error(Y(308));Wl=t,tm.dependencies={lanes:0,firstContext:t}}else Wl=Wl.next=t;return e}var aa=null;function N_(t){aa===null?aa=[t]:aa.push(t)}function ON(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,N_(e)):(n.next=s.next,s.next=n),e.interleaved=n,ai(t,r)}function ai(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Li=!1;function R_(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function DN(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Zs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function io(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,Be&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,ai(t,n)}return s=r.interleaved,s===null?(e.next=e,N_(r)):(e.next=s.next,s.next=e),r.interleaved=e,ai(t,n)}function op(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,g_(t,n)}}function C1(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function nm(t,e,n,r){var s=t.updateQueue;Li=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,u=c=l=null,a=i;do{var f=a.lane,m=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:m,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,y=a;switch(f=e,m=n,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(m,h,f);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,f=typeof g=="function"?g.call(m,h,f):g,f==null)break e;h=bt({},h,f);break e;case 2:Li=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=s.effects,f===null?s.effects=[a]:f.push(a))}else m={eventTime:m,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=m,l=h):u=u.next=m,o|=f;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;f=a,a=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);Pa|=o,t.lanes=o,t.memoizedState=h}}function I1(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(Y(191,s));s.call(r)}}}var Ed={},bs=No(Ed),Fh=No(Ed),Bh=No(Ed);function la(t){if(t===Ed)throw Error(Y(174));return t}function P_(t,e){switch(nt(Bh,e),nt(Fh,t),nt(bs,Ed),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:K0(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=K0(e,t)}ct(bs),nt(bs,e)}function vc(){ct(bs),ct(Fh),ct(Bh)}function LN(t){la(Bh.current);var e=la(bs.current),n=K0(e,t.type);e!==n&&(nt(Fh,t),nt(bs,n))}function M_(t){Fh.current===t&&(ct(bs),ct(Fh))}var vt=No(0);function rm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Ev=[];function O_(){for(var t=0;t<Ev.length;t++)Ev[t]._workInProgressVersionPrimary=null;Ev.length=0}var ap=pi.ReactCurrentDispatcher,Sv=pi.ReactCurrentBatchConfig,Ra=0,xt=null,Ht=null,tn=null,sm=!1,rh=!1,zh=0,SF=0;function vn(){throw Error(Y(321))}function D_(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!rs(t[n],e[n]))return!1;return!0}function L_(t,e,n,r,s,i){if(Ra=i,xt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ap.current=t===null||t.memoizedState===null?AF:NF,t=n(r,s),rh){i=0;do{if(rh=!1,zh=0,25<=i)throw Error(Y(301));i+=1,tn=Ht=null,e.updateQueue=null,ap.current=RF,t=n(r,s)}while(rh)}if(ap.current=im,e=Ht!==null&&Ht.next!==null,Ra=0,tn=Ht=xt=null,sm=!1,e)throw Error(Y(300));return t}function j_(){var t=zh!==0;return zh=0,t}function ds(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return tn===null?xt.memoizedState=tn=t:tn=tn.next=t,tn}function Vr(){if(Ht===null){var t=xt.alternate;t=t!==null?t.memoizedState:null}else t=Ht.next;var e=tn===null?xt.memoizedState:tn.next;if(e!==null)tn=e,Ht=t;else{if(t===null)throw Error(Y(310));Ht=t,t={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},tn===null?xt.memoizedState=tn=t:tn=tn.next=t}return tn}function $h(t,e){return typeof e=="function"?e(t):e}function kv(t){var e=Vr(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=Ht,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((Ra&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,xt.lanes|=u,Pa|=u}c=c.next}while(c!==null&&c!==i);l===null?o=r:l.next=a,rs(r,e.memoizedState)||(Qn=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,xt.lanes|=i,Pa|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Cv(t){var e=Vr(),n=e.queue;if(n===null)throw Error(Y(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);rs(i,e.memoizedState)||(Qn=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function jN(){}function VN(t,e){var n=xt,r=Vr(),s=e(),i=!rs(r.memoizedState,s);if(i&&(r.memoizedState=s,Qn=!0),r=r.queue,V_(zN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||tn!==null&&tn.memoizedState.tag&1){if(n.flags|=2048,Uh(9,BN.bind(null,n,r,s,e),void 0,null),on===null)throw Error(Y(349));Ra&30||FN(n,e,s)}return s}function FN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=xt.updateQueue,e===null?(e={lastEffect:null,stores:null},xt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function BN(t,e,n,r){e.value=n,e.getSnapshot=r,$N(e)&&UN(t)}function zN(t,e,n){return n(function(){$N(e)&&UN(t)})}function $N(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!rs(t,n)}catch{return!0}}function UN(t){var e=ai(t,1);e!==null&&ts(e,t,1,-1)}function A1(t){var e=ds();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:$h,lastRenderedState:t},e.queue=t,t=t.dispatch=IF.bind(null,xt,t),[e.memoizedState,t]}function Uh(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=xt.updateQueue,e===null?(e={lastEffect:null,stores:null},xt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function HN(){return Vr().memoizedState}function lp(t,e,n,r){var s=ds();xt.flags|=t,s.memoizedState=Uh(1|e,n,void 0,r===void 0?null:r)}function jg(t,e,n,r){var s=Vr();r=r===void 0?null:r;var i=void 0;if(Ht!==null){var o=Ht.memoizedState;if(i=o.destroy,r!==null&&D_(r,o.deps)){s.memoizedState=Uh(e,n,i,r);return}}xt.flags|=t,s.memoizedState=Uh(1|e,n,i,r)}function N1(t,e){return lp(8390656,8,t,e)}function V_(t,e){return jg(2048,8,t,e)}function WN(t,e){return jg(4,2,t,e)}function qN(t,e){return jg(4,4,t,e)}function KN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function GN(t,e,n){return n=n!=null?n.concat([t]):null,jg(4,4,KN.bind(null,e,t),n)}function F_(){}function QN(t,e){var n=Vr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&D_(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function JN(t,e){var n=Vr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&D_(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function YN(t,e,n){return Ra&21?(rs(n,e)||(n=nN(),xt.lanes|=n,Pa|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Qn=!0),t.memoizedState=n)}function kF(t,e){var n=Ge;Ge=n!==0&&4>n?n:4,t(!0);var r=Sv.transition;Sv.transition={};try{t(!1),e()}finally{Ge=n,Sv.transition=r}}function XN(){return Vr().memoizedState}function CF(t,e,n){var r=ao(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ZN(t))eR(e,n);else if(n=ON(t,e,n,r),n!==null){var s=jn();ts(n,t,r,s),tR(n,e,r)}}function IF(t,e,n){var r=ao(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ZN(t))eR(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,rs(a,o)){var l=e.interleaved;l===null?(s.next=s,N_(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=ON(t,e,s,r),n!==null&&(s=jn(),ts(n,t,r,s),tR(n,e,r))}}function ZN(t){var e=t.alternate;return t===xt||e!==null&&e===xt}function eR(t,e){rh=sm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function tR(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,g_(t,n)}}var im={readContext:jr,useCallback:vn,useContext:vn,useEffect:vn,useImperativeHandle:vn,useInsertionEffect:vn,useLayoutEffect:vn,useMemo:vn,useReducer:vn,useRef:vn,useState:vn,useDebugValue:vn,useDeferredValue:vn,useTransition:vn,useMutableSource:vn,useSyncExternalStore:vn,useId:vn,unstable_isNewReconciler:!1},AF={readContext:jr,useCallback:function(t,e){return ds().memoizedState=[t,e===void 0?null:e],t},useContext:jr,useEffect:N1,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,lp(4194308,4,KN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return lp(4194308,4,t,e)},useInsertionEffect:function(t,e){return lp(4,2,t,e)},useMemo:function(t,e){var n=ds();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ds();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=CF.bind(null,xt,t),[r.memoizedState,t]},useRef:function(t){var e=ds();return t={current:t},e.memoizedState=t},useState:A1,useDebugValue:F_,useDeferredValue:function(t){return ds().memoizedState=t},useTransition:function(){var t=A1(!1),e=t[0];return t=kF.bind(null,t[1]),ds().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=xt,s=ds();if(gt){if(n===void 0)throw Error(Y(407));n=n()}else{if(n=e(),on===null)throw Error(Y(349));Ra&30||FN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,N1(zN.bind(null,r,i,t),[t]),r.flags|=2048,Uh(9,BN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=ds(),e=on.identifierPrefix;if(gt){var n=Gs,r=Ks;n=(r&~(1<<32-es(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=zh++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=SF++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},NF={readContext:jr,useCallback:QN,useContext:jr,useEffect:V_,useImperativeHandle:GN,useInsertionEffect:WN,useLayoutEffect:qN,useMemo:JN,useReducer:kv,useRef:HN,useState:function(){return kv($h)},useDebugValue:F_,useDeferredValue:function(t){var e=Vr();return YN(e,Ht.memoizedState,t)},useTransition:function(){var t=kv($h)[0],e=Vr().memoizedState;return[t,e]},useMutableSource:jN,useSyncExternalStore:VN,useId:XN,unstable_isNewReconciler:!1},RF={readContext:jr,useCallback:QN,useContext:jr,useEffect:V_,useImperativeHandle:GN,useInsertionEffect:WN,useLayoutEffect:qN,useMemo:JN,useReducer:Cv,useRef:HN,useState:function(){return Cv($h)},useDebugValue:F_,useDeferredValue:function(t){var e=Vr();return Ht===null?e.memoizedState=t:YN(e,Ht.memoizedState,t)},useTransition:function(){var t=Cv($h)[0],e=Vr().memoizedState;return[t,e]},useMutableSource:jN,useSyncExternalStore:VN,useId:XN,unstable_isNewReconciler:!1};function Wr(t,e){if(t&&t.defaultProps){e=bt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function pw(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:bt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Vg={isMounted:function(t){return(t=t._reactInternals)?tl(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=jn(),s=ao(t),i=Zs(r,s);i.payload=e,n!=null&&(i.callback=n),e=io(t,i,s),e!==null&&(ts(e,t,s,r),op(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=jn(),s=ao(t),i=Zs(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=io(t,i,s),e!==null&&(ts(e,t,s,r),op(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=jn(),r=ao(t),s=Zs(n,r);s.tag=2,e!=null&&(s.callback=e),e=io(t,s,r),e!==null&&(ts(e,t,r,n),op(e,t,r))}};function R1(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Dh(n,r)||!Dh(s,i):!0}function nR(t,e,n){var r=!1,s=xo,i=e.contextType;return typeof i=="object"&&i!==null?i=jr(i):(s=Xn(e)?Aa:Cn.current,r=e.contextTypes,i=(r=r!=null)?mc(t,s):xo),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Vg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function P1(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Vg.enqueueReplaceState(e,e.state,null)}function mw(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},R_(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=jr(i):(i=Xn(e)?Aa:Cn.current,s.context=mc(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(pw(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Vg.enqueueReplaceState(s,s.state,null),nm(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function wc(t,e){try{var n="",r=e;do n+=i4(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Iv(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function gw(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var PF=typeof WeakMap=="function"?WeakMap:Map;function rR(t,e,n){n=Zs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){am||(am=!0,kw=r),gw(t,e)},n}function sR(t,e,n){n=Zs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){gw(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){gw(t,e),typeof r!="function"&&(oo===null?oo=new Set([this]):oo.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function M1(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new PF;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=qF.bind(null,t,e,n),e.then(t,t))}function O1(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function D1(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Zs(-1,1),e.tag=2,io(n,e,1))),n.lanes|=1),t)}var MF=pi.ReactCurrentOwner,Qn=!1;function Dn(t,e,n,r){e.child=t===null?MN(e,null,n,r):yc(e,t.child,n,r)}function L1(t,e,n,r,s){n=n.render;var i=e.ref;return tc(e,s),r=L_(t,e,n,r,i,s),n=j_(),t!==null&&!Qn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,li(t,e,s)):(gt&&n&&E_(e),e.flags|=1,Dn(t,e,r,s),e.child)}function j1(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!K_(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,iR(t,e,i,r,s)):(t=dp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Dh,n(o,r)&&t.ref===e.ref)return li(t,e,s)}return e.flags|=1,t=lo(i,r),t.ref=e.ref,t.return=e,e.child=t}function iR(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Dh(i,r)&&t.ref===e.ref)if(Qn=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(Qn=!0);else return e.lanes=t.lanes,li(t,e,s)}return yw(t,e,n,r,s)}function oR(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(Kl,sr),sr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nt(Kl,sr),sr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,nt(Kl,sr),sr|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,nt(Kl,sr),sr|=r;return Dn(t,e,s,n),e.child}function aR(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function yw(t,e,n,r,s){var i=Xn(n)?Aa:Cn.current;return i=mc(e,i),tc(e,s),n=L_(t,e,n,r,i,s),r=j_(),t!==null&&!Qn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,li(t,e,s)):(gt&&r&&E_(e),e.flags|=1,Dn(t,e,n,s),e.child)}function V1(t,e,n,r,s){if(Xn(n)){var i=!0;Yp(e)}else i=!1;if(tc(e,s),e.stateNode===null)cp(t,e),nR(e,n,r),mw(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=jr(c):(c=Xn(n)?Aa:Cn.current,c=mc(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&P1(e,o,r,c),Li=!1;var f=e.memoizedState;o.state=f,nm(e,r,o,s),l=e.memoizedState,a!==r||f!==l||Yn.current||Li?(typeof u=="function"&&(pw(e,n,u,r),l=e.memoizedState),(a=Li||R1(e,n,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,DN(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Wr(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=jr(l):(l=Xn(n)?Aa:Cn.current,l=mc(e,l));var m=n.getDerivedStateFromProps;(u=typeof m=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&P1(e,o,r,l),Li=!1,f=e.memoizedState,o.state=f,nm(e,r,o,s);var g=e.memoizedState;a!==h||f!==g||Yn.current||Li?(typeof m=="function"&&(pw(e,n,m,r),g=e.memoizedState),(c=Li||R1(e,n,c,r,f,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return vw(t,e,n,r,i,s)}function vw(t,e,n,r,s,i){aR(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&T1(e,n,!1),li(t,e,i);r=e.stateNode,MF.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=yc(e,t.child,null,i),e.child=yc(e,null,a,i)):Dn(t,e,a,i),e.memoizedState=r.state,s&&T1(e,n,!0),e.child}function lR(t){var e=t.stateNode;e.pendingContext?b1(t,e.pendingContext,e.pendingContext!==e.context):e.context&&b1(t,e.context,!1),P_(t,e.containerInfo)}function F1(t,e,n,r,s){return gc(),k_(s),e.flags|=256,Dn(t,e,n,r),e.child}var ww={dehydrated:null,treeContext:null,retryLane:0};function xw(t){return{baseLanes:t,cachePool:null,transitions:null}}function cR(t,e,n){var r=e.pendingProps,s=vt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),nt(vt,s&1),t===null)return dw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=zg(o,r,0,null),t=ya(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=xw(n),e.memoizedState=ww,t):B_(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return OF(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=lo(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=lo(a,i):(i=ya(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?xw(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=ww,r}return i=t.child,t=i.sibling,r=lo(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function B_(t,e){return e=zg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function xf(t,e,n,r){return r!==null&&k_(r),yc(e,t.child,null,n),t=B_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function OF(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Iv(Error(Y(422))),xf(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=zg({mode:"visible",children:r.children},s,0,null),i=ya(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&yc(e,t.child,null,o),e.child.memoizedState=xw(o),e.memoizedState=ww,i);if(!(e.mode&1))return xf(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(Y(419)),r=Iv(i,r,void 0),xf(t,e,o,r)}if(a=(o&t.childLanes)!==0,Qn||a){if(r=on,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,ai(t,s),ts(r,t,s,-1))}return q_(),r=Iv(Error(Y(421))),xf(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=KF.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,cr=so(s.nextSibling),dr=e,gt=!0,Gr=null,t!==null&&(Cr[Ir++]=Ks,Cr[Ir++]=Gs,Cr[Ir++]=Na,Ks=t.id,Gs=t.overflow,Na=e),e=B_(e,r.children),e.flags|=4096,e)}function B1(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),fw(t.return,e,n)}function Av(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function uR(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Dn(t,e,r.children,n),r=vt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&B1(t,n,e);else if(t.tag===19)B1(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(nt(vt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&rm(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Av(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&rm(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Av(e,!0,n,null,i);break;case"together":Av(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function cp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function li(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pa|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Y(153));if(e.child!==null){for(t=e.child,n=lo(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=lo(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function DF(t,e,n){switch(e.tag){case 3:lR(e),gc();break;case 5:LN(e);break;case 1:Xn(e.type)&&Yp(e);break;case 4:P_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;nt(em,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(nt(vt,vt.current&1),e.flags|=128,null):n&e.child.childLanes?cR(t,e,n):(nt(vt,vt.current&1),t=li(t,e,n),t!==null?t.sibling:null);nt(vt,vt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return uR(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),nt(vt,vt.current),r)break;return null;case 22:case 23:return e.lanes=0,oR(t,e,n)}return li(t,e,n)}var hR,_w,dR,fR;hR=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};_w=function(){};dR=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,la(bs.current);var i=null;switch(n){case"input":s=U0(t,s),r=U0(t,r),i=[];break;case"select":s=bt({},s,{value:void 0}),r=bt({},r,{value:void 0}),i=[];break;case"textarea":s=q0(t,s),r=q0(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Qp)}G0(n,r);var o;n=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Ih.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Ih.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&at("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};fR=function(t,e,n,r){n!==r&&(e.flags|=4)};function vu(t,e){if(!gt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function wn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function LF(t,e,n){var r=e.pendingProps;switch(S_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return wn(e),null;case 1:return Xn(e.type)&&Jp(),wn(e),null;case 3:return r=e.stateNode,vc(),ct(Yn),ct(Cn),O_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(vf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Gr!==null&&(Aw(Gr),Gr=null))),_w(t,e),wn(e),null;case 5:M_(e);var s=la(Bh.current);if(n=e.type,t!==null&&e.stateNode!=null)dR(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Y(166));return wn(e),null}if(t=la(bs.current),vf(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[ys]=e,r[Vh]=i,t=(e.mode&1)!==0,n){case"dialog":at("cancel",r),at("close",r);break;case"iframe":case"object":case"embed":at("load",r);break;case"video":case"audio":for(s=0;s<Bu.length;s++)at(Bu[s],r);break;case"source":at("error",r);break;case"img":case"image":case"link":at("error",r),at("load",r);break;case"details":at("toggle",r);break;case"input":QE(r,i),at("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},at("invalid",r);break;case"textarea":YE(r,i),at("invalid",r)}G0(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&yf(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&yf(r.textContent,a,t),s=["children",""+a]):Ih.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&at("scroll",r)}switch(n){case"input":cf(r),JE(r,i,!0);break;case"textarea":cf(r),XE(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=Qp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=zA(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[ys]=e,t[Vh]=r,hR(t,e,!1,!1),e.stateNode=t;e:{switch(o=Q0(n,r),n){case"dialog":at("cancel",t),at("close",t),s=r;break;case"iframe":case"object":case"embed":at("load",t),s=r;break;case"video":case"audio":for(s=0;s<Bu.length;s++)at(Bu[s],t);s=r;break;case"source":at("error",t),s=r;break;case"img":case"image":case"link":at("error",t),at("load",t),s=r;break;case"details":at("toggle",t),s=r;break;case"input":QE(t,r),s=U0(t,r),at("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=bt({},r,{value:void 0}),at("invalid",t);break;case"textarea":YE(t,r),s=q0(t,r),at("invalid",t);break;default:s=r}G0(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?HA(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&$A(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Ah(t,l):typeof l=="number"&&Ah(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Ih.hasOwnProperty(i)?l!=null&&i==="onScroll"&&at("scroll",t):l!=null&&u_(t,i,l,o))}switch(n){case"input":cf(t),JE(t,r,!1);break;case"textarea":cf(t),XE(t);break;case"option":r.value!=null&&t.setAttribute("value",""+wo(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Yl(t,!!r.multiple,i,!1):r.defaultValue!=null&&Yl(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=Qp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return wn(e),null;case 6:if(t&&e.stateNode!=null)fR(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Y(166));if(n=la(Bh.current),la(bs.current),vf(e)){if(r=e.stateNode,n=e.memoizedProps,r[ys]=e,(i=r.nodeValue!==n)&&(t=dr,t!==null))switch(t.tag){case 3:yf(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&yf(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ys]=e,e.stateNode=r}return wn(e),null;case 13:if(ct(vt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gt&&cr!==null&&e.mode&1&&!(e.flags&128))RN(),gc(),e.flags|=98560,i=!1;else if(i=vf(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(Y(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Y(317));i[ys]=e}else gc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;wn(e),i=!1}else Gr!==null&&(Aw(Gr),Gr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||vt.current&1?Wt===0&&(Wt=3):q_())),e.updateQueue!==null&&(e.flags|=4),wn(e),null);case 4:return vc(),_w(t,e),t===null&&Lh(e.stateNode.containerInfo),wn(e),null;case 10:return A_(e.type._context),wn(e),null;case 17:return Xn(e.type)&&Jp(),wn(e),null;case 19:if(ct(vt),i=e.memoizedState,i===null)return wn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)vu(i,!1);else{if(Wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=rm(t),o!==null){for(e.flags|=128,vu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return nt(vt,vt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Ot()>xc&&(e.flags|=128,r=!0,vu(i,!1),e.lanes=4194304)}else{if(!r)if(t=rm(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),vu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!gt)return wn(e),null}else 2*Ot()-i.renderingStartTime>xc&&n!==1073741824&&(e.flags|=128,r=!0,vu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Ot(),e.sibling=null,n=vt.current,nt(vt,r?n&1|2:n&1),e):(wn(e),null);case 22:case 23:return W_(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?sr&1073741824&&(wn(e),e.subtreeFlags&6&&(e.flags|=8192)):wn(e),null;case 24:return null;case 25:return null}throw Error(Y(156,e.tag))}function jF(t,e){switch(S_(e),e.tag){case 1:return Xn(e.type)&&Jp(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return vc(),ct(Yn),ct(Cn),O_(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return M_(e),null;case 13:if(ct(vt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Y(340));gc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ct(vt),null;case 4:return vc(),null;case 10:return A_(e.type._context),null;case 22:case 23:return W_(),null;case 24:return null;default:return null}}var _f=!1,Tn=!1,VF=typeof WeakSet=="function"?WeakSet:Set,le=null;function ql(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){It(t,e,r)}else n.current=null}function bw(t,e,n){try{n()}catch(r){It(t,e,r)}}var z1=!1;function FF(t,e){if(iw=qp,t=vN(),T_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var m;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(m=h.firstChild)!==null;)f=h,h=m;for(;;){if(h===t)break t;if(f===n&&++c===s&&(a=o),f===i&&++u===r&&(l=o),(m=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=m}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(ow={focusedElem:t,selectionRange:n},qp=!1,le=e;le!==null;)if(e=le,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,le=t;else for(;le!==null;){e=le;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,v=g.memoizedState,w=e.stateNode,_=w.getSnapshotBeforeUpdate(e.elementType===e.type?y:Wr(e.type,y),v);w.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Y(163))}}catch(N){It(e,e.return,N)}if(t=e.sibling,t!==null){t.return=e.return,le=t;break}le=e.return}return g=z1,z1=!1,g}function sh(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&bw(e,n,i)}s=s.next}while(s!==r)}}function Fg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Tw(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function pR(t){var e=t.alternate;e!==null&&(t.alternate=null,pR(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ys],delete e[Vh],delete e[cw],delete e[_F],delete e[bF])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function mR(t){return t.tag===5||t.tag===3||t.tag===4}function $1(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||mR(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Ew(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Qp));else if(r!==4&&(t=t.child,t!==null))for(Ew(t,e,n),t=t.sibling;t!==null;)Ew(t,e,n),t=t.sibling}function Sw(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Sw(t,e,n),t=t.sibling;t!==null;)Sw(t,e,n),t=t.sibling}var cn=null,qr=!1;function Ci(t,e,n){for(n=n.child;n!==null;)gR(t,e,n),n=n.sibling}function gR(t,e,n){if(_s&&typeof _s.onCommitFiberUnmount=="function")try{_s.onCommitFiberUnmount(Rg,n)}catch{}switch(n.tag){case 5:Tn||ql(n,e);case 6:var r=cn,s=qr;cn=null,Ci(t,e,n),cn=r,qr=s,cn!==null&&(qr?(t=cn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):cn.removeChild(n.stateNode));break;case 18:cn!==null&&(qr?(t=cn,n=n.stateNode,t.nodeType===8?bv(t.parentNode,n):t.nodeType===1&&bv(t,n),Mh(t)):bv(cn,n.stateNode));break;case 4:r=cn,s=qr,cn=n.stateNode.containerInfo,qr=!0,Ci(t,e,n),cn=r,qr=s;break;case 0:case 11:case 14:case 15:if(!Tn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&bw(n,e,o),s=s.next}while(s!==r)}Ci(t,e,n);break;case 1:if(!Tn&&(ql(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){It(n,e,a)}Ci(t,e,n);break;case 21:Ci(t,e,n);break;case 22:n.mode&1?(Tn=(r=Tn)||n.memoizedState!==null,Ci(t,e,n),Tn=r):Ci(t,e,n);break;default:Ci(t,e,n)}}function U1(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new VF),e.forEach(function(r){var s=GF.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Hr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:cn=a.stateNode,qr=!1;break e;case 3:cn=a.stateNode.containerInfo,qr=!0;break e;case 4:cn=a.stateNode.containerInfo,qr=!0;break e}a=a.return}if(cn===null)throw Error(Y(160));gR(i,o,s),cn=null,qr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){It(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yR(e,t),e=e.sibling}function yR(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Hr(e,t),hs(t),r&4){try{sh(3,t,t.return),Fg(3,t)}catch(y){It(t,t.return,y)}try{sh(5,t,t.return)}catch(y){It(t,t.return,y)}}break;case 1:Hr(e,t),hs(t),r&512&&n!==null&&ql(n,n.return);break;case 5:if(Hr(e,t),hs(t),r&512&&n!==null&&ql(n,n.return),t.flags&32){var s=t.stateNode;try{Ah(s,"")}catch(y){It(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&FA(s,i),Q0(a,o);var c=Q0(a,i);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?HA(s,h):u==="dangerouslySetInnerHTML"?$A(s,h):u==="children"?Ah(s,h):u_(s,u,h,c)}switch(a){case"input":H0(s,i);break;case"textarea":BA(s,i);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var m=i.value;m!=null?Yl(s,!!i.multiple,m,!1):f!==!!i.multiple&&(i.defaultValue!=null?Yl(s,!!i.multiple,i.defaultValue,!0):Yl(s,!!i.multiple,i.multiple?[]:"",!1))}s[Vh]=i}catch(y){It(t,t.return,y)}}break;case 6:if(Hr(e,t),hs(t),r&4){if(t.stateNode===null)throw Error(Y(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){It(t,t.return,y)}}break;case 3:if(Hr(e,t),hs(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Mh(e.containerInfo)}catch(y){It(t,t.return,y)}break;case 4:Hr(e,t),hs(t);break;case 13:Hr(e,t),hs(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(U_=Ot())),r&4&&U1(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Tn=(c=Tn)||u,Hr(e,t),Tn=c):Hr(e,t),hs(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(le=t,u=t.child;u!==null;){for(h=le=u;le!==null;){switch(f=le,m=f.child,f.tag){case 0:case 11:case 14:case 15:sh(4,f,f.return);break;case 1:ql(f,f.return);var g=f.stateNode;if(typeof g.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){It(r,n,y)}}break;case 5:ql(f,f.return);break;case 22:if(f.memoizedState!==null){W1(h);continue}}m!==null?(m.return=f,le=m):W1(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=UA("display",o))}catch(y){It(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){It(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Hr(e,t),hs(t),r&4&&U1(t);break;case 21:break;default:Hr(e,t),hs(t)}}function hs(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(mR(n)){var r=n;break e}n=n.return}throw Error(Y(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Ah(s,""),r.flags&=-33);var i=$1(t);Sw(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=$1(t);Ew(t,a,o);break;default:throw Error(Y(161))}}catch(l){It(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function BF(t,e,n){le=t,vR(t)}function vR(t,e,n){for(var r=(t.mode&1)!==0;le!==null;){var s=le,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||_f;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Tn;a=_f;var c=Tn;if(_f=o,(Tn=l)&&!c)for(le=s;le!==null;)o=le,l=o.child,o.tag===22&&o.memoizedState!==null?q1(s):l!==null?(l.return=o,le=l):q1(s);for(;i!==null;)le=i,vR(i),i=i.sibling;le=s,_f=a,Tn=c}H1(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,le=i):H1(t)}}function H1(t){for(;le!==null;){var e=le;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Tn||Fg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Tn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Wr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&I1(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}I1(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Mh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Y(163))}Tn||e.flags&512&&Tw(e)}catch(f){It(e,e.return,f)}}if(e===t){le=null;break}if(n=e.sibling,n!==null){n.return=e.return,le=n;break}le=e.return}}function W1(t){for(;le!==null;){var e=le;if(e===t){le=null;break}var n=e.sibling;if(n!==null){n.return=e.return,le=n;break}le=e.return}}function q1(t){for(;le!==null;){var e=le;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Fg(4,e)}catch(l){It(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){It(e,s,l)}}var i=e.return;try{Tw(e)}catch(l){It(e,i,l)}break;case 5:var o=e.return;try{Tw(e)}catch(l){It(e,o,l)}}}catch(l){It(e,e.return,l)}if(e===t){le=null;break}var a=e.sibling;if(a!==null){a.return=e.return,le=a;break}le=e.return}}var zF=Math.ceil,om=pi.ReactCurrentDispatcher,z_=pi.ReactCurrentOwner,Mr=pi.ReactCurrentBatchConfig,Be=0,on=null,jt=null,mn=0,sr=0,Kl=No(0),Wt=0,Hh=null,Pa=0,Bg=0,$_=0,ih=null,Kn=null,U_=0,xc=1/0,$s=null,am=!1,kw=null,oo=null,bf=!1,Ji=null,lm=0,oh=0,Cw=null,up=-1,hp=0;function jn(){return Be&6?Ot():up!==-1?up:up=Ot()}function ao(t){return t.mode&1?Be&2&&mn!==0?mn&-mn:EF.transition!==null?(hp===0&&(hp=nN()),hp):(t=Ge,t!==0||(t=window.event,t=t===void 0?16:cN(t.type)),t):1}function ts(t,e,n,r){if(50<oh)throw oh=0,Cw=null,Error(Y(185));_d(t,n,r),(!(Be&2)||t!==on)&&(t===on&&(!(Be&2)&&(Bg|=n),Wt===4&&zi(t,mn)),Zn(t,r),n===1&&Be===0&&!(e.mode&1)&&(xc=Ot()+500,Lg&&Ro()))}function Zn(t,e){var n=t.callbackNode;E4(t,e);var r=Wp(t,t===on?mn:0);if(r===0)n!==null&&t1(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&t1(n),e===1)t.tag===0?TF(K1.bind(null,t)):IN(K1.bind(null,t)),wF(function(){!(Be&6)&&Ro()}),n=null;else{switch(rN(r)){case 1:n=m_;break;case 4:n=eN;break;case 16:n=Hp;break;case 536870912:n=tN;break;default:n=Hp}n=kR(n,wR.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function wR(t,e){if(up=-1,hp=0,Be&6)throw Error(Y(327));var n=t.callbackNode;if(nc()&&t.callbackNode!==n)return null;var r=Wp(t,t===on?mn:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=cm(t,r);else{e=r;var s=Be;Be|=2;var i=_R();(on!==t||mn!==e)&&($s=null,xc=Ot()+500,ga(t,e));do try{HF();break}catch(a){xR(t,a)}while(!0);I_(),om.current=i,Be=s,jt!==null?e=0:(on=null,mn=0,e=Wt)}if(e!==0){if(e===2&&(s=ew(t),s!==0&&(r=s,e=Iw(t,s))),e===1)throw n=Hh,ga(t,0),zi(t,r),Zn(t,Ot()),n;if(e===6)zi(t,r);else{if(s=t.current.alternate,!(r&30)&&!$F(s)&&(e=cm(t,r),e===2&&(i=ew(t),i!==0&&(r=i,e=Iw(t,i))),e===1))throw n=Hh,ga(t,0),zi(t,r),Zn(t,Ot()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(Y(345));case 2:Qo(t,Kn,$s);break;case 3:if(zi(t,r),(r&130023424)===r&&(e=U_+500-Ot(),10<e)){if(Wp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){jn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=lw(Qo.bind(null,t,Kn,$s),e);break}Qo(t,Kn,$s);break;case 4:if(zi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-es(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Ot()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*zF(r/1960))-r,10<r){t.timeoutHandle=lw(Qo.bind(null,t,Kn,$s),r);break}Qo(t,Kn,$s);break;case 5:Qo(t,Kn,$s);break;default:throw Error(Y(329))}}}return Zn(t,Ot()),t.callbackNode===n?wR.bind(null,t):null}function Iw(t,e){var n=ih;return t.current.memoizedState.isDehydrated&&(ga(t,e).flags|=256),t=cm(t,e),t!==2&&(e=Kn,Kn=n,e!==null&&Aw(e)),t}function Aw(t){Kn===null?Kn=t:Kn.push.apply(Kn,t)}function $F(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!rs(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function zi(t,e){for(e&=~$_,e&=~Bg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-es(e),r=1<<n;t[n]=-1,e&=~r}}function K1(t){if(Be&6)throw Error(Y(327));nc();var e=Wp(t,0);if(!(e&1))return Zn(t,Ot()),null;var n=cm(t,e);if(t.tag!==0&&n===2){var r=ew(t);r!==0&&(e=r,n=Iw(t,r))}if(n===1)throw n=Hh,ga(t,0),zi(t,e),Zn(t,Ot()),n;if(n===6)throw Error(Y(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Qo(t,Kn,$s),Zn(t,Ot()),null}function H_(t,e){var n=Be;Be|=1;try{return t(e)}finally{Be=n,Be===0&&(xc=Ot()+500,Lg&&Ro())}}function Ma(t){Ji!==null&&Ji.tag===0&&!(Be&6)&&nc();var e=Be;Be|=1;var n=Mr.transition,r=Ge;try{if(Mr.transition=null,Ge=1,t)return t()}finally{Ge=r,Mr.transition=n,Be=e,!(Be&6)&&Ro()}}function W_(){sr=Kl.current,ct(Kl)}function ga(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,vF(n)),jt!==null)for(n=jt.return;n!==null;){var r=n;switch(S_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Jp();break;case 3:vc(),ct(Yn),ct(Cn),O_();break;case 5:M_(r);break;case 4:vc();break;case 13:ct(vt);break;case 19:ct(vt);break;case 10:A_(r.type._context);break;case 22:case 23:W_()}n=n.return}if(on=t,jt=t=lo(t.current,null),mn=sr=e,Wt=0,Hh=null,$_=Bg=Pa=0,Kn=ih=null,aa!==null){for(e=0;e<aa.length;e++)if(n=aa[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}aa=null}return t}function xR(t,e){do{var n=jt;try{if(I_(),ap.current=im,sm){for(var r=xt.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}sm=!1}if(Ra=0,tn=Ht=xt=null,rh=!1,zh=0,z_.current=null,n===null||n.return===null){Wt=1,Hh=e,jt=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=mn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var m=O1(o);if(m!==null){m.flags&=-257,D1(m,o,a,i,e),m.mode&1&&M1(i,c,e),e=m,l=c;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){M1(i,c,e),q_();break e}l=Error(Y(426))}}else if(gt&&a.mode&1){var v=O1(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),D1(v,o,a,i,e),k_(wc(l,a));break e}}i=l=wc(l,a),Wt!==4&&(Wt=2),ih===null?ih=[i]:ih.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var w=rR(i,l,e);C1(i,w);break e;case 1:a=l;var _=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof _.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(oo===null||!oo.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var N=sR(i,a,e);C1(i,N);break e}}i=i.return}while(i!==null)}TR(n)}catch(R){e=R,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(!0)}function _R(){var t=om.current;return om.current=im,t===null?im:t}function q_(){(Wt===0||Wt===3||Wt===2)&&(Wt=4),on===null||!(Pa&268435455)&&!(Bg&268435455)||zi(on,mn)}function cm(t,e){var n=Be;Be|=2;var r=_R();(on!==t||mn!==e)&&($s=null,ga(t,e));do try{UF();break}catch(s){xR(t,s)}while(!0);if(I_(),Be=n,om.current=r,jt!==null)throw Error(Y(261));return on=null,mn=0,Wt}function UF(){for(;jt!==null;)bR(jt)}function HF(){for(;jt!==null&&!m4();)bR(jt)}function bR(t){var e=SR(t.alternate,t,sr);t.memoizedProps=t.pendingProps,e===null?TR(t):jt=e,z_.current=null}function TR(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=jF(n,e),n!==null){n.flags&=32767,jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Wt=6,jt=null;return}}else if(n=LF(n,e,sr),n!==null){jt=n;return}if(e=e.sibling,e!==null){jt=e;return}jt=e=t}while(e!==null);Wt===0&&(Wt=5)}function Qo(t,e,n){var r=Ge,s=Mr.transition;try{Mr.transition=null,Ge=1,WF(t,e,n,r)}finally{Mr.transition=s,Ge=r}return null}function WF(t,e,n,r){do nc();while(Ji!==null);if(Be&6)throw Error(Y(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Y(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if(S4(t,i),t===on&&(jt=on=null,mn=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||bf||(bf=!0,kR(Hp,function(){return nc(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Mr.transition,Mr.transition=null;var o=Ge;Ge=1;var a=Be;Be|=4,z_.current=null,FF(t,n),yR(n,t),hF(ow),qp=!!iw,ow=iw=null,t.current=n,BF(n),g4(),Be=a,Ge=o,Mr.transition=i}else t.current=n;if(bf&&(bf=!1,Ji=t,lm=s),i=t.pendingLanes,i===0&&(oo=null),w4(n.stateNode),Zn(t,Ot()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(am)throw am=!1,t=kw,kw=null,t;return lm&1&&t.tag!==0&&nc(),i=t.pendingLanes,i&1?t===Cw?oh++:(oh=0,Cw=t):oh=0,Ro(),null}function nc(){if(Ji!==null){var t=rN(lm),e=Mr.transition,n=Ge;try{if(Mr.transition=null,Ge=16>t?16:t,Ji===null)var r=!1;else{if(t=Ji,Ji=null,lm=0,Be&6)throw Error(Y(331));var s=Be;for(Be|=4,le=t.current;le!==null;){var i=le,o=i.child;if(le.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(le=c;le!==null;){var u=le;switch(u.tag){case 0:case 11:case 15:sh(8,u,i)}var h=u.child;if(h!==null)h.return=u,le=h;else for(;le!==null;){u=le;var f=u.sibling,m=u.return;if(pR(u),u===c){le=null;break}if(f!==null){f.return=m,le=f;break}le=m}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}le=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,le=o;else e:for(;le!==null;){if(i=le,i.flags&2048)switch(i.tag){case 0:case 11:case 15:sh(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,le=w;break e}le=i.return}}var _=t.current;for(le=_;le!==null;){o=le;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,le=E;else e:for(o=_;le!==null;){if(a=le,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Fg(9,a)}}catch(R){It(a,a.return,R)}if(a===o){le=null;break e}var N=a.sibling;if(N!==null){N.return=a.return,le=N;break e}le=a.return}}if(Be=s,Ro(),_s&&typeof _s.onPostCommitFiberRoot=="function")try{_s.onPostCommitFiberRoot(Rg,t)}catch{}r=!0}return r}finally{Ge=n,Mr.transition=e}}return!1}function G1(t,e,n){e=wc(n,e),e=rR(t,e,1),t=io(t,e,1),e=jn(),t!==null&&(_d(t,1,e),Zn(t,e))}function It(t,e,n){if(t.tag===3)G1(t,t,n);else for(;e!==null;){if(e.tag===3){G1(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(oo===null||!oo.has(r))){t=wc(n,t),t=sR(e,t,1),e=io(e,t,1),t=jn(),e!==null&&(_d(e,1,t),Zn(e,t));break}}e=e.return}}function qF(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=jn(),t.pingedLanes|=t.suspendedLanes&n,on===t&&(mn&n)===n&&(Wt===4||Wt===3&&(mn&130023424)===mn&&500>Ot()-U_?ga(t,0):$_|=n),Zn(t,e)}function ER(t,e){e===0&&(t.mode&1?(e=df,df<<=1,!(df&130023424)&&(df=4194304)):e=1);var n=jn();t=ai(t,e),t!==null&&(_d(t,e,n),Zn(t,n))}function KF(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ER(t,n)}function GF(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Y(314))}r!==null&&r.delete(e),ER(t,n)}var SR;SR=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Yn.current)Qn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Qn=!1,DF(t,e,n);Qn=!!(t.flags&131072)}else Qn=!1,gt&&e.flags&1048576&&AN(e,Zp,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;cp(t,e),t=e.pendingProps;var s=mc(e,Cn.current);tc(e,n),s=L_(null,e,r,t,s,n);var i=j_();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Xn(r)?(i=!0,Yp(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,R_(e),s.updater=Vg,e.stateNode=s,s._reactInternals=e,mw(e,r,t,n),e=vw(null,e,r,!0,i,n)):(e.tag=0,gt&&i&&E_(e),Dn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(cp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=JF(r),t=Wr(r,t),s){case 0:e=yw(null,e,r,t,n);break e;case 1:e=V1(null,e,r,t,n);break e;case 11:e=L1(null,e,r,t,n);break e;case 14:e=j1(null,e,r,Wr(r.type,t),n);break e}throw Error(Y(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Wr(r,s),yw(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Wr(r,s),V1(t,e,r,s,n);case 3:e:{if(lR(e),t===null)throw Error(Y(387));r=e.pendingProps,i=e.memoizedState,s=i.element,DN(t,e),nm(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=wc(Error(Y(423)),e),e=F1(t,e,r,n,s);break e}else if(r!==s){s=wc(Error(Y(424)),e),e=F1(t,e,r,n,s);break e}else for(cr=so(e.stateNode.containerInfo.firstChild),dr=e,gt=!0,Gr=null,n=MN(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(gc(),r===s){e=li(t,e,n);break e}Dn(t,e,r,n)}e=e.child}return e;case 5:return LN(e),t===null&&dw(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,aw(r,s)?o=null:i!==null&&aw(r,i)&&(e.flags|=32),aR(t,e),Dn(t,e,o,n),e.child;case 6:return t===null&&dw(e),null;case 13:return cR(t,e,n);case 4:return P_(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=yc(e,null,r,n):Dn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Wr(r,s),L1(t,e,r,s,n);case 7:return Dn(t,e,e.pendingProps,n),e.child;case 8:return Dn(t,e,e.pendingProps.children,n),e.child;case 12:return Dn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,nt(em,r._currentValue),r._currentValue=o,i!==null)if(rs(i.value,o)){if(i.children===s.children&&!Yn.current){e=li(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=Zs(-1,n&-n),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),fw(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Y(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),fw(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Dn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,tc(e,n),s=jr(s),r=r(s),e.flags|=1,Dn(t,e,r,n),e.child;case 14:return r=e.type,s=Wr(r,e.pendingProps),s=Wr(r.type,s),j1(t,e,r,s,n);case 15:return iR(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Wr(r,s),cp(t,e),e.tag=1,Xn(r)?(t=!0,Yp(e)):t=!1,tc(e,n),nR(e,r,s),mw(e,r,s,n),vw(null,e,r,!0,t,n);case 19:return uR(t,e,n);case 22:return oR(t,e,n)}throw Error(Y(156,e.tag))};function kR(t,e){return ZA(t,e)}function QF(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rr(t,e,n,r){return new QF(t,e,n,r)}function K_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function JF(t){if(typeof t=="function")return K_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===d_)return 11;if(t===f_)return 14}return 2}function lo(t,e){var n=t.alternate;return n===null?(n=Rr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function dp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")K_(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case jl:return ya(n.children,s,i,e);case h_:o=8,s|=8;break;case F0:return t=Rr(12,n,e,s|2),t.elementType=F0,t.lanes=i,t;case B0:return t=Rr(13,n,e,s),t.elementType=B0,t.lanes=i,t;case z0:return t=Rr(19,n,e,s),t.elementType=z0,t.lanes=i,t;case LA:return zg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case OA:o=10;break e;case DA:o=9;break e;case d_:o=11;break e;case f_:o=14;break e;case Di:o=16,r=null;break e}throw Error(Y(130,t==null?t:typeof t,""))}return e=Rr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ya(t,e,n,r){return t=Rr(7,t,r,e),t.lanes=n,t}function zg(t,e,n,r){return t=Rr(22,t,r,e),t.elementType=LA,t.lanes=n,t.stateNode={isHidden:!1},t}function Nv(t,e,n){return t=Rr(6,t,null,e),t.lanes=n,t}function Rv(t,e,n){return e=Rr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function YF(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=hv(0),this.expirationTimes=hv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=hv(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function G_(t,e,n,r,s,i,o,a,l){return t=new YF(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Rr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},R_(i),t}function XF(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ll,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function CR(t){if(!t)return xo;t=t._reactInternals;e:{if(tl(t)!==t||t.tag!==1)throw Error(Y(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Xn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Y(171))}if(t.tag===1){var n=t.type;if(Xn(n))return CN(t,n,e)}return e}function IR(t,e,n,r,s,i,o,a,l){return t=G_(n,r,!0,t,s,i,o,a,l),t.context=CR(null),n=t.current,r=jn(),s=ao(n),i=Zs(r,s),i.callback=e??null,io(n,i,s),t.current.lanes=s,_d(t,s,r),Zn(t,r),t}function $g(t,e,n,r){var s=e.current,i=jn(),o=ao(s);return n=CR(n),e.context===null?e.context=n:e.pendingContext=n,e=Zs(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=io(s,e,o),t!==null&&(ts(t,s,o,i),op(t,s,o)),o}function um(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Q1(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Q_(t,e){Q1(t,e),(t=t.alternate)&&Q1(t,e)}function ZF(){return null}var AR=typeof reportError=="function"?reportError:function(t){console.error(t)};function J_(t){this._internalRoot=t}Ug.prototype.render=J_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Y(409));$g(t,e,null,null)};Ug.prototype.unmount=J_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ma(function(){$g(null,t,null,null)}),e[oi]=null}};function Ug(t){this._internalRoot=t}Ug.prototype.unstable_scheduleHydration=function(t){if(t){var e=oN();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Bi.length&&e!==0&&e<Bi[n].priority;n++);Bi.splice(n,0,t),n===0&&lN(t)}};function Y_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function J1(){}function e3(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=um(o);i.call(c)}}var o=IR(e,r,t,0,null,!1,!1,"",J1);return t._reactRootContainer=o,t[oi]=o.current,Lh(t.nodeType===8?t.parentNode:t),Ma(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=um(l);a.call(c)}}var l=G_(t,0,!1,null,null,!1,!1,"",J1);return t._reactRootContainer=l,t[oi]=l.current,Lh(t.nodeType===8?t.parentNode:t),Ma(function(){$g(e,l,n,r)}),l}function Wg(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=um(o);a.call(l)}}$g(e,o,t,s)}else o=e3(n,e,t,s,r);return um(o)}sN=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Fu(e.pendingLanes);n!==0&&(g_(e,n|1),Zn(e,Ot()),!(Be&6)&&(xc=Ot()+500,Ro()))}break;case 13:Ma(function(){var r=ai(t,1);if(r!==null){var s=jn();ts(r,t,1,s)}}),Q_(t,1)}};y_=function(t){if(t.tag===13){var e=ai(t,134217728);if(e!==null){var n=jn();ts(e,t,134217728,n)}Q_(t,134217728)}};iN=function(t){if(t.tag===13){var e=ao(t),n=ai(t,e);if(n!==null){var r=jn();ts(n,t,e,r)}Q_(t,e)}};oN=function(){return Ge};aN=function(t,e){var n=Ge;try{return Ge=t,e()}finally{Ge=n}};Y0=function(t,e,n){switch(e){case"input":if(H0(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Dg(r);if(!s)throw Error(Y(90));VA(r),H0(r,s)}}}break;case"textarea":BA(t,n);break;case"select":e=n.value,e!=null&&Yl(t,!!n.multiple,e,!1)}};KA=H_;GA=Ma;var t3={usingClientEntryPoint:!1,Events:[Td,zl,Dg,WA,qA,H_]},wu={findFiberByHostInstance:oa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},n3={bundleType:wu.bundleType,version:wu.version,rendererPackageName:wu.rendererPackageName,rendererConfig:wu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:pi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=YA(t),t===null?null:t.stateNode},findFiberByHostInstance:wu.findFiberByHostInstance||ZF,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Tf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Tf.isDisabled&&Tf.supportsFiber)try{Rg=Tf.inject(n3),_s=Tf}catch{}}gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=t3;gr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Y_(e))throw Error(Y(200));return XF(t,e,null,n)};gr.createRoot=function(t,e){if(!Y_(t))throw Error(Y(299));var n=!1,r="",s=AR;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=G_(t,1,!1,null,null,n,!1,r,s),t[oi]=e.current,Lh(t.nodeType===8?t.parentNode:t),new J_(e)};gr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Y(188)):(t=Object.keys(t).join(","),Error(Y(268,t)));return t=YA(e),t=t===null?null:t.stateNode,t};gr.flushSync=function(t){return Ma(t)};gr.hydrate=function(t,e,n){if(!Hg(e))throw Error(Y(200));return Wg(null,t,e,!0,n)};gr.hydrateRoot=function(t,e,n){if(!Y_(t))throw Error(Y(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=AR;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=IR(e,null,t,1,n??null,s,!1,i,o),t[oi]=e.current,Lh(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new Ug(e)};gr.render=function(t,e,n){if(!Hg(e))throw Error(Y(200));return Wg(null,t,e,!1,n)};gr.unmountComponentAtNode=function(t){if(!Hg(t))throw Error(Y(40));return t._reactRootContainer?(Ma(function(){Wg(null,null,t,!1,function(){t._reactRootContainer=null,t[oi]=null})}),!0):!1};gr.unstable_batchedUpdates=H_;gr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hg(n))throw Error(Y(200));if(t==null||t._reactInternals===void 0)throw Error(Y(38));return Wg(t,e,n,!1,r)};gr.version="18.3.1-next-f1338f8080-20240426";function NR(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(NR)}catch(t){console.error(t)}}NR(),NA.exports=gr;var RR=NA.exports;const X_=Io(RR);var Y1=RR;j0.createRoot=Y1.createRoot,j0.hydrateRoot=Y1.hydrateRoot;/**
 * react-router v7.11.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var X1="popstate";function r3(t={}){function e(s,i){let{pathname:o="/",search:a="",hash:l=""}=nl(s.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Nw("",{pathname:o,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(s,i){let o=s.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=s.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof i=="string"?i:Wh(i))}function r(s,i){Fr(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(i)})`)}return i3(e,n,r,t)}function _t(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Fr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function s3(){return Math.random().toString(36).substring(2,10)}function Z1(t,e){return{usr:t.state,key:t.key,idx:e}}function Nw(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?nl(e):e,state:n,key:e&&e.key||r||s3()}}function Wh({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function nl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function i3(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,c=u();c==null&&(c=0,o.replaceState({...o.state,idx:c},""));function u(){return(o.state||{idx:null}).idx}function h(){a="POP";let v=u(),w=v==null?null:v-c;c=v,l&&l({action:a,location:y.location,delta:w})}function f(v,w){a="PUSH";let _=Nw(y.location,v,w);n&&n(_,v),c=u()+1;let E=Z1(_,c),N=y.createHref(_);try{o.pushState(E,"",N)}catch(R){if(R instanceof DOMException&&R.name==="DataCloneError")throw R;s.location.assign(N)}i&&l&&l({action:a,location:y.location,delta:1})}function m(v,w){a="REPLACE";let _=Nw(y.location,v,w);n&&n(_,v),c=u();let E=Z1(_,c),N=y.createHref(_);o.replaceState(E,"",N),i&&l&&l({action:a,location:y.location,delta:0})}function g(v){return o3(v)}let y={get action(){return a},get location(){return t(s,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(X1,h),l=v,()=>{s.removeEventListener(X1,h),l=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let w=g(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:f,replace:m,go(v){return o.go(v)}};return y}function o3(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),_t(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Wh(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function PR(t,e,n="/"){return a3(t,e,n,!1)}function a3(t,e,n,r){let s=typeof e=="string"?nl(e):e,i=ci(s.pathname||"/",n);if(i==null)return null;let o=MR(t);l3(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=w3(i);a=y3(o[l],c,r)}return a}function MR(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,c)=>{let u={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(r)&&l)return;_t(u.relativePath.startsWith(r),`Absolute route path "${u.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(r.length)}let h=ei([r,u.relativePath]),f=n.concat(u);o.children&&o.children.length>0&&(_t(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),MR(o.children,e,f,h,l)),!(o.path==null&&!o.index)&&e.push({path:h,score:m3(h,o.index),routesMeta:f})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let c of OR(o.path))i(o,a,!0,c)}),e}function OR(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=OR(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function l3(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:g3(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var c3=/^:[\w-]+$/,u3=3,h3=2,d3=1,f3=10,p3=-2,eS=t=>t==="*";function m3(t,e){let n=t.split("/"),r=n.length;return n.some(eS)&&(r+=p3),e&&(r+=h3),n.filter(s=>!eS(s)).reduce((s,i)=>s+(c3.test(i)?u3:i===""?d3:f3),r)}function g3(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function y3(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",h=hm({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),f=l.route;if(!h&&c&&n&&!r[r.length-1].route.index&&(h=hm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:ei([i,h.pathname]),pathnameBase:T3(ei([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=ei([i,h.pathnameBase]))}return o}function hm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=v3(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,{paramName:u,isOptional:h},f)=>{if(u==="*"){let g=a[f]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const m=a[f];return h&&!m?c[u]=void 0:c[u]=(m||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:t}}function v3(t,e=!1,n=!0){Fr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function w3(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Fr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function ci(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var DR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,x3=t=>DR.test(t);function _3(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?nl(t):t,i;if(n)if(x3(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Fr(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=tS(n.substring(1),"/"):i=tS(n,e)}else i=e;return{pathname:i,search:E3(r),hash:S3(s)}}function tS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Pv(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function b3(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function LR(t){let e=b3(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function jR(t,e,n,r=!1){let s;typeof t=="string"?s=nl(t):(s={...t},_t(!s.pathname||!s.pathname.includes("?"),Pv("?","pathname","search",s)),_t(!s.pathname||!s.pathname.includes("#"),Pv("#","pathname","hash",s)),_t(!s.search||!s.search.includes("#"),Pv("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),h-=1;s.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=_3(s,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var ei=t=>t.join("/").replace(/\/\/+/g,"/"),T3=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),E3=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,S3=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,k3=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function C3(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function I3(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var VR=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function FR(t,e){let n=t;if(typeof n!="string"||!DR.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(VR)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=ci(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Fr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var BR=["POST","PUT","PATCH","DELETE"];new Set(BR);var A3=["GET",...BR];new Set(A3);var Kc=A.createContext(null);Kc.displayName="DataRouter";var qg=A.createContext(null);qg.displayName="DataRouterState";var N3=A.createContext(!1),zR=A.createContext({isTransitioning:!1});zR.displayName="ViewTransition";var R3=A.createContext(new Map);R3.displayName="Fetchers";var P3=A.createContext(null);P3.displayName="Await";var zr=A.createContext(null);zr.displayName="Navigation";var Sd=A.createContext(null);Sd.displayName="Location";var Ps=A.createContext({outlet:null,matches:[],isDataRoute:!1});Ps.displayName="Route";var Z_=A.createContext(null);Z_.displayName="RouteError";var $R="REACT_ROUTER_ERROR",M3="REDIRECT",O3="ROUTE_ERROR_RESPONSE";function D3(t){if(t.startsWith(`${$R}:${M3}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function L3(t){if(t.startsWith(`${$R}:${O3}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new k3(e.status,e.statusText,e.data)}catch{}}function j3(t,{relative:e}={}){_t(kd(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=A.useContext(zr),{hash:s,pathname:i,search:o}=Cd(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:ei([n,i])),r.createHref({pathname:a,search:o,hash:s})}function kd(){return A.useContext(Sd)!=null}function mi(){return _t(kd(),"useLocation() may be used only in the context of a <Router> component."),A.useContext(Sd).location}var UR="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function HR(t){A.useContext(zr).static||A.useLayoutEffect(t)}function rl(){let{isDataRoute:t}=A.useContext(Ps);return t?J3():V3()}function V3(){_t(kd(),"useNavigate() may be used only in the context of a <Router> component.");let t=A.useContext(Kc),{basename:e,navigator:n}=A.useContext(zr),{matches:r}=A.useContext(Ps),{pathname:s}=mi(),i=JSON.stringify(LR(r)),o=A.useRef(!1);return HR(()=>{o.current=!0}),A.useCallback((l,c={})=>{if(Fr(o.current,UR),!o.current)return;if(typeof l=="number"){n.go(l);return}let u=jR(l,JSON.parse(i),s,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:ei([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,i,s,t])}A.createContext(null);function Kg(){let{matches:t}=A.useContext(Ps),e=t[t.length-1];return e?e.params:{}}function Cd(t,{relative:e}={}){let{matches:n}=A.useContext(Ps),{pathname:r}=mi(),s=JSON.stringify(LR(n));return A.useMemo(()=>jR(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function F3(t,e){return WR(t,e)}function WR(t,e,n,r,s){var _;_t(kd(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=A.useContext(zr),{matches:o}=A.useContext(Ps),a=o[o.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",h=a&&a.route;{let E=h&&h.path||"";KR(c,!h||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let f=mi(),m;if(e){let E=typeof e=="string"?nl(e):e;_t(u==="/"||((_=E.pathname)==null?void 0:_.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${E.pathname}" was given in the \`location\` prop.`),m=E}else m=f;let g=m.pathname||"/",y=g;if(u!=="/"){let E=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=PR(t,{pathname:y});Fr(h||v!=null,`No routes matched location "${m.pathname}${m.search}${m.hash}" `),Fr(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${m.pathname}${m.search}${m.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=H3(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},l,E.params),pathname:ei([u,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?u:ei([u,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),o,n,r,s);return e&&w?A.createElement(Sd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...m},navigationType:"POP"}},w):w}function B3(){let t=Q3(),e=C3(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=A.createElement(A.Fragment,null,A.createElement("p",null," Hey developer "),A.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",A.createElement("code",{style:i},"ErrorBoundary")," or"," ",A.createElement("code",{style:i},"errorElement")," prop on your route.")),A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:s},n):null,o)}var z3=A.createElement(B3,null),qR=class extends A.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=L3(t.digest);n&&(t=n)}let e=t!==void 0?A.createElement(Ps.Provider,{value:this.props.routeContext},A.createElement(Z_.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?A.createElement($3,{error:t},e):e}};qR.contextType=N3;var Mv=new WeakMap;function $3({children:t,error:e}){let{basename:n}=A.useContext(zr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=D3(e.digest);if(r){let s=Mv.get(e);if(s)throw s;let i=FR(r.location,n);if(VR&&!Mv.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw Mv.set(e,o),o}return A.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function U3({routeContext:t,match:e,children:n}){let r=A.useContext(Kc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),A.createElement(Ps.Provider,{value:t},n)}function H3(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let u=i.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);_t(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,u+1))}let a=!1,l=-1;if(n)for(let u=0;u<i.length;u++){let h=i[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=u),h.route.id){let{loaderData:f,errors:m}=n,g=h.route.loader&&!f.hasOwnProperty(h.route.id)&&(!m||m[h.route.id]===void 0);if(h.route.lazy||g){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let c=n&&r?(u,h)=>{var f,m;r(u,{location:n.location,params:((m=(f=n.matches)==null?void 0:f[0])==null?void 0:m.params)??{},unstable_pattern:I3(n.matches),errorInfo:h})}:void 0;return i.reduceRight((u,h,f)=>{let m,g=!1,y=null,v=null;n&&(m=o&&h.route.id?o[h.route.id]:void 0,y=h.route.errorElement||z3,a&&(l<0&&f===0?(KR("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,v=null):l===f&&(g=!0,v=h.route.hydrateFallbackElement||null)));let w=e.concat(i.slice(0,f+1)),_=()=>{let E;return m?E=y:g?E=v:h.route.Component?E=A.createElement(h.route.Component,null):h.route.element?E=h.route.element:E=u,A.createElement(U3,{match:h,routeContext:{outlet:u,matches:w,isDataRoute:n!=null},children:E})};return n&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?A.createElement(qR,{location:n.location,revalidation:n.revalidation,component:y,error:m,children:_(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:c}):_()},null)}function eb(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function W3(t){let e=A.useContext(Kc);return _t(e,eb(t)),e}function q3(t){let e=A.useContext(qg);return _t(e,eb(t)),e}function K3(t){let e=A.useContext(Ps);return _t(e,eb(t)),e}function tb(t){let e=K3(t),n=e.matches[e.matches.length-1];return _t(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function G3(){return tb("useRouteId")}function Q3(){var r;let t=A.useContext(Z_),e=q3("useRouteError"),n=tb("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function J3(){let{router:t}=W3("useNavigate"),e=tb("useNavigate"),n=A.useRef(!1);return HR(()=>{n.current=!0}),A.useCallback(async(s,i={})=>{Fr(n.current,UR),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var nS={};function KR(t,e,n){!e&&!nS[t]&&(nS[t]=!0,Fr(!1,n))}A.memo(Y3);function Y3({routes:t,future:e,state:n,onError:r}){return WR(t,void 0,n,r,e)}function br(t){_t(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function X3({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){_t(!kd(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=A.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=nl(n));let{pathname:c="/",search:u="",hash:h="",state:f=null,key:m="default"}=n,g=A.useMemo(()=>{let y=ci(c,a);return y==null?null:{location:{pathname:y,search:u,hash:h,state:f,key:m},navigationType:r}},[a,c,u,h,f,m,r]);return Fr(g!=null,`<Router basename="${a}"> is not able to match the URL "${c}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:A.createElement(zr.Provider,{value:l},A.createElement(Sd.Provider,{children:e,value:g}))}function Z3({children:t,location:e}){return F3(Rw(t),e)}function Rw(t,e=[]){let n=[];return A.Children.forEach(t,(r,s)=>{if(!A.isValidElement(r))return;let i=[...e,s];if(r.type===A.Fragment){n.push.apply(n,Rw(r.props.children,i));return}_t(r.type===br,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),_t(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=Rw(r.props.children,i)),n.push(o)}),n}var fp="get",pp="application/x-www-form-urlencoded";function Gg(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function eB(t){return Gg(t)&&t.tagName.toLowerCase()==="button"}function tB(t){return Gg(t)&&t.tagName.toLowerCase()==="form"}function nB(t){return Gg(t)&&t.tagName.toLowerCase()==="input"}function rB(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function sB(t,e){return t.button===0&&(!e||e==="_self")&&!rB(t)}var Ef=null;function iB(){if(Ef===null)try{new FormData(document.createElement("form"),0),Ef=!1}catch{Ef=!0}return Ef}var oB=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ov(t){return t!=null&&!oB.has(t)?(Fr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${pp}"`),null):t}function aB(t,e){let n,r,s,i,o;if(tB(t)){let a=t.getAttribute("action");r=a?ci(a,e):null,n=t.getAttribute("method")||fp,s=Ov(t.getAttribute("enctype"))||pp,i=new FormData(t)}else if(eB(t)||nB(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?ci(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||fp,s=Ov(t.getAttribute("formenctype"))||Ov(a.getAttribute("enctype"))||pp,i=new FormData(a,t),!iB()){let{name:c,type:u,value:h}=t;if(u==="image"){let f=c?`${c}.`:"";i.append(`${f}x`,"0"),i.append(`${f}y`,"0")}else c&&i.append(c,h)}}else{if(Gg(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=fp,r=null,s=pp,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function nb(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lB(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&ci(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function cB(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function uB(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function hB(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await cB(i,n);return o.links?o.links():[]}return[]}));return mB(r.flat(1).filter(uB).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function rS(t,e,n,r,s,i){let o=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,a=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,c)=>o(l,c)||a(l,c)):i==="data"?e.filter((l,c)=>{var h;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(o(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let f=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof f=="boolean")return f}return!0}):[]}function dB(t,e,{includeHydrateFallback:n}={}){return fB(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function fB(t){return[...new Set(t)]}function pB(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function mB(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(pB(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function GR(){let t=A.useContext(Kc);return nb(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function gB(){let t=A.useContext(qg);return nb(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var rb=A.createContext(void 0);rb.displayName="FrameworkContext";function QR(){let t=A.useContext(rb);return nb(t,"You must render this element inside a <HydratedRouter> element"),t}function yB(t,e){let n=A.useContext(rb),[r,s]=A.useState(!1),[i,o]=A.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:h}=e,f=A.useRef(null);A.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=w=>{w.forEach(_=>{o(_.isIntersecting)})},v=new IntersectionObserver(y,{threshold:.5});return f.current&&v.observe(f.current),()=>{v.disconnect()}}},[t]),A.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let m=()=>{s(!0)},g=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,f,{}]:[i,f,{onFocus:xu(a,m),onBlur:xu(l,g),onMouseEnter:xu(c,m),onMouseLeave:xu(u,g),onTouchStart:xu(h,m)}]:[!1,f,{}]}function xu(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function vB({page:t,...e}){let{router:n}=GR(),r=A.useMemo(()=>PR(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?A.createElement(xB,{page:t,matches:r,...e}):null}function wB(t){let{manifest:e,routeModules:n}=QR(),[r,s]=A.useState([]);return A.useEffect(()=>{let i=!1;return hB(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function xB({page:t,matches:e,...n}){let r=mi(),{manifest:s,routeModules:i}=QR(),{basename:o}=GR(),{loaderData:a,matches:l}=gB(),c=A.useMemo(()=>rS(t,e,l,s,r,"data"),[t,e,l,s,r]),u=A.useMemo(()=>rS(t,e,l,s,r,"assets"),[t,e,l,s,r]),h=A.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let g=new Set,y=!1;if(e.forEach(w=>{var E;let _=s.routes[w.route.id];!_||!_.hasLoader||(!c.some(N=>N.route.id===w.route.id)&&w.route.id in a&&((E=i[w.route.id])!=null&&E.shouldRevalidate)||_.hasClientLoader?y=!0:g.add(w.route.id))}),g.size===0)return[];let v=lB(t,o,"data");return y&&g.size>0&&v.searchParams.set("_routes",e.filter(w=>g.has(w.route.id)).map(w=>w.route.id).join(",")),[v.pathname+v.search]},[o,a,r,s,c,e,t,i]),f=A.useMemo(()=>dB(u,s),[u,s]),m=wB(u);return A.createElement(A.Fragment,null,h.map(g=>A.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...n})),f.map(g=>A.createElement("link",{key:g,rel:"modulepreload",href:g,...n})),m.map(({key:g,link:y})=>A.createElement("link",{key:g,nonce:n.nonce,...y})))}function _B(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var bB=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{bB&&(window.__reactRouterVersion="7.11.0")}catch{}function TB({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=A.useRef();s.current==null&&(s.current=r3({window:r,v5Compat:!0}));let i=s.current,[o,a]=A.useState({action:i.action,location:i.location}),l=A.useCallback(c=>{n===!1?a(c):A.startTransition(()=>a(c))},[n]);return A.useLayoutEffect(()=>i.listen(l),[i,l]),A.createElement(X3,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var JR=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Sr=A.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:f,...m},g){let{basename:y,unstable_useTransitions:v}=A.useContext(zr),w=typeof c=="string"&&JR.test(c),_=FR(c,y);c=_.to;let E=j3(c,{relative:s}),[N,R,O]=yB(r,m),S=CB(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:s,viewTransition:h,unstable_defaultShouldRevalidate:f,unstable_useTransitions:v});function T(I){e&&e(I),I.defaultPrevented||S(I)}let k=A.createElement("a",{...m,...O,href:_.absoluteURL||E,onClick:_.isExternal||i?e:T,ref:_B(g,R),target:l,"data-discover":!w&&n==="render"?"true":void 0});return N&&!w?A.createElement(A.Fragment,null,k,A.createElement(vB,{page:E})):k});Sr.displayName="Link";var EB=A.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...c},u){let h=Cd(o,{relative:c.relative}),f=mi(),m=A.useContext(qg),{navigator:g,basename:y}=A.useContext(zr),v=m!=null&&PB(h)&&a===!0,w=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,_=f.pathname,E=m&&m.navigation&&m.navigation.location?m.navigation.location.pathname:null;n||(_=_.toLowerCase(),E=E?E.toLowerCase():null,w=w.toLowerCase()),E&&y&&(E=ci(E,y)||E);const N=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let R=_===w||!s&&_.startsWith(w)&&_.charAt(N)==="/",O=E!=null&&(E===w||!s&&E.startsWith(w)&&E.charAt(w.length)==="/"),S={isActive:R,isPending:O,isTransitioning:v},T=R?e:void 0,k;typeof r=="function"?k=r(S):k=[r,R?"active":null,O?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let I=typeof i=="function"?i(S):i;return A.createElement(Sr,{...c,"aria-current":T,className:k,ref:u,style:I,to:o,viewTransition:a},typeof l=="function"?l(S):l)});EB.displayName="NavLink";var SB=A.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=fp,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:f,...m},g)=>{let{unstable_useTransitions:y}=A.useContext(zr),v=NB(),w=RB(a,{relative:c}),_=o.toLowerCase()==="get"?"get":"post",E=typeof a=="string"&&JR.test(a),N=R=>{if(l&&l(R),R.defaultPrevented)return;R.preventDefault();let O=R.nativeEvent.submitter,S=(O==null?void 0:O.getAttribute("formmethod"))||o,T=()=>v(O||R.currentTarget,{fetcherKey:e,method:S,navigate:n,replace:s,state:i,relative:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:f});y&&n!==!1?A.startTransition(()=>T()):T()};return A.createElement("form",{ref:g,method:_,action:w,onSubmit:r?l:N,...m,"data-discover":!E&&t==="render"?"true":void 0})});SB.displayName="Form";function kB(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function YR(t){let e=A.useContext(Kc);return _t(e,kB(t)),e}function CB(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let c=rl(),u=mi(),h=Cd(t,{relative:i});return A.useCallback(f=>{if(sB(f,e)){f.preventDefault();let m=n!==void 0?n:Wh(u)===Wh(h),g=()=>c(t,{replace:m,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?A.startTransition(()=>g()):g()}},[u,c,h,n,r,e,t,s,i,o,a,l])}var IB=0,AB=()=>`__${String(++IB)}__`;function NB(){let{router:t}=YR("useSubmit"),{basename:e}=A.useContext(zr),n=G3(),r=t.fetch,s=t.navigate;return A.useCallback(async(i,o={})=>{let{action:a,method:l,encType:c,formData:u,body:h}=aB(i,e);if(o.navigate===!1){let f=o.fetcherKey||AB();await r(f,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:h,formMethod:o.method||l,formEncType:o.encType||c,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:h,formMethod:o.method||l,formEncType:o.encType||c,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function RB(t,{relative:e}={}){let{basename:n}=A.useContext(zr),r=A.useContext(Ps);_t(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Cd(t||".",{relative:e})},o=mi();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(u=>u==="")){a.delete("index"),l.filter(h=>h).forEach(h=>a.append("index",h));let u=a.toString();i.search=u?`?${u}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:ei([n,i.pathname])),Wh(i)}function PB(t,{relative:e}={}){let n=A.useContext(zR);_t(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=YR("useViewTransitionState"),s=Cd(t,{relative:e});if(!n.isTransitioning)return!1;let i=ci(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=ci(n.nextLocation.pathname,r)||n.nextLocation.pathname;return hm(s.pathname,o)!=null||hm(s.pathname,i)!=null}var MB=typeof Element<"u",OB=typeof Map=="function",DB=typeof Set=="function",LB=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function mp(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,s;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!mp(t[r],e[r]))return!1;return!0}var i;if(OB&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i=t.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;for(i=t.entries();!(r=i.next()).done;)if(!mp(r.value[1],e.get(r.value[0])))return!1;return!0}if(DB&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i=t.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(LB&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(s=Object.keys(t),n=s.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,s[r]))return!1;if(MB&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((s[r]==="_owner"||s[r]==="__v"||s[r]==="__o")&&t.$$typeof)&&!mp(t[s[r]],e[s[r]]))return!1;return!0}return t!==t&&e!==e}var jB=function(e,n){try{return mp(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const XR=Io(jB);var VB=function(t,e,n,r,s,i,o,a){if(!t){var l;if(e===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,s,i,o,a],u=0;l=new Error(e.replace(/%s/g,function(){return c[u++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}},FB=VB;const sS=Io(FB);var BB=function(e,n,r,s){var i=r?r.call(s,e,n):void 0;if(i!==void 0)return!!i;if(e===n)return!0;if(typeof e!="object"||!e||typeof n!="object"||!n)return!1;var o=Object.keys(e),a=Object.keys(n);if(o.length!==a.length)return!1;for(var l=Object.prototype.hasOwnProperty.bind(n),c=0;c<o.length;c++){var u=o[c];if(!l(u))return!1;var h=e[u],f=n[u];if(i=r?r.call(s,h,f,u):void 0,i===!1||i===void 0&&h!==f)return!1}return!0};const zB=Io(BB);var ZR=(t=>(t.BASE="base",t.BODY="body",t.HEAD="head",t.HTML="html",t.LINK="link",t.META="meta",t.NOSCRIPT="noscript",t.SCRIPT="script",t.STYLE="style",t.TITLE="title",t.FRAGMENT="Symbol(react.fragment)",t))(ZR||{}),Dv={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},iS=Object.values(ZR),sb={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},$B=Object.entries(sb).reduce((t,[e,n])=>(t[n]=e,t),{}),Jr="data-rh",rc={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},sc=(t,e)=>{for(let n=t.length-1;n>=0;n-=1){const r=t[n];if(Object.prototype.hasOwnProperty.call(r,e))return r[e]}return null},UB=t=>{let e=sc(t,"title");const n=sc(t,rc.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),n&&e)return n.replace(/%s/g,()=>e);const r=sc(t,rc.DEFAULT_TITLE);return e||r||void 0},HB=t=>sc(t,rc.ON_CHANGE_CLIENT_STATE)||(()=>{}),Lv=(t,e)=>e.filter(n=>typeof n[t]<"u").map(n=>n[t]).reduce((n,r)=>({...n,...r}),{}),WB=(t,e)=>e.filter(n=>typeof n.base<"u").map(n=>n.base).reverse().reduce((n,r)=>{if(!n.length){const s=Object.keys(r);for(let i=0;i<s.length;i+=1){const a=s[i].toLowerCase();if(t.indexOf(a)!==-1&&r[a])return n.concat(r)}}return n},[]),qB=t=>console&&typeof console.warn=="function"&&console.warn(t),_u=(t,e,n)=>{const r={};return n.filter(s=>Array.isArray(s[t])?!0:(typeof s[t]<"u"&&qB(`Helmet: ${t} should be of type "Array". Instead found type "${typeof s[t]}"`),!1)).map(s=>s[t]).reverse().reduce((s,i)=>{const o={};i.filter(l=>{let c;const u=Object.keys(l);for(let f=0;f<u.length;f+=1){const m=u[f],g=m.toLowerCase();e.indexOf(g)!==-1&&!(c==="rel"&&l[c].toLowerCase()==="canonical")&&!(g==="rel"&&l[g].toLowerCase()==="stylesheet")&&(c=g),e.indexOf(m)!==-1&&(m==="innerHTML"||m==="cssText"||m==="itemprop")&&(c=m)}if(!c||!l[c])return!1;const h=l[c].toLowerCase();return r[c]||(r[c]={}),o[c]||(o[c]={}),r[c][h]?!1:(o[c][h]=!0,!0)}).reverse().forEach(l=>s.push(l));const a=Object.keys(o);for(let l=0;l<a.length;l+=1){const c=a[l],u={...r[c],...o[c]};r[c]=u}return s},[]).reverse()},KB=(t,e)=>{if(Array.isArray(t)&&t.length){for(let n=0;n<t.length;n+=1)if(t[n][e])return!0}return!1},GB=t=>({baseTag:WB(["href"],t),bodyAttributes:Lv("bodyAttributes",t),defer:sc(t,rc.DEFER),encode:sc(t,rc.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:Lv("htmlAttributes",t),linkTags:_u("link",["rel","href"],t),metaTags:_u("meta",["name","charset","http-equiv","property","itemprop"],t),noscriptTags:_u("noscript",["innerHTML"],t),onChangeClientState:HB(t),scriptTags:_u("script",["src","innerHTML"],t),styleTags:_u("style",["cssText"],t),title:UB(t),titleAttributes:Lv("titleAttributes",t),prioritizeSeoTags:KB(t,rc.PRIORITIZE_SEO_TAGS)}),eP=t=>Array.isArray(t)?t.join(""):t,QB=(t,e)=>{const n=Object.keys(t);for(let r=0;r<n.length;r+=1)if(e[n[r]]&&e[n[r]].includes(t[n[r]]))return!0;return!1},jv=(t,e)=>Array.isArray(t)?t.reduce((n,r)=>(QB(r,e)?n.priority.push(r):n.default.push(r),n),{priority:[],default:[]}):{default:t,priority:[]},oS=(t,e)=>({...t,[e]:void 0}),JB=["noscript","script","style"],Pw=(t,e=!0)=>e===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),tP=t=>Object.keys(t).reduce((e,n)=>{const r=typeof t[n]<"u"?`${n}="${t[n]}"`:`${n}`;return e?`${e} ${r}`:r},""),YB=(t,e,n,r)=>{const s=tP(n),i=eP(e);return s?`<${t} ${Jr}="true" ${s}>${Pw(i,r)}</${t}>`:`<${t} ${Jr}="true">${Pw(i,r)}</${t}>`},XB=(t,e,n=!0)=>e.reduce((r,s)=>{const i=s,o=Object.keys(i).filter(c=>!(c==="innerHTML"||c==="cssText")).reduce((c,u)=>{const h=typeof i[u]>"u"?u:`${u}="${Pw(i[u],n)}"`;return c?`${c} ${h}`:h},""),a=i.innerHTML||i.cssText||"",l=JB.indexOf(t)===-1;return`${r}<${t} ${Jr}="true" ${o}${l?"/>":`>${a}</${t}>`}`},""),nP=(t,e={})=>Object.keys(t).reduce((n,r)=>{const s=sb[r];return n[s||r]=t[r],n},e),ZB=(t,e,n)=>{const r={key:e,[Jr]:!0},s=nP(n,r);return[qe.createElement("title",s,e)]},gp=(t,e)=>e.map((n,r)=>{const s={key:r,[Jr]:!0};return Object.keys(n).forEach(i=>{const a=sb[i]||i;if(a==="innerHTML"||a==="cssText"){const l=n.innerHTML||n.cssText;s.dangerouslySetInnerHTML={__html:l}}else s[a]=n[i]}),qe.createElement(t,s)}),Er=(t,e,n=!0)=>{switch(t){case"title":return{toComponent:()=>ZB(t,e.title,e.titleAttributes),toString:()=>YB(t,e.title,e.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>nP(e),toString:()=>tP(e)};default:return{toComponent:()=>gp(t,e),toString:()=>XB(t,e,n)}}},e5=({metaTags:t,linkTags:e,scriptTags:n,encode:r})=>{const s=jv(t,Dv.meta),i=jv(e,Dv.link),o=jv(n,Dv.script);return{priorityMethods:{toComponent:()=>[...gp("meta",s.priority),...gp("link",i.priority),...gp("script",o.priority)],toString:()=>`${Er("meta",s.priority,r)} ${Er("link",i.priority,r)} ${Er("script",o.priority,r)}`},metaTags:s.default,linkTags:i.default,scriptTags:o.default}},t5=t=>{const{baseTag:e,bodyAttributes:n,encode:r=!0,htmlAttributes:s,noscriptTags:i,styleTags:o,title:a="",titleAttributes:l,prioritizeSeoTags:c}=t;let{linkTags:u,metaTags:h,scriptTags:f}=t,m={toComponent:()=>{},toString:()=>""};return c&&({priorityMethods:m,linkTags:u,metaTags:h,scriptTags:f}=e5(t)),{priority:m,base:Er("base",e,r),bodyAttributes:Er("bodyAttributes",n,r),htmlAttributes:Er("htmlAttributes",s,r),link:Er("link",u,r),meta:Er("meta",h,r),noscript:Er("noscript",i,r),script:Er("script",f,r),style:Er("style",o,r),title:Er("title",{title:a,titleAttributes:l},r)}},Mw=t5,Sf=[],rP=!!(typeof window<"u"&&window.document&&window.document.createElement),Ow=class{constructor(t,e){Ds(this,"instances",[]);Ds(this,"canUseDOM",rP);Ds(this,"context");Ds(this,"value",{setHelmet:t=>{this.context.helmet=t},helmetInstances:{get:()=>this.canUseDOM?Sf:this.instances,add:t=>{(this.canUseDOM?Sf:this.instances).push(t)},remove:t=>{const e=(this.canUseDOM?Sf:this.instances).indexOf(t);(this.canUseDOM?Sf:this.instances).splice(e,1)}}});this.context=t,this.canUseDOM=e||!1,e||(t.helmet=Mw({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},n5={},sP=qe.createContext(n5),ma,iP=(ma=class extends A.Component{constructor(n){super(n);Ds(this,"helmetData");this.helmetData=new Ow(this.props.context||{},ma.canUseDOM)}render(){return qe.createElement(sP.Provider,{value:this.helmetData.value},this.props.children)}},Ds(ma,"canUseDOM",rP),ma),pl=(t,e)=>{const n=document.head||document.querySelector("head"),r=n.querySelectorAll(`${t}[${Jr}]`),s=[].slice.call(r),i=[];let o;return e&&e.length&&e.forEach(a=>{const l=document.createElement(t);for(const c in a)if(Object.prototype.hasOwnProperty.call(a,c))if(c==="innerHTML")l.innerHTML=a.innerHTML;else if(c==="cssText")l.styleSheet?l.styleSheet.cssText=a.cssText:l.appendChild(document.createTextNode(a.cssText));else{const u=c,h=typeof a[u]>"u"?"":a[u];l.setAttribute(c,h)}l.setAttribute(Jr,"true"),s.some((c,u)=>(o=u,l.isEqualNode(c)))?s.splice(o,1):i.push(l)}),s.forEach(a=>{var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),i.forEach(a=>n.appendChild(a)),{oldTags:s,newTags:i}},Dw=(t,e)=>{const n=document.getElementsByTagName(t)[0];if(!n)return;const r=n.getAttribute(Jr),s=r?r.split(","):[],i=[...s],o=Object.keys(e);for(const a of o){const l=e[a]||"";n.getAttribute(a)!==l&&n.setAttribute(a,l),s.indexOf(a)===-1&&s.push(a);const c=i.indexOf(a);c!==-1&&i.splice(c,1)}for(let a=i.length-1;a>=0;a-=1)n.removeAttribute(i[a]);s.length===i.length?n.removeAttribute(Jr):n.getAttribute(Jr)!==o.join(",")&&n.setAttribute(Jr,o.join(","))},r5=(t,e)=>{typeof t<"u"&&document.title!==t&&(document.title=eP(t)),Dw("title",e)},aS=(t,e)=>{const{baseTag:n,bodyAttributes:r,htmlAttributes:s,linkTags:i,metaTags:o,noscriptTags:a,onChangeClientState:l,scriptTags:c,styleTags:u,title:h,titleAttributes:f}=t;Dw("body",r),Dw("html",s),r5(h,f);const m={baseTag:pl("base",n),linkTags:pl("link",i),metaTags:pl("meta",o),noscriptTags:pl("noscript",a),scriptTags:pl("script",c),styleTags:pl("style",u)},g={},y={};Object.keys(m).forEach(v=>{const{newTags:w,oldTags:_}=m[v];w.length&&(g[v]=w),_.length&&(y[v]=m[v].oldTags)}),e&&e(),l(t,g,y)},bu=null,s5=t=>{bu&&cancelAnimationFrame(bu),t.defer?bu=requestAnimationFrame(()=>{aS(t,()=>{bu=null})}):(aS(t),bu=null)},i5=s5,lS=class extends A.Component{constructor(){super(...arguments);Ds(this,"rendered",!1)}shouldComponentUpdate(e){return!zB(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:n}=this.props.context;let r=null;const s=GB(e.get().map(i=>{const o={...i.props};return delete o.context,o}));iP.canUseDOM?i5(s):Mw&&(r=Mw(s)),n(r)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},L0,o5=(L0=class extends A.Component{shouldComponentUpdate(e){return!XR(oS(this.props,"helmetData"),oS(e,"helmetData"))}mapNestedChildrenToProps(e,n){if(!n)return null;switch(e.type){case"script":case"noscript":return{innerHTML:n};case"style":return{cssText:n};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,n,r,s){return{...n,[e.type]:[...n[e.type]||[],{...r,...this.mapNestedChildrenToProps(e,s)}]}}mapObjectTypeChildren(e,n,r,s){switch(e.type){case"title":return{...n,[e.type]:s,titleAttributes:{...r}};case"body":return{...n,bodyAttributes:{...r}};case"html":return{...n,htmlAttributes:{...r}};default:return{...n,[e.type]:{...r}}}}mapArrayTypeChildrenToProps(e,n){let r={...n};return Object.keys(e).forEach(s=>{r={...r,[s]:e[s]}}),r}warnOnInvalidChildren(e,n){return sS(iS.some(r=>e.type===r),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${iS.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),sS(!n||typeof n=="string"||Array.isArray(n)&&!n.some(r=>typeof r!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,n){let r={};return qe.Children.forEach(e,s=>{if(!s||!s.props)return;const{children:i,...o}=s.props,a=Object.keys(o).reduce((c,u)=>(c[$B[u]||u]=o[u],c),{});let{type:l}=s;switch(typeof l=="symbol"?l=l.toString():this.warnOnInvalidChildren(s,i),l){case"Symbol(react.fragment)":n=this.mapChildrenToProps(i,n);break;case"link":case"meta":case"noscript":case"script":case"style":r=this.flattenArrayTypeChildren(s,r,a,i);break;default:n=this.mapObjectTypeChildren(s,n,a,i);break}}),this.mapArrayTypeChildrenToProps(r,n)}render(){const{children:e,...n}=this.props;let r={...n},{helmetData:s}=n;if(e&&(r=this.mapChildrenToProps(e,r)),s&&!(s instanceof Ow)){const i=s;s=new Ow(i.context,!0),delete r.helmetData}return s?qe.createElement(lS,{...r,context:s.value}):qe.createElement(sP.Consumer,null,i=>qe.createElement(lS,{...r,context:i}))}},Ds(L0,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),L0);const a5=()=>{const t=document.createElement("canvas"),e=t.getContext("2d");e.textBaseline="top",e.font="14px Arial",e.fillText("fingerprint",2,2);const n={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,canvasFingerprint:t.toDataURL(),colorDepth:screen.colorDepth,deviceMemory:navigator.deviceMemory||"unknown",hardwareConcurrency:navigator.hardwareConcurrency||"unknown"},r=JSON.stringify(n);let s=0;for(let i=0;i<r.length;i++){const o=r.charCodeAt(i);s=(s<<5)-s+o,s=s&s}return`guest_${Math.abs(s).toString(36)}`},l5=()=>{let t=localStorage.getItem("deskhub_guest_id");return t||(t=a5(),localStorage.setItem("deskhub_guest_id",t)),t},Tu=()=>{const t=JSON.parse(localStorage.getItem("deskhub_current_user")||"null");if(t)return{id:t.id,username:t.username,displayName:t.displayName,avatar:t.avatar,role:t.role,isGuest:!1};const e=l5(),n=localStorage.getItem("deskhub_guest_name")||"Khch",r=localStorage.getItem("deskhub_guest_avatar")||"https://i.pravatar.cc/150?img=0";return{id:e,username:e,displayName:n,avatar:r,role:"guest",isGuest:!0}},c5=(t,e)=>{localStorage.setItem("deskhub_guest_name",t)},u5=()=>{};var cS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},h5=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},aP={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,u=i>>2,h=(i&3)<<4|a>>4;let f=(a&15)<<2|c>>6,m=c&63;l||(m=64,o||(f=64)),r.push(n[u],n[h],n[f],n[m])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(oP(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):h5(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const c=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||c==null||h==null)throw new d5;const f=i<<2|a>>4;if(r.push(f),c!==64){const m=a<<4&240|c>>2;if(r.push(m),h!==64){const g=c<<6&192|h;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class d5 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const f5=function(t){const e=oP(t);return aP.encodeByteArray(e,!0)},dm=function(t){return f5(t).replace(/\./g,"")},lP=function(t){try{return aP.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cP(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p5=()=>cP().__FIREBASE_DEFAULTS__,m5=()=>{if(typeof process>"u"||typeof cS>"u")return;const t=cS.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},g5=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&lP(t[1]);return e&&JSON.parse(e)},Qg=()=>{try{return u5()||p5()||m5()||g5()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},uP=t=>{var e,n;return(n=(e=Qg())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},hP=t=>{const e=uP(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},dP=()=>{var t;return(t=Qg())==null?void 0:t.config},fP=t=>{var e;return(e=Qg())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class y5{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Po(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ib(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pP(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[dm(JSON.stringify(n)),dm(JSON.stringify(o)),""].join(".")}const ah={};function v5(){const t={prod:[],emulator:[]};for(const e of Object.keys(ah))ah[e]?t.emulator.push(e):t.prod.push(e);return t}function w5(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let uS=!1;function ob(t,e){if(typeof window>"u"||typeof document>"u"||!Po(window.location.host)||ah[t]===e||ah[t]||uS)return;ah[t]=e;function n(f){return`__firebase__banner__${f}`}const r="__firebase__banner",i=v5().prod.length>0;function o(){const f=document.getElementById(r);f&&f.remove()}function a(f){f.style.display="flex",f.style.background="#7faaf0",f.style.position="fixed",f.style.bottom="5px",f.style.left="5px",f.style.padding=".5em",f.style.borderRadius="5px",f.style.alignItems="center"}function l(f,m){f.setAttribute("width","24"),f.setAttribute("id",m),f.setAttribute("height","24"),f.setAttribute("viewBox","0 0 24 24"),f.setAttribute("fill","none"),f.style.marginLeft="-6px"}function c(){const f=document.createElement("span");return f.style.cursor="pointer",f.style.marginLeft="16px",f.style.fontSize="24px",f.innerHTML=" &times;",f.onclick=()=>{uS=!0,o()},f}function u(f,m){f.setAttribute("id",m),f.innerText="Learn more",f.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",f.setAttribute("target","__blank"),f.style.paddingLeft="5px",f.style.textDecoration="underline"}function h(){const f=w5(r),m=n("text"),g=document.getElementById(m)||document.createElement("span"),y=n("learnmore"),v=document.getElementById(y)||document.createElement("a"),w=n("preprendIcon"),_=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(f.created){const E=f.element;a(E),u(v,y);const N=c();l(_,w),E.append(_,g,v,N),document.body.appendChild(E)}i?(g.innerText="Preview backend disconnected.",_.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(_.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function x5(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qt())}function mP(){var e;const t=(e=Qg())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function _5(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function b5(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function T5(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function E5(){const t=qt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function gP(){return!mP()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function yP(){return!mP()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function vP(){try{return typeof indexedDB=="object"}catch{return!1}}function S5(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k5="FirebaseError";class Ms extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=k5,Object.setPrototypeOf(this,Ms.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Id.prototype.create)}}class Id{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?C5(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ms(s,a,r)}}function C5(t,e){return t.replace(I5,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const I5=/\{\$([^}]+)}/g;function A5(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Oa(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(hS(i)&&hS(o)){if(!Oa(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function hS(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ad(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function zu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function $u(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function N5(t,e){const n=new R5(t,e);return n.subscribe.bind(n)}class R5{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");P5(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Vv),s.error===void 0&&(s.error=Vv),s.complete===void 0&&(s.complete=Vv);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function P5(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Vv(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tt(t){return t&&t._delegate?t._delegate:t}class _o{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jo="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class M5{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new y5;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(D5(e))try{this.getOrInitializeService({instanceIdentifier:Jo})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=Jo){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Jo){return this.instances.has(e)}getOptions(e=Jo){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:O5(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Jo){return this.component?this.component.multipleInstances?e:Jo:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function O5(t){return t===Jo?void 0:t}function D5(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L5{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new M5(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var De;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(De||(De={}));const j5={debug:De.DEBUG,verbose:De.VERBOSE,info:De.INFO,warn:De.WARN,error:De.ERROR,silent:De.SILENT},V5=De.INFO,F5={[De.DEBUG]:"log",[De.VERBOSE]:"log",[De.INFO]:"info",[De.WARN]:"warn",[De.ERROR]:"error"},B5=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=F5[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class ab{constructor(e){this.name=e,this._logLevel=V5,this._logHandler=B5,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in De))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?j5[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,De.DEBUG,...e),this._logHandler(this,De.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,De.VERBOSE,...e),this._logHandler(this,De.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,De.INFO,...e),this._logHandler(this,De.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,De.WARN,...e),this._logHandler(this,De.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,De.ERROR,...e),this._logHandler(this,De.ERROR,...e)}}const z5=(t,e)=>e.some(n=>t instanceof n);let dS,fS;function $5(){return dS||(dS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function U5(){return fS||(fS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const wP=new WeakMap,Lw=new WeakMap,xP=new WeakMap,Fv=new WeakMap,lb=new WeakMap;function H5(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(co(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&wP.set(n,t)}).catch(()=>{}),lb.set(e,t),e}function W5(t){if(Lw.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Lw.set(t,e)}let jw={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Lw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||xP.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return co(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function q5(t){jw=t(jw)}function K5(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Bv(this),e,...n);return xP.set(r,e.sort?e.sort():[e]),co(r)}:U5().includes(t)?function(...e){return t.apply(Bv(this),e),co(wP.get(this))}:function(...e){return co(t.apply(Bv(this),e))}}function G5(t){return typeof t=="function"?K5(t):(t instanceof IDBTransaction&&W5(t),z5(t,$5())?new Proxy(t,jw):t)}function co(t){if(t instanceof IDBRequest)return H5(t);if(Fv.has(t))return Fv.get(t);const e=G5(t);return e!==t&&(Fv.set(t,e),lb.set(e,t)),e}const Bv=t=>lb.get(t);function Q5(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=co(o);return r&&o.addEventListener("upgradeneeded",l=>{r(co(o.result),l.oldVersion,l.newVersion,co(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const J5=["get","getKey","getAll","getAllKeys","count"],Y5=["put","add","delete","clear"],zv=new Map;function pS(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(zv.get(e))return zv.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=Y5.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||J5.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return zv.set(e,i),i}q5(t=>({...t,get:(e,n,r)=>pS(e,n)||t.get(e,n,r),has:(e,n)=>!!pS(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X5{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(Z5(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function Z5(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Vw="@firebase/app",mS="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ui=new ab("@firebase/app"),ez="@firebase/app-compat",tz="@firebase/analytics-compat",nz="@firebase/analytics",rz="@firebase/app-check-compat",sz="@firebase/app-check",iz="@firebase/auth",oz="@firebase/auth-compat",az="@firebase/database",lz="@firebase/data-connect",cz="@firebase/database-compat",uz="@firebase/functions",hz="@firebase/functions-compat",dz="@firebase/installations",fz="@firebase/installations-compat",pz="@firebase/messaging",mz="@firebase/messaging-compat",gz="@firebase/performance",yz="@firebase/performance-compat",vz="@firebase/remote-config",wz="@firebase/remote-config-compat",xz="@firebase/storage",_z="@firebase/storage-compat",bz="@firebase/firestore",Tz="@firebase/ai",Ez="@firebase/firestore-compat",Sz="firebase",kz="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="[DEFAULT]",Cz={[Vw]:"fire-core",[ez]:"fire-core-compat",[nz]:"fire-analytics",[tz]:"fire-analytics-compat",[sz]:"fire-app-check",[rz]:"fire-app-check-compat",[iz]:"fire-auth",[oz]:"fire-auth-compat",[az]:"fire-rtdb",[lz]:"fire-data-connect",[cz]:"fire-rtdb-compat",[uz]:"fire-fn",[hz]:"fire-fn-compat",[dz]:"fire-iid",[fz]:"fire-iid-compat",[pz]:"fire-fcm",[mz]:"fire-fcm-compat",[gz]:"fire-perf",[yz]:"fire-perf-compat",[vz]:"fire-rc",[wz]:"fire-rc-compat",[xz]:"fire-gcs",[_z]:"fire-gcs-compat",[bz]:"fire-fst",[Ez]:"fire-fst-compat",[Tz]:"fire-vertex","fire-js":"fire-js",[Sz]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fm=new Map,Iz=new Map,Bw=new Map;function gS(t,e){try{t.container.addComponent(e)}catch(n){ui.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Da(t){const e=t.name;if(Bw.has(e))return ui.debug(`There were multiple attempts to register component ${e}.`),!1;Bw.set(e,t);for(const n of fm.values())gS(n,t);for(const n of Iz.values())gS(n,t);return!0}function Jg(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function or(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Az={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},uo=new Id("app","Firebase",Az);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nz{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new _o("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw uo.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sl=kz;function _P(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Fw,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw uo.create("bad-app-name",{appName:String(s)});if(n||(n=dP()),!n)throw uo.create("no-options");const i=fm.get(s);if(i){if(Oa(n,i.options)&&Oa(r,i.config))return i;throw uo.create("duplicate-app",{appName:s})}const o=new L5(s);for(const l of Bw.values())o.addComponent(l);const a=new Nz(n,r,o);return fm.set(s,a),a}function cb(t=Fw){const e=fm.get(t);if(!e&&t===Fw&&dP())return _P();if(!e)throw uo.create("no-app",{appName:t});return e}function Ts(t,e,n){let r=Cz[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),ui.warn(o.join(" "));return}Da(new _o(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rz="firebase-heartbeat-database",Pz=1,qh="firebase-heartbeat-store";let $v=null;function bP(){return $v||($v=Q5(Rz,Pz,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(qh)}catch(n){console.warn(n)}}}}).catch(t=>{throw uo.create("idb-open",{originalErrorMessage:t.message})})),$v}async function Mz(t){try{const n=(await bP()).transaction(qh),r=await n.objectStore(qh).get(TP(t));return await n.done,r}catch(e){if(e instanceof Ms)ui.warn(e.message);else{const n=uo.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});ui.warn(n.message)}}}async function yS(t,e){try{const r=(await bP()).transaction(qh,"readwrite");await r.objectStore(qh).put(e,TP(t)),await r.done}catch(n){if(n instanceof Ms)ui.warn(n.message);else{const r=uo.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ui.warn(r.message)}}}function TP(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oz=1024,Dz=30;class Lz{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Vz(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=vS();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>Dz){const o=Fz(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){ui.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=vS(),{heartbeatsToSend:r,unsentEntries:s}=jz(this._heartbeatsCache.heartbeats),i=dm(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return ui.warn(n),""}}}function vS(){return new Date().toISOString().substring(0,10)}function jz(t,e=Oz){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),wS(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),wS(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Vz{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return vP()?S5().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Mz(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return yS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return yS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function wS(t){return dm(JSON.stringify({version:2,heartbeats:t})).length}function Fz(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bz(t){Da(new _o("platform-logger",e=>new X5(e),"PRIVATE")),Da(new _o("heartbeat",e=>new Lz(e),"PRIVATE")),Ts(Vw,mS,t),Ts(Vw,mS,"esm2020"),Ts("fire-js","")}Bz("");var xS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var ho,EP;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(S,T){function k(){}k.prototype=T.prototype,S.F=T.prototype,S.prototype=new k,S.prototype.constructor=S,S.D=function(I,M,D){for(var P=Array(arguments.length-2),pe=2;pe<arguments.length;pe++)P[pe-2]=arguments[pe];return T.prototype[M].apply(I,P)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(S,T,k){k||(k=0);const I=Array(16);if(typeof T=="string")for(var M=0;M<16;++M)I[M]=T.charCodeAt(k++)|T.charCodeAt(k++)<<8|T.charCodeAt(k++)<<16|T.charCodeAt(k++)<<24;else for(M=0;M<16;++M)I[M]=T[k++]|T[k++]<<8|T[k++]<<16|T[k++]<<24;T=S.g[0],k=S.g[1],M=S.g[2];let D=S.g[3],P;P=T+(D^k&(M^D))+I[0]+3614090360&4294967295,T=k+(P<<7&4294967295|P>>>25),P=D+(M^T&(k^M))+I[1]+3905402710&4294967295,D=T+(P<<12&4294967295|P>>>20),P=M+(k^D&(T^k))+I[2]+606105819&4294967295,M=D+(P<<17&4294967295|P>>>15),P=k+(T^M&(D^T))+I[3]+3250441966&4294967295,k=M+(P<<22&4294967295|P>>>10),P=T+(D^k&(M^D))+I[4]+4118548399&4294967295,T=k+(P<<7&4294967295|P>>>25),P=D+(M^T&(k^M))+I[5]+1200080426&4294967295,D=T+(P<<12&4294967295|P>>>20),P=M+(k^D&(T^k))+I[6]+2821735955&4294967295,M=D+(P<<17&4294967295|P>>>15),P=k+(T^M&(D^T))+I[7]+4249261313&4294967295,k=M+(P<<22&4294967295|P>>>10),P=T+(D^k&(M^D))+I[8]+1770035416&4294967295,T=k+(P<<7&4294967295|P>>>25),P=D+(M^T&(k^M))+I[9]+2336552879&4294967295,D=T+(P<<12&4294967295|P>>>20),P=M+(k^D&(T^k))+I[10]+4294925233&4294967295,M=D+(P<<17&4294967295|P>>>15),P=k+(T^M&(D^T))+I[11]+2304563134&4294967295,k=M+(P<<22&4294967295|P>>>10),P=T+(D^k&(M^D))+I[12]+1804603682&4294967295,T=k+(P<<7&4294967295|P>>>25),P=D+(M^T&(k^M))+I[13]+4254626195&4294967295,D=T+(P<<12&4294967295|P>>>20),P=M+(k^D&(T^k))+I[14]+2792965006&4294967295,M=D+(P<<17&4294967295|P>>>15),P=k+(T^M&(D^T))+I[15]+1236535329&4294967295,k=M+(P<<22&4294967295|P>>>10),P=T+(M^D&(k^M))+I[1]+4129170786&4294967295,T=k+(P<<5&4294967295|P>>>27),P=D+(k^M&(T^k))+I[6]+3225465664&4294967295,D=T+(P<<9&4294967295|P>>>23),P=M+(T^k&(D^T))+I[11]+643717713&4294967295,M=D+(P<<14&4294967295|P>>>18),P=k+(D^T&(M^D))+I[0]+3921069994&4294967295,k=M+(P<<20&4294967295|P>>>12),P=T+(M^D&(k^M))+I[5]+3593408605&4294967295,T=k+(P<<5&4294967295|P>>>27),P=D+(k^M&(T^k))+I[10]+38016083&4294967295,D=T+(P<<9&4294967295|P>>>23),P=M+(T^k&(D^T))+I[15]+3634488961&4294967295,M=D+(P<<14&4294967295|P>>>18),P=k+(D^T&(M^D))+I[4]+3889429448&4294967295,k=M+(P<<20&4294967295|P>>>12),P=T+(M^D&(k^M))+I[9]+568446438&4294967295,T=k+(P<<5&4294967295|P>>>27),P=D+(k^M&(T^k))+I[14]+3275163606&4294967295,D=T+(P<<9&4294967295|P>>>23),P=M+(T^k&(D^T))+I[3]+4107603335&4294967295,M=D+(P<<14&4294967295|P>>>18),P=k+(D^T&(M^D))+I[8]+1163531501&4294967295,k=M+(P<<20&4294967295|P>>>12),P=T+(M^D&(k^M))+I[13]+2850285829&4294967295,T=k+(P<<5&4294967295|P>>>27),P=D+(k^M&(T^k))+I[2]+4243563512&4294967295,D=T+(P<<9&4294967295|P>>>23),P=M+(T^k&(D^T))+I[7]+1735328473&4294967295,M=D+(P<<14&4294967295|P>>>18),P=k+(D^T&(M^D))+I[12]+2368359562&4294967295,k=M+(P<<20&4294967295|P>>>12),P=T+(k^M^D)+I[5]+4294588738&4294967295,T=k+(P<<4&4294967295|P>>>28),P=D+(T^k^M)+I[8]+2272392833&4294967295,D=T+(P<<11&4294967295|P>>>21),P=M+(D^T^k)+I[11]+1839030562&4294967295,M=D+(P<<16&4294967295|P>>>16),P=k+(M^D^T)+I[14]+4259657740&4294967295,k=M+(P<<23&4294967295|P>>>9),P=T+(k^M^D)+I[1]+2763975236&4294967295,T=k+(P<<4&4294967295|P>>>28),P=D+(T^k^M)+I[4]+1272893353&4294967295,D=T+(P<<11&4294967295|P>>>21),P=M+(D^T^k)+I[7]+4139469664&4294967295,M=D+(P<<16&4294967295|P>>>16),P=k+(M^D^T)+I[10]+3200236656&4294967295,k=M+(P<<23&4294967295|P>>>9),P=T+(k^M^D)+I[13]+681279174&4294967295,T=k+(P<<4&4294967295|P>>>28),P=D+(T^k^M)+I[0]+3936430074&4294967295,D=T+(P<<11&4294967295|P>>>21),P=M+(D^T^k)+I[3]+3572445317&4294967295,M=D+(P<<16&4294967295|P>>>16),P=k+(M^D^T)+I[6]+76029189&4294967295,k=M+(P<<23&4294967295|P>>>9),P=T+(k^M^D)+I[9]+3654602809&4294967295,T=k+(P<<4&4294967295|P>>>28),P=D+(T^k^M)+I[12]+3873151461&4294967295,D=T+(P<<11&4294967295|P>>>21),P=M+(D^T^k)+I[15]+530742520&4294967295,M=D+(P<<16&4294967295|P>>>16),P=k+(M^D^T)+I[2]+3299628645&4294967295,k=M+(P<<23&4294967295|P>>>9),P=T+(M^(k|~D))+I[0]+4096336452&4294967295,T=k+(P<<6&4294967295|P>>>26),P=D+(k^(T|~M))+I[7]+1126891415&4294967295,D=T+(P<<10&4294967295|P>>>22),P=M+(T^(D|~k))+I[14]+2878612391&4294967295,M=D+(P<<15&4294967295|P>>>17),P=k+(D^(M|~T))+I[5]+4237533241&4294967295,k=M+(P<<21&4294967295|P>>>11),P=T+(M^(k|~D))+I[12]+1700485571&4294967295,T=k+(P<<6&4294967295|P>>>26),P=D+(k^(T|~M))+I[3]+2399980690&4294967295,D=T+(P<<10&4294967295|P>>>22),P=M+(T^(D|~k))+I[10]+4293915773&4294967295,M=D+(P<<15&4294967295|P>>>17),P=k+(D^(M|~T))+I[1]+2240044497&4294967295,k=M+(P<<21&4294967295|P>>>11),P=T+(M^(k|~D))+I[8]+1873313359&4294967295,T=k+(P<<6&4294967295|P>>>26),P=D+(k^(T|~M))+I[15]+4264355552&4294967295,D=T+(P<<10&4294967295|P>>>22),P=M+(T^(D|~k))+I[6]+2734768916&4294967295,M=D+(P<<15&4294967295|P>>>17),P=k+(D^(M|~T))+I[13]+1309151649&4294967295,k=M+(P<<21&4294967295|P>>>11),P=T+(M^(k|~D))+I[4]+4149444226&4294967295,T=k+(P<<6&4294967295|P>>>26),P=D+(k^(T|~M))+I[11]+3174756917&4294967295,D=T+(P<<10&4294967295|P>>>22),P=M+(T^(D|~k))+I[2]+718787259&4294967295,M=D+(P<<15&4294967295|P>>>17),P=k+(D^(M|~T))+I[9]+3951481745&4294967295,S.g[0]=S.g[0]+T&4294967295,S.g[1]=S.g[1]+(M+(P<<21&4294967295|P>>>11))&4294967295,S.g[2]=S.g[2]+M&4294967295,S.g[3]=S.g[3]+D&4294967295}r.prototype.v=function(S,T){T===void 0&&(T=S.length);const k=T-this.blockSize,I=this.C;let M=this.h,D=0;for(;D<T;){if(M==0)for(;D<=k;)s(this,S,D),D+=this.blockSize;if(typeof S=="string"){for(;D<T;)if(I[M++]=S.charCodeAt(D++),M==this.blockSize){s(this,I),M=0;break}}else for(;D<T;)if(I[M++]=S[D++],M==this.blockSize){s(this,I),M=0;break}}this.h=M,this.o+=T},r.prototype.A=function(){var S=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);S[0]=128;for(var T=1;T<S.length-8;++T)S[T]=0;T=this.o*8;for(var k=S.length-8;k<S.length;++k)S[k]=T&255,T/=256;for(this.v(S),S=Array(16),T=0,k=0;k<4;++k)for(let I=0;I<32;I+=8)S[T++]=this.g[k]>>>I&255;return S};function i(S,T){var k=a;return Object.prototype.hasOwnProperty.call(k,S)?k[S]:k[S]=T(S)}function o(S,T){this.h=T;const k=[];let I=!0;for(let M=S.length-1;M>=0;M--){const D=S[M]|0;I&&D==T||(k[M]=D,I=!1)}this.g=k}var a={};function l(S){return-128<=S&&S<128?i(S,function(T){return new o([T|0],T<0?-1:0)}):new o([S|0],S<0?-1:0)}function c(S){if(isNaN(S)||!isFinite(S))return h;if(S<0)return v(c(-S));const T=[];let k=1;for(let I=0;S>=k;I++)T[I]=S/k|0,k*=4294967296;return new o(T,0)}function u(S,T){if(S.length==0)throw Error("number format error: empty string");if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(S.charAt(0)=="-")return v(u(S.substring(1),T));if(S.indexOf("-")>=0)throw Error('number format error: interior "-" character');const k=c(Math.pow(T,8));let I=h;for(let D=0;D<S.length;D+=8){var M=Math.min(8,S.length-D);const P=parseInt(S.substring(D,D+M),T);M<8?(M=c(Math.pow(T,M)),I=I.j(M).add(c(P))):(I=I.j(k),I=I.add(c(P)))}return I}var h=l(0),f=l(1),m=l(16777216);t=o.prototype,t.m=function(){if(y(this))return-v(this).m();let S=0,T=1;for(let k=0;k<this.g.length;k++){const I=this.i(k);S+=(I>=0?I:4294967296+I)*T,T*=4294967296}return S},t.toString=function(S){if(S=S||10,S<2||36<S)throw Error("radix out of range: "+S);if(g(this))return"0";if(y(this))return"-"+v(this).toString(S);const T=c(Math.pow(S,6));var k=this;let I="";for(;;){const M=N(k,T).g;k=w(k,M.j(T));let D=((k.g.length>0?k.g[0]:k.h)>>>0).toString(S);if(k=M,g(k))return D+I;for(;D.length<6;)D="0"+D;I=D+I}},t.i=function(S){return S<0?0:S<this.g.length?this.g[S]:this.h};function g(S){if(S.h!=0)return!1;for(let T=0;T<S.g.length;T++)if(S.g[T]!=0)return!1;return!0}function y(S){return S.h==-1}t.l=function(S){return S=w(this,S),y(S)?-1:g(S)?0:1};function v(S){const T=S.g.length,k=[];for(let I=0;I<T;I++)k[I]=~S.g[I];return new o(k,~S.h).add(f)}t.abs=function(){return y(this)?v(this):this},t.add=function(S){const T=Math.max(this.g.length,S.g.length),k=[];let I=0;for(let M=0;M<=T;M++){let D=I+(this.i(M)&65535)+(S.i(M)&65535),P=(D>>>16)+(this.i(M)>>>16)+(S.i(M)>>>16);I=P>>>16,D&=65535,P&=65535,k[M]=P<<16|D}return new o(k,k[k.length-1]&-2147483648?-1:0)};function w(S,T){return S.add(v(T))}t.j=function(S){if(g(this)||g(S))return h;if(y(this))return y(S)?v(this).j(v(S)):v(v(this).j(S));if(y(S))return v(this.j(v(S)));if(this.l(m)<0&&S.l(m)<0)return c(this.m()*S.m());const T=this.g.length+S.g.length,k=[];for(var I=0;I<2*T;I++)k[I]=0;for(I=0;I<this.g.length;I++)for(let M=0;M<S.g.length;M++){const D=this.i(I)>>>16,P=this.i(I)&65535,pe=S.i(M)>>>16,Ee=S.i(M)&65535;k[2*I+2*M]+=P*Ee,_(k,2*I+2*M),k[2*I+2*M+1]+=D*Ee,_(k,2*I+2*M+1),k[2*I+2*M+1]+=P*pe,_(k,2*I+2*M+1),k[2*I+2*M+2]+=D*pe,_(k,2*I+2*M+2)}for(S=0;S<T;S++)k[S]=k[2*S+1]<<16|k[2*S];for(S=T;S<2*T;S++)k[S]=0;return new o(k,0)};function _(S,T){for(;(S[T]&65535)!=S[T];)S[T+1]+=S[T]>>>16,S[T]&=65535,T++}function E(S,T){this.g=S,this.h=T}function N(S,T){if(g(T))throw Error("division by zero");if(g(S))return new E(h,h);if(y(S))return T=N(v(S),T),new E(v(T.g),v(T.h));if(y(T))return T=N(S,v(T)),new E(v(T.g),T.h);if(S.g.length>30){if(y(S)||y(T))throw Error("slowDivide_ only works with positive integers.");for(var k=f,I=T;I.l(S)<=0;)k=R(k),I=R(I);var M=O(k,1),D=O(I,1);for(I=O(I,2),k=O(k,2);!g(I);){var P=D.add(I);P.l(S)<=0&&(M=M.add(k),D=P),I=O(I,1),k=O(k,1)}return T=w(S,M.j(T)),new E(M,T)}for(M=h;S.l(T)>=0;){for(k=Math.max(1,Math.floor(S.m()/T.m())),I=Math.ceil(Math.log(k)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),D=c(k),P=D.j(T);y(P)||P.l(S)>0;)k-=I,D=c(k),P=D.j(T);g(D)&&(D=f),M=M.add(D),S=w(S,P)}return new E(M,S)}t.B=function(S){return N(this,S).h},t.and=function(S){const T=Math.max(this.g.length,S.g.length),k=[];for(let I=0;I<T;I++)k[I]=this.i(I)&S.i(I);return new o(k,this.h&S.h)},t.or=function(S){const T=Math.max(this.g.length,S.g.length),k=[];for(let I=0;I<T;I++)k[I]=this.i(I)|S.i(I);return new o(k,this.h|S.h)},t.xor=function(S){const T=Math.max(this.g.length,S.g.length),k=[];for(let I=0;I<T;I++)k[I]=this.i(I)^S.i(I);return new o(k,this.h^S.h)};function R(S){const T=S.g.length+1,k=[];for(let I=0;I<T;I++)k[I]=S.i(I)<<1|S.i(I-1)>>>31;return new o(k,S.h)}function O(S,T){const k=T>>5;T%=32;const I=S.g.length-k,M=[];for(let D=0;D<I;D++)M[D]=T>0?S.i(D+k)>>>T|S.i(D+k+1)<<32-T:S.i(D+k);return new o(M,S.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,EP=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,ho=o}).apply(typeof xS<"u"?xS:typeof self<"u"?self:typeof window<"u"?window:{});var kf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var SP,Uu,kP,yp,zw,CP,IP,AP;(function(){var t,e=Object.defineProperty;function n(p){p=[typeof globalThis=="object"&&globalThis,p,typeof window=="object"&&window,typeof self=="object"&&self,typeof kf=="object"&&kf];for(var x=0;x<p.length;++x){var b=p[x];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var r=n(this);function s(p,x){if(x)e:{var b=r;p=p.split(".");for(var C=0;C<p.length-1;C++){var j=p[C];if(!(j in b))break e;b=b[j]}p=p[p.length-1],C=b[p],x=x(C),x!=C&&x!=null&&e(b,p,{configurable:!0,writable:!0,value:x})}}s("Symbol.dispose",function(p){return p||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(p){return p||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(p){return p||function(x){var b=[],C;for(C in x)Object.prototype.hasOwnProperty.call(x,C)&&b.push([C,x[C]]);return b}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(p){var x=typeof p;return x=="object"&&p!=null||x=="function"}function l(p,x,b){return p.call.apply(p.bind,arguments)}function c(p,x,b){return c=l,c.apply(null,arguments)}function u(p,x){var b=Array.prototype.slice.call(arguments,1);return function(){var C=b.slice();return C.push.apply(C,arguments),p.apply(this,C)}}function h(p,x){function b(){}b.prototype=x.prototype,p.Z=x.prototype,p.prototype=new b,p.prototype.constructor=p,p.Ob=function(C,j,F){for(var te=Array(arguments.length-2),Ae=2;Ae<arguments.length;Ae++)te[Ae-2]=arguments[Ae];return x.prototype[j].apply(C,te)}}var f=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?p=>p&&AsyncContext.Snapshot.wrap(p):p=>p;function m(p){const x=p.length;if(x>0){const b=Array(x);for(let C=0;C<x;C++)b[C]=p[C];return b}return[]}function g(p,x){for(let C=1;C<arguments.length;C++){const j=arguments[C];var b=typeof j;if(b=b!="object"?b:j?Array.isArray(j)?"array":b:"null",b=="array"||b=="object"&&typeof j.length=="number"){b=p.length||0;const F=j.length||0;p.length=b+F;for(let te=0;te<F;te++)p[b+te]=j[te]}else p.push(j)}}class y{constructor(x,b){this.i=x,this.j=b,this.h=0,this.g=null}get(){let x;return this.h>0?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function v(p){o.setTimeout(()=>{throw p},0)}function w(){var p=S;let x=null;return p.g&&(x=p.g,p.g=p.g.next,p.g||(p.h=null),x.next=null),x}class _{constructor(){this.h=this.g=null}add(x,b){const C=E.get();C.set(x,b),this.h?this.h.next=C:this.g=C,this.h=C}}var E=new y(()=>new N,p=>p.reset());class N{constructor(){this.next=this.g=this.h=null}set(x,b){this.h=x,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let R,O=!1,S=new _,T=()=>{const p=Promise.resolve(void 0);R=()=>{p.then(k)}};function k(){for(var p;p=w();){try{p.h.call(p.g)}catch(b){v(b)}var x=E;x.j(p),x.h<100&&(x.h++,p.next=x.g,x.g=p)}O=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function M(p,x){this.type=p,this.g=this.target=x,this.defaultPrevented=!1}M.prototype.h=function(){this.defaultPrevented=!0};var D=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var p=!1,x=Object.defineProperty({},"passive",{get:function(){p=!0}});try{const b=()=>{};o.addEventListener("test",b,x),o.removeEventListener("test",b,x)}catch{}return p}();function P(p){return/^[\s\xa0]*$/.test(p)}function pe(p,x){M.call(this,p?p.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,p&&this.init(p,x)}h(pe,M),pe.prototype.init=function(p,x){const b=this.type=p.type,C=p.changedTouches&&p.changedTouches.length?p.changedTouches[0]:null;this.target=p.target||p.srcElement,this.g=x,x=p.relatedTarget,x||(b=="mouseover"?x=p.fromElement:b=="mouseout"&&(x=p.toElement)),this.relatedTarget=x,C?(this.clientX=C.clientX!==void 0?C.clientX:C.pageX,this.clientY=C.clientY!==void 0?C.clientY:C.pageY,this.screenX=C.screenX||0,this.screenY=C.screenY||0):(this.clientX=p.clientX!==void 0?p.clientX:p.pageX,this.clientY=p.clientY!==void 0?p.clientY:p.pageY,this.screenX=p.screenX||0,this.screenY=p.screenY||0),this.button=p.button,this.key=p.key||"",this.ctrlKey=p.ctrlKey,this.altKey=p.altKey,this.shiftKey=p.shiftKey,this.metaKey=p.metaKey,this.pointerId=p.pointerId||0,this.pointerType=p.pointerType,this.state=p.state,this.i=p,p.defaultPrevented&&pe.Z.h.call(this)},pe.prototype.h=function(){pe.Z.h.call(this);const p=this.i;p.preventDefault?p.preventDefault():p.returnValue=!1};var Ee="closure_listenable_"+(Math.random()*1e6|0),je=0;function oe(p,x,b,C,j){this.listener=p,this.proxy=null,this.src=x,this.type=b,this.capture=!!C,this.ha=j,this.key=++je,this.da=this.fa=!1}function W(p){p.da=!0,p.listener=null,p.proxy=null,p.src=null,p.ha=null}function V(p,x,b){for(const C in p)x.call(b,p[C],C,p)}function Z(p,x){for(const b in p)x.call(void 0,p[b],b,p)}function ce(p){const x={};for(const b in p)x[b]=p[b];return x}const U="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function he(p,x){let b,C;for(let j=1;j<arguments.length;j++){C=arguments[j];for(b in C)p[b]=C[b];for(let F=0;F<U.length;F++)b=U[F],Object.prototype.hasOwnProperty.call(C,b)&&(p[b]=C[b])}}function we(p){this.src=p,this.g={},this.h=0}we.prototype.add=function(p,x,b,C,j){const F=p.toString();p=this.g[F],p||(p=this.g[F]=[],this.h++);const te=st(p,x,C,j);return te>-1?(x=p[te],b||(x.fa=!1)):(x=new oe(x,this.src,F,!!C,j),x.fa=b,p.push(x)),x};function dt(p,x){const b=x.type;if(b in p.g){var C=p.g[b],j=Array.prototype.indexOf.call(C,x,void 0),F;(F=j>=0)&&Array.prototype.splice.call(C,j,1),F&&(W(x),p.g[b].length==0&&(delete p.g[b],p.h--))}}function st(p,x,b,C){for(let j=0;j<p.length;++j){const F=p[j];if(!F.da&&F.listener==x&&F.capture==!!b&&F.ha==C)return j}return-1}var it="closure_lm_"+(Math.random()*1e6|0),$e={};function ae(p,x,b,C,j){if(Array.isArray(x)){for(let F=0;F<x.length;F++)ae(p,x[F],b,C,j);return null}return b=q(b),p&&p[Ee]?p.J(x,b,a(C)?!!C.capture:!1,j):Qt(p,x,b,!1,C,j)}function Qt(p,x,b,C,j,F){if(!x)throw Error("Invalid event type");const te=a(j)?!!j.capture:!!j;let Ae=wr(p);if(Ae||(p[it]=Ae=new we(p)),b=Ae.add(x,b,C,te,F),b.proxy)return b;if(C=Rn(),b.proxy=C,C.src=p,C.listener=b,p.addEventListener)D||(j=te),j===void 0&&(j=!1),p.addEventListener(x.toString(),C,j);else if(p.attachEvent)p.attachEvent(Pn(x.toString()),C);else if(p.addListener&&p.removeListener)p.addListener(C);else throw Error("addEventListener and attachEvent are unavailable.");return b}function Rn(){function p(b){return x.call(p.src,p.listener,b)}const x=tr;return p}function $r(p,x,b,C,j){if(Array.isArray(x))for(var F=0;F<x.length;F++)$r(p,x[F],b,C,j);else C=a(C)?!!C.capture:!!C,b=q(b),p&&p[Ee]?(p=p.i,F=String(x).toString(),F in p.g&&(x=p.g[F],b=st(x,b,C,j),b>-1&&(W(x[b]),Array.prototype.splice.call(x,b,1),x.length==0&&(delete p.g[F],p.h--)))):p&&(p=wr(p))&&(x=p.g[x.toString()],p=-1,x&&(p=st(x,b,C,j)),(b=p>-1?x[p]:null)&&vr(b))}function vr(p){if(typeof p!="number"&&p&&!p.da){var x=p.src;if(x&&x[Ee])dt(x.i,p);else{var b=p.type,C=p.proxy;x.removeEventListener?x.removeEventListener(b,C,p.capture):x.detachEvent?x.detachEvent(Pn(b),C):x.addListener&&x.removeListener&&x.removeListener(C),(b=wr(x))?(dt(b,p),b.h==0&&(b.src=null,x[it]=null)):W(p)}}}function Pn(p){return p in $e?$e[p]:$e[p]="on"+p}function tr(p,x){if(p.da)p=!0;else{x=new pe(x,this);const b=p.listener,C=p.ha||p.src;p.fa&&vr(p),p=b.call(C,x)}return p}function wr(p){return p=p[it],p instanceof we?p:null}var xr="__closure_events_fn_"+(Math.random()*1e9>>>0);function q(p){return typeof p=="function"?p:(p[xr]||(p[xr]=function(x){return p.handleEvent(x)}),p[xr])}function xe(){I.call(this),this.i=new we(this),this.M=this,this.G=null}h(xe,I),xe.prototype[Ee]=!0,xe.prototype.removeEventListener=function(p,x,b,C){$r(this,p,x,b,C)};function Me(p,x){var b,C=p.G;if(C)for(b=[];C;C=C.G)b.push(C);if(p=p.M,C=x.type||x,typeof x=="string")x=new M(x,p);else if(x instanceof M)x.target=x.target||p;else{var j=x;x=new M(C,p),he(x,j)}j=!0;let F,te;if(b)for(te=b.length-1;te>=0;te--)F=x.g=b[te],j=St(F,C,!0,x)&&j;if(F=x.g=p,j=St(F,C,!0,x)&&j,j=St(F,C,!1,x)&&j,b)for(te=0;te<b.length;te++)F=x.g=b[te],j=St(F,C,!1,x)&&j}xe.prototype.N=function(){if(xe.Z.N.call(this),this.i){var p=this.i;for(const x in p.g){const b=p.g[x];for(let C=0;C<b.length;C++)W(b[C]);delete p.g[x],p.h--}}this.G=null},xe.prototype.J=function(p,x,b,C){return this.i.add(String(p),x,!1,b,C)},xe.prototype.K=function(p,x,b,C){return this.i.add(String(p),x,!0,b,C)};function St(p,x,b,C){if(x=p.i.g[String(x)],!x)return!0;x=x.concat();let j=!0;for(let F=0;F<x.length;++F){const te=x[F];if(te&&!te.da&&te.capture==b){const Ae=te.listener,$t=te.ha||te.src;te.fa&&dt(p.i,te),j=Ae.call($t,C)!==!1&&j}}return j&&!C.defaultPrevented}function K(p,x){if(typeof p!="function")if(p&&typeof p.handleEvent=="function")p=c(p.handleEvent,p);else throw Error("Invalid listener argument");return Number(x)>2147483647?-1:o.setTimeout(p,x||0)}function X(p){p.g=K(()=>{p.g=null,p.i&&(p.i=!1,X(p))},p.l);const x=p.h;p.h=null,p.m.apply(null,x)}class ie extends I{constructor(x,b){super(),this.m=x,this.l=b,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:X(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ge(p){I.call(this),this.h=p,this.g={}}h(ge,I);var se=[];function Ye(p){V(p.g,function(x,b){this.g.hasOwnProperty(b)&&vr(x)},p),p.g={}}ge.prototype.N=function(){ge.Z.N.call(this),Ye(this)},ge.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ve=o.JSON.stringify,Jt=o.JSON.parse,$=class{stringify(p){return o.JSON.stringify(p,void 0)}parse(p){return o.JSON.parse(p,void 0)}};function Ce(){}function Re(){}var He={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Yt(){M.call(this,"d")}h(Yt,M);function Un(){M.call(this,"c")}h(Un,M);var Mn={},xi=null;function as(){return xi=xi||new xe}Mn.Ia="serverreachability";function Ur(p){M.call(this,Mn.Ia,p)}h(Ur,M);function ls(p){const x=as();Me(x,new Ur(x))}Mn.STAT_EVENT="statevent";function H(p,x){M.call(this,Mn.STAT_EVENT,p),this.stat=x}h(H,M);function Q(p){const x=as();Me(x,new H(x,p))}Mn.Ja="timingevent";function _e(p,x){M.call(this,Mn.Ja,p),this.size=x}h(_e,M);function Mt(p,x){if(typeof p!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){p()},x)}function nr(){this.g=!0}nr.prototype.ua=function(){this.g=!1};function lV(p,x,b,C,j,F){p.info(function(){if(p.g)if(F){var te="",Ae=F.split("&");for(let Xe=0;Xe<Ae.length;Xe++){var $t=Ae[Xe].split("=");if($t.length>1){const Xt=$t[0];$t=$t[1];const us=Xt.split("_");te=us.length>=2&&us[1]=="type"?te+(Xt+"="+$t+"&"):te+(Xt+"=redacted&")}}}else te=null;else te=F;return"XMLHTTP REQ ("+C+") [attempt "+j+"]: "+x+`
`+b+`
`+te})}function cV(p,x,b,C,j,F,te){p.info(function(){return"XMLHTTP RESP ("+C+") [ attempt "+j+"]: "+x+`
`+b+`
`+F+" "+te})}function ul(p,x,b,C){p.info(function(){return"XMLHTTP TEXT ("+x+"): "+hV(p,b)+(C?" "+C:"")})}function uV(p,x){p.info(function(){return"TIMEOUT: "+x})}nr.prototype.info=function(){};function hV(p,x){if(!p.g)return x;if(!x)return null;try{const F=JSON.parse(x);if(F){for(p=0;p<F.length;p++)if(Array.isArray(F[p])){var b=F[p];if(!(b.length<2)){var C=b[1];if(Array.isArray(C)&&!(C.length<1)){var j=C[0];if(j!="noop"&&j!="stop"&&j!="close")for(let te=1;te<C.length;te++)C[te]=""}}}}return Ve(F)}catch{return x}}var Jd={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},sE={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},iE;function qy(){}h(qy,Ce),qy.prototype.g=function(){return new XMLHttpRequest},iE=new qy;function tu(p){return encodeURIComponent(String(p))}function dV(p){var x=1;p=p.split(":");const b=[];for(;x>0&&p.length;)b.push(p.shift()),x--;return p.length&&b.push(p.join(":")),b}function _i(p,x,b,C){this.j=p,this.i=x,this.l=b,this.S=C||1,this.V=new ge(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new oE}function oE(){this.i=null,this.g="",this.h=!1}var aE={},Ky={};function Gy(p,x,b){p.M=1,p.A=Xd(cs(x)),p.u=b,p.R=!0,lE(p,null)}function lE(p,x){p.F=Date.now(),Yd(p),p.B=cs(p.A);var b=p.B,C=p.S;Array.isArray(C)||(C=[String(C)]),_E(b.i,"t",C),p.C=0,b=p.j.L,p.h=new oE,p.g=FE(p.j,b?x:null,!p.u),p.P>0&&(p.O=new ie(c(p.Y,p,p.g),p.P)),x=p.V,b=p.g,C=p.ba;var j="readystatechange";Array.isArray(j)||(j&&(se[0]=j.toString()),j=se);for(let F=0;F<j.length;F++){const te=ae(b,j[F],C||x.handleEvent,!1,x.h||x);if(!te)break;x.g[te.key]=te}x=p.J?ce(p.J):{},p.u?(p.v||(p.v="POST"),x["Content-Type"]="application/x-www-form-urlencoded",p.g.ea(p.B,p.v,p.u,x)):(p.v="GET",p.g.ea(p.B,p.v,null,x)),ls(),lV(p.i,p.v,p.B,p.l,p.S,p.u)}_i.prototype.ba=function(p){p=p.target;const x=this.O;x&&Ei(p)==3?x.j():this.Y(p)},_i.prototype.Y=function(p){try{if(p==this.g)e:{const Ae=Ei(this.g),$t=this.g.ya(),Xe=this.g.ca();if(!(Ae<3)&&(Ae!=3||this.g&&(this.h.h||this.g.la()||IE(this.g)))){this.K||Ae!=4||$t==7||($t==8||Xe<=0?ls(3):ls(2)),Qy(this);var x=this.g.ca();this.X=x;var b=fV(this);if(this.o=x==200,cV(this.i,this.v,this.B,this.l,this.S,Ae,x),this.o){if(this.U&&!this.L){t:{if(this.g){var C,j=this.g;if((C=j.g?j.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!P(C)){var F=C;break t}}F=null}if(p=F)ul(this.i,this.l,p,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Jy(this,p);else{this.o=!1,this.m=3,Q(12),$o(this),nu(this);break e}}if(this.R){p=!0;let Xt;for(;!this.K&&this.C<b.length;)if(Xt=pV(this,b),Xt==Ky){Ae==4&&(this.m=4,Q(14),p=!1),ul(this.i,this.l,null,"[Incomplete Response]");break}else if(Xt==aE){this.m=4,Q(15),ul(this.i,this.l,b,"[Invalid Chunk]"),p=!1;break}else ul(this.i,this.l,Xt,null),Jy(this,Xt);if(cE(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ae!=4||b.length!=0||this.h.h||(this.m=1,Q(16),p=!1),this.o=this.o&&p,!p)ul(this.i,this.l,b,"[Invalid Chunked Response]"),$o(this),nu(this);else if(b.length>0&&!this.W){this.W=!0;var te=this.j;te.g==this&&te.aa&&!te.P&&(te.j.info("Great, no buffering proxy detected. Bytes received: "+b.length),sv(te),te.P=!0,Q(11))}}else ul(this.i,this.l,b,null),Jy(this,b);Ae==4&&$o(this),this.o&&!this.K&&(Ae==4?DE(this.j,this):(this.o=!1,Yd(this)))}else IV(this.g),x==400&&b.indexOf("Unknown SID")>0?(this.m=3,Q(12)):(this.m=0,Q(13)),$o(this),nu(this)}}}catch{}finally{}};function fV(p){if(!cE(p))return p.g.la();const x=IE(p.g);if(x==="")return"";let b="";const C=x.length,j=Ei(p.g)==4;if(!p.h.i){if(typeof TextDecoder>"u")return $o(p),nu(p),"";p.h.i=new o.TextDecoder}for(let F=0;F<C;F++)p.h.h=!0,b+=p.h.i.decode(x[F],{stream:!(j&&F==C-1)});return x.length=0,p.h.g+=b,p.C=0,p.h.g}function cE(p){return p.g?p.v=="GET"&&p.M!=2&&p.j.Aa:!1}function pV(p,x){var b=p.C,C=x.indexOf(`
`,b);return C==-1?Ky:(b=Number(x.substring(b,C)),isNaN(b)?aE:(C+=1,C+b>x.length?Ky:(x=x.slice(C,C+b),p.C=C+b,x)))}_i.prototype.cancel=function(){this.K=!0,$o(this)};function Yd(p){p.T=Date.now()+p.H,uE(p,p.H)}function uE(p,x){if(p.D!=null)throw Error("WatchDog timer not null");p.D=Mt(c(p.aa,p),x)}function Qy(p){p.D&&(o.clearTimeout(p.D),p.D=null)}_i.prototype.aa=function(){this.D=null;const p=Date.now();p-this.T>=0?(uV(this.i,this.B),this.M!=2&&(ls(),Q(17)),$o(this),this.m=2,nu(this)):uE(this,this.T-p)};function nu(p){p.j.I==0||p.K||DE(p.j,p)}function $o(p){Qy(p);var x=p.O;x&&typeof x.dispose=="function"&&x.dispose(),p.O=null,Ye(p.V),p.g&&(x=p.g,p.g=null,x.abort(),x.dispose())}function Jy(p,x){try{var b=p.j;if(b.I!=0&&(b.g==p||Yy(b.h,p))){if(!p.L&&Yy(b.h,p)&&b.I==3){try{var C=b.Ba.g.parse(x)}catch{C=null}if(Array.isArray(C)&&C.length==3){var j=C;if(j[0]==0){e:if(!b.v){if(b.g)if(b.g.F+3e3<p.F)rf(b),tf(b);else break e;rv(b),Q(18)}}else b.xa=j[1],0<b.xa-b.K&&j[2]<37500&&b.F&&b.A==0&&!b.C&&(b.C=Mt(c(b.Va,b),6e3));fE(b.h)<=1&&b.ta&&(b.ta=void 0)}else Ho(b,11)}else if((p.L||b.g==p)&&rf(b),!P(x))for(j=b.Ba.g.parse(x),x=0;x<j.length;x++){let Xe=j[x];const Xt=Xe[0];if(!(Xt<=b.K))if(b.K=Xt,Xe=Xe[1],b.I==2)if(Xe[0]=="c"){b.M=Xe[1],b.ba=Xe[2];const us=Xe[3];us!=null&&(b.ka=us,b.j.info("VER="+b.ka));const Wo=Xe[4];Wo!=null&&(b.za=Wo,b.j.info("SVER="+b.za));const Si=Xe[5];Si!=null&&typeof Si=="number"&&Si>0&&(C=1.5*Si,b.O=C,b.j.info("backChannelRequestTimeoutMs_="+C)),C=b;const ki=p.g;if(ki){const of=ki.g?ki.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(of){var F=C.h;F.g||of.indexOf("spdy")==-1&&of.indexOf("quic")==-1&&of.indexOf("h2")==-1||(F.j=F.l,F.g=new Set,F.h&&(Xy(F,F.h),F.h=null))}if(C.G){const iv=ki.g?ki.g.getResponseHeader("X-HTTP-Session-Id"):null;iv&&(C.wa=iv,ot(C.J,C.G,iv))}}b.I=3,b.l&&b.l.ra(),b.aa&&(b.T=Date.now()-p.F,b.j.info("Handshake RTT: "+b.T+"ms")),C=b;var te=p;if(C.na=VE(C,C.L?C.ba:null,C.W),te.L){pE(C.h,te);var Ae=te,$t=C.O;$t&&(Ae.H=$t),Ae.D&&(Qy(Ae),Yd(Ae)),C.g=te}else ME(C);b.i.length>0&&nf(b)}else Xe[0]!="stop"&&Xe[0]!="close"||Ho(b,7);else b.I==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?Ho(b,7):nv(b):Xe[0]!="noop"&&b.l&&b.l.qa(Xe),b.A=0)}}ls(4)}catch{}}var mV=class{constructor(p,x){this.g=p,this.map=x}};function hE(p){this.l=p||10,o.PerformanceNavigationTiming?(p=o.performance.getEntriesByType("navigation"),p=p.length>0&&(p[0].nextHopProtocol=="hq"||p[0].nextHopProtocol=="h2")):p=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=p?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function dE(p){return p.h?!0:p.g?p.g.size>=p.j:!1}function fE(p){return p.h?1:p.g?p.g.size:0}function Yy(p,x){return p.h?p.h==x:p.g?p.g.has(x):!1}function Xy(p,x){p.g?p.g.add(x):p.h=x}function pE(p,x){p.h&&p.h==x?p.h=null:p.g&&p.g.has(x)&&p.g.delete(x)}hE.prototype.cancel=function(){if(this.i=mE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const p of this.g.values())p.cancel();this.g.clear()}};function mE(p){if(p.h!=null)return p.i.concat(p.h.G);if(p.g!=null&&p.g.size!==0){let x=p.i;for(const b of p.g.values())x=x.concat(b.G);return x}return m(p.i)}var gE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function gV(p,x){if(p){p=p.split("&");for(let b=0;b<p.length;b++){const C=p[b].indexOf("=");let j,F=null;C>=0?(j=p[b].substring(0,C),F=p[b].substring(C+1)):j=p[b],x(j,F?decodeURIComponent(F.replace(/\+/g," ")):"")}}}function bi(p){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let x;p instanceof bi?(this.l=p.l,ru(this,p.j),this.o=p.o,this.g=p.g,su(this,p.u),this.h=p.h,Zy(this,bE(p.i)),this.m=p.m):p&&(x=String(p).match(gE))?(this.l=!1,ru(this,x[1]||"",!0),this.o=iu(x[2]||""),this.g=iu(x[3]||"",!0),su(this,x[4]),this.h=iu(x[5]||"",!0),Zy(this,x[6]||"",!0),this.m=iu(x[7]||"")):(this.l=!1,this.i=new au(null,this.l))}bi.prototype.toString=function(){const p=[];var x=this.j;x&&p.push(ou(x,yE,!0),":");var b=this.g;return(b||x=="file")&&(p.push("//"),(x=this.o)&&p.push(ou(x,yE,!0),"@"),p.push(tu(b).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.u,b!=null&&p.push(":",String(b))),(b=this.h)&&(this.g&&b.charAt(0)!="/"&&p.push("/"),p.push(ou(b,b.charAt(0)=="/"?wV:vV,!0))),(b=this.i.toString())&&p.push("?",b),(b=this.m)&&p.push("#",ou(b,_V)),p.join("")},bi.prototype.resolve=function(p){const x=cs(this);let b=!!p.j;b?ru(x,p.j):b=!!p.o,b?x.o=p.o:b=!!p.g,b?x.g=p.g:b=p.u!=null;var C=p.h;if(b)su(x,p.u);else if(b=!!p.h){if(C.charAt(0)!="/")if(this.g&&!this.h)C="/"+C;else{var j=x.h.lastIndexOf("/");j!=-1&&(C=x.h.slice(0,j+1)+C)}if(j=C,j==".."||j==".")C="";else if(j.indexOf("./")!=-1||j.indexOf("/.")!=-1){C=j.lastIndexOf("/",0)==0,j=j.split("/");const F=[];for(let te=0;te<j.length;){const Ae=j[te++];Ae=="."?C&&te==j.length&&F.push(""):Ae==".."?((F.length>1||F.length==1&&F[0]!="")&&F.pop(),C&&te==j.length&&F.push("")):(F.push(Ae),C=!0)}C=F.join("/")}else C=j}return b?x.h=C:b=p.i.toString()!=="",b?Zy(x,bE(p.i)):b=!!p.m,b&&(x.m=p.m),x};function cs(p){return new bi(p)}function ru(p,x,b){p.j=b?iu(x,!0):x,p.j&&(p.j=p.j.replace(/:$/,""))}function su(p,x){if(x){if(x=Number(x),isNaN(x)||x<0)throw Error("Bad port number "+x);p.u=x}else p.u=null}function Zy(p,x,b){x instanceof au?(p.i=x,bV(p.i,p.l)):(b||(x=ou(x,xV)),p.i=new au(x,p.l))}function ot(p,x,b){p.i.set(x,b)}function Xd(p){return ot(p,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),p}function iu(p,x){return p?x?decodeURI(p.replace(/%25/g,"%2525")):decodeURIComponent(p):""}function ou(p,x,b){return typeof p=="string"?(p=encodeURI(p).replace(x,yV),b&&(p=p.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),p):null}function yV(p){return p=p.charCodeAt(0),"%"+(p>>4&15).toString(16)+(p&15).toString(16)}var yE=/[#\/\?@]/g,vV=/[#\?:]/g,wV=/[#\?]/g,xV=/[#\?@]/g,_V=/#/g;function au(p,x){this.h=this.g=null,this.i=p||null,this.j=!!x}function Uo(p){p.g||(p.g=new Map,p.h=0,p.i&&gV(p.i,function(x,b){p.add(decodeURIComponent(x.replace(/\+/g," ")),b)}))}t=au.prototype,t.add=function(p,x){Uo(this),this.i=null,p=hl(this,p);let b=this.g.get(p);return b||this.g.set(p,b=[]),b.push(x),this.h+=1,this};function vE(p,x){Uo(p),x=hl(p,x),p.g.has(x)&&(p.i=null,p.h-=p.g.get(x).length,p.g.delete(x))}function wE(p,x){return Uo(p),x=hl(p,x),p.g.has(x)}t.forEach=function(p,x){Uo(this),this.g.forEach(function(b,C){b.forEach(function(j){p.call(x,j,C,this)},this)},this)};function xE(p,x){Uo(p);let b=[];if(typeof x=="string")wE(p,x)&&(b=b.concat(p.g.get(hl(p,x))));else for(p=Array.from(p.g.values()),x=0;x<p.length;x++)b=b.concat(p[x]);return b}t.set=function(p,x){return Uo(this),this.i=null,p=hl(this,p),wE(this,p)&&(this.h-=this.g.get(p).length),this.g.set(p,[x]),this.h+=1,this},t.get=function(p,x){return p?(p=xE(this,p),p.length>0?String(p[0]):x):x};function _E(p,x,b){vE(p,x),b.length>0&&(p.i=null,p.g.set(hl(p,x),m(b)),p.h+=b.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const p=[],x=Array.from(this.g.keys());for(let C=0;C<x.length;C++){var b=x[C];const j=tu(b);b=xE(this,b);for(let F=0;F<b.length;F++){let te=j;b[F]!==""&&(te+="="+tu(b[F])),p.push(te)}}return this.i=p.join("&")};function bE(p){const x=new au;return x.i=p.i,p.g&&(x.g=new Map(p.g),x.h=p.h),x}function hl(p,x){return x=String(x),p.j&&(x=x.toLowerCase()),x}function bV(p,x){x&&!p.j&&(Uo(p),p.i=null,p.g.forEach(function(b,C){const j=C.toLowerCase();C!=j&&(vE(this,C),_E(this,j,b))},p)),p.j=x}function TV(p,x){const b=new nr;if(o.Image){const C=new Image;C.onload=u(Ti,b,"TestLoadImage: loaded",!0,x,C),C.onerror=u(Ti,b,"TestLoadImage: error",!1,x,C),C.onabort=u(Ti,b,"TestLoadImage: abort",!1,x,C),C.ontimeout=u(Ti,b,"TestLoadImage: timeout",!1,x,C),o.setTimeout(function(){C.ontimeout&&C.ontimeout()},1e4),C.src=p}else x(!1)}function EV(p,x){const b=new nr,C=new AbortController,j=setTimeout(()=>{C.abort(),Ti(b,"TestPingServer: timeout",!1,x)},1e4);fetch(p,{signal:C.signal}).then(F=>{clearTimeout(j),F.ok?Ti(b,"TestPingServer: ok",!0,x):Ti(b,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(j),Ti(b,"TestPingServer: error",!1,x)})}function Ti(p,x,b,C,j){try{j&&(j.onload=null,j.onerror=null,j.onabort=null,j.ontimeout=null),C(b)}catch{}}function SV(){this.g=new $}function ev(p){this.i=p.Sb||null,this.h=p.ab||!1}h(ev,Ce),ev.prototype.g=function(){return new Zd(this.i,this.h)};function Zd(p,x){xe.call(this),this.H=p,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(Zd,xe),t=Zd.prototype,t.open=function(p,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=p,this.D=x,this.readyState=1,cu(this)},t.send=function(p){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const x={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};p&&(x.body=p),(this.H||o).fetch(new Request(this.D,x)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,lu(this)),this.readyState=0},t.Pa=function(p){if(this.g&&(this.l=p,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=p.headers,this.readyState=2,cu(this)),this.g&&(this.readyState=3,cu(this),this.g)))if(this.responseType==="arraybuffer")p.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in p){if(this.j=p.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;TE(this)}else p.text().then(this.Oa.bind(this),this.ga.bind(this))};function TE(p){p.j.read().then(p.Ma.bind(p)).catch(p.ga.bind(p))}t.Ma=function(p){if(this.g){if(this.o&&p.value)this.response.push(p.value);else if(!this.o){var x=p.value?p.value:new Uint8Array(0);(x=this.B.decode(x,{stream:!p.done}))&&(this.response=this.responseText+=x)}p.done?lu(this):cu(this),this.readyState==3&&TE(this)}},t.Oa=function(p){this.g&&(this.response=this.responseText=p,lu(this))},t.Na=function(p){this.g&&(this.response=p,lu(this))},t.ga=function(){this.g&&lu(this)};function lu(p){p.readyState=4,p.l=null,p.j=null,p.B=null,cu(p)}t.setRequestHeader=function(p,x){this.A.append(p,x)},t.getResponseHeader=function(p){return this.h&&this.h.get(p.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const p=[],x=this.h.entries();for(var b=x.next();!b.done;)b=b.value,p.push(b[0]+": "+b[1]),b=x.next();return p.join(`\r
`)};function cu(p){p.onreadystatechange&&p.onreadystatechange.call(p)}Object.defineProperty(Zd.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(p){this.m=p?"include":"same-origin"}});function EE(p){let x="";return V(p,function(b,C){x+=C,x+=":",x+=b,x+=`\r
`}),x}function tv(p,x,b){e:{for(C in b){var C=!1;break e}C=!0}C||(b=EE(b),typeof p=="string"?b!=null&&tu(b):ot(p,x,b))}function kt(p){xe.call(this),this.headers=new Map,this.L=p||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(kt,xe);var kV=/^https?$/i,CV=["POST","PUT"];t=kt.prototype,t.Fa=function(p){this.H=p},t.ea=function(p,x,b,C){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+p);x=x?x.toUpperCase():"GET",this.D=p,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():iE.g(),this.g.onreadystatechange=f(c(this.Ca,this));try{this.B=!0,this.g.open(x,String(p),!0),this.B=!1}catch(F){SE(this,F);return}if(p=b||"",b=new Map(this.headers),C)if(Object.getPrototypeOf(C)===Object.prototype)for(var j in C)b.set(j,C[j]);else if(typeof C.keys=="function"&&typeof C.get=="function")for(const F of C.keys())b.set(F,C.get(F));else throw Error("Unknown input type for opt_headers: "+String(C));C=Array.from(b.keys()).find(F=>F.toLowerCase()=="content-type"),j=o.FormData&&p instanceof o.FormData,!(Array.prototype.indexOf.call(CV,x,void 0)>=0)||C||j||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[F,te]of b)this.g.setRequestHeader(F,te);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(p),this.v=!1}catch(F){SE(this,F)}};function SE(p,x){p.h=!1,p.g&&(p.j=!0,p.g.abort(),p.j=!1),p.l=x,p.o=5,kE(p),ef(p)}function kE(p){p.A||(p.A=!0,Me(p,"complete"),Me(p,"error"))}t.abort=function(p){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=p||7,Me(this,"complete"),Me(this,"abort"),ef(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ef(this,!0)),kt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?CE(this):this.Xa())},t.Xa=function(){CE(this)};function CE(p){if(p.h&&typeof i<"u"){if(p.v&&Ei(p)==4)setTimeout(p.Ca.bind(p),0);else if(Me(p,"readystatechange"),Ei(p)==4){p.h=!1;try{const F=p.ca();e:switch(F){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var b;if(!(b=x)){var C;if(C=F===0){let te=String(p.D).match(gE)[1]||null;!te&&o.self&&o.self.location&&(te=o.self.location.protocol.slice(0,-1)),C=!kV.test(te?te.toLowerCase():"")}b=C}if(b)Me(p,"complete"),Me(p,"success");else{p.o=6;try{var j=Ei(p)>2?p.g.statusText:""}catch{j=""}p.l=j+" ["+p.ca()+"]",kE(p)}}finally{ef(p)}}}}function ef(p,x){if(p.g){p.m&&(clearTimeout(p.m),p.m=null);const b=p.g;p.g=null,x||Me(p,"ready");try{b.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Ei(p){return p.g?p.g.readyState:0}t.ca=function(){try{return Ei(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(p){if(this.g){var x=this.g.responseText;return p&&x.indexOf(p)==0&&(x=x.substring(p.length)),Jt(x)}};function IE(p){try{if(!p.g)return null;if("response"in p.g)return p.g.response;switch(p.F){case"":case"text":return p.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in p.g)return p.g.mozResponseArrayBuffer}return null}catch{return null}}function IV(p){const x={};p=(p.g&&Ei(p)>=2&&p.g.getAllResponseHeaders()||"").split(`\r
`);for(let C=0;C<p.length;C++){if(P(p[C]))continue;var b=dV(p[C]);const j=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const F=x[j]||[];x[j]=F,F.push(b)}Z(x,function(C){return C.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function uu(p,x,b){return b&&b.internalChannelParams&&b.internalChannelParams[p]||x}function AE(p){this.za=0,this.i=[],this.j=new nr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=uu("failFast",!1,p),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=uu("baseRetryDelayMs",5e3,p),this.Za=uu("retryDelaySeedMs",1e4,p),this.Ta=uu("forwardChannelMaxRetries",2,p),this.va=uu("forwardChannelRequestTimeoutMs",2e4,p),this.ma=p&&p.xmlHttpFactory||void 0,this.Ua=p&&p.Rb||void 0,this.Aa=p&&p.useFetchStreams||!1,this.O=void 0,this.L=p&&p.supportsCrossDomainXhr||!1,this.M="",this.h=new hE(p&&p.concurrentRequestLimit),this.Ba=new SV,this.S=p&&p.fastHandshake||!1,this.R=p&&p.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=p&&p.Pb||!1,p&&p.ua&&this.j.ua(),p&&p.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&p&&p.detectBufferingProxy||!1,this.ia=void 0,p&&p.longPollingTimeout&&p.longPollingTimeout>0&&(this.ia=p.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=AE.prototype,t.ka=8,t.I=1,t.connect=function(p,x,b,C){Q(0),this.W=p,this.H=x||{},b&&C!==void 0&&(this.H.OSID=b,this.H.OAID=C),this.F=this.X,this.J=VE(this,null,this.W),nf(this)};function nv(p){if(NE(p),p.I==3){var x=p.V++,b=cs(p.J);if(ot(b,"SID",p.M),ot(b,"RID",x),ot(b,"TYPE","terminate"),hu(p,b),x=new _i(p,p.j,x),x.M=2,x.A=Xd(cs(b)),b=!1,o.navigator&&o.navigator.sendBeacon)try{b=o.navigator.sendBeacon(x.A.toString(),"")}catch{}!b&&o.Image&&(new Image().src=x.A,b=!0),b||(x.g=FE(x.j,null),x.g.ea(x.A)),x.F=Date.now(),Yd(x)}jE(p)}function tf(p){p.g&&(sv(p),p.g.cancel(),p.g=null)}function NE(p){tf(p),p.v&&(o.clearTimeout(p.v),p.v=null),rf(p),p.h.cancel(),p.m&&(typeof p.m=="number"&&o.clearTimeout(p.m),p.m=null)}function nf(p){if(!dE(p.h)&&!p.m){p.m=!0;var x=p.Ea;R||T(),O||(R(),O=!0),S.add(x,p),p.D=0}}function AV(p,x){return fE(p.h)>=p.h.j-(p.m?1:0)?!1:p.m?(p.i=x.G.concat(p.i),!0):p.I==1||p.I==2||p.D>=(p.Sa?0:p.Ta)?!1:(p.m=Mt(c(p.Ea,p,x),LE(p,p.D)),p.D++,!0)}t.Ea=function(p){if(this.m)if(this.m=null,this.I==1){if(!p){this.V=Math.floor(Math.random()*1e5),p=this.V++;const j=new _i(this,this.j,p);let F=this.o;if(this.U&&(F?(F=ce(F),he(F,this.U)):F=this.U),this.u!==null||this.R||(j.J=F,F=null),this.S)e:{for(var x=0,b=0;b<this.i.length;b++){t:{var C=this.i[b];if("__data__"in C.map&&(C=C.map.__data__,typeof C=="string")){C=C.length;break t}C=void 0}if(C===void 0)break;if(x+=C,x>4096){x=b;break e}if(x===4096||b===this.i.length-1){x=b+1;break e}}x=1e3}else x=1e3;x=PE(this,j,x),b=cs(this.J),ot(b,"RID",p),ot(b,"CVER",22),this.G&&ot(b,"X-HTTP-Session-Id",this.G),hu(this,b),F&&(this.R?x="headers="+tu(EE(F))+"&"+x:this.u&&tv(b,this.u,F)),Xy(this.h,j),this.Ra&&ot(b,"TYPE","init"),this.S?(ot(b,"$req",x),ot(b,"SID","null"),j.U=!0,Gy(j,b,null)):Gy(j,b,x),this.I=2}}else this.I==3&&(p?RE(this,p):this.i.length==0||dE(this.h)||RE(this))};function RE(p,x){var b;x?b=x.l:b=p.V++;const C=cs(p.J);ot(C,"SID",p.M),ot(C,"RID",b),ot(C,"AID",p.K),hu(p,C),p.u&&p.o&&tv(C,p.u,p.o),b=new _i(p,p.j,b,p.D+1),p.u===null&&(b.J=p.o),x&&(p.i=x.G.concat(p.i)),x=PE(p,b,1e3),b.H=Math.round(p.va*.5)+Math.round(p.va*.5*Math.random()),Xy(p.h,b),Gy(b,C,x)}function hu(p,x){p.H&&V(p.H,function(b,C){ot(x,C,b)}),p.l&&V({},function(b,C){ot(x,C,b)})}function PE(p,x,b){b=Math.min(p.i.length,b);const C=p.l?c(p.l.Ka,p.l,p):null;e:{var j=p.i;let Ae=-1;for(;;){const $t=["count="+b];Ae==-1?b>0?(Ae=j[0].g,$t.push("ofs="+Ae)):Ae=0:$t.push("ofs="+Ae);let Xe=!0;for(let Xt=0;Xt<b;Xt++){var F=j[Xt].g;const us=j[Xt].map;if(F-=Ae,F<0)Ae=Math.max(0,j[Xt].g-100),Xe=!1;else try{F="req"+F+"_"||"";try{var te=us instanceof Map?us:Object.entries(us);for(const[Wo,Si]of te){let ki=Si;a(Si)&&(ki=Ve(Si)),$t.push(F+Wo+"="+encodeURIComponent(ki))}}catch(Wo){throw $t.push(F+"type="+encodeURIComponent("_badmap")),Wo}}catch{C&&C(us)}}if(Xe){te=$t.join("&");break e}}te=void 0}return p=p.i.splice(0,b),x.G=p,te}function ME(p){if(!p.g&&!p.v){p.Y=1;var x=p.Da;R||T(),O||(R(),O=!0),S.add(x,p),p.A=0}}function rv(p){return p.g||p.v||p.A>=3?!1:(p.Y++,p.v=Mt(c(p.Da,p),LE(p,p.A)),p.A++,!0)}t.Da=function(){if(this.v=null,OE(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var p=4*this.T;this.j.info("BP detection timer enabled: "+p),this.B=Mt(c(this.Wa,this),p)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Q(10),tf(this),OE(this))};function sv(p){p.B!=null&&(o.clearTimeout(p.B),p.B=null)}function OE(p){p.g=new _i(p,p.j,"rpc",p.Y),p.u===null&&(p.g.J=p.o),p.g.P=0;var x=cs(p.na);ot(x,"RID","rpc"),ot(x,"SID",p.M),ot(x,"AID",p.K),ot(x,"CI",p.F?"0":"1"),!p.F&&p.ia&&ot(x,"TO",p.ia),ot(x,"TYPE","xmlhttp"),hu(p,x),p.u&&p.o&&tv(x,p.u,p.o),p.O&&(p.g.H=p.O);var b=p.g;p=p.ba,b.M=1,b.A=Xd(cs(x)),b.u=null,b.R=!0,lE(b,p)}t.Va=function(){this.C!=null&&(this.C=null,tf(this),rv(this),Q(19))};function rf(p){p.C!=null&&(o.clearTimeout(p.C),p.C=null)}function DE(p,x){var b=null;if(p.g==x){rf(p),sv(p),p.g=null;var C=2}else if(Yy(p.h,x))b=x.G,pE(p.h,x),C=1;else return;if(p.I!=0){if(x.o)if(C==1){b=x.u?x.u.length:0,x=Date.now()-x.F;var j=p.D;C=as(),Me(C,new _e(C,b)),nf(p)}else ME(p);else if(j=x.m,j==3||j==0&&x.X>0||!(C==1&&AV(p,x)||C==2&&rv(p)))switch(b&&b.length>0&&(x=p.h,x.i=x.i.concat(b)),j){case 1:Ho(p,5);break;case 4:Ho(p,10);break;case 3:Ho(p,6);break;default:Ho(p,2)}}}function LE(p,x){let b=p.Qa+Math.floor(Math.random()*p.Za);return p.isActive()||(b*=2),b*x}function Ho(p,x){if(p.j.info("Error code "+x),x==2){var b=c(p.bb,p),C=p.Ua;const j=!C;C=new bi(C||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||ru(C,"https"),Xd(C),j?TV(C.toString(),b):EV(C.toString(),b)}else Q(2);p.I=0,p.l&&p.l.pa(x),jE(p),NE(p)}t.bb=function(p){p?(this.j.info("Successfully pinged google.com"),Q(2)):(this.j.info("Failed to ping google.com"),Q(1))};function jE(p){if(p.I=0,p.ja=[],p.l){const x=mE(p.h);(x.length!=0||p.i.length!=0)&&(g(p.ja,x),g(p.ja,p.i),p.h.i.length=0,m(p.i),p.i.length=0),p.l.oa()}}function VE(p,x,b){var C=b instanceof bi?cs(b):new bi(b);if(C.g!="")x&&(C.g=x+"."+C.g),su(C,C.u);else{var j=o.location;C=j.protocol,x=x?x+"."+j.hostname:j.hostname,j=+j.port;const F=new bi(null);C&&ru(F,C),x&&(F.g=x),j&&su(F,j),b&&(F.h=b),C=F}return b=p.G,x=p.wa,b&&x&&ot(C,b,x),ot(C,"VER",p.ka),hu(p,C),C}function FE(p,x,b){if(x&&!p.L)throw Error("Can't create secondary domain capable XhrIo object.");return x=p.Aa&&!p.ma?new kt(new ev({ab:b})):new kt(p.ma),x.Fa(p.L),x}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function BE(){}t=BE.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function sf(){}sf.prototype.g=function(p,x){return new rr(p,x)};function rr(p,x){xe.call(this),this.g=new AE(x),this.l=p,this.h=x&&x.messageUrlParams||null,p=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(p?p["X-Client-Protocol"]="webchannel":p={"X-Client-Protocol":"webchannel"}),this.g.o=p,p=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(p?p["X-WebChannel-Content-Type"]=x.messageContentType:p={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.sa&&(p?p["X-WebChannel-Client-Profile"]=x.sa:p={"X-WebChannel-Client-Profile":x.sa}),this.g.U=p,(p=x&&x.Qb)&&!P(p)&&(this.g.u=p),this.A=x&&x.supportsCrossDomainXhr||!1,this.v=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!P(x)&&(this.g.G=x,p=this.h,p!==null&&x in p&&(p=this.h,x in p&&delete p[x])),this.j=new dl(this)}h(rr,xe),rr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},rr.prototype.close=function(){nv(this.g)},rr.prototype.o=function(p){var x=this.g;if(typeof p=="string"){var b={};b.__data__=p,p=b}else this.v&&(b={},b.__data__=Ve(p),p=b);x.i.push(new mV(x.Ya++,p)),x.I==3&&nf(x)},rr.prototype.N=function(){this.g.l=null,delete this.j,nv(this.g),delete this.g,rr.Z.N.call(this)};function zE(p){Yt.call(this),p.__headers__&&(this.headers=p.__headers__,this.statusCode=p.__status__,delete p.__headers__,delete p.__status__);var x=p.__sm__;if(x){e:{for(const b in x){p=b;break e}p=void 0}(this.i=p)&&(p=this.i,x=x!==null&&p in x?x[p]:void 0),this.data=x}else this.data=p}h(zE,Yt);function $E(){Un.call(this),this.status=1}h($E,Un);function dl(p){this.g=p}h(dl,BE),dl.prototype.ra=function(){Me(this.g,"a")},dl.prototype.qa=function(p){Me(this.g,new zE(p))},dl.prototype.pa=function(p){Me(this.g,new $E)},dl.prototype.oa=function(){Me(this.g,"b")},sf.prototype.createWebChannel=sf.prototype.g,rr.prototype.send=rr.prototype.o,rr.prototype.open=rr.prototype.m,rr.prototype.close=rr.prototype.close,AP=function(){return new sf},IP=function(){return as()},CP=Mn,zw={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Jd.NO_ERROR=0,Jd.TIMEOUT=8,Jd.HTTP_ERROR=6,yp=Jd,sE.COMPLETE="complete",kP=sE,Re.EventType=He,He.OPEN="a",He.CLOSE="b",He.ERROR="c",He.MESSAGE="d",xe.prototype.listen=xe.prototype.J,Uu=Re,kt.prototype.listenOnce=kt.prototype.K,kt.prototype.getLastError=kt.prototype.Ha,kt.prototype.getLastErrorCode=kt.prototype.ya,kt.prototype.getStatus=kt.prototype.ca,kt.prototype.getResponseJson=kt.prototype.La,kt.prototype.getResponseText=kt.prototype.la,kt.prototype.send=kt.prototype.ea,kt.prototype.setWithCredentials=kt.prototype.Fa,SP=kt}).apply(typeof kf<"u"?kf:typeof self<"u"?self:typeof window<"u"?window:{});const _S="@firebase/firestore",bS="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}hn.UNAUTHENTICATED=new hn(null),hn.GOOGLE_CREDENTIALS=new hn("google-credentials-uid"),hn.FIRST_PARTY=new hn("first-party-uid"),hn.MOCK_USER=new hn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Gc="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const La=new ab("@firebase/firestore");function kl(){return La.logLevel}function G(t,...e){if(La.logLevel<=De.DEBUG){const n=e.map(ub);La.debug(`Firestore (${Gc}): ${t}`,...n)}}function Ln(t,...e){if(La.logLevel<=De.ERROR){const n=e.map(ub);La.error(`Firestore (${Gc}): ${t}`,...n)}}function ja(t,...e){if(La.logLevel<=De.WARN){const n=e.map(ub);La.warn(`Firestore (${Gc}): ${t}`,...n)}}function ub(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ue(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,NP(t,r,n)}function NP(t,e,n){let r=`FIRESTORE (${Gc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Ln(r),new Error(r)}function de(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||NP(e,s,r)}function ke(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ee extends Ms{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Es{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RP{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class zz{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(hn.UNAUTHENTICATED))}shutdown(){}}class $z{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class Uz{constructor(e){this.t=e,this.currentUser=hn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){de(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let i=new Es;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Es,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{G("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(G("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Es)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(G("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(de(typeof r.accessToken=="string",31837,{l:r}),new RP(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return de(e===null||typeof e=="string",2055,{h:e}),new hn(e)}}class Hz{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=hn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Wz{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new Hz(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(hn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class TS{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qz{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,or(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){de(this.o===void 0,3512);const r=i=>{i.error!=null&&G("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,G("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{G("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):G("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new TS(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(de(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new TS(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kz(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Kz(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function Se(t,e){return t<e?-1:t>e?1:0}function $w(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return Uv(s)===Uv(i)?Se(s,i):Uv(s)?1:-1}return Se(t.length,e.length)}const Gz=55296,Qz=57343;function Uv(t){const e=t.charCodeAt(0);return e>=Gz&&e<=Qz}function _c(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function PP(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ES="__name__";class gs{constructor(e,n,r){n===void 0?n=0:n>e.length&&ue(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&ue(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return gs.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof gs?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=gs.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return Se(e.length,n.length)}static compareSegments(e,n){const r=gs.isNumericId(e),s=gs.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?gs.extractNumericId(e).compare(gs.extractNumericId(n)):$w(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return ho.fromString(e.substring(4,e.length-2))}}class Ue extends gs{construct(e,n,r){return new Ue(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ee(B.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ue(n)}static emptyPath(){return new Ue([])}}const Jz=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wt extends gs{construct(e,n,r){return new wt(e,n,r)}static isValidIdentifier(e){return Jz.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ES}static keyField(){return new wt([ES])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ee(B.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ee(B.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ee(B.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ee(B.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wt(n)}static emptyPath(){return new wt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class re{constructor(e){this.path=e}static fromPath(e){return new re(Ue.fromString(e))}static fromName(e){return new re(Ue.fromString(e).popFirst(5))}static empty(){return new re(Ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ue.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new Ue(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MP(t,e,n){if(!n)throw new ee(B.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function Yz(t,e,n,r){if(e===!0&&r===!0)throw new ee(B.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function SS(t){if(!re.isDocumentKey(t))throw new ee(B.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function kS(t){if(re.isDocumentKey(t))throw new ee(B.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function OP(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function Yg(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ue(12329,{type:typeof t})}function Br(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ee(B.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Yg(t);throw new ee(B.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vt(t,e){const n={typeString:t};return e&&(n.value=e),n}function Nd(t,e){if(!OP(t))throw new ee(B.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new ee(B.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CS=-62135596800,IS=1e6;class We{static now(){return We.fromMillis(Date.now())}static fromDate(e){return We.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*IS);return new We(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ee(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ee(B.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<CS)throw new ee(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ee(B.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/IS}_compareTo(e){return this.seconds===e.seconds?Se(this.nanoseconds,e.nanoseconds):Se(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:We._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Nd(e,We._jsonSchema))return new We(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-CS;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}We._jsonSchemaVersion="firestore/timestamp/1.0",We._jsonSchema={type:Vt("string",We._jsonSchemaVersion),seconds:Vt("number"),nanoseconds:Vt("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ye{static fromTimestamp(e){return new ye(e)}static min(){return new ye(new We(0,0))}static max(){return new ye(new We(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kh=-1;class pm{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function Uw(t){return t.fields.find(e=>e.kind===2)}function Yo(t){return t.fields.filter(e=>e.kind!==2)}pm.UNKNOWN_ID=-1;class vp{constructor(e,n){this.fieldPath=e,this.kind=n}}class Gh{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Gh(0,mr.min())}}function Xz(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ye.fromTimestamp(r===1e9?new We(n+1,0):new We(n,r));return new mr(s,re.empty(),e)}function DP(t){return new mr(t.readTime,t.key,Kh)}class mr{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new mr(ye.min(),re.empty(),Kh)}static max(){return new mr(ye.max(),re.empty(),Kh)}}function db(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=re.comparator(t.documentKey,e.documentKey),n!==0?n:Se(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LP="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class jP{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function il(t){if(t.code!==B.FAILED_PRECONDITION||t.message!==LP)throw t;G("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ue(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new L((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof L?n:L.resolve(n)}catch(n){return L.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):L.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):L.reject(n)}static resolve(e){return new L((n,r)=>{n(e)})}static reject(e){return new L((n,r)=>{r(e)})}static waitFor(e){return new L((n,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},l=>r(l))}),o=!0,i===s&&n()})}static or(e){let n=L.resolve(!1);for(const r of e)n=n.next(s=>s?L.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new L((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===i&&r(o)},u=>s(u))}})}static doWhile(e,n){return new L((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ir="SimpleDb";class Xg{static open(e,n,r,s){try{return new Xg(n,e.transaction(s,r))}catch(i){throw new lh(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Es,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new lh(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=fb(r.target.error);this.S.reject(new lh(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(G(ir,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new e$(n)}}class fo{static delete(e){return G(ir,"Removing database:",e),Zo(cP().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!vP())return!1;if(fo.F())return!0;const e=qt(),n=fo.M(e),r=0<n&&n<10,s=VP(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,fo.M(qt())===12.2&&Ln("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(G(ir,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;n(o)},s.onblocked=()=>{r(new lh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ee(B.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ee(B.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new lh(e,o))},s.onupgradeneeded=i=>{G(ir,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{G(ir,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=Xg.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.C(),c)).catch(c=>(a.abort(c),L.reject(c))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(G(ir,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function VP(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Zz{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return Zo(this.U.delete())}}class lh extends ee{constructor(e,n){super(B.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Mo(t){return t.name==="IndexedDbTransactionError"}class e${constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(G(ir,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(G(ir,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Zo(r)}add(e){return G(ir,"ADD",this.store.name,e,e),Zo(this.store.add(e))}get(e){return Zo(this.store.get(e)).next(n=>(n===void 0&&(n=null),G(ir,"GET",this.store.name,e,n),n))}delete(e){return G(ir,"DELETE",this.store.name,e),Zo(this.store.delete(e))}count(){return G(ir,"COUNT",this.store.name),Zo(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new L((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new L((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,n){G(ir,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new L((r,s)=>{n.onerror=i=>{const o=fb(i.target.error);s(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new L((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new Zz(a),c=n(a.primaryKey,a.value,l);if(c instanceof L){const u=c.catch(h=>(l.done(),L.reject(h)));r.push(u)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>L.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function Zo(t){return new L((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=fb(r.target.error);n(s)}})}let AS=!1;function fb(t){const e=fo.M(qt());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ee("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return AS||(AS=!0,setTimeout(()=>{throw r},0)),r}}return t}const ch="IndexBackfiller";class t${constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){G(ch,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();G(ch,`Documents written: ${n}`)}catch(n){Mo(n)?G(ch,"Ignoring IndexedDB error during index backfill: ",n):await il(n)}await this.re(6e4)})}}class n${constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return L.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return G(ch,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(G(ch,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const o=DP(i);db(o,r)>0&&(r=o)}),new mr(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pr{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Pr.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const va=-1;function Zg(t){return t==null}function Qh(t){return t===0&&1/t==-1/0}function r$(t){return typeof t=="number"&&Number.isInteger(t)&&!Qh(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mm="";function kn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=NS(e)),e=s$(t.get(n),e);return NS(e)}function s$(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case mm:n+="";break;default:n+=i}}return n}function NS(t){return t+mm+""}function vs(t){const e=t.length;if(de(e>=2,64408,{path:t}),e===2)return de(t.charAt(0)===mm&&t.charAt(1)==="",56145,{path:t}),Ue.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const o=t.indexOf(mm,i);switch((o<0||o>n)&&ue(50515,{path:t}),t.charAt(o+1)){case"":const a=t.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=t.substring(i,o),s+="\0";break;case"":s+=t.substring(i,o+1);break;default:ue(61167,{path:t})}i=o+2}return new Ue(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xo="remoteDocuments",Rd="owner",ml="owner",Jh="mutationQueues",i$="userId",Kr="mutations",RS="batchId",ca="userMutationsIndex",PS=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wp(t,e){return[t,kn(e)]}function FP(t,e,n){return[t,kn(e),n]}const o$={},bc="documentMutations",gm="remoteDocumentsV14",a$=["prefixPath","collectionGroup","readTime","documentId"],xp="documentKeyIndex",l$=["prefixPath","collectionGroup","documentId"],BP="collectionGroupIndex",c$=["collectionGroup","readTime","prefixPath","documentId"],Yh="remoteDocumentGlobal",Hw="remoteDocumentGlobalKey",Tc="targets",zP="queryTargetsIndex",u$=["canonicalId","targetId"],Ec="targetDocuments",h$=["targetId","path"],pb="documentTargetsIndex",d$=["path","targetId"],ym="targetGlobalKey",wa="targetGlobal",Xh="collectionParents",f$=["collectionId","parent"],Sc="clientMetadata",p$="clientId",ey="bundles",m$="bundleId",ty="namedQueries",g$="name",mb="indexConfiguration",y$="indexId",Ww="collectionGroupIndex",v$="collectionGroup",uh="indexState",w$=["indexId","uid"],$P="sequenceNumberIndex",x$=["uid","sequenceNumber"],hh="indexEntries",_$=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],UP="documentKeyIndex",b$=["indexId","uid","orderedDocumentKey"],ny="documentOverlays",T$=["userId","collectionPath","documentId"],qw="collectionPathOverlayIndex",E$=["userId","collectionPath","largestBatchId"],HP="collectionGroupOverlayIndex",S$=["userId","collectionGroup","largestBatchId"],gb="globals",k$="name",WP=[Jh,Kr,bc,Xo,Tc,Rd,wa,Ec,Sc,Yh,Xh,ey,ty],C$=[...WP,ny],qP=[Jh,Kr,bc,gm,Tc,Rd,wa,Ec,Sc,Yh,Xh,ey,ty,ny],KP=qP,yb=[...KP,mb,uh,hh],I$=yb,GP=[...yb,gb],A$=GP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kw extends jP{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function Kt(t,e){const n=ke(t);return fo.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Oo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function QP(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,n){this.comparator=e,this.root=n||dn.EMPTY}insert(e,n){return new yt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,dn.BLACK,null,null))}remove(e){return new yt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Cf(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Cf(this.root,e,this.comparator,!1)}getReverseIterator(){return new Cf(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Cf(this.root,e,this.comparator,!0)}}class Cf{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class dn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??dn.RED,this.left=s??dn.EMPTY,this.right=i??dn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new dn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return dn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return dn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ue(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ue(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ue(27949);return e+(this.isRed()?0:1)}}dn.EMPTY=null,dn.RED=!0,dn.BLACK=!1;dn.EMPTY=new class{constructor(){this.size=0}get key(){throw ue(57766)}get value(){throw ue(16141)}get color(){throw ue(16727)}get left(){throw ue(29726)}get right(){throw ue(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new dn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.comparator=e,this.data=new yt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new OS(this.data.getIterator())}getIteratorFrom(e){return new OS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Qe)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Qe(this.comparator);return n.data=e,n}}class OS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gl(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.fields=e,e.sort(wt.comparator)}static empty(){return new Jn([])}unionWith(e){let n=new Qe(wt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new Jn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return _c(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new JP("Invalid base64 string: "+i):i}}(e);return new Bt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new Bt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Se(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Bt.EMPTY_BYTE_STRING=new Bt("");const N$=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(t){if(de(!!t,39018),typeof t=="string"){let e=0;const n=N$.exec(t);if(de(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:mt(t.seconds),nanos:mt(t.nanos)}}function mt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function di(t){return typeof t=="string"?Bt.fromBase64String(t):Bt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YP="server_timestamp",XP="__type__",ZP="__previous_value__",eM="__local_write_time__";function vb(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[XP])==null?void 0:r.stringValue)===YP}function ry(t){const e=t.mapValue.fields[ZP];return vb(e)?ry(e):e}function Zh(t){const e=hi(t.mapValue.fields[eM].timestampValue);return new We(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R${constructor(e,n,r,s,i,o,a,l,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}}const vm="(default)";class Va{constructor(e,n){this.projectId=e,this.database=n||vm}static empty(){return new Va("","")}get isDefaultDatabase(){return this.database===vm}isEqual(e){return e instanceof Va&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wb="__type__",tM="__max__",Yi={mapValue:{fields:{__type__:{stringValue:tM}}}},xb="__vector__",kc="value",_p={nullValue:"NULL_VALUE"};function bo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vb(t)?4:nM(t)?9007199254740991:sy(t)?10:11:ue(28295,{value:t})}function As(t,e){if(t===e)return!0;const n=bo(t);if(n!==bo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Zh(t).isEqual(Zh(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=hi(s.timestampValue),a=hi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return di(s.bytesValue).isEqual(di(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return mt(s.geoPointValue.latitude)===mt(i.geoPointValue.latitude)&&mt(s.geoPointValue.longitude)===mt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return mt(s.integerValue)===mt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=mt(s.doubleValue),a=mt(i.doubleValue);return o===a?Qh(o)===Qh(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return _c(t.arrayValue.values||[],e.arrayValue.values||[],As);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(MS(o)!==MS(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!As(o[l],a[l])))return!1;return!0}(t,e);default:return ue(52216,{left:t})}}function ed(t,e){return(t.values||[]).find(n=>As(n,e))!==void 0}function To(t,e){if(t===e)return 0;const n=bo(t),r=bo(e);if(n!==r)return Se(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Se(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=mt(i.integerValue||i.doubleValue),l=mt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return DS(t.timestampValue,e.timestampValue);case 4:return DS(Zh(t),Zh(e));case 5:return $w(t.stringValue,e.stringValue);case 6:return function(i,o){const a=di(i),l=di(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=Se(a[c],l[c]);if(u!==0)return u}return Se(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Se(mt(i.latitude),mt(o.latitude));return a!==0?a:Se(mt(i.longitude),mt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return LS(t.arrayValue,e.arrayValue);case 10:return function(i,o){var f,m,g,y;const a=i.fields||{},l=o.fields||{},c=(f=a[kc])==null?void 0:f.arrayValue,u=(m=l[kc])==null?void 0:m.arrayValue,h=Se(((g=c==null?void 0:c.values)==null?void 0:g.length)||0,((y=u==null?void 0:u.values)==null?void 0:y.length)||0);return h!==0?h:LS(c,u)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===Yi.mapValue&&o===Yi.mapValue)return 0;if(i===Yi.mapValue)return 1;if(o===Yi.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const f=$w(l[h],u[h]);if(f!==0)return f;const m=To(a[l[h]],c[u[h]]);if(m!==0)return m}return Se(l.length,u.length)}(t.mapValue,e.mapValue);default:throw ue(23264,{he:n})}}function DS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Se(t,e);const n=hi(t),r=hi(e),s=Se(n.seconds,r.seconds);return s!==0?s:Se(n.nanos,r.nanos)}function LS(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=To(n[s],r[s]);if(i)return i}return Se(n.length,r.length)}function Cc(t){return Gw(t)}function Gw(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=hi(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return di(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return re.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=Gw(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${Gw(n.fields[o])}`;return s+"}"}(t.mapValue):ue(61005,{value:t})}function bp(t){switch(bo(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ry(t);return e?16+bp(e):16;case 5:return 2*t.stringValue.length;case 6:return di(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+bp(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Oo(r.fields,(i,o)=>{s+=i.length+bp(o)}),s}(t.mapValue);default:throw ue(13486,{value:t})}}function td(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Qw(t){return!!t&&"integerValue"in t}function nd(t){return!!t&&"arrayValue"in t}function jS(t){return!!t&&"nullValue"in t}function VS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Tp(t){return!!t&&"mapValue"in t}function sy(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[wb])==null?void 0:r.stringValue)===xb}function dh(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Oo(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=dh(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=dh(t.arrayValue.values[n]);return e}return{...t}}function nM(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===tM}const rM={mapValue:{fields:{[wb]:{stringValue:xb},[kc]:{arrayValue:{}}}}};function P$(t){return"nullValue"in t?_p:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?td(Va.empty(),re.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?sy(t)?rM:{mapValue:{}}:ue(35942,{value:t})}function M$(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?td(Va.empty(),re.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?rM:"mapValue"in t?sy(t)?{mapValue:{}}:Yi:ue(61959,{value:t})}function FS(t,e){const n=To(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function BS(t,e){const n=To(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this.value=e}static empty(){return new En({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Tp(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=dh(n)}setAll(e){let n=wt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=dh(o):s.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Tp(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return As(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Tp(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Oo(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new En(dh(this.value))}}function sM(t){const e=[];return Oo(t.fields,(n,r)=>{const s=new wt([n]);if(Tp(r)){const i=sM(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new Jn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nt{constructor(e,n,r,s,i,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Nt(e,0,ye.min(),ye.min(),ye.min(),En.empty(),0)}static newFoundDocument(e,n,r,s){return new Nt(e,1,n,ye.min(),r,s,0)}static newNoDocument(e,n){return new Nt(e,2,n,ye.min(),ye.min(),En.empty(),0)}static newUnknownDocument(e,n){return new Nt(e,3,n,ye.min(),ye.min(),En.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(ye.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=En.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=En.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ye.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Nt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Nt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ic{constructor(e,n){this.position=e,this.inclusive=n}}function zS(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=re.comparator(re.fromName(o.referenceValue),n.key):r=To(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function $S(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!As(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rd{constructor(e,n="asc"){this.field=e,this.dir=n}}function O$(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iM{}class Le extends iM{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new D$(e,n,r):n==="array-contains"?new V$(e,r):n==="in"?new hM(e,r):n==="not-in"?new F$(e,r):n==="array-contains-any"?new B$(e,r):new Le(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new L$(e,r):new j$(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(To(n,this.value)):n!==null&&bo(this.value)===bo(n)&&this.matchesComparison(To(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ue(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ke extends iM{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Ke(e,n)}matches(e){return Ac(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Ac(t){return t.op==="and"}function Jw(t){return t.op==="or"}function _b(t){return oM(t)&&Ac(t)}function oM(t){for(const e of t.filters)if(e instanceof Ke)return!1;return!0}function Yw(t){if(t instanceof Le)return t.field.canonicalString()+t.op.toString()+Cc(t.value);if(_b(t))return t.filters.map(e=>Yw(e)).join(",");{const e=t.filters.map(n=>Yw(n)).join(",");return`${t.op}(${e})`}}function aM(t,e){return t instanceof Le?function(r,s){return s instanceof Le&&r.op===s.op&&r.field.isEqual(s.field)&&As(r.value,s.value)}(t,e):t instanceof Ke?function(r,s){return s instanceof Ke&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&aM(o,s.filters[a]),!0):!1}(t,e):void ue(19439)}function lM(t,e){const n=t.filters.concat(e);return Ke.create(n,t.op)}function cM(t){return t instanceof Le?function(n){return`${n.field.canonicalString()} ${n.op} ${Cc(n.value)}`}(t):t instanceof Ke?function(n){return n.op.toString()+" {"+n.getFilters().map(cM).join(" ,")+"}"}(t):"Filter"}class D$ extends Le{constructor(e,n,r){super(e,n,r),this.key=re.fromName(r.referenceValue)}matches(e){const n=re.comparator(e.key,this.key);return this.matchesComparison(n)}}class L$ extends Le{constructor(e,n){super(e,"in",n),this.keys=uM("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class j$ extends Le{constructor(e,n){super(e,"not-in",n),this.keys=uM("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function uM(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>re.fromName(r.referenceValue))}class V$ extends Le{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return nd(n)&&ed(n.arrayValue,this.value)}}class hM extends Le{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&ed(this.value.arrayValue,n)}}class F$ extends Le{constructor(e,n){super(e,"not-in",n)}matches(e){if(ed(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!ed(this.value.arrayValue,n)}}class B$ extends Le{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!nd(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>ed(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z${constructor(e,n=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function Xw(t,e=null,n=[],r=[],s=null,i=null,o=null){return new z$(t,e,n,r,s,i,o)}function Fa(t){const e=ke(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Yw(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),Zg(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Cc(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Cc(r)).join(",")),e.Te=n}return e.Te}function Pd(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!O$(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!aM(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!$S(t.startAt,e.startAt)&&$S(t.endAt,e.endAt)}function wm(t){return re.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function xm(t,e){return t.filters.filter(n=>n instanceof Le&&n.field.isEqual(e))}function US(t,e,n){let r=_p,s=!0;for(const i of xm(t,e)){let o=_p,a=!0;switch(i.op){case"<":case"<=":o=P$(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=_p}FS({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];FS({value:r,inclusive:s},{value:o,inclusive:n.inclusive})<0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}function HS(t,e,n){let r=Yi,s=!0;for(const i of xm(t,e)){let o=Yi,a=!0;switch(i.op){case">=":case">":o=M$(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=Yi}BS({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];BS({value:r,inclusive:s},{value:o,inclusive:n.inclusive})>0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qc{constructor(e,n=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function $$(t,e,n,r,s,i,o,a){return new Qc(t,e,n,r,s,i,o,a)}function iy(t){return new Qc(t)}function WS(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function dM(t){return t.collectionGroup!==null}function fh(t){const e=ke(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Qe(wt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new rd(i,r))}),n.has(wt.keyField().canonicalString())||e.Ie.push(new rd(wt.keyField(),r))}return e.Ie}function Or(t){const e=ke(t);return e.Ee||(e.Ee=U$(e,fh(t))),e.Ee}function U$(t,e){if(t.limitType==="F")return Xw(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new rd(s.field,i)});const n=t.endAt?new Ic(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Ic(t.startAt.position,t.startAt.inclusive):null;return Xw(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function Zw(t,e){const n=t.filters.concat([e]);return new Qc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function _m(t,e,n){return new Qc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function oy(t,e){return Pd(Or(t),Or(e))&&t.limitType===e.limitType}function fM(t){return`${Fa(Or(t))}|lt:${t.limitType}`}function Cl(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>cM(s)).join(", ")}]`),Zg(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Cc(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Cc(s)).join(",")),`Target(${r})`}(Or(t))}; limitType=${t.limitType})`}function Md(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):re.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of fh(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=zS(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,fh(r),s)||r.endAt&&!function(o,a,l){const c=zS(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,fh(r),s))}(t,e)}function H$(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function pM(t){return(e,n)=>{let r=!1;for(const s of fh(t)){const i=W$(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function W$(t,e,n){const r=t.field.isKeyField()?re.comparator(e.key,n.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?To(l,c):ue(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ue(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Oo(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return QP(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q$=new yt(re.comparator);function ur(){return q$}const mM=new yt(re.comparator);function Hu(...t){let e=mM;for(const n of t)e=e.insert(n.key,n);return e}function gM(t){let e=mM;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function ws(){return ph()}function yM(){return ph()}function ph(){return new gi(t=>t.toString(),(t,e)=>t.isEqual(e))}const K$=new yt(re.comparator),G$=new Qe(re.comparator);function Pe(...t){let e=G$;for(const n of t)e=e.add(n);return e}const Q$=new Qe(Se);function J$(){return Q$}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qh(e)?"-0":e}}function vM(t){return{integerValue:""+t}}function wM(t,e){return r$(e)?vM(e):bb(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ay{constructor(){this._=void 0}}function Y$(t,e,n){return t instanceof sd?function(s,i){const o={fields:{[XP]:{stringValue:YP},[eM]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&vb(i)&&(i=ry(i)),i&&(o.fields[ZP]=i),{mapValue:o}}(n,e):t instanceof Nc?_M(t,e):t instanceof Rc?bM(t,e):function(s,i){const o=xM(s,i),a=qS(o)+qS(s.Ae);return Qw(o)&&Qw(s.Ae)?vM(a):bb(s.serializer,a)}(t,e)}function X$(t,e,n){return t instanceof Nc?_M(t,e):t instanceof Rc?bM(t,e):n}function xM(t,e){return t instanceof Pc?function(r){return Qw(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class sd extends ay{}class Nc extends ay{constructor(e){super(),this.elements=e}}function _M(t,e){const n=TM(e);for(const r of t.elements)n.some(s=>As(s,r))||n.push(r);return{arrayValue:{values:n}}}class Rc extends ay{constructor(e){super(),this.elements=e}}function bM(t,e){let n=TM(e);for(const r of t.elements)n=n.filter(s=>!As(s,r));return{arrayValue:{values:n}}}class Pc extends ay{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function qS(t){return mt(t.integerValue||t.doubleValue)}function TM(t){return nd(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EM{constructor(e,n){this.field=e,this.transform=n}}function Z$(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Nc&&s instanceof Nc||r instanceof Rc&&s instanceof Rc?_c(r.elements,s.elements,As):r instanceof Pc&&s instanceof Pc?As(r.Ae,s.Ae):r instanceof sd&&s instanceof sd}(t.transform,e.transform)}class eU{constructor(e,n){this.version=e,this.transformResults=n}}class Sn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Sn}static exists(e){return new Sn(void 0,e)}static updateTime(e){return new Sn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Ep(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class ly{}function SM(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new cy(t.key,Sn.none()):new Jc(t.key,t.data,Sn.none());{const n=t.data,r=En.empty();let s=new Qe(wt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new yi(t.key,r,new Jn(s.toArray()),Sn.none())}}function tU(t,e,n){t instanceof Jc?function(s,i,o){const a=s.value.clone(),l=GS(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof yi?function(s,i,o){if(!Ep(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=GS(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(kM(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function mh(t,e,n,r){return t instanceof Jc?function(i,o,a,l){if(!Ep(i.precondition,o))return a;const c=i.value.clone(),u=QS(i.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(t,e,n,r):t instanceof yi?function(i,o,a,l){if(!Ep(i.precondition,o))return a;const c=QS(i.fieldTransforms,l,o),u=o.data;return u.setAll(kM(i)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,o,a){return Ep(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function nU(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=xM(r.transform,s||null);i!=null&&(n===null&&(n=En.empty()),n.set(r.field,i))}return n||null}function KS(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&_c(r,s,(i,o)=>Z$(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Jc extends ly{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class yi extends ly{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function kM(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function GS(t,e,n){const r=new Map;de(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,X$(o,a,n[s]))}return r}function QS(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,Y$(i,o,e))}return r}class cy extends ly{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class CM extends ly{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&tU(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=mh(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=mh(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=yM();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(s.key)?null:a;const l=SM(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(ye.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Pe())}isEqual(e){return this.batchId===e.batchId&&_c(this.mutations,e.mutations,(n,r)=>KS(n,r))&&_c(this.baseMutations,e.baseMutations,(n,r)=>KS(n,r))}}class Eb{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){de(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return K$}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Eb(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sb{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rU{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lt,Fe;function sU(t){switch(t){case B.OK:return ue(64938);case B.CANCELLED:case B.UNKNOWN:case B.DEADLINE_EXCEEDED:case B.RESOURCE_EXHAUSTED:case B.INTERNAL:case B.UNAVAILABLE:case B.UNAUTHENTICATED:return!1;case B.INVALID_ARGUMENT:case B.NOT_FOUND:case B.ALREADY_EXISTS:case B.PERMISSION_DENIED:case B.FAILED_PRECONDITION:case B.ABORTED:case B.OUT_OF_RANGE:case B.UNIMPLEMENTED:case B.DATA_LOSS:return!0;default:return ue(15467,{code:t})}}function IM(t){if(t===void 0)return Ln("GRPC error has no .code"),B.UNKNOWN;switch(t){case Lt.OK:return B.OK;case Lt.CANCELLED:return B.CANCELLED;case Lt.UNKNOWN:return B.UNKNOWN;case Lt.DEADLINE_EXCEEDED:return B.DEADLINE_EXCEEDED;case Lt.RESOURCE_EXHAUSTED:return B.RESOURCE_EXHAUSTED;case Lt.INTERNAL:return B.INTERNAL;case Lt.UNAVAILABLE:return B.UNAVAILABLE;case Lt.UNAUTHENTICATED:return B.UNAUTHENTICATED;case Lt.INVALID_ARGUMENT:return B.INVALID_ARGUMENT;case Lt.NOT_FOUND:return B.NOT_FOUND;case Lt.ALREADY_EXISTS:return B.ALREADY_EXISTS;case Lt.PERMISSION_DENIED:return B.PERMISSION_DENIED;case Lt.FAILED_PRECONDITION:return B.FAILED_PRECONDITION;case Lt.ABORTED:return B.ABORTED;case Lt.OUT_OF_RANGE:return B.OUT_OF_RANGE;case Lt.UNIMPLEMENTED:return B.UNIMPLEMENTED;case Lt.DATA_LOSS:return B.DATA_LOSS;default:return ue(39323,{code:t})}}(Fe=Lt||(Lt={}))[Fe.OK=0]="OK",Fe[Fe.CANCELLED=1]="CANCELLED",Fe[Fe.UNKNOWN=2]="UNKNOWN",Fe[Fe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Fe[Fe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Fe[Fe.NOT_FOUND=5]="NOT_FOUND",Fe[Fe.ALREADY_EXISTS=6]="ALREADY_EXISTS",Fe[Fe.PERMISSION_DENIED=7]="PERMISSION_DENIED",Fe[Fe.UNAUTHENTICATED=16]="UNAUTHENTICATED",Fe[Fe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Fe[Fe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Fe[Fe.ABORTED=10]="ABORTED",Fe[Fe.OUT_OF_RANGE=11]="OUT_OF_RANGE",Fe[Fe.UNIMPLEMENTED=12]="UNIMPLEMENTED",Fe[Fe.INTERNAL=13]="INTERNAL",Fe[Fe.UNAVAILABLE=14]="UNAVAILABLE",Fe[Fe.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iU(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oU=new ho([4294967295,4294967295],0);function JS(t){const e=iU().encode(t),n=new EP;return n.update(e),new Uint8Array(n.digest())}function YS(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new ho([n,r],0),new ho([s,i],0)]}class kb{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Wu(`Invalid padding: ${n}`);if(r<0)throw new Wu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Wu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Wu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=ho.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(ho.fromNumber(r)));return s.compare(oU)===1&&(s=new ho([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=JS(e),[r,s]=YS(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new kb(i,s,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const n=JS(e),[r,s]=YS(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Wu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Od.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new uy(ye.min(),s,new yt(Se),ur(),Pe())}}class Od{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Od(r,n,Pe(),Pe(),Pe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sp{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class AM{constructor(e,n){this.targetId=e,this.Ce=n}}class NM{constructor(e,n,r=Bt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class XS{constructor(){this.ve=0,this.Fe=ZS(),this.Me=Bt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Pe(),n=Pe(),r=Pe();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ue(38017,{changeType:i})}}),new Od(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=ZS()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,de(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class aU{constructor(e){this.Ge=e,this.ze=new Map,this.je=ur(),this.Je=If(),this.He=If(),this.Ye=new yt(Se)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:ue(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(wm(i))if(r===0){const o=new re(i.path);this.et(n,o,Nt.newNoDocument(o,ye.min()))}else de(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(n);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,c)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,a;try{o=di(r).toUint8Array()}catch(l){if(l instanceof JP)return ja("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new kb(o,s,i)}catch(l){return ja(l instanceof Wu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&wm(a.target)){const l=new re(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Nt.newNoDocument(l,e))}i.Be&&(n.set(o,i.ke()),i.qe())}});let r=Pe();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new uy(e,n,this.Ye,this.je,r);return this.je=ur(),this.Je=If(),this.He=If(),this.Ye=new yt(Se),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new XS,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new Qe(Se),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new Qe(Se),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||G("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new XS),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function If(){return new yt(re.comparator)}function ZS(){return new yt(re.comparator)}const lU={asc:"ASCENDING",desc:"DESCENDING"},cU={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},uU={and:"AND",or:"OR"};class hU{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function ex(t,e){return t.useProto3Json||Zg(e)?e:{value:e}}function Mc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function RM(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function dU(t,e){return Mc(t,e.toTimestamp())}function Vn(t){return de(!!t,49232),ye.fromTimestamp(function(n){const r=hi(n);return new We(r.seconds,r.nanos)}(t))}function Cb(t,e){return tx(t,e).canonicalString()}function tx(t,e){const n=function(s){return new Ue(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function PM(t){const e=Ue.fromString(t);return de(zM(e),10190,{key:e.toString()}),e}function bm(t,e){return Cb(t.databaseId,e.path)}function xa(t,e){const n=PM(e);if(n.get(1)!==t.databaseId.projectId)throw new ee(B.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ee(B.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new re(DM(n))}function MM(t,e){return Cb(t.databaseId,e)}function OM(t){const e=PM(t);return e.length===4?Ue.emptyPath():DM(e)}function nx(t){return new Ue(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function DM(t){return de(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function ek(t,e,n){return{name:bm(t,e),fields:n.value.mapValue.fields}}function fU(t,e,n){const r=xa(t,e.name),s=Vn(e.updateTime),i=e.createTime?Vn(e.createTime):ye.min(),o=new En({mapValue:{fields:e.fields}}),a=Nt.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function pU(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ue(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,u){return c.useProto3Json?(de(u===void 0||typeof u=="string",58123),Bt.fromBase64String(u||"")):(de(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),Bt.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?B.UNKNOWN:IM(c.code);return new ee(u,c.message||"")}(o);n=new NM(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=xa(t,r.document.name),i=Vn(r.document.updateTime),o=r.document.createTime?Vn(r.document.createTime):ye.min(),a=new En({mapValue:{fields:r.document.fields}}),l=Nt.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Sp(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=xa(t,r.document),i=r.readTime?Vn(r.readTime):ye.min(),o=Nt.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Sp([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=xa(t,r.document),i=r.removedTargetIds||[];n=new Sp([],i,s,null)}else{if(!("filter"in e))return ue(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new rU(s,i),a=r.targetId;n=new AM(a,o)}}return n}function Tm(t,e){let n;if(e instanceof Jc)n={update:ek(t,e.key,e.value)};else if(e instanceof cy)n={delete:bm(t,e.key)};else if(e instanceof yi)n={update:ek(t,e.key,e.data),updateMask:xU(e.fieldMask)};else{if(!(e instanceof CM))return ue(16599,{Vt:e.type});n={verify:bm(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof sd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Nc)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Rc)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Pc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ue(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:dU(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ue(27497)}(t,e.precondition)),n}function rx(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?Sn.updateTime(Vn(i.updateTime)):i.exists!==void 0?Sn.exists(i.exists):Sn.none()}(e.currentDocument):Sn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)de(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new sd;else if("appendMissingElements"in a){const u=a.appendMissingElements.values||[];l=new Nc(u)}else if("removeAllFromArray"in a){const u=a.removeAllFromArray.values||[];l=new Rc(u)}else"increment"in a?l=new Pc(o,a.increment):ue(16584,{proto:a});const c=wt.fromServerFormat(a.fieldPath);return new EM(c,l)}(t,s)):[];if(e.update){e.update.name;const s=xa(t,e.update.name),i=new En({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new Jn(c.map(u=>wt.fromServerFormat(u)))}(e.updateMask);return new yi(s,i,o,n,r)}return new Jc(s,i,n,r)}if(e.delete){const s=xa(t,e.delete);return new cy(s,n)}if(e.verify){const s=xa(t,e.verify);return new CM(s,n)}return ue(1463,{proto:e})}function mU(t,e){return t&&t.length>0?(de(e!==void 0,14353),t.map(n=>function(s,i){let o=s.updateTime?Vn(s.updateTime):Vn(i);return o.isEqual(ye.min())&&(o=Vn(i)),new eU(o,s.transformResults||[])}(n,e))):[]}function LM(t,e){return{documents:[MM(t,e.path)]}}function jM(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=MM(t,s);const i=function(c){if(c.length!==0)return BM(Ke.create(c,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(u=>function(f){return{field:Il(f.field),direction:yU(f.dir)}}(u))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ex(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:n,parent:s}}function VM(t){let e=OM(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){de(r===1,65062);const u=n.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let i=[];n.where&&(i=function(h){const f=FM(h);return f instanceof Ke&&_b(f)?f.getFilters():[f]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(f=>function(g){return new rd(Al(g.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(f))}(n.orderBy));let a=null;n.limit&&(a=function(h){let f;return f=typeof h=="object"?h.value:h,Zg(f)?null:f}(n.limit));let l=null;n.startAt&&(l=function(h){const f=!!h.before,m=h.values||[];return new Ic(m,f)}(n.startAt));let c=null;return n.endAt&&(c=function(h){const f=!h.before,m=h.values||[];return new Ic(m,f)}(n.endAt)),$$(e,s,o,i,a,"F",l,c)}function gU(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ue(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function FM(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Al(n.unaryFilter.field);return Le.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Al(n.unaryFilter.field);return Le.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Al(n.unaryFilter.field);return Le.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Al(n.unaryFilter.field);return Le.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ue(61313);default:return ue(60726)}}(t):t.fieldFilter!==void 0?function(n){return Le.create(Al(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ue(58110);default:return ue(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Ke.create(n.compositeFilter.filters.map(r=>FM(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ue(1026)}}(n.compositeFilter.op))}(t):ue(30097,{filter:t})}function yU(t){return lU[t]}function vU(t){return cU[t]}function wU(t){return uU[t]}function Il(t){return{fieldPath:t.canonicalString()}}function Al(t){return wt.fromServerFormat(t.fieldPath)}function BM(t){return t instanceof Le?function(n){if(n.op==="=="){if(VS(n.value))return{unaryFilter:{field:Il(n.field),op:"IS_NAN"}};if(jS(n.value))return{unaryFilter:{field:Il(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(VS(n.value))return{unaryFilter:{field:Il(n.field),op:"IS_NOT_NAN"}};if(jS(n.value))return{unaryFilter:{field:Il(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Il(n.field),op:vU(n.op),value:n.value}}}(t):t instanceof Ke?function(n){const r=n.getFilters().map(s=>BM(s));return r.length===1?r[0]:{compositeFilter:{op:wU(n.op),filters:r}}}(t):ue(54877,{filter:t})}function xU(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function zM(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs{constructor(e,n,r,s,i=ye.min(),o=ye.min(),a=Bt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new Qs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $M{constructor(e){this.yt=e}}function _U(t,e){let n;if(e.document)n=fU(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=re.fromSegments(e.noDocument.path),s=za(e.noDocument.readTime);n=Nt.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ue(56709);{const r=re.fromSegments(e.unknownDocument.path),s=za(e.unknownDocument.version);n=Nt.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new We(s[0],s[1]);return ye.fromTimestamp(i)}(e.readTime)),n}function tk(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Em(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:bm(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Mc(i,o.version.toTimestamp()),createTime:Mc(i,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Ba(e.version)};else{if(!e.isUnknownDocument())return ue(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:Ba(e.version)}}return r}function Em(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ba(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function za(t){const e=new We(t.seconds,t.nanoseconds);return ye.fromTimestamp(e)}function ea(t,e){const n=(e.baseMutations||[]).map(i=>rx(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>rx(t.yt,i)),s=We.fromMillis(e.localWriteTimeMs);return new Tb(e.batchId,s,n,r)}function qu(t){const e=za(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?za(t.lastLimboFreeSnapshotVersion):ye.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const o=i.documents.length;return de(o===1,1966,{count:o}),Or(iy(OM(i.documents[0])))}(t.query):function(i){return Or(VM(i))}(t.query),new Qs(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,Bt.fromBase64String(t.resumeToken))}function UM(t,e){const n=Ba(e.snapshotVersion),r=Ba(e.lastLimboFreeSnapshotVersion);let s;s=wm(e.target)?LM(t.yt,e.target):jM(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Fa(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function HM(t){const e=VM({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?_m(e,e.limit,"L"):e}function Hv(t,e){return new Sb(e.largestBatchId,rx(t.yt,e.overlayMutation))}function nk(t,e){const n=e.path.lastSegment();return[t,kn(e.path.popLast()),n]}function rk(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Ba(r.readTime),documentKey:kn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bU{getBundleMetadata(e,n){return sk(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:za(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return sk(e).put(function(s){return{bundleId:s.id,createTime:Ba(Vn(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return ik(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:HM(i.bundledQuery),readTime:za(i.readTime)}}(r)})}saveNamedQuery(e,n){return ik(e).put(function(s){return{name:s.name,readTime:Ba(Vn(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function sk(t){return Kt(t,ey)}function ik(t){return Kt(t,ty)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hy{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new hy(e,r)}getOverlay(e,n){return Eu(e).get(nk(this.userId,n)).next(r=>r?Hv(this.serializer,r):null)}getOverlays(e,n){const r=ws();return L.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,o)=>{const a=new Sb(n,o);s.push(this.St(e,a))}),L.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(o=>s.add(kn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Eu(e).Z(qw,a))}),L.waitFor(i)}getOverlaysForCollection(e,n,r){const s=ws(),i=kn(n),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Eu(e).J(qw,o).next(a=>{for(const l of a){const c=Hv(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=ws();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Eu(e).ee({index:HP,range:a},(l,c,u)=>{const h=Hv(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>i)}St(e,n){return Eu(e).put(function(s,i,o){const[a,l,c]=nk(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Tm(s.yt,o.mutation)}}(this.serializer,this.userId,n))}}function Eu(t){return Kt(t,ny)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{bt(e){return Kt(e,gb)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?Bt.fromUint8Array(r):Bt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ta{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(mt(e.integerValue));else if("doubleValue"in e){const r=mt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),Qh(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=hi(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(di(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?nM(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):sy(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):ue(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var o,a;const r=e.fields||{};this.Ft(n,53);const s=kc,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(n,15),n.Mt(mt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),re.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}ta.Kt=new ta;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yl=255;function EU(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function ok(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=EU(255&r[i]);if(s+=o,o!==8)break}return s}(t);return Math.ceil(e/8)}class SU{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=ok(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=ok(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(yl),this.sn(255)}_n(){this.an(yl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===yl?(this.sn(yl),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===yl?(this.an(yl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class kU{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class CU{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Su{constructor(){this.cn=new SU,this.ln=new kU(this.cn),this.hn=new CU(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class na{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new na(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:kp(this.En),directionalValue:kp(this.dn),orderedDocumentKey:kp(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Ii(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=ak(t.En,e.En),n!==0?n:(n=ak(t.dn,e.dn),n!==0?n:re.comparator(t.In,e.In)))}function ak(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function kp(t){return yP()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function lk(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class ck{constructor(e){this.mn=new Qe((n,r)=>wt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(de(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=Uw(e);if(n!==void 0&&!this.wn(n))return!1;const r=Yo(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new Qe(wt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new vp(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new vp(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new vp(r.field,r.dir==="asc"?0:1)));return new pm(pm.UNKNOWN_ID,this.collectionId,n,Gh.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(t){var n,r;if(de(t instanceof Le||t instanceof Ke,20012),t instanceof Le){if(t instanceof hM){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>Le.create(t.field,"==",i)))||[];return Ke.create(s,"or")}return t}const e=t.filters.map(s=>WM(s));return Ke.create(e,t.op)}function IU(t){if(t.getFilters().length===0)return[];const e=ox(WM(t));return de(qM(e),7391),sx(e)||ix(e)?[e]:e.getFilters()}function sx(t){return t instanceof Le}function ix(t){return t instanceof Ke&&_b(t)}function qM(t){return sx(t)||ix(t)||function(n){if(n instanceof Ke&&Jw(n)){for(const r of n.getFilters())if(!sx(r)&&!ix(r))return!1;return!0}return!1}(t)}function ox(t){if(de(t instanceof Le||t instanceof Ke,34018),t instanceof Le)return t;if(t.filters.length===1)return ox(t.filters[0]);const e=t.filters.map(r=>ox(r));let n=Ke.create(e,t.op);return n=Sm(n),qM(n)?n:(de(n instanceof Ke,64498),de(Ac(n),40251),de(n.filters.length>1,57927),n.filters.reduce((r,s)=>Ib(r,s)))}function Ib(t,e){let n;return de(t instanceof Le||t instanceof Ke,38388),de(e instanceof Le||e instanceof Ke,25473),n=t instanceof Le?e instanceof Le?function(s,i){return Ke.create([s,i],"and")}(t,e):uk(t,e):e instanceof Le?uk(e,t):function(s,i){if(de(s.filters.length>0&&i.filters.length>0,48005),Ac(s)&&Ac(i))return lM(s,i.getFilters());const o=Jw(s)?s:i,a=Jw(s)?i:s,l=o.filters.map(c=>Ib(c,a));return Ke.create(l,"or")}(t,e),Sm(n)}function uk(t,e){if(Ac(e))return lM(e,t.getFilters());{const n=e.filters.map(r=>Ib(t,r));return Ke.create(n,"or")}}function Sm(t){if(de(t instanceof Le||t instanceof Ke,11850),t instanceof Le)return t;const e=t.getFilters();if(e.length===1)return Sm(e[0]);if(oM(t))return t;const n=e.map(s=>Sm(s)),r=[];return n.forEach(s=>{s instanceof Le?r.push(s):s instanceof Ke&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ke.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{constructor(){this.Cn=new Ab}addToCollectionParentIndex(e,n){return this.Cn.add(n),L.resolve()}getCollectionParents(e,n){return L.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return L.resolve()}deleteFieldIndex(e,n){return L.resolve()}deleteAllFieldIndexes(e){return L.resolve()}createTargetIndexes(e,n){return L.resolve()}getDocumentsMatchingTarget(e,n){return L.resolve(null)}getIndexType(e,n){return L.resolve(0)}getFieldIndexes(e,n){return L.resolve([])}getNextCollectionGroupToUpdate(e){return L.resolve(null)}getMinOffset(e,n){return L.resolve(mr.min())}getMinOffsetFromCollectionGroup(e,n){return L.resolve(mr.min())}updateCollectionGroup(e,n,r){return L.resolve()}updateIndexEntries(e,n){return L.resolve()}}class Ab{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new Qe(Ue.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new Qe(Ue.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk="IndexedDbIndexManager",Af=new Uint8Array(0);class NU{constructor(e,n){this.databaseId=n,this.vn=new Ab,this.Fn=new gi(r=>Fa(r),(r,s)=>Pd(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:kn(s)};return dk(e).put(i)}return L.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[PP(n),""],!1,!0);return dk(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==n)break;r.push(vs(o.parent))}return r})}addFieldIndex(e,n){const r=ku(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const o=wl(e);return i.next(a=>{o.put(rk(a,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=ku(e),s=wl(e),i=vl(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=ku(e),r=vl(e),s=wl(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return L.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new ck(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=vl(e);let s=!0;const i=new Map;return L.forEach(this.Mn(n),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Pe();const a=[];return L.forEach(i,(l,c)=>{G(hk,`Using index ${function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map(N=>`${N.fieldPath}:${N.kind}`).join(",")}`}(l)} to execute ${Fa(n)}`);const u=function(E,N){const R=Uw(N);if(R===void 0)return null;for(const O of xm(E,R.fieldPath))switch(O.op){case"array-contains-any":return O.value.arrayValue.values||[];case"array-contains":return[O.value]}return null}(c,l),h=function(E,N){const R=new Map;for(const O of Yo(N))for(const S of xm(E,O.fieldPath))switch(S.op){case"==":case"in":R.set(O.fieldPath.canonicalString(),S.value);break;case"not-in":case"!=":return R.set(O.fieldPath.canonicalString(),S.value),Array.from(R.values())}return null}(c,l),f=function(E,N){const R=[];let O=!0;for(const S of Yo(N)){const T=S.kind===0?US(E,S.fieldPath,E.startAt):HS(E,S.fieldPath,E.startAt);R.push(T.value),O&&(O=T.inclusive)}return new Ic(R,O)}(c,l),m=function(E,N){const R=[];let O=!0;for(const S of Yo(N)){const T=S.kind===0?HS(E,S.fieldPath,E.endAt):US(E,S.fieldPath,E.endAt);R.push(T.value),O&&(O=T.inclusive)}return new Ic(R,O)}(c,l),g=this.On(l,c,f),y=this.On(l,c,m),v=this.Nn(l,c,h),w=this.Bn(l.indexId,u,g,f.inclusive,y,m.inclusive,v);return L.forEach(w,_=>r.Y(_,n.limit).next(E=>{E.forEach(N=>{const R=re.fromSegments(N.documentKey);o.has(R)||(o=o.add(R),a.push(R))})}))}).next(()=>a)}return L.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=IU(Ke.create(e.filters,"and")).map(r=>Xw(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,o,a){const l=(n!=null?n.length:1)*Math.max(r.length,i.length),c=l/(n!=null?n.length:1),u=[];for(let h=0;h<l;++h){const f=n?this.Ln(n[h/c]):Af,m=this.kn(e,f,r[h%c],s),g=this.qn(e,f,i[h%c],o),y=a.map(v=>this.kn(e,f,v,!0));u.push(...this.createRange(m,g,y))}return u}kn(e,n,r,s){const i=new na(e,re.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new na(e,re.empty(),n,r);return s?i.An():i}xn(e,n){const r=new ck(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;const s=this.Mn(n);return L.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new Qe(wt.comparator),u=!1;for(const h of l.filters)for(const f of h.getFlattenedFilters())f.field.isKeyField()||(f.op==="array-contains"||f.op==="array-contains-any"?u=!0:c=c.add(f.field));for(const h of l.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(u?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Su;for(const s of Yo(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);ta.Kt.Dt(i,o)}return r.un()}Ln(e){const n=new Su;return ta.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Su;return ta.Kt.Dt(td(this.databaseId,n),r.Pn(function(i){const o=Yo(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Su);let i=0;for(const o of Yo(e)){const a=r[i++];for(const l of s)if(this.Un(n,o.fieldPath)&&nd(a))s=this.Kn(s,o,a);else{const c=l.Pn(o.kind);ta.Kt.Dt(a,c)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Su;l.seed(a.un()),ta.Kt.Dt(o,l.Pn(n.kind)),i.push(l)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof Le&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=ku(e),s=wl(e);return(n?r.J(Ww,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const o=[];return L.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(u,h){const f=h?new Gh(h.sequenceNumber,new mr(za(h.readTime),new re(vs(h.documentKey)),h.largestBatchId)):Gh.empty(),m=u.fields.map(([g,y])=>new vp(wt.fromServerFormat(g),y));return new pm(u.indexId,u.collectionGroup,m,f)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Se(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=ku(e),i=wl(e);return this.Gn(e).next(o=>s.J(Ww,IDBKeyRange.bound(n,n)).next(a=>L.forEach(a,l=>i.put(rk(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return L.forEach(n,(s,i)=>{const o=r.get(s.collectionGroup);return(o?L.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),L.forEach(a,l=>this.zn(e,s,l).next(c=>{const u=this.jn(i,l);return c.isEqual(u)?L.resolve():this.Jn(e,i,l,c,u)}))))})}Hn(e,n,r,s){return vl(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return vl(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=vl(e);let i=new Qe(Ii);return s.ee({index:UP,range:IDBKeyRange.only([r.indexId,this.uid,kp(this.$n(r,n))])},(o,a)=>{i=i.add(new na(r.indexId,n,lk(a.arrayValue),lk(a.directionalValue)))}).next(()=>i)}jn(e,n){let r=new Qe(Ii);const s=this.Qn(n,e);if(s==null)return r;const i=Uw(n);if(i!=null){const o=e.data.field(i.fieldPath);if(nd(o))for(const a of o.arrayValue.values||[])r=r.add(new na(n.indexId,e.key,this.Ln(a),s))}else r=r.add(new na(n.indexId,e.key,Af,s));return r}Jn(e,n,r,s,i){G(hk,"Updating index entries for document '%s'",n.key);const o=[];return function(l,c,u,h,f){const m=l.getIterator(),g=c.getIterator();let y=gl(m),v=gl(g);for(;y||v;){let w=!1,_=!1;if(y&&v){const E=u(y,v);E<0?_=!0:E>0&&(w=!0)}else y!=null?_=!0:w=!0;w?(h(v),v=gl(g)):_?(f(y),y=gl(m)):(y=gl(m),v=gl(g))}}(s,i,Ii,a=>{o.push(this.Hn(e,n,r,a))},a=>{o.push(this.Yn(e,n,r,a))}),L.waitFor(o)}Gn(e){let n=1;return wl(e).ee({index:$P,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>Ii(o,a)).filter((o,a,l)=>!a||Ii(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Ii(o,e),l=Ii(o,n);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(n);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Af,re.empty()),l=s[o+1].Vn(this.uid,Af,re.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,n){return Ii(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(fk)}getMinOffset(e,n){return L.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||ue(44426))).next(fk)}}function dk(t){return Kt(t,Xh)}function vl(t){return Kt(t,hh)}function ku(t){return Kt(t,mb)}function wl(t){return Kt(t,uh)}function fk(t){de(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;db(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new mr(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pk={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},KM=41943040;class bn{static withCacheSize(e){return new bn(e,bn.DEFAULT_COLLECTION_PERCENTILE,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GM(t,e,n){const r=t.store(Kr),s=t.store(bc),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=r.ee({range:o},(u,h,f)=>(a++,f.delete()));i.push(l.next(()=>{de(a===1,47070,{batchId:n.batchId})}));const c=[];for(const u of n.mutations){const h=FP(e,u.key.path,n.batchId);i.push(s.delete(h)),c.push(u.key)}return L.waitFor(i).next(()=>c)}function km(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ue(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */bn.DEFAULT_COLLECTION_PERCENTILE=10,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bn.DEFAULT=new bn(KM,bn.DEFAULT_COLLECTION_PERCENTILE,bn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bn.DISABLED=new bn(-1,0,0);class dy{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){de(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new dy(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ai(e).ee({index:ca,range:r},(s,i,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Nl(e),o=Ai(e);return o.add({}).next(a=>{de(typeof a=="number",49019);const l=new Tb(a,n,r,s),c=function(m,g,y){const v=y.baseMutations.map(_=>Tm(m.yt,_)),w=y.mutations.map(_=>Tm(m.yt,_));return{userId:g,batchId:y.batchId,localWriteTimeMs:y.localWriteTime.toMillis(),baseMutations:v,mutations:w}}(this.serializer,this.userId,l),u=[];let h=new Qe((f,m)=>Se(f.canonicalString(),m.canonicalString()));for(const f of s){const m=FP(this.userId,f.key.path,a);h=h.add(f.key.path.popLast()),u.push(o.put(c)),u.push(i.put(m,o$))}return h.forEach(f=>{u.push(this.indexManager.addToCollectionParentIndex(e,f))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),L.waitFor(u).next(()=>l)})}lookupMutationBatch(e,n){return Ai(e).get(n).next(r=>r?(de(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),ea(this.serializer,r)):null)}er(e,n){return this.Xn[n]?L.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Ai(e).ee({index:ca,range:s},(o,a,l)=>{a.userId===this.userId&&(de(a.batchId>=r,47524,{tr:r}),i=ea(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=va;return Ai(e).ee({index:ca,range:n,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,va],[this.userId,Number.POSITIVE_INFINITY]);return Ai(e).J(ca,n).next(r=>r.map(s=>ea(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=wp(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Nl(e).ee({range:s},(o,a,l)=>{const[c,u,h]=o,f=vs(u);if(c===this.userId&&n.path.isEqual(f))return Ai(e).get(h).next(m=>{if(!m)throw ue(61480,{nr:o,batchId:h});de(m.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:m.userId,batchId:h}),i.push(ea(this.serializer,m))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Qe(Se);const s=[];return n.forEach(i=>{const o=wp(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Nl(e).ee({range:a},(c,u,h)=>{const[f,m,g]=c,y=vs(m);f===this.userId&&i.path.isEqual(y)?r=r.add(g):h.done()});s.push(l)}),L.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=wp(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new Qe(Se);return Nl(e).ee({range:o},(l,c,u)=>{const[h,f,m]=l,g=vs(f);h===this.userId&&r.isPrefixOf(g)?g.length===s&&(a=a.add(m)):u.done()}).next(()=>this.rr(e,a))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Ai(e).get(i).next(o=>{if(o===null)throw ue(35274,{batchId:i});de(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(ea(this.serializer,o))}))}),L.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return GM(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),L.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return L.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Nl(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=vs(i[1]);s.push(l)}else a.done()}).next(()=>{de(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return QM(e,this.userId,n)}_r(e){return JM(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:va,lastStreamToken:""})}}function QM(t,e,n){const r=wp(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Nl(t).ee({range:i,X:!0},(a,l,c)=>{const[u,h,f]=a;u===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function Ai(t){return Kt(t,Kr)}function Nl(t){return Kt(t,bc)}function JM(t){return Kt(t,Jh)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new $a(0)}static cr(){return new $a(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RU{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new $a(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>ye.fromTimestamp(new We(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>xl(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(de(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return xl(e).ee((o,a)=>{const l=qu(a);l.sequenceNumber<=n&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>L.waitFor(i)).next(()=>s)}forEachTarget(e,n){return xl(e).ee((r,s)=>{const i=qu(s);n(i)})}lr(e){return mk(e).get(ym).next(n=>(de(n!==null,2888),n))}hr(e,n){return mk(e).put(ym,n)}Pr(e,n){return xl(e).put(UM(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=Fa(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return xl(e).ee({range:s,index:zP},(o,a,l)=>{const c=qu(a);Pd(n,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=$i(e);return n.forEach(o=>{const a=kn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),L.waitFor(s)}removeMatchingKeys(e,n,r){const s=$i(e);return L.forEach(n,i=>{const o=kn(i.path);return L.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=$i(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=$i(e);let i=Pe();return s.ee({range:r,X:!0},(o,a,l)=>{const c=vs(o[1]),u=new re(c);i=i.add(u)}).next(()=>i)}containsKey(e,n){const r=kn(n.path),s=IDBKeyRange.bound([r],[PP(r)],!1,!0);let i=0;return $i(e).ee({index:pb,X:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}At(e,n){return xl(e).get(n).next(r=>r?qu(r):null)}}function xl(t){return Kt(t,Tc)}function mk(t){return Kt(t,wa)}function $i(t){return Kt(t,Ec)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gk="LruGarbageCollector",PU=1048576;function yk([t,e],[n,r]){const s=Se(t,n);return s===0?Se(e,r):s}class MU{constructor(e){this.Ir=e,this.buffer=new Qe(yk),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();yk(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class YM{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){G(gk,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Mo(n)?G(gk,"Ignoring IndexedDB error during garbage collection: ",n):await il(n)}await this.Vr(3e5)})}}class OU{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return L.resolve(Pr.ce);const r=new MU(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(G("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(pk)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(G("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),pk):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(G("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),kl()<=De.DEBUG&&G("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function XM(t,e){return new OU(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU{constructor(e,n){this.db=e,this.garbageCollector=XM(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return Nf(e,r)}removeReference(e,n,r){return Nf(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Nf(e,n)}br(e,n){return function(s,i){let o=!1;return JM(s).te(a=>QM(s,a,i).next(l=>(l&&(o=!0),L.resolve(!l)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=n){const l=this.br(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,ye.min()),$i(e).delete(function(h){return[0,kn(h.path)]}(o))))});s.push(l)}}).next(()=>L.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Nf(e,n)}Sr(e,n){const r=$i(e);let s,i=Pr.ce;return r.ee({index:pb},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Pr.ce&&n(new re(vs(s)),i),i=c,s=l):i=Pr.ce}).next(()=>{i!==Pr.ce&&n(new re(vs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Nf(t,e){return $i(t).put(function(r,s){return{targetId:0,path:kn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZM{constructor(){this.changes=new gi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Nt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?L.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return qo(e).put(r)}removeEntry(e,n,r){return qo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Em(o),a[a.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Nt.newInvalidDocument(n);return qo(e).ee({index:xp,range:IDBKeyRange.only(Cu(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Nt.newInvalidDocument(n)};return qo(e).ee({index:xp,range:IDBKeyRange.only(Cu(n))},(s,i)=>{r={document:this.Cr(n,i),size:km(i)}}).next(()=>r)}getEntries(e,n){let r=ur();return this.Fr(e,n,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,n){let r=ur(),s=new yt(re.comparator);return this.Fr(e,n,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,km(o))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return L.resolve();let s=new Qe(xk);n.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Cu(s.first()),Cu(s.last())),o=s.getIterator();let a=o.getNext();return qo(e).ee({index:xp,range:i},(l,c,u)=>{const h=re.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&xk(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.j(Cu(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const o=n.path,a=[o.popLast().toArray(),o.lastSegment(),Em(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return qo(e).J(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let u=ur();for(const h of c){const f=this.Cr(re.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);f.isFoundDocument()&&(Md(n,f)||s.has(f.key))&&(u=u.insert(f.key,f))}return u})}getAllFromCollectionGroup(e,n,r,s){let i=ur();const o=wk(n,r),a=wk(n,mr.max());return qo(e).ee({index:BP,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.Cr(re.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&u.done()}).next(()=>i)}newChangeBuffer(e){return new jU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return vk(e).get(Hw).next(n=>(de(!!n,20021),n))}Dr(e,n){return vk(e).put(Hw,n)}Cr(e,n){if(n){const r=_U(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(ye.min())))return r}return Nt.newInvalidDocument(e)}}function e2(t){return new LU(t)}class jU extends ZM{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new gi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new Qe((i,o)=>Se(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=tk(this.Nr.serializer,o);s=s.add(i.path.popLast());const c=km(l);r+=c-a.size,n.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=tk(this.Nr.serializer,o.convertToNoDocument(ye.min()));n.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),L.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function vk(t){return Kt(t,Yh)}function qo(t){return Kt(t,gm)}function Cu(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function wk(t,e){const n=e.documentKey.path.toArray();return[t,Em(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function xk(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Se(n[i],r[i]),s)return s;return s=Se(n.length,r.length),s||(s=Se(n[n.length-2],r[r.length-2]),s||Se(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VU{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t2{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&mh(r.mutation,s,Jn.empty(),We.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Pe()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Pe()){const s=ws();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=Hu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=ws();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Pe()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,s){let i=ur();const o=ph(),a=function(){return ph()}();return n.forEach((l,c)=>{const u=r.get(c.key);s.has(c.key)&&(u===void 0||u.mutation instanceof yi)?i=i.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),mh(u.mutation,c,u.mutation.getFieldMask(),We.now())):o.set(c.key,Jn.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>a.set(c,new VU(u,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,n){const r=ph();let s=new yt((o,a)=>o-a),i=Pe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=r.get(l)||Jn.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(s.get(a.batchId)||Pe()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=yM();u.forEach(f=>{if(!i.has(f)){const m=SM(n.get(f),r.get(f));m!==null&&h.set(f,m),i=i.add(f)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return L.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return re.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):dM(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):L.resolve(ws());let a=Kh,l=i;return o.next(c=>L.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(u)?L.resolve():this.remoteDocumentCache.getEntry(e,u).next(f=>{l=l.insert(u,f)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Pe())).next(u=>({batchId:a,changes:gM(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new re(n)).next(r=>{let s=Hu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=Hu();return this.indexManager.getCollectionParents(e,i).next(a=>L.forEach(a,l=>{const c=function(h,f){return new Qc(f,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(u=>{u.forEach((h,f)=>{o=o.insert(h,f)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,Nt.newInvalidDocument(u)))});let a=Hu();return o.forEach((l,c)=>{const u=i.get(l);u!==void 0&&mh(u.mutation,c,Jn.empty(),We.now()),Md(n,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FU{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return L.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:Vn(s.createTime)}}(n)),L.resolve()}getNamedQuery(e,n){return L.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:HM(s.bundledQuery),readTime:Vn(s.readTime)}}(n)),L.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class BU{constructor(){this.overlays=new yt(re.comparator),this.qr=new Map}getOverlay(e,n){return L.resolve(this.overlays.get(n))}getOverlays(e,n){const r=ws();return L.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),L.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),L.resolve()}getOverlaysForCollection(e,n,r){const s=ws(),i=n.length+1,o=new re(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return L.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new yt((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let u=i.get(c.largestBatchId);u===null&&(u=ws(),i=i.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=ws(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=s)););return L.resolve(a)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Sb(n,r));let i=this.qr.get(n);i===void 0&&(i=Pe(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zU{constructor(){this.sessionToken=Bt.EMPTY_BYTE_STRING}getSessionToken(e){return L.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,L.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(){this.Qr=new Qe(en.$r),this.Ur=new Qe(en.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new en(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new en(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new re(new Ue([])),r=new en(n,e),s=new en(n,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new re(new Ue([])),r=new en(n,e),s=new en(n,e+1);let i=Pe();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new en(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class en{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return re.comparator(e.key,n.key)||Se(e.Yr,n.Yr)}static Kr(e,n){return Se(e.Yr,n.Yr)||re.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $U{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new Qe(en.$r)}checkEmpty(e){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Tb(i,n,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new en(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(e,n){return L.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return L.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?va:this.tr-1)}getAllMutationBatches(e){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new en(n,0),s=new en(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),L.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Qe(Se);return n.forEach(s=>{const i=new en(s,0),o=new en(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),L.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;re.isDocumentKey(i)||(i=i.child(""));const o=new en(new re(i),0);let a=new Qe(Se);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.Yr)),!0)},o),L.resolve(this.ti(a))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){de(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return L.forEach(n.mutations,s=>{const i=new en(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new en(n,0),s=this.Zr.firstAfterOrEqual(r);return L.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,L.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UU{constructor(e){this.ri=e,this.docs=function(){return new yt(re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return L.resolve(r?r.document.mutableCopy():Nt.newInvalidDocument(n))}getEntries(e,n){let r=ur();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Nt.newInvalidDocument(s))}),L.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=ur();const o=n.path,a=new re(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||db(DP(u),r)<=0||(s.has(u.key)||Md(n,u))&&(i=i.insert(u.key,u.mutableCopy()))}return L.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ue(9500)}ii(e,n){return L.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new HU(this)}getSize(e){return L.resolve(this.size)}}class HU extends ZM{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),L.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WU{constructor(e){this.persistence=e,this.si=new gi(n=>Fa(n),Pd),this.lastRemoteSnapshotVersion=ye.min(),this.highestTargetId=0,this.oi=0,this._i=new Nb,this.targetCount=0,this.ai=$a.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),L.resolve()}getLastRemoteSnapshotVersion(e){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return L.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),L.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new $a(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,L.resolve()}updateTargetData(e,n){return this.Pr(n),L.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,L.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),L.waitFor(i).next(()=>s)}getTargetCount(e){return L.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return L.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),L.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),L.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),L.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return L.resolve(r)}containsKey(e,n){return L.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(e,n){this.ui={},this.overlays={},this.ci=new Pr(0),this.li=!1,this.li=!0,this.hi=new zU,this.referenceDelegate=e(this),this.Pi=new WU(this),this.indexManager=new AU,this.remoteDocumentCache=function(s){return new UU(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new $M(n),this.Ii=new FU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new BU,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new $U(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){G("MemoryPersistence","Starting transaction:",e);const s=new qU(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return L.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class qU extends jP{constructor(e){super(),this.currentSequenceNumber=e}}class fy{constructor(e){this.persistence=e,this.Ri=new Nb,this.Vi=null}static mi(e){return new fy(e)}get fi(){if(this.Vi)return this.Vi;throw ue(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),L.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),L.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),L.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.fi,r=>{const s=re.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,ye.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return L.or([()=>L.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Cm{constructor(e,n){this.persistence=e,this.pi=new gi(r=>kn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=XM(this,n)}static mi(e,n){return new Cm(e,n)}Ei(){}di(e){return L.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return L.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?L.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,n).next(a=>{a||(r++,i.removeEntry(o,ye.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),L.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),L.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),L.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),L.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=bp(e.data.value)),n}br(e,n,r){return L.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return L.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KU{constructor(e){this.serializer=e}k(e,n,r,s){const i=new Xg("createOrUpgrade",n);r<1&&s>=1&&(function(l){l.createObjectStore(Rd)}(e),function(l){l.createObjectStore(Jh,{keyPath:i$}),l.createObjectStore(Kr,{keyPath:RS,autoIncrement:!0}).createIndex(ca,PS,{unique:!0}),l.createObjectStore(bc)}(e),_k(e),function(l){l.createObjectStore(Xo)}(e));let o=L.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Ec),l.deleteObjectStore(Tc),l.deleteObjectStore(wa)}(e),_k(e)),o=o.next(()=>function(l){const c=l.store(wa),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ye.min().toTimestamp(),targetCount:0};return c.put(ym,u)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store(Kr).J().next(h=>{l.deleteObjectStore(Kr),l.createObjectStore(Kr,{keyPath:RS,autoIncrement:!0}).createIndex(ca,PS,{unique:!0});const f=c.store(Kr),m=h.map(g=>f.put(g));return L.waitFor(m)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(Sc,{keyPath:p$})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(Yh)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(ey,{keyPath:m$})})(e),function(l){l.createObjectStore(ty,{keyPath:g$})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore(ny,{keyPath:T$});c.createIndex(qw,E$,{unique:!1}),c.createIndex(HP,S$,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore(gm,{keyPath:a$});c.createIndex(xp,l$),c.createIndex(BP,c$)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(Xo))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(mb,{keyPath:y$,autoIncrement:!0}).createIndex(Ww,v$,{unique:!1}),l.createObjectStore(uh,{keyPath:w$}).createIndex($P,x$,{unique:!1}),l.createObjectStore(hh,{keyPath:_$}).createIndex(UP,b$,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{n.objectStore(uh).clear()}).next(()=>{n.objectStore(hh).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(gb,{keyPath:k$})})(e)})),r<18&&s>=18&&yP()&&(o=o.next(()=>{n.objectStore(uh).clear()}).next(()=>{n.objectStore(hh).clear()})),o}wi(e){let n=0;return e.store(Xo).ee((r,s)=>{n+=km(s)}).next(()=>{const r={byteSize:n};return e.store(Yh).put(Hw,r)})}yi(e){const n=e.store(Jh),r=e.store(Kr);return n.J().next(s=>L.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,va],[i.userId,i.lastAcknowledgedBatchId]);return r.J(ca,o).next(a=>L.forEach(a,l=>{de(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const c=ea(this.serializer,l);return GM(e,i.userId,c).next(()=>{})}))}))}Si(e){const n=e.store(Ec),r=e.store(Xo);return e.store(wa).get(ym).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Ue(o),c=function(h){return[0,kn(h)]}(l);i.push(n.get(c).next(u=>u?L.resolve():(h=>n.put({targetId:0,path:kn(h),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>L.waitFor(i))})}bi(e,n){e.createObjectStore(Xh,{keyPath:f$});const r=n.store(Xh),s=new Ab,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:kn(l)})}};return n.store(Xo).ee({X:!0},(o,a)=>{const l=new Ue(o);return i(l.popLast())}).next(()=>n.store(bc).ee({X:!0},([o,a,l],c)=>{const u=vs(a);return i(u.popLast())}))}Di(e){const n=e.store(Tc);return n.ee((r,s)=>{const i=qu(s),o=UM(this.serializer,i);return n.put(o)})}Ci(e,n){const r=n.store(Xo),s=[];return r.ee((i,o)=>{const a=n.store(gm),l=function(h){return h.document?new re(Ue.fromString(h.document.name).popFirst(5)):h.noDocument?re.fromSegments(h.noDocument.path):h.unknownDocument?re.fromSegments(h.unknownDocument.path):ue(36783)}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>L.waitFor(s))}Fi(e,n){const r=n.store(Kr),s=e2(this.serializer),i=new Rb(fy.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let c=a.get(l.userId)??Pe();ea(this.serializer,l).keys().forEach(u=>c=c.add(u)),a.set(l.userId,c)}),L.forEach(a,(l,c)=>{const u=new hn(c),h=hy.wt(this.serializer,u),f=i.getIndexManager(u),m=dy.wt(u,this.serializer,f,i.referenceDelegate);return new t2(s,m,h,f).recalculateAndSaveOverlaysForDocumentKeys(new Kw(n,Pr.ce),l).next()})})}}function _k(t){t.createObjectStore(Ec,{keyPath:h$}).createIndex(pb,d$,{unique:!0}),t.createObjectStore(Tc,{keyPath:"targetId"}).createIndex(zP,u$,{unique:!0}),t.createObjectStore(wa)}const Ni="IndexedDbPersistence",Wv=18e5,qv=5e3,Kv="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",GU="main";class Pb{constructor(e,n,r,s,i,o,a,l,c,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=c,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=f=>Promise.resolve(),!Pb.v())throw new ee(B.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new DU(this,s),this.$i=n+GU,this.serializer=new $M(l),this.Ui=new fo(this.$i,this.Ni,new KU(this.serializer)),this.hi=new TU,this.Pi=new RU(this.referenceDelegate,this.serializer),this.remoteDocumentCache=e2(this.serializer),this.Ii=new bU,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,u===!1&&Ln(Ni,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ee(B.FAILED_PRECONDITION,Kv);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Pr(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Rf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Mo(e))return G(Ni,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return G(Ni,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Iu(e).get(ml).next(n=>L.resolve(this.es(n)))}ts(e){return Rf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,Wv)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=Kt(n,Sc);return r.J().next(s=>{const i=this.ss(s,Wv),o=s.filter(a=>i.indexOf(a)===-1);return L.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?L.resolve(!0):Iu(e).get(ml).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,qv)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new ee(B.FAILED_PRECONDITION,Kv);return!1}}return!(!this.networkEnabled||!this.inForeground)||Rf(e).J().next(r=>this.ss(r,qv).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&G(Ni,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Rd,Sc],e=>{const n=new Kw(e,Pr.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Rf(e).J().next(n=>this.ss(n,Wv).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return dy.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new NU(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return hy.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){G(Ni,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(l){return l===18?A$:l===17?GP:l===16?I$:l===15?yb:l===14?KP:l===13?qP:l===12?C$:l===11?WP:void ue(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new Kw(a,this.ci?this.ci.next():Pr.ce),n==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Ln(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new ee(B.FAILED_PRECONDITION,LP);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Iu(e).get(ml).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,qv)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ee(B.FAILED_PRECONDITION,Kv)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Iu(e).put(ml,n)}static v(){return fo.v()}Zi(e){const n=Iu(e);return n.get(ml).next(r=>this.es(r)?(G(Ni,"Releasing primary lease."),n.delete(ml)):L.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Ln(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;gP()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return G(Ni,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ln(Ni,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Ln("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Iu(t){return Kt(t,Rd)}function Rf(t){return Kt(t,Sc)}function QU(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mb{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Pe(),s=Pe();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Mb(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n2{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return gP()?8:VP(qt())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new JU;return this.Ss(e,n,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,n,o,a.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(kl()<=De.DEBUG&&G("QueryEngine","SDK will not create cache indexes for query:",Cl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),L.resolve()):(kl()<=De.DEBUG&&G("QueryEngine","Query:",Cl(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(kl()<=De.DEBUG&&G("QueryEngine","The SDK decides to create cache indexes for query:",Cl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Or(n))):L.resolve())}ys(e,n){if(WS(n))return L.resolve(null);let r=Or(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=_m(n,null,"F"),r=Or(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Pe(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Ds(n,a);return this.Cs(n,c,o,l.readTime)?this.ys(e,_m(n,null,"F")):this.vs(e,c,n,l)}))})))}ws(e,n,r,s){return WS(n)||s.isEqual(ye.min())?L.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(n,i);return this.Cs(n,o,r,s)?L.resolve(null):(kl()<=De.DEBUG&&G("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Cl(n)),this.vs(e,o,n,Xz(s,Kh)).next(a=>a))})}Ds(e,n){let r=new Qe(pM(e));return n.forEach((s,i)=>{Md(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return kl()<=De.DEBUG&&G("QueryEngine","Using full collection scan to execute query:",Cl(n)),this.ps.getDocumentsMatchingQuery(e,n,mr.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ob="LocalStore",YU=3e8;class XU{constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new yt(Se),this.xs=new gi(i=>Fa(i),Pd),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new t2(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function r2(t,e,n,r){return new XU(t,e,n,r)}async function s2(t,e){const n=ke(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Pe();for(const c of s){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of i){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(r,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function ZU(t,e){const n=ke(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,f=h.keys();let m=L.resolve();return f.forEach(g=>{m=m.next(()=>u.getEntry(l,g)).next(y=>{const v=c.docVersions.get(g);de(v!==null,48541),y.version.compareTo(v)<0&&(h.applyToRemoteDocument(y,c),y.isValidDocument()&&(y.setReadTime(c.commitVersion),u.addEntry(y)))})}),m.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Pe();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function i2(t){const e=ke(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function e6(t,e){const n=ke(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const a=[];e.targetChanges.forEach((u,h)=>{const f=s.get(h);if(!f)return;a.push(n.Pi.removeMatchingKeys(i,u.removedDocuments,h).next(()=>n.Pi.addMatchingKeys(i,u.addedDocuments,h)));let m=f.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?m=m.withResumeToken(Bt.EMPTY_BYTE_STRING,ye.min()).withLastLimboFreeSnapshotVersion(ye.min()):u.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(u.resumeToken,r)),s=s.insert(h,m),function(y,v,w){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=YU?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(f,m,u)&&a.push(n.Pi.updateTargetData(i,m))});let l=ur(),c=Pe();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(t6(i,o,e.documentUpdates).next(u=>{l=u.ks,c=u.qs})),!r.isEqual(ye.min())){const u=n.Pi.getLastRemoteSnapshotVersion(i).next(h=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return L.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(n.Ms=s,i))}function t6(t,e,n){let r=Pe(),s=Pe();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=ur();return n.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(ye.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):G(Ob,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:s}})}function n6(t,e){const n=ke(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=va),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function r6(t,e){const n=ke(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,L.resolve(s)):n.Pi.allocateTargetId(r).next(o=>(s=new Qs(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function ax(t,e,n){const r=ke(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Mo(o))throw o;G(Ob,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function bk(t,e,n){const r=ke(t);let s=ye.min(),i=Pe();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=ke(l),f=h.xs.get(u);return f!==void 0?L.resolve(h.Ms.get(f)):h.Pi.getTargetData(c,u)}(r,o,Or(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?s:ye.min(),n?i:Pe())).next(a=>(s6(r,H$(e),a),{documents:a,Qs:i})))}function s6(t,e,n){let r=t.Os.get(e)||ye.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class Tk{constructor(){this.activeTargetIds=J$()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class o2{constructor(){this.Mo=new Tk,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Tk,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i6{Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek="ConnectivityMonitor";class Sk{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){G(Ek,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){G(Ek,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Pf=null;function lx(){return Pf===null?Pf=function(){return 268435456+Math.round(2147483648*Math.random())}():Pf++,"0x"+Pf.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gv="RestConnection",o6={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class a6{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===vm?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const o=lx(),a=this.zo(e,n.toUriEncodedString());G(Gv,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:c}=new URL(a),u=Po(c);return this.Jo(e,a,l,r,u).then(h=>(G(Gv,`Received RPC '${e}' ${o}: `,h),h),h=>{throw ja(Gv,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",r),h})}Ho(e,n,r,s,i,o){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Gc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=o6[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l6{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xn="WebChannelConnection";class c6 extends a6{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const o=lx();return new Promise((a,l)=>{const c=new SP;c.setWithCredentials(!0),c.listenOnce(kP.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case yp.NO_ERROR:const h=c.getResponseJson();G(xn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case yp.TIMEOUT:G(xn,`RPC '${e}' ${o} timed out`),l(new ee(B.DEADLINE_EXCEEDED,"Request time out"));break;case yp.HTTP_ERROR:const f=c.getStatus();if(G(xn,`RPC '${e}' ${o} failed with status:`,f,"response text:",c.getResponseText()),f>0){let m=c.getResponseJson();Array.isArray(m)&&(m=m[0]);const g=m==null?void 0:m.error;if(g&&g.status&&g.message){const y=function(w){const _=w.toLowerCase().replace(/_/g,"-");return Object.values(B).indexOf(_)>=0?_:B.UNKNOWN}(g.status);l(new ee(y,g.message))}else l(new ee(B.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new ee(B.UNAVAILABLE,"Connection failed."));break;default:ue(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{G(xn,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(s);G(xn,`RPC '${e}' ${o} sending request:`,s),c.send(n,"POST",u,r,15)})}T_(e,n,r){const s=lx(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=AP(),a=IP(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const u=i.join("");G(xn,`Creating RPC '${e}' stream ${s}: ${u}`,l);const h=o.createWebChannel(u,l);this.I_(h);let f=!1,m=!1;const g=new l6({Yo:v=>{m?G(xn,`Not sending because RPC '${e}' stream ${s} is closed:`,v):(f||(G(xn,`Opening RPC '${e}' stream ${s} transport.`),h.open(),f=!0),G(xn,`RPC '${e}' stream ${s} sending:`,v),h.send(v))},Zo:()=>h.close()}),y=(v,w,_)=>{v.listen(w,E=>{try{_(E)}catch(N){setTimeout(()=>{throw N},0)}})};return y(h,Uu.EventType.OPEN,()=>{m||(G(xn,`RPC '${e}' stream ${s} transport opened.`),g.o_())}),y(h,Uu.EventType.CLOSE,()=>{m||(m=!0,G(xn,`RPC '${e}' stream ${s} transport closed`),g.a_(),this.E_(h))}),y(h,Uu.EventType.ERROR,v=>{m||(m=!0,ja(xn,`RPC '${e}' stream ${s} transport errored. Name:`,v.name,"Message:",v.message),g.a_(new ee(B.UNAVAILABLE,"The operation could not be completed")))}),y(h,Uu.EventType.MESSAGE,v=>{var w;if(!m){const _=v.data[0];de(!!_,16349);const E=_,N=(E==null?void 0:E.error)||((w=E[0])==null?void 0:w.error);if(N){G(xn,`RPC '${e}' stream ${s} received error:`,N);const R=N.status;let O=function(k){const I=Lt[k];if(I!==void 0)return IM(I)}(R),S=N.message;O===void 0&&(O=B.INTERNAL,S="Unknown error status: "+R+" with message "+N.message),m=!0,g.a_(new ee(O,S)),h.close()}else G(xn,`RPC '${e}' stream ${s} received:`,_),g.u_(_)}}),y(a,CP.STAT_EVENT,v=>{v.stat===zw.PROXY?G(xn,`RPC '${e}' stream ${s} detected buffering proxy`):v.stat===zw.NOPROXY&&G(xn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{g.__()},0),g}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function u6(){return typeof window<"u"?window:null}function Cp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function py(t){return new hU(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a2{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&G("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kk="PersistentStream";class l2{constructor(e,n,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new a2(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===B.RESOURCE_EXHAUSTED?(Ln(n.toString()),Ln("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===B.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new ee(B.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return G(kk,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(G(kk,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class h6 extends l2{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=pU(this.serializer,e),r=function(i){if(!("targetChange"in i))return ye.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?ye.min():o.readTime?Vn(o.readTime):ye.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=nx(this.serializer),n.addTarget=function(i,o){let a;const l=o.target;if(a=wm(l)?{documents:LM(i,l)}:{query:jM(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=RM(i,o.resumeToken);const c=ex(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(ye.min())>0){a.readTime=Mc(i,o.snapshotVersion.toTimestamp());const c=ex(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=gU(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=nx(this.serializer),n.removeTarget=e,this.q_(n)}}class d6 extends l2{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return de(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,de(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){de(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=mU(e.writeResults,e.commitTime),r=Vn(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=nx(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Tm(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class f6{}class p6 extends f6{constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new ee(B.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,tx(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ee(B.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,tx(n,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===B.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ee(B.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class m6{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ln(n),this.aa=!1):G("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua="RemoteStore";class g6{constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{ol(this)&&(G(Ua,"Restarting streams for network reachability change."),await async function(l){const c=ke(l);c.Ea.add(4),await Dd(c),c.Ra.set("Unknown"),c.Ea.delete(4),await my(c)}(this))})}),this.Ra=new m6(r,s)}}async function my(t){if(ol(t))for(const e of t.da)await e(!0)}async function Dd(t){for(const e of t.da)await e(!1)}function c2(t,e){const n=ke(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Vb(n)?jb(n):Yc(n).O_()&&Lb(n,e))}function Db(t,e){const n=ke(t),r=Yc(n);n.Ia.delete(e),r.O_()&&u2(n,e),n.Ia.size===0&&(r.O_()?r.L_():ol(n)&&n.Ra.set("Unknown"))}function Lb(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ye.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Yc(t).Y_(e)}function u2(t,e){t.Va.Ue(e),Yc(t).Z_(e)}function jb(t){t.Va=new aU({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Yc(t).start(),t.Ra.ua()}function Vb(t){return ol(t)&&!Yc(t).x_()&&t.Ia.size>0}function ol(t){return ke(t).Ea.size===0}function h2(t){t.Va=void 0}async function y6(t){t.Ra.set("Online")}async function v6(t){t.Ia.forEach((e,n)=>{Lb(t,e)})}async function w6(t,e){h2(t),Vb(t)?(t.Ra.ha(e),jb(t)):t.Ra.set("Unknown")}async function x6(t,e,n){if(t.Ra.set("Online"),e instanceof NM&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(t,e)}catch(r){G(Ua,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Im(t,r)}else if(e instanceof Sp?t.Va.Ze(e):e instanceof AM?t.Va.st(e):t.Va.tt(e),!n.isEqual(ye.min()))try{const r=await i2(t.localStore);n.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=i.Ia.get(c);u&&i.Ia.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=i.Ia.get(l);if(!u)return;i.Ia.set(l,u.withResumeToken(Bt.EMPTY_BYTE_STRING,u.snapshotVersion)),u2(i,l);const h=new Qs(u.target,l,c,u.sequenceNumber);Lb(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){G(Ua,"Failed to raise snapshot:",r),await Im(t,r)}}async function Im(t,e,n){if(!Mo(e))throw e;t.Ea.add(1),await Dd(t),t.Ra.set("Offline"),n||(n=()=>i2(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{G(Ua,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await my(t)})}function d2(t,e){return e().catch(n=>Im(t,n,e))}async function Ld(t){const e=ke(t),n=Eo(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:va;for(;_6(e);)try{const s=await n6(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,b6(e,s)}catch(s){await Im(e,s)}f2(e)&&p2(e)}function _6(t){return ol(t)&&t.Ta.length<10}function b6(t,e){t.Ta.push(e);const n=Eo(t);n.O_()&&n.X_&&n.ea(e.mutations)}function f2(t){return ol(t)&&!Eo(t).x_()&&t.Ta.length>0}function p2(t){Eo(t).start()}async function T6(t){Eo(t).ra()}async function E6(t){const e=Eo(t);for(const n of t.Ta)e.ea(n.mutations)}async function S6(t,e,n){const r=t.Ta.shift(),s=Eb.from(r,e,n);await d2(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Ld(t)}async function k6(t,e){e&&Eo(t).X_&&await async function(r,s){if(function(o){return sU(o)&&o!==B.ABORTED}(s.code)){const i=r.Ta.shift();Eo(r).B_(),await d2(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ld(r)}}(t,e),f2(t)&&p2(t)}async function Ck(t,e){const n=ke(t);n.asyncQueue.verifyOperationInProgress(),G(Ua,"RemoteStore received new credentials");const r=ol(n);n.Ea.add(3),await Dd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await my(n)}async function C6(t,e){const n=ke(t);e?(n.Ea.delete(2),await my(n)):e||(n.Ea.add(2),await Dd(n),n.Ra.set("Unknown"))}function Yc(t){return t.ma||(t.ma=function(n,r,s){const i=ke(n);return i.sa(),new h6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:y6.bind(null,t),t_:v6.bind(null,t),r_:w6.bind(null,t),H_:x6.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Vb(t)?jb(t):t.Ra.set("Unknown")):(await t.ma.stop(),h2(t))})),t.ma}function Eo(t){return t.fa||(t.fa=function(n,r,s){const i=ke(n);return i.sa(),new d6(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:T6.bind(null,t),r_:k6.bind(null,t),ta:E6.bind(null,t),na:S6.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await Ld(t)):(await t.fa.stop(),t.Ta.length>0&&(G(Ua,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fb{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Es,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,a=new Fb(e,n,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ee(B.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Bb(t,e){if(Ln("AsyncQueue",`${e}: ${t}`),Mo(t))return new ee(B.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ic{static emptySet(e){return new ic(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||re.comparator(n.key,r.key):(n,r)=>re.comparator(n.key,r.key),this.keyedMap=Hu(),this.sortedSet=new yt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ic)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ic;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ik{constructor(){this.ga=new yt(re.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):ue(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class Oc{constructor(e,n,r,s,i,o,a,l,c){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new Oc(e,n,ic.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oy(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class I6{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class A6{constructor(){this.queries=Ak(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=ke(n),i=s.queries;s.queries=Ak(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new ee(B.ABORTED,"Firestore shutting down"))}}function Ak(){return new gi(t=>fM(t),oy)}async function m2(t,e){const n=ke(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new I6,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const a=Bb(o,`Initialization of query '${Cl(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&zb(n)}async function g2(t,e){const n=ke(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function N6(t,e){const n=ke(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&zb(n)}function R6(t,e,n){const r=ke(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function zb(t){t.Ca.forEach(e=>{e.next()})}var cx,Nk;(Nk=cx||(cx={})).Ma="default",Nk.Cache="cache";class y2{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new Oc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=Oc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==cx.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v2{constructor(e){this.key=e}}class w2{constructor(e){this.key=e}}class P6{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Pe(),this.mutatedKeys=Pe(),this.eu=pM(e),this.tu=new ic(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new Ik,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const f=s.get(u),m=Md(this.query,h)?h:null,g=!!f&&this.mutatedKeys.has(f.key),y=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let v=!1;f&&m?f.data.isEqual(m.data)?g!==y&&(r.track({type:3,doc:m}),v=!0):this.su(f,m)||(r.track({type:2,doc:m}),v=!0,(l&&this.eu(m,l)>0||c&&this.eu(m,c)<0)&&(a=!0)):!f&&m?(r.track({type:0,doc:m}),v=!0):f&&!m&&(r.track({type:1,doc:f}),v=!0,(l||c)&&(a=!0)),v&&(m?(o=o.add(m),i=y?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,h)=>function(m,g){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ue(20277,{Rt:v})}};return y(m)-y(g)}(u.type,h.type)||this.eu(u.doc,h.doc)),this.ou(r),s=s??!1;const a=n&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new Oc(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Ik,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Pe(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new w2(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new v2(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Pe();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return Oc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const $b="SyncEngine";class M6{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class O6{constructor(e){this.key=e,this.hu=!1}}class D6{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new gi(a=>fM(a),oy),this.Iu=new Map,this.Eu=new Set,this.du=new yt(re.comparator),this.Au=new Map,this.Ru=new Nb,this.Vu={},this.mu=new Map,this.fu=$a.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function L6(t,e,n=!0){const r=S2(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await x2(r,e,n,!0),s}async function j6(t,e){const n=S2(t);await x2(n,e,!0,!1)}async function x2(t,e,n,r){const s=await r6(t.localStore,Or(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await V6(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&c2(t.remoteStore,s),a}async function V6(t,e,n,r,s){t.pu=(h,f,m)=>async function(y,v,w,_){let E=v.view.ru(w);E.Cs&&(E=await bk(y.localStore,v.query,!1).then(({documents:S})=>v.view.ru(S,E)));const N=_&&_.targetChanges.get(v.targetId),R=_&&_.targetMismatches.get(v.targetId)!=null,O=v.view.applyChanges(E,y.isPrimaryClient,N,R);return Pk(y,v.targetId,O.au),O.snapshot}(t,h,f,m);const i=await bk(t.localStore,e,!0),o=new P6(e,i.Qs),a=o.ru(i.documents),l=Od.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),c=o.applyChanges(a,t.isPrimaryClient,l);Pk(t,n,c.au);const u=new M6(e,n,o);return t.Tu.set(e,u),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),c.snapshot}async function F6(t,e,n){const r=ke(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!oy(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ax(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Db(r.remoteStore,s.targetId),ux(r,s.targetId)}).catch(il)):(ux(r,s.targetId),await ax(r.localStore,s.targetId,!0))}async function B6(t,e){const n=ke(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Db(n.remoteStore,r.targetId))}async function z6(t,e,n){const r=k2(t);try{const s=await function(o,a){const l=ke(o),c=We.now(),u=a.reduce((m,g)=>m.add(g.key),Pe());let h,f;return l.persistence.runTransaction("Locally write mutations","readwrite",m=>{let g=ur(),y=Pe();return l.Ns.getEntries(m,u).next(v=>{g=v,g.forEach((w,_)=>{_.isValidDocument()||(y=y.add(w))})}).next(()=>l.localDocuments.getOverlayedDocuments(m,g)).next(v=>{h=v;const w=[];for(const _ of a){const E=nU(_,h.get(_.key).overlayedDocument);E!=null&&w.push(new yi(_.key,E,sM(E.value.mapValue),Sn.exists(!0)))}return l.mutationQueue.addMutationBatch(m,c,w,a)}).next(v=>{f=v;const w=v.applyToLocalDocumentSet(h,y);return l.documentOverlayCache.saveOverlays(m,v.batchId,w)})}).then(()=>({batchId:f.batchId,changes:gM(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new yt(Se)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(r,s.batchId,n),await jd(r,s.changes),await Ld(r.remoteStore)}catch(s){const i=Bb(s,"Failed to persist write");n.reject(i)}}async function _2(t,e){const n=ke(t);try{const r=await e6(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Au.get(i);o&&(de(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?de(o.hu,14607):s.removedDocuments.size>0&&(de(o.hu,42227),o.hu=!1))}),await jd(n,r,e)}catch(r){await il(r)}}function Rk(t,e,n){const r=ke(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=ke(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const f of h.Sa)f.va(a)&&(c=!0)}),c&&zb(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function $6(t,e,n){const r=ke(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new yt(re.comparator);o=o.insert(i,Nt.newNoDocument(i,ye.min()));const a=Pe().add(i),l=new uy(ye.min(),new Map,new yt(Se),o,a);await _2(r,l),r.du=r.du.remove(i),r.Au.delete(e),Ub(r)}else await ax(r.localStore,e,!1).then(()=>ux(r,e,n)).catch(il)}async function U6(t,e){const n=ke(t),r=e.batch.batchId;try{const s=await ZU(n.localStore,e);T2(n,r,null),b2(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await jd(n,s)}catch(s){await il(s)}}async function H6(t,e,n){const r=ke(t);try{const s=await function(o,a){const l=ke(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(de(h!==null,37113),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(r.localStore,e);T2(r,e,n),b2(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await jd(r,s)}catch(s){await il(s)}}function b2(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function T2(t,e,n){const r=ke(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function ux(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||E2(t,r)})}function E2(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(Db(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Ub(t))}function Pk(t,e,n){for(const r of n)r instanceof v2?(t.Ru.addReference(r.key,e),W6(t,r)):r instanceof w2?(G($b,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||E2(t,r.key)):ue(19791,{wu:r})}function W6(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(G($b,"New document in limbo: "+n),t.Eu.add(r),Ub(t))}function Ub(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new re(Ue.fromString(e)),r=t.fu.next();t.Au.set(r,new O6(n)),t.du=t.du.insert(n,r),c2(t.remoteStore,new Qs(Or(iy(n.path)),r,"TargetPurposeLimboResolution",Pr.ce))}}async function jd(t,e,n){const r=ke(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,n).then(c=>{var u;if((c||n)&&r.isPrimaryClient){const h=c?!c.fromCache:(u=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){s.push(c);const h=Mb.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,c){const u=ke(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>L.forEach(c,f=>L.forEach(f.Es,m=>u.persistence.referenceDelegate.addReference(h,f.targetId,m)).next(()=>L.forEach(f.ds,m=>u.persistence.referenceDelegate.removeReference(h,f.targetId,m)))))}catch(h){if(!Mo(h))throw h;G(Ob,"Failed to update sequence numbers: "+h)}for(const h of c){const f=h.targetId;if(!h.fromCache){const m=u.Ms.get(f),g=m.snapshotVersion,y=m.withLastLimboFreeSnapshotVersion(g);u.Ms=u.Ms.insert(f,y)}}}(r.localStore,i))}async function q6(t,e){const n=ke(t);if(!n.currentUser.isEqual(e)){G($b,"User change. New user:",e.toKey());const r=await s2(n.localStore,e);n.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new ee(B.CANCELLED,o))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await jd(n,r.Ls)}}function K6(t,e){const n=ke(t),r=n.Au.get(e);if(r&&r.hu)return Pe().add(r.key);{let s=Pe();const i=n.Iu.get(e);if(!i)return s;for(const o of i){const a=n.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function S2(t){const e=ke(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=_2.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=K6.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=$6.bind(null,e),e.Pu.H_=N6.bind(null,e.eventManager),e.Pu.yu=R6.bind(null,e.eventManager),e}function k2(t){const e=ke(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=U6.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=H6.bind(null,e),e}class id{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=py(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return r2(this.persistence,new n2,e.initialUser,this.serializer)}Cu(e){return new Rb(fy.mi,this.serializer)}Du(e){return new o2}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}id.provider={build:()=>new id};class G6 extends id{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){de(this.persistence.referenceDelegate instanceof Cm,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new YM(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?bn.withCacheSize(this.cacheSizeBytes):bn.DEFAULT;return new Rb(r=>Cm.mi(r,n),this.serializer)}}class Q6 extends id{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await k2(this.xu.syncEngine),await Ld(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return r2(this.persistence,new n2,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new YM(r,e.asyncQueue,n)}Mu(e,n){const r=new n$(n,this.persistence);return new t$(e.asyncQueue,r)}Cu(e){const n=QU(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?bn.withCacheSize(this.cacheSizeBytes):bn.DEFAULT;return new Pb(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,u6(),Cp(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new o2}}class Am{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Rk(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=q6.bind(null,this.syncEngine),await C6(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new A6}()}createDatastore(e){const n=py(e.databaseInfo.databaseId),r=function(i){return new c6(i)}(e.databaseInfo);return function(i,o,a,l){return new p6(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,a){return new g6(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Rk(this.syncEngine,n,0),function(){return Sk.v()?new Sk:new i6}())}createSyncEngine(e,n){return function(s,i,o,a,l,c,u){const h=new D6(s,i,o,a,l,c);return u&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=ke(s);G(Ua,"RemoteStore shutting down."),i.Ea.add(5),await Dd(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}Am.provider={build:()=>new Am};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C2{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ln("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const So="FirestoreClient";class J6{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=hn.UNAUTHENTICATED,this.clientId=hb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{G(So,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(G(So,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Es;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Bb(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Qv(t,e){t.asyncQueue.verifyOperationInProgress(),G(So,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await s2(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Mk(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Y6(t);G(So,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Ck(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Ck(e.remoteStore,s)),t._onlineComponents=e}async function Y6(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){G(So,"Using user provided OfflineComponentProvider");try{await Qv(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===B.FAILED_PRECONDITION||s.code===B.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;ja("Error using user provided cache. Falling back to memory cache: "+n),await Qv(t,new id)}}else G(So,"Using default OfflineComponentProvider"),await Qv(t,new G6(void 0));return t._offlineComponents}async function I2(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(G(So,"Using user provided OnlineComponentProvider"),await Mk(t,t._uninitializedComponentsProvider._online)):(G(So,"Using default OnlineComponentProvider"),await Mk(t,new Am))),t._onlineComponents}function X6(t){return I2(t).then(e=>e.syncEngine)}async function A2(t){const e=await I2(t),n=e.eventManager;return n.onListen=L6.bind(null,e.syncEngine),n.onUnlisten=F6.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=j6.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=B6.bind(null,e.syncEngine),n}function Z6(t,e,n={}){const r=new Es;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new C2({next:f=>{u.Nu(),o.enqueueAndForget(()=>g2(i,h));const m=f.docs.has(a);!m&&f.fromCache?c.reject(new ee(B.UNAVAILABLE,"Failed to get document because the client is offline.")):m&&f.fromCache&&l&&l.source==="server"?c.reject(new ee(B.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new y2(iy(a.path),u,{includeMetadataChanges:!0,qa:!0});return m2(i,h)}(await A2(t),t.asyncQueue,e,n,r)),r.promise}function eH(t,e,n={}){const r=new Es;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new C2({next:f=>{u.Nu(),o.enqueueAndForget(()=>g2(i,h)),f.fromCache&&l.source==="server"?c.reject(new ee(B.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(f)},error:f=>c.reject(f)}),h=new y2(a,u,{includeMetadataChanges:!0,qa:!0});return m2(i,h)}(await A2(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function N2(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ok=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const R2="firestore.googleapis.com",Dk=!0;class Lk{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ee(B.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=R2,this.ssl=Dk}else this.host=e.host,this.ssl=e.ssl??Dk;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=KM;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<PU)throw new ee(B.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}Yz("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=N2(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ee(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ee(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ee(B.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class gy{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Lk({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ee(B.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ee(B.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Lk(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new zz;switch(r.type){case"firstParty":return new Wz(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ee(B.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Ok.get(n);r&&(G("ComponentProvider","Removing Datastore"),Ok.delete(n),r.terminate())}(this),Promise.resolve()}}function tH(t,e,n,r={}){var c;t=Br(t,gy);const s=Po(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;s&&(ib(`https://${a}`),ob("Firestore",!0)),i.host!==R2&&i.host!==a&&ja("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Oa(l,o)&&(t._setSettings(l),r.mockUserToken)){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=hn.MOCK_USER;else{u=pP(r.mockUserToken,(c=t._app)==null?void 0:c.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new ee(B.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new hn(f)}t._authCredentials=new $z(new RP(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Do{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Do(this.firestore,e,this._query)}}class Dt{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new po(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Dt(this.firestore,e,this._key)}toJSON(){return{type:Dt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Nd(n,Dt._jsonSchema))return new Dt(e,r||null,new re(Ue.fromString(n.referencePath)))}}Dt._jsonSchemaVersion="firestore/documentReference/1.0",Dt._jsonSchema={type:Vt("string",Dt._jsonSchemaVersion),referencePath:Vt("string")};class po extends Do{constructor(e,n,r){super(e,n,iy(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Dt(this.firestore,null,new re(e))}withConverter(e){return new po(this.firestore,e,this._path)}}function Vd(t,e,...n){if(t=Tt(t),MP("collection","path",e),t instanceof gy){const r=Ue.fromString(e,...n);return kS(r),new po(t,null,r)}{if(!(t instanceof Dt||t instanceof po))throw new ee(B.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ue.fromString(e,...n));return kS(r),new po(t.firestore,null,r)}}function Wn(t,e,...n){if(t=Tt(t),arguments.length===1&&(e=hb.newId()),MP("doc","path",e),t instanceof gy){const r=Ue.fromString(e,...n);return SS(r),new Dt(t,null,new re(r))}{if(!(t instanceof Dt||t instanceof po))throw new ee(B.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ue.fromString(e,...n));return SS(r),new Dt(t.firestore,t instanceof po?t.converter:null,new re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jk="AsyncQueue";class Vk{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new a2(this,"async_queue_retry"),this._c=()=>{const r=Cp();r&&G(jk,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Cp();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Cp();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Es;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Mo(e))throw e;G(jk,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Ln("INTERNAL UNHANDLED ERROR: ",Fk(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Fb.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ue(47125,{Pc:Fk(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function Fk(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Lo extends gy{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new Vk,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Vk(e),this._firestoreClient=void 0,await e}}}function nH(t,e){const n=typeof t=="object"?t:cb(),r=typeof t=="string"?t:vm,s=Jg(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=hP("firestore");i&&tH(s,...i)}return s}function Hb(t){if(t._terminated)throw new ee(B.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||P2(t),t._firestoreClient}function P2(t){var r,s,i;const e=t._freezeSettings(),n=function(a,l,c,u){return new R$(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,N2(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new J6(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}function rH(t,e){ja("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return sH(t,Am.provider,{build:r=>new Q6(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function sH(t,e,n){if((t=Br(t,Lo))._firestoreClient||t._terminated)throw new ee(B.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ee(B.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},P2(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ar{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ar(Bt.fromBase64String(e))}catch(n){throw new ee(B.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Ar(Bt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ar._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Nd(e,Ar._jsonSchema))return Ar.fromBase64String(e.bytes)}}Ar._jsonSchemaVersion="firestore/bytes/1.0",Ar._jsonSchema={type:Vt("string",Ar._jsonSchemaVersion),bytes:Vt("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yy{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ee(B.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ss{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ee(B.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ee(B.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Se(this._lat,e._lat)||Se(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ss._jsonSchemaVersion}}static fromJSON(e){if(Nd(e,Ss._jsonSchema))return new Ss(e.latitude,e.longitude)}}Ss._jsonSchemaVersion="firestore/geoPoint/1.0",Ss._jsonSchema={type:Vt("string",Ss._jsonSchemaVersion),latitude:Vt("number"),longitude:Vt("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:ks._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Nd(e,ks._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new ks(e.vectorValues);throw new ee(B.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}ks._jsonSchemaVersion="firestore/vectorValue/1.0",ks._jsonSchema={type:Vt("string",ks._jsonSchemaVersion),vectorValues:Vt("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iH=/^__.*__$/;class oH{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new yi(e,this.data,this.fieldMask,n,this.fieldTransforms):new Jc(e,this.data,n,this.fieldTransforms)}}class M2{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new yi(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function O2(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ue(40011,{Ac:t})}}class Wb{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Wb({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Nm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(O2(this.Ac)&&iH.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class aH{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||py(e)}Cc(e,n,r,s=!1){return new Wb({Ac:e,methodName:n,Dc:r,path:wt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function wy(t){const e=t._freezeSettings(),n=py(t._databaseId);return new aH(t._databaseId,!!e.ignoreUndefinedProperties,n)}function D2(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);Kb("Data must be an object, but it was:",o,r);const a=L2(r,o);let l,c;if(i.merge)l=new Jn(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const h of i.mergeFields){const f=hx(e,h,n);if(!o.contains(f))throw new ee(B.INVALID_ARGUMENT,`Field '${f}' is specified in your field mask but missing from your input data.`);V2(u,f)||u.push(f)}l=new Jn(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new oH(new En(a),l,c)}class xy extends vy{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof xy}}class qb extends vy{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new Pc(e.serializer,wM(e.serializer,this.Fc));return new EM(e.path,n)}isEqual(e){return e instanceof qb&&this.Fc===e.Fc}}function lH(t,e,n,r){const s=t.Cc(1,e,n);Kb("Data must be an object, but it was:",s,r);const i=[],o=En.empty();Oo(r,(l,c)=>{const u=Gb(e,l,n);c=Tt(c);const h=s.yc(u);if(c instanceof xy)i.push(u);else{const f=Fd(c,h);f!=null&&(i.push(u),o.set(u,f))}});const a=new Jn(i);return new M2(o,a,s.fieldTransforms)}function cH(t,e,n,r,s,i){const o=t.Cc(1,e,n),a=[hx(e,r,n)],l=[s];if(i.length%2!=0)throw new ee(B.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let f=0;f<i.length;f+=2)a.push(hx(e,i[f])),l.push(i[f+1]);const c=[],u=En.empty();for(let f=a.length-1;f>=0;--f)if(!V2(c,a[f])){const m=a[f];let g=l[f];g=Tt(g);const y=o.yc(m);if(g instanceof xy)c.push(m);else{const v=Fd(g,y);v!=null&&(c.push(m),u.set(m,v))}}const h=new Jn(c);return new M2(u,h,o.fieldTransforms)}function uH(t,e,n,r=!1){return Fd(n,t.Cc(r?4:3,e))}function Fd(t,e){if(j2(t=Tt(t)))return Kb("Unsupported field value:",e,t),L2(t,e);if(t instanceof vy)return function(r,s){if(!O2(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Fd(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Tt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return wM(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=We.fromDate(r);return{timestampValue:Mc(s.serializer,i)}}if(r instanceof We){const i=new We(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Mc(s.serializer,i)}}if(r instanceof Ss)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ar)return{bytesValue:RM(s.serializer,r._byteString)};if(r instanceof Dt){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Cb(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof ks)return function(o,a){return{mapValue:{fields:{[wb]:{stringValue:xb},[kc]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return bb(a.serializer,c)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${Yg(r)}`)}(t,e)}function L2(t,e){const n={};return QP(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Oo(t,(r,s)=>{const i=Fd(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function j2(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof We||t instanceof Ss||t instanceof Ar||t instanceof Dt||t instanceof vy||t instanceof ks)}function Kb(t,e,n){if(!j2(n)||!OP(n)){const r=Yg(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function hx(t,e,n){if((e=Tt(e))instanceof yy)return e._internalPath;if(typeof e=="string")return Gb(t,e);throw Nm("Field path arguments must be of type string or ",t,!1,void 0,n)}const hH=new RegExp("[~\\*/\\[\\]]");function Gb(t,e,n){if(e.search(hH)>=0)throw Nm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new yy(...e.split("."))._internalPath}catch{throw Nm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Nm(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ee(B.INVALID_ARGUMENT,a+t+l)}function V2(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F2{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Dt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new dH(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(_y("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class dH extends F2{data(){return super.data()}}function _y(t,e){return typeof e=="string"?Gb(t,e):e instanceof yy?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fH(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ee(B.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Qb{}class Jb extends Qb{}function Jv(t,e,...n){let r=[];e instanceof Qb&&r.push(e),r=r.concat(n),function(i){const o=i.filter(l=>l instanceof Yb).length,a=i.filter(l=>l instanceof by).length;if(o>1||o>0&&a>0)throw new ee(B.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class by extends Jb{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new by(e,n,r)}_apply(e){const n=this._parse(e);return B2(e._query,n),new Do(e.firestore,e.converter,Zw(e._query,n))}_parse(e){const n=wy(e.firestore);return function(i,o,a,l,c,u,h){let f;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new ee(B.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){$k(h,u);const g=[];for(const y of h)g.push(zk(l,i,y));f={arrayValue:{values:g}}}else f=zk(l,i,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||$k(h,u),f=uH(a,o,h,u==="in"||u==="not-in");return Le.create(c,u,f)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function pH(t,e,n){const r=e,s=_y("where",t);return by._create(s,r,n)}class Yb extends Qb{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Yb(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Ke.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)B2(o,l),o=Zw(o,l)}(e._query,n),new Do(e.firestore,e.converter,Zw(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Xb extends Jb{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new Xb(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new ee(B.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ee(B.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new rd(i,o)}(e._query,this._field,this._direction);return new Do(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Qc(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function mH(t,e="asc"){const n=e,r=_y("orderBy",t);return Xb._create(r,n)}class Zb extends Jb{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new Zb(e,n,r)}_apply(e){return new Do(e.firestore,e.converter,_m(e._query,this._limit,this._limitType))}}function Bk(t){return Zb._create("limit",t,"F")}function zk(t,e,n){if(typeof(n=Tt(n))=="string"){if(n==="")throw new ee(B.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!dM(e)&&n.indexOf("/")!==-1)throw new ee(B.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ue.fromString(n));if(!re.isDocumentKey(r))throw new ee(B.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return td(t,new re(r))}if(n instanceof Dt)return td(t,n._key);throw new ee(B.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Yg(n)}.`)}function $k(t,e){if(!Array.isArray(t)||t.length===0)throw new ee(B.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function B2(t,e){const n=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ee(B.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ee(B.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class gH{convertValue(e,n="none"){switch(bo(e)){case 0:return null;case 1:return e.booleanValue;case 2:return mt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(di(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ue(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Oo(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[kc].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>mt(o.doubleValue));return new ks(n)}convertGeoPoint(e){return new Ss(mt(e.latitude),mt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=ry(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(Zh(e));default:return null}}convertTimestamp(e){const n=hi(e);return new We(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ue.fromString(e);de(zM(r),9688,{name:e});const s=new Va(r.get(1),r.get(3)),i=new re(r.popFirst(5));return s.isEqual(n)||Ln(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z2(t,e,n){let r;return r=t?t.toFirestore(e):e,r}class Ku{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class _a extends F2{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Ip(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(_y("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ee(B.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=_a._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}_a._jsonSchemaVersion="firestore/documentSnapshot/1.0",_a._jsonSchema={type:Vt("string",_a._jsonSchemaVersion),bundleSource:Vt("string","DocumentSnapshot"),bundleName:Vt("string"),bundle:Vt("string")};class Ip extends _a{data(e={}){return super.data(e)}}class oc{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Ku(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Ip(this._firestore,this._userDataWriter,r.key,r,new Ku(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ee(B.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Ip(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ku(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Ip(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Ku(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:yH(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ee(B.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=oc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=hb.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function yH(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ue(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ap(t){t=Br(t,Dt);const e=Br(t.firestore,Lo);return Z6(Hb(e),t._key).then(n=>wH(e,t,n))}oc._jsonSchemaVersion="firestore/querySnapshot/1.0",oc._jsonSchema={type:Vt("string",oc._jsonSchemaVersion),bundleSource:Vt("string","QuerySnapshot"),bundleName:Vt("string"),bundle:Vt("string")};class $2 extends gH{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ar(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Dt(this.firestore,null,n)}}function Yv(t){t=Br(t,Do);const e=Br(t.firestore,Lo),n=Hb(e),r=new $2(e);return fH(t._query),eH(n,t._query).then(s=>new oc(e,r,t,s))}function vH(t,e,n){t=Br(t,Dt);const r=Br(t.firestore,Lo),s=z2(t.converter,e);return Ty(r,[D2(wy(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,Sn.none())])}function Mi(t,e,n,...r){t=Br(t,Dt);const s=Br(t.firestore,Lo),i=wy(s);let o;return o=typeof(e=Tt(e))=="string"||e instanceof yy?cH(i,"updateDoc",t._key,e,n,r):lH(i,"updateDoc",t._key,e),Ty(s,[o.toMutation(t._key,Sn.exists(!0))])}function Uk(t){return Ty(Br(t.firestore,Lo),[new cy(t._key,Sn.none())])}function Mf(t,e){const n=Br(t.firestore,Lo),r=Wn(t),s=z2(t.converter,e);return Ty(n,[D2(wy(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Sn.exists(!1))]).then(()=>r)}function Ty(t,e){return function(r,s){const i=new Es;return r.asyncQueue.enqueueAndForget(async()=>z6(await X6(r),s,i)),i.promise}(Hb(t),e)}function wH(t,e,n){const r=n.docs.get(e._key),s=new $2(t);return new _a(t,s,e._key,r,new Ku(n.hasPendingWrites,n.fromCache),e.converter)}function Hk(t){return new qb("increment",t)}(function(e,n=!0){(function(s){Gc=s})(sl),Da(new _o("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Lo(new Uz(r.getProvider("auth-internal")),new qz(o,r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ee(B.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Va(c.options.projectId,u)}(o,s),o);return i={useFetchStreams:n,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Ts(_S,bS,e),Ts(_S,bS,"esm2020")})();function U2(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const xH=U2,H2=new Id("auth","Firebase",U2());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rm=new ab("@firebase/auth");function _H(t,...e){Rm.logLevel<=De.WARN&&Rm.warn(`Auth (${sl}): ${t}`,...e)}function Np(t,...e){Rm.logLevel<=De.ERROR&&Rm.error(`Auth (${sl}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ss(t,...e){throw eT(t,...e)}function Cs(t,...e){return eT(t,...e)}function W2(t,e,n){const r={...xH(),[e]:n};return new Id("auth","Firebase",r).create(e,{appName:t.name})}function ti(t){return W2(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function eT(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return H2.create(t,...e)}function be(t,e,...n){if(!t)throw eT(e,...n)}function Js(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Np(e),new Error(e)}function fi(t,e){t||Js(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dx(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function bH(){return Wk()==="http:"||Wk()==="https:"}function Wk(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function TH(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bH()||b5()||"connection"in navigator)?navigator.onLine:!0}function EH(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,n){this.shortDelay=e,this.longDelay=n,fi(n>e,"Short delay should be less than long delay!"),this.isMobile=x5()||T5()}get(){return TH()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tT(t,e){fi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Js("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Js("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Js("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const SH={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kH=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],CH=new Bd(3e4,6e4);function jo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function vi(t,e,n,r,s={}){return K2(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Ad({key:t.config.apiKey,...o}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c={method:e,headers:l,...i};return _5()||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&Po(t.emulatorConfig.host)&&(c.credentials="include"),q2.fetch()(await G2(t,t.config.apiHost,n,a),c)})}async function K2(t,e,n){t._canInitEmulator=!1;const r={...SH,...e};try{const s=new AH(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Of(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Of(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Of(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Of(t,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw W2(t,u,c);ss(t,u)}}catch(s){if(s instanceof Ms)throw s;ss(t,"network-request-failed",{message:String(s)})}}async function zd(t,e,n,r,s={}){const i=await vi(t,e,n,r,s);return"mfaPendingCredential"in i&&ss(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function G2(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?tT(t.config,s):`${t.config.apiScheme}://${s}`;return kH.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function IH(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class AH{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Cs(this.auth,"network-request-failed")),CH.get())})}}function Of(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Cs(t,e,r);return s.customData._tokenResponse=n,s}function qk(t){return t!==void 0&&t.enterprise!==void 0}class NH{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return IH(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function RH(t,e){return vi(t,"GET","/v2/recaptchaConfig",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PH(t,e){return vi(t,"POST","/v1/accounts:delete",e)}async function Pm(t,e){return vi(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function MH(t,e=!1){const n=Tt(t),r=await n.getIdToken(e),s=nT(r);be(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:gh(Xv(s.auth_time)),issuedAtTime:gh(Xv(s.iat)),expirationTime:gh(Xv(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function Xv(t){return Number(t)*1e3}function nT(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return Np("JWT malformed, contained fewer than 3 sections"),null;try{const s=lP(n);return s?JSON.parse(s):(Np("Failed to decode base64 JWT payload"),null)}catch(s){return Np("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Kk(t){const e=nT(t);return be(e,"internal-error"),be(typeof e.exp<"u","internal-error"),be(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Dc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof Ms&&OH(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function OH({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DH{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fx{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=gh(this.lastLoginAt),this.creationTime=gh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Mm(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Dc(t,Pm(e,{idToken:n}));be(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?Q2(s.providerUserInfo):[],o=jH(t.providerData,i),a=t.isAnonymous,l=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new fx(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(t,u)}async function LH(t){const e=Tt(t);await Mm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function jH(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function Q2(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function VH(t,e){const n=await K2(t,{},async()=>{const r=Ad({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await G2(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return t.emulatorConfig&&Po(t.emulatorConfig.host)&&(l.credentials="include"),q2.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function FH(t,e){return vi(t,"POST","/v2/accounts:revokeToken",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){be(e.idToken,"internal-error"),be(typeof e.idToken<"u","internal-error"),be(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Kk(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){be(e.length!==0,"internal-error");const n=Kk(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(be(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await VH(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new ac;return r&&(be(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(be(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(be(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ac,this.toJSON())}_performRefresh(){return Js("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ri(t,e){be(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Yr{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new DH(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new fx(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Dc(this,this.stsTokenManager.getToken(this.auth,e));return be(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return MH(this,e)}reload(){return LH(this)}_assign(e){this!==e&&(be(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Yr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){be(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Mm(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(or(this.auth.app))return Promise.reject(ti(this.auth));const e=await this.getIdToken();return await Dc(this,PH(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,l=n._redirectEventId??void 0,c=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:f,isAnonymous:m,providerData:g,stsTokenManager:y}=n;be(h&&y,e,"internal-error");const v=ac.fromJSON(this.name,y);be(typeof h=="string",e,"internal-error"),Ri(r,e.name),Ri(s,e.name),be(typeof f=="boolean",e,"internal-error"),be(typeof m=="boolean",e,"internal-error"),Ri(i,e.name),Ri(o,e.name),Ri(a,e.name),Ri(l,e.name),Ri(c,e.name),Ri(u,e.name);const w=new Yr({uid:h,auth:e,email:s,emailVerified:f,displayName:r,isAnonymous:m,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:c,lastLoginAt:u});return g&&Array.isArray(g)&&(w.providerData=g.map(_=>({..._}))),l&&(w._redirectEventId=l),w}static async _fromIdTokenResponse(e,n,r=!1){const s=new ac;s.updateFromServerResponse(n);const i=new Yr({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Mm(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];be(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?Q2(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new ac;a.updateFromIdToken(r);const l=new Yr({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new fx(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=new Map;function Ys(t){fi(t instanceof Function,"Expected a class definition");let e=Gk.get(t);return e?(fi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,Gk.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J2{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}J2.type="NONE";const Qk=J2;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rp(t,e,n){return`firebase:${t}:${e}:${n}`}class lc{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Rp(this.userKey,s.apiKey,i),this.fullPersistenceKey=Rp("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Pm(this.auth,{idToken:e}).catch(()=>{});return n?Yr._fromGetAccountInfoResponse(this.auth,n,e):null}return Yr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new lc(Ys(Qk),e,r);const s=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||Ys(Qk);const o=Rp(r,e.config.apiKey,e.name);let a=null;for(const c of n)try{const u=await c._get(o);if(u){let h;if(typeof u=="string"){const f=await Pm(e,{idToken:u}).catch(()=>{});if(!f)break;h=await Yr._fromGetAccountInfoResponse(e,f,u)}else h=Yr._fromJSON(e,u);c!==i&&(a=h),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new lc(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new lc(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jk(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(eO(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Y2(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(nO(e))return"Blackberry";if(rO(e))return"Webos";if(X2(e))return"Safari";if((e.includes("chrome/")||Z2(e))&&!e.includes("edge/"))return"Chrome";if(tO(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Y2(t=qt()){return/firefox\//i.test(t)}function X2(t=qt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Z2(t=qt()){return/crios\//i.test(t)}function eO(t=qt()){return/iemobile/i.test(t)}function tO(t=qt()){return/android/i.test(t)}function nO(t=qt()){return/blackberry/i.test(t)}function rO(t=qt()){return/webos/i.test(t)}function rT(t=qt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function BH(t=qt()){var e;return rT(t)&&!!((e=window.navigator)!=null&&e.standalone)}function zH(){return E5()&&document.documentMode===10}function sO(t=qt()){return rT(t)||tO(t)||rO(t)||nO(t)||/windows phone/i.test(t)||eO(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function iO(t,e=[]){let n;switch(t){case"Browser":n=Jk(qt());break;case"Worker":n=`${Jk(qt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${sl}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $H{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UH(t,e={}){return vi(t,"GET","/v2/passwordPolicy",jo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HH=6;class WH{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??HH,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qH{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yk(this),this.idTokenSubscription=new Yk(this),this.beforeStateQueue=new $H(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=H2,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Ys(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await lc.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Pm(this,{idToken:e}),r=await Yr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(or(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return be(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Mm(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=EH()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(or(this.app))return Promise.reject(ti(this));const n=e?Tt(e):null;return n&&be(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&be(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return or(this.app)?Promise.reject(ti(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return or(this.app)?Promise.reject(ti(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ys(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await UH(this),n=new WH(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Id("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await FH(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Ys(e)||this._popupRedirectResolver;be(n,this,"argument-error"),this.redirectPersistenceManager=await lc.create(this,[Ys(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(be(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return be(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=iO(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(or(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&_H(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function al(t){return Tt(t)}class Yk{constructor(e){this.auth=e,this.observer=null,this.addObserver=N5(n=>this.observer=n)}get next(){return be(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ey={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function KH(t){Ey=t}function oO(t){return Ey.loadJS(t)}function GH(){return Ey.recaptchaEnterpriseScript}function QH(){return Ey.gapiScript}function JH(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class YH{constructor(){this.enterprise=new XH}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class XH{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const ZH="recaptcha-enterprise",aO="NO_RECAPTCHA";class e9{constructor(e){this.type=ZH,this.auth=al(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{RH(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new NH(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;qk(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(aO)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new YH().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!n&&qk(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=GH();l.length!==0&&(l+=a),oO(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function Xk(t,e,n,r=!1,s=!1){const i=new e9(t);let o;if(s)o=aO;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function px(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Xk(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Xk(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t9(t,e){const n=Jg(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Oa(i,e??{}))return s;ss(s,"already-initialized")}return n.initialize({options:e})}function n9(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(Ys);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function r9(t,e,n){const r=al(t);be(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=lO(e),{host:o,port:a}=s9(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){be(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),be(Oa(c,r.config.emulator)&&Oa(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,Po(o)?(ib(`${i}//${o}${l}`),ob("Auth",!0)):i9()}function lO(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function s9(t){const e=lO(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:Zk(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:Zk(o)}}}function Zk(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function i9(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sT{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return Js("not implemented")}_getIdTokenResponse(e){return Js("not implemented")}_linkToIdToken(e,n){return Js("not implemented")}_getReauthenticationResolver(e){return Js("not implemented")}}async function o9(t,e){return vi(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function a9(t,e){return zd(t,"POST","/v1/accounts:signInWithPassword",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function l9(t,e){return zd(t,"POST","/v1/accounts:signInWithEmailLink",jo(t,e))}async function c9(t,e){return zd(t,"POST","/v1/accounts:signInWithEmailLink",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class od extends sT{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new od(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new od(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return px(e,n,"signInWithPassword",a9);case"emailLink":return l9(e,{email:this._email,oobCode:this._password});default:ss(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return px(e,r,"signUpPassword",o9);case"emailLink":return c9(e,{idToken:n,email:this._email,oobCode:this._password});default:ss(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cc(t,e){return zd(t,"POST","/v1/accounts:signInWithIdp",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const u9="http://localhost";class Ha extends sT{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Ha(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):ss("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Ha(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return cc(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,cc(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,cc(e,n)}buildRequest(){const e={requestUri:u9,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Ad(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h9(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function d9(t){const e=zu($u(t)).link,n=e?zu($u(e)).deep_link_id:null,r=zu($u(t)).deep_link_id;return(r?zu($u(r)).link:null)||r||n||e||t}class iT{constructor(e){const n=zu($u(e)),r=n.apiKey??null,s=n.oobCode??null,i=h9(n.mode??null);be(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=d9(e);try{return new iT(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xc{constructor(){this.providerId=Xc.PROVIDER_ID}static credential(e,n){return od._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=iT.parseLink(n);return be(r,"argument-error"),od._fromEmailAndCode(e,r.code,r.tenantId)}}Xc.PROVIDER_ID="password";Xc.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Xc.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cO{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $d extends cO{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ui extends $d{constructor(){super("facebook.com")}static credential(e){return Ha._fromParams({providerId:Ui.PROVIDER_ID,signInMethod:Ui.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ui.credentialFromTaggedObject(e)}static credentialFromError(e){return Ui.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ui.credential(e.oauthAccessToken)}catch{return null}}}Ui.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ui.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ws extends $d{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Ha._fromParams({providerId:Ws.PROVIDER_ID,signInMethod:Ws.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Ws.credentialFromTaggedObject(e)}static credentialFromError(e){return Ws.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Ws.credential(n,r)}catch{return null}}}Ws.GOOGLE_SIGN_IN_METHOD="google.com";Ws.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hi extends $d{constructor(){super("github.com")}static credential(e){return Ha._fromParams({providerId:Hi.PROVIDER_ID,signInMethod:Hi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Hi.credentialFromTaggedObject(e)}static credentialFromError(e){return Hi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Hi.credential(e.oauthAccessToken)}catch{return null}}}Hi.GITHUB_SIGN_IN_METHOD="github.com";Hi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wi extends $d{constructor(){super("twitter.com")}static credential(e,n){return Ha._fromParams({providerId:Wi.PROVIDER_ID,signInMethod:Wi.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Wi.credentialFromTaggedObject(e)}static credentialFromError(e){return Wi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Wi.credential(n,r)}catch{return null}}}Wi.TWITTER_SIGN_IN_METHOD="twitter.com";Wi.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function f9(t,e){return zd(t,"POST","/v1/accounts:signUp",jo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wa{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await Yr._fromIdTokenResponse(e,r,s),o=eC(r);return new Wa({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=eC(r);return new Wa({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function eC(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om extends Ms{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,Om.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new Om(e,n,r,s)}}function uO(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?Om._fromErrorAndOperation(t,i,e,r):i})}async function p9(t,e,n=!1){const r=await Dc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Wa._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function m9(t,e,n=!1){const{auth:r}=t;if(or(r.app))return Promise.reject(ti(r));const s="reauthenticate";try{const i=await Dc(t,uO(r,s,e,t),n);be(i.idToken,r,"internal-error");const o=nT(i.idToken);be(o,r,"internal-error");const{sub:a}=o;return be(t.uid===a,r,"user-mismatch"),Wa._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&ss(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hO(t,e,n=!1){if(or(t.app))return Promise.reject(ti(t));const r="signIn",s=await uO(t,r,e),i=await Wa._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function g9(t,e){return hO(al(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dO(t){const e=al(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function y9(t,e,n){if(or(t.app))return Promise.reject(ti(t));const r=al(t),o=await px(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",f9).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&dO(t),l}),a=await Wa._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function v9(t,e,n){return or(t.app)?Promise.reject(ti(t)):g9(Tt(t),Xc.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&dO(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function w9(t,e){return vi(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fO(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=Tt(t),i={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Dc(r,w9(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function x9(t,e,n,r){return Tt(t).onIdTokenChanged(e,n,r)}function _9(t,e,n){return Tt(t).beforeAuthStateChanged(e,n)}function b9(t){return Tt(t).signOut()}const Dm="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pO{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Dm,"1"),this.storage.removeItem(Dm),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T9=1e3,E9=10;class mO extends pO{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=sO(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);zH()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,E9):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},T9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}mO.type="LOCAL";const S9=mO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO extends pO{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}gO.type="SESSION";const yO=gO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k9(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sy{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Sy(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(n.origin,i)),l=await k9(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Sy.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oT(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C9{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=oT("",20);s.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const f=h;if(f.data.eventId===c)switch(f.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(f.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Is(){return window}function I9(t){Is().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vO(){return typeof Is().WorkerGlobalScope<"u"&&typeof Is().importScripts=="function"}async function A9(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function N9(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function R9(){return vO()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wO="firebaseLocalStorageDb",P9=1,Lm="firebaseLocalStorage",xO="fbase_key";class Ud{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function ky(t,e){return t.transaction([Lm],e?"readwrite":"readonly").objectStore(Lm)}function M9(){const t=indexedDB.deleteDatabase(wO);return new Ud(t).toPromise()}function mx(){const t=indexedDB.open(wO,P9);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Lm,{keyPath:xO})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Lm)?e(r):(r.close(),await M9(),e(await mx()))})})}async function tC(t,e,n){const r=ky(t,!0).put({[xO]:e,value:n});return new Ud(r).toPromise()}async function O9(t,e){const n=ky(t,!1).get(e),r=await new Ud(n).toPromise();return r===void 0?null:r.value}function nC(t,e){const n=ky(t,!0).delete(e);return new Ud(n).toPromise()}const D9=800,L9=3;class _O{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await mx(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>L9)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return vO()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Sy._getInstance(R9()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await A9(),!this.activeServiceWorker)return;this.sender=new C9(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||N9()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await mx();return await tC(e,Dm,"1"),await nC(e,Dm),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>tC(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>O9(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>nC(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=ky(s,!1).getAll();return new Ud(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),D9)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}_O.type="LOCAL";const j9=_O;new Bd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V9(t,e){return e?Ys(e):(be(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aT extends sT{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return cc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return cc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return cc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function F9(t){return hO(t.auth,new aT(t),t.bypassAuthState)}function B9(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),m9(n,new aT(t),t.bypassAuthState)}async function z9(t){const{auth:e,user:n}=t;return be(n,e,"internal-error"),p9(n,new aT(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bO{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return F9;case"linkViaPopup":case"linkViaRedirect":return z9;case"reauthViaPopup":case"reauthViaRedirect":return B9;default:ss(this.auth,"internal-error")}}resolve(e){fi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){fi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $9=new Bd(2e3,1e4);class Gl extends bO{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Gl.currentPopupAction&&Gl.currentPopupAction.cancel(),Gl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return be(e,this.auth,"internal-error"),e}async onExecution(){fi(this.filter.length===1,"Popup operations only handle one event");const e=oT();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Cs(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Cs(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Gl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Cs(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,$9.get())};e()}}Gl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const U9="pendingRedirect",Pp=new Map;class H9 extends bO{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Pp.get(this.auth._key());if(!e){try{const r=await W9(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Pp.set(this.auth._key(),e)}return this.bypassAuthState||Pp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function W9(t,e){const n=G9(e),r=K9(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function q9(t,e){Pp.set(t._key(),e)}function K9(t){return Ys(t._redirectPersistence)}function G9(t){return Rp(U9,t.config.apiKey,t.name)}async function Q9(t,e,n=!1){if(or(t.app))return Promise.reject(ti(t));const r=al(t),s=V9(r,e),o=await new H9(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const J9=10*60*1e3;class Y9{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!X9(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!TO(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Cs(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=J9&&this.cachedEventUids.clear(),this.cachedEventUids.has(rC(e))}saveEventToCache(e){this.cachedEventUids.add(rC(e)),this.lastProcessedEventTime=Date.now()}}function rC(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function TO({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function X9(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return TO(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z9(t,e={}){return vi(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const e8=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,t8=/^https?/;async function n8(t){if(t.config.emulator)return;const{authorizedDomains:e}=await Z9(t);for(const n of e)try{if(r8(n))return}catch{}ss(t,"unauthorized-domain")}function r8(t){const e=dx(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!t8.test(n))return!1;if(e8.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const s8=new Bd(3e4,6e4);function sC(){const t=Is().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function i8(t){return new Promise((e,n)=>{var s,i,o;function r(){sC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{sC(),n(Cs(t,"network-request-failed"))},timeout:s8.get()})}if((i=(s=Is().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Is().gapi)!=null&&o.load)r();else{const a=JH("iframefcb");return Is()[a]=()=>{gapi.load?r():n(Cs(t,"network-request-failed"))},oO(`${QH()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw Mp=null,e})}let Mp=null;function o8(t){return Mp=Mp||i8(t),Mp}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a8=new Bd(5e3,15e3),l8="__/auth/iframe",c8="emulator/auth/iframe",u8={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},h8=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function d8(t){const e=t.config;be(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?tT(e,c8):`https://${t.config.authDomain}/${l8}`,r={apiKey:e.apiKey,appName:t.name,v:sl},s=h8.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Ad(r).slice(1)}`}async function f8(t){const e=await o8(t),n=Is().gapi;return be(n,t,"internal-error"),e.open({where:document.body,url:d8(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:u8,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Cs(t,"network-request-failed"),a=Is().setTimeout(()=>{i(o)},a8.get());function l(){Is().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p8={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},m8=500,g8=600,y8="_blank",v8="http://localhost";class iC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function w8(t,e,n,r=m8,s=g8){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...p8,width:r.toString(),height:s.toString(),top:i,left:o},c=qt().toLowerCase();n&&(a=Z2(c)?y8:n),Y2(c)&&(e=e||v8,l.scrollbars="yes");const u=Object.entries(l).reduce((f,[m,g])=>`${f}${m}=${g},`,"");if(BH(c)&&a!=="_self")return x8(e||"",a),new iC(null);const h=window.open(e||"",a,u);be(h,t,"popup-blocked");try{h.focus()}catch{}return new iC(h)}function x8(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _8="__/auth/handler",b8="emulator/auth/handler",T8=encodeURIComponent("fac");async function oC(t,e,n,r,s,i){be(t.config.authDomain,t,"auth-domain-config-required"),be(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:sl,eventId:s};if(e instanceof cO){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",A5(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof $d){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await t._getAppCheckToken(),c=l?`#${T8}=${encodeURIComponent(l)}`:"";return`${E8(t)}?${Ad(a).slice(1)}${c}`}function E8({config:t}){return t.emulator?tT(t,b8):`https://${t.authDomain}/${_8}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zv="webStorageSupport";class S8{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=yO,this._completeRedirectFn=Q9,this._overrideRedirectResult=q9}async _openPopup(e,n,r,s){var o;fi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await oC(e,n,r,dx(),s);return w8(e,i,oT())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await oC(e,n,r,dx(),s);return I9(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(fi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await f8(e),r=new Y9(e);return n.register("authEvent",s=>(be(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(Zv,{type:Zv},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[Zv];i!==void 0&&n(!!i),ss(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=n8(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return sO()||X2()||rT()}}const k8=S8;var aC="@firebase/auth",lC="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C8{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){be(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I8(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function A8(t){Da(new _o("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;be(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:iO(t)},c=new qH(r,s,i,l);return n9(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Da(new _o("auth-internal",e=>{const n=al(e.getProvider("auth").getImmediate());return(r=>new C8(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ts(aC,lC,I8(t)),Ts(aC,lC,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N8=5*60,R8=fP("authIdTokenMaxAge")||N8;let cC=null;const P8=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>R8)return;const s=n==null?void 0:n.token;cC!==s&&(cC=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function M8(t=cb()){const e=Jg(t,"auth");if(e.isInitialized())return e.getImmediate();const n=t9(t,{popupRedirectResolver:k8,persistence:[j9,S9,yO]}),r=fP("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=P8(i.toString());_9(n,o,()=>o(n.currentUser)),x9(n,a=>o(a))}}const s=uP("auth");return s&&r9(n,`http://${s}`),n}function O8(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}KH({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Cs("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",O8().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});A8("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EO="firebasestorage.googleapis.com",SO="storageBucket",D8=2*60*1e3,L8=10*60*1e3,j8=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Et extends Ms{constructor(e,n,r=0){super(e0(e),`Firebase Storage: ${n} (${e0(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,Et.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return e0(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var ut;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(ut||(ut={}));function e0(t){return"storage/"+t}function lT(){const t="An unknown error occurred, please check the error payload for server response.";return new Et(ut.UNKNOWN,t)}function V8(t){return new Et(ut.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function F8(t){return new Et(ut.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function B8(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new Et(ut.UNAUTHENTICATED,t)}function z8(){return new Et(ut.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function $8(t){return new Et(ut.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function kO(){return new Et(ut.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function CO(){return new Et(ut.CANCELED,"User canceled the upload/download.")}function U8(t){return new Et(ut.INVALID_URL,"Invalid URL '"+t+"'.")}function H8(t){return new Et(ut.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function W8(){return new Et(ut.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+SO+"' property when initializing the app?")}function IO(){return new Et(ut.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function q8(){return new Et(ut.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function K8(){return new Et(ut.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function G8(t){return new Et(ut.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function gx(t){return new Et(ut.INVALID_ARGUMENT,t)}function AO(){return new Et(ut.APP_DELETED,"The Firebase app was deleted.")}function Q8(t){return new Et(ut.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function yh(t,e){return new Et(ut.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Au(t){throw new Et(ut.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hr{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=hr.makeFromUrl(e,n)}catch{return new hr(e,"")}if(r.path==="")return r;throw H8(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(N){N.path.charAt(N.path.length-1)==="/"&&(N.path_=N.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(N){N.path_=decodeURIComponent(N.path)}const u="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),f="(/([^?#]*).*)?$",m=new RegExp(`^https?://${h}/${u}/b/${s}/o${f}`,"i"),g={bucket:1,path:3},y=n===EO?"(?:storage.googleapis.com|storage.cloud.google.com)":n,v="([^?#]*)",w=new RegExp(`^https?://${y}/${s}/${v}`,"i"),E=[{regex:a,indices:l,postModify:i},{regex:m,indices:g,postModify:c},{regex:w,indices:{bucket:1,path:2},postModify:c}];for(let N=0;N<E.length;N++){const R=E[N],O=R.regex.exec(e);if(O){const S=O[R.indices.bucket];let T=O[R.indices.path];T||(T=""),r=new hr(S,T),R.postModify(r);break}}if(r==null)throw U8(e);return r}}class J8{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Y8(t,e,n){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...v){c||(c=!0,e.apply(null,v))}function h(v){s=setTimeout(()=>{s=null,t(m,l())},v)}function f(){i&&clearTimeout(i)}function m(v,...w){if(c){f();return}if(v){f(),u.call(null,v,...w);return}if(l()||o){f(),u.call(null,v,...w);return}r<64&&(r*=2);let E;a===1?(a=2,E=0):E=(r+Math.random())*1e3,h(E)}let g=!1;function y(v){g||(g=!0,f(),!c&&(s!==null?(v||(a=2),clearTimeout(s),h(0)):v||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,y(!0)},n),y}function X8(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Z8(t){return t!==void 0}function eW(t){return typeof t=="function"}function tW(t){return typeof t=="object"&&!Array.isArray(t)}function Cy(t){return typeof t=="string"||t instanceof String}function uC(t){return cT()&&t instanceof Blob}function cT(){return typeof Blob<"u"}function hC(t,e,n,r){if(r<e)throw gx(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw gx(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hd(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function NO(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var ba;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(ba||(ba={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RO(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nW{constructor(e,n,r,s,i,o,a,l,c,u,h,f=!0,m=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=f,this.isUsingEmulator=m,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,y)=>{this.resolve_=g,this.reject_=y,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new Df(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===ba.NO_ERROR,l=i.getStatus();if(!a||RO(l,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===ba.ABORT;r(!1,new Df(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new Df(c,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());Z8(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=lT();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?AO():CO();o(l)}else{const l=kO();o(l)}};this.canceled_?n(!1,new Df(!1,null,!0)):this.backoffId_=Y8(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&X8(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class Df{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function rW(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function sW(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function iW(t,e){e&&(t["X-Firebase-GMPID"]=e)}function oW(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function aW(t,e,n,r,s,i,o=!0,a=!1){const l=NO(t.urlParams),c=t.url+l,u=Object.assign({},t.headers);return iW(u,e),rW(u,n),sW(u,i),oW(u,r),new nW(c,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lW(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function cW(...t){const e=lW();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(cT())return new Blob(t);throw new Et(ut.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function uW(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hW(t){if(typeof atob>"u")throw G8("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xs={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class t0{constructor(e,n){this.data=e,this.contentType=n||null}}function dW(t,e){switch(t){case xs.RAW:return new t0(PO(e));case xs.BASE64:case xs.BASE64URL:return new t0(MO(t,e));case xs.DATA_URL:return new t0(pW(e),mW(e))}throw lT()}function PO(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function fW(t){let e;try{e=decodeURIComponent(t)}catch{throw yh(xs.DATA_URL,"Malformed data URL.")}return PO(e)}function MO(t,e){switch(t){case xs.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw yh(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case xs.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw yh(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=hW(e)}catch(s){throw s.message.includes("polyfill")?s:yh(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class OO{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw yh(xs.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=gW(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function pW(t){const e=new OO(t);return e.base64?MO(xs.BASE64,e.rest):fW(e.rest)}function mW(t){return new OO(t).contentType}function gW(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qs{constructor(e,n){let r=0,s="";uC(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(uC(this.data_)){const r=this.data_,s=uW(r,e,n);return s===null?null:new qs(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new qs(r,!0)}}static getBlob(...e){if(cT()){const n=e.map(r=>r instanceof qs?r.data_:r);return new qs(cW.apply(null,n))}else{const n=e.map(o=>Cy(o)?dW(xs.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new qs(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DO(t){let e;try{e=JSON.parse(t)}catch{return null}return tW(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yW(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function vW(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function LO(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wW(t,e){return e}let On=class{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||wW}},Lf=null;function xW(t){return!Cy(t)||t.length<2?t:LO(t)}function uT(){if(Lf)return Lf;const t=[];t.push(new On("bucket")),t.push(new On("generation")),t.push(new On("metageneration")),t.push(new On("name","fullPath",!0));function e(i,o){return xW(o)}const n=new On("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new On("size");return s.xform=r,t.push(s),t.push(new On("timeCreated")),t.push(new On("updated")),t.push(new On("md5Hash",null,!0)),t.push(new On("cacheControl",null,!0)),t.push(new On("contentDisposition",null,!0)),t.push(new On("contentEncoding",null,!0)),t.push(new On("contentLanguage",null,!0)),t.push(new On("contentType",null,!0)),t.push(new On("metadata","customMetadata",!0)),Lf=t,Lf}function _W(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new hr(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function bW(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return _W(r,t),r}function jO(t,e,n){const r=DO(e);return r===null?null:bW(t,r,n)}function TW(t,e,n,r){const s=DO(e);if(s===null||!Cy(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const u=t.bucket,h=t.fullPath,f="/b/"+o(u)+"/o/"+o(h),m=Hd(f,n,r),g=NO({alt:"media",token:c});return m+g})[0]}function VO(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}class Zc{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ni(t){if(!t)throw lT()}function hT(t,e){function n(r,s){const i=jO(t,s,e);return ni(i!==null),i}return n}function EW(t,e){function n(r,s){const i=jO(t,s,e);return ni(i!==null),TW(i,s,t.host,t._protocol)}return n}function Wd(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=z8():s=B8():n.getStatus()===402?s=F8(t.bucket):n.getStatus()===403?s=$8(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function FO(t){const e=Wd(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=V8(t.path)),i.serverResponse=s.serverResponse,i}return n}function SW(t,e,n){const r=e.fullServerUrl(),s=Hd(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new Zc(s,i,hT(t,n),o);return a.errorHandler=FO(e),a}function kW(t,e,n){const r=e.fullServerUrl(),s=Hd(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new Zc(s,i,EW(t,n),o);return a.errorHandler=FO(e),a}function CW(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function BO(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=CW(null,e)),r}function zO(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let E="";for(let N=0;N<2;N++)E=E+Math.random().toString().slice(2);return E}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=BO(e,r,s),u=VO(c,n),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,f=`\r
--`+l+"--",m=qs.getBlob(h,r,f);if(m===null)throw IO();const g={name:c.fullPath},y=Hd(i,t.host,t._protocol),v="POST",w=t.maxUploadRetryTime,_=new Zc(y,v,hT(t,n),w);return _.urlParams=g,_.headers=o,_.body=m.uploadData(),_.errorHandler=Wd(e),_}class jm{constructor(e,n,r,s){this.current=e,this.total=n,this.finalized=!!r,this.metadata=s||null}}function dT(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{ni(!1)}return ni(!!n&&(e||["active"]).indexOf(n)!==-1),n}function IW(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o=BO(e,r,s),a={name:o.fullPath},l=Hd(i,t.host,t._protocol),c="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=VO(o,n),f=t.maxUploadRetryTime;function m(y){dT(y);let v;try{v=y.getResponseHeader("X-Goog-Upload-URL")}catch{ni(!1)}return ni(Cy(v)),v}const g=new Zc(l,c,m,f);return g.urlParams=a,g.headers=u,g.body=h,g.errorHandler=Wd(e),g}function AW(t,e,n,r){const s={"X-Goog-Upload-Command":"query"};function i(c){const u=dT(c,["active","final"]);let h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{ni(!1)}h||ni(!1);const f=Number(h);return ni(!isNaN(f)),new jm(f,r.size(),u==="final")}const o="POST",a=t.maxUploadRetryTime,l=new Zc(n,o,i,a);return l.headers=s,l.errorHandler=Wd(e),l}const dC=256*1024;function NW(t,e,n,r,s,i,o,a){const l=new jm(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw q8();const c=l.total-l.current;let u=c;s>0&&(u=Math.min(u,s));const h=l.current,f=h+u;let m="";u===0?m="finalize":c===u?m="upload, finalize":m="upload";const g={"X-Goog-Upload-Command":m,"X-Goog-Upload-Offset":`${l.current}`},y=r.slice(h,f);if(y===null)throw IO();function v(N,R){const O=dT(N,["active","final"]),S=l.current+u,T=r.size();let k;return O==="final"?k=hT(e,i)(N,R):k=null,new jm(S,T,O==="final",k)}const w="POST",_=e.maxUploadRetryTime,E=new Zc(n,w,v,_);return E.headers=g,E.body=y.uploadData(),E.progressCallback=a||null,E.errorHandler=Wd(t),E}const qn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function n0(t){switch(t){case"running":case"pausing":case"canceling":return qn.RUNNING;case"paused":return qn.PAUSED;case"success":return qn.SUCCESS;case"canceled":return qn.CANCELED;case"error":return qn.ERROR;default:return qn.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class RW{constructor(e,n,r){if(eW(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class PW{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ba.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ba.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ba.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Au("cannot .send() more than once");if(Po(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Au("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Au("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Au("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Au("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class MW extends PW{initXhr(){this.xhr_.responseType="text"}}function ra(){return new MW}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OW{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=uT(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(ut.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(RO(s.status,[]))if(i)s=kO();else{this.sleepTime=Math.max(this.sleepTime*2,j8),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(ut.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=IW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,ra,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const s=AW(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,ra,n,r);this._request=i,i.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=dC*this._chunkMultiplier,n=new jm(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=NW(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,ra,s,i,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){dC*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=SW(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,ra,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=zO(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,ra,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=CO(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=n0(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,s){const i=new RW(n||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(n0(this._state)){case qn.SUCCESS:_l(this._resolve.bind(null,this.snapshot))();break;case qn.CANCELED:case qn.ERROR:const n=this._reject;_l(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(n0(this._state)){case qn.RUNNING:case qn.PAUSED:e.next&&_l(e.next.bind(e,this.snapshot))();break;case qn.SUCCESS:e.complete&&_l(e.complete.bind(e))();break;case qn.CANCELED:case qn.ERROR:e.error&&_l(e.error.bind(e,this._error))();break;default:e.error&&_l(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qa{constructor(e,n){this._service=e,n instanceof hr?this._location=n:this._location=hr.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new qa(e,n)}get root(){const e=new hr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return LO(this._location.path)}get storage(){return this._service}get parent(){const e=yW(this._location.path);if(e===null)return null;const n=new hr(this._location.bucket,e);return new qa(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw Q8(e)}}function DW(t,e,n){t._throwIfRoot("uploadBytes");const r=zO(t.storage,t._location,uT(),new qs(e,!0),n);return t.storage.makeRequestWithTokens(r,ra).then(s=>({metadata:s,ref:t}))}function LW(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new OW(t,new qs(e),n)}function jW(t){t._throwIfRoot("getDownloadURL");const e=kW(t.storage,t._location,uT());return t.storage.makeRequestWithTokens(e,ra).then(n=>{if(n===null)throw K8();return n})}function VW(t,e){const n=vW(t._location.path,e),r=new hr(t._location.bucket,n);return new qa(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FW(t){return/^[A-Za-z]+:\/\//.test(t)}function BW(t,e){return new qa(t,e)}function $O(t,e){if(t instanceof fT){const n=t;if(n._bucket==null)throw W8();const r=new qa(n,n._bucket);return e!=null?$O(r,e):r}else return e!==void 0?VW(t,e):t}function zW(t,e){if(e&&FW(e)){if(t instanceof fT)return BW(t,e);throw gx("To use ref(service, url), the first argument must be a Storage instance.")}else return $O(t,e)}function fC(t,e){const n=e==null?void 0:e[SO];return n==null?null:hr.makeFromBucketSpec(n,t)}function $W(t,e,n,r={}){t.host=`${e}:${n}`;const s=Po(e);s&&(ib(`https://${t.host}/b`),ob("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:pP(i,t.app.options.projectId))}class fT{constructor(e,n,r,s,i,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=EO,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=D8,this._maxUploadRetryTime=L8,this._requests=new Set,s!=null?this._bucket=hr.makeFromBucketSpec(s,this._host):this._bucket=fC(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=hr.makeFromBucketSpec(this._url,e):this._bucket=fC(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){hC("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){hC("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(or(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new qa(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new J8(AO());{const o=aW(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const pC="@firebase/storage",mC="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UO="storage";function UW(t,e,n){return t=Tt(t),DW(t,e,n)}function HW(t,e,n){return t=Tt(t),LW(t,e,n)}function gC(t){return t=Tt(t),jW(t)}function yC(t,e){return t=Tt(t),zW(t,e)}function WW(t=cb(),e){t=Tt(t);const r=Jg(t,UO).getImmediate({identifier:e}),s=hP("storage");return s&&qW(r,...s),r}function qW(t,e,n,r={}){$W(t,e,n,r)}function KW(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new fT(n,r,s,e,sl)}function GW(){Da(new _o(UO,KW,"PUBLIC").setMultipleInstances(!0)),Ts(pC,mC,""),Ts(pC,mC,"esm2020")}GW();var QW="firebase",JW="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ts(QW,JW,"app");const YW={apiKey:"AIzaSyAlMyf_NFJ8xrQLt24EhxAzWZTnQbPr6aQ",authDomain:"desksetup-web.firebaseapp.com",projectId:"desksetup-web",storageBucket:"desksetup-web.firebasestorage.app",messagingSenderId:"540303783708",appId:"1:540303783708:web:ef169c5fb08b7d9a822cd9",measurementId:"G-N1ZDZ3JWF0"},pT=_P(YW),uc=M8(pT),Ut=nH(pT);rH(Ut).catch(t=>{t.code==="failed-precondition"?console.warn("Firestore persistence disabled: Multiple tabs open"):t.code==="unimplemented"&&console.warn("Firestore persistence disabled: Browser not supported")});const vC=WW(pT);new Ws;const HO=[],Ql=[],Rl={colorTone:[{value:"warm",label:"Tng Mu m",description:"G, be, nh sng du"},{value:"cool",label:"Tng Mu Lnh",description:"Trng, xm, nh sng xanh"},{value:"neutral",label:"Trung Tnh / Ti Gin",description:"Sch s v n gin"}],budget:[{value:"budget",label:"Tit Kim",description:"Di 10 triu"},{value:"mid-range",label:"Tm Trung",description:"10 - 50 triu"},{value:"premium",label:"Cao Cp",description:"Trn 50 triu"}],gender:[{value:"masculine",label:"Nam Tnh",description:"Mnh m v c tnh"},{value:"feminine",label:"N Tnh",description:"Nh nhng v thanh lch"},{value:"neutral",label:"Trung Tnh",description:"Ph hp mi ngi"}],purpose:[{value:"work-from-home",label:"Lm Vic Ti Nh",description:"Lm vic t xa chuyn nghip"},{value:"gaming",label:"Gaming",description:"Chi game v gii tr"},{value:"creative",label:"Sng To / Thit K",description:"Cng vic sng to"},{value:"productivity",label:"Nng Sut",description:"Hiu qu ti a"}],size:[{value:"small",label:"Khng Gian Nh",description:"Setup nh gn"},{value:"medium",label:"Trung Bnh",description:"Kch thc bn tiu chun"},{value:"large",label:"Ln / Studio",description:"Setup rng ri"}]},wC=Vd(Ut,"setups"),xC=Vd(Ut,"blogs");Vd(Ut,"users");const _C=Vd(Ut,"comments"),XW=Vd(Ut,"newsletter"),sa=["admin@deskhub.com","thanhdat.rces@gmail.com"],Zt={getData:async()=>{try{const t=Jv(wC,mH("createdAt","desc"),Bk(50)),n=(await Yv(t)).docs.map(a=>({id:a.id,...a.data()})),r=Jv(xC,Bk(50)),i=(await Yv(r)).docs.map(a=>({id:a.id,...a.data()})).sort((a,l)=>{const c=new Date(a.createdAt||a.publishedAt||0);return new Date(l.createdAt||l.publishedAt||0)-c});return{setups:n,blogs:i,comments:{}}}catch(t){return console.error("Error getting data (using fallback):",t),{setups:HO,blogs:Ql,comments:{}}}},login:async(t,e)=>{try{const n=t.includes("@")?t:`${t}@deskhub.com`,s=(await v9(uc,n,e)).user;let i={};try{const o=await Ap(Wn(Ut,"users",s.uid));o.exists()&&(i=o.data()),(sa.includes(s.email)||sa.includes(n))&&i.role!=="admin"&&(console.log(`Auto-promoting ${s.email} to Admin`),await Mi(Wn(Ut,"users",s.uid),{role:"admin"}),i.role="admin")}catch(o){console.warn("Firestore access failed (offline?):",o),(sa.includes(s.email)||sa.includes(n))&&(i.role="admin")}return{id:s.uid,email:s.email,displayName:s.displayName||i.displayName||t,photoURL:s.photoURL||i.avatar,role:i.role||"user"}}catch(n){throw console.error(n),n}},register:async t=>{try{const{email:e,password:n,username:r,displayName:s}=t,o=(await y9(uc,e,n)).user;await fO(o,{displayName:s});const a={username:r,displayName:s,email:e,role:sa.includes(e)?"admin":"user",avatar:`https://ui-avatars.com/api/?name=${s}`,createdAt:new Date().toISOString()};return await vH(Wn(Ut,"users",o.uid),a),{success:!0,user:{id:o.uid,...a}}}catch(e){throw console.error(e),e}},logout:async()=>{await b9(uc)},toggleLike:async(t,e)=>{try{const n=Wn(Ut,"setups",t),r=await Ap(n);if(r.exists()){const i=r.data().likes||[],o=i.some(l=>l.userId===e||l===e);let a;return o?a=i.filter(l=>l.userId!==e&&l!==e):a=[...i,{userId:e,timestamp:new Date().toISOString()}],await Mi(n,{likes:a}),{success:!0,likes:a}}}catch(n){console.error(n)}return{success:!1}},toggleSave:async(t,e)=>{try{const n=Wn(Ut,"setups",t),r=await Ap(n);if(r.exists()){const i=r.data().saves||[],o=i.some(l=>l.userId===e||l===e);let a;return o?a=i.filter(l=>l.userId!==e&&l!==e):a=[...i,{userId:e,timestamp:new Date().toISOString()}],await Mi(n,{saves:a}),{success:!0,saves:a}}}catch(n){console.error(n)}return{success:!1}},addComment:async(t,e)=>{try{const n={setupId:t,text:e.text,author:e.author,userId:e.userId,avatar:e.avatar,timestamp:new Date().toISOString()};e.replyTo&&(n.replyTo=e.replyTo);const r=await Mf(_C,n),s=Wn(Ut,"setups",t);return await Mi(s,{comments:Hk(1)}),{id:r.id,...n}}catch(n){throw console.error(n),n}},getCommentsForSetup:async t=>{try{const e=Jv(_C,pH("setupId","==",t));return(await Yv(e)).docs.map(s=>({id:s.id,...s.data()})).sort((s,i)=>{const o=s.timestamp?new Date(s.timestamp).getTime():0;return(i.timestamp?new Date(i.timestamp).getTime():0)-o})}catch(e){return console.error("Error fetching comments:",e),[]}},addSetup:async t=>{try{if(console.log(" addSetup called with data:",t),!t.title||!t.caption)throw new Error("Missing required fields: title or caption");const e={...t,likes:[],saves:[],comments:0,createdAt:new Date().toISOString()};console.log(" Calling addDoc with data:",JSON.stringify(e,null,2));const n=await Mf(wC,e);return console.log(" Setup added successfully with ID:",n.id),{success:!0,setup:{id:n.id,...e}}}catch(e){return console.error(" addSetup FAILED:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),console.error("Full error:",JSON.stringify(e,null,2)),e.code==="permission-denied"?{success:!1,message:"Permission denied. Check Firestore Security Rules."}:e.code==="unavailable"?{success:!1,message:"Network error. Check your internet connection."}:{success:!1,message:e.message||"Unknown error occurred"}}},deleteSetup:async t=>{try{return await Uk(Wn(Ut,"setups",t)),{success:!0}}catch(e){return{success:!1,message:e.message}}},updateSetup:async(t,e)=>{try{const n=Wn(Ut,"setups",t);return await Mi(n,e),{success:!0,setup:{id:t,...e}}}catch(n){return{success:!1,message:n.message}}},addBlog:async t=>{try{if(console.log(" addBlog called with data:",t),!t.title||!t.excerpt||!t.content)throw new Error("Missing required fields: title, excerpt, or content");const e={...t,views:0,publishedAt:new Date().toISOString()};console.log(" Calling addDoc with data:",JSON.stringify(e,null,2));const n=await Mf(xC,e);return console.log(" Blog added successfully with ID:",n.id),{...e,id:n.id}}catch(e){throw console.error(" addBlog FAILED:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),e.code==="permission-denied"?new Error("Permission denied. Check Firestore Security Rules."):e}},subscribeNewsletter:async t=>{try{return await Mf(XW,{...t,timestamp:new Date().toISOString()}),{success:!0}}catch(e){return console.error(e),{success:!1}}},incrementBlogView:async t=>{try{const e=Wn(Ut,"blogs",t);return await Mi(e,{views:Hk(1)}),{success:!0}}catch{return{success:!1}}},deleteBlog:async t=>{try{return await Uk(Wn(Ut,"blogs",t)),{success:!0}}catch(e){return console.error(e),{success:!1}}},updateBlog:async(t,e)=>{try{const n=Wn(Ut,"blogs",t);return await Mi(n,e),{success:!0,blog:{id:t,...e}}}catch{return{success:!1}}},_imgbbApiKey:"2a4945145b81f0e070078eeb4571403c",uploadFile:async t=>{var e;try{console.log(` Starting ImgBB upload for ${t.name}`);const r=await(a=>new Promise((l,c)=>{const u=new FileReader;u.readAsDataURL(a),u.onload=()=>{const h=u.result.split(",")[1];l(h)},u.onerror=c}))(t),s=new FormData;s.append("key",Zt._imgbbApiKey),s.append("image",r),s.append("name",`desk_${Date.now()}`);const o=await(await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:s})).json();if(o.success)return console.log(` ImgBB upload success: ${o.data.url}`),o.data.url;throw new Error(((e=o.error)==null?void 0:e.message)||"ImgBB upload failed")}catch(n){console.error("ImgBB upload failed:",n),console.log(" Trying Firebase Storage fallback...");try{const r=yC(vC,`uploads/${Date.now()}_${t.name}`),s={contentType:t.type},i=await UW(r,t,s);return await gC(i.ref)}catch(r){throw console.error("Firebase Storage fallback also failed:",r),new Error(`Upload tht bi: ${n.message}`)}}},uploadVideo:async(t,e)=>new Promise((n,r)=>{const s=yC(vC,`videos/${Date.now()}_${t.name}`),i={contentType:t.type},o=HW(s,t,i);o.on("state_changed",a=>{const l=a.bytesTransferred/a.totalBytes*100;e&&e(l)},a=>{console.error("Video upload failed:",a),a.code==="storage/unauthorized"?r(new Error("Khng c quyn ti ln video (Li Storage Rules)")):a.code==="storage/canceled"?r(new Error(" hy ti ln")):r(a)},async()=>{try{const a=await gC(o.snapshot.ref);n(a)}catch(a){r(a)}})})},WO=A.createContext(),Nu="deskhub_cache_setups",jf="deskhub_cache_blogs",r0="deskhub_cache_timestamp",yn=()=>{const t=A.useContext(WO);if(!t)throw new Error("useApp must be used within AppProvider");return t},ZW=({children:t})=>{const[e,n]=A.useState("light"),[r,s]=A.useState(()=>{try{const K=localStorage.getItem(Nu);if(K){const X=JSON.parse(K);if(X&&X.length>0)return console.log(" Instant load:",X.length,"setups from cache"),X}}catch(K){console.warn("Cache parse error:",K)}return[]}),[i,o]=A.useState(()=>{try{const K=localStorage.getItem(jf);if(K){const X=JSON.parse(K);if(X&&X.length>0)return X}}catch(K){console.warn("Cache parse error:",K)}return[]}),[a,l]=A.useState(null),[c,u]=A.useState(()=>{try{const K=localStorage.getItem(Nu);if(K){const X=JSON.parse(K);return!(X&&X.length>0)}}catch{}return!0}),h=async()=>{console.log(" Fetching fresh data from Firestore...");try{const K=await Zt.getData();if(K.setups&&K.setups.length>0){console.log(" Loaded",K.setups.length,"setups from Firestore"),s(K.setups);try{localStorage.setItem(Nu,JSON.stringify(K.setups))}catch(X){console.warn("Cache storage failed:",X)}}else console.warn(" No data from Firestore, using sample data"),s(HO);if(K.blogs&&K.blogs.length>0){console.log(" Loaded",K.blogs.length,"blogs from Firestore"),o(K.blogs);try{localStorage.setItem(jf,JSON.stringify(K.blogs))}catch(X){console.warn("Cache storage failed:",X)}}else o(Ql);localStorage.setItem(r0,Date.now().toString()),oe(K.comments||{})}catch(K){console.error(" Error loading data from Firestore:",K),console.log(" Keeping cached data due to network error")}finally{u(!1)}},[f,m]=A.useState({colorTone:[],budget:[],gender:[],purpose:[],size:[],search:""}),[g,y]=A.useState("gallery"),[v,w]=A.useState(null),[_,E]=A.useState(null),[N,R]=A.useState(!1),[O,S]=A.useState(!1),[T,k]=A.useState(!1),[I,M]=A.useState(!1),[D,P]=A.useState(!1),[pe,Ee]=A.useState(!1),[je,oe]=A.useState({});A.useEffect(()=>{h(),W();const K=uc.onAuthStateChanged(async X=>{var ie;if(X){const ge=sa.includes(X.email),se={id:X.uid,email:X.email,displayName:X.displayName||((ie=X.email)==null?void 0:ie.split("@")[0]),photoURL:X.photoURL,role:ge?"admin":"user"};l(se);try{const Ye=Wn(Ut,"users",X.uid);Ap(Ye).then(Ve=>{if(Ve.exists()){const Jt=Ve.data(),$=sa.includes(X.email);l(Ce=>({...Ce,displayName:Jt.displayName||Ce.displayName,photoURL:Jt.avatar||Ce.photoURL,role:$?"admin":Jt.role||Ce.role}))}}).catch(Ve=>console.warn("Background user fetch failed:",Ve))}catch(Ye){console.warn("Failed to initiate user fetch:",Ye)}}else l(null)});return()=>K()},[]);const W=()=>{const K=localStorage.getItem("deskhub_theme")||"light";n(K),document.documentElement.setAttribute("data-theme",K)},St={refreshData:h,forceRefresh:async()=>{var K,X,ie,ge;console.log(" Force refreshing all data...");try{if(localStorage.removeItem(Nu),localStorage.removeItem(jf),localStorage.removeItem(r0),console.log(" LocalStorage cache cleared"),"indexedDB"in window){const Ye=await((X=(K=window.indexedDB).databases)==null?void 0:X.call(K));if(Ye)for(const Ve of Ye)Ve.name&&Ve.name.includes("firestore")&&(window.indexedDB.deleteDatabase(Ve.name),console.log(" Cleared IndexedDB:",Ve.name))}u(!0);const se=await Zt.getData();return se.setups&&se.setups.length>0&&(s(se.setups),localStorage.setItem(Nu,JSON.stringify(se.setups))),se.blogs&&se.blogs.length>0&&(o(se.blogs),localStorage.setItem(jf,JSON.stringify(se.blogs))),localStorage.setItem(r0,Date.now().toString()),console.log(" Fresh data loaded:",(ie=se.setups)==null?void 0:ie.length,"setups,",(ge=se.blogs)==null?void 0:ge.length,"blogs"),{success:!0,message:" ti li d liu mi!"}}catch(se){return console.error(" Force refresh failed:",se),{success:!1,message:"Li khi ti li d liu"}}finally{u(!1)}},theme:e,toggleTheme:()=>{const K=e==="light"?"dark":"light";n(K),localStorage.setItem("deskhub_theme",K),document.documentElement.setAttribute("data-theme",K)},setups:r,loading:c,blogs:i,currentUser:a,refreshUser:()=>{a&&!a.isGuest||l(Tu())},filters:f,setFilters:m,currentView:g,setCurrentView:y,selectedSetup:v,setSelectedSetup:w,selectedBlog:_,setSelectedBlog:E,showAuthModal:N,setShowAuthModal:R,showProfileModal:O,setShowProfileModal:S,showNewsletterModal:T,setShowNewsletterModal:k,showCollectionsModal:I,setShowCollectionsModal:M,showAddSetupModal:D,setShowAddSetupModal:P,showMobileFilter:pe,setShowMobileFilter:Ee,getFilteredSetups:()=>r.filter(K=>{if(f.search){const ie=f.search.toLowerCase();if(!(K.title.toLowerCase().includes(ie)||K.caption.toLowerCase().includes(ie)||K.tags.some(se=>se.toLowerCase().includes(ie))))return!1}const X=["colorTone","budget","gender","purpose","size"];for(const ie of X)if(f[ie].length>0&&!f[ie].includes(K.filters[ie]))return!1;return!0}),toggleLike:async K=>{if(!a){R(!0);return}const X=a,ie=await Zt.toggleLike(K,X.id);ie.success&&s(ge=>ge.map(se=>se.id===K?{...se,likes:ie.likes}:se))},toggleSave:async K=>{if(!a){R(!0);return}const X=a,ie=await Zt.toggleSave(K,X.id);ie.success&&s(ge=>ge.map(se=>se.id===K?{...se,saves:ie.saves}:se))},hasUserLiked:K=>{const X=a||Tu();if(!X)return!1;const ie=r.find(se=>se.id===K);return ie?(ie.likes||[]).some(se=>se.userId===X.id||se===X.id):!1},hasUserSaved:K=>{const X=a||Tu();if(!X)return!1;const ie=r.find(se=>se.id===K);return ie?(ie.saves||[]).some(se=>se.userId===X.id||se===X.id):!1},getSavedSetups:()=>{const K=a||Tu();return K?r.filter(X=>(X.saves||[]).some(ge=>ge.userId===K.id||ge===K.id)):[]},addComment:async(K,X)=>{const ie=a||Tu(),ge=ie.photoURL||ie.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(ie.displayName||"User")}&background=random`;let se;typeof X=="object"&&X!==null?se={text:X.text,author:X.author||ie.displayName,avatar:X.avatar||ge,userId:X.userId||ie.id}:se={text:X,author:ie.displayName,avatar:ge,userId:ie.id};const Ye=await Zt.addComment(K,se);oe(Ve=>({...Ve,[K]:[...Ve[K]||[],Ye]})),s(Ve=>Ve.map(Jt=>Jt.id===K?{...Jt,comments:(Jt.comments||0)+1}:Jt))},getComments:K=>je[K]||[],fetchCommentsForSetup:async K=>{try{const X=await Zt.getCommentsForSetup(K);return oe(ie=>({...ie,[K]:X})),X}catch(X){return console.error("Error fetching comments:",X),[]}},subscribeNewsletter:async K=>{const X={email:K.email,name:K.name||"Khch"};return await Zt.subscribeNewsletter(X)},addBlog:async K=>{if(console.log(" AppContext.addBlog called"),(a==null?void 0:a.role)!=="admin")return console.warn(" Non-admin user attempted to add blog"),{success:!1,message:"Ch Admin mi c th vit blog!"};const X=a,ie=X.displayName||X.email||"Admin",ge=X.photoURL||X.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(ie)}&background=random`,se={...K,author:{name:ie,avatar:ge}};console.log(" Blog data prepared:",se);const Ye=await Zt.addBlog(se);return o([Ye,...i]),{success:!0,blog:Ye}},updateBlog:async(K,X)=>{if((a==null?void 0:a.role)!=="admin")return{success:!1,message:"Ch Admin mi c th chnh sa blog!"};const ie=await Zt.updateBlog(K,X);return ie.success?(o(ge=>ge.map(se=>se.id===K?ie.blog:se)),{success:!0,blog:ie.blog}):{success:!1,message:"Cp nht tht bi"}},deleteBlog:async K=>(a==null?void 0:a.role)!=="admin"?{success:!1,message:"Ch Admin mi c th xa blog!"}:(await Zt.deleteBlog(K)).success?(o(ie=>ie.filter(ge=>ge.id!==K)),{success:!0}):{success:!1,message:"Xa tht bi"},addSetup:async K=>{if(console.log(" AppContext.addSetup called"),(a==null?void 0:a.role)!=="admin")return console.warn(" Non-admin user attempted to add setup"),{success:!1,message:"Ch Admin mi c th thm setup!"};const X=a;console.log(" Current user:",{id:X.id,displayName:X.displayName,role:X.role});const ie=X.photoURL||X.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(X.displayName||"User")}`,ge={...K,author:{name:X.displayName||X.email||"Anonymous",avatar:ie}};console.log(" Calling api.addSetup with setupToSave:",ge);const se=await Zt.addSetup(ge);return console.log(" api.addSetup response:",se),se.success?(s(Ye=>[se.setup,...Ye]),{success:!0,setup:se.setup}):{success:!1,message:se.message||"Thm setup tht bi"}},updateSetup:async(K,X)=>{if((a==null?void 0:a.role)!=="admin")return{success:!1,message:"Ch Admin mi c th sa setup!"};const ie=await Zt.updateSetup(K,X);return ie.success?(s(ge=>ge.map(se=>se.id===K?ie.setup:se)),{success:!0,setup:ie.setup}):{success:!1,message:"Cp nht tht bi"}},deleteSetup:async K=>(a==null?void 0:a.role)!=="admin"?{success:!1,message:"Ch Admin mi c th xa setup!"}:(await Zt.deleteSetup(K)).success?(s(ie=>ie.filter(ge=>ge.id!==K)),{success:!0}):{success:!1,message:"Xa tht bi"},logout:async()=>{await Zt.logout()},getSimilarSetups:(K,X=4)=>{const ie=r.find(ge=>ge.id===K);return ie?r.filter(ge=>ge.id!==K).map(ge=>{let se=0;Object.keys(ie.filters).forEach(Ve=>{ge.filters[Ve]===ie.filters[Ve]&&(se+=1)});const Ye=ge.tags.filter(Ve=>ie.tags.includes(Ve)).length;return se+=Ye*.5,{...ge,similarityScore:se}}).sort((ge,se)=>se.similarityScore-ge.similarityScore).slice(0,X):[]},setBlogs:o};return d.jsx(WO.Provider,{value:St,children:t})},eq=()=>{const{theme:t,toggleTheme:e,filters:n,setFilters:r,currentUser:s,setShowAuthModal:i,setShowProfileModal:o,setShowNewsletterModal:a,setShowCollectionsModal:l,setShowAddSetupModal:c,setShowMobileFilter:u}=yn(),[h,f]=A.useState(!1),[m,g]=A.useState(!1),[y,v]=A.useState(!1),w=rl(),_=mi(),E=_.pathname==="/"||_.pathname==="/gallery",N=T=>{r({...n,search:T.target.value}),_.pathname!=="/"&&_.pathname!=="/gallery"&&w("/")},R=()=>v(!1),S=Object.keys(n).reduce((T,k)=>k==="search"?T:T+n[k].length,0);return d.jsxs("header",{className:"header",children:[d.jsxs("div",{className:"container header-container",children:[d.jsxs(Sr,{to:"/",className:"header-logo",onClick:R,children:[d.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:[d.jsx("rect",{width:"32",height:"32",rx:"8",fill:"url(#logo-gradient)"}),d.jsx("path",{d:"M8 12h16M8 16h16M8 20h12",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),d.jsx("defs",{children:d.jsxs("linearGradient",{id:"logo-gradient",x1:"0",y1:"0",x2:"32",y2:"32",children:[d.jsx("stop",{offset:"0%",stopColor:"hsl(220, 90%, 56%)"}),d.jsx("stop",{offset:"100%",stopColor:"hsl(280, 70%, 60%)"})]})})]}),d.jsx("span",{className:"header-logo-text",children:"DeskHub"})]}),d.jsxs("nav",{className:"header-nav desktop-only",children:[d.jsx(Sr,{to:"/",className:`nav-link ${_.pathname==="/"||_.pathname==="/gallery"?"active":""}`,children:"B Su Tp"}),d.jsx(Sr,{to:"/blog",className:`nav-link ${_.pathname.startsWith("/blog")?"active":""}`,children:"Blog"})]}),d.jsxs("div",{className:"header-actions",children:[(s==null?void 0:s.role)==="admin"&&d.jsxs("div",{className:"desktop-only",style:{display:"flex",alignItems:"center"},children:[d.jsx(Sr,{to:"/blog/seo-new",className:"btn",style:{padding:"0.5rem 1rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",marginRight:"0.5rem",textDecoration:"none",borderRadius:"8px"},children:" Blog"}),d.jsxs("button",{className:"btn btn-primary",style:{padding:"0.5rem 1rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},onClick:()=>c(!0),children:[d.jsx("span",{children:"+"})," ng Gc"]})]}),d.jsxs("div",{className:`search-container ${h?"expanded":""}`,children:[d.jsx("input",{type:"text",className:"search-input",placeholder:"Tm kim...",value:n.search,onChange:N,onFocus:()=>f(!0),onBlur:()=>!n.search&&f(!1)}),d.jsx("svg",{className:"search-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),E&&d.jsxs("button",{className:"btn-icon mobile-filter-btn mobile-only",onClick:()=>u(!0),title:"B lc",children:[d.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:d.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),S>0&&d.jsx("span",{className:"filter-badge",children:S})]}),d.jsx("button",{className:"btn-icon mobile-menu-toggle mobile-only",onClick:()=>v(!0),children:s?d.jsx("img",{src:s.avatar||`https://ui-avatars.com/api/?name=${s.displayName}`,alt:"",className:"mobile-avatar-btn"}):d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),d.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),d.jsx("button",{className:"btn btn-icon theme-toggle desktop-only",onClick:e,title:"i theme",style:{fontSize:"22px",lineHeight:1},children:t==="light"?"":""}),d.jsxs("div",{className:"user-menu-container desktop-only",children:[d.jsx("button",{className:"user-avatar-btn",onClick:()=>g(!m),children:d.jsx("img",{src:(s==null?void 0:s.avatar)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.displayName)||"Guest"}`,alt:""})}),m&&d.jsxs("div",{className:"user-menu",children:[d.jsxs("div",{className:"user-menu-header",children:[d.jsx("img",{src:(s==null?void 0:s.avatar)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.displayName)||"Guest"}`,alt:""}),d.jsxs("div",{children:[d.jsx("p",{className:"user-menu-name",children:(s==null?void 0:s.displayName)||"Khch"}),d.jsx("p",{className:"user-menu-role",children:s?s.role==="admin"?"Qun tr vin":"Thnh vin":"Cha ng nhp"})]})]}),d.jsxs("div",{className:"user-menu-items",children:[d.jsxs("button",{onClick:()=>{o(!0),g(!1)},children:[d.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M10 10a4 4 0 100-8 4 4 0 000 8zM3 18a7 7 0 0114 0",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"H S"]}),(s==null?void 0:s.role)==="admin"&&d.jsxs(Sr,{to:"/admin",onClick:()=>g(!1),style:{display:"flex",alignItems:"center",gap:"0.75rem",width:"100%",textAlign:"left",padding:"0.75rem 1rem",color:"var(--color-text-primary)",textDecoration:"none",fontSize:"0.95rem",background:"none",border:"none",cursor:"pointer"},onMouseEnter:T=>T.target.style.background="var(--color-surface-hover)",onMouseLeave:T=>T.target.style.background="transparent",children:[d.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("rect",{x:"3",y:"3",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),d.jsx("rect",{x:"11",y:"3",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),d.jsx("rect",{x:"3",y:"11",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),d.jsx("rect",{x:"11",y:"11",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),"Dashboard"]}),d.jsxs("button",{onClick:()=>{l(!0),g(!1)},children:[d.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"2"})}),"Setup  Lu"]}),!s&&d.jsxs("button",{onClick:()=>{i(!0),g(!1)},children:[d.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M10 3v14M3 10h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"ng Nhp / ng K"]})]})]})]})]})]}),m&&d.jsx("div",{className:"user-menu-overlay",onClick:()=>g(!1)}),d.jsxs(d.Fragment,{children:[d.jsx("div",{className:`mobile-menu-backdrop ${y?"open":""}`,onClick:()=>v(!1)}),d.jsxs("div",{className:`mobile-menu-drawer ${y?"open":""}`,children:[d.jsxs("div",{className:"mobile-menu-header",children:[d.jsx("h3",{children:"Menu"}),d.jsx("button",{className:"mobile-close-btn",onClick:()=>v(!1),children:d.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),d.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s&&d.jsxs("div",{className:"mobile-user-profile",onClick:()=>{o(!0),R()},children:[d.jsx("img",{src:s.avatar,alt:"Avatar"}),d.jsxs("div",{children:[d.jsx("p",{className:"name",children:s.displayName}),d.jsx("p",{className:"role",children:s.role==="admin"?"Admin":"Member"})]})]}),d.jsxs("div",{className:"mobile-nav-links",children:[d.jsx(Sr,{to:"/",className:`mobile-nav-item ${_.pathname==="/"?"active":""}`,onClick:R,children:"Trang Ch"}),d.jsx(Sr,{to:"/blog",className:`mobile-nav-item ${_.pathname.startsWith("/blog")?"active":""}`,onClick:R,children:"Blog"}),(s==null?void 0:s.role)==="admin"&&d.jsx(Sr,{to:"/admin",className:"mobile-nav-item",onClick:R,children:"Qun L (Admin)"})]}),d.jsxs("div",{className:"mobile-actions",children:[d.jsx("button",{className:"mobile-action-btn",onClick:()=>{l(!0),R()},children:"Setup  Lu"}),(s==null?void 0:s.role)==="admin"&&d.jsx("button",{className:"mobile-action-btn primary",onClick:()=>{c(!0),R()},children:"+ ng Setup"}),!s&&d.jsx("button",{className:"mobile-action-btn primary",onClick:()=>{i(!0),R()},children:"ng Nhp"}),d.jsx("button",{className:"mobile-action-btn",onClick:e,children:t==="light"?"Ch  Ti":"Ch  Sng"})]})]})]})]})},qO=()=>{const{filters:t,setFilters:e,showMobileFilter:n,setShowMobileFilter:r}=yn(),[s,i]=A.useState(!1),o=(h,f)=>{const m=t[h],g=m.includes(f)?m.filter(y=>y!==f):[...m,f];e({...t,[h]:g})},a=()=>{e({colorTone:[],budget:[],gender:[],purpose:[],size:[],search:""})},c=Object.keys(t).reduce((h,f)=>f==="search"?h:h+t[f].length,0),u=n;return d.jsxs(d.Fragment,{children:[u&&d.jsx("div",{className:"filter-backdrop mobile-only",onClick:()=>r(!1)}),d.jsx("aside",{className:`filter-sidebar ${s?"collapsed":""} ${u?"mobile-open":""}`,children:d.jsxs("div",{className:"sidebar-content",children:[d.jsxs("div",{className:"sidebar-header",children:[d.jsx("button",{className:"sidebar-toggle desktop-only",onClick:()=>i(!s),title:s?"Hin b lc":"n b lc",children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M3 6h14M3 10h14M3 14h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsx("button",{className:"sidebar-close mobile-only",onClick:()=>r(!1),children:d.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),d.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),d.jsxs("h3",{className:"sidebar-title",children:["B Lc",c>0&&d.jsx("span",{className:"filter-count",children:c})]}),c>0&&d.jsx("button",{className:"btn-clear-all",onClick:a,children:"Xa tt c"})]}),d.jsx("div",{className:"filter-groups",children:Object.entries(Rl).map(([h,f])=>d.jsx(tq,{category:h,options:f,selectedValues:t[h],onToggle:o},h))})]})})]})},tq=({category:t,options:e,selectedValues:n,onToggle:r})=>{const[s,i]=A.useState(!0),o={colorTone:"Tng Mu",budget:"Ngn Sch",gender:"Phong Cch",purpose:"Mc ch",size:"Kch Thc"};return d.jsxs("div",{className:"filter-group",children:[d.jsxs("button",{className:"filter-group-header",onClick:()=>i(!s),children:[d.jsx("span",{className:"filter-group-title",children:o[t]}),d.jsx("svg",{className:`expand-icon ${s?"expanded":""}`,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:d.jsx("path",{d:"M4 6l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),s&&d.jsx("div",{className:"filter-options",children:e.map(a=>d.jsxs("label",{className:"filter-option",children:[d.jsx("input",{type:"checkbox",checked:n.includes(a.value),onChange:()=>r(t,a.value),className:"filter-checkbox"}),d.jsxs("span",{className:"filter-option-content",children:[d.jsx("span",{className:"filter-option-label",children:a.label}),d.jsx("span",{className:"filter-option-description",children:a.description})]})]},a.value))})]})},nq=({setup:t,index:e})=>{var S,T;const{toggleLike:n,toggleSave:r,hasUserLiked:s,hasUserSaved:i}=yn(),[o,a]=A.useState(!1),[l,c]=A.useState(!1),u=A.useRef(null),[h,f]=A.useState(!1),[m,g]=A.useState(!1),y=s(t.id),v=i(t.id),w=k=>{k.preventDefault(),k.stopPropagation(),n(t.id),g(!1)},_=k=>{k.preventDefault(),k.stopPropagation(),r(t.id),g(!1)},E=k=>{k.preventDefault(),k.stopPropagation();const I=`${window.location.origin}/setup/${t.id}`;navigator.share?navigator.share({title:t.title,text:t.caption,url:I}):(navigator.clipboard.writeText(I),alert(" copy link!")),g(!1)},N=k=>{k.preventDefault(),k.stopPropagation(),m||document.querySelectorAll(".setup-card").forEach(M=>{M.dispatchEvent(new CustomEvent("closeOtherMenus",{detail:{exceptId:t.id}}))}),g(!m)};qe.useEffect(()=>{const k=document.querySelector(`[data-setup-id="${t.id}"]`);if(k){const I=M=>{M.detail.exceptId!==t.id&&g(!1)};return k.addEventListener("closeOtherMenus",I),()=>k.removeEventListener("closeOtherMenus",I)}},[t.id]),qe.useEffect(()=>{if(m){const k=M=>{!M.target.closest(".mobile-menu-popup")&&!M.target.closest(".mobile-menu-btn")&&g(!1)},I=()=>{g(!1)};return document.addEventListener("click",k),window.addEventListener("scroll",I,{passive:!0}),()=>{document.removeEventListener("click",k),window.removeEventListener("scroll",I)}}},[m]);const R=()=>{if(t.thumbnailVideo&&u.current){const k=u.current.play();k!==void 0&&k.then(()=>f(!0)).catch(()=>{})}},O=()=>{t.thumbnailVideo&&u.current&&(u.current.pause(),u.current.currentTime=0,f(!1))};return d.jsxs(d.Fragment,{children:[d.jsx(Sr,{to:`/setup/${t.id}`,className:"setup-card","data-setup-id":t.id,onMouseEnter:R,onMouseLeave:O,children:d.jsxs("div",{className:"setup-card-image-container",children:[t.thumbnailVideo&&d.jsx("video",{ref:u,className:"setup-card-image",muted:!0,loop:!0,playsInline:!0,style:{display:h?"block":"none"},children:d.jsx("source",{src:t.thumbnailVideo,type:"video/mp4"})}),t.images&&t.images.length>0?d.jsx("img",{src:typeof t.images[0]=="string"?t.images[0]:((S=t.images[0])==null?void 0:S.url)||((T=t.images[0])==null?void 0:T.src),alt:t.title||"Setup image",className:`setup-card-image ${o?"loaded":""}`,loading:"lazy",decoding:"async",onLoad:()=>a(!0),onError:k=>{var I;console.error("Image load error:",{raw:t.images[0],type:typeof t.images[0],url:typeof t.images[0]=="string"?t.images[0]:(I=t.images[0])==null?void 0:I.url}),c(!0)},style:{display:t.thumbnailVideo&&h?"none":"block"}}):d.jsxs("div",{className:"image-error",children:[d.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:[d.jsx("path",{d:"M24 4L4 44h40L24 4z",stroke:"currentColor",strokeWidth:"2"}),d.jsx("path",{d:"M24 18v12M24 34v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),d.jsx("span",{children:"Khng c nh"})]}),!o&&!l&&d.jsx("div",{className:"skeleton-image-placeholder"}),t.thumbnailVideo&&!h&&d.jsx("div",{className:"video-play-indicator",children:d.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"white",children:[d.jsx("circle",{cx:"24",cy:"24",r:"24",opacity:"0.9"}),d.jsx("path",{d:"M18 14l16 10-16 10V14z",fill:"black"})]})}),l&&!t.thumbnailVideo&&d.jsxs("div",{className:"image-error",children:[d.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:[d.jsx("path",{d:"M24 4L4 44h40L24 4z",stroke:"currentColor",strokeWidth:"2"}),d.jsx("path",{d:"M24 18v12M24 34v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),d.jsx("span",{children:"nh li"})]}),d.jsx("div",{className:"setup-card-overlay",style:{zIndex:4}}),d.jsxs("div",{className:"setup-card-actions",style:{zIndex:5},children:[d.jsx("button",{className:`action-btn ${y?"active":""}`,onClick:w,title:y?"B thch":"Thch",children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:y?"currentColor":"none",children:d.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})})}),d.jsx("button",{className:`action-btn ${v?"active":""}`,onClick:_,title:v?"B lu":"Lu",children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:v?"currentColor":"none",children:d.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})})}),d.jsx("button",{className:"action-btn",onClick:E,title:"Chia s",children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M15 13v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3M10 3v10M10 3l-3 3M10 3l3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})})]}),d.jsx("div",{className:"setup-card-tags",style:{zIndex:5},children:t.tags.slice(0,3).map(k=>d.jsxs("span",{className:"tag",children:["#",k]},k))}),d.jsx("button",{className:"mobile-menu-btn",onClick:N,style:{zIndex:6},children:d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("circle",{cx:"10",cy:"4",r:"1.5",fill:"currentColor"}),d.jsx("circle",{cx:"10",cy:"10",r:"1.5",fill:"currentColor"}),d.jsx("circle",{cx:"10",cy:"16",r:"1.5",fill:"currentColor"})]})})]})}),m&&d.jsxs("div",{className:"mobile-menu-popup",children:[d.jsxs("div",{className:"mobile-menu-header",children:[d.jsx("button",{className:"mobile-menu-close",onClick:k=>{k.preventDefault(),k.stopPropagation(),g(!1)},children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsx("h3",{children:"Ty chn"}),d.jsx("div",{style:{width:"24px"}})]}),d.jsxs("div",{className:"mobile-menu-actions",children:[d.jsxs("button",{onClick:w,className:y?"active":"",children:[d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:y?"currentColor":"none",children:d.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})}),d.jsx("span",{children:y?"B thch":"Thch"})]}),d.jsxs("button",{onClick:_,className:v?"active":"",children:[d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:v?"currentColor":"none",children:d.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})}),d.jsx("span",{children:v?" lu":"Lu"})]}),d.jsxs("button",{onClick:E,children:[d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M15 13v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3M10 3v10M10 3l-3 3M10 3l3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),d.jsx("span",{children:"Chia s"})]})]})]})]})},Iy=({title:t,description:e,image:n,url:r,type:s="website",schema:i})=>{const o="DeskHub",a="DeskHub - Cng ng Chia S Gc Lm Vic p",l="Khm ph hng ngn  tng setup gc lm vic, bn gaming, v khng gian sng to t cng ng.",c="https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=1200&q=80",u=t?`${t} | ${o}`:a,h=e||l,f=n||c,m=r||window.location.href;return d.jsxs(o5,{children:[d.jsx("title",{children:u}),d.jsx("meta",{name:"description",content:h}),d.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),d.jsx("link",{rel:"canonical",href:m}),d.jsx("meta",{property:"og:site_name",content:o}),d.jsx("meta",{property:"og:title",content:u}),d.jsx("meta",{property:"og:description",content:h}),d.jsx("meta",{property:"og:image",content:f}),d.jsx("meta",{property:"og:url",content:m}),d.jsx("meta",{property:"og:type",content:s}),d.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),d.jsx("meta",{name:"twitter:title",content:u}),d.jsx("meta",{name:"twitter:description",content:h}),d.jsx("meta",{name:"twitter:image",content:f}),i&&d.jsx("script",{type:"application/ld+json",children:JSON.stringify(i)})]})},rq=()=>{var N,R,O,S,T;const{getFilteredSetups:t,loading:e,filters:n,setups:r}=yn(),[s,i]=A.useState([]),[o,a]=A.useState(1),[l,c]=A.useState(!1),u=A.useRef(null),h=A.useRef(null),f=12,m=A.useMemo(()=>t(),[t]);A.useEffect(()=>{g(1)},[m]),A.useEffect(()=>{const k={root:null,rootMargin:"200px",threshold:.1};return u.current=new IntersectionObserver(I=>{I[0].isIntersecting&&!l&&y()},k),h.current&&u.current.observe(h.current),()=>{u.current&&u.current.disconnect()}},[l,o]);const g=k=>{c(!0);const I=0,M=k*f,D=m.slice(I,M);i(D),a(k),c(!1)},y=()=>{const k=o+1,I=k*f;if(s.length<m.length){c(!0);const M=m.slice(0,I);i(M),a(k),c(!1)}},v=s.length<m.length,w=n.search||((N=n.colorTone)==null?void 0:N.length)>0||((R=n.budget)==null?void 0:R.length)>0||((O=n.gender)==null?void 0:O.length)>0||((S=n.purpose)==null?void 0:S.length)>0||((T=n.size)==null?void 0:T.length)>0,_=e||r.length===0,E=!_&&w&&m.length===0;return d.jsxs("div",{className:"masonry-gallery",children:[d.jsx(Iy,{title:"Khm Ph Gc Lm Vic - DeskHub",description:"B su tp nhng gc lm vic, setup bn phm, mn hnh p nht c chia s bi cng ng."}),_&&d.jsxs("div",{className:"loading-state",children:[d.jsx("div",{className:"loading-spinner"}),d.jsx("h3",{children:"Sp load xong cc gc setup, bn ng thot nh "}),d.jsx("p",{children:"ang ti d liu t server..."})]}),E&&d.jsxs("div",{className:"empty-state",children:[d.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",children:[d.jsx("path",{d:"M60 20L20 100h80L60 20z",stroke:"currentColor",strokeWidth:"4"}),d.jsx("path",{d:"M60 45v30M60 85v4",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})]}),d.jsx("h3",{children:"Khng tm thy setup no"}),d.jsx("p",{children:"Th thay i b lc hoc tm kim vi t kha khc"})]}),!_&&s.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"masonry-grid",children:s.map((k,I)=>d.jsx(nq,{setup:k,index:I},k.id))}),v&&d.jsx("div",{ref:h,className:"load-more-trigger",children:l&&d.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:d.jsx("p",{children:"ang ti..."})})}),!v&&s.length>0&&d.jsx("div",{className:"end-message",children:" Bn  xem ht tt c!"})]})]})},sq=()=>{var tr,wr,xr;const{selectedSetup:t,setSelectedSetup:e,toggleLike:n,toggleSave:r,addComment:s,getComments:i,fetchCommentsForSetup:o,hasUserLiked:a,hasUserSaved:l,getSimilarSetups:c,currentUser:u,setups:h,setShowAuthModal:f}=yn(),[m,g]=A.useState(null),[y,v]=A.useState(0),[w,_]=A.useState(""),[E,N]=A.useState(!0),[R,O]=A.useState(!1),[S,T]=A.useState(!1),[k,I]=A.useState(null),[M,D]=A.useState(null),[P,pe]=A.useState(null),Ee=A.useRef(null),je=50;if(qe.useEffect(()=>{t!=null&&t.id&&o(t.id)},[t==null?void 0:t.id,o]),qe.useEffect(()=>{const q=()=>O(window.innerWidth<=768);return q(),window.addEventListener("resize",q),()=>window.removeEventListener("resize",q)},[]),qe.useEffect(()=>{R&&t&&W.length>1&&(localStorage.getItem("hasSeenSwipeHint")||(T(!0),setTimeout(()=>{T(!1),localStorage.setItem("hasSeenSwipeHint","true")},3e3)))},[R,t]),!t)return null;const oe=t,W=((tr=oe.images)==null?void 0:tr.length)>0?[...oe.images.map(q=>({type:"image",url:q.url,products:q.products||[]})),...oe.youtubeVideo?[{type:"youtube",url:oe.youtubeVideo,poster:oe.mainImage}]:[]]:[{type:"image",url:oe.mainImage,products:oe.products||[]},...(oe.moreImages||[]).map(q=>({type:"image",url:q})),...oe.youtubeVideo?[{type:"youtube",url:oe.youtubeVideo,poster:oe.mainImage}]:[]],V=W[y]||W[0],Z=a(oe.id),ce=l(oe.id),U=i(oe.id),he=c(oe.id),we=()=>{m&&g(null)},dt=()=>{e(null),_("")},st=()=>{if(!u){f(!0);return}n(oe.id)},it=q=>{if(q.preventDefault(),!u){f(!0);return}if(w.trim()){const xe=u.photoURL||u.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(u.displayName||"User")}&background=random`,Me={text:w,author:u.displayName,userId:u.id,avatar:xe};P&&(Me.replyTo={commentId:P.id,author:P.author}),s(oe.id,Me),_(""),pe(null)}},$e=q=>{var Me,St;if(!u){f(!0);return}const xe=typeof q.author=="string"?q.author:((Me=q.author)==null?void 0:Me.name)||((St=q.author)==null?void 0:St.displayName)||"n danh";pe({id:q.id,author:xe}),_(`@${xe} `),Ee.current&&Ee.current.focus()},ae=()=>{pe(null),_("")},Qt=q=>{q.target===q.currentTarget&&dt()},Rn={"@context":"https://schema.org","@type":"CreativeWork",name:oe.title,image:oe.mainImage,creator:{"@type":"Person",name:oe.author.name},description:oe.caption,interactionStatistic:[{"@type":"InteractionCounter",interactionType:"https://schema.org/LikeAction",userInteractionCount:((wr=oe.likes)==null?void 0:wr.length)||0}]},$r=q=>{D(null),I(q.targetTouches[0].clientX)},vr=q=>{D(q.targetTouches[0].clientX)},Pn=()=>{if(!k||!M)return;const q=k-M,xe=q>je,Me=q<-je;xe&&y<W.length-1&&v(St=>St+1),Me&&y>0&&v(St=>St-1)};return d.jsxs("div",{className:"modal-overlay",onClick:Qt,children:[d.jsx(Iy,{title:oe.title,description:oe.caption,image:oe.mainImage,type:"article",schema:Rn}),d.jsxs("div",{className:"setup-detail-modal modal-content",children:[d.jsx("button",{className:"modal-close-btn",onClick:dt,children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),S&&R&&d.jsxs("div",{className:"swipe-hint-popup",children:[d.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",children:[d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M9 18l6-6-6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),d.jsx("p",{children:"Vut  xem nh tip theo"})]}),d.jsxs("div",{className:"modal-layout",children:[d.jsxs("div",{className:"modal-gallery",children:[d.jsxs("div",{className:"main-image-container",onClick:we,onTouchStart:R?$r:void 0,onTouchMove:R?vr:void 0,onTouchEnd:R?Pn:void 0,children:[V.type==="video"?d.jsx("video",{src:V.url,className:"main-image",controls:!0,autoPlay:!0,muted:!1,poster:V.poster,style:{objectFit:"contain",background:"#000"}}):V.type==="youtube"?d.jsx(iq,{url:V.url,poster:V.poster}):d.jsxs("div",{className:"image-wrapper-relative",children:[d.jsx("img",{src:V.url,alt:oe.title,className:"main-image"}),E&&V.products&&Array.isArray(V.products)&&V.products.map((q,xe)=>d.jsx(oq,{product:q,isActive:m===q,onActivate:g},xe)),d.jsx("button",{className:"toggle-products-btn",onClick:q=>{q.stopPropagation(),N(!E)},"aria-label":E?"n sn phm":"Hin sn phm",children:R?E?d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),d.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),d.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):E?"n sn phm":"Hin sn phm"}),W.length>1&&d.jsxs(d.Fragment,{children:[d.jsx("button",{className:"nav-arrow prev",onClick:q=>{q.stopPropagation(),v(xe=>Math.max(0,xe-1))},disabled:y===0,"aria-label":"Previous image",children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),d.jsx("button",{className:"nav-arrow next",onClick:q=>{q.stopPropagation(),v(xe=>Math.min(W.length-1,xe+1))},disabled:y===W.length-1,"aria-label":"Next image",children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),W.length>1&&d.jsx("div",{className:"image-pagination-dots",children:W.slice(0,5).map((q,xe)=>{let Me="pagination-dot";return xe===y&&(Me+=" active"),xe===3&&(Me+=" dot-small"),xe===4&&(Me+=" dot-tiny"),d.jsx("button",{className:Me,onClick:St=>{St.stopPropagation(),v(xe)},"aria-label":`Go to image ${xe+1}`},xe)})})]}),W.length>1&&d.jsx("div",{className:"image-thumbnails",children:W.map((q,xe)=>d.jsx("button",{className:`thumbnail ${xe===y?"active":""}`,onClick:()=>v(xe),children:q.type==="video"?d.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[d.jsx("img",{src:q.poster,alt:"Video",style:{width:"100%",height:"100%",objectFit:"cover"}}),d.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:d.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"white",children:d.jsx("path",{d:"M8 5v14l11-7z"})})})]}):q.type==="youtube"?d.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[d.jsx("img",{src:q.poster,alt:"YouTube",style:{width:"100%",height:"100%",objectFit:"cover"}}),d.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"red",children:d.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})})]}):d.jsx("img",{src:q.url,alt:`View ${xe+1}`})},xe))})]}),d.jsxs("div",{className:"modal-details",children:[d.jsxs("div",{className:"detail-header",children:[d.jsxs("div",{className:"author-info",children:[d.jsx("img",{src:oe.author.avatar,alt:oe.author.name,className:"author-avatar-large"}),d.jsxs("div",{children:[d.jsx("h2",{className:"detail-title",children:oe.title}),d.jsx("p",{className:"author-name-large",children:oe.author.name})]})]}),d.jsxs("div",{className:"detail-actions",children:[d.jsxs("button",{className:`action-btn-large ${Z?"active":""}`,onClick:st,children:[d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:Z?"currentColor":"none",children:d.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})}),d.jsx("span",{children:(((xr=oe.likes)==null?void 0:xr.length)||0).toLocaleString()})]}),d.jsxs("button",{className:`action-btn-large ${ce?"active":""}`,onClick:()=>r(oe.id),children:[d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:ce?"currentColor":"none",children:d.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})}),d.jsx("span",{children:ce?" Lu":"Lu"})]})]})]}),d.jsx("p",{className:"detail-caption",children:oe.caption}),d.jsx("div",{className:"detail-tags",children:oe.tags&&Array.isArray(oe.tags)&&oe.tags.map(q=>d.jsxs("span",{className:"detail-tag",children:["#",q]},q))}),d.jsxs("div",{className:"detail-filters",children:[d.jsx("h4",{children:"Chi Tit Setup"}),d.jsx("div",{className:"filter-badges",children:Object.entries(oe.filters).map(([q,xe])=>d.jsx("span",{className:"filter-badge",children:xe.replace("-"," ")},q))})]}),d.jsxs("div",{className:"comments-section",children:[d.jsxs("h4",{children:["Bnh Lun (",U.length,")"]}),P&&d.jsxs("div",{className:"reply-indicator",children:[d.jsxs("span",{children:["ang tr li ",d.jsxs("strong",{children:["@",P.author]})]}),d.jsx("button",{type:"button",className:"cancel-reply-btn",onClick:ae,children:d.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),d.jsxs("form",{className:"comment-form",onSubmit:it,children:[d.jsxs("div",{className:"comment-input-wrapper",children:[d.jsx("img",{src:(u==null?void 0:u.photoURL)||(u==null?void 0:u.avatar)||"https://ui-avatars.com/api/?name=User&background=random",alt:"Avatar",className:"comment-user-avatar"}),d.jsx("input",{ref:Ee,type:"text",className:"input comment-input",placeholder:P?`Tr li @${P.author}...`:u?`Bnh lun vi tn ${u.displayName}...`:"ng nhp  bnh lun...",value:w,onChange:q=>_(q.target.value),onClick:()=>!u&&f(!0)})]}),d.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!w.trim(),onClick:q=>{u||(q.preventDefault(),f(!0))},children:"Gi"})]}),d.jsx("div",{className:"comments-list",children:U.length===0?d.jsx("p",{className:"no-comments",children:"Cha c bnh lun no. Hy l ngi u tin!"}):U.map(q=>{var ie,ge,se,Ye;const xe=typeof q.text=="string"?q.text:((ie=q.text)==null?void 0:ie.text)||JSON.stringify(q.text)||"",Me=typeof q.author=="string"?q.author:((ge=q.author)==null?void 0:ge.name)||((se=q.author)==null?void 0:se.displayName)||"n danh",St=typeof q.avatar=="string"?q.avatar:((Ye=q.avatar)==null?void 0:Ye.url)||"https://ui-avatars.com/api/?name=User&background=random",K=q.timestamp?new Date(q.timestamp).toLocaleDateString("vi-VN"):"",X=Ve=>{const Jt=/@(\S+)/g,$=[];let Ce=0,Re;for(;(Re=Jt.exec(Ve))!==null;)Re.index>Ce&&$.push(Ve.substring(Ce,Re.index)),$.push(d.jsxs("span",{className:"mention-tag",children:["@",Re[1]]},Re.index)),Ce=Re.index+Re[0].length;return Ce<Ve.length&&$.push(Ve.substring(Ce)),$.length>0?$:Ve};return d.jsxs("div",{className:"comment",children:[d.jsx("img",{src:St,alt:Me,className:"comment-avatar"}),d.jsxs("div",{className:"comment-content",children:[d.jsxs("div",{className:"comment-header",children:[d.jsx("span",{className:"comment-author",children:Me}),d.jsxs("div",{className:"comment-actions",children:[d.jsx("button",{type:"button",className:"reply-btn",onClick:()=>$e(q),children:"Tr li"}),d.jsx("span",{className:"comment-time",children:K})]})]}),q.replyTo&&d.jsxs("p",{className:"reply-to-indicator",children:[" Tr li ",d.jsxs("span",{className:"mention-tag",children:["@",q.replyTo.author]})]}),d.jsx("p",{className:"comment-text",children:X(xe)})]})]},q.id)})})]}),he.length>0&&d.jsxs("div",{className:"similar-setups",children:[d.jsx("h4",{children:"Setup Tng T"}),d.jsx("div",{className:"similar-grid",children:he.map(q=>d.jsxs("div",{className:"similar-card",onClick:()=>{e(q),v(0),_("")},children:[d.jsx("img",{src:q.mainImage,alt:q.title}),d.jsx("p",{className:"similar-title",children:q.title})]},q.id))})]})]})]})]}),R&&m&&X_.createPortal(d.jsxs("div",{className:"product-tooltip-portal",style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:"380px",background:"rgba(20, 20, 20, 0.95)",backdropFilter:"blur(12px)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"20px",zIndex:1e5,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)",borderRadius:"16px",display:"flex",flexDirection:"column",gap:"12px",animation:"slideUpFade 0.3s ease-out"},onClick:q=>q.stopPropagation(),children:[d.jsx("button",{style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"20px",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",lineHeight:"1"},onClick:q=>{q.stopPropagation(),g(null)},onMouseEnter:q=>{q.target.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:q=>{q.target.style.background="rgba(255, 255, 255, 0.1)"},children:""}),d.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"white",margin:"0 24px 0 0",lineHeight:"1.4",paddingRight:"8px"},children:m.name}),d.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:"#ff6b35",margin:"4px 0",lineHeight:"1.2"},children:m.price}),m.link&&d.jsxs("a",{href:m.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"15px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"14px 24px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"8px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.4)",transition:"all 0.2s",border:"none"},onMouseEnter:q=>{q.target.style.transform="translateY(-2px)",q.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.5)"},onMouseLeave:q=>{q.target.style.transform="translateY(0)",q.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.4)"},children:[d.jsx("span",{children:"Xem sn phm"}),d.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",style:{marginTop:"1px"},children:d.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),document.body)]})},iq=({url:t,poster:e})=>{const[n,r]=A.useState(!1);return qe.useEffect(()=>{r(!1)},[t]),n?d.jsx("iframe",{width:"100%",height:"100%",src:`${t}?autoplay=1&rel=0`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{aspectRatio:"16/9",borderRadius:"8px",minHeight:"400px"}}):d.jsxs("div",{className:"youtube-placeholder",onClick:()=>r(!0),style:{position:"relative",width:"100%",height:"100%",minHeight:"400px",cursor:"pointer",backgroundImage:`url(${e})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:[d.jsx("div",{style:{background:"red",width:"60px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:d.jsx("div",{style:{width:0,height:0,borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"16px solid white"}})}),d.jsx("div",{style:{position:"absolute",bottom:"10px",left:"10px",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:"Click  pht video"})]})},oq=({product:t,isActive:e,onActivate:n})=>{const[r,s]=A.useState(!1);qe.useEffect(()=>{const o=()=>s(window.innerWidth<=768);return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const i=o=>{o.stopPropagation(),n(e?null:t)};return d.jsxs("div",{className:"product-marker",style:{left:`${t.x}%`,top:`${t.y}%`},onClick:i,children:[d.jsx("button",{className:`marker-btn ${e?"active":""}`,children:d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"var(--color-primary)"}),d.jsx("path",{d:"M10 6v8M6 10h8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),!r&&e&&d.jsxs("div",{className:"product-tooltip-desktop",style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%) translateY(-8px)",marginBottom:"8px",background:"white",color:"#333",padding:"16px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)",minWidth:"280px",maxWidth:"320px",zIndex:1e4,animation:"fadeIn 0.2s ease-out",border:"1px solid rgba(0, 0, 0, 0.08)"},onClick:o=>o.stopPropagation(),children:[d.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#333",margin:"0 0 8px 0",lineHeight:"1.4"},children:t.name}),d.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#ff6b35",margin:"0 0 12px 0",lineHeight:"1.2"},children:t.price}),t.link&&d.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"14px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"10px 20px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.3)",transition:"all 0.2s",border:"none"},onMouseEnter:o=>{o.target.style.transform="translateY(-2px)",o.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.4)"},onMouseLeave:o=>{o.target.style.transform="translateY(0)",o.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.3)"},children:[d.jsx("span",{children:"Xem sn phm"}),d.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",children:d.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),d.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"8px solid white",filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05))"}})]})]})},aq=()=>{const{blogs:t}=yn();return d.jsxs("div",{className:"blog-view",children:[d.jsx(Iy,{title:"Blog DeskHub - Kinh Nghim & Cm Hng",description:"Tng hp cc bi vit hng dn setup, review gear, v xu hng thit k gc lm vic mi nht."}),d.jsxs("div",{className:"blog-hero",children:[d.jsx("h1",{children:"Gc Nhn Desk Setup"}),d.jsx("p",{children:"Mo, xu hng v cm hng cho gc lm vic hon ho ca bn"})]}),d.jsx("div",{className:"blog-grid",children:t.map(e=>d.jsx(Sr,{to:`/blog/${e.slug||e.id}`,className:"blog-card-link",children:d.jsxs("article",{className:"blog-card",children:[d.jsxs("div",{className:"blog-card-image",children:[d.jsx("img",{src:e.coverImage,alt:e.title}),d.jsx("span",{className:"blog-category",children:e.category})]}),d.jsxs("div",{className:"blog-card-content",children:[d.jsx("h3",{className:"blog-card-title",children:e.title}),d.jsx("p",{className:"blog-card-excerpt",children:e.excerpt}),d.jsxs("div",{className:"blog-card-meta",children:[d.jsxs("div",{className:"blog-author",children:[d.jsx("img",{src:e.author.avatar,alt:e.author.name}),d.jsx("span",{children:e.author.name})]}),d.jsxs("div",{className:"blog-stats",children:[d.jsxs("span",{className:"read-time",children:[d.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"1.5"}),d.jsx("path",{d:"M10 6v4l3 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),e.readTime," min"]}),d.jsxs("span",{className:"views",children:[d.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("path",{d:"M1 10s3-7 9-7 9 7 9 7-3 7-9 7-9-7-9-7z",stroke:"currentColor",strokeWidth:"1.5"}),d.jsx("circle",{cx:"10",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),e.views]})]})]})]})]})},e.id))})]})};var KO={exports:{}},lq="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",cq=lq,uq=cq;function GO(){}function QO(){}QO.resetWarningCache=GO;var hq=function(){function t(r,s,i,o,a,l){if(l!==uq){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:QO,resetWarningCache:GO};return n.PropTypes=n,n};KO.exports=hq();var dq=KO.exports;const ft=Io(dq);function fq(t){return t&&typeof t=="object"&&"default"in t?t.default:t}var JO=A,pq=fq(JO);function bC(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function mq(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var gq=!!(typeof window<"u"&&window.document&&window.document.createElement);function yq(t,e,n){if(typeof t!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof e!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof n<"u"&&typeof n!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function r(s){return s.displayName||s.name||"Component"}return function(i){if(typeof i!="function")throw new Error("Expected WrappedComponent to be a React component.");var o=[],a;function l(){a=t(o.map(function(u){return u.props})),c.canUseDOM?e(a):n&&(a=n(a))}var c=function(u){mq(h,u);function h(){return u.apply(this,arguments)||this}h.peek=function(){return a},h.rewind=function(){if(h.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var g=a;return a=void 0,o=[],g};var f=h.prototype;return f.UNSAFE_componentWillMount=function(){o.push(this),l()},f.componentDidUpdate=function(){l()},f.componentWillUnmount=function(){var g=o.indexOf(this);o.splice(g,1),l()},f.render=function(){return pq.createElement(i,this.props)},h}(JO.PureComponent);return bC(c,"displayName","SideEffect("+r(i)+")"),bC(c,"canUseDOM",gq),c}}var vq=yq;const wq=Io(vq);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var TC=Object.getOwnPropertySymbols,xq=Object.prototype.hasOwnProperty,_q=Object.prototype.propertyIsEnumerable;function bq(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function Tq(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(i){return e[i]});if(r.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(i){s[i]=i}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var Eq=Tq()?Object.assign:function(t,e){for(var n,r=bq(t),s,i=1;i<arguments.length;i++){n=Object(arguments[i]);for(var o in n)xq.call(n,o)&&(r[o]=n[o]);if(TC){s=TC(n);for(var a=0;a<s.length;a++)_q.call(n,s[a])&&(r[s[a]]=n[s[a]])}}return r};const Sq=Io(Eq);var Ta={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},Ie={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Ie).map(function(t){return Ie[t]});var pt={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},Vm={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},ad={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},kq=Object.keys(Vm).reduce(function(t,e){return t[Vm[e]]=e,t},{}),Cq=[Ie.NOSCRIPT,Ie.SCRIPT,Ie.STYLE],Xr="data-react-helmet",Iq=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Aq=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},Nq=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Hn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Rq=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},EC=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},Pq=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},yx=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return n===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},Mq=function(e){var n=hc(e,Ie.TITLE),r=hc(e,ad.TITLE_TEMPLATE);if(r&&n)return r.replace(/%s/g,function(){return Array.isArray(n)?n.join(""):n});var s=hc(e,ad.DEFAULT_TITLE);return n||s||void 0},Oq=function(e){return hc(e,ad.ON_CHANGE_CLIENT_STATE)||function(){}},s0=function(e,n){return n.filter(function(r){return typeof r[e]<"u"}).map(function(r){return r[e]}).reduce(function(r,s){return Hn({},r,s)},{})},Dq=function(e,n){return n.filter(function(r){return typeof r[Ie.BASE]<"u"}).map(function(r){return r[Ie.BASE]}).reverse().reduce(function(r,s){if(!r.length)for(var i=Object.keys(s),o=0;o<i.length;o++){var a=i[o],l=a.toLowerCase();if(e.indexOf(l)!==-1&&s[l])return r.concat(s)}return r},[])},Ru=function(e,n,r){var s={};return r.filter(function(i){return Array.isArray(i[e])?!0:(typeof i[e]<"u"&&Fq("Helmet: "+e+' should be of type "Array". Instead found type "'+Iq(i[e])+'"'),!1)}).map(function(i){return i[e]}).reverse().reduce(function(i,o){var a={};o.filter(function(f){for(var m=void 0,g=Object.keys(f),y=0;y<g.length;y++){var v=g[y],w=v.toLowerCase();n.indexOf(w)!==-1&&!(m===pt.REL&&f[m].toLowerCase()==="canonical")&&!(w===pt.REL&&f[w].toLowerCase()==="stylesheet")&&(m=w),n.indexOf(v)!==-1&&(v===pt.INNER_HTML||v===pt.CSS_TEXT||v===pt.ITEM_PROP)&&(m=v)}if(!m||!f[m])return!1;var _=f[m].toLowerCase();return s[m]||(s[m]={}),a[m]||(a[m]={}),s[m][_]?!1:(a[m][_]=!0,!0)}).reverse().forEach(function(f){return i.push(f)});for(var l=Object.keys(a),c=0;c<l.length;c++){var u=l[c],h=Sq({},s[u],a[u]);s[u]=h}return i},[]).reverse()},hc=function(e,n){for(var r=e.length-1;r>=0;r--){var s=e[r];if(s.hasOwnProperty(n))return s[n]}return null},Lq=function(e){return{baseTag:Dq([pt.HREF,pt.TARGET],e),bodyAttributes:s0(Ta.BODY,e),defer:hc(e,ad.DEFER),encode:hc(e,ad.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:s0(Ta.HTML,e),linkTags:Ru(Ie.LINK,[pt.REL,pt.HREF],e),metaTags:Ru(Ie.META,[pt.NAME,pt.CHARSET,pt.HTTPEQUIV,pt.PROPERTY,pt.ITEM_PROP],e),noscriptTags:Ru(Ie.NOSCRIPT,[pt.INNER_HTML],e),onChangeClientState:Oq(e),scriptTags:Ru(Ie.SCRIPT,[pt.SRC,pt.INNER_HTML],e),styleTags:Ru(Ie.STYLE,[pt.CSS_TEXT],e),title:Mq(e),titleAttributes:s0(Ta.TITLE,e)}},vx=function(){var t=Date.now();return function(e){var n=Date.now();n-t>16?(t=n,e(n)):setTimeout(function(){vx(e)},0)}}(),SC=function(e){return clearTimeout(e)},jq=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||vx:global.requestAnimationFrame||vx,Vq=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||SC:global.cancelAnimationFrame||SC,Fq=function(e){return console&&typeof console.warn=="function"&&console.warn(e)},Pu=null,Bq=function(e){Pu&&Vq(Pu),e.defer?Pu=jq(function(){kC(e,function(){Pu=null})}):(kC(e),Pu=null)},kC=function(e,n){var r=e.baseTag,s=e.bodyAttributes,i=e.htmlAttributes,o=e.linkTags,a=e.metaTags,l=e.noscriptTags,c=e.onChangeClientState,u=e.scriptTags,h=e.styleTags,f=e.title,m=e.titleAttributes;wx(Ie.BODY,s),wx(Ie.HTML,i),zq(f,m);var g={baseTag:bl(Ie.BASE,r),linkTags:bl(Ie.LINK,o),metaTags:bl(Ie.META,a),noscriptTags:bl(Ie.NOSCRIPT,l),scriptTags:bl(Ie.SCRIPT,u),styleTags:bl(Ie.STYLE,h)},y={},v={};Object.keys(g).forEach(function(w){var _=g[w],E=_.newTags,N=_.oldTags;E.length&&(y[w]=E),N.length&&(v[w]=g[w].oldTags)}),n&&n(),c(e,y,v)},YO=function(e){return Array.isArray(e)?e.join(""):e},zq=function(e,n){typeof e<"u"&&document.title!==e&&(document.title=YO(e)),wx(Ie.TITLE,n)},wx=function(e,n){var r=document.getElementsByTagName(e)[0];if(r){for(var s=r.getAttribute(Xr),i=s?s.split(","):[],o=[].concat(i),a=Object.keys(n),l=0;l<a.length;l++){var c=a[l],u=n[c]||"";r.getAttribute(c)!==u&&r.setAttribute(c,u),i.indexOf(c)===-1&&i.push(c);var h=o.indexOf(c);h!==-1&&o.splice(h,1)}for(var f=o.length-1;f>=0;f--)r.removeAttribute(o[f]);i.length===o.length?r.removeAttribute(Xr):r.getAttribute(Xr)!==a.join(",")&&r.setAttribute(Xr,a.join(","))}},bl=function(e,n){var r=document.head||document.querySelector(Ie.HEAD),s=r.querySelectorAll(e+"["+Xr+"]"),i=Array.prototype.slice.call(s),o=[],a=void 0;return n&&n.length&&n.forEach(function(l){var c=document.createElement(e);for(var u in l)if(l.hasOwnProperty(u))if(u===pt.INNER_HTML)c.innerHTML=l.innerHTML;else if(u===pt.CSS_TEXT)c.styleSheet?c.styleSheet.cssText=l.cssText:c.appendChild(document.createTextNode(l.cssText));else{var h=typeof l[u]>"u"?"":l[u];c.setAttribute(u,h)}c.setAttribute(Xr,"true"),i.some(function(f,m){return a=m,c.isEqualNode(f)})?i.splice(a,1):o.push(c)}),i.forEach(function(l){return l.parentNode.removeChild(l)}),o.forEach(function(l){return r.appendChild(l)}),{oldTags:i,newTags:o}},XO=function(e){return Object.keys(e).reduce(function(n,r){var s=typeof e[r]<"u"?r+'="'+e[r]+'"':""+r;return n?n+" "+s:s},"")},$q=function(e,n,r,s){var i=XO(r),o=YO(n);return i?"<"+e+" "+Xr+'="true" '+i+">"+yx(o,s)+"</"+e+">":"<"+e+" "+Xr+'="true">'+yx(o,s)+"</"+e+">"},Uq=function(e,n,r){return n.reduce(function(s,i){var o=Object.keys(i).filter(function(c){return!(c===pt.INNER_HTML||c===pt.CSS_TEXT)}).reduce(function(c,u){var h=typeof i[u]>"u"?u:u+'="'+yx(i[u],r)+'"';return c?c+" "+h:h},""),a=i.innerHTML||i.cssText||"",l=Cq.indexOf(e)===-1;return s+"<"+e+" "+Xr+'="true" '+o+(l?"/>":">"+a+"</"+e+">")},"")},ZO=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(r,s){return r[Vm[s]||s]=e[s],r},n)},Hq=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(r,s){return r[kq[s]||s]=e[s],r},n)},Wq=function(e,n,r){var s,i=(s={key:n},s[Xr]=!0,s),o=ZO(r,i);return[qe.createElement(Ie.TITLE,o,n)]},qq=function(e,n){return n.map(function(r,s){var i,o=(i={key:s},i[Xr]=!0,i);return Object.keys(r).forEach(function(a){var l=Vm[a]||a;if(l===pt.INNER_HTML||l===pt.CSS_TEXT){var c=r.innerHTML||r.cssText;o.dangerouslySetInnerHTML={__html:c}}else o[l]=r[a]}),qe.createElement(e,o)})},Ls=function(e,n,r){switch(e){case Ie.TITLE:return{toComponent:function(){return Wq(e,n.title,n.titleAttributes)},toString:function(){return $q(e,n.title,n.titleAttributes,r)}};case Ta.BODY:case Ta.HTML:return{toComponent:function(){return ZO(n)},toString:function(){return XO(n)}};default:return{toComponent:function(){return qq(e,n)},toString:function(){return Uq(e,n,r)}}}},eD=function(e){var n=e.baseTag,r=e.bodyAttributes,s=e.encode,i=e.htmlAttributes,o=e.linkTags,a=e.metaTags,l=e.noscriptTags,c=e.scriptTags,u=e.styleTags,h=e.title,f=h===void 0?"":h,m=e.titleAttributes;return{base:Ls(Ie.BASE,n,s),bodyAttributes:Ls(Ta.BODY,r,s),htmlAttributes:Ls(Ta.HTML,i,s),link:Ls(Ie.LINK,o,s),meta:Ls(Ie.META,a,s),noscript:Ls(Ie.NOSCRIPT,l,s),script:Ls(Ie.SCRIPT,c,s),style:Ls(Ie.STYLE,u,s),title:Ls(Ie.TITLE,{title:f,titleAttributes:m},s)}},Kq=function(e){var n,r;return r=n=function(s){Rq(i,s);function i(){return Aq(this,i),Pq(this,s.apply(this,arguments))}return i.prototype.shouldComponentUpdate=function(a){return!XR(this.props,a)},i.prototype.mapNestedChildrenToProps=function(a,l){if(!l)return null;switch(a.type){case Ie.SCRIPT:case Ie.NOSCRIPT:return{innerHTML:l};case Ie.STYLE:return{cssText:l}}throw new Error("<"+a.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},i.prototype.flattenArrayTypeChildren=function(a){var l,c=a.child,u=a.arrayTypeChildren,h=a.newChildProps,f=a.nestedChildren;return Hn({},u,(l={},l[c.type]=[].concat(u[c.type]||[],[Hn({},h,this.mapNestedChildrenToProps(c,f))]),l))},i.prototype.mapObjectTypeChildren=function(a){var l,c,u=a.child,h=a.newProps,f=a.newChildProps,m=a.nestedChildren;switch(u.type){case Ie.TITLE:return Hn({},h,(l={},l[u.type]=m,l.titleAttributes=Hn({},f),l));case Ie.BODY:return Hn({},h,{bodyAttributes:Hn({},f)});case Ie.HTML:return Hn({},h,{htmlAttributes:Hn({},f)})}return Hn({},h,(c={},c[u.type]=Hn({},f),c))},i.prototype.mapArrayTypeChildrenToProps=function(a,l){var c=Hn({},l);return Object.keys(a).forEach(function(u){var h;c=Hn({},c,(h={},h[u]=a[u],h))}),c},i.prototype.warnOnInvalidChildren=function(a,l){return!0},i.prototype.mapChildrenToProps=function(a,l){var c=this,u={};return qe.Children.forEach(a,function(h){if(!(!h||!h.props)){var f=h.props,m=f.children,g=EC(f,["children"]),y=Hq(g);switch(c.warnOnInvalidChildren(h,m),h.type){case Ie.LINK:case Ie.META:case Ie.NOSCRIPT:case Ie.SCRIPT:case Ie.STYLE:u=c.flattenArrayTypeChildren({child:h,arrayTypeChildren:u,newChildProps:y,nestedChildren:m});break;default:l=c.mapObjectTypeChildren({child:h,newProps:l,newChildProps:y,nestedChildren:m});break}}}),l=this.mapArrayTypeChildrenToProps(u,l),l},i.prototype.render=function(){var a=this.props,l=a.children,c=EC(a,["children"]),u=Hn({},c);return l&&(u=this.mapChildrenToProps(l,u)),qe.createElement(e,u)},Nq(i,null,[{key:"canUseDOM",set:function(a){e.canUseDOM=a}}]),i}(qe.Component),n.propTypes={base:ft.object,bodyAttributes:ft.object,children:ft.oneOfType([ft.arrayOf(ft.node),ft.node]),defaultTitle:ft.string,defer:ft.bool,encodeSpecialCharacters:ft.bool,htmlAttributes:ft.object,link:ft.arrayOf(ft.object),meta:ft.arrayOf(ft.object),noscript:ft.arrayOf(ft.object),onChangeClientState:ft.func,script:ft.arrayOf(ft.object),style:ft.arrayOf(ft.object),title:ft.string,titleAttributes:ft.object,titleTemplate:ft.string},n.defaultProps={defer:!0,encodeSpecialCharacters:!0},n.peek=e.peek,n.rewind=function(){var s=e.rewind();return s||(s=eD({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},r},Gq=function(){return null},Qq=wq(Lq,Bq,eD)(Gq),xx=Kq(Qq);xx.renderStatic=xx.rewind;const Jq=({blogData:t})=>{const e=A.useMemo(()=>{var s,i,o,a,l,c,u,h,f,m,g,y;return t?{"@context":"https://schema.org","@type":"Article",headline:((s=t.seo)==null?void 0:s.seoTitle)||t.title,description:((i=t.seo)==null?void 0:i.metaDescription)||t.excerpt,image:t.coverImage||((o=t.seo)==null?void 0:o.ogImage),datePublished:((c=(l=(a=t.createdAt)==null?void 0:a.toDate)==null?void 0:l.call(a))==null?void 0:c.toISOString())||new Date().toISOString(),dateModified:((f=(h=(u=t.updatedAt)==null?void 0:u.toDate)==null?void 0:h.call(u))==null?void 0:f.toISOString())||new Date().toISOString(),author:t.author?{"@type":"Person",name:t.author.name,description:t.author.bio||"",url:t.author.avatar||""}:void 0,publisher:{"@type":"Organization",name:"DeskHub",logo:{"@type":"ImageObject",url:"https://deskhub.vn/logo.png"}},mainEntityOfPage:{"@type":"WebPage","@id":t.canonicalUrl||`https://deskhub.vn/blog/${t.slug}`},keywords:[(m=t.keywords)==null?void 0:m.primaryKeyword,...((g=t.keywords)==null?void 0:g.secondaryKeywords)||[],...((y=t.keywords)==null?void 0:y.lsiKeywords)||[]].filter(Boolean).join(", ")}:null},[t]),n=A.useMemo(()=>{var s,i;return!((s=t==null?void 0:t.schema)!=null&&s.enableFaqSchema)||!((i=t==null?void 0:t.faqItems)!=null&&i.length)?null:{"@context":"https://schema.org","@type":"FAQPage",mainEntity:t.faqItems.map(o=>({"@type":"Question",name:o.question,acceptedAnswer:{"@type":"Answer",text:o.answer}}))}},[t]),r=A.useMemo(()=>{var i,o,a;if(!((i=t==null?void 0:t.schema)!=null&&i.enableReviewSchema)||!((o=t==null?void 0:t.schema)!=null&&o.reviewData))return null;const{reviewData:s}=t.schema;return{"@context":"https://schema.org","@type":"Review",itemReviewed:{"@type":s.itemType||"Product",name:s.itemName},reviewRating:{"@type":"Rating",ratingValue:s.rating,bestRating:s.maxRating||5},author:{"@type":"Person",name:((a=t.author)==null?void 0:a.name)||"Anonymous"},reviewBody:s.summary||t.excerpt}},[t]);return e?d.jsxs(d.Fragment,{children:[d.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(e,null,2)}}),n&&d.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(n,null,2)}}),r&&d.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(r,null,2)}})]}):null},Yq=t=>{var n,r,s,i,o,a,l,c,u,h,f,m,g,y,v,w,_,E,N,R;return t?[{name:"description",content:((n=t.seo)==null?void 0:n.metaDescription)||t.excerpt},{name:"keywords",content:[(r=t.keywords)==null?void 0:r.primaryKeyword,...((s=t.keywords)==null?void 0:s.secondaryKeywords)||[]].filter(Boolean).join(", ")},{name:"robots",content:t.noIndex?"noindex, nofollow":"index, follow"},{property:"og:title",content:((i=t.seo)==null?void 0:i.ogTitle)||((o=t.seo)==null?void 0:o.seoTitle)||t.title},{property:"og:description",content:((a=t.seo)==null?void 0:a.ogDescription)||((l=t.seo)==null?void 0:l.metaDescription)},{property:"og:image",content:((c=t.seo)==null?void 0:c.ogImage)||t.coverImage},{property:"og:url",content:t.canonicalUrl},{property:"og:type",content:"article"},{property:"og:site_name",content:"DeskHub"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:((u=t.seo)==null?void 0:u.ogTitle)||((h=t.seo)==null?void 0:h.seoTitle)||t.title},{name:"twitter:description",content:((f=t.seo)==null?void 0:f.ogDescription)||((m=t.seo)==null?void 0:m.metaDescription)},{name:"twitter:image",content:((g=t.seo)==null?void 0:g.ogImage)||t.coverImage},{property:"article:published_time",content:(w=(v=(y=t.createdAt)==null?void 0:y.toDate)==null?void 0:v.call(y))==null?void 0:w.toISOString()},{property:"article:modified_time",content:(N=(E=(_=t.updatedAt)==null?void 0:_.toDate)==null?void 0:E.call(_))==null?void 0:N.toISOString()},{property:"article:author",content:(R=t.author)==null?void 0:R.name},{property:"article:section",content:t.category},...(t.tags||[]).map(O=>({property:"article:tag",content:O}))].filter(O=>O.content):[]},Xq=t=>t?t.canonicalUrl||`https://deskhub.vn/blog/${t.slug}`:null,Zq=()=>{var g,y;const{slug:t}=Kg(),e=rl(),{blogs:n,setBlogs:r,deleteBlog:s,currentUser:i}=yn(),[o,a]=A.useState(null);if(A.useEffect(()=>{let v=n.find(w=>w.slug===t||w.id==t);v||(v=Ql.find(w=>w.slug===t||w.id==t)),v&&a(v)},[t,n]),A.useEffect(()=>{window.scrollTo(0,0)},[]),A.useEffect(()=>{if(!o)return;console.log("BlogDetail: Setting up view timer for blog:",o.id);const v=setTimeout(async()=>{console.log("BlogDetail: 5 seconds elapsed, incrementing view for blog:",o.id);try{const w=await Zt.incrementBlogView(o.id)}catch(w){console.error("BlogDetail: Error incrementing view:",w)}},5e3);return()=>clearTimeout(v)},[o==null?void 0:o.id]),!o)return d.jsxs("div",{className:"container",style:{padding:"2rem",textAlign:"center",minHeight:"50vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[d.jsx("h3",{children:"ang ti bi vit..."}),d.jsxs("div",{style:{color:"#666",marginTop:"1rem",fontSize:"0.9rem",textAlign:"left",background:"#f5f5f5",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{children:d.jsx("strong",{children:"Debug Info:"})}),d.jsxs("p",{children:["Requested Slug/ID: ",t]}),d.jsxs("p",{children:["Context Blogs Loaded: ",n.length]}),d.jsxs("p",{children:["Sample Data Size: ",(Ql==null?void 0:Ql.length)||"undefined"]}),d.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",fontSize:"0.8rem"},children:"Nu s liu trn = 0, vui lng kim tra li kt ni mng hoc th li sau."})]})]});const l=()=>{e("/blog")},c=()=>{o.seo?e(`/blog/seo-edit/${o.id}`):e(`/blog/edit/${o.id}`)},u=async()=>{if(window.confirm("Bn c chc chn mun xa bi vit ny khng?")){const v=await s(o.id);v.success?e("/blog"):alert(v.message||"C li xy ra")}},h=Yq(o),f=Xq(o),m=o.contentHtml||o.content;return d.jsxs("div",{className:"blog-detail-page",children:[d.jsxs(xx,{children:[d.jsxs("title",{children:[((g=o.seo)==null?void 0:g.seoTitle)||o.title," | DeskHub"]}),h.map((v,w)=>d.jsx("meta",{...v},w)),f&&d.jsx("link",{rel:"canonical",href:f})]}),d.jsx(Jq,{blogData:o}),d.jsxs("div",{className:"blog-detail-actions",children:[d.jsxs("button",{className:"back-btn",onClick:l,children:[d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M12.5 15L7.5 10l5-5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),"Quay li"]}),i&&i.role==="admin"&&d.jsxs("div",{className:"blog-admin-actions",children:[d.jsxs("button",{className:"blog-edit-btn",onClick:c,children:[d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),"Chnh sa"]}),d.jsxs("button",{className:"blog-delete-btn",onClick:u,children:[d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M5 7h10M8 7V5a1 1 0 011-1h2a1 1 0 011 1v2m-5 0h6M6 7v10a1 1 0 001 1h6a1 1 0 001-1V7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),"Xa bi vit"]})]})]}),d.jsxs("article",{className:"blog-article",children:[d.jsxs("div",{className:"blog-cover",children:[d.jsx("img",{src:o.coverImage,alt:o.title}),d.jsx("div",{className:"blog-cover-overlay",children:d.jsx("span",{className:"blog-category-large",children:o.category})})]}),d.jsxs("header",{className:"blog-header",children:[d.jsx("h1",{className:"blog-title",children:o.title}),d.jsxs("div",{className:"blog-meta-large",children:[d.jsxs("div",{className:"blog-author-large",children:[d.jsx("img",{src:o.author.avatar,alt:o.author.name}),d.jsxs("div",{children:[d.jsx("p",{className:"author-name",children:o.author.name}),d.jsx("p",{className:"publish-date",children:new Date(o.publishedAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})})]})]}),d.jsxs("div",{className:"blog-stats-large",children:[d.jsxs("span",{className:"stat",children:[d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"1.5"}),d.jsx("path",{d:"M10 6v4l3 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),o.readTime," pht c"]}),d.jsxs("span",{className:"stat",children:[d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("path",{d:"M1 10s3-7 9-7 9 7 9 7-3 7-9 7-9-7-9-7z",stroke:"currentColor",strokeWidth:"1.5"}),d.jsx("circle",{cx:"10",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),o.views," lt xem"]})]})]})]}),d.jsx("div",{className:"blog-content",dangerouslySetInnerHTML:{__html:m}}),d.jsx("div",{className:"blog-tags",children:(y=o.tags)==null?void 0:y.map(v=>d.jsxs("span",{className:"blog-tag",children:["#",v]},v))})]})]})},ua=t=>{if(!t)return"";const e={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"i",:"i",:"i",:"i",:"i",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"y",:"y",:"y",:"y",:"y",:"d",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"I",:"I",:"I",:"I",:"I",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"Y",:"Y",:"Y",:"Y",:"Y",:"D"};let n=t.split("").map(r=>e[r]||r).join("");return n=n.toLowerCase(),n=n.replace(/\s+/g,"-"),n=n.replace(/[^a-z0-9-]/g,""),n=n.replace(/-+/g,"-"),n=n.replace(/^-+|-+$/g,""),n},CC=()=>{const{id:t}=Kg(),e=rl(),{addBlog:n,updateBlog:r,blogs:s}=yn(),i=!!t,[o,a]=A.useState(null),[l,c]=A.useState(""),[u,h]=A.useState(""),[f,m]=A.useState(""),[g,y]=A.useState(""),[v,w]=A.useState("Hng Dn"),[_,E]=A.useState(""),[N,R]=A.useState(5),[O,S]=A.useState(""),T=A.useRef(null),k=A.useRef(null),[I,M]=A.useState("image");A.useEffect(()=>{var U;if(i&&s.length>0){const he=s.find(we=>we.id==t);he?(a(he),c(he.title||""),h(he.slug||""),m(he.excerpt||""),y(he.coverImage||""),w(he.category||"Hng Dn"),E(((U=he.tags)==null?void 0:U.join(", "))||""),R(he.readTime||5),S(he.content||""),T.current&&(T.current.innerHTML=he.content||"")):(alert("Khng tm thy bi vit!"),e("/blog"))}},[i,t,s,e]);const D=U=>{const he=U.target.value;c(he);const we=ua(he);(!u||u===ua(l))&&h(we)},P=async U=>{U.preventDefault(),console.log(" Blog form submission started");const he={title:l,slug:u||ua(l),excerpt:f,coverImage:g||"https://images.unsplash.com/photo-1593062096033-9a26b09da705?w=1200",content:O,category:v,tags:_.split(",").map(we=>we.trim()).filter(Boolean),readTime:parseInt(N)||5};if(console.log(" Blog data to save:",he),i&&o){console.log(" Updating blog:",o.id);const we=await r(o.id,he);console.log(" Update response:",we),we.success?(alert(" cp nht bi vit thnh cng!"),e(`/blog/${o.id}`)):alert(`Li: ${we.message||"C li xy ra khi cp nht!"}`)}else{console.log(" Creating new blog");const we=await n(he);console.log(" Create response:",we),we.success?(alert(" ng bi vit thnh cng!"),e("/blog")):alert(`Li: ${we.message||"C li xy ra!"}`)}},pe=(U,he=null)=>{var we;document.execCommand(U,!1,he),(we=T.current)==null||we.focus(),ce()},Ee=U=>{const he=window.getSelection();if(he.rangeCount>0){const we=he.getRangeAt(0),dt=document.createElement(`h${U}`);dt.textContent=he.toString()||`Tiu  ${U}`,we.deleteContents(),we.insertNode(dt),ce()}},je=U=>{M(U),k.current&&(k.current.accept=U==="image"?"image/*":"video/*",k.current.click())},oe=U=>{const he=U.target.files[0];if(he){const we=new FileReader;we.onload=dt=>{const st=dt.target.result;if(I==="image"){const it=`<img src="${st}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 10px 0;" alt="Uploaded image" />`;document.execCommand("insertHTML",!1,it)}else{const it=`<div class="video-container" style="margin: 10px 0;"><video controls width="100%" style="border-radius: 8px;"><source src="${st}" type="${he.type}">Trnh duyt ca bn khng h tr th video.</video></div><p><br/></p>`;document.execCommand("insertHTML",!1,it)}ce()},we.readAsDataURL(he)}U.target.value=""},W=()=>{const U=prompt("Nhp ng dn (URL):");U&&pe("createLink",U)},V=U=>{pe("fontName",U)},Z=U=>{pe("foreColor",U)},ce=()=>{T.current&&S(T.current.innerHTML)};return d.jsxs("div",{className:"blog-editor",children:[d.jsx("input",{type:"file",ref:k,style:{display:"none"},onChange:oe}),d.jsxs("div",{className:"editor-header",children:[d.jsx("h1",{children:i?"Chnh Sa Bi Vit":"To Bi Vit Mi"}),d.jsx("p",{children:i?"Cp nht ni dung bi vit ca bn":"Chia s kin thc v cm hng setup ca bn"})]}),d.jsxs("form",{onSubmit:P,className:"editor-form",children:[d.jsxs("div",{className:"form-section",children:[d.jsx("h3",{children:"Thng Tin C Bn"}),d.jsxs("div",{className:"form-grid",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{htmlFor:"title",children:"Tiu  *"}),d.jsx("input",{id:"title",type:"text",className:"input",value:l,onChange:D,placeholder:"Nhp tiu  bi vit",required:!0})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{htmlFor:"slug",children:"URL / Slug"}),d.jsx("input",{id:"slug",type:"text",className:"input",value:u,onChange:U=>h(U.target.value),placeholder:"tu-dong-tao-tu-tieu-de"})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{htmlFor:"category",children:"Danh Mc *"}),d.jsxs("select",{id:"category",className:"input",value:v,onChange:U=>w(U.target.value),required:!0,children:[d.jsx("option",{value:"Hng Dn",children:"Hng Dn"}),d.jsx("option",{value:"Thit K",children:"Thit K"}),d.jsx("option",{value:"nh Gi",children:"nh Gi"}),d.jsx("option",{value:"Xu Hng",children:"Xu Hng"}),d.jsx("option",{value:"Mo",children:"Mo"})]})]}),d.jsxs("div",{className:"form-group full-width",children:[d.jsx("label",{htmlFor:"excerpt",children:"M T Ngn *"}),d.jsx("textarea",{id:"excerpt",className:"input",value:f,onChange:U=>m(U.target.value),placeholder:"M t ngn gn v ni dung bi vit",rows:"3",required:!0})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{htmlFor:"coverImage",children:"nh Ba (URL hoc Upload bn di)"}),d.jsxs("div",{style:{display:"flex",gap:"10px"},children:[d.jsx("input",{id:"coverImage",type:"url",className:"input",value:g,onChange:U=>y(U.target.value),placeholder:"https://example.com/image.jpg",style:{flex:1}}),d.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{M("image"),alert("Hin ti nh ba h tr URL. Tnh nng upload nh ba ang pht trin.")},children:"URL"})]})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{htmlFor:"readTime",children:"Thi Gian c (pht)"}),d.jsx("input",{id:"readTime",type:"number",className:"input",value:N,onChange:U=>R(U.target.value),min:"1",max:"60"})]}),d.jsxs("div",{className:"form-group full-width",children:[d.jsx("label",{htmlFor:"tags",children:"Th (phn cch bng du phy)"}),d.jsx("input",{id:"tags",type:"text",className:"input",value:_,onChange:U=>E(U.target.value),placeholder:"desk, productivity, ergonomics"})]})]})]}),d.jsxs("div",{className:"form-section",children:[d.jsx("h3",{children:"Ni Dung Bi Vit"}),d.jsxs("div",{className:"editor-toolbar",children:[d.jsxs("div",{className:"toolbar-group",children:[d.jsxs("select",{onChange:U=>Ee(U.target.value),className:"toolbar-select",children:[d.jsx("option",{value:"",children:"Tiu "}),d.jsx("option",{value:"2",children:"Heading 2"}),d.jsx("option",{value:"3",children:"Heading 3"}),d.jsx("option",{value:"4",children:"Heading 4"})]}),d.jsxs("select",{onChange:U=>V(U.target.value),className:"toolbar-select",children:[d.jsx("option",{value:"Arial",children:"Arial"}),d.jsx("option",{value:"Georgia",children:"Georgia"}),d.jsx("option",{value:"Courier New",children:"Courier New"}),d.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),d.jsx("option",{value:"System-ui",children:"System UI"})]})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>pe("bold"),title:"In m",children:d.jsx("strong",{children:"B"})}),d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>pe("italic"),title:"In nghing",children:d.jsx("em",{children:"I"})}),d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>pe("underline"),title:"Gch chn",children:d.jsx("u",{children:"U"})}),d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>W(),title:"Chn Link",children:""})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>pe("insertUnorderedList"),title:"Danh sch",children:" List"}),d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>pe("insertOrderedList"),title:"S th t",children:"1. List"})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>je("image"),title:"Ti nh ln",children:" nh"}),d.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>je("video"),title:"Ti video ln",children:" Video"})]}),d.jsx("div",{className:"toolbar-group",children:d.jsx("input",{type:"color",onChange:U=>Z(U.target.value),title:"Mu ch",className:"toolbar-color-picker"})})]}),d.jsx("div",{ref:T,className:"content-editor",contentEditable:!0,onInput:ce,"data-placeholder":"Bt u vit bi ti y..."})]}),d.jsxs("div",{className:"editor-actions",children:[d.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>e("/blog"),children:"Hy"}),d.jsx("button",{type:"submit",className:"btn btn-primary",children:i?"Cp Nht":"ng Bi"})]})]})]})},Mu={title:"",slug:"",canonicalUrl:"",redirectsFrom:[],noIndex:!1,seo:{seoTitle:"",metaDescription:"",ogTitle:"",ogDescription:"",ogImage:""},keywords:{primaryKeyword:"",secondaryKeywords:[],lsiKeywords:[]},searchIntent:"informational",content:null,contentHtml:"",excerpt:"",images:[],author:null,references:[],schema:{enableArticleSchema:!0,enableFaqSchema:!1,enableReviewSchema:!1,reviewData:null},category:"Hng Dn",tags:[],readTime:5,coverImage:"",status:"draft",views:0},tD={informational:{label:"Thng tin (Informational)",description:"Ngi dng mun tm hiu, hc hi",suggestedCTA:"c thm, Tm hiu thm",suggestedStructure:["Gii thiu","Cc phn chi tit","Kt lun"]},navigational:{label:"iu hng (Navigational)",description:"Ngi dng mun tm trang/ngun c th",suggestedCTA:"Truy cp, n trang",suggestedStructure:["Thng tin nhanh","Link trc tip"]},transactional:{label:"Giao dch (Transactional)",description:"Ngi dng mun mua/ng k",suggestedCTA:"Mua ngay, ng k, Thm vo gi",suggestedStructure:["Li ch","Tnh nng","Gi","CTA"]},commercial:{label:"Thng mi (Commercial Investigation)",description:"Ngi dng so snh trc khi mua",suggestedCTA:"So snh, Xem nh gi",suggestedStructure:["Tng quan","So snh","u/Nhc im","Kt lun"]}};var nD={exports:{}},rD={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Lc=A;function eK(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var tK=typeof Object.is=="function"?Object.is:eK,nK=Lc.useState,rK=Lc.useEffect,sK=Lc.useLayoutEffect,iK=Lc.useDebugValue;function oK(t,e){var n=e(),r=nK({inst:{value:n,getSnapshot:e}}),s=r[0].inst,i=r[1];return sK(function(){s.value=n,s.getSnapshot=e,i0(s)&&i({inst:s})},[t,n,e]),rK(function(){return i0(s)&&i({inst:s}),t(function(){i0(s)&&i({inst:s})})},[t]),iK(n),n}function i0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!tK(t,n)}catch{return!0}}function aK(t,e){return e()}var lK=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?aK:oK;rD.useSyncExternalStore=Lc.useSyncExternalStore!==void 0?Lc.useSyncExternalStore:lK;nD.exports=rD;var mT=nD.exports;function un(t){this.content=t}un.prototype={constructor:un,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new un(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new un(n)},addToStart:function(t,e){return new un([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new un(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new un(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=un.from(t),t.size?new un(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=un.from(t),t.size?new un(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=un.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};un.from=function(t){if(t instanceof un)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new un(e)};function sD(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=sD(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function iD(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=iD(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class z{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,s+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new z(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new z(r,s)}cutByIndex(e,n){return e==n?z.empty:e==0&&n==this.content.length?this:new z(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new z(s,i)}addToStart(e){return new z([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new z(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return sD(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return iD(this,e,n,r)}findIndex(e){if(e==0)return Vf(0,e);if(e==this.size)return Vf(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Vf(n+1,i):Vf(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return z.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new z(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return z.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new z(n||e,r)}static from(e){if(!e)return z.empty;if(e instanceof z)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new z([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}z.empty=new z([],0);const o0={index:0,offset:0};function Vf(t,e){return o0.index=t,o0.offset=e,o0}function Fm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Fm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Fm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let Ze=class _x{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Fm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return _x.none;if(e instanceof _x)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};Ze.none=[];class Bm extends Error{}class ne{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=aD(this.content,e+this.openStart,n);return r&&new ne(r,this.openStart,this.openEnd)}removeBetween(e,n){return new ne(oD(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return ne.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ne(z.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new ne(e,r,s)}}ne.empty=new ne(z.empty,0,0);function oD(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(oD(i.content,e-s-1,n-s-1)))}function aD(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=aD(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function cK(t,e,n){if(n.openStart>t.depth)throw new Bm("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Bm("Inconsistent open depths");return lD(t,e,n,0)}function lD(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=lD(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Sa(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=uK(n,t);return Sa(i,uD(t,o,a,e,r))}else return Sa(i,zm(t,e,r))}function cD(t,e){if(!e.type.compatibleContent(t.type))throw new Bm("Cannot join "+e.type.name+" onto "+t.type.name)}function bx(t,e,n){let r=t.node(n);return cD(r,e.node(n)),r}function Ea(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function vh(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Ea(t.nodeAfter,r),i++));for(let a=i;a<o;a++)Ea(s.child(a),r);e&&e.depth==n&&e.textOffset&&Ea(e.nodeBefore,r)}function Sa(t,e){return t.type.checkContent(e),t.copy(e)}function uD(t,e,n,r,s){let i=t.depth>s&&bx(t,e,s+1),o=r.depth>s&&bx(n,r,s+1),a=[];return vh(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(cD(i,o),Ea(Sa(i,uD(t,e,n,r,s+1)),a)):(i&&Ea(Sa(i,zm(t,e,s+1)),a),vh(e,n,s,a),o&&Ea(Sa(o,zm(n,r,s+1)),a)),vh(r,null,s,a),new z(a)}function zm(t,e,n){let r=[];if(vh(null,t,n,r),t.depth>n){let s=bx(t,e,n+1);Ea(Sa(s,zm(t,e,n+1)),r)}return vh(e,null,n,r),new z(r)}function uK(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(z.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class ld{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return Ze.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new $m(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(r.push(o,a,s+l),!c||(o=o.child(a),o.isText))break;i=c-1,s+=l+1}return new ld(n,r,i)}static resolveCached(e,n){let r=IC.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else IC.set(e,r=new hK);let s=r.elts[r.i]=ld.resolve(e,n);return r.i=(r.i+1)%dK,s}}class hK{constructor(){this.elts=[],this.i=0}}const dK=12,IC=new WeakMap;class $m{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const fK=Object.create(null);class ns{constructor(e,n,r,s=Ze.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||z.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Fm(this.attrs,n||e.defaultAttrs||fK)&&Ze.sameSet(this.marks,r||Ze.none)}copy(e=null){return e==this.content?this:new ns(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new ns(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return ne.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),c=s.node(o).content.cut(s.pos-a,i.pos-a);return new ne(c,s.depth-o,i.depth-o)}replace(e,n,r){return cK(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return ld.resolveCached(this,e)}resolveNoCache(e){return ld.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),hD(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=z.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=Ze.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!Ze.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=z.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}}ns.prototype.text=void 0;class Um extends ns{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):hD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new Um(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new Um(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function hD(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Ka{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new pK(e,n);if(r.next==null)return Ka.empty;let s=dD(r);r.next&&r.err("Unexpected trailing text");let i=_K(xK(s));return bK(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return z.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let f=i(h,a.concat(u));if(f)return f}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Ka.empty=new Ka(!0);class pK{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function dD(t){let e=[];do e.push(mK(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function mK(t){let e=[];do e.push(gK(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function gK(t){let e=wK(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=yK(t,e);else break;return e}function AC(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function yK(t,e){let n=AC(t),r=n;return t.eat(",")&&(t.next!="}"?r=AC(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function vK(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function wK(t){if(t.eat("(")){let e=dD(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=vK(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function xK(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;s(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();s(i(o.expr,l),u),l=u}if(o.max==-1)s(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),s(i(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function fD(t,e){return e-t}function NC(t,e){let n=[];return r(e),n.sort(fD);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function _K(t){let e=Object.create(null);return n(NC(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<s.length;u++)s[u][0]==a&&(c=s[u][1]);NC(t,l).forEach(u=>{c||s.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[r.join(",")]=new Ka(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(fD);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function bK(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:c}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(c)==-1&&r.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function pD(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function mD(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function gD(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function yD(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new EK(t,r,e[r]);return n}let RC=class vD{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=yD(e,r.attrs),this.defaultAttrs=pD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ka.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:mD(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new ns(this,this.computeAttrs(e),z.from(n),Ze.setFrom(r))}createChecked(e=null,n,r){return n=z.from(n),this.checkContent(n),new ns(this,this.computeAttrs(e),n,Ze.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=z.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(z.empty,!0);return i?new ns(this,e,n.append(i),Ze.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){gD(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:Ze.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new vD(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function TK(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class EK{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?TK(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Ay{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=yD(e,s.attrs),this.excluded=null;let i=pD(this.attrs);this.instance=i?new Ze(this,i):null}create(e=null){return!e&&this.instance?this.instance:new Ze(this,mD(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Ay(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){gD(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class wD{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=un.from(e.nodes),n.marks=un.from(e.marks||{}),this.nodes=RC.compile(this.spec.nodes,this),this.marks=Ay.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Ka.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?PC(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:PC(this,o.split(" "))}this.nodeFromJSON=s=>ns.fromJSON(this,s),this.markFromJSON=s=>Ze.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof RC){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new Um(r,r.defaultAttrs,e,Ze.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function PC(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function SK(t){return t.tag!=null}function kK(t){return t.style!=null}class mo{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(SK(s))this.tags.push(s);else if(kK(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new OC(this,n,!1);return r.addAll(e,Ze.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new OC(this,n,!0);return r.addAll(e,Ze.none,n.from,n.to),ne.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(AK(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=DC(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=DC(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new mo(e,mo.schemaRules(e)))}}const xD={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},CK={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},_D={ol:!0,ul:!0},cd=1,Tx=2,wh=4;function MC(t,e,n){return e!=null?(e?cd:0)|(e==="full"?Tx:0):t&&t.whitespace=="pre"?cd|Tx:n&~wh}class Ff{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=Ze.none,this.match=i||(o&wh?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(z.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&cd)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=z.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(z.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!xD.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class OC{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=MC(null,n.preserveWhitespace,0)|(r?wh:0);s?i=new Ff(s.type,s.attrs,Ze.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new Ff(null,null,Ze.none,!0,null,o):i=new Ff(e.schema.topNodeType,null,Ze.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&Tx?"full":this.localPreserveWS||(s.options&cd)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;_D.hasOwnProperty(o)&&this.parser.normalizeLists&&IK(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:CK.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(xD.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let h=l&&l.skip?n:this.readStyles(e,n);h&&this.addAll(e,h),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!s||s.length>c.length+a)&&(s=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=Ze.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):LC(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=MC(e,i,o.options);o.options&wh&&o.content.length==0&&(a|=wh);let l=Ze.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):LC(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new Ff(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=cd)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function IK(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&_D.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function AK(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function DC(t){let e={};for(let n in t)e[n]=t[n];return e}function LC(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(s.contentMatch))return!0}}class ll{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=a0(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(i.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=Op(a0(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&Op(a0(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return Op(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new ll(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=jC(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return jC(e.marks)}}function jC(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function a0(t){return t.document||window.document}const VC=new WeakMap;function NK(t){let e=VC.get(t);return e===void 0&&VC.set(t,e=RK(t)),e}function RK(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function Op(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=NK(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let h in c)if(c[h]!=null){let f=h.indexOf(" ");f>0?l.setAttributeNS(h.slice(0,f),h.slice(f+1),c[h]):h=="style"&&l.style?l.style.cssText=c[h]:l.setAttribute(h,c[h])}}for(let h=u;h<e.length;h++){let f=e[h];if(f===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:m,contentDOM:g}=Op(t,f,n,r);if(l.appendChild(m),g){if(a)throw new RangeError("Multiple content holes");a=g}}}return{dom:l,contentDOM:a}}const bD=65535,TD=Math.pow(2,16);function PK(t,e){return t+e*TD}function FC(t){return t&bD}function MK(t){return(t-(t&bD))/TD}const ED=1,SD=2,Dp=4,kD=8;class Ex{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&kD)>0}get deletedBefore(){return(this.delInfo&(ED|Dp))>0}get deletedAfter(){return(this.delInfo&(SD|Dp))>0}get deletedAcross(){return(this.delInfo&Dp)>0}}class ar{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&ar.empty)return ar.empty}recover(e){let n=0,r=FC(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+MK(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],h=l+c;if(e<=h){let f=c?e==l?-1:e==h?1:n:n,m=l+s+(f<0?0:u);if(r)return m;let g=e==(n<0?l:h)?null:PK(a/3,e-l),y=e==l?SD:e==h?ED:Dp;return(n<0?e!=l:e!=h)&&(y|=kD),new Ex(m,y,g)}s+=u-c}return r?e+s:new Ex(e+s,0,null)}touches(e,n){let r=0,s=FC(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==s*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[s+n],u=this.ranges[s+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new ar(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?ar.empty:new ar(e<0?[0,-e,0]:[0,0,e])}}ar.empty=new ar([]);class ud{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new ud(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new ud;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new Ex(e,s,null)}}const l0=Object.create(null);class Nn{getMap(){return ar.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=l0[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in l0)throw new RangeError("Duplicate use of step JSON ID "+e);return l0[e]=n,n.prototype.jsonID=e,n}}class Ft{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Ft(e,null)}static fail(e){return new Ft(null,e)}static fromReplace(e,n,r,s){try{return Ft.ok(e.replace(n,r,s))}catch(i){if(i instanceof Bm)return Ft.fail(i.message);throw i}}}function gT(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(gT(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return z.fromArray(r)}class Xi extends Nn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new ne(gT(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Ft.fromReplace(e,this.from,this.to,i)}invert(){return new Zr(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Xi(n.pos,r.pos,this.mark)}merge(e){return e instanceof Xi&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Xi(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new Xi(n.from,n.to,e.markFromJSON(n.mark))}}Nn.jsonID("addMark",Xi);class Zr extends Nn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new ne(gT(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Ft.fromReplace(e,this.from,this.to,r)}invert(){return new Xi(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new Zr(n.pos,r.pos,this.mark)}merge(e){return e instanceof Zr&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new Zr(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new Zr(n.from,n.to,e.markFromJSON(n.mark))}}Nn.jsonID("removeMark",Zr);class Zi extends Nn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ft.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Ft.fromReplace(e,this.pos,this.pos+1,new ne(z.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new Zi(this.pos,n.marks[s]);return new Zi(this.pos,this.mark)}}return new Ga(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Zi(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new Zi(n.pos,e.markFromJSON(n.mark))}}Nn.jsonID("addNodeMark",Zi);class Ga extends Nn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ft.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Ft.fromReplace(e,this.pos,this.pos+1,new ne(z.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new Zi(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Ga(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Ga(n.pos,e.markFromJSON(n.mark))}}Nn.jsonID("removeNodeMark",Ga);class nn extends Nn{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&Sx(e,this.from,this.to)?Ft.fail("Structure replace would overwrite content"):Ft.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new ar([this.from,this.to-this.from,this.slice.size])}invert(e){return new nn(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new nn(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof nn)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?ne.empty:new ne(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new nn(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?ne.empty:new ne(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new nn(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new nn(n.from,n.to,ne.fromJSON(e,n.slice),!!n.structure)}}Nn.jsonID("replace",nn);class an extends Nn{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(Sx(e,this.from,this.gapFrom)||Sx(e,this.gapTo,this.to)))return Ft.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Ft.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Ft.fromReplace(e,this.from,this.to,r):Ft.fail("Content does not fit in gap")}getMap(){return new ar([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new an(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new an(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new an(n.from,n.to,n.gapFrom,n.gapTo,ne.fromJSON(e,n.slice),n.insert,!!n.structure)}}Nn.jsonID("replaceAround",an);function Sx(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function OK(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let f=Math.max(c,e),m=Math.min(c+l.nodeSize,n),g=r.addToSet(h);for(let y=0;y<h.length;y++)h[y].isInSet(g)||(o&&o.to==f&&o.mark.eq(h[y])?o.to=m:s.push(o=new Zr(f,m,h[y])));a&&a.to==f?a.to=m:i.push(a=new Xi(f,m,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function DK(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Ay){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let h=l[u],f;for(let m=0;m<s.length;m++){let g=s[m];g.step==i-1&&h.eq(s[m].style)&&(f=g)}f?(f.to=c,f.step=i):s.push({style:h,from:Math.max(a,e),to:c,step:i})}}}),s.forEach(o=>t.step(new Zr(o.from,o.to,o.style)))}function yT(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,h=r.matchType(c.type);if(!h)o.push(new nn(a,u,ne.empty));else{r=h;for(let f=0;f<c.marks.length;f++)n.allowsMarkType(c.marks[f].type)||t.step(new Zr(a,u,c.marks[f]));if(s&&c.isText&&n.whitespace!="pre"){let f,m=/\r?\n|\r/g,g;for(;f=m.exec(c.text);)g||(g=new ne(z.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new nn(a+f.index,a+f.index+f[0].length,g))}}a=u}if(!r.validEnd){let l=r.fillBefore(z.empty,!0);t.replace(a,a,new ne(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function LK(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function eu(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!LK(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function jK(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,c=a,u=z.empty,h=0;for(let g=i,y=!1;g>n;g--)y||r.index(g)>0?(y=!0,u=z.from(r.node(g).copy(u)),h++):l--;let f=z.empty,m=0;for(let g=i,y=!1;g>n;g--)y||s.after(g+1)<s.end(g)?(y=!0,f=z.from(s.node(g).copy(f)),m++):c++;t.step(new an(l,c,o,a,new ne(u.append(f),h,m),u.size-h,!0))}function vT(t,e,n=null,r=t){let s=VK(t,e),i=s&&FK(r,e);return i?s.map(BC).concat({type:e,attrs:n}).concat(i.map(BC)):null}function BC(t){return{type:t,attrs:null}}function VK(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function FK(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<s;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function BK(t,e,n){let r=z.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=z.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new an(s,i,s,i,new ne(r,0,0),n.length,!0))}function zK(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&$K(t.doc,t.mapping.slice(i).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let m=r.whitespace=="pre",g=!!r.contentMatch.matchType(r.schema.linebreakReplacement);m&&!g?c=!1:!m&&g&&(c=!0)}c===!1&&ID(t,o,a,i),yT(t,t.mapping.slice(i).map(a,1),r,void 0,c===null);let u=t.mapping.slice(i),h=u.map(a,1),f=u.map(a+o.nodeSize,1);return t.step(new an(h,f,h+1,f-1,new ne(z.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&CD(t,o,a,i),!1}})}function CD(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function ID(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function $K(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function UK(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new an(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new ne(z.from(o),0,0),1,!0))}function ri(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=n-2;c>i;c--,u--){let h=s.node(c),f=s.index(c);if(h.type.spec.isolating)return!1;let m=h.content.cutByIndex(f,h.childCount),g=r&&r[u+1];g&&(m=m.replaceChild(0,g.type.create(g.attrs)));let y=r&&r[u]||h;if(!h.canReplace(f+1,h.childCount)||!y.type.validContent(m))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function HK(t,e,n=1,r){let s=t.doc.resolve(e),i=z.empty,o=z.empty;for(let a=s.depth,l=s.depth-n,c=n-1;a>l;a--,c--){i=z.from(s.node(a).copy(i));let u=r&&r[c];o=z.from(u?u.type.create(u.attrs,o):s.node(a).copy(o))}t.step(new nn(e,e,new ne(i.append(o),n,n),!0))}function Vo(t,e){let n=t.resolve(e),r=n.index();return AD(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function WK(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function AD(t,e){return!!(t&&e&&!t.isLeaf&&WK(t,e))}function Ny(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&AD(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function qK(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let u=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);u&&!h?r=!1:!u&&h&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);ID(t,u.node(),u.before(),a)}o.inlineContent&&yT(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new nn(c,l.map(e+n,-1),ne.empty,!0)),r===!0){let u=t.doc.resolve(c);CD(t,u.node(),u.before(),t.steps.length)}return t}function KK(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function ND(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(i==1)u=c.canReplace(l,l,s);else{let h=c.contentMatchAt(l).findWrapping(s.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function Ry(t,e,n=e,r=ne.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return RD(s,i,r)?new nn(e,n,r):new GK(s,i,r).fit()}function RD(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class GK{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=z.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=z.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new ne(i,o,a);return e>-1?new an(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new nn(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=c0(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,h=null;if(n==1&&(o?c.matchType(o.type)||(h=c.fillBefore(z.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:h};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=c0(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new ne(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=c0(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new ne(Gu(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new ne(Gu(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:f}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)u.push(s.child(y));h=h.matchFragment(s)}let m=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let y=a.child(c),v=h.matchType(y.type);if(!v)break;c++,(c>1||l==0||y.content.size)&&(h=v,u.push(PD(y.mark(f.allowedMarks(y.marks)),c==1?l:0,c==a.childCount?m:-1)))}let g=c==a.childCount;g||(m=-1),this.placed=Qu(this.placed,n,z.from(u)),this.frontier[n].match=h,g&&m<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,v=a;y<m;y++){let w=v.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),v=w.content}this.unplaced=g?e==0?ne.empty:new ne(Gu(o.content,e-1,1),e-1,m<0?o.openEnd:e-1):new ne(Gu(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!u0(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=u0(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=u0(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=Qu(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Qu(this.placed,this.depth,z.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(z.empty,!0);n.childCount&&(this.placed=Qu(this.placed,this.frontier.length,n))}}function Gu(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Gu(t.firstChild.content,e-1,n)))}function Qu(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Qu(t.lastChild.content,e-1,n)))}function c0(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function PD(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,PD(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(z.empty,!0)))),t.copy(r)}function u0(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!QK(n,i.content,o)?a:null}function QK(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function JK(t){return t.spec.defining||t.spec.definingForContent}function YK(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(RD(s,i,r))return t.step(new nn(e,n,r));let o=OD(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let f=s.depth,m=s.pos-1;f>0;f--,m--){let g=s.node(f).type.spec;if(g.defining||g.definingAsContext||g.isolating)break;o.indexOf(f)>-1?a=f:s.before(f)==m&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],u=r.openStart;for(let f=r.content,m=0;;m++){let g=f.firstChild;if(c.push(g),m==r.openStart)break;f=g.content}for(let f=u-1;f>=0;f--){let m=c[f],g=JK(m.type);if(g&&!m.sameMarkup(s.node(Math.abs(a)-1)))u=f;else if(g||!m.type.isTextblock)break}for(let f=r.openStart;f>=0;f--){let m=(f+u+1)%(r.openStart+1),g=c[m];if(g)for(let y=0;y<o.length;y++){let v=o[(y+l)%o.length],w=!0;v<0&&(w=!1,v=-v);let _=s.node(v-1),E=s.index(v-1);if(_.canReplaceWith(E,E,g.type,g.marks))return t.replace(s.before(v),w?i.after(v):n,new ne(MD(r.content,0,r.openStart,m),m,r.openEnd))}}let h=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>h));f--){let m=o[f];m<0||(e=s.before(m),n=i.after(m))}}function MD(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(MD(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(z.empty,!0))}return t}function XK(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=KK(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new ne(z.from(r),0,0))}function ZK(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=OD(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function OD(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class dc extends Nn{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Ft.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Ft.fromReplace(e,this.pos,this.pos+1,new ne(z.from(s),0,n.isLeaf?0:1))}getMap(){return ar.empty}invert(e){return new dc(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new dc(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new dc(n.pos,n.attr,n.value)}}Nn.jsonID("attr",dc);class hd extends Nn{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Ft.ok(r)}getMap(){return ar.empty}invert(e){return new hd(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new hd(n.attr,n.value)}}Nn.jsonID("docAttr",hd);let jc=class extends Error{};jc=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};jc.prototype=Object.create(Error.prototype);jc.prototype.constructor=jc;jc.prototype.name="TransformError";class wT{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new ud}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new jc(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=ne.empty){let s=Ry(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new ne(z.from(r),0,0))}delete(e,n){return this.replace(e,n,ne.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return YK(this,e,n,r),this}replaceRangeWith(e,n,r){return XK(this,e,n,r),this}deleteRange(e,n){return ZK(this,e,n),this}lift(e,n){return jK(this,e,n),this}join(e,n=1){return qK(this,e,n),this}wrap(e,n){return BK(this,e,n),this}setBlockType(e,n=e,r,s=null){return zK(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return UK(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new dc(e,n,r)),this}setDocAttribute(e,n){return this.step(new hd(e,n)),this}addNodeMark(e,n){return this.step(new Zi(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof Ze)n.isInSet(r.marks)&&this.step(new Ga(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Ga(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return HK(this,e,n,r),this}addMark(e,n,r){return OK(this,e,n,r),this}removeMark(e,n,r){return DK(this,e,n,r),this}clearIncompatible(e,n,r){return yT(this,e,n,r),this}}const h0=Object.create(null);class Te{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new DD(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=ne.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?ne.empty:n),a==0&&UC(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),UC(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new ve(e):Pl(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?Pl(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Pl(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new fr(e.node(0))}static atStart(e){return Pl(e,e,0,0,1)||new fr(e)}static atEnd(e){return Pl(e,e,e.content.size,e.childCount,-1)||new fr(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=h0[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in h0)throw new RangeError("Duplicate use of selection JSON ID "+e);return h0[e]=n,n.prototype.jsonID=e,n}getBookmark(){return ve.between(this.$anchor,this.$head).getBookmark()}}Te.prototype.visible=!0;class DD{constructor(e,n){this.$from=e,this.$to=n}}let zC=!1;function $C(t){!zC&&!t.parent.inlineContent&&(zC=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class ve extends Te{constructor(e,n=e){$C(e),$C(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return Te.near(r);let s=e.resolve(n.map(this.anchor));return new ve(s.parent.inlineContent?s:r,r)}replace(e,n=ne.empty){if(super.replace(e,n),n==ne.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof ve&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Py(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new ve(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=Te.findFrom(n,r,!0)||Te.findFrom(n,-r,!0);if(i)n=i.$head;else return Te.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(Te.findFrom(e,-r,!0)||Te.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new ve(e,n)}}Te.jsonID("text",ve);class Py{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Py(e.map(this.anchor),e.map(this.head))}resolve(e){return ve.between(e.resolve(this.anchor),e.resolve(this.head))}}class me extends Te{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?Te.near(i):new me(i)}content(){return new ne(z.from(this.node),0,0)}eq(e){return e instanceof me&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new xT(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new me(e.resolve(n.anchor))}static create(e,n){return new me(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}me.prototype.visible=!1;Te.jsonID("node",me);class xT{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Py(r,r):new xT(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&me.isSelectable(r)?new me(n):Te.near(n)}}class fr extends Te{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=ne.empty){if(n==ne.empty){e.delete(0,e.doc.content.size);let r=Te.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new fr(e)}map(e){return new fr(e)}eq(e){return e instanceof fr}getBookmark(){return e7}}Te.jsonID("all",fr);const e7={map(){return this},resolve(t){return new fr(t)}};function Pl(t,e,n,r,s,i=!1){if(e.inlineContent)return ve.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&me.isSelectable(a))return me.create(t,n-(s<0?a.nodeSize:0))}else{let l=Pl(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function UC(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof nn||s instanceof an))return;let i=t.mapping.maps[r],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(Te.near(t.doc.resolve(o),n))}const HC=1,Bf=2,WC=4;class t7 extends wT{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|HC)&~Bf,this.storedMarks=null,this}get selectionSet(){return(this.updated&HC)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Bf,this}ensureMarks(e){return Ze.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Bf)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Bf,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||Ze.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(Te.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=WC,this}get scrolledIntoView(){return(this.updated&WC)>0}}function qC(t,e){return!e||!t?t:t.bind(e)}class Ju{constructor(e,n,r){this.name=e,this.init=qC(n.init,r),this.apply=qC(n.apply,r)}}const n7=[new Ju("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ju("selection",{init(t,e){return t.selection||Te.atStart(e.doc)},apply(t){return t.selection}}),new Ju("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new Ju("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class d0{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=n7.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new Ju(r.key,r.spec.state,r))})}}class Jl{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,c=s?s[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Jl(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new t7(this)}static create(e){let n=new d0(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Jl(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new d0(this.schema,e.plugins),r=n.fields,s=new Jl(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new d0(e.schema,e.plugins),i=new Jl(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=ns.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=Te.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=c.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function LD(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=LD(s,e,{})),n[r]=s}return n}class ht{constructor(e){this.spec=e,this.props={},e.props&&LD(e.props,this,this.props),this.key=e.key?e.key.key:jD("plugin")}getState(e){return e[this.key]}}const f0=Object.create(null);function jD(t){return t in f0?t+"$"+ ++f0[t]:(f0[t]=0,t+"$")}class Pt{constructor(e="key"){this.key=jD(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const _T=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function VD(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const FD=(t,e,n)=>{let r=VD(t,n);if(!r)return!1;let s=bT(r);if(!s){let o=r.blockRange(),a=o&&eu(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(GD(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Vc(i,"end")||me.isSelectable(i)))for(let o=r.depth;;o--){let a=Ry(t.doc,r.before(o),r.after(o),ne.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Vc(i,"end")?Te.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):me.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},r7=(t,e,n)=>{let r=VD(t,n);if(!r)return!1;let s=bT(r);return s?BD(t,s,e):!1},s7=(t,e,n)=>{let r=$D(t,n);if(!r)return!1;let s=TT(r);return s?BD(t,s,e):!1};function BD(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=Ry(t.doc,i,l,ne.empty);if(!c||c.from!=i||c instanceof nn&&c.slice.size>=l-i)return!1;if(n){let u=t.tr.step(c);u.setSelection(ve.create(u.doc,i)),n(u.scrollIntoView())}return!0}function Vc(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const zD=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=bT(r)}let o=i&&i.nodeBefore;return!o||!me.isSelectable(o)?!1:(e&&e(t.tr.setSelection(me.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function bT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function $D(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const UD=(t,e,n)=>{let r=$D(t,n);if(!r)return!1;let s=TT(r);if(!s)return!1;let i=s.nodeAfter;if(GD(t,s,e,1))return!0;if(r.parent.content.size==0&&(Vc(i,"start")||me.isSelectable(i))){let o=Ry(t.doc,r.before(),r.after(),ne.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Vc(i,"start")?Te.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):me.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},HD=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=TT(r)}let o=i&&i.nodeAfter;return!o||!me.isSelectable(o)?!1:(e&&e(t.tr.setSelection(me.create(t.doc,i.pos)).scrollIntoView()),!0)};function TT(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const i7=(t,e)=>{let n=t.selection,r=n instanceof me,s;if(r){if(n.node.isTextblock||!Vo(t.doc,n.from))return!1;s=n.from}else if(s=Ny(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(me.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},o7=(t,e)=>{let n=t.selection,r;if(n instanceof me){if(n.node.isTextblock||!Vo(t.doc,n.to))return!1;r=n.to}else if(r=Ny(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},a7=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&eu(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},WD=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function ET(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const l7=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=ET(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(Te.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},qD=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof fr||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=ET(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(ve.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},KD=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(ri(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&eu(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)};function c7(t){return(e,n)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof me&&e.selection.node.isBlock)return!r.parentOffset||!ri(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,a,l=!1,c=!1;for(let m=r.depth;;m--)if(r.node(m).isBlock){l=r.end(m)==r.pos+(r.depth-m),c=r.start(m)==r.pos-(r.depth-m),a=ET(r.node(m-1).contentMatchAt(r.indexAfter(m-1))),i.unshift(l&&a?{type:a}:null),o=m;break}else{if(m==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof ve||e.selection instanceof fr)&&u.deleteSelection();let h=u.mapping.map(r.pos),f=ri(u.doc,h,i.length,i);if(f||(i[0]=a?{type:a}:null,f=ri(u.doc,h,i.length,i)),!f)return!1;if(u.split(h,i.length,i),!l&&c&&r.node(o).type!=a){let m=u.mapping.map(r.before(o)),g=u.doc.resolve(m);a&&r.node(o-1).canReplaceWith(g.index(),g.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const u7=c7(),h7=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(me.create(t.doc,s))),!0)};function d7(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||Vo(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function GD(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&d7(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let m=e.pos+i.nodeSize,g=z.empty;for(let w=o.length-1;w>=0;w--)g=z.from(o[w].create(null,g));g=z.from(s.copy(g));let y=t.tr.step(new an(e.pos-1,m,e.pos,m,new ne(g,1,0),o.length,!0)),v=y.doc.resolve(m+2*o.length);v.nodeAfter&&v.nodeAfter.type==s.type&&Vo(y.doc,v.pos)&&y.join(v.pos),n(y.scrollIntoView())}return!0}let u=i.type.spec.isolating||r>0&&l?null:Te.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),f=h&&eu(h);if(f!=null&&f>=e.depth)return n&&n(t.tr.lift(h,f).scrollIntoView()),!0;if(c&&Vc(i,"start",!0)&&Vc(s,"end")){let m=s,g=[];for(;g.push(m),!m.isTextblock;)m=m.lastChild;let y=i,v=1;for(;!y.isTextblock;y=y.firstChild)v++;if(m.canReplace(m.childCount,m.childCount,y.content)){if(n){let w=z.empty;for(let E=g.length-1;E>=0;E--)w=z.from(g[E].copy(w));let _=t.tr.step(new an(e.pos-g.length,e.pos+i.nodeSize,e.pos+v,e.pos+i.nodeSize-v,new ne(w,g.length,0),0,!0));n(_.scrollIntoView())}return!0}}return!1}function QD(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(ve.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const f7=QD(-1),p7=QD(1);function m7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&vT(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function KC(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let u=n.doc.resolve(c),h=u.index();s=u.parent.canReplaceWith(h,h+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}function ST(...t){return function(e,n,r){for(let s=0;s<t.length;s++)if(t[s](e,n,r))return!0;return!1}}ST(_T,FD,zD);ST(_T,UD,HD);ST(WD,qD,KD,u7);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function g7(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return y7(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function y7(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new $m(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new $m(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=vT(i,n,r,e);return a?(t&&v7(t,e,a,s,n),!0):!1}function v7(t,e,n,r,s){let i=z.empty;for(let u=n.length-1;u>=0;u--)i=z.from(n[u].type.create(n[u].attrs,i));t.step(new an(e.start-(r?2:0),e.end,e.start,e.end,new ne(i,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==s&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,f=!0;u<h;u++,f=!1)!f&&ri(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function w7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?x7(e,n,t,i):_7(e,n,i):!0:!1}}function x7(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new an(i-1,o,i,o,new ne(z.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new $m(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=eu(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return Vo(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function _7(t,e,n){let r=t.tr,s=n.parent;for(let m=n.end,g=n.endIndex-1,y=n.startIndex;g>y;g--)m-=s.child(g).nodeSize,r.delete(m-1,m+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?z.empty:z.from(s))))return!1;let h=i.pos,f=h+o.nodeSize;return r.step(new an(h-(a?1:0),f+(l?1:0),h+1,f-1,new ne((a?z.empty:z.from(s.copy(z.empty))).append(l?z.empty:z.from(s.copy(z.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function b7(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=z.from(c?t.create():null),h=new ne(z.from(t.create(null,z.from(a.type.create(null,u)))),c?3:1,0),f=i.start,m=i.end;n(e.tr.step(new an(f-(c?3:1),m,f,m,h,1,!0)).scrollIntoView())}return!0}}const fn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},Fc=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let kx=null;const Us=function(t,e,n){let r=kx||(kx=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},T7=function(){kx=null},Qa=function(t,e,n,r){return n&&(GC(t,e,n,r,-1)||GC(t,e,n,r,1))},E7=/^(img|br|input|textarea|hr)$/i;function GC(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:Nr(t))){let o=t.parentNode;if(!o||o.nodeType!=1||qd(t)||E7.test(t.nodeName)||t.contentEditable=="false")return!1;e=fn(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?Nr(t):0}else return!1}}function Nr(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function S7(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Nr(t)}else if(t.parentNode&&!qd(t))e=fn(t),t=t.parentNode;else return null}}function k7(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!qd(t))e=fn(t)+1,t=t.parentNode;else return null}}function C7(t,e,n){for(let r=e==0,s=e==Nr(t);r||s;){if(t==n)return!0;let i=fn(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==Nr(t)}}function qd(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const My=function(t){return t.focusNode&&Qa(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ia(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function I7(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function A7(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Nr(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Nr(r.startContainer),r.startOffset)}}}const Ns=typeof navigator<"u"?navigator:null,QC=typeof document<"u"?document:null,Fo=Ns&&Ns.userAgent||"",Cx=/Edge\/(\d+)/.exec(Fo),JD=/MSIE \d/.exec(Fo),Ix=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Fo),er=!!(JD||Ix||Cx),go=JD?document.documentMode:Ix?+Ix[1]:Cx?+Cx[1]:0,Dr=!er&&/gecko\/(\d+)/i.test(Fo);Dr&&+(/Firefox\/(\d+)/.exec(Fo)||[0,0])[1];const Ax=!er&&/Chrome\/(\d+)/.exec(Fo),rn=!!Ax,YD=Ax?+Ax[1]:0,In=!er&&!!Ns&&/Apple Computer/.test(Ns.vendor),Bc=In&&(/Mobile\/\w+/.test(Fo)||!!Ns&&Ns.maxTouchPoints>2),kr=Bc||(Ns?/Mac/.test(Ns.platform):!1),XD=Ns?/Win/.test(Ns.platform):!1,Xs=/Android \d/.test(Fo),Kd=!!QC&&"webkitFontSmoothing"in QC.documentElement.style,N7=Kd?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function R7(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function js(t,e){return typeof t=="number"?t:t[e]}function P7(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function JC(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=Fc(o);continue}let a=o,l=a==i.body,c=l?R7(i):P7(a),u=0,h=0;if(e.top<c.top+js(r,"top")?h=-(c.top-e.top+js(s,"top")):e.bottom>c.bottom-js(r,"bottom")&&(h=e.bottom-e.top>c.bottom-c.top?e.top+js(s,"top")-c.top:e.bottom-c.bottom+js(s,"bottom")),e.left<c.left+js(r,"left")?u=-(c.left-e.left+js(s,"left")):e.right>c.right-js(r,"right")&&(u=e.right-c.right+js(s,"right")),u||h)if(l)i.defaultView.scrollBy(u,h);else{let m=a.scrollLeft,g=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let y=a.scrollLeft-m,v=a.scrollTop-g;e={left:e.left-y,top:e.top-v,right:e.right-y,bottom:e.bottom-v}}let f=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(f))break;o=f=="absolute"?o.offsetParent:Fc(o)}}function M7(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:ZD(t.dom)}}function ZD(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=Fc(r));return e}function O7({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;eL(n,r==0?0:r-e)}function eL(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Tl=null;function D7(t){if(t.setActive)return t.setActive();if(Tl)return t.focus(Tl);let e=ZD(t);t.focus(Tl==null?{get preventScroll(){return Tl={preventScroll:!0},!0}}:void 0),Tl||(Tl=!1,eL(e,0))}function tL(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,h=0;u;u=u.nextSibling,h++){let f;if(u.nodeType==1)f=u.getClientRects();else if(u.nodeType==3)f=Us(u).getClientRects();else continue;for(let m=0;m<f.length;m++){let g=f[m];if(g.top<=o&&g.bottom>=a){o=Math.max(g.bottom,o),a=Math.min(g.top,a);let y=g.left>e.left?g.left-e.left:g.right<e.left?e.left-g.right:0;if(y<r){n=u,r=y,s=y&&n.nodeType==3?{left:g.right<e.left?g.right:g.left,top:e.top}:e,u.nodeType==1&&y&&(i=h+(e.left>=(g.left+g.right)/2?1:0));continue}}else g.top>e.top&&!l&&g.left<=e.left&&g.right>=e.left&&(l=u,c={left:Math.max(g.left,Math.min(g.right,e.left)),top:g.top});!n&&(e.left>=g.right&&e.top>=g.top||e.left>=g.left&&e.top>=g.bottom)&&(i=h+1)}}return!n&&l&&(n=l,s=c,r=0),n&&n.nodeType==3?L7(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:tL(n,s)}function L7(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=Oi(r,1);if(o.top!=o.bottom&&kT(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function kT(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function j7(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function V7(t,e,n){let{node:r,offset:s}=tL(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function F7(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function nL(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(kT(e,c))return nL(o,e,c)}}if((i=(i+1)%r)==s)break}return t}function B7(t,e){let n=t.dom.ownerDocument,r,s=0,i=A7(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!kT(e,c)||(o=nL(t.dom,e,c),!o))return null}if(In)for(let c=o;r&&c;c=Fc(c))c.draggable&&(r=void 0);if(o=j7(o,e),r){if(Dr&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let u=r.childNodes[s],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let c;Kd&&s&&r.nodeType==1&&(c=r.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=F7(t,r,s,e))}a==null&&(a=V7(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function YC(t){return t.top<t.bottom||t.left<t.right}function Oi(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(YC(r))return r}return Array.prototype.find.call(n,YC)||t.getBoundingClientRect()}const z7=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function rL(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Kd||Dr;if(r.nodeType==3)if(o&&(z7.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=Oi(Us(r,s,s),n);if(Dr&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let c=Oi(Us(r,s-1,s-1),-1);if(c.top==l.top){let u=Oi(Us(r,s,s+1),-1);if(u.top!=l.top)return Ou(u,u.left<c.left)}}return l}else{let l=s,c=s,u=n<0?1:-1;return n<0&&!s?(c++,u=-1):n>=0&&s==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Ou(Oi(Us(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==Nr(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return p0(l.getBoundingClientRect(),!1)}if(i==null&&s<Nr(r)){let l=r.childNodes[s];if(l.nodeType==1)return p0(l.getBoundingClientRect(),!0)}return p0(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==Nr(r))){let l=r.childNodes[s-1],c=l.nodeType==3?Us(l,Nr(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Ou(Oi(c,1),!1)}if(i==null&&s<Nr(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Us(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Ou(Oi(c,-1),!0)}return Ou(Oi(r.nodeType==3?Us(r):r,-n),n>=0)}function Ou(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function p0(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function sL(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function $7(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return sL(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=rL(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Us(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const U7=/[\u0590-\u08ac]/;function H7(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!U7.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:sL(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=t.domSelectionRange(),f=a.caretBidiLevel;a.modify("move",n,"character");let m=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:g,focusOffset:y}=t.domSelectionRange(),v=g&&!m.contains(g.nodeType==1?g:g.parentNode)||l==g&&c==y;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return f!=null&&(a.caretBidiLevel=f),v}):r.pos==r.start()||r.pos==r.end()}let XC=null,ZC=null,eI=!1;function W7(t,e,n){return XC==e&&ZC==n?eI:(XC=e,ZC=n,eI=n=="up"||n=="down"?$7(t,e,n):H7(t,e,n))}const Lr=0,tI=1,ha=2,Rs=3;class Gd{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Lr,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>fn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof oL){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof iL&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?fn(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?fn(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(s==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let h=a;h>0;h--){let f=this.children[h-1];if(f.size&&f.dom.parentNode==this.contentDOM&&!f.emptyChildAt(1)){s=fn(f.dom)+1;break}e-=f.size}s==-1&&(s=0)}if(s>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=fn(h.dom);break}n+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let m=0,g=0;m<this.children.length;m++){let y=this.children[m],v=g+y.size;if(i>g&&o<v)return y.setSelection(e-g-y.border,n-g-y.border,r,s);g=v}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),h=!1;if((Dr||In)&&e==n){let{node:m,offset:g}=a;if(m.nodeType==3){if(h=!!(g&&m.nodeValue[g-1]==`
`),h&&g==m.nodeValue.length)for(let y=m,v;y;y=y.parentNode){if(v=y.nextSibling){v.nodeName=="BR"&&(a=l={node:v.parentNode,offset:fn(v)+1});break}let w=y.pmViewDesc;if(w&&w.node&&w.node.isBlock)break}}else{let y=m.childNodes[g-1];h=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(Dr&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let m=u.focusNode.childNodes[u.focusOffset];m&&m.contentEditable=="false"&&(s=!0)}if(!(s||h&&In)&&Qa(a.node,a.offset,u.anchorNode,u.anchorOffset)&&Qa(l.node,l.offset,u.focusNode,u.focusOffset))return;let f=!1;if((c.extend||e==n)&&!(h&&Dr)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),f=!0}catch{}}if(!f){if(e>n){let g=a;a=l,l=g}let m=document.createRange();m.setEnd(l.node,l.offset),m.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(m)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?ha:tI,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Rs:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?ha:Rs}r=o}this.dirty=ha}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ha:tI;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class iL extends Gd{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Lr&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class q7 extends Gd{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class Ja extends Gd{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=ll.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new Ja(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Rs||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Rs&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Lr){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Lr}}slice(e,n,r){let s=Ja.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=Rx(i,n,o,r)),e>0&&(i=Rx(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class yo extends Gd{constructor(e,n,r,s,i,o,a,l,c){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,c=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),u=c&&c.dom,h=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=ll.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!h&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let f=u;return u=cL(u,r,n),c?l=new K7(e,n,r,s,u,h||null,f,c,i,o+1):n.isText?new Oy(e,n,r,s,u,f,i):new yo(e,n,r,s,u,h||null,f,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>z.empty)}return e}matchesNode(e,n,r){return this.dirty==Lr&&e.eq(this.node)&&Hm(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new Q7(this,o&&o.node,e);X7(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?Ze.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,s)},(c,u,h,f)=>{l.syncToMarks(c.marks,r,e);let m;l.findNodeMatch(c,u,h,f)||a&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(m=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,h,m,e)||l.updateNextNode(c,u,h,e,f,s)||l.addNode(c,u,h,e,s),s+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ha)&&(o&&this.protectLocalComposition(e,o),aL(this.contentDOM,this.children,e),Bc&&Z7(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof ve)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=eG(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new q7(this,i,n,s);e.input.compositionNodes.push(o),this.children=Rx(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==Rs||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Lr}updateOuterDeco(e){if(Hm(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=lL(this.dom,this.nodeDOM,Nx(this.outerDeco,this.node,n),Nx(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function nI(t,e,n,r,s){cL(r,e,t);let i=new yo(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class Oy extends yo{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==Rs||this.dirty!=Lr&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Lr||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Lr,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new Oy(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Rs)}get domAtom(){return!1}isText(e){return this.node.text==e}}class oL extends Gd{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Lr&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class K7 extends yo{constructor(e,n,r,s,i,o,a,l,c,u){super(e,n,r,s,i,o,a,c,u),this.spec=l}update(e,n,r,s){if(this.dirty==Rs)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function aL(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=rI(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof Ja){let l=r?r.previousSibling:t.lastChild;aL(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=rI(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const xh=function(t){t&&(this.nodeName=t)};xh.prototype=Object.create(null);const da=[new xh];function Nx(t,e,n){if(t.length==0)return da;let r=n?da[0]:new xh,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new xh(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new xh(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function lL(t,e,n,r){if(n==da&&r==da)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=da[0]),s=l}G7(s,a||da[0],o)}return s}function G7(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function cL(t,e,n){return lL(t,t,da,Nx(e,n,t.nodeType!=1))}function Hm(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function rI(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Q7{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=J7(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Lr,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=Ja.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==Rs&&o.dom==o.contentDOM&&(o.dirty=ha),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof yo){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,h,f=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Rs&&Hm(n,l.outerDeco));if(!f&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!f&&(h=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=ha,h.updateChildren(s,o+1),h.dirty=Lr),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!Hm(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=yo.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=yo.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new iL(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Ja;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof Oy)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((In||rn)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new oL(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function J7(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof Ja)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function Y7(t,e){return t.type.side-e.type.side}function X7(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,s,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,h;for(;o<s.length&&s[o].to==i;){let v=s[o++];v.widget&&(u?(h||(h=[u])).push(v):u=v)}if(u)if(h){h.sort(Y7);for(let v=0;v<h.length;v++)n(h[v],c,!!l)}else n(u,c,!!l);let f,m;if(l)m=-1,f=l,l=null;else if(c<t.childCount)m=c,f=t.child(c++);else break;for(let v=0;v<a.length;v++)a[v].to<=i&&a.splice(v--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let g=i+f.nodeSize;if(f.isText){let v=g;o<s.length&&s[o].from<v&&(v=s[o].from);for(let w=0;w<a.length;w++)a[w].to<v&&(v=a[w].to);v<g&&(l=f.cut(v-i),f=f.cut(0,v-i),g=v,m=-1)}else for(;o<s.length&&s[o].to<g;)o++;let y=f.isInline&&!f.isLeaf?a.filter(v=>!v.inline):a.slice();r(f,y,e.forChild(i,f),m),i=g}}function Z7(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function eG(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let c=t.child(s++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function Rx(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,r)),s&&(i.push(s),s=void 0),u>n&&i.push(l.slice(n-c,l.size,r)))}return i}function CT(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(My(n)){for(l=o;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&me.isSelectable(h)&&s.parent&&!(h.isInline&&C7(n.focusNode,n.focusOffset,s.dom))){let f=s.posBefore;c=new me(o==f?a:r.resolve(f))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let h=o,f=o;for(let m=0;m<n.rangeCount;m++){let g=n.getRangeAt(m);h=Math.min(h,t.docView.posFromDOM(g.startContainer,g.startOffset,1)),f=Math.max(f,t.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(h<0)return null;[l,o]=f==t.state.selection.anchor?[f,h]:[h,f],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let h=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=IT(t,u,a,h)}return c}function uL(t){return t.editable?t.hasFocus():dL(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function si(t,e=!1){let n=t.state.selection;if(hL(t,n),!!uL(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&rn){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&Qa(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)nG(t);else{let{anchor:r,head:s}=n,i,o;sI&&!(n instanceof ve)&&(n.$from.parent.inlineContent||(i=iI(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=iI(t,n.to))),t.docView.setSelection(r,s,t,e),sI&&(i&&oI(i),o&&oI(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&tG(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const sI=In||rn&&YD<63;function iI(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(In&&s&&s.contentEditable=="false")return m0(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return m0(s);if(i)return m0(i)}}function m0(t){return t.contentEditable="true",In&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function oI(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function tG(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!uL(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function nG(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,fn(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&er&&go<=11&&(n.disabled=!0,n.disabled=!1)}function hL(t,e){if(e instanceof me){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(aI(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else aI(t)}function aI(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function IT(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||ve.between(e,n,r)}function lI(t){return t.editable&&!t.hasFocus()?!1:dL(t)}function dL(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function rG(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Qa(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Px(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&Te.findFrom(i,e)}function ji(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function cI(t,e,n){let r=t.state.selection;if(r instanceof ve)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return ji(t,new ve(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=Px(t.state,e);return s&&s instanceof me?ji(t,s):!1}else if(!(kr&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?me.isSelectable(i)?ji(t,new me(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Kd?ji(t,new ve(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof me&&r.node.isInline)return ji(t,new ve(e>0?r.$to:r.$from));{let s=Px(t.state,e);return s?ji(t,s):!1}}}function Wm(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function _h(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function El(t,e){return e<0?sG(t):iG(t)}function sG(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(Dr&&n.nodeType==1&&r<Wm(n)&&_h(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(_h(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(fL(n))break;{let a=n.previousSibling;for(;a&&_h(a,-1);)s=n.parentNode,i=fn(a),a=a.previousSibling;if(a)n=a,r=Wm(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?Mx(t,n,r):s&&Mx(t,s,i)}function iG(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=Wm(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(_h(a,1))i=n,o=++r;else break}else{if(fL(n))break;{let a=n.nextSibling;for(;a&&_h(a,1);)i=a.parentNode,o=fn(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=Wm(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&Mx(t,i,o)}function fL(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function oG(t,e){for(;t&&e==t.childNodes.length&&!qd(t);)e=fn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function aG(t,e){for(;t&&!e&&!qd(t);)e=fn(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Mx(t,e,n){if(e.nodeType!=3){let i,o;(o=oG(e,n))?(e=o,n=0):(i=aG(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(My(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&si(t)},50)}function uI(t,e){let n=t.state.doc.resolve(e);if(!(rn||XD)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function hI(t,e,n){let r=t.state.selection;if(r instanceof ve&&!r.empty||n.indexOf("s")>-1||kr&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=Px(t.state,e);if(o&&o instanceof me)return ji(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof fr?Te.near(o,e):Te.findFrom(o,e);return a?ji(t,a):!1}return!1}function dI(t,e){if(!(t.state.selection instanceof ve))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function fI(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function lG(t){if(!In||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;fI(t,r,"true"),setTimeout(()=>fI(t,r,"false"),20)}return!1}function cG(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function uG(t,e){let n=e.keyCode,r=cG(e);if(n==8||kr&&n==72&&r=="c")return dI(t,-1)||El(t,-1);if(n==46&&!e.shiftKey||kr&&n==68&&r=="c")return dI(t,1)||El(t,1);if(n==13||n==27)return!0;if(n==37||kr&&n==66&&r=="c"){let s=n==37?uI(t,t.state.selection.from)=="ltr"?-1:1:-1;return cI(t,s,r)||El(t,s)}else if(n==39||kr&&n==70&&r=="c"){let s=n==39?uI(t,t.state.selection.from)=="ltr"?1:-1:1;return cI(t,s,r)||El(t,s)}else{if(n==38||kr&&n==80&&r=="c")return hI(t,-1,r)||El(t,-1);if(n==40||kr&&n==78&&r=="c")return lG(t)||hI(t,1,r)||El(t,1);if(r==(kr?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function AT(t,e){t.someProp("transformCopied",m=>{e=m(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let m=r.firstChild;n.push(m.type.name,m.attrs!=m.type.defaultAttrs?m.attrs:null),r=m.content}let o=t.someProp("clipboardSerializer")||ll.fromSchema(t.state.schema),a=wL(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=vL[c.nodeName.toLowerCase()]);){for(let m=u.length-1;m>=0;m--){let g=a.createElement(u[m]);for(;l.firstChild;)g.appendChild(l.firstChild);l.appendChild(g),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",m=>m(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:f,slice:e}}function pL(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",f=>{e=f(e,i||r,t)}),i)return a=new ne(z.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",f=>{a=f(a,t,!0)}),a;let h=t.someProp("clipboardTextParser",f=>f(e,s,r,t));if(h)a=h;else{let f=s.marks(),{schema:m}=t.state,g=ll.fromSchema(m);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let v=o.appendChild(document.createElement("p"));y&&v.appendChild(g.serializeNode(m.text(y,f)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),o=pG(n),Kd&&mG(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let f=o.firstChild;for(;f&&f.nodeType!=1;)f=f.nextSibling;if(!f)break;o=f}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||mo.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:s,ruleFromNode(f){return f.nodeName=="BR"&&!f.nextSibling&&f.parentNode&&!hG.test(f.parentNode.nodeName)?{ignore:!0}:null}})),u)a=gG(pI(a,+u[1],+u[2]),u[4]);else if(a=ne.maxOpen(dG(a.content,s),!0),a.openStart||a.openEnd){let h=0,f=0;for(let m=a.content.firstChild;h<a.openStart&&!m.type.spec.isolating;h++,m=m.firstChild);for(let m=a.content.lastChild;f<a.openEnd&&!m.type.spec.isolating;f++,m=m.lastChild);a=pI(a,h,f)}return t.someProp("transformPasted",h=>{a=h(a,t,l)}),a}const hG=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function dG(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&gL(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=yL(o[o.length-1],i.length));let u=mL(a,l);o.push(u),s=s.matchType(u.type),i=l}}),o)return z.from(o)}return t}function mL(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,z.from(t));return t}function gL(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=gL(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(z.from(mL(n,t,s+1))))}}function yL(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,yL(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(z.empty,!0);return t.copy(n.append(r))}function Ox(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=Ox(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(z.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function pI(t,e,n){return e<t.openStart&&(t=new ne(Ox(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new ne(Ox(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const vL={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let mI=null;function wL(){return mI||(mI=document.implementation.createHTMLDocument("title"))}let g0=null;function fG(t){let e=window.trustedTypes;return e?(g0||(g0=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),g0.createHTML(t)):t}function pG(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=wL().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&vL[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=fG(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function mG(t){let e=t.querySelectorAll(rn?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function gG(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=z.from(l.create(r[a+1],s)),i++,o++}return new ne(s,i,o)}const Fn={},Bn={},yG={touchstart:!0,touchmove:!0};class vG{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function wG(t){for(let e in Fn){let n=Fn[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{_G(t,r)&&!NT(t,r)&&(t.editable||!(r.type in Bn))&&n(t,r)},yG[e]?{passive:!0}:void 0)}In&&t.dom.addEventListener("input",()=>null),Dx(t)}function eo(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function xG(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function Dx(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>NT(t,r))})}function NT(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function _G(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function bG(t,e){!NT(t,e)&&Fn[e.type]&&(t.editable||!(e.type in Bn))&&Fn[e.type](t,e)}Bn.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!_L(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(Xs&&rn&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),Bc&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,ia(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||uG(t,n)?n.preventDefault():eo(t,"key")};Bn.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Bn.keypress=(t,e)=>{let n=e;if(_L(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||kr&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof ve)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Dy(t){return{left:t.clientX,top:t.clientY}}function TG(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function RT(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function fc(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function EG(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&me.isSelectable(r)?(fc(t,new me(n)),!0):!1}function SG(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof me&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(me.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(fc(t,me.create(t.state.doc,s)),!0):!1}function kG(t,e,n,r,s){return RT(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?SG(t,n):EG(t,n))}function CG(t,e,n,r){return RT(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function IG(t,e,n,r){return RT(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||AG(t,n,r)}function AG(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(fc(t,ve.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)fc(t,ve.create(r,a+1,a+1+o.content.size));else if(me.isSelectable(o))fc(t,me.create(r,a));else continue;return!0}}function PT(t){return qm(t)}const xL=kr?"metaKey":"ctrlKey";Fn.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=PT(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&TG(n,t.input.lastClick)&&!n[xL]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Dy(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new NG(t,o,n,!!r)):(i=="doubleClick"?CG:IG)(t,o.pos,o.inside,n)?n.preventDefault():eo(t,"pointer"))};class NG{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[xL],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);i=u.parent,o=u.depth?u.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof me&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Dr&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),eo(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>si(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Dy(e))),this.updateAllowDefault(e),this.allowDefault||!n?eo(this.view,"pointer"):kG(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||In&&this.mightDrag&&!this.mightDrag.node.isAtom||rn&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(fc(this.view,Te.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):eo(this.view,"pointer")}move(e){this.updateAllowDefault(e),eo(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}Fn.touchstart=t=>{t.input.lastTouch=Date.now(),PT(t),eo(t,"pointer")};Fn.touchmove=t=>{t.input.lastTouch=Date.now(),eo(t,"pointer")};Fn.contextmenu=t=>PT(t);function _L(t,e){return t.composing?!0:In&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const RG=Xs?5e3:-1;Bn.compositionstart=Bn.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof ve&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||rn&&XD&&PG(t)))t.markCursor=t.state.storedMarks||n.marks(),qm(t,!0),t.markCursor=null;else if(qm(t,!e.selection.empty),Dr&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}bL(t,RG)};function PG(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Bn.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,bL(t,20))};function bL(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>qm(t),e))}function TL(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=OG());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function MG(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=S7(e.focusNode,e.focusOffset),r=k7(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function OG(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function qm(t,e=!1){if(!(Xs&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),TL(t),e||t.docView&&t.docView.dirty){let n=CT(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function DG(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const dd=er&&go<15||Bc&&N7<604;Fn.copy=Bn.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=dd?null:n.clipboardData,o=r.content(),{dom:a,text:l}=AT(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):DG(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function LG(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function jG(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?fd(t,r.value,null,s,e):fd(t,r.textContent,r.innerHTML,s,e)},50)}function fd(t,e,n,r,s){let i=pL(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||ne.empty)))return!0;if(!i)return!1;let o=LG(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function EL(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Bn.paste=(t,e)=>{let n=e;if(t.composing&&!Xs)return;let r=dd?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&fd(t,EL(r),r.getData("text/html"),s,n)?n.preventDefault():jG(t,n)};class SL{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const VG=kr?"altKey":"ctrlKey";function kL(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[VG]}Fn.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Dy(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof me?s.to-1:s.to))){if(r&&r.mightDrag)o=me.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let h=t.docView.nearestDesc(n.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(o=me.create(t.state.doc,h.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=AT(t,a);(!n.dataTransfer.files.length||!rn||YD>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(dd?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",dd||n.dataTransfer.setData("text/plain",c),t.dragging=new SL(u,kL(t,n),o)};Fn.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Bn.dragover=Bn.dragenter=(t,e)=>e.preventDefault();Bn.drop=(t,e)=>{try{FG(t,e,t.dragging)}finally{t.dragging=null}};function FG(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Dy(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",m=>{i=m(i,t,!1)}):i=pL(t,EL(e.dataTransfer),dd?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&kL(t,e));if(t.someProp("handleDrop",m=>m(t,e,i||ne.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?ND(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:m}=n;m?m.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,h=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),l.doc.eq(h))return;let f=l.doc.resolve(c);if(u&&me.isSelectable(i.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new me(f));else{let m=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((g,y,v,w)=>m=w),l.setSelection(IT(t,f,l.doc.resolve(m)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Fn.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&si(t)},20))};Fn.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Fn.beforeinput=(t,e)=>{if(rn&&Xs&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,ia(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Bn)Fn[t]=Bn[t];function pd(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class Km{constructor(e,n){this.toDOM=e,this.spec=n||ka,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new sn(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof Km&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&pd(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class vo{constructor(e,n){this.attrs=e,this.spec=n||ka}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new sn(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof vo&&pd(this.attrs,e.attrs)&&pd(this.spec,e.spec)}static is(e){return e.type instanceof vo}destroy(){}}class MT{constructor(e,n){this.attrs=e,this.spec=n||ka}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new sn(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof MT&&pd(this.attrs,e.attrs)&&pd(this.spec,e.spec)}destroy(){}}class sn{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new sn(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new sn(e,e,new Km(n,r))}static inline(e,n,r,s){return new sn(e,n,new vo(r,s))}static node(e,n,r,s){return new sn(e,n,new MT(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof vo}get widget(){return this.type instanceof Km}}const Ml=[],ka={};class tt{constructor(e,n){this.local=e.length?e:Ml,this.children=n.length?n:Ml}static create(e,n){return n.length?Gm(n,e,0,ka):_n}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==_n||e.maps.length==0?this:this.mapInner(e,n,0,0,r||ka)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?BG(this.children,o||[],e,n,r,s,i):o?new tt(o.sort(Ca),Ml):_n}add(e,n){return n.length?this==_n?tt.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=IL(n,a,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,u,c+1):s.splice(i,0,l,l+a.nodeSize,Gm(u,a,c+1,ka)),i+=3}});let o=CL(i?AL(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new tt(o.length?this.local.concat(o).sort(Ca):this.local,s||this.children)}remove(e){return e.length==0||this==_n?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(o,a+1);c!=_n?r[i+2]=c:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new tt(s,r):_n}forChild(e,n){if(this==_n)return this;if(n.isLeaf)return tt.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof vo){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(s||(s=[])).push(l.copy(c,u))}}if(s){let a=new tt(s.sort(Ca),Ml);return r?new qi([a,r]):a}return r||_n}eq(e){if(this==e)return!0;if(!(e instanceof tt)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return OT(this.localsInner(e))}localsInner(e){if(this==_n)return Ml;if(e.inlineContent||!this.local.some(vo.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof vo||n.push(this.local[r]);return n}forEachSet(e){e(this)}}tt.empty=new tt([],[]);tt.removeOverlap=OT;const _n=tt.empty;class qi{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,ka));return qi.from(r)}forChild(e,n){if(n.isLeaf)return tt.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=_n&&(i instanceof qi?r=r.concat(i.members):r.push(i))}return qi.from(r)}eq(e){if(!(e instanceof qi)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?OT(r?n:n.sort(Ca)):Ml}static from(e){switch(e.length){case 0:return _n;case 1:return e[0];default:return new qi(e.every(n=>n instanceof tt)?e:e.reduce((n,r)=>n.concat(r instanceof tt?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function BG(t,e,n,r,s,i,o){let a=t.slice();for(let c=0,u=i;c<n.maps.length;c++){let h=0;n.maps[c].forEach((f,m,g,y)=>{let v=y-g-(m-f);for(let w=0;w<a.length;w+=3){let _=a[w+1];if(_<0||f>_+u-h)continue;let E=a[w]+u-h;m>=E?a[w+1]=f<=E?-2:-1:f>=u&&v&&(a[w]+=v,a[w+1]+=v)}h+=v}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+i),h=u-s;if(h<0||h>=r.content.size){l=!0;continue}let f=n.map(t[c+1]+i,-1),m=f-s,{index:g,offset:y}=r.content.findIndex(h),v=r.maybeChild(g);if(v&&y==h&&y+v.nodeSize==m){let w=a[c+2].mapInner(n,v,u+1,t[c]+i+1,o);w!=_n?(a[c]=h,a[c+1]=m,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=zG(a,t,e,n,s,i,o),u=Gm(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,f=0;h<u.children.length;h+=3){let m=u.children[h];for(;f<a.length&&a[f]<m;)f+=3;a.splice(f,0,u.children[h],u.children[h+1],u.children[h+2])}}return new tt(e.sort(Ca),a)}function CL(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new sn(s.from+e,s.to+e,s.type))}return n}function zG(t,e,n,r,s,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,s,c);h?n.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function IL(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function AL(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Gm(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let c=IL(t,a,l+n);if(c){i=!0;let u=Gm(c,a,n+l+1,r);u!=_n&&s.push(l,l+a.nodeSize,u)}});let o=CL(i?AL(t):t,-n).sort(Ca);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new tt(o,s):_n}function Ca(t,e){return t.from-e.from||t.to-e.to}function OT(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),gI(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),gI(e,s,r.copy(i.from,r.to)));break}}}return e}function gI(t,e,n){for(;e<t.length&&Ca(n,t[e])>0;)e++;t.splice(e,0,n)}function y0(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=_n&&e.push(r)}),t.cursorWrapper&&e.push(tt.create(t.state.doc,[t.cursorWrapper.deco])),qi.from(e)}const $G={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},UG=er&&go<=11;class HG{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class WG{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new HG,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);er&&go<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),UG&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,$G)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(lI(this.view)){if(this.suppressingSelectionUpdates)return si(this.view);if(er&&go<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Qa(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=Fc(i))n.add(i);for(let i=e.anchorNode;i;i=Fc(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&lI(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let h=this.registerMutation(n[u],l);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(Dr&&l.length){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,f]=u;h.parentNode&&h.parentNode.parentNode==f.parentNode?f.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let f of u){let m=f.parentNode;m&&m.nodeName=="LI"&&(!h||GG(e,h)!=m)&&f.remove()}}}else if((rn||In)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let h=u.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&My(r)&&(c=CT(e))&&c.eq(Te.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,si(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),qG(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||si(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];n.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(er&&go<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:f}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!f||Array.prototype.indexOf.call(e.addedNodes,f)<0)&&(i=f)}let o=s&&s.parentNode==e.target?fn(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?fn(i):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let yI=new WeakMap,vI=!1;function qG(t){if(!yI.has(t)&&(yI.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Dr,vI)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),vI=!0}}function wI(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return Qa(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function KG(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return wI(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?wI(t,n):null}function GG(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function QG(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],My(l)||c.push({node:l.focusNode,offset:l.focusOffset})),rn&&t.input.lastKeyCode===8)for(let v=i;v>s;v--){let w=r.childNodes[v-1],_=w.pmViewDesc;if(w.nodeName=="BR"&&!_){i=v;break}if(!_||_.size)break}let h=t.state.doc,f=t.someProp("domParser")||mo.fromSchema(t.state.schema),m=h.resolve(o),g=null,y=f.parse(r,{topNode:m.parent,topMatch:m.parent.contentMatchAt(m.index()),topOpen:!0,from:s,to:i,preserveWhitespace:m.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:JG,context:m});if(c&&c[0].pos!=null){let v=c[0].pos,w=c[1]&&c[1].pos;w==null&&(w=v),g={anchor:v+o,head:w+o}}return{doc:y,sel:g,from:o,to:a}}function JG(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(In&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||In&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const YG=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function XG(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let S=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,T=CT(t,S);if(T&&!t.state.selection.eq(T)){if(rn&&Xs&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",I=>I(t,ia(13,"Enter"))))return;let k=t.state.tr.setSelection(T);S=="pointer"?k.setMeta("pointer",!0):S=="key"&&k.scrollIntoView(),i&&k.setMeta("composition",i),t.dispatch(k)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=QG(t,e,n),u=t.state.doc,h=u.slice(c.from,c.to),f,m;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(f=t.state.selection.to,m="end"):(f=t.state.selection.from,m="start"),t.input.lastKeyCode=null;let g=tQ(h.content,c.doc.content,c.from,f,m);if(g&&t.input.domChangeCount++,(Bc&&t.input.lastIOSEnter>Date.now()-225||Xs)&&s.some(S=>S.nodeType==1&&!YG.test(S.nodeName))&&(!g||g.endA>=g.endB)&&t.someProp("handleKeyDown",S=>S(t,ia(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!g)if(r&&l instanceof ve&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))g={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let S=xI(t,t.state.doc,c.sel);if(S&&!S.eq(t.state.selection)){let T=t.state.tr.setSelection(S);i&&T.setMeta("composition",i),t.dispatch(T)}}return}t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof ve&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),er&&go<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>c.from&&c.doc.textBetween(g.start-c.from-1,g.start-c.from+1)==" "&&(g.start--,g.endA--,g.endB--);let y=c.doc.resolveNoCache(g.start-c.from),v=c.doc.resolveNoCache(g.endB-c.from),w=u.resolve(g.start),_=y.sameParent(v)&&y.parent.inlineContent&&w.end()>=g.endA;if((Bc&&t.input.lastIOSEnter>Date.now()-225&&(!_||s.some(S=>S.nodeName=="DIV"||S.nodeName=="P"))||!_&&y.pos<c.doc.content.size&&(!y.sameParent(v)||!y.parent.inlineContent)&&y.pos<v.pos&&!/\S/.test(c.doc.textBetween(y.pos,v.pos,"","")))&&t.someProp("handleKeyDown",S=>S(t,ia(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>g.start&&eQ(u,g.start,g.endA,y,v)&&t.someProp("handleKeyDown",S=>S(t,ia(8,"Backspace")))){Xs&&rn&&t.domObserver.suppressSelectionUpdates();return}rn&&g.endB==g.start&&(t.input.lastChromeDelete=Date.now()),Xs&&!_&&y.start()!=v.start()&&v.parentOffset==0&&y.depth==v.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==g.endA&&(g.endB-=2,v=c.doc.resolveNoCache(g.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(S){return S(t,ia(13,"Enter"))})},20));let E=g.start,N=g.endA,R=S=>{let T=S||t.state.tr.replace(E,N,c.doc.slice(g.start-c.from,g.endB-c.from));if(c.sel){let k=xI(t,T.doc,c.sel);k&&!(rn&&t.composing&&k.empty&&(g.start!=g.endB||t.input.lastChromeDelete<Date.now()-100)&&(k.head==E||k.head==T.mapping.map(N)-1)||er&&k.empty&&k.head==E)&&T.setSelection(k)}return i&&T.setMeta("composition",i),T.scrollIntoView()},O;if(_)if(y.pos==v.pos){er&&go<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>si(t),20));let S=R(t.state.tr.delete(E,N)),T=u.resolve(g.start).marksAcross(u.resolve(g.endA));T&&S.ensureMarks(T),t.dispatch(S)}else if(g.endA==g.endB&&(O=ZG(y.parent.content.cut(y.parentOffset,v.parentOffset),w.parent.content.cut(w.parentOffset,g.endA-w.start())))){let S=R(t.state.tr);O.type=="add"?S.addMark(E,N,O.mark):S.removeMark(E,N,O.mark),t.dispatch(S)}else if(y.parent.child(y.index()).isText&&y.index()==v.index()-(v.textOffset?0:1)){let S=y.parent.textBetween(y.parentOffset,v.parentOffset),T=()=>R(t.state.tr.insertText(S,E,N));t.someProp("handleTextInput",k=>k(t,E,N,S,T))||t.dispatch(T())}else t.dispatch(R());else t.dispatch(R())}function xI(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:IT(t,e.resolve(n.anchor),e.resolve(n.head))}function ZG(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let u=0;u<r.length;u++)s=r[u].removeFromSet(s);for(let u=0;u<n.length;u++)i=n[u].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(z.from(c).eq(t))return{mark:a,type:o}}function eQ(t,e,n,r,s){if(n-e<=s.pos-r.pos||v0(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(v0(i,!0,!0));return!o.parent.isTextblock||o.pos>n||v0(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function v0(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function tQ(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&_I(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&_I(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function _I(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class NL{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new vG,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(kI),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=EI(this),TI(this),this.nodeViews=SI(this),this.docView=nI(this.state.doc,bI(this),y0(this),this.dom,this),this.domObserver=new WG(this,(r,s,i,o)=>XG(this,r,s,i,o)),this.domObserver.start(),wG(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&Dx(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(kI),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(TL(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let m=SI(this);rQ(m,this.nodeViews)&&(this.nodeViews=m,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&Dx(this),this.editable=EI(this),TI(this);let l=y0(this),c=bI(this),u=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,c,l);(h||!e.selection.eq(s.selection))&&(o=!0);let f=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&M7(this);if(o){this.domObserver.stop();let m=h&&(er||rn)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&nQ(s.selection,e.selection);if(h){let g=rn?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=MG(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=nI(e.doc,c,l,this.dom,this)),g&&!this.trackWrites&&(m=!0)}m||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&rG(this))?si(this,m):(hL(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():f&&O7(f)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof me){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&JC(this,n.getBoundingClientRect(),e)}else JC(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new SL(e.slice,e.move,s<0?void 0:me.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(er){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&D7(this.dom),si(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return B7(this,e)}coordsAtPos(e,n=1){return rL(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return W7(this,n||this.state,e)}pasteHTML(e,n){return fd(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return fd(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return AT(this,e)}destroy(){this.docView&&(xG(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],y0(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,T7())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return bG(this,e)}domSelectionRange(){let e=this.domSelection();return e?In&&this.root.nodeType===11&&I7(this.dom.ownerDocument)==this.dom&&KG(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}NL.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function bI(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[sn.node(0,t.state.doc.content.size,e)]}function TI(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:sn.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function EI(t){return!t.someProp("editable",e=>e(t.state)===!1)}function nQ(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function SI(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function rQ(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function kI(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var ko={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Qm={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},sQ=typeof navigator<"u"&&/Mac/.test(navigator.platform),iQ=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var pn=0;pn<10;pn++)ko[48+pn]=ko[96+pn]=String(pn);for(var pn=1;pn<=24;pn++)ko[pn+111]="F"+pn;for(var pn=65;pn<=90;pn++)ko[pn]=String.fromCharCode(pn+32),Qm[pn]=String.fromCharCode(pn);for(var w0 in ko)Qm.hasOwnProperty(w0)||(Qm[w0]=ko[w0]);function oQ(t){var e=sQ&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||iQ&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Qm:ko)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const aQ=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),lQ=typeof navigator<"u"&&/Win/.test(navigator.platform);function cQ(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))aQ?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function uQ(t){let e=Object.create(null);for(let n in t)e[cQ(n)]=t[n];return e}function x0(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function hQ(t){return new ht({props:{handleKeyDown:DT(t)}})}function DT(t){let e=uQ(t);return function(n,r){let s=oQ(r),i,o=e[x0(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[x0(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(lQ&&r.ctrlKey&&r.altKey)&&(i=ko[r.keyCode])&&i!=s){let a=e[x0(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var dQ=Object.defineProperty,LT=(t,e)=>{for(var n in e)dQ(t,n,{get:e[n],enumerable:!0})};function Ly(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}var jy=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:s}=n,i=this.buildProps(s);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(i);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r,o=[],a=!!t,l=t||s.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),o.every(h=>h===!0)),u={...Object.fromEntries(Object.entries(n).map(([h,f])=>[h,(...g)=>{const y=this.buildProps(l,e),v=f(...g)(y);return o.push(v),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,s=t||n.tr,i=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...i,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r,o={tr:t,editor:r,view:i,state:Ly({state:s,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},RL={};LT(RL,{blur:()=>fQ,clearContent:()=>pQ,clearNodes:()=>mQ,command:()=>gQ,createParagraphNear:()=>yQ,cut:()=>vQ,deleteCurrentNode:()=>wQ,deleteNode:()=>xQ,deleteRange:()=>_Q,deleteSelection:()=>bQ,enter:()=>TQ,exitCode:()=>EQ,extendMarkRange:()=>SQ,first:()=>kQ,focus:()=>IQ,forEach:()=>AQ,insertContent:()=>NQ,insertContentAt:()=>MQ,joinBackward:()=>LQ,joinDown:()=>DQ,joinForward:()=>jQ,joinItemBackward:()=>VQ,joinItemForward:()=>FQ,joinTextblockBackward:()=>BQ,joinTextblockForward:()=>zQ,joinUp:()=>OQ,keyboardShortcut:()=>UQ,lift:()=>HQ,liftEmptyBlock:()=>WQ,liftListItem:()=>qQ,newlineInCode:()=>KQ,resetAttributes:()=>GQ,scrollIntoView:()=>QQ,selectAll:()=>JQ,selectNodeBackward:()=>YQ,selectNodeForward:()=>XQ,selectParentNode:()=>ZQ,selectTextblockEnd:()=>eJ,selectTextblockStart:()=>tJ,setContent:()=>nJ,setMark:()=>_J,setMeta:()=>bJ,setNode:()=>TJ,setNodeSelection:()=>EJ,setTextDirection:()=>SJ,setTextSelection:()=>kJ,sinkListItem:()=>CJ,splitBlock:()=>IJ,splitListItem:()=>AJ,toggleList:()=>NJ,toggleMark:()=>RJ,toggleNode:()=>PJ,toggleWrap:()=>MJ,undoInputRule:()=>OJ,unsetAllMarks:()=>DJ,unsetMark:()=>LJ,unsetTextDirection:()=>jJ,updateAttributes:()=>VJ,wrapIn:()=>FJ,wrapInList:()=>BJ});var fQ=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())==null||n.removeAllRanges())}),!0),pQ=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),mQ=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),f=c.resolve(u.map(l+a.nodeSize)),m=h.blockRange(f);if(!m)return;const g=eu(m);if(a.type.isTextblock){const{defaultType:y}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(m.start,y)}(g||g===0)&&e.lift(m,g)})}),!0},gQ=t=>e=>t(e),yQ=()=>({state:t,dispatch:e})=>qD(t,e),vQ=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new ve(r.doc.resolve(Math.max(o-1,0)))),!0},wQ=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1};function zt(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var xQ=t=>({tr:e,state:n,dispatch:r})=>{const s=zt(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},_Q=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},bQ=()=>({state:t,dispatch:e})=>_T(t,e),TQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),EQ=()=>({state:t,dispatch:e})=>l7(t,e);function jT(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function Jm(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:jT(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function PL(t,e,n={}){return t.find(r=>r.type===e&&Jm(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function CI(t,e,n={}){return!!PL(t,e,n)}function VT(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(n=n||((r=s.node.marks[0])==null?void 0:r.attrs),!PL([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,c=a+s.node.nodeSize;for(;o>0&&CI([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&CI([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function wi(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var SQ=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=wi(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(s){const h=VT(l,i,e);if(h&&h.from<=c&&h.to>=u){const f=ve.create(o,h.from,h.to);n.setSelection(f)}}return!0},kQ=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function ML(t){return t instanceof ve}function fa(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function OL(t,e=null){if(!e)return null;const n=Te.atStart(t),r=Te.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?ve.create(t,fa(0,s,i),fa(t.content.size,s,i)):ve.create(t,fa(e,s,i),fa(e,s,i))}function II(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function Ym(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function CQ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var IQ=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(Ym()||II())&&r.dom.focus(),CQ()&&!Ym()&&!II()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!ML(n.state.selection))return o(),!0;const a=OL(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},AQ=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),NQ=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),DL=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&DL(r)}return t};function zf(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return DL(n)}function md(t,e,n){if(t instanceof ns||t instanceof z)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return z.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),md("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new wD({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?mo.fromSchema(l).parseSlice(zf(t),n.parseOptions):mo.fromSchema(l).parse(zf(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=mo.fromSchema(e);return n.slice?i.parseSlice(zf(t),n.parseOptions).content:i.parse(zf(t),n.parseOptions)}return md("",e,n)}function RQ(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof nn||s instanceof an))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(Te.near(t.doc.resolve(o),n))}var PQ=t=>!("type"in t),MQ=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=v=>{i.emit("contentError",{editor:i,error:v,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{md(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(v){l(v)}try{a=md(e,i.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:i.options.enableContentCheck})}catch(v){return l(v),!1}let{from:u,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},f=!0,m=!0;if((PQ(a)?a:[a]).forEach(v=>{v.check(),f=f?v.isText&&v.marks.length===0:!1,m=m?v.isBlock:!1}),u===h&&m){const{parent:v}=r.doc.resolve(u);v.isTextblock&&!v.type.spec.code&&!v.childCount&&(u-=1,h+=1)}let y;if(f){if(Array.isArray(e))y=e.map(v=>v.text||"").join("");else if(e instanceof z){let v="";e.forEach(w=>{w.text&&(v+=w.text)}),y=v}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,u,h)}else{y=a;const v=r.doc.resolve(u),w=v.node(),_=v.parentOffset===0,E=w.isText||w.isTextblock,N=w.content.size>0;_&&E&&N&&(u=Math.max(0,u-1)),r.replaceWith(u,h,y)}n.updateSelection&&RQ(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:y})}return!0},OQ=()=>({state:t,dispatch:e})=>i7(t,e),DQ=()=>({state:t,dispatch:e})=>o7(t,e),LQ=()=>({state:t,dispatch:e})=>FD(t,e),jQ=()=>({state:t,dispatch:e})=>UD(t,e),VQ=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ny(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},FQ=()=>({state:t,dispatch:e,tr:n})=>{try{const r=Ny(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},BQ=()=>({state:t,dispatch:e})=>r7(t,e),zQ=()=>({state:t,dispatch:e})=>s7(t,e);function LL(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function $Q(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))Ym()||LL()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}var UQ=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=$Q(t).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function Co(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?zt(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(h,f)=>{if(h.isText)return;const m=Math.max(r,f),g=Math.min(s,f+h.nodeSize);a.push({node:h,from:m,to:g})});const l=s-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>Jm(h.node.attrs,n,{strict:!1}));return i?!!c.length:c.reduce((h,f)=>h+f.to-f.from,0)>=l}var HQ=(t,e={})=>({state:n,dispatch:r})=>{const s=zt(t,n.schema);return Co(n,s,e)?a7(n,r):!1},WQ=()=>({state:t,dispatch:e})=>KD(t,e),qQ=t=>({state:e,dispatch:n})=>{const r=zt(t,e.schema);return w7(r)(e,n)},KQ=()=>({state:t,dispatch:e})=>WD(t,e);function Vy(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function AI(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}var GQ=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Vy(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(i=zt(t,r.schema)),a==="mark"&&(o=wi(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,h)=>{i&&i===u.type&&(l=!0,s&&n.setNodeMarkup(h,void 0,AI(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(f=>{o===f.type&&(l=!0,s&&n.addMark(h,h+u.nodeSize,o.create(AI(f.attrs,e))))})})}),l},QQ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),JQ=()=>({tr:t,dispatch:e})=>{if(e){const n=new fr(t.doc);t.setSelection(n)}return!0},YQ=()=>({state:t,dispatch:e})=>zD(t,e),XQ=()=>({state:t,dispatch:e})=>HD(t,e),ZQ=()=>({state:t,dispatch:e})=>h7(t,e),eJ=()=>({state:t,dispatch:e})=>p7(t,e),tJ=()=>({state:t,dispatch:e})=>f7(t,e);function Lx(t,e,n={},r={}){return md(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var nJ=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if(r.preserveWhitespace!=="full"){const c=Lx(t,s.schema,r,{errorOnInvalidContent:e??s.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??s.options.enableContentCheck})};function jL(t,e){const n=wi(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function VL(t,e){const n=new wT(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function rJ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function sJ(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function FL(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Fy(t){return e=>FL(e.$from,t)}function fe(t,e,n){return t.config[e]===void 0&&t.parent?fe(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?fe(t.parent,e,n):null}):t.config[e]}function FT(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=fe(e,"addExtensions",n);return r?[e,...FT(r())]:e}).flat(10)}function BT(t,e){const n=ll.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}function BL(t){return typeof t=="function"}function ze(t,e=void 0,...n){return BL(t)?e?t.bind(e)(...n):t(...n):t}function iJ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function zc(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function zL(t){const e=[],{nodeExtensions:n,markExtensions:r}=zc(t),s=[...n,...r],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=fe(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([f,m])=>{e.push({type:h,name:f,attribute:{...i,...m}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=fe(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const f={...i,...h};typeof(f==null?void 0:f.default)=="function"&&(f.default=f.default()),f!=null&&f.isRequired&&(f==null?void 0:f.default)===void 0&&delete f.default,e.push({type:o.name,name:u,attribute:f})})}),e}function et(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],c=a.filter(u=>!l.includes(u));r[s]=[...l,...c].join(" ")}else if(s==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[h,f]=u.split(":").map(m=>m.trim());c.set(h,f)}),a.forEach(u=>{const[h,f]=u.split(":").map(m=>m.trim());c.set(h,f)}),r[s]=Array.from(c.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else r[s]=i}),r},{})}function gd(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>et(n,r),{})}function oJ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function NI(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):oJ(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function RI(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&iJ(n)?!1:n!=null))}function PI(t){var e,n;const r={};return!((e=t==null?void 0:t.attribute)!=null&&e.isRequired)&&"default"in((t==null?void 0:t.attribute)||{})&&(r.default=t.attribute.default),((n=t==null?void 0:t.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=t.attribute.validate),[t.name,r]}function aJ(t,e){var n;const r=zL(t),{nodeExtensions:s,markExtensions:i}=zc(t),o=(n=s.find(c=>fe(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(s.map(c=>{const u=r.filter(w=>w.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((w,_)=>{const E=fe(_,"extendNodeSchema",h);return{...w,...E?E(c):{}}},{}),m=RI({...f,content:ze(fe(c,"content",h)),marks:ze(fe(c,"marks",h)),group:ze(fe(c,"group",h)),inline:ze(fe(c,"inline",h)),atom:ze(fe(c,"atom",h)),selectable:ze(fe(c,"selectable",h)),draggable:ze(fe(c,"draggable",h)),code:ze(fe(c,"code",h)),whitespace:ze(fe(c,"whitespace",h)),linebreakReplacement:ze(fe(c,"linebreakReplacement",h)),defining:ze(fe(c,"defining",h)),isolating:ze(fe(c,"isolating",h)),attrs:Object.fromEntries(u.map(PI))}),g=ze(fe(c,"parseHTML",h));g&&(m.parseDOM=g.map(w=>NI(w,u)));const y=fe(c,"renderHTML",h);y&&(m.toDOM=w=>y({node:w,HTMLAttributes:gd(w,u)}));const v=fe(c,"renderText",h);return v&&(m.toText=v),[c.name,m]})),l=Object.fromEntries(i.map(c=>{const u=r.filter(v=>v.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},f=t.reduce((v,w)=>{const _=fe(w,"extendMarkSchema",h);return{...v,..._?_(c):{}}},{}),m=RI({...f,inclusive:ze(fe(c,"inclusive",h)),excludes:ze(fe(c,"excludes",h)),group:ze(fe(c,"group",h)),spanning:ze(fe(c,"spanning",h)),code:ze(fe(c,"code",h)),attrs:Object.fromEntries(u.map(PI))}),g=ze(fe(c,"parseHTML",h));g&&(m.parseDOM=g.map(v=>NI(v,u)));const y=fe(c,"renderHTML",h);return y&&(m.toDOM=v=>y({mark:v,HTMLAttributes:gd(v,u)})),[c.name,m]}));return new wD({topNode:o,nodes:a,marks:l})}function lJ(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function Xm(t){return t.sort((n,r)=>{const s=fe(n,"priority")||100,i=fe(r,"priority")||100;return s>i?-1:s<i?1:0})}function $L(t){const e=Xm(FT(t)),n=lJ(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function UL(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,c,u,h)=>{var f;l.isBlock&&c>r&&(a+=i);const m=o==null?void 0:o[l.type.name];if(m)return u&&(a+=m({node:l,pos:c,parent:u,index:h,range:e})),!1;l.isText&&(a+=(f=l==null?void 0:l.text)==null?void 0:f.slice(Math.max(r,c)-c,s-c))}),a}function cJ(t,e){const n={from:0,to:t.content.size};return UL(t,n,e)}function HL(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function uJ(t,e){const n=zt(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function WL(t,e){const n=Vy(typeof e=="string"?e:e.name,t.schema);return n==="node"?uJ(t,e):n==="mark"?jL(t,e):{}}function hJ(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function dJ(t){const e=hJ(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function qL(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(i).map(a,-1),u=e.slice(i).map(l),h=e.invert().map(c,-1),f=e.invert().map(u);r.push({oldRange:{from:h,to:f},newRange:{from:c,to:u}})})}),dJ(r)}function zT(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=VT(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}var fJ=(t,e,n,r=20)=>{const s=t.doc.resolve(n);let i=r,o=null;for(;i>0&&o===null;){const a=s.node(i);(a==null?void 0:a.type.name)===e?o=a:i-=1}return[o,i]};function $f(t,e){return e.nodes[t]||e.marks[t]||null}function Lp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}var pJ=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)==null?void 0:c.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,r-i))}),n};function jx(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?wi(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>Jm(h.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:h,$to:f})=>{const m=h.pos,g=f.pos;t.doc.nodesBetween(m,g,(y,v)=>{if(!y.isText&&!y.marks.length)return;const w=Math.max(m,v),_=Math.min(g,v+y.nodeSize),E=_-w;o+=E,a.push(...y.marks.map(N=>({mark:N,from:w,to:_})))})}),o===0)return!1;const l=a.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>Jm(h.mark.attrs,n,{strict:!1})).reduce((h,f)=>h+f.to-f.from,0),c=a.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,f)=>h+f.to-f.from,0);return(l>0?l+c:l)>=o}function mJ(t,e,n={}){if(!e)return Co(t,null,n)||jx(t,null,n);const r=Vy(e,t.schema);return r==="node"?Co(t,e,n):r==="mark"?jx(t,e,n):!1}var gJ=(t,e)=>{const{$from:n,$to:r,$anchor:s}=t.selection;if(e){const i=Fy(a=>a.type.name===e)(t.selection);if(!i)return!1;const o=t.doc.resolve(i.pos+1);return s.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},yJ=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function MI(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function OI(t,e){const{nodeExtensions:n}=zc(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=ze(fe(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function By(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(By(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function KL(t){return t instanceof me}var GL=class QL{constructor(e){this.position=e}static fromJSON(e){return new QL(e.position)}toJSON(){return{position:this.position}}};function vJ(t,e){const n=e.mapping.mapResult(t.position);return{position:new GL(n.pos),mapResult:n}}function wJ(t){return new GL(t)}function xJ(t,e,n){var r;const{selection:s}=e;let i=null;if(ML(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!=null?r:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,h,f)=>{if(c)return!1;if(u.isInline){const m=!f||f.type.allowsMarkType(n),g=!!n.isInSet(u.marks)||!u.marks.some(y=>y.type.excludes(n));c=m&&g}return!c}),c})}var _J=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=wi(t,r.schema);if(s)if(o){const c=jL(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(f,m)=>{const g=Math.max(m,u),y=Math.min(m+f.nodeSize,h);f.marks.find(w=>w.type===l)?f.marks.forEach(w=>{l===w.type&&n.addMark(g,y,l.create({...w.attrs,...e}))}):n.addMark(g,y,l.create(e))})});return xJ(r,n,l)},bJ=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),TJ=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=zt(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>KC(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>KC(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},EJ=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=fa(t,0,r.content.size),i=me.create(r,s);e.setSelection(i)}return!0},SJ=(t,e)=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=r;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=i.from,a=i.to),s&&n.doc.nodesBetween(o,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},kJ=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=ve.atStart(r).from,a=ve.atEnd(r).to,l=fa(s,o,a),c=fa(i,o,a),u=ve.create(r,l,c);e.setSelection(u)}return!0},CJ=t=>({state:e,dispatch:n})=>{const r=zt(t,e.schema);return b7(r)(e,n)};function DI(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}var IJ=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=s.extensionManager.attributes,u=Lp(c,a.node().type.name,a.node().attrs);if(i instanceof me&&i.node.isBlock)return!a.parentOffset||!ri(o,a.pos)?!1:(r&&(t&&DI(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,f=a.depth===0?void 0:rJ(a.node(-1).contentMatchAt(a.indexAfter(-1)));let m=h&&f?[{type:f,attrs:u}]:void 0,g=ri(e.doc,e.mapping.map(a.pos),1,m);if(!m&&!g&&ri(e.doc,e.mapping.map(a.pos),1,f?[{type:f}]:void 0)&&(g=!0,m=f?[{type:f,attrs:u}]:void 0),r){if(g&&(i instanceof ve&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,m),f&&!h&&!a.parentOffset&&a.parent.type!==f)){const y=e.mapping.map(a.before()),v=e.doc.resolve(y);a.node(-1).canReplaceWith(v.index(),v.index()+1,f)&&e.setNodeMarkup(e.mapping.map(a.before()),f)}t&&DI(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return g},AJ=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=zt(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==a)return!1;const f=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let w=z.empty;const _=l.index(-1)?1:l.index(-2)?2:3;for(let T=l.depth-_;T>=l.depth-3;T-=1)w=z.from(l.node(T).copy(w));const E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,N={...Lp(f,l.node().type.name,l.node().attrs),...e},R=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(N))||void 0;w=w.append(z.from(a.createAndFill(null,R)||void 0));const O=l.before(l.depth-(_-1));n.replace(O,l.after(-E),new ne(w,4-_,0));let S=-1;n.doc.nodesBetween(O,n.doc.content.size,(T,k)=>{if(S>-1)return!1;T.isTextblock&&T.content.size===0&&(S=k+1)}),S>-1&&n.setSelection(ve.near(n.doc.resolve(S))),n.scrollIntoView()}return!0}const m=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,g={...Lp(f,h.type.name,h.attrs),...e},y={...Lp(f,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const v=m?[{type:a,attrs:g},{type:m,attrs:y}]:[{type:a,attrs:g}];if(!ri(n.doc,l.pos,2))return!1;if(s){const{selection:w,storedMarks:_}=r,{splittableMarks:E}=i.extensionManager,N=_||w.$to.parentOffset&&w.$from.marks();if(n.split(l.pos,2,v).scrollIntoView(),!N||!s)return!0;const R=N.filter(O=>E.includes(O.type.name));n.ensureMarks(R)}return!0},_0=(t,e)=>{const n=Fy(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Vo(t.doc,n.pos)&&t.join(n.pos),!0},b0=(t,e)=>{const n=Fy(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&Vo(t.doc,r)&&t.join(r),!0},NJ=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:h,splittableMarks:f}=s.extensionManager,m=zt(t,o.schema),g=zt(e,o.schema),{selection:y,storedMarks:v}=o,{$from:w,$to:_}=y,E=w.blockRange(_),N=v||y.$to.parentOffset&&y.$from.marks();if(!E)return!1;const R=Fy(O=>OI(O.type.name,h))(y);if(E.depth>=1&&R&&E.depth-R.depth<=1){if(R.node.type===m)return c.liftListItem(g);if(OI(R.node.type.name,h)&&m.validContent(R.node.content)&&a)return l().command(()=>(i.setNodeMarkup(R.pos,m),!0)).command(()=>_0(i,m)).command(()=>b0(i,m)).run()}return!n||!N||!a?l().command(()=>u().wrapInList(m,r)?!0:c.clearNodes()).wrapInList(m,r).command(()=>_0(i,m)).command(()=>b0(i,m)).run():l().command(()=>{const O=u().wrapInList(m,r),S=N.filter(T=>f.includes(T.type.name));return i.ensureMarks(S),O?!0:c.clearNodes()}).wrapInList(m,r).command(()=>_0(i,m)).command(()=>b0(i,m)).run()},RJ=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=wi(t,r.schema);return jx(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},PJ=(t,e,n={})=>({state:r,commands:s})=>{const i=zt(t,r.schema),o=zt(e,r.schema),a=Co(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},MJ=(t,e={})=>({state:n,commands:r})=>{const s=zt(t,n.schema);return Co(n,s,e)?r.lift(s):r.wrapIn(s,e)},OJ=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},DJ=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},LJ=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=wi(t,r.schema),{$from:c,empty:u,ranges:h}=a;if(!s)return!0;if(u&&o){let{from:f,to:m}=a;const g=(i=c.marks().find(v=>v.type===l))==null?void 0:i.attrs,y=VT(c,l,g);y&&(f=y.from,m=y.to),n.removeMark(f,m,l)}else h.forEach(f=>{n.removeMark(f.$from.pos,f.$to.pos,l)});return n.removeStoredMark(l),!0},jJ=t=>({tr:e,state:n,dispatch:r})=>{const{selection:s}=n;let i,o;return typeof t=="number"?(i=t,o=t):t&&"from"in t&&"to"in t?(i=t.from,o=t.to):(i=s.from,o=s.to),r&&e.doc.nodesBetween(i,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},VJ=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Vy(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(i=zt(t,r.schema)),a==="mark"&&(o=wi(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;let f,m,g,y;n.selection.empty?r.doc.nodesBetween(u,h,(v,w)=>{i&&i===v.type&&(l=!0,g=Math.max(w,u),y=Math.min(w+v.nodeSize,h),f=w,m=v)}):r.doc.nodesBetween(u,h,(v,w)=>{w<u&&i&&i===v.type&&(l=!0,g=Math.max(w,u),y=Math.min(w+v.nodeSize,h),f=w,m=v),w>=u&&w<=h&&(i&&i===v.type&&(l=!0,s&&n.setNodeMarkup(w,void 0,{...v.attrs,...e})),o&&v.marks.length&&v.marks.forEach(_=>{if(o===_.type&&(l=!0,s)){const E=Math.max(w,u),N=Math.min(w+v.nodeSize,h);n.addMark(E,N,o.create({..._.attrs,...e}))}}))}),m&&(f!==void 0&&s&&n.setNodeMarkup(f,void 0,{...m.attrs,...e}),o&&m.marks.length&&m.marks.forEach(v=>{o===v.type&&s&&n.addMark(g,y,o.create({...v.attrs,...e}))}))}),l},FJ=(t,e={})=>({state:n,dispatch:r})=>{const s=zt(t,n.schema);return m7(s,e)(n,r)},BJ=(t,e={})=>({state:n,dispatch:r})=>{const s=zt(t,n.schema);return g7(s,e)(n,r)},zJ=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},zy=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},$J=(t,e)=>{if(jT(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Uf(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(f=>f.type.spec.code))return!1;let u=!1;const h=pJ(c)+i;return o.forEach(f=>{if(u)return;const m=$J(h,f.find);if(!m)return;const g=l.state.tr,y=Ly({state:l.state,transaction:g}),v={from:r-(m[0].length-i.length),to:s},{commands:w,chain:_,can:E}=new jy({editor:n,state:y});f.handler({state:y,range:v,match:m,commands:w,chain:_,can:E})===null||!g.steps.length||(f.undoable&&g.setMeta(a,{transform:g,from:r,to:s,text:i}),l.dispatch(g),u=!0)}),u}function UJ(t){const{editor:e,rules:n}=t,r=new ht({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=BT(z.from(u),o.schema);const{from:h}=l,f=h+u.length;Uf({editor:e,from:h,to:f,text:u,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Uf({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Uf({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Uf({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function HJ(t){return Object.prototype.toString.call(t).slice(8,-1)}function Hf(t){return HJ(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function JL(t,e){const n={...t};return Hf(t)&&Hf(e)&&Object.keys(e).forEach(r=>{Hf(e[r])&&Hf(t[r])?n[r]=JL(t[r],e[r]):n[r]=e[r]}),n}var $T=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...ze(fe(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...ze(fe(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>JL(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Bo=class YL extends $T{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new YL(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function WJ(t){return typeof t=="number"}var XL=class{constructor(t){this.find=t.find,this.handler=t.handler}},qJ=(t,e,n)=>{if(jT(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function KJ(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new jy({editor:e,state:n}),h=[];return n.doc.nodesBetween(r,s,(m,g)=>{var y,v,w,_,E;if((v=(y=m.type)==null?void 0:y.spec)!=null&&v.code||!(m.isText||m.isTextblock||m.isInline))return;const N=(E=(_=(w=m.content)==null?void 0:w.size)!=null?_:m.nodeSize)!=null?E:0,R=Math.max(r,g),O=Math.min(s,g+N);if(R>=O)return;const S=m.isText?m.text||"":m.textBetween(R-g,O-g,void 0,"");qJ(S,i.find,o).forEach(k=>{if(k.index===void 0)return;const I=R+k.index+1,M=I+k[0].length,D={from:n.tr.mapping.map(I),to:n.tr.mapping.map(M)},P=i.handler({state:n,range:D,match:k,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});h.push(P)})}),h.every(m=>m!==null)}var Wf=null,GJ=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function QJ(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:h,to:f,rule:m,pasteEvt:g})=>{const y=u.tr,v=Ly({state:u,transaction:y});if(!(!KJ({editor:e,state:v,from:Math.max(h-1,0),to:f.b-1,rule:m,pasteEvent:g,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(u=>new ht({view(h){const f=g=>{var y;r=(y=h.dom.parentElement)!=null&&y.contains(g.target)?h.dom.parentElement:null,r&&(Wf=e)},m=()=>{Wf&&(Wf=null)};return window.addEventListener("dragstart",f),window.addEventListener("dragend",m),{destroy(){window.removeEventListener("dragstart",f),window.removeEventListener("dragend",m)}}},props:{handleDOMEvents:{drop:(h,f)=>{if(i=r===h.dom.parentElement,a=f,!i){const m=Wf;m!=null&&m.isEditable&&setTimeout(()=>{const g=m.state.selection;g&&m.commands.deleteRange({from:g.from,to:g.to})},10)}return!1},paste:(h,f)=>{var m;const g=(m=f.clipboardData)==null?void 0:m.getData("text/html");return o=f,s=!!(g!=null&&g.includes("data-pm-slice")),!1}}},appendTransaction:(h,f,m)=>{const g=h[0],y=g.getMeta("uiEvent")==="paste"&&!s,v=g.getMeta("uiEvent")==="drop"&&!i,w=g.getMeta("applyPasteRules"),_=!!w;if(!y&&!v&&!_)return;if(_){let{text:R}=w;typeof R=="string"?R=R:R=BT(z.from(R),m.schema);const{from:O}=w,S=O+R.length,T=GJ(R);return l({rule:u,state:m,from:O,to:{b:S},pasteEvt:T})}const E=f.doc.content.findDiffStart(m.doc.content),N=f.doc.content.findDiffEnd(m.doc.content);if(!(!WJ(E)||!N||E===N.b))return l({rule:u,state:m,from:E,to:N,pasteEvt:o})}}))}var $y=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=$L(t),this.schema=aJ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:$f(e.name,this.schema)},r=fe(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return Xm([...this.extensions].reverse()).flatMap(r=>{const s={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:$f(r.name,this.schema)},i=[],o=fe(r,"addKeyboardShortcuts",s);let a={};if(r.type==="mark"&&fe(r,"exitable",s)&&(a.ArrowRight=()=>Bo.handleExit({editor:t,mark:r})),o){const f=Object.fromEntries(Object.entries(o()).map(([m,g])=>[m,()=>g({editor:t})]));a={...a,...f}}const l=hQ(a);i.push(l);const c=fe(r,"addInputRules",s);if(MI(r,t.options.enableInputRules)&&c){const f=c();if(f&&f.length){const m=UJ({editor:t,rules:f}),g=Array.isArray(m)?m:[m];i.push(...g)}}const u=fe(r,"addPasteRules",s);if(MI(r,t.options.enablePasteRules)&&u){const f=u();if(f&&f.length){const m=QJ({editor:t,rules:f});i.push(...m)}}const h=fe(r,"addProseMirrorPlugins",s);if(h){const f=h();i.push(...f)}return i})}get attributes(){return zL(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=zc(this.extensions);return Object.fromEntries(e.filter(n=>!!fe(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),s={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:zt(n.name,this.schema)},i=fe(n,"addNodeView",s);if(!i)return[];const o=i();if(!o)return[];const a=(l,c,u,h,f)=>{const m=gd(l,r);return o({node:l,view:c,getPos:u,decorations:h,innerDecorations:f,editor:t,extension:n,HTMLAttributes:m})};return[n.name,a]}))}dispatchTransaction(t){const{editor:e}=this;return Xm([...this.extensions].reverse()).reduceRight((r,s)=>{const i={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:e,type:$f(s.name,this.schema)},o=fe(s,"dispatchTransaction",i);return o?a=>{o.call(i,{transaction:a,next:r})}:r},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=zc(this.extensions);return Object.fromEntries(e.filter(n=>!!fe(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),s={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:wi(n.name,this.schema)},i=fe(n,"addMarkView",s);if(!i)return[];const o=(a,l,c)=>{const u=gd(a,r);return i()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:h=>{cY(a,t,h)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:$f(e.name,this.schema)};e.type==="mark"&&((n=ze(fe(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const s=fe(e,"onBeforeCreate",r),i=fe(e,"onCreate",r),o=fe(e,"onUpdate",r),a=fe(e,"onSelectionUpdate",r),l=fe(e,"onTransaction",r),c=fe(e,"onFocus",r),u=fe(e,"onBlur",r),h=fe(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}};$y.resolve=$L;$y.sort=Xm;$y.flatten=FT;var JJ={};LT(JJ,{ClipboardTextSerializer:()=>ej,Commands:()=>tj,Delete:()=>nj,Drop:()=>rj,Editable:()=>sj,FocusEvents:()=>oj,Keymap:()=>aj,Paste:()=>lj,Tabindex:()=>cj,TextDirection:()=>uj,focusEventsPluginKey:()=>ij});var Je=class ZL extends $T{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new ZL(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},ej=Je.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new ht({key:new Pt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=HL(n);return UL(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),tj=Je.create({name:"commands",addCommands(){return{...RL}}}),nj=Je.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,s;const i=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=VL(t.before,[t,...e]);qL(u).forEach(m=>{u.mapping.mapResult(m.oldRange.from).deletedAfter&&u.mapping.mapResult(m.oldRange.to).deletedBefore&&u.before.nodesBetween(m.oldRange.from,m.oldRange.to,(g,y)=>{const v=y+g.nodeSize-2,w=m.oldRange.from<=y&&v<=m.oldRange.to;this.editor.emit("delete",{type:"node",node:g,from:y,to:v,newFrom:u.mapping.map(y),newTo:u.mapping.map(v),deletedRange:m.oldRange,newRange:m.newRange,partial:!w,editor:this.editor,transaction:t,combinedTransform:u})})});const f=u.mapping;u.steps.forEach((m,g)=>{var y,v;if(m instanceof Zr){const w=f.slice(g).map(m.from,-1),_=f.slice(g).map(m.to),E=f.invert().map(w,-1),N=f.invert().map(_),R=(y=u.doc.nodeAt(w-1))==null?void 0:y.marks.some(S=>S.eq(m.mark)),O=(v=u.doc.nodeAt(_))==null?void 0:v.marks.some(S=>S.eq(m.mark));this.editor.emit("delete",{type:"mark",mark:m.mark,from:m.from,to:m.to,deletedRange:{from:E,to:N},newRange:{from:w,to:_},partial:!!(O||R),editor:this.editor,transaction:t,combinedTransform:u})}})};(s=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||s?setTimeout(i,0):i()}}),rj=Je.create({name:"drop",addProseMirrorPlugins(){return[new ht({key:new Pt("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),sj=Je.create({name:"editable",addProseMirrorPlugins(){return[new ht({key:new Pt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),ij=new Pt("focusEvents"),oj=Je.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new ht({key:ij,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),aj=Je.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:f,parent:m}=h,g=h.parent.isTextblock&&f>0?a.doc.resolve(f-1):h,y=g.parent.type.spec.isolating,v=h.pos-h.parentOffset,w=y&&g.parent.childCount===1?v===h.pos:Te.atStart(c).from===f;return!u||!m.type.isTextblock||m.textContent.length||!w||w&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ym()||LL()?i:s},addProseMirrorPlugins(){return[new ht({key:new Pt("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=Te.atStart(e.doc).from,c=Te.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!By(n.doc))return;const f=n.tr,m=Ly({state:n,transaction:f}),{commands:g}=new jy({editor:this.editor,state:m});if(g.clearNodes(),!!f.steps.length)return f}})]}}),lj=Je.create({name:"paste",addProseMirrorPlugins(){return[new ht({key:new Pt("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),cj=Je.create({name:"tabindex",addProseMirrorPlugins(){return[new ht({key:new Pt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),uj=Je.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=zc(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new ht({key:new Pt("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),YJ=class Ol{constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Ol(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Ol(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Ol(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new Ol(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new Ol(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},XJ=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function ZJ(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}var eY=class extends zJ{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:r})=>{throw r},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:vJ,createMappablePosition:wJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:r,slice:s,moved:i})=>this.options.onDrop(r,s,i)),this.on("paste",({event:r,slice:s})=>this.options.onPaste(r,s)),this.on("delete",this.options.onDelete);const e=this.createDoc(),n=OL(e,this.options.autofocus);this.editorState=Jl.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t!=null&&t.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=ZJ(XJ,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const n=BL(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(s=>{const i=typeof s=="string"?`${s}$`:s.key;n=n.filter(o=>!o.key.startsWith(i))}),e.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var t,e;const r=[...this.options.enableCoreExtensions?[sj,ej.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),tj,oj,aj,cj,rj,lj,nj,uj.configure({direction:this.options.textDirection})].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new $y(r,this)}createCommandManager(){this.commandManager=new jy({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=Lx(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),t=Lx(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:n}=this.options,r=e.dispatchTransaction||this.dispatchTransaction.bind(this),s=n?this.extensionManager.dispatchTransaction(r):r;this.editorView=new NL(t,{...e,attributes:{role:"textbox",...e==null?void 0:e.attributes},dispatchTransaction:s,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.prependClass(),this.injectCSS();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:n}=this.state.applyTransaction(t),r=!this.state.selection.eq(e.selection),s=n.includes(t),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!s)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const o=n.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=o==null?void 0:o.getMeta("focus"),l=o==null?void 0:o.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),!(t.getMeta("preventUpdate")||!n.some(c=>c.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return WL(this.state,t)}isActive(t,e){const n=typeof t=="string"?t:null,r=typeof t=="string"?e:t;return mJ(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return BT(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return cJ(this.state.doc,{blockSeparator:e,textSerializers:{...HL(this.schema),...n}})}get isEmpty(){return By(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new YJ(e,this)}get $doc(){return this.$pos(0)}};function $c(t){return new zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=ze(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(zT(n.from,n.to,e.doc).filter(m=>m.mark.type.excluded.find(y=>y===t.type&&y!==m.mark.type)).filter(m=>m.to>c).length)return null;u<n.to&&i.delete(u,n.to),c>n.from&&i.delete(n.from+l,c);const f=n.from+l+o.length;i.addMark(n.from+l,f,t.type.create(s||{})),i.removeStoredMark(t.type)}},undoable:t.undoable})}function hj(t){return new zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=ze(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,o+r[0].length-1),i.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;i.insert(c,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()},undoable:t.undoable})}function Vx(t){return new zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=ze(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)},undoable:t.undoable})}function Uc(t){return new zy({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=ze(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&vT(l,t.type,i);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:h,storedMarks:f}=e,{splittableMarks:m}=t.editor.extensionManager,g=f||h.$to.parentOffset&&h.$from.marks();if(g){const y=g.filter(v=>m.includes(v.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&Vo(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var tY=t=>"touches"in t,nY=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.touches[0];if(!l)return;const c=l.clientX-this.startX,u=l.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const a=this.element.offsetWidth,l=this.element.offsetHeight;this.onCommit(a,l),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,s,i,o;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t==null?void 0:t.options)!=null&&r.directions&&(this.directions=t.options.directions),(s=t.options)!=null&&s.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(i=t.options)!=null&&i.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(o=t.options)!=null&&o.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),s=e.includes("left"),i=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),s&&(t.style.left="0"),i&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,tY(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:s}=this.calculateNewDimensions(this.activeHandle,t,e),i=this.applyConstraints(r,s,n);this.element.style.width=`${i.width}px`,this.element.style.height=`${i.height}px`,this.onResize&&this.onResize(i.width,i.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,s=this.startHeight;const i=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return i?r=this.startWidth+e:o&&(r=this.startWidth-e),a?s=this.startHeight+n:l&&(s=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(i?e:-e)),(t==="top"||t==="bottom")&&(s=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,s,t):{width:r,height:s}}applyConstraints(t,e,n){var r,s,i,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(s=this.maxSize)!=null&&s.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(i=this.maxSize)!=null&&i.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",s=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:s?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function rY(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof me){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}var sY={};LT(sY,{createAtomBlockMarkdownSpec:()=>dj,createBlockMarkdownSpec:()=>iY,createInlineMarkdownSpec:()=>lY,parseAttributes:()=>UT,parseIndentedBlocks:()=>Fx,renderNestedMarkdownContent:()=>WT,serializeAttributes:()=>HT});function UT(t){if(!(t!=null&&t.trim()))return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),s=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){const c=s.map(u=>u.trim().slice(1));e.class=c.join(" ")}const i=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var h;const f=parseInt(((h=u.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),m=n[f];m&&(e[c]=m.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function HT(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function dj(t){const{nodeName:e,name:n,parseAttributes:r=UT,serializeAttributes:s=HT,defaultAttributes:i={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const h={};return a.forEach(f=>{f in u&&(h[f]=u[f])}),h};return{parseMarkdown:(u,h)=>{const f={...i,...u.attributes};return h.createNode(e,f,[])},markdownTokenizer:{name:e,level:"block",start(u){var h;const f=new RegExp(`^:::${l}(?:\\s|$)`,"m"),m=(h=u.match(f))==null?void 0:h.index;return m!==void 0?m:-1},tokenize(u,h,f){const m=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),g=u.match(m);if(!g)return;const y=g[1]||"",v=r(y);if(!o.find(_=>!(_ in v)))return{type:e,raw:g[0],attributes:v}}},renderMarkdown:u=>{const h=c(u.attrs||{}),f=s(h),m=f?` {${f}}`:"";return`:::${l}${m} :::`}}}function iY(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=UT,serializeAttributes:i=HT,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=h=>{if(!l)return h;const f={};return l.forEach(m=>{m in h&&(f[m]=h[m])}),f};return{parseMarkdown:(h,f)=>{let m;if(r){const y=r(h);m=typeof y=="string"?[{type:"text",text:y}]:y}else a==="block"?m=f.parseChildren(h.tokens||[]):m=f.parseInline(h.tokens||[]);const g={...o,...h.attributes};return f.createNode(e,g,m)},markdownTokenizer:{name:e,level:"block",start(h){var f;const m=new RegExp(`^:::${c}`,"m"),g=(f=h.match(m))==null?void 0:f.index;return g!==void 0?g:-1},tokenize(h,f,m){var g;const y=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),v=h.match(y);if(!v)return;const[w,_=""]=v,E=s(_);let N=1;const R=w.length;let O="";const S=/^:::([\w-]*)(\s.*)?/gm,T=h.slice(R);for(S.lastIndex=0;;){const k=S.exec(T);if(k===null)break;const I=k.index,M=k[1];if(!((g=k[2])!=null&&g.endsWith(":::"))){if(M)N+=1;else if(N-=1,N===0){const D=T.slice(0,I);O=D.trim();const P=h.slice(0,R+I+k[0].length);let pe=[];if(O)if(a==="block")for(pe=m.blockTokens(D),pe.forEach(Ee=>{Ee.text&&(!Ee.tokens||Ee.tokens.length===0)&&(Ee.tokens=m.inlineTokens(Ee.text))});pe.length>0;){const Ee=pe[pe.length-1];if(Ee.type==="paragraph"&&(!Ee.text||Ee.text.trim()===""))pe.pop();else break}else pe=m.inlineTokens(O);return{type:e,raw:P,attributes:E,content:O,tokens:pe}}}}}},renderMarkdown:(h,f)=>{const m=u(h.attrs||{}),g=i(m),y=g?` {${g}}`:"",v=f.renderChildren(h.content||[],`

`);return`:::${c}${y}

${v}

:::`}}}function oY(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,s,i,o]=r;e[s]=i||o,r=n.exec(t)}return e}function aY(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function lY(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=oY,serializeAttributes:i=aY,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=f=>{if(!l)return f;const m={};return l.forEach(g=>{const y=typeof g=="string"?g:g.name,v=typeof g=="string"?void 0:g.skipIfDefault;if(y in f){const w=f[y];if(v!==void 0&&w===v)return;m[y]=w}}),m},h=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(f,m)=>{const g={...o,...f.attributes};if(a)return m.createNode(e,g);const y=r?r(f):f.content||"";return y?m.createNode(e,g,[m.createTextNode(y)]):m.createNode(e,g,[])},markdownTokenizer:{name:e,level:"inline",start(f){const m=a?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),g=f.match(m),y=g==null?void 0:g.index;return y!==void 0?y:-1},tokenize(f,m,g){const y=a?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),v=f.match(y);if(!v)return;let w="",_="";if(a){const[,N]=v;_=N}else{const[,N,R]=v;_=N,w=R||""}const E=s(_.trim());return{type:e,raw:v[0],content:w.trim(),attributes:E}}},renderMarkdown:f=>{let m="";r?m=r(f):f.content&&f.content.length>0&&(m=f.content.filter(w=>w.type==="text").map(w=>w.text).join(""));const g=u(f.attrs||{}),y=i(g),v=y?` ${y}`:"";return a?`[${c}${v}]`:`[${c}${v}]${m}[/${c}]`}}}function Fx(t,e,n){var r,s,i,o;const a=t.split(`
`),l=[];let c="",u=0;const h=e.baseIndentSize||2;for(;u<a.length;){const f=a[u],m=f.match(e.itemPattern);if(!m){if(l.length>0)break;if(f.trim()===""){u+=1,c=`${c}${f}
`;continue}else return}const g=e.extractItemData(m),{indentLevel:y,mainContent:v}=g;c=`${c}${f}
`;const w=[v];for(u+=1;u<a.length;){const R=a[u];if(R.trim()===""){const S=a.slice(u+1).findIndex(I=>I.trim()!=="");if(S===-1)break;if((((s=(r=a[u+1+S].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:s.length)||0)>y){w.push(R),c=`${c}${R}
`,u+=1;continue}else break}if((((o=(i=R.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:o.length)||0)>y)w.push(R),c=`${c}${R}
`,u+=1;else break}let _;const E=w.slice(1);if(E.length>0){const R=E.map(O=>O.slice(y+h)).join(`
`);R.trim()&&(e.customNestedParser?_=e.customNestedParser(R):_=n.blockTokens(R))}const N=e.createToken(g,_);l.push(N)}if(l.length!==0)return{items:l,raw:c}}function WT(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const s=typeof n=="function"?n(r):n,[i,...o]=t.content,a=e.renderChildren([i]),l=[`${s}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const h=u.split(`
`).map(f=>f?e.indent(f):"").join(`
`);l.push(h)}}),l.join(`
`)}function cY(t,e,n={}){const{state:r}=e,{doc:s,tr:i}=r,o=t;s.descendants((a,l)=>{const c=i.mapping.map(l),u=i.mapping.map(l)+a.nodeSize;let h=null;if(a.marks.forEach(m=>{if(m!==o)return!1;h=m}),!h)return;let f=!1;if(Object.keys(n).forEach(m=>{n[m]!==h.attrs[m]&&(f=!0)}),f){const m=t.type.create({...t.attrs,...n});i.removeMark(c,u,t.type),i.addMark(c,u,m)}}),i.docChanged&&e.view.dispatch(i)}var Gt=class fj extends $T{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new fj(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function Ya(t){return new XL({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=ze(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),h=n.from+l.indexOf(a),f=h+a.length;if(zT(n.from,n.to,e.doc).filter(g=>g.mark.type.excluded.find(v=>v===t.type&&v!==g.mark.type)).filter(g=>g.to>h).length)return null;f<n.to&&o.delete(f,n.to),h>n.from&&o.delete(n.from+u,h),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}function uY(t){return new XL({find:t.find,handler({match:e,chain:n,range:r,pasteEvent:s}){const i=ze(t.getAttributes,void 0,e,s),o=ze(t.getContent,void 0,i);if(i===!1||i===null)return null;const a={type:t.type.name,attrs:i};o&&(a.content=o),e.input&&n().deleteRange(r).insertContentAt(r.from,a)}})}const{getOwnPropertyNames:hY,getOwnPropertySymbols:dY}=Object,{hasOwnProperty:fY}=Object.prototype;function T0(t,e){return function(r,s,i){return t(r,s,i)&&e(r,s,i)}}function qf(t){return function(n,r,s){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,s);const{cache:i}=s,o=i.get(n),a=i.get(r);if(o&&a)return o===r&&a===n;i.set(n,r),i.set(r,n);const l=t(n,r,s);return i.delete(n),i.delete(r),l}}function pY(t){return t!=null?t[Symbol.toStringTag]:void 0}function LI(t){return hY(t).concat(dY(t))}const mY=Object.hasOwn||((t,e)=>fY.call(t,e));function cl(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const gY="__v",yY="__o",vY="_owner",{getOwnPropertyDescriptor:jI,keys:VI}=Object;function wY(t,e){return t.byteLength===e.byteLength&&Zm(new Uint8Array(t),new Uint8Array(e))}function xY(t,e,n){let r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function _Y(t,e){return t.byteLength===e.byteLength&&Zm(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function bY(t,e){return cl(t.getTime(),e.getTime())}function TY(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function EY(t,e){return t===e}function FI(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=t.entries();let o,a,l=0;for(;(o=i.next())&&!o.done;){const c=e.entries();let u=!1,h=0;for(;(a=c.next())&&!a.done;){if(s[h]){h++;continue}const f=o.value,m=a.value;if(n.equals(f[0],m[0],l,h,t,e,n)&&n.equals(f[1],m[1],f[0],m[0],t,e,n)){u=s[h]=!0;break}h++}if(!u)return!1;l++}return!0}const SY=cl;function kY(t,e,n){const r=VI(t);let s=r.length;if(VI(e).length!==s)return!1;for(;s-- >0;)if(!pj(t,e,n,r[s]))return!1;return!0}function Du(t,e,n){const r=LI(t);let s=r.length;if(LI(e).length!==s)return!1;let i,o,a;for(;s-- >0;)if(i=r[s],!pj(t,e,n,i)||(o=jI(t,i),a=jI(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function CY(t,e){return cl(t.valueOf(),e.valueOf())}function IY(t,e){return t.source===e.source&&t.flags===e.flags}function BI(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=t.values();let o,a;for(;(o=i.next())&&!o.done;){const l=e.values();let c=!1,u=0;for(;(a=l.next())&&!a.done;){if(!s[u]&&n.equals(o.value,a.value,o.value,a.value,t,e,n)){c=s[u]=!0;break}u++}if(!c)return!1}return!0}function Zm(t,e){let n=t.byteLength;if(e.byteLength!==n||t.byteOffset!==e.byteOffset)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function AY(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function pj(t,e,n,r){return(r===vY||r===yY||r===gY)&&(t.$$typeof||e.$$typeof)?!0:mY(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}const NY="[object ArrayBuffer]",RY="[object Arguments]",PY="[object Boolean]",MY="[object DataView]",OY="[object Date]",DY="[object Error]",LY="[object Map]",jY="[object Number]",VY="[object Object]",FY="[object RegExp]",BY="[object Set]",zY="[object String]",$Y={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},UY="[object URL]",HY=Object.prototype.toString;function WY({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:n,areDatesEqual:r,areErrorsEqual:s,areFunctionsEqual:i,areMapsEqual:o,areNumbersEqual:a,areObjectsEqual:l,arePrimitiveWrappersEqual:c,areRegExpsEqual:u,areSetsEqual:h,areTypedArraysEqual:f,areUrlsEqual:m,unknownTagComparators:g}){return function(v,w,_){if(v===w)return!0;if(v==null||w==null)return!1;const E=typeof v;if(E!==typeof w)return!1;if(E!=="object")return E==="number"?a(v,w,_):E==="function"?i(v,w,_):!1;const N=v.constructor;if(N!==w.constructor)return!1;if(N===Object)return l(v,w,_);if(Array.isArray(v))return e(v,w,_);if(N===Date)return r(v,w,_);if(N===RegExp)return u(v,w,_);if(N===Map)return o(v,w,_);if(N===Set)return h(v,w,_);const R=HY.call(v);if(R===OY)return r(v,w,_);if(R===FY)return u(v,w,_);if(R===LY)return o(v,w,_);if(R===BY)return h(v,w,_);if(R===VY)return typeof v.then!="function"&&typeof w.then!="function"&&l(v,w,_);if(R===UY)return m(v,w,_);if(R===DY)return s(v,w,_);if(R===RY)return l(v,w,_);if($Y[R])return f(v,w,_);if(R===NY)return t(v,w,_);if(R===MY)return n(v,w,_);if(R===PY||R===jY||R===zY)return c(v,w,_);if(g){let O=g[R];if(!O){const S=pY(v);S&&(O=g[S])}if(O)return O(v,w,_)}return!1}}function qY({circular:t,createCustomConfig:e,strict:n}){let r={areArrayBuffersEqual:wY,areArraysEqual:n?Du:xY,areDataViewsEqual:_Y,areDatesEqual:bY,areErrorsEqual:TY,areFunctionsEqual:EY,areMapsEqual:n?T0(FI,Du):FI,areNumbersEqual:SY,areObjectsEqual:n?Du:kY,arePrimitiveWrappersEqual:CY,areRegExpsEqual:IY,areSetsEqual:n?T0(BI,Du):BI,areTypedArraysEqual:n?T0(Zm,Du):Zm,areUrlsEqual:AY,unknownTagComparators:void 0};if(e&&(r=Object.assign({},r,e(r))),t){const s=qf(r.areArraysEqual),i=qf(r.areMapsEqual),o=qf(r.areObjectsEqual),a=qf(r.areSetsEqual);r=Object.assign({},r,{areArraysEqual:s,areMapsEqual:i,areObjectsEqual:o,areSetsEqual:a})}return r}function KY(t){return function(e,n,r,s,i,o,a){return t(e,n,a)}}function GY({circular:t,comparator:e,createState:n,equals:r,strict:s}){if(n)return function(a,l){const{cache:c=t?new WeakMap:void 0,meta:u}=n();return e(a,l,{cache:c,equals:r,meta:u,strict:s})};if(t)return function(a,l){return e(a,l,{cache:new WeakMap,equals:r,meta:void 0,strict:s})};const i={cache:void 0,equals:r,meta:void 0,strict:s};return function(a,l){return e(a,l,i)}}const QY=zo();zo({strict:!0});zo({circular:!0});zo({circular:!0,strict:!0});zo({createInternalComparator:()=>cl});zo({strict:!0,createInternalComparator:()=>cl});zo({circular:!0,createInternalComparator:()=>cl});zo({circular:!0,createInternalComparator:()=>cl,strict:!0});function zo(t={}){const{circular:e=!1,createInternalComparator:n,createState:r,strict:s=!1}=t,i=qY(t),o=WY(i),a=n?n(o):KY(o);return GY({circular:e,comparator:o,createState:r,equals:a,strict:s})}var mj={exports:{}},gj={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uy=A,JY=mT;function YY(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var XY=typeof Object.is=="function"?Object.is:YY,ZY=JY.useSyncExternalStore,eX=Uy.useRef,tX=Uy.useEffect,nX=Uy.useMemo,rX=Uy.useDebugValue;gj.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var i=eX(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=nX(function(){function l(m){if(!c){if(c=!0,u=m,m=r(m),s!==void 0&&o.hasValue){var g=o.value;if(s(g,m))return h=g}return h=m}if(g=h,XY(u,m))return g;var y=r(m);return s!==void 0&&s(g,y)?(u=m,g):(u=m,h=y)}var c=!1,u,h,f=n===void 0?null:n;return[function(){return l(e())},f===null?void 0:function(){return l(f())}]},[e,n,r,s]);var a=ZY(t,i[0],i[1]);return tX(function(){o.hasValue=!0,o.value=a},[a]),rX(a),a};mj.exports=gj;var sX=mj.exports,iX=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},oX=({contentComponent:t})=>{const e=mT.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return d.jsx(d.Fragment,{children:Object.values(e)})};function aX(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,r){e={...e,[n]:X_.createPortal(r.reactElement,r.element,n)},t.forEach(s=>s())},removeRenderer(n){const r={...e};delete r[n],e=r,t.forEach(s=>s())}}}var lX=class extends qe.Component{constructor(t){var e;super(t),this.editorContentRef=qe.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n}),e.contentComponent=aX(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const n=document.createElement("div");n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n})}catch{}}}render(){const{editor:t,innerRef:e,...n}=this.props;return d.jsxs(d.Fragment,{children:[d.jsx("div",{ref:iX(e,this.editorContentRef),...n}),(t==null?void 0:t.contentComponent)&&d.jsx(oX,{contentComponent:t.contentComponent})]})}},cX=A.forwardRef((t,e)=>{const n=qe.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return qe.createElement(lX,{key:n,innerRef:e,...t})}),uX=qe.memo(cX),hX=typeof window<"u"?A.useLayoutEffect:A.useEffect,dX=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(r=>r())},n=this.editor;return n.on("transaction",e),()=>{n.off("transaction",e)}}}};function fX(t){var e;const[n]=A.useState(()=>new dX(t.editor)),r=sX.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:QY);return hX(()=>n.watch(t.editor),[t.editor,n]),A.useDebugValue(r),r}var pX=!1,Bx=typeof window>"u",mX=Bx||!!(typeof window<"u"&&window.next),gX=class yj{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Bx||mX?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)==null?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)==null?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)==null?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)==null?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)==null?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)==null?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)==null?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)==null?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)==null?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)==null?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)==null?void 0:i.call(s,...r)},onDelete:(...r)=>{var s,i;return(i=(s=this.options.current).onDelete)==null?void 0:i.call(s,...r)}};return new eY(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=n.extensions)==null?void 0:o[i])}):e[r]===n[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?yj.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function yX(t={},e=[]){const n=A.useRef(t);n.current=t;const[r]=A.useState(()=>new gX(n)),s=mT.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return A.useDebugValue(s),A.useEffect(r.onRender(e)),fX({editor:s,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&i===0?0:i+1}),s}var vX=A.createContext({editor:null});vX.Consumer;var wX=A.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),xX=()=>A.useContext(wX);qe.forwardRef((t,e)=>{const{onDragStart:n}=xX(),r=t.as||"div";return d.jsx(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});qe.createContext({markViewContentRef:()=>{}});var eg=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},_X=/^\s*>\s$/,bX=Gt.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return eg("blockquote",{...et(this.options.HTMLAttributes,t),children:eg("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",r=[];return t.content.forEach(s=>{const a=e.renderChildren([s]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);r.push(a.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[Uc({find:_X,type:this.type})]}}),TX=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,EX=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,SX=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,kX=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,CX=Bo.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return eg("strong",{...et(this.options.HTMLAttributes,t),children:eg("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[$c({find:TX,type:this.type}),$c({find:SX,type:this.type})]},addPasteRules(){return[Ya({find:EX,type:this.type}),Ya({find:kX,type:this.type})]}}),IX=/(^|[^`])`([^`]+)`(?!`)$/,AX=/(^|[^`])`([^`]+)`(?!`)/g,NX=Bo.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",et(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[$c({find:IX,type:this.type})]},addPasteRules(){return[Ya({find:AX,type:this.type})]}}),E0=4,RX=/^```([a-z]+)?[\s\n]$/,PX=/^~~~([a-z]+)?[\s\n]$/,MX=Gt.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:E0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const i=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",et(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const s=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${s}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${s}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:E0,{state:r}=t,{selection:s}=r,{$from:i,empty:o}=s;if(i.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=s,m=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(g=>a+g).join(`
`);return l.replaceWith(c,u,r.schema.text(m)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:E0,{state:r}=t,{selection:s}=r,{$from:i,empty:o}=s;return i.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=i,u=i.start(),h=i.end(),m=r.doc.textBetween(u,h,`
`,`
`).split(`
`);let g=0,y=0;const v=c-u;for(let O=0;O<m.length;O+=1){if(y+m[O].length>=v){g=O;break}y+=m[O].length+1}const _=((l=m[g].match(/^ */))==null?void 0:l[0])||"",E=Math.min(_.length,n);if(E===0)return!0;let N=u;for(let O=0;O<g;O+=1)N+=m[O].length+1;return a.delete(N,N+E),c-N<=E&&a.setSelection(ve.create(a.doc,N)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=s,f=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(m=>{var g;const y=((g=m.match(/^ */))==null?void 0:g[0])||"",v=Math.min(y.length,n);return m.slice(v)}).join(`
`);return a.replaceWith(l,c,r.schema.text(f)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(Te.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[Vx({find:RX,type:this.type,getAttributes:t=>({language:t[1]})}),Vx({find:PX,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new ht({key:new Pt("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(ve.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),OX=Gt.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),DX=Gt.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",et(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(f=>a.includes(f.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),LX=Gt.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,et(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,s="#".repeat(r);return t.content?`${s} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Vx({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),jX=Gt.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",et(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!rY(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,s=t();return KL(n)?s.insertContentAt(r.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({state:i,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(ve.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(me.create(o.doc,l.pos)):o.setSelection(ve.create(o.doc,l.pos));else{const u=i.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,h=u==null?void 0:u.create();h&&(o.insert(c,h),o.setSelection(ve.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[hj({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),VX=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,FX=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,BX=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,zX=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,$X=Bo.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",et(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[$c({find:VX,type:this.type}),$c({find:BX,type:this.type})]},addPasteRules(){return[Ya({find:FX,type:this.type}),Ya({find:zX,type:this.type})]}});const UX="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",HX="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",zx="numeric",$x="ascii",Ux="alpha",bh="asciinumeric",Yu="alphanumeric",Hx="domain",vj="emoji",WX="scheme",qX="slashscheme",S0="whitespace";function KX(t,e){return t in e||(e[t]=[]),e[t]}function pa(t,e,n){e[zx]&&(e[bh]=!0,e[Yu]=!0),e[$x]&&(e[bh]=!0,e[Ux]=!0),e[bh]&&(e[Yu]=!0),e[Ux]&&(e[Yu]=!0),e[Yu]&&(e[Hx]=!0),e[vj]&&(e[Hx]=!0);for(const r in e){const s=KX(r,n);s.indexOf(t)<0&&s.push(t)}}function GX(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Gn(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Gn.groups={};Gn.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||Gn.groups;let s;return e&&e.j?s=e:(s=new Gn(e),n&&r&&pa(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Gn.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new Gn,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Gn,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(GX(o.t,r),n);pa(i,l,r)}else n&&pa(i,n,r);o.t=i}return s.j[t]=o,o}};const Ne=(t,e,n,r,s)=>t.ta(e,n,r,s),Ct=(t,e,n,r,s)=>t.tr(e,n,r,s),zI=(t,e,n,r,s)=>t.ts(e,n,r,s),J=(t,e,n,r,s)=>t.tt(e,n,r,s),Bs="WORD",Wx="UWORD",wj="ASCIINUMERICAL",xj="ALPHANUMERICAL",yd="LOCALHOST",qx="TLD",Kx="UTLD",jp="SCHEME",Dl="SLASH_SCHEME",qT="NUM",Gx="WS",KT="NL",Th="OPENBRACE",Eh="CLOSEBRACE",tg="OPENBRACKET",ng="CLOSEBRACKET",rg="OPENPAREN",sg="CLOSEPAREN",ig="OPENANGLEBRACKET",og="CLOSEANGLEBRACKET",ag="FULLWIDTHLEFTPAREN",lg="FULLWIDTHRIGHTPAREN",cg="LEFTCORNERBRACKET",ug="RIGHTCORNERBRACKET",hg="LEFTWHITECORNERBRACKET",dg="RIGHTWHITECORNERBRACKET",fg="FULLWIDTHLESSTHAN",pg="FULLWIDTHGREATERTHAN",mg="AMPERSAND",gg="APOSTROPHE",yg="ASTERISK",Vi="AT",vg="BACKSLASH",wg="BACKTICK",xg="CARET",Ki="COLON",GT="COMMA",_g="DOLLAR",fs="DOT",bg="EQUALS",QT="EXCLAMATION",Tr="HYPHEN",Sh="PERCENT",Tg="PIPE",Eg="PLUS",Sg="POUND",kh="QUERY",JT="QUOTE",_j="FULLWIDTHMIDDLEDOT",YT="SEMI",ps="SLASH",Ch="TILDE",kg="UNDERSCORE",bj="EMOJI",Cg="SYM";var Tj=Object.freeze({__proto__:null,ALPHANUMERICAL:xj,AMPERSAND:mg,APOSTROPHE:gg,ASCIINUMERICAL:wj,ASTERISK:yg,AT:Vi,BACKSLASH:vg,BACKTICK:wg,CARET:xg,CLOSEANGLEBRACKET:og,CLOSEBRACE:Eh,CLOSEBRACKET:ng,CLOSEPAREN:sg,COLON:Ki,COMMA:GT,DOLLAR:_g,DOT:fs,EMOJI:bj,EQUALS:bg,EXCLAMATION:QT,FULLWIDTHGREATERTHAN:pg,FULLWIDTHLEFTPAREN:ag,FULLWIDTHLESSTHAN:fg,FULLWIDTHMIDDLEDOT:_j,FULLWIDTHRIGHTPAREN:lg,HYPHEN:Tr,LEFTCORNERBRACKET:cg,LEFTWHITECORNERBRACKET:hg,LOCALHOST:yd,NL:KT,NUM:qT,OPENANGLEBRACKET:ig,OPENBRACE:Th,OPENBRACKET:tg,OPENPAREN:rg,PERCENT:Sh,PIPE:Tg,PLUS:Eg,POUND:Sg,QUERY:kh,QUOTE:JT,RIGHTCORNERBRACKET:ug,RIGHTWHITECORNERBRACKET:dg,SCHEME:jp,SEMI:YT,SLASH:ps,SLASH_SCHEME:Dl,SYM:Cg,TILDE:Ch,TLD:qx,UNDERSCORE:kg,UTLD:Kx,UWORD:Wx,WORD:Bs,WS:Gx});const Vs=/[a-z]/,Lu=new RegExp("\\p{L}","u"),k0=new RegExp("\\p{Emoji}","u"),Fs=/\d/,C0=/\s/,$I="\r",I0=`
`,QX="",JX="",A0="";let Kf=null,Gf=null;function YX(t=[]){const e={};Gn.groups=e;const n=new Gn;Kf==null&&(Kf=UI(UX)),Gf==null&&(Gf=UI(HX)),J(n,"'",gg),J(n,"{",Th),J(n,"}",Eh),J(n,"[",tg),J(n,"]",ng),J(n,"(",rg),J(n,")",sg),J(n,"<",ig),J(n,">",og),J(n,"",ag),J(n,"",lg),J(n,"",cg),J(n,"",ug),J(n,"",hg),J(n,"",dg),J(n,"",fg),J(n,"",pg),J(n,"&",mg),J(n,"*",yg),J(n,"@",Vi),J(n,"`",wg),J(n,"^",xg),J(n,":",Ki),J(n,",",GT),J(n,"$",_g),J(n,".",fs),J(n,"=",bg),J(n,"!",QT),J(n,"-",Tr),J(n,"%",Sh),J(n,"|",Tg),J(n,"+",Eg),J(n,"#",Sg),J(n,"?",kh),J(n,'"',JT),J(n,"/",ps),J(n,";",YT),J(n,"~",Ch),J(n,"_",kg),J(n,"\\",vg),J(n,"",_j);const r=Ct(n,Fs,qT,{[zx]:!0});Ct(r,Fs,r);const s=Ct(r,Vs,wj,{[bh]:!0}),i=Ct(r,Lu,xj,{[Yu]:!0}),o=Ct(n,Vs,Bs,{[$x]:!0});Ct(o,Fs,s),Ct(o,Vs,o),Ct(s,Fs,s),Ct(s,Vs,s);const a=Ct(n,Lu,Wx,{[Ux]:!0});Ct(a,Vs),Ct(a,Fs,i),Ct(a,Lu,a),Ct(i,Fs,i),Ct(i,Vs),Ct(i,Lu,i);const l=J(n,I0,KT,{[S0]:!0}),c=J(n,$I,Gx,{[S0]:!0}),u=Ct(n,C0,Gx,{[S0]:!0});J(n,A0,u),J(c,I0,l),J(c,A0,u),Ct(c,C0,u),J(u,$I),J(u,I0),Ct(u,C0,u),J(u,A0,u);const h=Ct(n,k0,bj,{[vj]:!0});J(h,"#"),Ct(h,k0,h),J(h,QX,h);const f=J(h,JX);J(f,"#"),Ct(f,k0,h);const m=[[Vs,o],[Fs,s]],g=[[Vs,null],[Lu,a],[Fs,i]];for(let y=0;y<Kf.length;y++)Pi(n,Kf[y],qx,Bs,m);for(let y=0;y<Gf.length;y++)Pi(n,Gf[y],Kx,Wx,g);pa(qx,{tld:!0,ascii:!0},e),pa(Kx,{utld:!0,alpha:!0},e),Pi(n,"file",jp,Bs,m),Pi(n,"mailto",jp,Bs,m),Pi(n,"http",Dl,Bs,m),Pi(n,"https",Dl,Bs,m),Pi(n,"ftp",Dl,Bs,m),Pi(n,"ftps",Dl,Bs,m),pa(jp,{scheme:!0,ascii:!0},e),pa(Dl,{slashscheme:!0,ascii:!0},e),t=t.sort((y,v)=>y[0]>v[0]?1:-1);for(let y=0;y<t.length;y++){const v=t[y][0],_=t[y][1]?{[WX]:!0}:{[qX]:!0};v.indexOf("-")>=0?_[Hx]=!0:Vs.test(v)?Fs.test(v)?_[bh]=!0:_[$x]=!0:_[zx]=!0,zI(n,v,v,_)}return zI(n,"localhost",yd,{ascii:!0}),n.jd=new Gn(Cg),{start:n,tokens:Object.assign({groups:e},Tj)}}function Ej(t,e){const n=XX(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,h=-1,f=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(h=0,f=0,u=a):h>=0&&(h+=n[o].length,f++),c+=n[o].length,i+=n[o].length,o++;i-=h,o-=f,c-=h,s.push({t:u.t,v:e.slice(i-c,i),s:i-c,e:i})}return s}function XX(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function Pi(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new Gn(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new Gn(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function UI(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const vd={defaultProtocol:"http",events:null,format:HI,formatHref:HI,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function XT(t,e=null){let n=Object.assign({},vd);t&&(n=Object.assign(n,t instanceof XT?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}XT.prototype={o:vd,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:vd[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function HI(t){return t}function Sj(t,e){this.t="token",this.v=t,this.tk=e}Sj.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=vd.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),h=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:s,attributes:o,content:i,eventListeners:h}}};function Hy(t,e){class n extends Sj{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const WI=Hy("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),qI=Hy("text"),ZX=Hy("nl"),Qf=Hy("url",{isLink:!0,toHref(t=vd.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==yd&&t[1].t===Ki}}),_r=t=>new Gn(t);function eZ({groups:t}){const e=t.domain.concat([mg,yg,Vi,vg,wg,xg,_g,bg,Tr,qT,Sh,Tg,Eg,Sg,ps,Cg,Ch,kg]),n=[gg,Ki,GT,fs,QT,Sh,kh,JT,YT,ig,og,Th,Eh,ng,tg,rg,sg,ag,lg,cg,ug,hg,dg,fg,pg],r=[mg,gg,yg,vg,wg,xg,_g,bg,Tr,Th,Eh,Sh,Tg,Eg,Sg,kh,ps,Cg,Ch,kg],s=_r(),i=J(s,Ch);Ne(i,r,i),Ne(i,t.domain,i);const o=_r(),a=_r(),l=_r();Ne(s,t.domain,o),Ne(s,t.scheme,a),Ne(s,t.slashscheme,l),Ne(o,r,i),Ne(o,t.domain,o);const c=J(o,Vi);J(i,Vi,c),J(a,Vi,c),J(l,Vi,c);const u=J(i,fs);Ne(u,r,i),Ne(u,t.domain,i);const h=_r();Ne(c,t.domain,h),Ne(h,t.domain,h);const f=J(h,fs);Ne(f,t.domain,h);const m=_r(WI);Ne(f,t.tld,m),Ne(f,t.utld,m),J(c,yd,m);const g=J(h,Tr);J(g,Tr,g),Ne(g,t.domain,h),Ne(m,t.domain,h),J(m,fs,f),J(m,Tr,g);const y=J(m,Ki);Ne(y,t.numeric,WI);const v=J(o,Tr),w=J(o,fs);J(v,Tr,v),Ne(v,t.domain,o),Ne(w,r,i),Ne(w,t.domain,o);const _=_r(Qf);Ne(w,t.tld,_),Ne(w,t.utld,_),Ne(_,t.domain,o),Ne(_,r,i),J(_,fs,w),J(_,Tr,v),J(_,Vi,c);const E=J(_,Ki),N=_r(Qf);Ne(E,t.numeric,N);const R=_r(Qf),O=_r();Ne(R,e,R),Ne(R,n,O),Ne(O,e,R),Ne(O,n,O),J(_,ps,R),J(N,ps,R);const S=J(a,Ki),T=J(l,Ki),k=J(T,ps),I=J(k,ps);Ne(a,t.domain,o),J(a,fs,w),J(a,Tr,v),Ne(l,t.domain,o),J(l,fs,w),J(l,Tr,v),Ne(S,t.domain,R),J(S,ps,R),J(S,kh,R),Ne(I,t.domain,R),Ne(I,e,R),J(I,ps,R);const M=[[Th,Eh],[tg,ng],[rg,sg],[ig,og],[ag,lg],[cg,ug],[hg,dg],[fg,pg]];for(let D=0;D<M.length;D++){const[P,pe]=M[D],Ee=J(R,P);J(O,P,Ee),J(Ee,pe,R);const je=_r(Qf);Ne(Ee,e,je);const oe=_r();Ne(Ee,n),Ne(je,e,je),Ne(je,n,oe),Ne(oe,e,je),Ne(oe,n,oe),J(je,pe,R),J(oe,pe,R)}return J(s,yd,_),J(s,KT,ZX),{start:s,tokens:Tj}}function tZ(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,c=null,u=0,h=null,f=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(c=l||a.go(n[s].t));)l=null,a=c,a.accepts()?(f=0,h=a):f>=0&&f++,s++,u++;if(f<0)s-=u,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(N0(qI,e,o)),o=[]),s-=f,u-=f;const m=h.t,g=n.slice(s-u,s);i.push(N0(m,e,g))}}return o.length>0&&i.push(N0(qI,e,o)),i}function N0(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const nZ=typeof console<"u"&&console&&console.warn||(()=>{}),rZ="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",lt={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function sZ(){return Gn.groups={},lt.scanner=null,lt.parser=null,lt.tokenQueue=[],lt.pluginQueue=[],lt.customSchemes=[],lt.initialized=!1,lt}function KI(t,e=!1){if(lt.initialized&&nZ(`linkifyjs: already initialized - will not register custom scheme "${t}" ${rZ}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);lt.customSchemes.push([t,e])}function iZ(){lt.scanner=YX(lt.customSchemes);for(let t=0;t<lt.tokenQueue.length;t++)lt.tokenQueue[t][1]({scanner:lt.scanner});lt.parser=eZ(lt.scanner.tokens);for(let t=0;t<lt.pluginQueue.length;t++)lt.pluginQueue[t][1]({scanner:lt.scanner,parser:lt.parser});return lt.initialized=!0,lt}function ZT(t){return lt.initialized||iZ(),tZ(lt.parser.start,t,Ej(lt.scanner.start,t))}ZT.scan=Ej;function kj(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new XT(n),s=ZT(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}var eE="[\0- -\u2029]",oZ=new RegExp(eE),aZ=new RegExp(`${eE}$`),lZ=new RegExp(eE,"g");function cZ(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function uZ(t){return new ht({key:new Pt("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),i=e.some(c=>c.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=VL(n.doc,[...e]);if(qL(a).forEach(({newRange:c})=>{const u=sJ(r.doc,c,m=>m.isTextblock);let h,f;if(u.length>1)h=u[0],f=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(u.length){const m=r.doc.textBetween(c.from,c.to," "," ");if(!aZ.test(m))return;h=u[0],f=r.doc.textBetween(h.pos,c.to,void 0," ")}if(h&&f){const m=f.split(oZ).filter(Boolean);if(m.length<=0)return!1;const g=m[m.length-1],y=h.pos+f.lastIndexOf(g);if(!g)return!1;const v=ZT(g).map(w=>w.toObject(t.defaultProtocol));if(!cZ(v))return!1;v.filter(w=>w.isLink).map(w=>({...w,from:y+w.start+1,to:y+w.end+1})).filter(w=>r.schema.marks.code?!r.doc.rangeHasMark(w.from,w.to,r.schema.marks.code):!0).filter(w=>t.validate(w.value)).filter(w=>t.shouldAutoLink(w.value)).forEach(w=>{zT(w.from,w.to,r.doc).some(_=>_.mark.type===t.type)||o.addMark(w.from,w.to,t.type.create({href:w.href}))})}}),!!o.steps.length)return o}})}function hZ(t){return new ht({key:new Pt("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0||!e.editable)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){let a=null;if(r.target instanceof HTMLAnchorElement)a=r.target;else{let h=r.target;const f=[];for(;h.nodeName!=="DIV";)f.push(h),h=h.parentNode;a=f.find(m=>m.nodeName==="A")}if(!a)return o;const l=WL(e.state,t.type.name),c=(s=a==null?void 0:a.href)!=null?s:l.href,u=(i=a==null?void 0:a.target)!=null?i:l.target;a&&c&&(window.open(c,u),o=!0)}return o}}})}function dZ(t){return new ht({key:new Pt("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:s}=t,{state:i}=e,{selection:o}=i,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=kj(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||s!==void 0&&!s(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function Ko(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(lZ,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Cj=Bo.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){KI(t);return}KI(t.scheme,t.optionalSlashes)})},onDestroy(){sZ()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Ko(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const s=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(s)||!/\./.test(s))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Ko(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Ko(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",et(this.options.HTMLAttributes,t),0]:["a",et(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Ko(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!Ko(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Ya({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=kj(t).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!Ko(o,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(uZ({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!Ko(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(hZ({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(dZ({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),fZ=Cj,pZ=Object.defineProperty,mZ=(t,e)=>{for(var n in e)pZ(t,n,{get:e[n],enumerable:!0})},gZ="listItem",GI="textStyle",QI=/^\s*([-+*])\s$/,Ij=Gt.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",et(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(gZ,this.editor.getAttributes(GI)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=Uc({find:QI,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Uc({find:QI,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(GI),editor:this.editor})),[t]}}),Aj=Gt.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",et(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(s=>s.type==="paragraph"))n=e.parseChildren(t.tokens);else{const s=t.tokens[0];if(s&&s.type==="text"&&s.tokens&&s.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(s.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>WT(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),yZ={};mZ(yZ,{findListItemPos:()=>Qd,getNextListDepth:()=>tE,handleBackspace:()=>Qx,handleDelete:()=>Jx,hasListBefore:()=>Nj,hasListItemAfter:()=>vZ,hasListItemBefore:()=>Rj,listItemHasSubList:()=>Pj,nextListIsDeeper:()=>Mj,nextListIsHigher:()=>Oj});var Qd=(t,e)=>{const{$from:n}=e.selection,r=zt(t,e.schema);let s=null,i=n.depth,o=n.pos,a=null;for(;i>0&&a===null;)s=n.node(i),s.type===r?a=i:(i-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},tE=(t,e)=>{const n=Qd(t,e);if(!n)return!1;const[,r]=fJ(e,t,n.$pos.pos+4);return r},Nj=(t,e,n)=>{const{$anchor:r}=t.selection,s=Math.max(0,r.pos-2),i=t.doc.resolve(s).node();return!(!i||!n.includes(i.type.name))},Rj=(t,e)=>{var n;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-2);return!(s.index()===0||((n=s.nodeBefore)==null?void 0:n.type.name)!==t)},Pj=(t,e,n)=>{if(!n)return!1;const r=zt(t,e.schema);let s=!1;return n.descendants(i=>{i.type===r&&(s=!0)}),s},Qx=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Co(t.state,e)&&Nj(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((f,m)=>{f.type.name===e&&c.push({node:f,pos:m})});const u=c.at(-1);if(!u)return!1;const h=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},h.end()).joinForward().run()}if(!Co(t.state,e)||!yJ(t.state))return!1;const r=Qd(e,t.state);if(!r)return!1;const i=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=Pj(e,t.state,i);return Rj(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},Mj=(t,e)=>{const n=tE(t,e),r=Qd(t,e);return!r||!n?!1:n>r.depth},Oj=(t,e)=>{const n=tE(t,e),r=Qd(t,e);return!r||!n?!1:n<r.depth},Jx=(t,e)=>{if(!Co(t.state,e)||!gJ(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:s}=n;return!n.empty&&r.sameParent(s)?!1:Mj(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():Oj(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},vZ=(t,e)=>{var n;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-r.parentOffset-2);return!(s.index()===s.parent.childCount-1||((n=s.nodeAfter)==null?void 0:n.type.name)!==t)},Dj=Je.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Jx(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&Jx(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&Qx(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&Qx(t,n,r)&&(e=!0)}),e}}}}),JI=/^(\s*)(\d+)\.\s+(.*)$/,wZ=/^\s/;function xZ(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n],i=s.match(JI);if(!i)break;const[,o,a,l]=i,c=o.length;let u=l,h=n+1;const f=[s];for(;h<t.length;){const m=t[h];if(m.match(JI))break;if(m.trim()==="")f.push(m),u+=`
`,h+=1;else if(m.match(wZ))f.push(m),u+=`
${m.slice(c+2)}`,h+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:f.join(`
`)}),r=h,n=h}return[e,r]}function Lj(t,e,n){var r;const s=[];let i=0;for(;i<t.length;){const o=t[i];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const m=n.blockTokens(u);c.push(...m)}let h=i+1;const f=[];for(;h<t.length&&t[h].indent>e;)f.push(t[h]),h+=1;if(f.length>0){const m=Math.min(...f.map(y=>y.indent)),g=Lj(f,m,n);c.push({type:"list",ordered:!0,start:f[0].number,items:g,raw:f.map(y=>y.raw).join(`
`)})}s.push({type:"list_item",raw:o.raw,tokens:c}),i=h}else i+=1}return s}function _Z(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(s=>{if(s.type==="paragraph"||s.type==="list"||s.type==="blockquote"||s.type==="code")r.push(...e.parseChildren([s]));else if(s.type==="text"&&s.tokens){const i=e.parseChildren([s]);r.push({type:"paragraph",content:i})}else{const i=e.parseChildren([s]);i.length>0&&r.push(...i)}}),{type:"listItem",content:r}})}var bZ="listItem",YI="textStyle",XI=/^(\d+)\.\s$/,jj=Gt.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",et(this.options.HTMLAttributes,n),0]:["ol",et(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?_Z(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e==null?void 0:e.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const s=t.split(`
`),[i,o]=xZ(s);if(i.length===0)return;const a=Lj(i,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=i[0])==null?void 0:r.number)||1,items:a,raw:s.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(bZ,this.editor.getAttributes(YI)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=Uc({find:XI,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=Uc({find:XI,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(YI)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),TZ=/^\s*(\[([( |x])?\])\s$/,EZ=Gt.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",et(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const s=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return WT(t,e,s)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=h=>{var f,m;a.ariaLabel=((m=(f=this.options.a11y)==null?void 0:f.checkboxLabel)==null?void 0:m.call(f,h,a.checked))||`Task item checkbox for ${h.textContent||"empty task item"}`};c(t),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",h=>h.preventDefault()),a.addEventListener("change",h=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:f}=h.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:m})=>{const g=n();if(typeof g!="number")return!1;const y=m.doc.nodeAt(g);return m.setNodeMarkup(g,void 0,{...y==null?void 0:y.attrs,checked:f}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,f)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([h,f])=>{s.setAttribute(h,f)}),s.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,i.append(a,o),s.append(i,l),Object.entries(e).forEach(([h,f])=>{s.setAttribute(h,f)});let u=new Set(Object.keys(e));return{dom:s,contentDOM:l,update:h=>{if(h.type!==this.type)return!1;s.dataset.checked=h.attrs.checked,a.checked=h.attrs.checked,c(h);const f=r.extensionManager.attributes,m=gd(h,f),g=new Set(Object.keys(m)),y=this.options.HTMLAttributes;return u.forEach(v=>{g.has(v)||(v in y?s.setAttribute(v,y[v]):s.removeAttribute(v))}),Object.entries(m).forEach(([v,w])=>{w==null?v in y?s.setAttribute(v,y[v]):s.removeAttribute(v):s.setAttribute(v,w)}),u=g,!0}}}},addInputRules(){return[Uc({find:TZ,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),SZ=Gt.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",et(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=i=>{const o=Fx(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(i)},s=Fx(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,o)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:n.inlineTokens(i.mainContent),nestedTokens:o}),customNestedParser:r},n);if(s)return{type:"taskList",raw:s.raw,items:s.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Je.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(Ij.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(Aj.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(Dj.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(jj.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(EZ.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(SZ.configure(this.options.taskList)),t}});var kZ=Gt.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",et(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),CZ=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,IZ=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,AZ=Bo.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",et(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[$c({find:CZ,type:this.type})]},addPasteRules(){return[Ya({find:IZ,type:this.type})]}}),NZ=Gt.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),RZ=Bo.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",et(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!s)return;const i=s[2].trim();return{type:"underline",raw:s[0],text:i,tokens:n.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function PZ(t={}){return new ht({view(e){return new MZ(e,t)}})}class MZ{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let h=e.nodeBefore,f=e.nodeAfter;if(h||f){let m=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(m){let g=m.getBoundingClientRect(),y=h?g.bottom:g.top;h&&f&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let v=this.width/2*a;r={left:g.left,right:g.right,top:y-v,bottom:y+v}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),f=this.width/2*o;r={left:h.left-f,right:h.left+f,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let h=l.getBoundingClientRect(),f=h.width/l.offsetWidth,m=h.height/l.offsetHeight;c=h.left-l.scrollLeft*f,u=h.top-l.scrollTop*m}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=ND(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class At extends Te{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return At.valid(r)?new At(r):Te.near(r)}content(){return ne.empty}eq(e){return e instanceof At&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new At(e.resolve(n.pos))}getBookmark(){return new nE(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!OZ(e)||!DZ(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&At.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(At.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!me.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(At.valid(a))return a}return null}}}At.prototype.visible=!1;At.findFrom=At.findGapCursorFrom;Te.jsonID("gapcursor",At);class nE{constructor(e){this.pos=e}map(e){return new nE(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return At.valid(n)?new At(n):Te.near(n)}}function Vj(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function OZ(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||Vj(s.type))return!0;if(s.inlineContent)return!1}}return!0}function DZ(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||Vj(s.type))return!0;if(s.inlineContent)return!1}}return!0}function LZ(){return new ht({props:{decorations:BZ,createSelectionBetween(t,e,n){return e.pos==n.pos&&At.valid(n)?new At(n):null},handleClick:VZ,handleKeyDown:jZ,handleDOMEvents:{beforeinput:FZ}}})}const jZ=DT({ArrowLeft:Jf("horiz",-1),ArrowRight:Jf("horiz",1),ArrowUp:Jf("vert",-1),ArrowDown:Jf("vert",1)});function Jf(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof ve){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=At.findGapCursorFrom(a,e,l);return c?(s&&s(r.tr.setSelection(new At(c))),!0):!1}}function VZ(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!At.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&me.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new At(r))),!0)}function FZ(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof At))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=z.empty;for(let o=r.length-1;o>=0;o--)s=z.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new ne(s,0,0));return i.setSelection(ve.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function BZ(t){if(!(t.selection instanceof At))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",tt.create(t.doc,[sn.widget(t.selection.head,e,{key:"gapcursor"})])}var Ig=200,ln=function(){};ln.prototype.append=function(e){return e.length?(e=ln.from(e),!this.length&&e||e.length<Ig&&this.leafAppend(e)||this.length<Ig&&e.leafPrepend(this)||this.appendInner(e)):this};ln.prototype.prepend=function(e){return e.length?ln.from(e).append(this):this};ln.prototype.appendInner=function(e){return new zZ(this,e)};ln.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?ln.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};ln.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ln.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};ln.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};ln.from=function(e){return e instanceof ln?e:e&&e.length?new Fj(e):ln.empty};var Fj=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Ig)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Ig)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(ln);ln.empty=new Fj([]);var zZ=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(ln);const $Z=500;class Qr{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,f)=>{if(!h.step){s||(s=this.remapping(r,f+1),i=s.maps.length),i--,u.push(h);return}if(s){u.push(new ms(h.map));let m=h.step.map(s.slice(i)),g;m&&o.maybeStep(m).doc&&(g=o.mapping.maps[o.mapping.maps.length-1],c.push(new ms(g,void 0,void 0,c.length+u.length))),i--,g&&s.appendMap(g,i)}else o.maybeStep(h.step);if(h.selection)return a=s?h.selection.map(s.slice(i)):h.selection,l=new Qr(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),f=new ms(e.mapping.maps[u],h,n),m;(m=l&&l.merge(f))&&(f=m,u?i.pop():a=a.slice(0,a.length-1)),i.push(f),n&&(o++,n=void 0),s||(l=f)}let c=o-r.depth;return c>HZ&&(a=UZ(a,c),o-=c),new Qr(a.append(i),o)}remapping(e,n){let r=new ud;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Qr(this.items.append(e.map(n=>new ms(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(f=>{f.selection&&a--},s);let l=n;this.items.forEach(f=>{let m=i.getMirror(--l);if(m==null)return;o=Math.min(o,m);let g=i.maps[m];if(f.step){let y=e.steps[m].invert(e.docs[m]),v=f.selection&&f.selection.map(i.slice(l+1,m));v&&a++,r.push(new ms(g,y,v))}else r.push(new ms(g))},s);let c=[];for(let f=n;f<o;f++)c.push(new ms(i.maps[f]));let u=this.items.slice(0,s).append(c).append(r),h=new Qr(u,a);return h.emptyItemCount()>$Z&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&i++;let h=new ms(c.invert(),l,u),f,m=s.length-1;(f=s.length&&s[m].merge(h))?s[m]=f:s.push(h)}}else o.map&&r--},this.items.length,0),new Qr(ln.from(s.reverse()),i)}}Qr.empty=new Qr(ln.empty,0);function UZ(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class ms{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new ms(n.getMap().invert(),n,this.selection)}}}class Fi{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const HZ=20;function WZ(t,e,n,r){let s=n.getMeta(Ia),i;if(s)return s.historyState;n.getMeta(GZ)&&(t=new Fi(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ia))return o.getMeta(Ia).redo?new Fi(t.done.addTransform(n,void 0,r,Vp(e)),t.undone,ZI(n.mapping.maps),t.prevTime,t.prevComposition):new Fi(t.done,t.undone.addTransform(n,void 0,r,Vp(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!qZ(n,t.prevRanges)),c=o?R0(t.prevRanges,n.mapping):ZI(n.mapping.maps);return new Fi(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,Vp(e)),Qr.empty,c,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new Fi(t.done.rebased(n,i),t.undone.rebased(n,i),R0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Fi(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),R0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function qZ(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function ZI(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function R0(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function KZ(t,e,n){let r=Vp(e),s=Ia.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new Fi(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Ia,{redo:n,historyState:l})}let P0=!1,eA=null;function Vp(t){let e=t.plugins;if(eA!=e){P0=!1,eA=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){P0=!0;break}}return P0}const Ia=new Pt("history"),GZ=new Pt("closeHistory");function QZ(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new ht({key:Ia,state:{init(){return new Fi(Qr.empty,Qr.empty,null,0,-1)},apply(e,n,r){return WZ(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?zj:r=="historyRedo"?$j:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function Bj(t,e){return(n,r)=>{let s=Ia.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=KZ(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const zj=Bj(!1,!0),$j=Bj(!0,!0);Je.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;if(((t==null?void 0:t.mode)||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new ht({key:new Pt("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const s=this.options.limit;if(s==null||s===0){t=!0;return}const i=this.storage.characters({node:r.doc});if(i>s){const o=i-s,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const s=this.storage.characters({node:n.doc}),i=this.storage.characters({node:e.doc});if(i<=r||s>r&&i>r&&i<=s)return!0;if(s>r&&i>r&&i>s||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=i-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var JZ=Je.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[PZ(this.options)]}});Je.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new ht({key:new Pt("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:s}=e,i=[];if(!n||!r)return tt.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";i.push(sn.node(c,c+l.nodeSize,{class:this.options.className}))}),tt.create(t,i)}}})]}});var YZ=Je.create({name:"gapCursor",addProseMirrorPlugins(){return[LZ()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=ze(fe(t,"allowGapCursor",n)))!=null?e:null}}}),XZ=Je.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new ht({key:new Pt("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&By(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const h=sn.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});s.push(h)}return this.options.includeChildren}),tt.create(t,s)}}})]}});Je.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new ht({key:new Pt("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||KL(n.selection)||t.view.dragging?null:tt.create(n.doc,[sn.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function tA({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(e==null?void 0:e.type)===t}var ZZ=Je.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Pt(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(n).includes(s.name));return[new ht({key:e,appendTransaction:(s,i,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),h=a.content.size,f=c.nodes[n];if(u)return l.insert(h,f.create())},state:{init:(s,i)=>{const o=i.tr.doc.lastChild;return!tA({node:o,types:r})},apply:(s,i)=>{if(!s.docChanged||s.getMeta("__uniqueIDTransaction"))return i;const o=s.doc.lastChild;return!tA({node:o,types:r})}}})]}}),eee=Je.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>zj(t,e),redo:()=>({state:t,dispatch:e})=>$j(t,e)}},addProseMirrorPlugins(){return[QZ(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),tee=Je.create({name:"starterKit",addExtensions(){var t,e,n,r;const s=[];return this.options.bold!==!1&&s.push(CX.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(bX.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(Ij.configure(this.options.bulletList)),this.options.code!==!1&&s.push(NX.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(MX.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(OX.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(JZ.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(YZ.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(DX.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(LX.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push(eee.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(jX.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push($X.configure(this.options.italic)),this.options.listItem!==!1&&s.push(Aj.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(Dj.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&s.push(Cj.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&s.push(jj.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(kZ.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(AZ.configure(this.options.strike)),this.options.text!==!1&&s.push(NZ.configure(this.options.text)),this.options.underline!==!1&&s.push(RZ.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&s.push(ZZ.configure((r=this.options)==null?void 0:r.trailingNode)),s}}),nee=tee,ree=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,see=Gt.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",et(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,s,i,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(s=(r=t.attrs)==null?void 0:r.alt)!=null?s:"",c=(o=(i=t.attrs)==null?void 0:i.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:s,getPos:i,HTMLAttributes:o,editor:a})=>{const l=document.createElement("img");Object.entries(o).forEach(([h,f])=>{if(f!=null)switch(h){case"width":case"height":break;default:l.setAttribute(h,f);break}}),l.src=o.src;const c=new nY({element:l,editor:a,node:s,getPos:i,onResize:(h,f)=>{l.style.width=`${h}px`,l.style.height=`${f}px`},onCommit:(h,f)=>{const m=i();m!==void 0&&this.editor.chain().setNodeSelection(m).updateAttributes(this.name,{width:h,height:f}).run()},onUpdate:(h,f,m)=>h.type===s.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[hj({find:ree,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),iee=see,oee=XZ;let Yx,Xx;if(typeof WeakMap<"u"){let t=new WeakMap;Yx=e=>t.get(e),Xx=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;Yx=r=>{for(let s=0;s<t.length;s+=2)if(t[s]==r)return t[s+1]},Xx=(r,s)=>(n==10&&(n=0),t[n++]=r,t[n++]=s)}var Rt=class{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,s=e/this.width|0;let i=r+1,o=s+1;for(let a=1;i<this.width&&this.map[e+a]==n;a++)i++;for(let a=1;o<this.height&&this.map[e+this.width*a]==n;a++)o++;return{left:r,top:s,right:i,bottom:o}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:s,top:i,bottom:o}=this.findCell(t);return e=="horiz"?(n<0?r==0:s==this.width)?null:this.map[i*this.width+(n<0?r-1:s)]:(n<0?i==0:o==this.height)?null:this.map[r+this.width*(n<0?i-1:o)]}rectBetween(t,e){const{left:n,right:r,top:s,bottom:i}=this.findCell(t),{left:o,right:a,top:l,bottom:c}=this.findCell(e);return{left:Math.min(n,o),top:Math.min(s,l),right:Math.max(r,a),bottom:Math.max(i,c)}}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let s=t.left;s<t.right;s++){const i=r*this.width+s,o=this.map[i];n[o]||(n[o]=!0,!(s==t.left&&s&&this.map[i-1]==o||r==t.top&&r&&this.map[i-this.width]==o)&&e.push(o))}return e}positionAt(t,e,n){for(let r=0,s=0;;r++){const i=s+n.child(r).nodeSize;if(r==t){let o=e+t*this.width;const a=(t+1)*this.width;for(;o<a&&this.map[o]<s;)o++;return o==a?i-1:this.map[o]}s=i}}static get(t){return Yx(t)||Xx(t,aee(t))}};function aee(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=lee(t),n=t.childCount,r=[];let s=0,i=null;const o=[];for(let c=0,u=e*n;c<u;c++)r[c]=0;for(let c=0,u=0;c<n;c++){const h=t.child(c);u++;for(let g=0;;g++){for(;s<r.length&&r[s]!=0;)s++;if(g==h.childCount)break;const y=h.child(g),{colspan:v,rowspan:w,colwidth:_}=y.attrs;for(let E=0;E<w;E++){if(E+c>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:u,n:w-E});break}const N=s+E*e;for(let R=0;R<v;R++){r[N+R]==0?r[N+R]=u:(i||(i=[])).push({type:"collision",row:c,pos:u,n:v-R});const O=_&&_[R];if(O){const S=(N+R)%e*2,T=o[S];T==null||T!=O&&o[S+1]==1?(o[S]=O,o[S+1]=1):T==O&&o[S+1]++}}}s+=v,u+=y.nodeSize}const f=(c+1)*e;let m=0;for(;s<f;)r[s++]==0&&m++;m&&(i||(i=[])).push({type:"missing",row:c,n:m}),u++}(e===0||n===0)&&(i||(i=[])).push({type:"zero_sized"});const a=new Rt(e,n,r,i);let l=!1;for(let c=0;!l&&c<o.length;c+=2)o[c]!=null&&o[c+1]<n&&(l=!0);return l&&cee(a,o,t),a}function lee(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const s=t.child(r);let i=0;if(n)for(let o=0;o<r;o++){const a=t.child(o);for(let l=0;l<a.childCount;l++){const c=a.child(l);o+c.attrs.rowspan>r&&(i+=c.attrs.colspan)}}for(let o=0;o<s.childCount;o++){const a=s.child(o);i+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=i:e!=i&&(e=Math.max(e,i))}return e}function cee(t,e,n){t.problems||(t.problems=[]);const r={};for(let s=0;s<t.map.length;s++){const i=t.map[s];if(r[i])continue;r[i]=!0;const o=n.nodeAt(i);if(!o)throw new RangeError(`No cell with offset ${i} found`);let a=null;const l=o.attrs;for(let c=0;c<l.colspan;c++){const u=e[(s+c)%t.width*2];u!=null&&(!l.colwidth||l.colwidth[c]!=u)&&((a||(a=uee(l)))[c]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}function uee(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function An(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],s=r.spec.tableRole;s&&(e[s]=r)}}return e}const Gi=new Pt("selectingCells");function Xa(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function hee(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function is(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function Wy(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=Xa(e.$head)||dee(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function dee(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function Zx(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function fee(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function rE(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function Uj(t,e,n){const r=t.node(-1),s=Rt.get(r),i=t.start(-1),o=s.nextCell(t.pos-i,e,n);return o==null?null:t.node(0).resolve(i+o)}function Za(t,e,n=1){const r={...t,colspan:t.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function Hj(t,e,n=1){const r={...t,colspan:t.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(e,0,0)}return r}function pee(t,e,n){const r=An(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[n+s*t.width]).type!=r)return!1;return!0}var rt=class zs extends Te{constructor(e,n=e){const r=e.node(-1),s=Rt.get(r),i=e.start(-1),o=s.rectBetween(e.pos-i,n.pos-i),a=e.node(0),l=s.cellsInRect(o).filter(u=>u!=n.pos-i);l.unshift(n.pos-i);const c=l.map(u=>{const h=r.nodeAt(u);if(!h)throw new RangeError(`No cell with offset ${u} found`);const f=i+u+1;return new DD(a.resolve(f),a.resolve(f+h.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const r=e.resolve(n.map(this.$anchorCell.pos)),s=e.resolve(n.map(this.$headCell.pos));if(Zx(r)&&Zx(s)&&rE(r,s)){const i=this.$anchorCell.node(-1)!=r.node(-1);return i&&this.isRowSelection()?zs.rowSelection(r,s):i&&this.isColSelection()?zs.colSelection(r,s):new zs(r,s)}return ve.between(r,s)}content(){const e=this.$anchorCell.node(-1),n=Rt.get(e),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),i={},o=[];for(let l=s.top;l<s.bottom;l++){const c=[];for(let u=l*n.width+s.left,h=s.left;h<s.right;h++,u++){const f=n.map[u];if(i[f])continue;i[f]=!0;const m=n.findCell(f);let g=e.nodeAt(f);if(!g)throw new RangeError(`No cell with offset ${f} found`);const y=s.left-m.left,v=m.right-s.right;if(y>0||v>0){let w=g.attrs;if(y>0&&(w=Za(w,0,y)),v>0&&(w=Za(w,w.colspan-v,v)),m.left<s.left){if(g=g.type.createAndFill(w),!g)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(w)}`)}else g=g.type.create(w,g.content)}if(m.top<s.top||m.bottom>s.bottom){const w={...g.attrs,rowspan:Math.min(m.bottom,s.bottom)-Math.max(m.top,s.top)};m.top<s.top?g=g.type.createAndFill(w):g=g.type.create(w,g.content)}c.push(g)}o.push(e.child(l).copy(z.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:o;return new ne(z.from(a),1,1)}replace(e,n=ne.empty){const r=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){const{$from:a,$to:l}=s[o],c=e.mapping.slice(r);e.replace(c.map(a.pos),c.map(l.pos),o?ne.empty:n)}const i=Te.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);i&&e.setSelection(i)}replaceWith(e,n){this.replace(e,new ne(z.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),r=Rt.get(n),s=this.$anchorCell.start(-1),i=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let o=0;o<i.length;o++)e(n.nodeAt(i[o]),s+i[o])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const r=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const r=e.node(-1),s=Rt.get(r),i=e.start(-1),o=s.findCell(e.pos-i),a=s.findCell(n.pos-i),l=e.node(0);return o.top<=a.top?(o.top>0&&(e=l.resolve(i+s.map[o.left])),a.bottom<s.height&&(n=l.resolve(i+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=l.resolve(i+s.map[a.left])),o.bottom<s.height&&(e=l.resolve(i+s.map[s.width*(s.height-1)+o.right-1]))),new zs(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=Rt.get(e),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),i=n.colCount(this.$headCell.pos-r);if(Math.min(s,i)>0)return!1;const o=s+this.$anchorCell.nodeAfter.attrs.colspan,a=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,a)==n.width}eq(e){return e instanceof zs&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const r=e.node(-1),s=Rt.get(r),i=e.start(-1),o=s.findCell(e.pos-i),a=s.findCell(n.pos-i),l=e.node(0);return o.left<=a.left?(o.left>0&&(e=l.resolve(i+s.map[o.top*s.width])),a.right<s.width&&(n=l.resolve(i+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=l.resolve(i+s.map[a.top*s.width])),o.right<s.width&&(e=l.resolve(i+s.map[s.width*(o.top+1)-1]))),new zs(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new zs(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new zs(e.resolve(n),e.resolve(r))}getBookmark(){return new mee(this.$anchorCell.pos,this.$headCell.pos)}};rt.prototype.visible=!1;Te.jsonID("cell",rt);var mee=class Wj{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Wj(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&rE(n,r)?new rt(n,r):Te.near(r,1)}};function gee(t){if(!(t.selection instanceof rt))return null;const e=[];return t.selection.forEachCell((n,r)=>{e.push(sn.node(r,r+n.nodeSize,{class:"selectedCell"}))}),tt.create(t.doc,e)}function yee({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,r=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,n++);for(let i=e.depth;i>=0&&!(e.before(i+1)>e.start(i));i--,r--);return n==r&&/row|table/.test(t.node(s).type.spec.tableRole)}function vee({$from:t,$to:e}){let n,r;for(let s=t.depth;s>0;s--){const i=t.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){n=i;break}}for(let s=e.depth;s>0;s--){const i=e.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){r=i;break}}return n!==r&&e.parentOffset===0}function wee(t,e,n){const r=(e||t).selection,s=(e||t).doc;let i,o;if(r instanceof me&&(o=r.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")i=rt.create(s,r.from);else if(o=="row"){const a=s.resolve(r.from+1);i=rt.rowSelection(a,a)}else if(!n){const a=Rt.get(r.node),l=r.from+1,c=l+a.map[a.width*a.height-1];i=rt.create(s,l+1,c)}}else r instanceof ve&&yee(r)?i=ve.create(s,r.from):r instanceof ve&&vee(r)&&(i=ve.create(s,r.$from.start(),r.$from.end()));return i&&(e||(e=t.tr)).setSelection(i),e}const xee=new Pt("fix-tables");function qj(t,e,n,r){const s=t.childCount,i=e.childCount;e:for(let o=0,a=0;o<i;o++){const l=e.child(o);for(let c=a,u=Math.min(s,o+3);c<u;c++)if(t.child(c)==l){a=c+1,n+=l.nodeSize;continue e}r(l,n),a<s&&t.child(a).sameMarkup(l)?qj(t.child(a),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function Kj(t,e){let n;const r=(s,i)=>{s.type.spec.tableRole=="table"&&(n=_ee(t,s,i,n))};return e?e.doc!=t.doc&&qj(e.doc,t.doc,0,r):t.doc.descendants(r),n}function _ee(t,e,n,r){const s=Rt.get(e);if(!s.problems)return r;r||(r=t.tr);const i=[];for(let l=0;l<s.height;l++)i.push(0);for(let l=0;l<s.problems.length;l++){const c=s.problems[l];if(c.type=="collision"){const u=e.nodeAt(c.pos);if(!u)continue;const h=u.attrs;for(let f=0;f<h.rowspan;f++)i[c.row+f]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,Za(h,h.colspan-c.n,c.n))}else if(c.type=="missing")i[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const u=r.mapping.map(n);r.delete(u,u+e.nodeSize)}}let o,a;for(let l=0;l<i.length;l++)i[l]&&(o==null&&(o=l),a=l);for(let l=0,c=n+1;l<s.height;l++){const u=e.child(l),h=c+u.nodeSize,f=i[l];if(f>0){let m="cell";u.firstChild&&(m=u.firstChild.type.spec.tableRole);const g=[];for(let v=0;v<f;v++){const w=An(t.schema)[m].createAndFill();w&&g.push(w)}const y=(l==0||o==l-1)&&a==l?c+1:h-1;r.insert(r.mapping.map(y),g)}c=h}return r.setMeta(xee,{fixTables:!0})}function Os(t){const e=t.selection,n=Wy(t),r=n.node(-1),s=n.start(-1),i=Rt.get(r);return{...e instanceof rt?i.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):i.findCell(n.pos-s),tableStart:s,map:i,table:r}}function Gj(t,{map:e,tableStart:n,table:r},s){let i=s>0?-1:0;pee(e,r,s+i)&&(i=s==0||s==e.width?null:0);for(let o=0;o<e.height;o++){const a=o*e.width+s;if(s>0&&s<e.width&&e.map[a-1]==e.map[a]){const l=e.map[a],c=r.nodeAt(l);t.setNodeMarkup(t.mapping.map(n+l),null,Hj(c.attrs,s-e.colCount(l))),o+=c.attrs.rowspan-1}else{const l=i==null?An(r.type.schema).cell:r.nodeAt(e.map[a+i]).type,c=e.positionAt(o,s,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function bee(t,e){if(!is(t))return!1;if(e){const n=Os(t);e(Gj(t.tr,n,n.left))}return!0}function Tee(t,e){if(!is(t))return!1;if(e){const n=Os(t);e(Gj(t.tr,n,n.right))}return!0}function Eee(t,{map:e,table:n,tableStart:r},s){const i=t.mapping.maps.length;for(let o=0;o<e.height;){const a=o*e.width+s,l=e.map[a],c=n.nodeAt(l),u=c.attrs;if(s>0&&e.map[a-1]==l||s<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(i).map(r+l),null,Za(u,s-e.colCount(l)));else{const h=t.mapping.slice(i).map(r+l);t.delete(h,h+c.nodeSize)}o+=u.rowspan}}function See(t,e){if(!is(t))return!1;if(e){const n=Os(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;Eee(r,n,s),s!=n.left;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Rt.get(i)}e(r)}return!0}function kee(t,e,n){var r;const s=An(e.type.schema).header_cell;for(let i=0;i<t.width;i++)if(((r=e.nodeAt(t.map[i+n*t.width]))===null||r===void 0?void 0:r.type)!=s)return!1;return!0}function Qj(t,{map:e,tableStart:n,table:r},s){let i=n;for(let c=0;c<s;c++)i+=r.child(c).nodeSize;const o=[];let a=s>0?-1:0;kee(e,r,s+a)&&(a=s==0||s==e.height?null:0);for(let c=0,u=e.width*s;c<e.width;c++,u++)if(s>0&&s<e.height&&e.map[u]==e.map[u-e.width]){const h=e.map[u],f=r.nodeAt(h).attrs;t.setNodeMarkup(n+h,null,{...f,rowspan:f.rowspan+1}),c+=f.colspan-1}else{var l;const h=a==null?An(r.type.schema).cell:(l=r.nodeAt(e.map[u+a*e.width]))===null||l===void 0?void 0:l.type,f=h==null?void 0:h.createAndFill();f&&o.push(f)}return t.insert(i,An(r.type.schema).row.create(null,o)),t}function Cee(t,e){if(!is(t))return!1;if(e){const n=Os(t);e(Qj(t.tr,n,n.top))}return!0}function Iee(t,e){if(!is(t))return!1;if(e){const n=Os(t);e(Qj(t.tr,n,n.bottom))}return!0}function Aee(t,{map:e,table:n,tableStart:r},s){let i=0;for(let c=0;c<s;c++)i+=n.child(c).nodeSize;const o=i+n.child(s).nodeSize,a=t.mapping.maps.length;t.delete(i+r,o+r);const l=new Set;for(let c=0,u=s*e.width;c<e.width;c++,u++){const h=e.map[u];if(!l.has(h)){if(l.add(h),s>0&&h==e.map[u-e.width]){const f=n.nodeAt(h).attrs;t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,{...f,rowspan:f.rowspan-1}),c+=f.colspan-1}else if(s<e.height&&h==e.map[u+e.width]){const f=n.nodeAt(h),m=f.attrs,g=f.type.create({...m,rowspan:f.attrs.rowspan-1},f.content),y=e.positionAt(s+1,c,n);t.insert(t.mapping.slice(a).map(r+y),g),c+=m.colspan-1}}}}function Nee(t,e){if(!is(t))return!1;if(e){const n=Os(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;Aee(r,n,s),s!=n.top;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Rt.get(n.table)}e(r)}return!0}function nA(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function Ree({width:t,height:e,map:n},r){let s=r.top*t+r.left,i=s,o=(r.bottom-1)*t+r.left,a=s+(r.right-r.left-1);for(let l=r.top;l<r.bottom;l++){if(r.left>0&&n[i]==n[i-1]||r.right<t&&n[a]==n[a+1])return!0;i+=t,a+=t}for(let l=r.left;l<r.right;l++){if(r.top>0&&n[s]==n[s-t]||r.bottom<e&&n[o]==n[o+t])return!0;s++,o++}return!1}function rA(t,e){const n=t.selection;if(!(n instanceof rt)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=Os(t),{map:s}=r;if(Ree(s,r))return!1;if(e){const i=t.tr,o={};let a=z.empty,l,c;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){const f=s.map[u*s.width+h],m=r.table.nodeAt(f);if(!(o[f]||!m))if(o[f]=!0,l==null)l=f,c=m;else{nA(m)||(a=a.append(m.content));const g=i.mapping.map(f+r.tableStart);i.delete(g,g+m.nodeSize)}}if(l==null||c==null)return!0;if(i.setNodeMarkup(l+r.tableStart,null,{...Hj(c.attrs,c.attrs.colspan,r.right-r.left-c.attrs.colspan),rowspan:r.bottom-r.top}),a.size>0){const u=l+1+c.content.size,h=nA(c)?l+1:u;i.replaceWith(h+r.tableStart,u+r.tableStart,a)}i.setSelection(new rt(i.doc.resolve(l+r.tableStart))),e(i)}return!0}function sA(t,e){const n=An(t.schema);return Pee(({node:r})=>n[r.type.spec.tableRole])(t,e)}function Pee(t){return(e,n)=>{const r=e.selection;let s,i;if(r instanceof rt){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,i=r.$anchorCell.pos}else{var o;if(s=hee(r.$from),!s)return!1;i=(o=Xa(r.$from))===null||o===void 0?void 0:o.pos}if(s==null||i==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let a=s.attrs;const l=[],c=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const u=Os(e),h=e.tr;for(let m=0;m<u.right-u.left;m++)l.push(c?{...a,colwidth:c&&c[m]?[c[m]]:null}:a);let f;for(let m=u.top;m<u.bottom;m++){let g=u.map.positionAt(m,u.left,u.table);m==u.top&&(g+=s.nodeSize);for(let y=u.left,v=0;y<u.right;y++,v++)y==u.left&&m==u.top||h.insert(f=h.mapping.map(g+u.tableStart,1),t({node:s,row:m,col:y}).createAndFill(l[v]))}h.setNodeMarkup(i,t({node:s,row:u.top,col:u.left}),l[0]),r instanceof rt&&h.setSelection(new rt(h.doc.resolve(r.$anchorCell.pos),f?h.doc.resolve(f):void 0)),n(h)}return!0}}function Mee(t,e){return function(n,r){if(!is(n))return!1;const s=Wy(n);if(s.nodeAfter.attrs[t]===e)return!1;if(r){const i=n.tr;n.selection instanceof rt?n.selection.forEachCell((o,a)=>{o.attrs[t]!==e&&i.setNodeMarkup(a,null,{...o.attrs,[t]:e})}):i.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),r(i)}return!0}}function Oee(t){return function(e,n){if(!is(e))return!1;if(n){const r=An(e.schema),s=Os(e),i=e.tr,o=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=o.map(l=>s.table.nodeAt(l));for(let l=0;l<o.length;l++)a[l].type==r.header_cell&&i.setNodeMarkup(s.tableStart+o[l],r.cell,a[l].attrs);if(i.steps.length===0)for(let l=0;l<o.length;l++)i.setNodeMarkup(s.tableStart+o[l],r.header_cell,a[l].attrs);n(i)}return!0}}function iA(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<r.length;s++){const i=e.table.nodeAt(r[s]);if(i&&i.type!==n.header_cell)return!1}return!0}function wd(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?Oee(t):function(n,r){if(!is(n))return!1;if(r){const s=An(n.schema),i=Os(n),o=n.tr,a=iA("row",i,s),l=iA("column",i,s),c=(t==="column"?a:t==="row"&&l)?1:0,u=t=="column"?{left:0,top:c,right:1,bottom:i.map.height}:t=="row"?{left:c,top:0,right:i.map.width,bottom:1}:i,h=t=="column"?l?s.cell:s.header_cell:t=="row"?a?s.cell:s.header_cell:s.cell;i.map.cellsInRect(u).forEach(f=>{const m=f+i.tableStart,g=o.doc.nodeAt(m);g&&o.setNodeMarkup(m,h,g.attrs)}),r(o)}return!0}}wd("row",{useDeprecatedLogic:!0});wd("column",{useDeprecatedLogic:!0});const Dee=wd("cell",{useDeprecatedLogic:!0});function Lee(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,s=t.before();r>=0;r--){const i=t.node(-1).child(r),o=i.lastChild;if(o)return s-1-o.nodeSize;s-=i.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let r=t.indexAfter(-1),s=t.after();r<n.childCount;r++){const i=n.child(r);if(i.childCount)return s+1;s+=i.nodeSize}}return null}function oA(t){return function(e,n){if(!is(e))return!1;const r=Lee(Wy(e),t);if(r==null)return!1;if(n){const s=e.doc.resolve(r);n(e.tr.setSelection(ve.between(s,fee(s))).scrollIntoView())}return!0}}function jee(t,e){const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function Yf(t,e){const n=t.selection;if(!(n instanceof rt))return!1;if(e){const r=t.tr,s=An(t.schema).cell.createAndFill().content;n.forEachCell((i,o)=>{i.content.eq(s)||r.replace(r.mapping.map(o+1),r.mapping.map(o+i.nodeSize-1),new ne(s,0,0))}),r.docChanged&&e(r)}return!0}function Vee(t){if(t.size===0)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.child(0).type.spec.tableRole=="table");)n--,r--,e=e.child(0).content;const s=e.child(0),i=s.type.spec.tableRole,o=s.type.schema,a=[];if(i=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content;const u=l?0:Math.max(0,n-1),h=l<e.childCount-1?0:Math.max(0,r-1);(u||h)&&(c=e_(An(o).row,new ne(c,u,h)).content),a.push(c)}else if(i=="cell"||i=="header_cell")a.push(n||r?e_(An(o).row,new ne(e,n,r)).content:e);else return null;return Fee(o,a)}function Fee(t,e){const n=[];for(let s=0;s<e.length;s++){const i=e[s];for(let o=i.childCount-1;o>=0;o--){const{rowspan:a,colspan:l}=i.child(o).attrs;for(let c=s;c<s+a;c++)n[c]=(n[c]||0)+l}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=e.length&&e.push(z.empty),n[s]<r){const i=An(t).cell.createAndFill(),o=[];for(let a=n[s];a<r;a++)o.push(i);e[s]=e[s].append(z.from(o))}return{height:e.length,width:r,rows:e}}function e_(t,e){const n=t.createAndFill();return new wT(n).replace(0,n.content.size,e).doc}function Bee({width:t,height:e,rows:n},r,s){if(t!=r){const i=[],o=[];for(let a=0;a<n.length;a++){const l=n[a],c=[];for(let u=i[a]||0,h=0;u<r;h++){let f=l.child(h%l.childCount);u+f.attrs.colspan>r&&(f=f.type.createChecked(Za(f.attrs,f.attrs.colspan,u+f.attrs.colspan-r),f.content)),c.push(f),u+=f.attrs.colspan;for(let m=1;m<f.attrs.rowspan;m++)i[a+m]=(i[a+m]||0)+f.attrs.colspan}o.push(z.from(c))}n=o,t=r}if(e!=s){const i=[];for(let o=0,a=0;o<s;o++,a++){const l=[],c=n[a%e];for(let u=0;u<c.childCount;u++){let h=c.child(u);o+h.attrs.rowspan>s&&(h=h.type.create({...h.attrs,rowspan:Math.max(1,s-h.attrs.rowspan)},h.content)),l.push(h)}i.push(z.from(l))}n=i,e=s}return{width:t,height:e,rows:n}}function zee(t,e,n,r,s,i,o){const a=t.doc.type.schema,l=An(a);let c,u;if(s>e.width)for(let h=0,f=0;h<e.height;h++){const m=n.child(h);f+=m.nodeSize;const g=[];let y;m.lastChild==null||m.lastChild.type==l.cell?y=c||(c=l.cell.createAndFill()):y=u||(u=l.header_cell.createAndFill());for(let v=e.width;v<s;v++)g.push(y);t.insert(t.mapping.slice(o).map(f-1+r),g)}if(i>e.height){const h=[];for(let g=0,y=(e.height-1)*e.width;g<Math.max(e.width,s);g++){const v=g>=e.width?!1:n.nodeAt(e.map[y+g]).type==l.header_cell;h.push(v?u||(u=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}const f=l.row.create(null,z.from(h)),m=[];for(let g=e.height;g<i;g++)m.push(f);t.insert(t.mapping.slice(o).map(r+n.nodeSize-2),m)}return!!(c||u)}function aA(t,e,n,r,s,i,o,a){if(o==0||o==e.height)return!1;let l=!1;for(let c=s;c<i;c++){const u=o*e.width+c,h=e.map[u];if(e.map[u-e.width]==h){l=!0;const f=n.nodeAt(h),{top:m,left:g}=e.findCell(h);t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,{...f.attrs,rowspan:o-m}),t.insert(t.mapping.slice(a).map(e.positionAt(o,g,n)),f.type.createAndFill({...f.attrs,rowspan:m+f.attrs.rowspan-o})),c+=f.attrs.colspan-1}}return l}function lA(t,e,n,r,s,i,o,a){if(o==0||o==e.width)return!1;let l=!1;for(let c=s;c<i;c++){const u=c*e.width+o,h=e.map[u];if(e.map[u-1]==h){l=!0;const f=n.nodeAt(h),m=e.colCount(h),g=t.mapping.slice(a).map(h+r);t.setNodeMarkup(g,null,Za(f.attrs,o-m,f.attrs.colspan-(o-m))),t.insert(g+f.nodeSize,f.type.createAndFill(Za(f.attrs,0,o-m))),c+=f.attrs.rowspan-1}}return l}function cA(t,e,n,r,s){let i=n?t.doc.nodeAt(n-1):t.doc;if(!i)throw new Error("No table found");let o=Rt.get(i);const{top:a,left:l}=r,c=l+s.width,u=a+s.height,h=t.tr;let f=0;function m(){if(i=n?h.doc.nodeAt(n-1):h.doc,!i)throw new Error("No table found");o=Rt.get(i),f=h.mapping.maps.length}zee(h,o,i,n,c,u,f)&&m(),aA(h,o,i,n,l,c,a,f)&&m(),aA(h,o,i,n,l,c,u,f)&&m(),lA(h,o,i,n,a,u,l,f)&&m(),lA(h,o,i,n,a,u,c,f)&&m();for(let g=a;g<u;g++){const y=o.positionAt(g,l,i),v=o.positionAt(g,c,i);h.replace(h.mapping.slice(f).map(y+n),h.mapping.slice(f).map(v+n),new ne(s.rows[g-a],0,0))}m(),h.setSelection(new rt(h.doc.resolve(n+o.positionAt(a,l,i)),h.doc.resolve(n+o.positionAt(u-1,c-1,i)))),e(h)}const $ee=DT({ArrowLeft:Xf("horiz",-1),ArrowRight:Xf("horiz",1),ArrowUp:Xf("vert",-1),ArrowDown:Xf("vert",1),"Shift-ArrowLeft":Zf("horiz",-1),"Shift-ArrowRight":Zf("horiz",1),"Shift-ArrowUp":Zf("vert",-1),"Shift-ArrowDown":Zf("vert",1),Backspace:Yf,"Mod-Backspace":Yf,Delete:Yf,"Mod-Delete":Yf});function Fp(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function Xf(t,e){return(n,r,s)=>{if(!s)return!1;const i=n.selection;if(i instanceof rt)return Fp(n,r,Te.near(i.$headCell,e));if(t!="horiz"&&!i.empty)return!1;const o=Jj(s,t,e);if(o==null)return!1;if(t=="horiz")return Fp(n,r,Te.near(n.doc.resolve(i.head+e),e));{const a=n.doc.resolve(o),l=Uj(a,t,e);let c;return l?c=Te.near(l,1):e<0?c=Te.near(n.doc.resolve(a.before(-1)),-1):c=Te.near(n.doc.resolve(a.after(-1)),1),Fp(n,r,c)}}}function Zf(t,e){return(n,r,s)=>{if(!s)return!1;const i=n.selection;let o;if(i instanceof rt)o=i;else{const l=Jj(s,t,e);if(l==null)return!1;o=new rt(n.doc.resolve(l))}const a=Uj(o.$headCell,t,e);return a?Fp(n,r,new rt(o.$anchorCell,a)):!1}}function Uee(t,e){const n=t.state.doc,r=Xa(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new rt(r))),!0):!1}function Hee(t,e,n){if(!is(t.state))return!1;let r=Vee(n);const s=t.state.selection;if(s instanceof rt){r||(r={width:1,height:1,rows:[z.from(e_(An(t.state.schema).cell,n))]});const i=s.$anchorCell.node(-1),o=s.$anchorCell.start(-1),a=Rt.get(i).rectBetween(s.$anchorCell.pos-o,s.$headCell.pos-o);return r=Bee(r,a.right-a.left,a.bottom-a.top),cA(t.state,t.dispatch,o,a,r),!0}else if(r){const i=Wy(t.state),o=i.start(-1);return cA(t.state,t.dispatch,o,Rt.get(i.node(-1)).findCell(i.pos-o),r),!0}else return!1}function Wee(t,e){var n;if(e.button!=0||e.ctrlKey||e.metaKey)return;const r=uA(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof rt)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&(s=Xa(t.state.selection.$anchor))!=null&&((n=M0(t,e))===null||n===void 0?void 0:n.pos)!=s.pos)i(s,e),e.preventDefault();else if(!r)return;function i(l,c){let u=M0(t,c);const h=Gi.getState(t.state)==null;if(!u||!rE(l,u))if(h)u=l;else return;const f=new rt(l,u);if(h||!t.state.selection.eq(f)){const m=t.state.tr.setSelection(f);h&&m.setMeta(Gi,l.pos),t.dispatch(m)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",a),Gi.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Gi,-1))}function a(l){const c=l,u=Gi.getState(t.state);let h;if(u!=null)h=t.state.doc.resolve(u);else if(uA(t,c.target)!=r&&(h=M0(t,e),!h))return o();h&&i(h,c)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",a)}function Jj(t,e,n){if(!(t.state.selection instanceof ve))return null;const{$head:r}=t.state.selection;for(let s=r.depth-1;s>=0;s--){const i=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:i.childCount))return null;if(i.type.spec.tableRole=="cell"||i.type.spec.tableRole=="header_cell"){const o=r.before(s),a=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?o:null}}return null}function uA(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function M0(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return null;let{inside:r,pos:s}=n;return r>=0&&Xa(t.state.doc.resolve(r))||Xa(t.state.doc.resolve(s))}var qee=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),t_(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,t_(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function t_(t,e,n,r,s,i){let o=0,a=!0,l=e.firstChild;const c=t.firstChild;if(c){for(let h=0,f=0;h<c.childCount;h++){const{colspan:m,colwidth:g}=c.child(h).attrs;for(let y=0;y<m;y++,f++){const v=s==f?i:g&&g[y],w=v?v+"px":"";if(o+=v||r,v||(a=!1),l)l.style.width!=w&&(l.style.width=w),l=l.nextSibling;else{const _=document.createElement("col");_.style.width=w,e.appendChild(_)}}}for(;l;){var u;const h=l.nextSibling;(u=l.parentNode)===null||u===void 0||u.removeChild(l),l=h}a?(n.style.width=o+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=o+"px")}}const lr=new Pt("tableColumnResizing");function Kee({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:r=qee,lastColumnResizable:s=!0}={}){const i=new ht({key:lr,state:{init(o,a){var l;const c=(l=i.spec)===null||l===void 0||(l=l.props)===null||l===void 0?void 0:l.nodeViews,u=An(a.schema).table.name;return r&&c&&(c[u]=(h,f)=>new r(h,n,f)),new Gee(-1,!1)},apply(o,a){return a.apply(o)}},props:{attributes:o=>{const a=lr.getState(o);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,a)=>{Qee(o,a,t,s)},mouseleave:o=>{Jee(o)},mousedown:(o,a)=>{Yee(o,a,e,n)}},decorations:o=>{const a=lr.getState(o);if(a&&a.activeHandle>-1)return nte(o,a.activeHandle)},nodeViews:{}}});return i}var Gee=class Bp{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,r=e.getMeta(lr);if(r&&r.setHandle!=null)return new Bp(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new Bp(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let s=e.mapping.map(n.activeHandle,-1);return Zx(e.doc.resolve(s))||(s=-1),new Bp(s,n.dragging)}return n}};function Qee(t,e,n,r){if(!t.editable)return;const s=lr.getState(t.state);if(s&&!s.dragging){const i=Zee(e.target);let o=-1;if(i){const{left:a,right:l}=i.getBoundingClientRect();e.clientX-a<=n?o=hA(t,e,"left",n):l-e.clientX<=n&&(o=hA(t,e,"right",n))}if(o!=s.activeHandle){if(!r&&o!==-1){const a=t.state.doc.resolve(o),l=a.node(-1),c=Rt.get(l),u=a.start(-1);if(c.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==c.width-1)return}Yj(t,o)}}}function Jee(t){if(!t.editable)return;const e=lr.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&Yj(t,-1)}function Yee(t,e,n,r){var s;if(!t.editable)return!1;const i=(s=t.dom.ownerDocument.defaultView)!==null&&s!==void 0?s:window,o=lr.getState(t.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const a=t.state.doc.nodeAt(o.activeHandle),l=Xee(t,o.activeHandle,a.attrs);t.dispatch(t.state.tr.setMeta(lr,{setDragging:{startX:e.clientX,startWidth:l}}));function c(h){i.removeEventListener("mouseup",c),i.removeEventListener("mousemove",u);const f=lr.getState(t.state);f!=null&&f.dragging&&(ete(t,f.activeHandle,dA(f.dragging,h,n)),t.dispatch(t.state.tr.setMeta(lr,{setDragging:null})))}function u(h){if(!h.which)return c(h);const f=lr.getState(t.state);if(f&&f.dragging){const m=dA(f.dragging,h,n);fA(t,f.activeHandle,m,r)}}return fA(t,o.activeHandle,l,r),i.addEventListener("mouseup",c),i.addEventListener("mousemove",u),e.preventDefault(),!0}function Xee(t,e,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const i=t.domAtPos(e);let o=i.node.childNodes[i.offset].offsetWidth,a=n;if(r)for(let l=0;l<n;l++)r[l]&&(o-=r[l],a--);return o/a}function Zee(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function hA(t,e,n,r){const s=n=="right"?-r:r,i=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!i)return-1;const{pos:o}=i,a=Xa(t.state.doc.resolve(o));if(!a)return-1;if(n=="right")return a.pos;const l=Rt.get(a.node(-1)),c=a.start(-1),u=l.map.indexOf(a.pos-c);return u%l.width==0?-1:c+l.map[u-1]}function dA(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function Yj(t,e){t.dispatch(t.state.tr.setMeta(lr,{setHandle:e}))}function ete(t,e,n){const r=t.state.doc.resolve(e),s=r.node(-1),i=Rt.get(s),o=r.start(-1),a=i.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<i.height;c++){const u=c*i.width+a;if(c&&i.map[u]==i.map[u-i.width])continue;const h=i.map[u],f=s.nodeAt(h).attrs,m=f.colspan==1?0:a-i.colCount(h);if(f.colwidth&&f.colwidth[m]==n)continue;const g=f.colwidth?f.colwidth.slice():tte(f.colspan);g[m]=n,l.setNodeMarkup(o+h,null,{...f,colwidth:g})}l.docChanged&&t.dispatch(l)}function fA(t,e,n,r){const s=t.state.doc.resolve(e),i=s.node(-1),o=s.start(-1),a=Rt.get(i).colCount(s.pos-o)+s.nodeAfter.attrs.colspan-1;let l=t.domAtPos(s.start(-1)).node;for(;l&&l.nodeName!="TABLE";)l=l.parentNode;l&&t_(i,l.firstChild,l,r,a,n)}function tte(t){return Array(t).fill(0)}function nte(t,e){const n=[],r=t.doc.resolve(e),s=r.node(-1);if(!s)return tt.empty;const i=Rt.get(s),o=r.start(-1),a=i.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1;for(let c=0;c<i.height;c++){const u=a+c*i.width;if((a==i.width-1||i.map[u]!=i.map[u+1])&&(c==0||i.map[u]!=i.map[u-i.width])){var l;const h=i.map[u],f=o+h+s.nodeAt(h).nodeSize-1,m=document.createElement("div");m.className="column-resize-handle",!((l=lr.getState(t))===null||l===void 0)&&l.dragging&&n.push(sn.node(o+h,o+h+s.nodeAt(h).nodeSize,{class:"column-resize-dragging"})),n.push(sn.widget(f,m))}}return tt.create(t.doc,n)}function rte({allowTableNodeSelection:t=!1}={}){return new ht({key:Gi,state:{init(){return null},apply(e,n){const r=e.getMeta(Gi);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;const{deleted:s,pos:i}=e.mapping.mapResult(n);return s?null:i}},props:{decorations:gee,handleDOMEvents:{mousedown:Wee},createSelectionBetween(e){return Gi.getState(e.state)!=null?e.state.selection:null},handleTripleClick:Uee,handleKeyDown:$ee,handlePaste:Hee},appendTransaction(e,n,r){return wee(r,Kj(r,n),t)}})}var Xj=Gt.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const r=t.getAttribute("colwidth"),s=r?r.split(",").map(i=>parseInt(i,10)):null;if(!s){const i=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),o=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(o&&o>-1&&i&&i[o]){const a=i[o].getAttribute("width");return a?[parseInt(a,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",et(this.options.HTMLAttributes,t),0]}}),Zj=Gt.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",et(this.options.HTMLAttributes,t),0]}}),eV=Gt.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",et(this.options.HTMLAttributes,t),0]}});function n_(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function pA(t,e,n,r,s,i){var o;let a=0,l=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let f=0,m=0;f<u.childCount;f+=1){const{colspan:g,colwidth:y}=u.child(f).attrs;for(let v=0;v<g;v+=1,m+=1){const w=s===m?i:y&&y[v],_=w?`${w}px`:"";if(a+=w||r,w||(l=!1),c){if(c.style.width!==_){const[E,N]=n_(r,w);c.style.setProperty(E,N)}c=c.nextSibling}else{const E=document.createElement("col"),[N,R]=n_(r,w);E.style.setProperty(N,R),e.appendChild(E)}}}for(;c;){const f=c.nextSibling;(o=c.parentNode)==null||o.removeChild(c),c=f}const h=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);l&&!h?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var ste=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),pA(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,pA(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),r=this.contentDOM.contains(e);return!!(n&&!r&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function ite(t,e,n,r){let s=0,i=!0;const o=[],a=t.firstChild;if(!a)return{};for(let h=0,f=0;h<a.childCount;h+=1){const{colspan:m,colwidth:g}=a.child(h).attrs;for(let y=0;y<m;y+=1,f+=1){const v=n===f?r:g&&g[y];s+=v||e,v||(i=!1);const[w,_]=n_(e,v);o.push(["col",{style:`${w}: ${_}`}])}}const l=i?`${s}px`:"",c=i?"":`${s}px`;return{colgroup:["colgroup",{},...o],tableWidth:l,tableMinWidth:c}}function mA(t,e){return t.createAndFill()}function ote(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function ate(t,e,n,r,s){const i=ote(t),o=[],a=[];for(let c=0;c<n;c+=1){const u=mA(i.cell);if(u&&a.push(u),r){const h=mA(i.header_cell);h&&o.push(h)}}const l=[];for(let c=0;c<e;c+=1)l.push(i.row.createChecked(null,r&&c===0?o:a));return i.table.createChecked(null,l)}function lte(t){return t instanceof rt}var ep=({editor:t})=>{const{selection:e}=t.state;if(!lte(e))return!1;let n=0;const r=FL(e.ranges[0].$from,i=>i.type.name==="table");return r==null||r.node.descendants(i=>{if(i.type.name==="table")return!1;["tableCell","tableHeader"].includes(i.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},cte="";function ute(t){return(t||"").replace(/\s+/g," ").trim()}function hte(t,e,n={}){var r;const s=(r=n.cellLineSeparator)!=null?r:cte;if(!t||!t.content||t.content.length===0)return"";const i=[];t.content.forEach(g=>{const y=[];g.content&&g.content.forEach(v=>{let w="";v.content&&Array.isArray(v.content)&&v.content.length>1?w=v.content.map(R=>e.renderChildren(R)).join(s):w=v.content?e.renderChildren(v.content):"";const _=ute(w),E=v.type==="tableHeader";y.push({text:_,isHeader:E})}),i.push(y)});const o=i.reduce((g,y)=>Math.max(g,y.length),0);if(o===0)return"";const a=new Array(o).fill(0);i.forEach(g=>{var y;for(let v=0;v<o;v+=1){const _=(((y=g[v])==null?void 0:y.text)||"").length;_>a[v]&&(a[v]=_),a[v]<3&&(a[v]=3)}});const l=(g,y)=>g+" ".repeat(Math.max(0,y-g.length)),c=i[0],u=c.some(g=>g.isHeader);let h=`
`;const f=new Array(o).fill(0).map((g,y)=>u&&c[y]&&c[y].text||"");return h+=`| ${f.map((g,y)=>l(g,a[y])).join(" | ")} |
`,h+=`| ${a.map(g=>"-".repeat(Math.max(3,g))).join(" | ")} |
`,(u?i.slice(1):i).forEach(g=>{h+=`| ${new Array(o).fill(0).map((y,v)=>l(g[v]&&g[v].text||"",a[v])).join(" | ")} |
`}),h}var dte=hte,tV=Gt.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:ste,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=ite(t,this.options.cellMinWidth),i=e.style;function o(){return i||(r?`width: ${r}`:`min-width: ${s}`)}const a=["table",et(this.options.HTMLAttributes,e,{style:o()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},a]:a},parseMarkdown:(t,e)=>{const n=[];if(t.header){const r=[];t.header.forEach(s=>{r.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(s.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}return t.rows&&t.rows.forEach(r=>{const s=[];r.forEach(i=>{s.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(i.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>dte(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:i})=>{const o=ate(i.schema,t,e,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(o).scrollIntoView().setSelection(ve.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>bee(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Tee(t,e),deleteColumn:()=>({state:t,dispatch:e})=>See(t,e),addRowBefore:()=>({state:t,dispatch:e})=>Cee(t,e),addRowAfter:()=>({state:t,dispatch:e})=>Iee(t,e),deleteRow:()=>({state:t,dispatch:e})=>Nee(t,e),deleteTable:()=>({state:t,dispatch:e})=>jee(t,e),mergeCells:()=>({state:t,dispatch:e})=>rA(t,e),splitCell:()=>({state:t,dispatch:e})=>sA(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>wd("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>wd("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>Dee(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>rA(t,e)?!0:sA(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>Mee(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>oA(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>oA(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&Kj(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=rt.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ep,"Mod-Backspace":ep,Delete:ep,"Mod-Delete":ep}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Kee({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],rte({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:ze(fe(t,"tableRole",e))}}});Je.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(tV.configure(this.options.table)),this.options.tableCell!==!1&&t.push(Xj.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(Zj.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(eV.configure(this.options.tableRow)),t}});var fte=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,pte=/^((?:https?:)?\/\/)?((?:www|m|music)\.)?((?:youtube\.com|youtu\.be|youtube-nocookie\.com))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/g,nV=t=>t.match(fte),gA=(t,e)=>e?"https://www.youtube-nocookie.com/embed/videoseries?list=":t?"https://www.youtube-nocookie.com/embed/":"https://www.youtube.com/embed/",mte=t=>{const{url:e,allowFullscreen:n,autoplay:r,ccLanguage:s,ccLoadPolicy:i,controls:o,disableKBcontrols:a,enableIFrameApi:l,endTime:c,interfaceLanguage:u,ivLoadPolicy:h,loop:f,modestBranding:m,nocookie:g,origin:y,playlist:v,progressBarColor:w,startAt:_,rel:E}=t;if(!nV(e))return null;if(e.includes("/embed/"))return e;if(e.includes("youtu.be")){const T=e.split("/").pop();return T?`${gA(g)}${T}`:null}const R=/(?:(v|list)=|shorts\/)([-\w]+)/gm.exec(e);if(!R||!R[2])return null;let O=`${gA(g,R[1]==="list")}${R[2]}`;const S=[];return n===!1&&S.push("fs=0"),r&&S.push("autoplay=1"),s&&S.push(`cc_lang_pref=${s}`),i&&S.push("cc_load_policy=1"),o||S.push("controls=0"),a&&S.push("disablekb=1"),l&&S.push("enablejsapi=1"),c&&S.push(`end=${c}`),u&&S.push(`hl=${u}`),h&&S.push(`iv_load_policy=${h}`),f&&S.push("loop=1"),m&&S.push("modestbranding=1"),y&&S.push(`origin=${y}`),v&&S.push(`playlist=${v}`),_&&S.push(`start=${_}`),w&&S.push(`color=${w}`),E!==void 0&&S.push(`rel=${E}`),S.length&&(O+=`${R[1]==="list"?"&":"?"}${S.join("&")}`),O},gte=Gt.create({name:"youtube",addOptions(){return{addPasteHandler:!0,allowFullscreen:!0,autoplay:!1,ccLanguage:void 0,ccLoadPolicy:void 0,controls:!0,disableKBcontrols:!1,enableIFrameApi:!1,endTime:0,height:480,interfaceLanguage:void 0,ivLoadPolicy:0,loop:!1,modestBranding:!1,HTMLAttributes:{},inline:!1,nocookie:!1,origin:"",playlist:"",progressBarColor:void 0,width:640,rel:1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},start:{default:0},width:{default:this.options.width},height:{default:this.options.height}}},parseHTML(){return[{tag:"div[data-youtube-video] iframe"}]},addCommands(){return{setYoutubeVideo:t=>({commands:e})=>nV(t.src)?e.insertContent({type:this.name,attrs:t}):!1}},addPasteRules(){return this.options.addPasteHandler?[uY({find:pte,type:this.type,getAttributes:t=>({src:t.input})})]:[]},renderHTML({HTMLAttributes:t}){const e=mte({url:t.src,allowFullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,controls:this.options.controls,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,nocookie:this.options.nocookie,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,startAt:t.start||0,rel:this.options.rel});return t.src=e,["div",{"data-youtube-video":""},["iframe",et(this.options.HTMLAttributes,{width:this.options.width,height:this.options.height,allowfullscreen:this.options.allowFullscreen,autoplay:this.options.autoplay,ccLanguage:this.options.ccLanguage,ccLoadPolicy:this.options.ccLoadPolicy,disableKBcontrols:this.options.disableKBcontrols,enableIFrameApi:this.options.enableIFrameApi,endTime:this.options.endTime,interfaceLanguage:this.options.interfaceLanguage,ivLoadPolicy:this.options.ivLoadPolicy,loop:this.options.loop,modestBranding:this.options.modestBranding,origin:this.options.origin,playlist:this.options.playlist,progressBarColor:this.options.progressBarColor,rel:this.options.rel},t)]]},...dj({nodeName:"youtube",allowedAttributes:["src","width","height","start"]})}),yte=gte,vte=20,rV=(t,e=0)=>{const n=[];return!t.children.length||e>vte||Array.from(t.children).forEach(r=>{r.tagName==="SPAN"?n.push(r):r.children.length&&n.push(...rV(r,e+1))}),n},wte=t=>{if(!t.children.length)return;const e=rV(t);e&&e.forEach(n=>{var r,s;const i=n.getAttribute("style"),o=(s=(r=n.parentElement)==null?void 0:r.closest("span"))==null?void 0:s.getAttribute("style");n.setAttribute("style",`${o};${i}`)})},sV=Bo.create({name:"textStyle",priority:101,addOptions(){return{HTMLAttributes:{},mergeNestedSpanStyles:!0}},parseHTML(){return[{tag:"span",consuming:!1,getAttrs:t=>t.hasAttribute("style")?(this.options.mergeNestedSpanStyles&&wte(t),{}):!1}]},renderHTML({HTMLAttributes:t}){return["span",et(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleTextStyle:t=>({commands:e})=>e.toggleMark(this.name,t),removeEmptyTextStyle:()=>({tr:t})=>{const{selection:e}=t;return t.doc.nodesBetween(e.from,e.to,(n,r)=>{if(n.isTextblock)return!0;n.marks.filter(s=>s.type===this.type).some(s=>Object.values(s.attrs).some(i=>!!i))||t.removeMark(r,r+n.nodeSize,this.type)}),!0}}}}),xte=Je.create({name:"backgroundColor",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{backgroundColor:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const r=n.split(";").map(s=>s.trim()).filter(Boolean);for(let s=r.length-1;s>=0;s-=1){const i=r[s].split(":");if(i.length>=2){const o=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(o==="background-color")return a.replace(/['"]+/g,"")}}}return(e=t.style.backgroundColor)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.backgroundColor?{style:`background-color: ${t.backgroundColor}`}:{}}}}]},addCommands(){return{setBackgroundColor:t=>({chain:e})=>e().setMark("textStyle",{backgroundColor:t}).run(),unsetBackgroundColor:()=>({chain:t})=>t().setMark("textStyle",{backgroundColor:null}).removeEmptyTextStyle().run()}}}),_te=Je.create({name:"color",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{color:{default:null,parseHTML:t=>{var e;const n=t.getAttribute("style");if(n){const r=n.split(";").map(s=>s.trim()).filter(Boolean);for(let s=r.length-1;s>=0;s-=1){const i=r[s].split(":");if(i.length>=2){const o=i[0].trim().toLowerCase(),a=i.slice(1).join(":").trim();if(o==="color")return a.replace(/['"]+/g,"")}}}return(e=t.style.color)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.color?{style:`color: ${t.color}`}:{}}}}]},addCommands(){return{setColor:t=>({chain:e})=>e().setMark("textStyle",{color:t}).run(),unsetColor:()=>({chain:t})=>t().setMark("textStyle",{color:null}).removeEmptyTextStyle().run()}}}),bte=Je.create({name:"fontFamily",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontFamily:{default:null,parseHTML:t=>t.style.fontFamily,renderHTML:t=>t.fontFamily?{style:`font-family: ${t.fontFamily}`}:{}}}}]},addCommands(){return{setFontFamily:t=>({chain:e})=>e().setMark("textStyle",{fontFamily:t}).run(),unsetFontFamily:()=>({chain:t})=>t().setMark("textStyle",{fontFamily:null}).removeEmptyTextStyle().run()}}}),Tte=Je.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>t.style.fontSize,renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),Ete=Je.create({name:"lineHeight",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{lineHeight:{default:null,parseHTML:t=>t.style.lineHeight,renderHTML:t=>t.lineHeight?{style:`line-height: ${t.lineHeight}`}:{}}}}]},addCommands(){return{setLineHeight:t=>({chain:e})=>e().setMark("textStyle",{lineHeight:t}).run(),unsetLineHeight:()=>({chain:t})=>t().setMark("textStyle",{lineHeight:null}).removeEmptyTextStyle().run()}}});Je.create({name:"textStyleKit",addExtensions(){const t=[];return this.options.backgroundColor!==!1&&t.push(xte.configure(this.options.backgroundColor)),this.options.color!==!1&&t.push(_te.configure(this.options.color)),this.options.fontFamily!==!1&&t.push(bte.configure(this.options.fontFamily)),this.options.fontSize!==!1&&t.push(Tte.configure(this.options.fontSize)),this.options.lineHeight!==!1&&t.push(Ete.configure(this.options.lineHeight)),this.options.textStyle!==!1&&t.push(sV.configure(this.options.textStyle)),t}});const Ste=Je.create({name:"fontSize",addOptions(){return{types:["textStyle"]}},addGlobalAttributes(){return[{types:this.options.types,attributes:{fontSize:{default:null,parseHTML:t=>{var e;return(e=t.style.fontSize)==null?void 0:e.replace(/['"]+/g,"")},renderHTML:t=>t.fontSize?{style:`font-size: ${t.fontSize}`}:{}}}}]},addCommands(){return{setFontSize:t=>({chain:e})=>e().setMark("textStyle",{fontSize:t}).run(),unsetFontSize:()=>({chain:t})=>t().setMark("textStyle",{fontSize:null}).removeEmptyTextStyle().run()}}}),kte=[{label:"Nh",value:"12px"},{label:"Bnh thng",value:"16px"},{label:"Trung bnh",value:"18px"},{label:"Ln",value:"20px"},{label:"Rt ln",value:"24px"},{label:"Tiu ",value:"28px"},{label:"Tiu  ln",value:"32px"}],Sl={cloudName:"dnogyneo3",uploadPreset:"deskhub_uploads",apiKey:"your-api-key"},Ag=async(t,e="desk-setups")=>{var r;const n=new FormData;n.append("file",t),n.append("upload_preset",Sl.uploadPreset),n.append("folder",e),n.append("cloud_name",Sl.cloudName);try{const s=await fetch(`https://api.cloudinary.com/v1_1/${Sl.cloudName}/image/upload`,{method:"POST",body:n});if(!s.ok){const o=await s.json().catch(()=>({}));throw console.error(" Cloudinary API Error:",{status:s.status,statusText:s.statusText,error:o,config:{cloudName:Sl.cloudName,uploadPreset:Sl.uploadPreset,hasApiKey:!!Sl.apiKey}}),new Error(`Upload failed: ${((r=o.error)==null?void 0:r.message)||s.statusText}`)}const i=await s.json();return{url:i.secure_url,publicId:i.public_id,width:i.width,height:i.height,format:i.format}}catch(s){throw console.error("Cloudinary upload error:",s),s}},Cte=nee.configure({heading:{levels:[2,3,4]}}),Ite=({content:t,onUpdate:e,onImageAdd:n,placeholder:r="Bt u vit bi ti y...",primaryKeyword:s=""})=>{const i=yX({extensions:[Cte,iee.configure({HTMLAttributes:{class:"blog-image"}}),fZ.configure({openOnClick:!1,HTMLAttributes:{class:"blog-link",target:"_blank",rel:"noopener noreferrer"}}),oee.configure({placeholder:r}),tV.configure({resizable:!0}),eV,Zj,Xj,yte.configure({controls:!0,nocookie:!0,allowFullscreen:!0,HTMLAttributes:{class:"blog-video"}}),sV,Ste],content:t||"",onUpdate:({editor:h})=>{const f=h.getJSON(),m=h.getHTML();e({json:f,html:m})}});A.useEffect(()=>{if(i&&t&&typeof t=="object"){const h=i.getJSON();JSON.stringify(h)!==JSON.stringify(t)&&i.commands.setContent(t)}},[t,i]);const o=A.useCallback((h,f="")=>{i&&(i.chain().focus().setImage({src:h,alt:f}).run(),n&&n({url:h,alt:f}))},[i,n]),a=A.useCallback(()=>{const h=prompt("Nhp URL:");h&&i&&i.chain().focus().extendMarkRange("link").setLink({href:h}).run()},[i]),l=A.useCallback(()=>{i&&i.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},[i]),c=A.useCallback(()=>{const h=prompt("Nhp URL YouTube hoc Vimeo:");if(h&&i){const f=/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/\s]{11})/;h.match(f)?i.commands.setYoutubeVideo({src:h,width:640,height:360}):alert("URL YouTube khng hp l. Vui lng s dng link YouTube.")}},[i]),u=A.useCallback(()=>{const h=document.createElement("input");h.type="file",h.accept="image/*",h.onchange=async f=>{const m=f.target.files[0];if(m)try{const g=s?` xut: "${s}"

`:"",y=prompt(`${g}Nhp Alt text cho nh (bt buc cho SEO):`)||"",v=await Ag(m,"blog-content");o(v.url,y)}catch(g){console.error("Image upload failed:",g),alert("Ti nh tht bi: "+g.message)}},h.click()},[o]);return i?d.jsxs("div",{className:"tiptap-editor-wrapper",children:[d.jsxs("div",{className:"tiptap-toolbar",children:[d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleHeading({level:2}).run(),className:`toolbar-btn ${i.isActive("heading",{level:2})?"active":""}`,title:"Heading 2",children:"H2"}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleHeading({level:3}).run(),className:`toolbar-btn ${i.isActive("heading",{level:3})?"active":""}`,title:"Heading 3",children:"H3"}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleHeading({level:4}).run(),className:`toolbar-btn ${i.isActive("heading",{level:4})?"active":""}`,title:"Heading 4",children:"H4"})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleBold().run(),className:`toolbar-btn ${i.isActive("bold")?"active":""}`,title:"In m",children:d.jsx("strong",{children:"B"})}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleItalic().run(),className:`toolbar-btn ${i.isActive("italic")?"active":""}`,title:"In nghing",children:d.jsx("em",{children:"I"})}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleStrike().run(),className:`toolbar-btn ${i.isActive("strike")?"active":""}`,title:"Gch ngang",children:d.jsx("s",{children:"S"})})]}),d.jsx("div",{className:"toolbar-group",children:d.jsxs("select",{className:"toolbar-select",onChange:h=>{const f=h.target.value;f?i.chain().focus().setFontSize(f).run():i.chain().focus().unsetFontSize().run()},value:i.getAttributes("textStyle").fontSize||"",title:"Kch c ch",children:[d.jsx("option",{value:"",children:"C ch"}),kte.map(h=>d.jsx("option",{value:h.value,children:h.label},h.value))]})}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleBulletList().run(),className:`toolbar-btn ${i.isActive("bulletList")?"active":""}`,title:"Danh sch",children:" List"}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleOrderedList().run(),className:`toolbar-btn ${i.isActive("orderedList")?"active":""}`,title:"Danh sch s",children:"1. List"})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:()=>i.chain().focus().toggleBlockquote().run(),className:`toolbar-btn ${i.isActive("blockquote")?"active":""}`,title:"Trch dn",children:'" Quote'}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().setHorizontalRule().run(),className:"toolbar-btn",title:"ng k ngang",children:""})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:u,className:"toolbar-btn",title:"Chn nh",children:" nh"}),d.jsx("button",{type:"button",onClick:c,className:"toolbar-btn",title:"Chn video YouTube",children:" Video"}),d.jsx("button",{type:"button",onClick:a,className:`toolbar-btn ${i.isActive("link")?"active":""}`,title:"Chn link",children:" Link"}),d.jsx("button",{type:"button",onClick:l,className:"toolbar-btn",title:"Chn bng",children:" Bng"})]}),d.jsxs("div",{className:"toolbar-group",children:[d.jsx("button",{type:"button",onClick:()=>i.chain().focus().undo().run(),disabled:!i.can().undo(),className:"toolbar-btn",title:"Hon tc",children:""}),d.jsx("button",{type:"button",onClick:()=>i.chain().focus().redo().run(),disabled:!i.can().redo(),className:"toolbar-btn",title:"Lm li",children:""})]})]}),d.jsx(uX,{editor:i,className:"tiptap-content"})]}):d.jsx("div",{className:"tiptap-loading",children:"ang ti editor..."})},Ate=A.forwardRef(({seoData:t,onChange:e,content:n,keywords:r,onKeywordsChange:s,searchIntent:i,onIntentChange:o},a)=>{var g,y;const[l,c]=qe.useState("keywords");A.useImperativeHandle(a,()=>({switchToTab:v=>{c(v);const w=document.querySelector(".seo-panel");w&&w.scrollIntoView({behavior:"smooth",block:"start"})},focusField:v=>{setTimeout(()=>{const w=document.querySelector(`#seo-field-${v}`);w&&(w.focus(),w.scrollIntoView({behavior:"smooth",block:"center"}))},100)}}));const u=[{id:"keywords",label:"Keywords",icon:""},{id:"social",label:"Social",icon:""},{id:"intent",label:"Intent",icon:""}],h=((g=t==null?void 0:t.seoTitle)==null?void 0:g.length)||0,f=((y=t==null?void 0:t.metaDescription)==null?void 0:y.length)||0,m=(r==null?void 0:r.primaryKeyword)&&r.primaryKeyword.trim()!=="";return d.jsxs("div",{className:"seo-panel",children:[d.jsx("div",{className:"seo-panel-header",children:d.jsx("h3",{children:" SEO Settings"})}),d.jsxs("div",{className:"seo-essential-fields",children:[d.jsxs("div",{className:"essential-field-header",children:[d.jsx("span",{className:"essential-icon",children:""}),d.jsx("span",{children:"Cc trng bt buc"})]}),d.jsxs("div",{className:"seo-field",children:[d.jsxs("label",{htmlFor:"seo-field-seoTitle",children:["SEO Title ",d.jsx("span",{className:"required",children:"*"}),d.jsxs("span",{className:`char-counter ${h===0?"empty":h<30?"short":h>60?"long":"good"}`,children:[h,"/60"]})]}),d.jsx("input",{id:"seo-field-seoTitle",type:"text",value:(t==null?void 0:t.seoTitle)||"",onChange:v=>e({...t,seoTitle:v.target.value}),placeholder:"Nhp tiu  SEO (30-60 k t)",className:"seo-input",maxLength:70}),h<30&&h>0&&d.jsx("div",{className:"seo-hint warning",children:" Cn ti thiu 30 k t"})]}),d.jsxs("div",{className:"seo-field",children:[d.jsxs("label",{htmlFor:"seo-field-metaDescription",children:["Meta Description ",d.jsx("span",{className:"required",children:"*"}),d.jsxs("span",{className:`char-counter ${f===0?"empty":f<120?"short":f>155?"long":"good"}`,children:[f,"/155"]})]}),d.jsx("textarea",{id:"seo-field-metaDescription",value:(t==null?void 0:t.metaDescription)||"",onChange:v=>e({...t,metaDescription:v.target.value}),placeholder:"Nhp m t SEO (120-155 k t)",className:"seo-input",rows:3,maxLength:160}),f<120&&f>0&&d.jsx("div",{className:"seo-hint warning",children:" Cn ti thiu 120 k t"})]}),d.jsxs("div",{className:"seo-field",children:[d.jsxs("label",{htmlFor:"seo-field-primaryKeyword",children:["Primary Keyword ",d.jsx("span",{className:"required",children:"*"})]}),d.jsx("input",{id:"seo-field-primaryKeyword",type:"text",value:(r==null?void 0:r.primaryKeyword)||"",onChange:v=>s({...r,primaryKeyword:v.target.value}),placeholder:"T kha chnh bn mun rank trn Google",className:"seo-input primary-keyword-input"}),!m&&d.jsx("div",{className:"seo-hint error",children:" Bt buc nhp Primary Keyword"})]})]}),d.jsxs("div",{className:"seo-advanced-section",children:[d.jsx("div",{className:"advanced-header",children:d.jsx("span",{children:"Ci t nng cao"})}),d.jsx("div",{className:"seo-tabs",children:u.map(v=>d.jsxs("button",{type:"button",className:`seo-tab ${l===v.id?"active":""}`,onClick:()=>c(v.id),children:[d.jsx("span",{className:"tab-icon",children:v.icon}),d.jsx("span",{className:"tab-label",children:v.label})]},v.id))}),d.jsxs("div",{className:"seo-tab-content",children:[l==="keywords"&&d.jsx(Nte,{keywords:r,onChange:s,content:n}),l==="social"&&d.jsx(Rte,{seoData:t,onChange:e}),l==="intent"&&d.jsx(Pte,{searchIntent:i,onChange:o})]})]})]})}),Nte=({keywords:t,onChange:e,content:n})=>{var a,l;const r=()=>{const c=prompt("Nhp secondary keyword:");c&&!t.secondaryKeywords.includes(c.trim())&&e({...t,secondaryKeywords:[...t.secondaryKeywords,c.trim()]})},s=c=>{e({...t,secondaryKeywords:t.secondaryKeywords.filter((u,h)=>h!==c)})},i=()=>{const c=prompt("Nhp LSI/semantic keyword:");c&&!t.lsiKeywords.includes(c.trim())&&e({...t,lsiKeywords:[...t.lsiKeywords,c.trim()]})},o=c=>{e({...t,lsiKeywords:t.lsiKeywords.filter((u,h)=>h!==c)})};return d.jsxs("div",{className:"seo-keywords-tab",children:[d.jsxs("div",{className:"seo-field",children:[d.jsxs("label",{children:["Primary Keyword ",d.jsx("span",{className:"required",children:"*"})]}),d.jsx("input",{id:"seo-field-primaryKeyword",type:"text",value:t.primaryKeyword||"",onChange:c=>e({...t,primaryKeyword:c.target.value}),placeholder:"T kha chnh bn mun rank",className:"seo-input primary-keyword-input"}),!t.primaryKeyword&&d.jsx("div",{className:"seo-hint error",children:" Bt buc c primary keyword"})]}),d.jsxs("div",{className:"seo-field",children:[d.jsx("label",{children:"Secondary Keywords"}),d.jsxs("div",{className:"keyword-tags",children:[(a=t.secondaryKeywords)==null?void 0:a.map((c,u)=>d.jsxs("span",{className:"keyword-tag",children:[c,d.jsx("button",{type:"button",onClick:()=>s(u),children:""})]},u)),d.jsx("button",{type:"button",className:"add-keyword-btn",onClick:r,children:"+ Thm"})]})]}),d.jsxs("div",{className:"seo-field",children:[d.jsx("label",{children:"LSI / Semantic Keywords"}),d.jsxs("div",{className:"keyword-tags",children:[(l=t.lsiKeywords)==null?void 0:l.map((c,u)=>d.jsxs("span",{className:"keyword-tag lsi",children:[c,d.jsx("button",{type:"button",onClick:()=>o(u),children:""})]},u)),d.jsx("button",{type:"button",className:"add-keyword-btn",onClick:i,children:"+ Thm"})]})]})]})},Rte=({seoData:t,onChange:e})=>d.jsxs("div",{className:"seo-social-tab",children:[d.jsxs("div",{className:"seo-field",children:[d.jsx("label",{children:"OG Title"}),d.jsx("input",{type:"text",value:t.ogTitle||"",onChange:n=>e({...t,ogTitle:n.target.value}),placeholder:"Tiu  khi chia s ( trng = dng SEO Title)",className:"seo-input"})]}),d.jsxs("div",{className:"seo-field",children:[d.jsx("label",{children:"OG Description"}),d.jsx("textarea",{value:t.ogDescription||"",onChange:n=>e({...t,ogDescription:n.target.value}),placeholder:"M t khi chia s ( trng = dng Meta Description)",className:"seo-input",rows:2})]}),d.jsxs("div",{className:"seo-field",children:[d.jsx("label",{children:"OG Image URL"}),d.jsx("input",{type:"url",value:t.ogImage||"",onChange:n=>e({...t,ogImage:n.target.value}),placeholder:"https://example.com/image.jpg",className:"seo-input"})]}),d.jsxs("div",{className:"social-preview",children:[d.jsx("h4",{children:"Facebook Preview"}),d.jsxs("div",{className:"fb-card",children:[d.jsx("div",{className:"fb-image",children:t.ogImage?d.jsx("img",{src:t.ogImage,alt:"OG Preview"}):d.jsx("div",{className:"fb-image-placeholder",children:"Cha c nh"})}),d.jsxs("div",{className:"fb-content",children:[d.jsx("div",{className:"fb-domain",children:"deskhub.vn"}),d.jsx("div",{className:"fb-title",children:t.ogTitle||t.seoTitle||"Tiu  bi vit"}),d.jsx("div",{className:"fb-desc",children:t.ogDescription||t.metaDescription||"M t bi vit..."})]})]})]})]}),Pte=({searchIntent:t,onChange:e})=>{const n=[{value:"informational",label:"Thng tin (Informational)",icon:"",desc:"Ngi dng mun tm hiu, hc hi",cta:"c thm, Tm hiu thm"},{value:"navigational",label:"iu hng (Navigational)",icon:"",desc:"Ngi dng mun tm trang/ngun c th",cta:"Truy cp, n trang"},{value:"transactional",label:"Giao dch (Transactional)",icon:"",desc:"Ngi dng mun mua/ng k",cta:"Mua ngay, ng k"},{value:"commercial",label:"Thng mi (Commercial)",icon:"",desc:"Ngi dng so snh trc khi mua",cta:"So snh, Xem nh gi"}];return d.jsxs("div",{className:"seo-intent-tab",children:[d.jsx("p",{className:"intent-intro",children:"Chn search intent ph hp  ti u cu trc ni dung"}),d.jsx("div",{className:"intent-options",children:n.map(r=>d.jsxs("div",{className:`intent-option ${t===r.value?"selected":""}`,onClick:()=>e(r.value),children:[d.jsx("div",{className:"intent-icon",children:r.icon}),d.jsxs("div",{className:"intent-info",children:[d.jsx("div",{className:"intent-label",children:r.label}),d.jsx("div",{className:"intent-desc",children:r.desc}),d.jsxs("div",{className:"intent-cta",children:["CTA gi : ",r.cta]})]})]},r.value))})]})},Mte=({primaryKeyword:t,title:e,content:n,contentJson:r})=>{const s=A.useMemo(()=>{if(!t)return{hasKeyword:!1,checks:[]};const l=t.toLowerCase().trim(),c=iV(n||""),u=c.toLowerCase(),h=oV(r,2),f=(e==null?void 0:e.toLowerCase())||"",m=c.split(/\s+/).filter(Boolean).length,g=(u.match(new RegExp(l,"gi"))||[]).length,y=m>0?g/m:0,v=[{id:"first150",label:"Keyword trong 150 k t u",passed:u.substring(0,150).includes(l),priority:"high"},{id:"last150",label:"Keyword trong 150 k t cui",passed:u.slice(-150).includes(l),priority:"medium"},{id:"h1",label:"Keyword trong H1 (tiu )",passed:f.includes(l),priority:"high"},{id:"h2",label:"Keyword trong t nht 1 H2",passed:h.some(w=>w.toLowerCase().includes(l)),priority:"high"},{id:"density",label:`Mt  keyword: ${(y*100).toFixed(1)}%`,passed:y<=.03&&y>=.005,warning:y>.03,priority:"medium",hint:y>.03?"Qu dy! Nn < 3%":y<.005?"Qu tha! Nn 0.5-3%":""}];return{hasKeyword:!0,keyword:l,keywordCount:g,wordCount:m,density:y,checks:v}},[t,e,n,r]);if(!s.hasKeyword)return d.jsxs("div",{className:"keyword-analyzer empty",children:[d.jsx("h4",{children:" Keyword Analysis"}),d.jsx("p",{className:"no-keyword",children:"Cha c primary keyword"})]});const i=s.checks.filter(l=>l.passed).length,o=s.checks.length,a=Math.round(i/o*100);return d.jsxs("div",{className:"keyword-analyzer",children:[d.jsxs("div",{className:"analyzer-header",children:[d.jsx("h4",{children:" Keyword Analysis"}),d.jsxs("div",{className:`keyword-score ${a>=70?"good":a>=40?"medium":"poor"}`,children:[a,"%"]})]}),d.jsxs("div",{className:"keyword-target",children:[d.jsx("span",{className:"label",children:"Target:"}),d.jsx("span",{className:"keyword",children:s.keyword}),d.jsxs("span",{className:"count",children:["(",s.keywordCount,"x trong ",s.wordCount," t)"]})]}),d.jsx("div",{className:"keyword-checks",children:s.checks.map(l=>d.jsxs("div",{className:`check-item ${l.passed?"passed":"failed"} ${l.warning?"warning":""}`,children:[d.jsx("span",{className:"check-icon",children:l.passed?"":l.warning?"":""}),d.jsx("span",{className:"check-label",children:l.label}),l.hint&&d.jsx("span",{className:"check-hint",children:l.hint})]},l.id))})]})},Ote=({title:t,content:e,contentJson:n,primaryKeyword:r=""})=>{const s=A.useMemo(()=>{const c=iV(e||""),u=r_(n,2),h=r_(n,3),f=Lte(n),g=Vte(n).filter(w=>w.wordCount>100),y=c.split(/\s+/).filter(Boolean).length;return{checks:[{id:"singleH1",label:"Ch c 1 H1 (tiu  bi)",passed:!f,hint:f?"Khng nn dng H1 trong ni dung":"",priority:"high"},{id:"hasH2",label:`C t nht 1 H2 (hin c ${u})`,passed:u>=1,priority:"high"},{id:"multipleH2",label:`C t nht 3 sections H2 (hin c ${u})`,passed:u>=3,priority:"medium"},{id:"headingHierarchy",label:"Khng b cp heading (H1H2H3)",passed:jte(n),priority:"high"},{id:"paragraphLength",label:`Paragraphs ngn (${g.length} qu di)`,passed:g.length===0,hint:g.length>0?"Nn chia nh on > 100 t":"",priority:"medium"},{id:"minWords",label:` di ni dung (${y} t)`,passed:y>=300,hint:y<300?"Nn c t nht 300 t":"",priority:"medium"}],wordCount:y,h2Count:u,h3Count:h}},[t,e,n]),i=A.useMemo(()=>{const c=[],u=(h,f=0)=>{var m,g;if(h){if(h.type==="heading"&&((m=h.attrs)!=null&&m.level)){const y=((g=h.content)==null?void 0:g.map(v=>v.text||"").join(""))||"";c.push({level:h.attrs.level,text:y})}h.content&&h.content.forEach(y=>u(y,f+1))}};return u(n),c},[n]),o=s.checks.filter(c=>c.passed).length,a=s.checks.length,l=Math.round(o/a*100);return d.jsxs("div",{className:"readability-checker",children:[d.jsxs("div",{className:"checker-header",children:[d.jsx("h4",{children:" Readability"}),d.jsxs("div",{className:`readability-score ${l>=70?"good":l>=40?"medium":"poor"}`,children:[l,"%"]})]}),d.jsxs("div",{className:"readability-stats",children:[d.jsxs("span",{children:[s.wordCount," t"]}),d.jsx("span",{children:""}),d.jsxs("span",{children:[s.h2Count," H2"]}),d.jsx("span",{children:""}),d.jsxs("span",{children:[s.h3Count," H3"]})]}),d.jsx("div",{className:"readability-checks",children:s.checks.map(c=>d.jsxs("div",{className:`check-item ${c.passed?"passed":"failed"}`,children:[d.jsx("span",{className:"check-icon",children:c.passed?"":""}),d.jsx("span",{className:"check-label",children:c.label}),c.hint&&d.jsx("span",{className:"check-hint",children:c.hint})]},c.id))}),i.length>0&&d.jsxs("div",{className:"heading-overview",children:[d.jsxs("div",{className:"heading-overview-title",children:["Cu trc Heading ",r&&d.jsx("span",{className:"keyword-indicator",children:" = c keyword"})]}),d.jsx("div",{className:"heading-list",children:i.map((c,u)=>{const h=r&&c.text.toLowerCase().includes(r.toLowerCase());return d.jsxs("div",{className:`heading-item h${c.level} ${h?"has-keyword":""}`,children:[d.jsxs("span",{className:"h-level",children:["H",c.level]}),d.jsx("span",{className:"h-text",children:c.text||"(trng)"}),h&&d.jsx("span",{className:"keyword-badge",children:""})]},u)})})]})]})},Dte=({seoData:t,keywords:e,title:n,slug:r,content:s,contentJson:i,images:o,author:a,onNavigate:l})=>{const c=A.useMemo(()=>{const m=r_(i,2),g=(o==null?void 0:o.filter(y=>!y.alt||y.alt.trim()===""))||[];return[{id:"seoTitle",label:"SEO Title",passed:(t==null?void 0:t.seoTitle)&&t.seoTitle.length>=30,blocking:!0,tab:"meta",field:"seoTitle",hint:t!=null&&t.seoTitle?t.seoTitle.length<30?`Ti thiu 30 k t (hin c ${t.seoTitle.length})`:"":"Nhn  nhp"},{id:"metaDesc",label:"Meta Description",passed:(t==null?void 0:t.metaDescription)&&t.metaDescription.length>=120,blocking:!0,tab:"meta",field:"metaDescription",hint:t!=null&&t.metaDescription?t.metaDescription.length<120?`Ti thiu 120 k t (hin c ${t.metaDescription.length})`:"":"Nhn  nhp"},{id:"primaryKeyword",label:"Primary Keyword",passed:(e==null?void 0:e.primaryKeyword)&&e.primaryKeyword.trim()!=="",blocking:!0,tab:"keywords",field:"primaryKeyword",hint:e!=null&&e.primaryKeyword?"":"Nhn  nhp"},{id:"hasH2",label:"C t nht 1 H2",passed:m>=1,blocking:!0,navigable:!1,hint:m===0?"Thm heading H2 vo ni dung":""},{id:"slug",label:"URL Slug",passed:r&&r.trim()!=="",blocking:!0,scrollTo:".slug-section",hint:r?"":"Nhn  nhp"},{id:"title",label:"Tiu  bi vit",passed:n&&n.trim()!=="",blocking:!0,scrollTo:".title-section",hint:n?"":"Nhn  nhp"},{id:"imageAlt",label:"nh c Alt text",passed:(o==null?void 0:o.length)>0&&g.length===0,blocking:!1,navigable:!1,hint:(o==null?void 0:o.length)===0?"Cha c nh trong bi vit":g.length>0?`${g.length} nh thiu alt`:""},{id:"author",label:"Tc gi",passed:a&&a.name,blocking:!1,navigable:!1}]},[t,e,n,r,s,i,o,a]),u=m=>{if(!m.passed){if(m.tab&&m.field&&l){l(m.tab,m.field);return}if(m.scrollTo){const g=document.querySelector(m.scrollTo);if(g){g.scrollIntoView({behavior:"smooth",block:"center"});const y=g.querySelector("input, textarea");y&&setTimeout(()=>y.focus(),300)}return}}},h=c.filter(m=>m.blocking).every(m=>m.passed),f=c.filter(m=>m.passed).length;return d.jsxs("div",{className:"publish-checklist",children:[d.jsxs("div",{className:"checklist-header",children:[d.jsx("h4",{children:" Pre-Publish Checklist"}),d.jsx("span",{className:`checklist-status ${h?"ready":"not-ready"}`,children:h?" Ready":` ${c.filter(m=>m.blocking&&!m.passed).length} li`})]}),d.jsx("div",{className:"checklist-items",children:c.map(m=>{const g=!m.passed&&(m.tab||m.scrollTo)&&m.navigable!==!1;return d.jsxs("div",{className:`checklist-item ${m.passed?"passed":"failed"} ${g?"clickable":""}`,onClick:()=>g&&u(m),title:g?"Nhn  in thng tin":"",children:[d.jsx("span",{className:"checklist-icon",children:m.passed?"":m.blocking?"":""}),d.jsxs("span",{className:"checklist-label",children:[m.label,m.blocking&&!m.passed&&d.jsx("span",{className:"blocking-badge",children:"Bt buc"})]}),g&&d.jsx("span",{className:"checklist-action",children:" Nhp"}),m.hint&&d.jsx("span",{className:"checklist-hint",children:m.hint})]},m.id)})}),d.jsxs("div",{className:"checklist-summary",children:[f,"/",c.length," hon thnh"]}),!h&&d.jsx("div",{className:"checklist-help",children:" Click vo cc mc   in thng tin trc tip"})]})};function iV(t){if(!t||typeof t!="string")return"";const e=document.createElement("div");return e.innerHTML=t,(e.textContent||e.innerText||"").trim()}function oV(t,e){const n=[];if(!t||!t.content)return n;function r(s){var i,o;if(s.type==="heading"&&((i=s.attrs)==null?void 0:i.level)===e){const a=((o=s.content)==null?void 0:o.map(l=>l.text||"").join(""))||"";n.push(a)}s.content&&s.content.forEach(r)}return r(t),n}function r_(t,e){return oV(t,e).length}function Lte(t){if(!t||!t.content)return!1;function e(n){var r;return n.type==="heading"&&((r=n.attrs)==null?void 0:r.level)===1?!0:n.content?n.content.some(e):!1}return e(t)}function jte(t){if(!t||!t.content)return!0;let e=1,n=!0;function r(s){var i;if(s.type==="heading"&&((i=s.attrs)!=null&&i.level)){const o=s.attrs.level;o>e+1&&(n=!1),e=o}s.content&&n&&s.content.forEach(r)}return r(t),n}function Vte(t){const e=[];if(!t||!t.content)return e;function n(r){var s;if(r.type==="paragraph"){const i=((s=r.content)==null?void 0:s.map(a=>a.text||"").join(""))||"",o=i.split(/\s+/).filter(Boolean).length;e.push({text:i,wordCount:o})}r.content&&r.content.forEach(n)}return n(t),e}const Fte=({searchIntent:t="informational",primaryKeyword:e="",onOutlineChange:n,existingOutline:r=[]})=>{const[s,i]=A.useState(r),[o,a]=A.useState({level:"h2",text:""}),[l,c]=A.useState(!0),u=tD[t],h=A.useMemo(()=>{const w={informational:[{level:"h2",text:"Gii thiu v [topic]"},{level:"h2",text:"[Topic] l g?"},{level:"h3",text:"nh ngha"},{level:"h3",text:"Lch s pht trin"},{level:"h2",text:"Ti sao [topic] quan trng?"},{level:"h2",text:"Cch thc hin [topic]"},{level:"h3",text:"Bc 1: ..."},{level:"h3",text:"Bc 2: ..."},{level:"h3",text:"Bc 3: ..."},{level:"h2",text:"Li khuyn v mo hay"},{level:"h2",text:"Cu hi thng gp (FAQ)"},{level:"h2",text:"Kt lun"}],transactional:[{level:"h2",text:"Tng quan sn phm"},{level:"h2",text:"Tnh nng ni bt"},{level:"h3",text:"Tnh nng 1"},{level:"h3",text:"Tnh nng 2"},{level:"h2",text:"Bng gi"},{level:"h2",text:"So snh vi i th"},{level:"h2",text:"nh gi t ngi dng"},{level:"h2",text:"Hng dn mua hng"}],commercial:[{level:"h2",text:"Top [n] sn phm tt nht"},{level:"h2",text:"#1. [Sn phm A]"},{level:"h3",text:"u im"},{level:"h3",text:"Nhc im"},{level:"h3",text:"Ai nn mua?"},{level:"h2",text:"#2. [Sn phm B]"},{level:"h2",text:"Bng so snh chi tit"},{level:"h2",text:"Hng dn chn mua"},{level:"h2",text:"Kt lun - Nn mua g?"}],navigational:[{level:"h2",text:"Thng tin nhanh"},{level:"h2",text:"Cch truy cp"},{level:"h2",text:"Hng dn s dng"}]};return w[t]||w.informational},[t]),f=()=>{if(o.text.trim()){const w=[...s,{...o,id:Date.now()}];i(w),a({level:"h2",text:""}),n==null||n(w)}},m=w=>{const _=s.filter(E=>E.id!==w);i(_),n==null||n(_)},g=(w,_)=>{const E=_==="up"?w-1:w+1;if(E<0||E>=s.length)return;const N=[...s];[N[w],N[E]]=[N[E],N[w]],i(N),n==null||n(N)},y=()=>{const w=e||"topic",_=h.map((E,N)=>({...E,id:Date.now()+N,text:E.text.replace(/\[topic\]/gi,w)}));i(_),n==null||n(_)},v=A.useMemo(()=>{const w=[],_=s.filter(E=>E.level==="h2").length;return _<3&&w.push({type:"warning",message:`Nn c t nht 3 H2 (hin c ${_})`}),s.length===0&&w.push({type:"error",message:"Cha c dn  no"}),e&&s.filter(N=>N.level==="h2"&&N.text.toLowerCase().includes(e.toLowerCase())).length===0&&w.push({type:"warning",message:"Nn c t nht 1 H2 cha keyword"}),w},[s,e]);return d.jsxs("div",{className:"outline-builder",children:[d.jsxs("div",{className:"outline-header",onClick:()=>c(!l),children:[d.jsxs("div",{className:"outline-title",children:[d.jsx("span",{className:"outline-icon",children:""}),d.jsxs("h4",{children:["Dn  bi vit (",s.length," mc)"]})]}),d.jsx("button",{type:"button",className:"expand-btn",children:l?"":""})]}),l&&d.jsxs("div",{className:"outline-content",children:[u&&d.jsxs("div",{className:"intent-suggestion-box",children:[d.jsx("span",{className:"intent-label",children:u.label}),d.jsx("button",{type:"button",className:"apply-template-btn",onClick:y,children:" p dng mu"})]}),v.length>0&&d.jsx("div",{className:"outline-issues",children:v.map((w,_)=>d.jsxs("div",{className:`issue-item ${w.type}`,children:[w.type==="error"?"":""," ",w.message]},_))}),d.jsx("div",{className:"outline-items",children:s.map((w,_)=>d.jsxs("div",{className:`outline-item ${w.level} ${e&&w.text.toLowerCase().includes(e.toLowerCase())?"has-keyword":""}`,children:[d.jsx("span",{className:"item-level",children:w.level.toUpperCase()}),d.jsx("span",{className:"item-text",children:w.text}),e&&w.text.toLowerCase().includes(e.toLowerCase())&&d.jsx("span",{className:"keyword-badge",children:""}),d.jsxs("div",{className:"item-actions",children:[d.jsx("button",{type:"button",onClick:()=>g(_,"up"),disabled:_===0,children:""}),d.jsx("button",{type:"button",onClick:()=>g(_,"down"),disabled:_===s.length-1,children:""}),d.jsx("button",{type:"button",onClick:()=>m(w.id),className:"remove-btn",children:""})]})]},w.id))}),d.jsxs("div",{className:"add-outline-item",children:[d.jsxs("select",{value:o.level,onChange:w=>a({...o,level:w.target.value}),className:"level-select",children:[d.jsx("option",{value:"h2",children:"H2"}),d.jsx("option",{value:"h3",children:"H3"}),d.jsx("option",{value:"h4",children:"H4"})]}),d.jsx("input",{type:"text",value:o.text,onChange:w=>a({...o,text:w.target.value}),placeholder:"Nhp tiu  heading...",className:"item-input",onKeyPress:w=>w.key==="Enter"&&f()}),d.jsx("button",{type:"button",onClick:f,className:"add-btn",children:"+ Thm"})]})]})]})},Bte=({title:t="",content:e="",contentJson:n=null,seoData:r={},keywords:s={},images:i=[],wordCount:o=0})=>{const a=A.useMemo(()=>{var _;const h=[],f=((_=s==null?void 0:s.primaryKeyword)==null?void 0:_.toLowerCase())||"",m=zte(e).toLowerCase();if(t&&f&&(t.toLowerCase().includes(f)||h.push({id:"title-keyword",type:"high",icon:"",message:`Thm keyword "${s.primaryKeyword}" vo tiu `,action:"Keyword trong tiu  gip Google hiu ch  chnh"}),t.length>60&&h.push({id:"title-length",type:"medium",icon:"",message:"Tiu  qu di - c th b ct trn Google",action:`Rt gn cn di 60 k t (hin ${t.length})`})),o<300?h.push({id:"word-count-low",type:"high",icon:"",message:"Ni dung qu ngn cho SEO",action:`Vit thm t nht ${300-o} t na ( xut 1000-2000 t)`}):o<800&&h.push({id:"word-count-medium",type:"low",icon:"",message:"Ni dung c th m rng thm",action:"Bi 1000-2000 t thng xp hng tt hn"}),f){const E=(m.match(new RegExp(f,"gi"))||[]).length;E===0?h.push({id:"no-keyword",type:"high",icon:"",message:"Keyword cha xut hin trong ni dung!",action:"Thm keyword t nhin vo bi vit"}):E<3&&h.push({id:"few-keywords",type:"medium",icon:"",message:`Keyword ch xut hin ${E} ln`,action:" xut 5-10 ln cho bi 1000 t"})}const g=yA(n,2),y=yA(n,3);if(g<2&&h.push({id:"few-h2",type:"medium",icon:"",message:`Ch c ${g} heading H2`,action:"Thm H2  chia bi thnh cc phn r rng"}),g>=3&&y===0&&h.push({id:"no-h3",type:"low",icon:"",message:"Cha c H3  chia nh cc mc",action:"Thm H3 di mi H2  cu trc r rng hn"}),i.length===0)h.push({id:"no-images",type:"medium",icon:"",message:"Bi vit cha c hnh nh",action:"Thm t nht 1-3 hnh nh minh ha"});else{const E=i.filter(N=>!N.alt||N.alt.trim()==="");E.length>0&&h.push({id:"missing-alt",type:"medium",icon:"",message:`${E.length} nh thiu Alt text`,action:"Thm m t Alt cho tt c nh"})}(!(r!=null&&r.metaDescription)||r.metaDescription.length<50)&&h.push({id:"meta-desc",type:"high",icon:"",message:"Meta Description cha ",action:"Vit m t hp dn 120-155 k t"}),(e.match(/<a /gi)||[]).length===0&&h.push({id:"no-links",type:"low",icon:"",message:"Cha c link trong bi",action:"Thm link internal n bi vit khc"});const w=$te(n);return f&&w&&!w.toLowerCase().includes(f)&&h.push({id:"first-para-keyword",type:"medium",icon:"",message:"Keyword cha c trong on m u",action:" cp keyword trong 100 t u tin"}),h},[t,e,n,r,s,i,o]),l=a.filter(h=>h.type==="high"),c=a.filter(h=>h.type==="medium"),u=a.filter(h=>h.type==="low");return a.length===0?d.jsxs("div",{className:"content-optimizer perfect",children:[d.jsxs("div",{className:"optimizer-header",children:[d.jsx("h4",{children:" Content Optimizer"}),d.jsx("span",{className:"perfect-badge",children:"Tuyt vi!"})]}),d.jsx("p",{className:"no-suggestions",children:"Khng c  xut ci thin. Bi vit  ti u tt!"})]}):d.jsxs("div",{className:"content-optimizer",children:[d.jsxs("div",{className:"optimizer-header",children:[d.jsx("h4",{children:" Content Optimizer"}),d.jsxs("span",{className:"suggestions-count",children:[a.length,"  xut"]})]}),l.length>0&&d.jsxs("div",{className:"suggestion-group high",children:[d.jsx("div",{className:"group-label",children:"u tin cao"}),l.map(h=>d.jsx(O0,{suggestion:h},h.id))]}),c.length>0&&d.jsxs("div",{className:"suggestion-group medium",children:[d.jsx("div",{className:"group-label",children:"Nn xem xt"}),c.map(h=>d.jsx(O0,{suggestion:h},h.id))]}),u.length>0&&d.jsxs("div",{className:"suggestion-group low",children:[d.jsx("div",{className:"group-label",children:"Ty chn"}),u.map(h=>d.jsx(O0,{suggestion:h},h.id))]})]})},O0=({suggestion:t})=>d.jsxs("div",{className:`suggestion-item ${t.type}`,children:[d.jsx("span",{className:"suggestion-icon",children:t.icon}),d.jsxs("div",{className:"suggestion-content",children:[d.jsx("div",{className:"suggestion-message",children:t.message}),d.jsx("div",{className:"suggestion-action",children:t.action})]})]}),zte=t=>{const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""},yA=(t,e)=>{if(!t)return 0;let n=0;const r=s=>{var i;s.type==="heading"&&((i=s.attrs)==null?void 0:i.level)===e&&n++,s.content&&s.content.forEach(r)};return r(t),n},$te=t=>{if(!(t!=null&&t.content))return"";for(const e of t.content)if(e.type==="paragraph"&&e.content)return e.content.map(n=>n.text||"").join("");return""},vA=()=>{var P,pe,Ee,je,oe,W,V,Z,ce,U,he,we,dt,st,it,$e,ae,Qt,Rn,$r,vr,Pn,tr,wr,xr,q,xe,Me,St,K,X,ie,ge,se,Ye,Ve,Jt,$,Ce,Re,He,Yt,Un,Mn,xi,as,Ur,ls;const{id:t}=Kg(),e=rl(),{addBlog:n,updateBlog:r,blogs:s,currentUser:i}=yn(),o=!!t,[a,l]=A.useState({...Mu,author:i?{id:i.id,name:i.displayName||"Anonymous",bio:"",expertise:"",avatar:i.photoURL||""}:null}),[c,u]=A.useState(!1),[h,f]=A.useState(!1),[m,g]=A.useState(null),[y,v]=A.useState([]),w=A.useRef(null);A.useEffect(()=>{if(o&&s.length>0){const H=s.find(Q=>Q.id===t);H?(l({...Mu,...H,seo:{...Mu.seo,...H.seo},keywords:{...Mu.keywords,...H.keywords},schema:{...Mu.schema,...H.schema}}),H.content&&typeof H.content=="object"&&g(H.content)):(alert("Khng tm thy bi vit!"),e("/blog"))}},[o,t,s,e]),A.useEffect(()=>{i&&!a.author&&l(H=>({...H,author:{id:i.id,name:i.displayName||"Anonymous",bio:"",expertise:"",avatar:i.photoURL||""}}))},[i,a.author]);const _=A.useCallback(H=>{l(Q=>{const _e=Q.slug===ua(Q.title)||!Q.slug?ua(H):Q.slug;return{...Q,title:H,slug:_e}})},[]),E=A.useCallback(({json:H,html:Q})=>{g(H),l(Mt=>({...Mt,content:H,contentHtml:Q}));const _e=Ute(H);v(_e)},[]),N=A.useCallback(H=>{v(Q=>[...Q,H])},[]),R=A.useCallback(H=>{l(Q=>({...Q,seo:H}))},[]),O=A.useCallback(H=>{l(Q=>({...Q,keywords:H}))},[]),S=A.useCallback(H=>{l(Q=>({...Q,searchIntent:H}))},[]),T=A.useCallback((H,Q)=>{w.current&&(w.current.switchToTab(H),w.current.focusField(Q))},[]),k=A.useMemo(()=>{const{seo:H,keywords:Q,title:_e,slug:Mt}=a,nr=Hte(m,2);return H.seoTitle&&H.seoTitle.length>=30&&H.metaDescription&&H.metaDescription.length>=120&&Q.primaryKeyword&&Q.primaryKeyword.trim()!==""&&nr>=1&&Mt&&Mt.trim()!==""&&_e&&_e.trim()!==""},[a,m]),I=async H=>{const Q=H.target.files[0];if(Q){if(!Q.type.startsWith("image/")){alert("Vui lng chn file nh!");return}if(Q.size>10*1024*1024){alert("File nh qu ln (ti a 10MB)");return}f(!0);try{const _e=await Ag(Q,"blog-covers");l(Mt=>({...Mt,coverImage:_e.url,seo:{...Mt.seo,ogImage:_e.url}}))}catch(_e){console.error("Upload failed:",_e),alert(`Ti nh tht bi: ${_e.message}`)}finally{f(!1),H.target.value=null}}},M=async(H="draft")=>{if(H==="published"&&!k){alert("Vui lng hon thnh tt c yu cu SEO trc khi ng!");return}u(!0);const Q={...a,status:H,canonicalUrl:`https://deskhub.vn/blog/${a.slug}`,excerpt:a.excerpt||a.seo.metaDescription,coverImage:a.coverImage||a.seo.ogImage,readTime:Wte(a.contentHtml)};try{if(o){const _e=await r(t,Q);_e.success?(alert(H==="published"?" ng bi thnh cng!":" lu nhp!"),e(`/blog/${t}`)):alert(`Li: ${_e.message}`)}else{const _e=await n(Q);_e.success?(alert(H==="published"?" ng bi thnh cng!":" lu nhp!"),e("/blog")):alert(`Li: ${_e.message}`)}}catch(_e){console.error("Save error:",_e),alert("C li xy ra khi lu bi vit!")}finally{u(!1)}},D=tD[a.searchIntent];return d.jsxs("div",{className:"seo-blog-editor",children:[d.jsxs("div",{className:"editor-header",children:[d.jsxs("div",{className:"header-left",children:[d.jsx("button",{type:"button",className:"back-btn",onClick:()=>e("/blog"),children:" Quay li"}),d.jsx("h1",{children:o?"Chnh Sa Bi Vit":"To Bi Vit Mi"})]}),d.jsxs("div",{className:"header-actions",children:[d.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>M("draft"),disabled:c,children:c?"ang lu...":"Lu Nhp"}),d.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>M("published"),disabled:c||!k,title:k?"":"Hon thnh cc yu cu SEO  ng bi",children:c?"ang ng...":"ng Bi"})]})]}),d.jsxs("div",{className:"editor-layout",children:[d.jsxs("div",{className:"editor-main",children:[d.jsxs("div",{className:"title-section",children:[d.jsx("input",{type:"text",value:a.title,onChange:H=>_(H.target.value),placeholder:"Tiu  bi vit (H1)",className:"title-input",maxLength:100}),d.jsxs("div",{className:"title-meta",children:[d.jsxs("span",{children:[a.title.length,"/100 k t"]}),d.jsx("span",{children:""}),d.jsxs("span",{children:["Slug: /",a.slug||"auto-generated"]})]})]}),d.jsxs("div",{className:"slug-section",children:[d.jsx("label",{children:"URL Slug:"}),d.jsxs("div",{className:"slug-input-wrapper",children:[d.jsx("span",{className:"slug-prefix",children:"deskhub.vn/blog/"}),d.jsx("input",{type:"text",value:a.slug,onChange:H=>l(Q=>({...Q,slug:ua(H.target.value)})),placeholder:"url-bai-viet",className:"slug-input"})]}),o&&d.jsxs("details",{className:"redirects-details",children:[d.jsxs("summary",{children:[" Qun l Redirect 301 (",(a.redirectsFrom||[]).length,")"]}),d.jsxs("div",{className:"redirects-content",children:[d.jsx("p",{className:"redirects-hint",children:"Thm URL c  t ng redirect v bi vit ny"}),(a.redirectsFrom||[]).map((H,Q)=>d.jsxs("div",{className:"redirect-item",children:[d.jsxs("span",{className:"old-url",children:["/blog/",H]}),d.jsx("span",{className:"redirect-arrow",children:""}),d.jsxs("span",{className:"new-url",children:["/blog/",a.slug]}),d.jsx("button",{type:"button",className:"remove-redirect",onClick:()=>l(_e=>({..._e,redirectsFrom:_e.redirectsFrom.filter((Mt,nr)=>nr!==Q)})),children:""})]},Q)),d.jsxs("div",{className:"add-redirect",children:[d.jsx("input",{type:"text",id:"new-redirect-slug",placeholder:"old-url-slug",className:"redirect-input"}),d.jsx("button",{type:"button",className:"add-redirect-btn",onClick:()=>{const H=document.getElementById("new-redirect-slug");H.value.trim()&&(l(Q=>({...Q,redirectsFrom:[...Q.redirectsFrom||[],ua(H.value.trim())]})),H.value="")},children:"+ Thm"})]})]})]})]}),d.jsxs("div",{className:"essential-seo-section",children:[d.jsxs("div",{className:"essential-seo-header",children:[d.jsx("span",{className:"essential-seo-icon",children:""}),d.jsx("h3",{children:"Thng tin SEO bt buc"})]}),d.jsxs("div",{className:"essential-seo-field",children:[d.jsxs("label",{htmlFor:"main-seo-title",children:["SEO Title ",d.jsx("span",{className:"required-star",children:"*"}),d.jsxs("span",{className:`field-counter ${(((pe=(P=a.seo)==null?void 0:P.seoTitle)==null?void 0:pe.length)||0)===0?"empty":(((je=(Ee=a.seo)==null?void 0:Ee.seoTitle)==null?void 0:je.length)||0)<30||(((W=(oe=a.seo)==null?void 0:oe.seoTitle)==null?void 0:W.length)||0)>60?"warning":"good"}`,children:[((Z=(V=a.seo)==null?void 0:V.seoTitle)==null?void 0:Z.length)||0,"/60"]})]}),d.jsx("input",{id:"main-seo-title",type:"text",value:((ce=a.seo)==null?void 0:ce.seoTitle)||"",onChange:H=>R({...a.seo,seoTitle:H.target.value}),placeholder:"Tiu  hin th trn Google (30-60 k t)",className:"essential-seo-input",maxLength:70}),(((he=(U=a.seo)==null?void 0:U.seoTitle)==null?void 0:he.length)||0)>0&&(((dt=(we=a.seo)==null?void 0:we.seoTitle)==null?void 0:dt.length)||0)<30&&d.jsx("span",{className:"field-hint warning",children:" Cn ti thiu 30 k t"}),((st=a.keywords)==null?void 0:st.primaryKeyword)&&((it=a.seo)==null?void 0:it.seoTitle)&&!a.seo.seoTitle.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase())&&d.jsxs("span",{className:"field-hint warning",children:[' Keyword "',a.keywords.primaryKeyword,'" cha c trong Title']}),(($e=a.keywords)==null?void 0:$e.primaryKeyword)&&((ae=a.seo)==null?void 0:ae.seoTitle)&&a.seo.seoTitle.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase())&&d.jsx("span",{className:"field-hint success",children:" Keyword c trong Title"})]}),d.jsxs("div",{className:"essential-seo-field",children:[d.jsxs("label",{htmlFor:"main-meta-desc",children:["Meta Description ",d.jsx("span",{className:"required-star",children:"*"}),d.jsxs("span",{className:`field-counter ${(((Rn=(Qt=a.seo)==null?void 0:Qt.metaDescription)==null?void 0:Rn.length)||0)===0?"empty":(((vr=($r=a.seo)==null?void 0:$r.metaDescription)==null?void 0:vr.length)||0)<120||(((tr=(Pn=a.seo)==null?void 0:Pn.metaDescription)==null?void 0:tr.length)||0)>155?"warning":"good"}`,children:[((xr=(wr=a.seo)==null?void 0:wr.metaDescription)==null?void 0:xr.length)||0,"/155"]})]}),d.jsx("textarea",{id:"main-meta-desc",value:((q=a.seo)==null?void 0:q.metaDescription)||"",onChange:H=>R({...a.seo,metaDescription:H.target.value}),placeholder:"M t ngn hin th trn kt qu tm kim (120-155 k t)",className:"essential-seo-input",rows:3,maxLength:160}),(((Me=(xe=a.seo)==null?void 0:xe.metaDescription)==null?void 0:Me.length)||0)>0&&(((K=(St=a.seo)==null?void 0:St.metaDescription)==null?void 0:K.length)||0)<120&&d.jsx("span",{className:"field-hint warning",children:" Cn ti thiu 120 k t"}),((X=a.keywords)==null?void 0:X.primaryKeyword)&&((ie=a.seo)==null?void 0:ie.metaDescription)&&!a.seo.metaDescription.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase())&&d.jsxs("span",{className:"field-hint warning",children:[' Keyword "',a.keywords.primaryKeyword,'" cha c trong Description']}),((ge=a.keywords)==null?void 0:ge.primaryKeyword)&&((se=a.seo)==null?void 0:se.metaDescription)&&a.seo.metaDescription.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase())&&d.jsx("span",{className:"field-hint success",children:" Keyword c trong Description"})]}),d.jsxs("div",{className:"essential-seo-field",children:[d.jsxs("label",{htmlFor:"main-primary-keyword",children:["Primary Keyword ",d.jsx("span",{className:"required-star",children:"*"})]}),d.jsx("input",{id:"main-primary-keyword",type:"text",value:((Ye=a.keywords)==null?void 0:Ye.primaryKeyword)||"",onChange:H=>O({...a.keywords,primaryKeyword:H.target.value}),placeholder:"T kha chnh bn mun xp hng trn Google",className:"essential-seo-input"}),!((Ve=a.keywords)!=null&&Ve.primaryKeyword)&&d.jsx("span",{className:"field-hint error",children:" Bt buc nhp Primary Keyword"})]}),a.slug&&d.jsxs("div",{className:"seo-warnings-box",children:[d.jsx("div",{className:"warnings-header",children:" Kim tra URL"}),d.jsxs("div",{className:"warnings-list",children:[a.slug.length>60?d.jsxs("div",{className:"warning-item error",children:[" URL qu di (",a.slug.length," k t). Nn di 60."]}):a.slug.length>50?d.jsxs("div",{className:"warning-item warning",children:[" URL hi di (",a.slug.length," k t). Nn 30-50."]}):d.jsxs("div",{className:"warning-item success",children:["  di URL tt (",a.slug.length," k t)"]}),((Jt=a.keywords)==null?void 0:Jt.primaryKeyword)&&(a.slug.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase().replace(/\s+/g,"-"))||a.slug.toLowerCase().includes(a.keywords.primaryKeyword.toLowerCase().replace(/\s+/g,""))?d.jsx("div",{className:"warning-item success",children:" URL cha keyword"}):d.jsxs("div",{className:"warning-item warning",children:[' URL nn cha keyword "',a.keywords.primaryKeyword,'"']}))]})]})]}),D&&d.jsxs("div",{className:"intent-suggestion",children:[d.jsx("span",{className:"intent-badge",children:D.label}),d.jsxs("span",{className:"intent-hint",children:["Cu trc  xut: ",D.suggestedStructure.join("  ")]})]}),d.jsx(Fte,{searchIntent:a.searchIntent,primaryKeyword:($=a.keywords)==null?void 0:$.primaryKeyword,onOutlineChange:H=>l(Q=>({...Q,outline:H})),existingOutline:a.outline||[]}),d.jsx("div",{className:"content-section",children:d.jsx(Ite,{content:m,onUpdate:E,onImageAdd:N,placeholder:"Bt u vit ni dung bi vit...",primaryKeyword:(Ce=a.keywords)==null?void 0:Ce.primaryKeyword})}),d.jsxs("div",{className:"cover-section",children:[d.jsx("label",{children:"nh Ba / OG Image:"}),a.coverImage?d.jsxs("div",{className:"cover-preview-container",children:[d.jsx("img",{src:a.coverImage,className:"cover-preview-img",alt:"Cover"}),d.jsx("button",{className:"remove-cover-btn",onClick:()=>l(H=>({...H,coverImage:"",seo:{...H.seo,ogImage:""}})),children:" G nh"})]}):d.jsxs("div",{className:"cover-upload-box",onClick:()=>document.getElementById("cover-upload").click(),children:[d.jsx("input",{id:"cover-upload",type:"file",accept:"image/*",onChange:I,style:{display:"none"},disabled:h}),d.jsx("div",{className:"upload-label",children:h?d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"upload-icon",children:""}),d.jsx("span",{children:"ang ti nh ln..."})]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{className:"upload-icon",children:""}),d.jsx("span",{children:"Nhn  ti nh ln"}),d.jsx("small",{children:"(Max 5MB)"})]})})]}),d.jsxs("details",{className:"url-fallback",children:[d.jsx("summary",{children:"Hoc nhp URL nh th cng"}),d.jsx("input",{type:"url",value:a.coverImage,onChange:H=>l(Q=>({...Q,coverImage:H.target.value,seo:{...Q.seo,ogImage:H.target.value}})),placeholder:"https://example.com/cover.jpg",className:"cover-input",style:{marginTop:"8px"}})]})]}),d.jsxs("div",{className:"excerpt-section",children:[d.jsx("label",{children:"M t ngn (Excerpt):"}),d.jsx("textarea",{value:a.excerpt,onChange:H=>l(Q=>({...Q,excerpt:H.target.value})),placeholder:"M t ngn v bi vit...",className:"excerpt-input",rows:3,maxLength:300})]}),d.jsxs("div",{className:"meta-section",children:[d.jsxs("div",{className:"meta-field",children:[d.jsx("label",{children:"Danh mc:"}),d.jsxs("select",{value:a.category,onChange:H=>l(Q=>({...Q,category:H.target.value})),className:"meta-select",children:[d.jsx("option",{value:"Hng Dn",children:"Hng Dn"}),d.jsx("option",{value:"Thit K",children:"Thit K"}),d.jsx("option",{value:"nh Gi",children:"nh Gi"}),d.jsx("option",{value:"Xu Hng",children:"Xu Hng"}),d.jsx("option",{value:"Mo",children:"Mo"})]})]}),d.jsxs("div",{className:"meta-field",children:[d.jsx("label",{children:"Tags (phn cch bng du phy):"}),d.jsx("input",{type:"text",value:((Re=a.tags)==null?void 0:Re.join(", "))||"",onChange:H=>l(Q=>({...Q,tags:H.target.value.split(",").map(_e=>_e.trim()).filter(Boolean)})),placeholder:"desk setup, productivity, gaming",className:"meta-input"})]})]}),d.jsx("div",{className:"index-section",children:d.jsxs("label",{className:"toggle-label",children:[d.jsx("input",{type:"checkbox",checked:a.noIndex,onChange:H=>l(Q=>({...Q,noIndex:H.target.checked}))}),d.jsx("span",{children:"No Index (khng cho Google index bi ny)"})]})}),d.jsxs("div",{className:"references-section",children:[d.jsxs("div",{className:"references-header",children:[d.jsx("span",{className:"references-icon",children:""}),d.jsx("h4",{children:"Ngun tham kho (E.E.A.T)"})]}),d.jsx("p",{className:"references-hint",children:"Thm ngun uy tn  tng  tin cy cho bi vit"}),d.jsx("div",{className:"references-list",children:(a.references||[]).map((H,Q)=>d.jsxs("div",{className:"reference-item",children:[d.jsxs("div",{className:"reference-info",children:[d.jsx("a",{href:H.url,target:"_blank",rel:"noopener noreferrer",children:H.title||H.url}),H.nofollow&&d.jsx("span",{className:"nofollow-badge",children:"nofollow"})]}),d.jsx("button",{type:"button",className:"remove-ref-btn",onClick:()=>{l(_e=>({..._e,references:_e.references.filter((Mt,nr)=>nr!==Q)}))},children:""})]},Q))}),d.jsxs("div",{className:"add-reference",children:[d.jsx("input",{type:"url",id:"new-ref-url",placeholder:"URL ngun (https://...)",className:"ref-input"}),d.jsx("input",{type:"text",id:"new-ref-title",placeholder:"Tiu  ngun",className:"ref-input"}),d.jsxs("div",{className:"ref-options",children:[d.jsxs("label",{className:"nofollow-toggle",children:[d.jsx("input",{type:"checkbox",id:"new-ref-nofollow"}),d.jsx("span",{children:"nofollow"})]}),d.jsx("button",{type:"button",className:"add-ref-btn",onClick:()=>{const H=document.getElementById("new-ref-url"),Q=document.getElementById("new-ref-title"),_e=document.getElementById("new-ref-nofollow");H.value.trim()&&(l(Mt=>({...Mt,references:[...Mt.references||[],{url:H.value.trim(),title:Q.value.trim()||H.value.trim(),nofollow:_e.checked}]})),H.value="",Q.value="",_e.checked=!1)},children:"+ Thm ngun"})]})]})]}),d.jsxs("div",{className:"schema-section",children:[d.jsxs("div",{className:"schema-header",children:[d.jsx("span",{className:"schema-icon",children:""}),d.jsx("h4",{children:"Schema Markup (Rich Results)"})]}),d.jsx("p",{className:"schema-hint",children:"Bt schema  hin th rich snippets trn Google"}),d.jsxs("div",{className:"schema-toggles",children:[d.jsxs("div",{className:"schema-toggle-item enabled",children:[d.jsxs("div",{className:"toggle-info",children:[d.jsx("span",{className:"toggle-icon",children:""}),d.jsxs("div",{children:[d.jsx("span",{className:"toggle-name",children:"Article Schema"}),d.jsx("span",{className:"toggle-desc",children:"Lun bt cho tt c bi vit"})]})]}),d.jsx("span",{className:"toggle-status active",children:" Active"})]}),d.jsxs("div",{className:"schema-toggle-item",children:[d.jsxs("div",{className:"toggle-info",children:[d.jsx("span",{className:"toggle-icon",children:""}),d.jsxs("div",{children:[d.jsx("span",{className:"toggle-name",children:"FAQ Schema"}),d.jsx("span",{className:"toggle-desc",children:"Hin th Q&A trn kt qu tm kim"})]})]}),d.jsxs("label",{className:"toggle-switch",children:[d.jsx("input",{type:"checkbox",checked:((He=a.schema)==null?void 0:He.enableFaqSchema)||!1,onChange:H=>l(Q=>({...Q,schema:{...Q.schema,enableFaqSchema:H.target.checked}}))}),d.jsx("span",{className:"toggle-slider"})]})]}),d.jsxs("div",{className:"schema-toggle-item",children:[d.jsxs("div",{className:"toggle-info",children:[d.jsx("span",{className:"toggle-icon",children:""}),d.jsxs("div",{children:[d.jsx("span",{className:"toggle-name",children:"Review Schema"}),d.jsx("span",{className:"toggle-desc",children:"Hin th nh gi sao trn Google"})]})]}),d.jsxs("label",{className:"toggle-switch",children:[d.jsx("input",{type:"checkbox",checked:((Yt=a.schema)==null?void 0:Yt.enableReviewSchema)||!1,onChange:H=>l(Q=>({...Q,schema:{...Q.schema,enableReviewSchema:H.target.checked}}))}),d.jsx("span",{className:"toggle-slider"})]})]}),((Un=a.schema)==null?void 0:Un.enableReviewSchema)&&d.jsxs("div",{className:"review-data-form",children:[d.jsxs("div",{className:"review-field",children:[d.jsx("label",{children:"Tn sn phm/dch v nh gi:"}),d.jsx("input",{type:"text",value:((xi=(Mn=a.schema)==null?void 0:Mn.reviewData)==null?void 0:xi.itemName)||"",onChange:H=>l(Q=>{var _e;return{...Q,schema:{...Q.schema,reviewData:{...(_e=Q.schema)==null?void 0:_e.reviewData,itemName:H.target.value}}}}),placeholder:"VD: Dell UltraSharp U2723QE",className:"review-input"})]}),d.jsxs("div",{className:"review-field",children:[d.jsx("label",{children:"im nh gi (1-5):"}),d.jsx("input",{type:"number",min:"1",max:"5",step:"0.1",value:((Ur=(as=a.schema)==null?void 0:as.reviewData)==null?void 0:Ur.rating)||5,onChange:H=>l(Q=>{var _e;return{...Q,schema:{...Q.schema,reviewData:{...(_e=Q.schema)==null?void 0:_e.reviewData,rating:parseFloat(H.target.value)}}}}),className:"review-input rating-input"})]})]})]})]})]}),d.jsxs("div",{className:"editor-sidebar",children:[d.jsx(Ate,{ref:w,seoData:a.seo,onChange:R,content:a.contentHtml,keywords:a.keywords,onKeywordsChange:O,searchIntent:a.searchIntent,onIntentChange:S}),d.jsx(Mte,{primaryKeyword:a.keywords.primaryKeyword,title:a.title,content:a.contentHtml,contentJson:m}),d.jsx(Ote,{title:a.title,content:a.contentHtml,contentJson:m,primaryKeyword:(ls=a.keywords)==null?void 0:ls.primaryKeyword}),d.jsx(Bte,{title:a.title,content:a.contentHtml,contentJson:m,seoData:a.seo,keywords:a.keywords,images:y,wordCount:a.contentHtml?a.contentHtml.replace(/<[^>]+>/g,"").split(/\s+/).filter(Boolean).length:0}),d.jsx(Dte,{seoData:a.seo,keywords:a.keywords,title:a.title,slug:a.slug,content:a.contentHtml,contentJson:m,images:y,author:a.author,onNavigate:T})]})]})]})};function Ute(t){const e=[];if(!t||!t.content)return e;function n(r){var s,i;r.type==="image"&&e.push({url:(s=r.attrs)==null?void 0:s.src,alt:((i=r.attrs)==null?void 0:i.alt)||""}),r.content&&r.content.forEach(n)}return n(t),e}function Hte(t,e){let n=0;if(!t||!t.content)return n;function r(s){var i;s.type==="heading"&&((i=s.attrs)==null?void 0:i.level)===e&&n++,s.content&&s.content.forEach(r)}return r(t),n}function Wte(t){if(!t)return 5;const e=document.createElement("div");e.innerHTML=t;const r=(e.textContent||"").split(/\s+/).filter(Boolean).length;return Math.max(1,Math.ceil(r/200))}const aV=({onClose:t,onSave:e,initialData:n=null})=>{var Ee,je,oe,W;const[r,s]=A.useState({title:(n==null?void 0:n.title)||"",caption:(n==null?void 0:n.caption)||"",authorName:((Ee=n==null?void 0:n.author)==null?void 0:Ee.name)||"",authorAvatar:((je=n==null?void 0:n.author)==null?void 0:je.avatar)||"",filters:(n==null?void 0:n.filters)||{colorTone:"neutral",budget:"mid-range",gender:"neutral",purpose:"productivity",size:"medium"},tags:((oe=n==null?void 0:n.tags)==null?void 0:oe.join(", "))||""}),[i,o]=A.useState(()=>n!=null&&n.media&&n.media.length>0?n.media:n!=null&&n.image?[{id:Date.now().toString(),type:"image",url:n.image,products:n.products||[]}]:[]),[a,l]=A.useState(null),[c,u]=A.useState(!1),[h,f]=A.useState(null),[m,g]=A.useState(((W=n==null?void 0:n.author)==null?void 0:W.avatar)||"");A.useEffect(()=>{i.length>0&&!a&&l(i[0].id)},[i,a]);const y=i.find(V=>V.id===a),[v,w]=A.useState(null),[_,E]=A.useState(!1),N=A.useRef(null),R=(V,Z)=>{o(ce=>ce.map(U=>U.id===V?{...U,...Z}:U))},O=V=>{const{name:Z,value:ce}=V.target;if(Z.startsWith("filter.")){const U=Z.split(".")[1];s(he=>({...he,filters:{...he.filters,[U]:ce}}))}else s(U=>({...U,[Z]:ce}))},S=V=>{const Z=Array.from(V.target.files);if(Z.length===0)return;const ce=Z.map(U=>U.size>10*1024*1024?(alert(`nh ${U.name} qu ln (>10MB).`),null):{id:Date.now()+Math.random().toString(),type:"image",url:URL.createObjectURL(U),file:U,products:[]}).filter(Boolean);o(U=>[...U,...ce]),!a&&ce.length>0&&l(ce[0].id)},T=(V,Z)=>{var U;Z.stopPropagation();const ce=i.filter(he=>he.id!==V);o(ce),a===V&&l(((U=ce[0])==null?void 0:U.id)||null)},k=V=>{const Z=V.target.files[0];if(Z){if(Z.size>5*1024*1024){alert("Avatar qu ln (>5MB).");return}f(Z),g(URL.createObjectURL(Z))}},I=V=>{if(!y||y.type!=="image")return;const Z=N.current.getBoundingClientRect(),ce=(V.clientX-Z.left)/Z.width*100,U=(V.clientY-Z.top)/Z.height*100,he={id:Date.now().toString(),x:ce,y:U,name:"",price:"",link:""};w(he),E(!0)},M=(V,Z)=>{V.stopPropagation(),w(Z),E(!0)},D=()=>{if(!v.name)return alert("Vui lng nhp tn sn phm");const V=y.products||[],Z=V.find(U=>U.id===v.id);let ce;Z?ce=V.map(U=>U.id===v.id?v:U):ce=[...V,v],R(a,{products:ce}),w(null),E(!1)},P=()=>{const Z=(y.products||[]).filter(ce=>ce.id!==v.id);R(a,{products:Z}),w(null),E(!1)},pe=async V=>{var Z,ce,U;V.preventDefault(),console.log(" Form submission started"),u(!0);try{if(i.length===0){alert("Vui lng thm t nht mt nh hoc video!"),u(!1);return}console.log(" Processing media uploads...");let he=m;if(h)try{console.log(" Uploading avatar to Cloudinary..."),he=(await Ag(h,"avatars")).url,console.log(" Avatar uploaded to Cloudinary:",he)}catch($e){console.error(" Avatar upload failed:",$e),he="https://ui-avatars.com/api/?name="+encodeURIComponent(r.authorName||"User")}const we=await Promise.all(i.map(async $e=>{if($e.file)try{console.log(` Uploading image to Cloudinary: ${$e.file.name}`);const ae=await Ag($e.file,"desk-setups");return console.log(" Image uploaded to Cloudinary:",ae.url),{...$e,url:ae.url,file:null}}catch(ae){throw console.error(" Image upload failed:",ae),new Error(`Khng th ti nh "${$e.file.name}": ${ae.message}`)}return $e}));console.log(" Media processing complete:",we);const dt=r.tags.split(",").map($e=>$e.trim()).filter($e=>$e),st=we.filter($e=>$e.type==="image").map($e=>({url:$e.url,products:$e.products||[]})),it={title:r.caption.substring(0,50)||"Setup",caption:r.caption,filters:r.filters,tags:dt,author:{name:r.authorName||"Anonymous",avatar:he||"https://ui-avatars.com/api/?name="+encodeURIComponent(r.authorName||"User")},images:st,media:we,mainImage:((Z=we[0])==null?void 0:Z.url)||"",image:((ce=we[0])==null?void 0:ce.url)||"",products:((U=st[0])==null?void 0:U.products)||[],updatedAt:new Date().toISOString()};console.log(" Final setupData to save:",it),console.log(" Calling onSave..."),n!=null&&n.id?await e(n.id,it):await e(it),console.log(" onSave completed successfully")}catch(he){console.error(" Form submission error:",he),alert(he.message||"C li xy ra khi lu setup.")}finally{u(!1)}};return d.jsx("div",{className:"modal-overlay",onClick:t,children:d.jsxs("div",{className:"modal-content add-setup-modal",onClick:V=>V.stopPropagation(),children:[d.jsxs("div",{className:"modal-header",children:[d.jsx("h2",{children:n?"Chnh Sa Setup":"Thm Gc Setup Mi"}),d.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[c&&d.jsx("span",{style:{color:"var(--accent-color)"},children:" ang ti ln... Vui lng ch"}),d.jsx("button",{className:"close-btn",onClick:t,children:""})]})]}),d.jsx("div",{className:"add-setup-body",children:d.jsxs("form",{id:"setupForm",onSubmit:pe,className:"setup-form-layout",children:[d.jsxs("div",{className:"form-column",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"M t"}),d.jsx("textarea",{name:"caption",value:r.caption,onChange:O,required:!0,placeholder:"M t v gc setup ny...",rows:"4"})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Media (nh/Video)"}),d.jsxs("div",{className:"media-gallery-preview",children:[i.map(V=>d.jsxs("div",{className:`media-thumb ${a===V.id?"active":""}`,onClick:()=>l(V.id),children:[V.type==="video"&&V.platform==="youtube"?d.jsxs(d.Fragment,{children:[d.jsx("img",{src:V.thumb||V.thumbnail,alt:"yt-thumb",style:{opacity:.8}}),d.jsx("div",{className:"video-icon",style:{fontSize:"12px"},children:""})]}):V.type==="video"?d.jsx("div",{className:"video-icon",children:""}):d.jsx("img",{src:V.url,alt:"thumb"}),d.jsx("button",{type:"button",className:"btn-remove-media",onClick:Z=>T(V.id,Z),children:""})]},V.id)),d.jsxs("label",{className:"add-media-btn",children:[d.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:S,style:{display:"none"}}),d.jsx("span",{children:"+ Thm"})]})]}),d.jsx("small",{style:{display:"block",marginTop:"5px",color:"#888"},children:"H tr ti a 8 nh (Max 10MB/nh)."})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tn ngi ng"}),d.jsx("input",{type:"text",name:"authorName",value:r.authorName,onChange:O,placeholder:"Nhp tn ngi ng..."})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Avatar ngi ng"}),d.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[m&&d.jsx("img",{src:m,alt:"Avatar preview",style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover",border:"2px solid var(--color-border)"}}),d.jsxs("label",{className:"btn btn-secondary",style:{cursor:"pointer",margin:0},children:[d.jsx("input",{type:"file",accept:"image/*",onChange:k,style:{display:"none"}}),m?"i Avatar":"Ti Avatar"]})]}),d.jsx("small",{style:{display:"block",marginTop:"5px",color:"#888"},children:"nh i din ca ngi ng (Max 5MB)"})]}),d.jsxs("div",{className:"form-row",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tng mu"}),d.jsx("select",{name:"filter.colorTone",value:r.filters.colorTone,onChange:O,children:Rl.colorTone.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Ngn sch"}),d.jsx("select",{name:"filter.budget",value:r.filters.budget,onChange:O,children:Rl.budget.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))})]})]}),d.jsxs("div",{className:"form-row",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Phong cch"}),d.jsx("select",{name:"filter.gender",value:r.filters.gender,onChange:O,children:Rl.gender.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Mc ch"}),d.jsx("select",{name:"filter.purpose",value:r.filters.purpose,onChange:O,children:Rl.purpose.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))})]})]}),d.jsxs("div",{className:"form-row",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Khng gian"}),d.jsx("select",{name:"filter.size",value:r.filters.size,onChange:O,children:Rl.size.map(V=>d.jsx("option",{value:V.value,children:V.label},V.value))})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tags (ngn cch bi du phy)"}),d.jsx("input",{type:"text",name:"tags",value:r.tags,onChange:O,placeholder:"gaming, minimal, rgb..."})]})]})]}),d.jsxs("div",{className:"form-column",children:[d.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:"500"},children:y?y.type==="video"||y.type==="youtube"?"Xem Video (Khng h tr gn th)":"Gn Th Sn Phm (Click vo nh)":"Xem trc"}),d.jsx("div",{className:"image-tagging-area",children:y?y.type==="video"?d.jsx("video",{src:y.url,controls:!0,className:"tagging-image",style:{maxHeight:"100%"}}):y.type==="youtube"?d.jsx("iframe",{width:"100%",height:"100%",src:y.url,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{aspectRatio:"16/9",borderRadius:"8px"}}):d.jsxs("div",{className:"image-wrapper",ref:N,onClick:I,children:[d.jsx("img",{src:y.url,alt:"Tagging Area",className:"tagging-image"}),y.products.map(V=>d.jsx("div",{className:`tag-marker ${(v==null?void 0:v.id)===V.id?"active":""}`,style:{left:`${V.x}%`,top:`${V.y}%`},onClick:Z=>M(Z,V),children:"+"},V.id)),v&&!y.products.find(V=>V.id===v.id)&&d.jsx("div",{className:"tag-marker active",style:{left:`${v.x}%`,top:`${v.y}%`},children:" + "}),_&&v&&d.jsxs("div",{className:"tag-popup",style:{left:`${Math.min(v.x,60)}%`,top:`${Math.min(v.y+5,80)}%`},onClick:V=>V.stopPropagation(),children:[d.jsx("h4",{children:y.products.find(V=>V.id===v.id)?"Sa Sn Phm":"Thm Sn Phm"}),d.jsx("div",{className:"form-group",children:d.jsx("input",{autoFocus:!0,placeholder:"Tn sn phm",value:v.name,onChange:V=>w({...v,name:V.target.value})})}),d.jsx("div",{className:"form-group",children:d.jsx("input",{placeholder:"Gi",value:v.price,onChange:V=>w({...v,price:V.target.value})})}),d.jsx("div",{className:"form-group",children:d.jsx("input",{placeholder:"Link (ty chn)",value:v.link,onChange:V=>w({...v,link:V.target.value})})}),d.jsxs("div",{className:"popup-actions",children:[d.jsx("button",{type:"button",className:"btn-small btn-delete",onClick:()=>{y.products.find(V=>V.id===v.id)?P():(w(null),E(!1))},children:"Xa"}),d.jsx("button",{type:"button",className:"btn-small btn-submit",onClick:D,children:"Lu"})]})]})]}):d.jsx("div",{className:"placeholder-text",children:"Chn hoc ti ln media  bt u custom"})})]})]})}),d.jsxs("div",{className:"form-actions",children:[d.jsx("button",{type:"button",className:"btn-cancel",onClick:t,children:"Hy"}),d.jsx("button",{type:"submit",form:"setupForm",className:"btn-submit",disabled:c,children:c?"ang Upload...":"ng Setup"})]})]})})},qte=()=>{const{setups:t,blogs:e,getComments:n,currentUser:r,addSetup:s,updateSetup:i,deleteSetup:o,refreshData:a}=yn(),[l,c]=A.useState(null),[u,h]=A.useState(new Set),[f,m]=A.useState({startDate:"",endDate:""}),g=T=>{T.target.checked?h(new Set(t.map(k=>k.id))):h(new Set)},y=T=>{const k=new Set(u);k.has(T)?k.delete(T):k.add(T),h(k)},v=async()=>{if(u.size!==0&&confirm(`Bn c chc chn mun xa ${u.size} setup  chn khng?`))try{const T=Array.from(u).map(k=>o(k));await Promise.all(T),h(new Set),alert(" xa cc setup  chn!")}catch(T){console.error("Bulk delete failed:",T),alert("C li xy ra khi xa hng lot.")}},w=async(T,k)=>{if(k){const I=await i(T,k);I.success?(c(null),alert(" cp nht setup thnh cng!")):alert(I.message||"Li cp nht")}else{const I=await s(T);I.success?alert(" thm setup thnh cng!"):alert(I.message||"C li xy ra")}},_=T=>{c(T)},E=async(T,k)=>{if(window.confirm(`Bn c chc mun xa setup "${k}" khng?`)){const I=await o(T);I.success||alert(I.message||"Xa tht bi")}},N=T=>{if(!T)return!1;const k=new Date(T);if(f.startDate){const I=f.startDate.split("-"),M=new Date(I[0],I[1]-1,I[2],0,0,0,0);if(k<M)return!1}if(f.endDate){const I=f.endDate.split("-"),M=new Date(I[0],I[1]-1,I[2],23,59,59,999);if(k>M)return!1}return!0},R=A.useMemo(()=>{const T=t.filter(P=>N(P.createdAt)).length,k=e.filter(P=>N(P.publishedAt)).length;let I=0,M=0,D=0;return t.forEach(P=>{Array.isArray(P.likes)&&(I+=P.likes.filter(Ee=>typeof Ee=="object"?N(Ee.timestamp):!0).length),Array.isArray(P.saves)&&(M+=P.saves.filter(Ee=>typeof Ee=="object"?N(Ee.timestamp):!0).length);const pe=n(P.id);D+=pe.filter(Ee=>N(Ee.timestamp)).length}),{totalSetups:T,totalBlogs:k,totalLikes:I,totalSaves:M,totalComments:D}},[t,e,f,n]),O=A.useMemo(()=>t.map(T=>{const k=n(T.id),I=(T.likes||[]).filter(P=>typeof P=="object"?N(P.timestamp):!0).length,M=(T.saves||[]).filter(P=>typeof P=="object"?N(P.timestamp):!0).length,D=k.filter(P=>N(P.timestamp)).length;return{...T,rangeLikeCount:I,rangeSaveCount:M,rangeCommentCount:D,engagement:I*2+M*3+D*1}}).sort((T,k)=>k.engagement-T.engagement).slice(0,5),[t,f,n]),S=A.useMemo(()=>{const T={};return t.filter(I=>N(I.createdAt)).forEach(I=>{const M=I.filters.purpose||"Other";T[M]||(T[M]=0),T[M]++}),Object.entries(T).sort((I,M)=>M[1]-I[1])},[t,f]);return!r||r.role!=="admin"?d.jsx("div",{className:"admin-dashboard-error",children:"Access Denied"}):d.jsxs("div",{className:"admin-dashboard",children:[d.jsxs("header",{className:"dashboard-header",children:[d.jsxs("div",{children:[d.jsx("h1",{children:"Admin Dashboard"}),d.jsxs("p",{children:["Welcome back, ",r.displayName]})]}),d.jsxs("div",{className:"header-actions",style:{display:"flex",gap:"1rem",alignItems:"center"},children:[d.jsx("button",{className:"btn",onClick:async()=>{confirm("Ti li d liu t server/local?")&&(await a(),alert(" cp nht!"))},style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"0.5rem 1rem",borderRadius:"8px",border:"1px solid var(--border-color)",cursor:"pointer"},children:" Khi phc D liu"}),d.jsxs("div",{className:"dashboard-filter",children:[d.jsx("span",{className:"filter-label",children:"Lc:"}),d.jsx("input",{type:"date",className:"date-input",value:f.startDate,onChange:T=>m(k=>({...k,startDate:T.target.value}))}),d.jsx("span",{className:"filter-separator",children:"-"}),d.jsx("input",{type:"date",className:"date-input",value:f.endDate,onChange:T=>m(k=>({...k,endDate:T.target.value}))}),(f.startDate||f.endDate)&&d.jsx("button",{className:"btn-clear",onClick:()=>m({startDate:"",endDate:""}),children:""})]})]})]}),d.jsxs("div",{className:"stats-grid",children:[d.jsxs("div",{className:"stat-card",children:[d.jsx("h3",{children:"Tng Lt Thch"}),d.jsx("div",{className:"stat-value",children:R.totalLikes}),d.jsxs("div",{className:"stat-trend positive",children:[" ",f.startDate||f.endDate?"Trong khong":"Tt c"]})]}),d.jsxs("div",{className:"stat-card",children:[d.jsx("h3",{children:"Tng Lt Lu"}),d.jsx("div",{className:"stat-value",children:R.totalSaves}),d.jsxs("div",{className:"stat-trend positive",children:[" ",f.startDate||f.endDate?"Trong khong":"Tt c"]})]}),d.jsxs("div",{className:"stat-card",children:[d.jsx("h3",{children:"Tng Bnh Lun"}),d.jsx("div",{className:"stat-value",children:R.totalComments}),d.jsx("div",{className:"stat-trend",children:" Tho lun"})]}),d.jsxs("div",{className:"stat-card",children:[d.jsx("h3",{children:"Tng Setup Mi"}),d.jsx("div",{className:"stat-value",children:R.totalSetups}),d.jsx("div",{className:"stat-trend",children:" Bi ng"})]})]}),d.jsxs("div",{className:"dashboard-layout",children:[d.jsxs("div",{className:"dashboard-section manage-section",children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsxs("h2",{children:[" Qun L Tt C Setup (",t.length,")"]}),u.size>0&&d.jsxs("div",{className:"bulk-actions",style:{margin:0},children:[d.jsxs("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:[" chn ",u.size]}),d.jsxs("button",{onClick:v,className:"btn-bulk-delete",children:[" Xa ",u.size," Setup"]})]})]}),d.jsx("div",{className:"ranking-table-wrapper",style:{maxHeight:"400px",overflowY:"auto"},children:d.jsxs("table",{className:"ranking-table",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{className:"checkbox-col",children:d.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:t.length>0&&u.size===t.length,onChange:g})}),d.jsx("th",{children:"Setup"}),d.jsx("th",{children:"Ngy to"}),d.jsx("th",{children:"Thng k (Like/Save/Cmt)"}),d.jsx("th",{children:"Hnh ng"})]})}),d.jsx("tbody",{children:t.map(T=>{var k,I;return d.jsxs("tr",{style:{background:u.has(T.id)?"var(--bg-secondary)":"transparent"},children:[d.jsx("td",{className:"checkbox-col",children:d.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:u.has(T.id),onChange:()=>y(T.id)})}),d.jsx("td",{children:d.jsxs("div",{className:"setup-cell",children:[d.jsx("img",{src:T.mainImage,alt:"",className:"setup-thumb"}),d.jsx("span",{className:"setup-title",title:T.title,children:T.title})]})}),d.jsx("td",{children:new Date(T.createdAt).toLocaleDateString("vi-VN")}),d.jsxs("td",{children:[((k=T.likes)==null?void 0:k.length)||0," / ",((I=T.saves)==null?void 0:I.length)||0," / ",T.comments||0]}),d.jsxs("td",{children:[d.jsx("button",{className:"btn-edit",onClick:()=>_(T),title:"Sa setup ny",style:{marginRight:"0.5rem",background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem"},children:""}),d.jsx("button",{className:"btn-delete",onClick:()=>E(T.id,T.title),title:"Xa setup ny",children:""})]})]},T.id)})})]})})]}),d.jsxs("div",{className:"dashboard-section ranking-section",children:[d.jsx("h2",{children:" BXH Tng Tc Top 5"}),d.jsx("div",{className:"ranking-table-wrapper",children:d.jsxs("table",{className:"ranking-table",children:[d.jsx("thead",{children:d.jsxs("tr",{children:[d.jsx("th",{children:"Rank"}),d.jsx("th",{children:"Setup"}),d.jsx("th",{children:"im"})]})}),d.jsx("tbody",{children:O.map((T,k)=>d.jsxs("tr",{children:[d.jsx("td",{children:d.jsxs("span",{className:`rank-badge rank-${k+1}`,children:["#",k+1]})}),d.jsx("td",{children:d.jsxs("div",{className:"setup-cell",children:[d.jsx("img",{src:T.mainImage,alt:"",className:"setup-thumb"}),d.jsx("span",{className:"setup-title",children:T.title})]})}),d.jsx("td",{children:d.jsx("strong",{children:T.engagement})})]},T.id))})]})})]}),d.jsxs("div",{className:"dashboard-section insights-section",children:[d.jsx("h2",{children:" Xu Hng"}),d.jsxs("div",{className:"insights-card",children:[d.jsx("h3",{children:"Danh Mc Ph Bin"}),S.length>0?d.jsx("ul",{className:"category-list",children:S.map(([T,k])=>d.jsxs("li",{className:"category-item",children:[d.jsx("span",{className:"category-name",children:T.replace("-"," ")}),d.jsx("div",{className:"progress-bar",children:d.jsx("div",{className:"progress-fill",style:{width:`${k/R.totalSetups*100}%`}})}),d.jsx("span",{className:"category-count",children:k})]},T))}):d.jsx("p",{className:"no-data",children:"Khng c d liu."})]})]})]}),l&&d.jsx(aV,{initialData:l,onClose:()=>c(null),onSave:w})]})},Kte=()=>{const{showAuthModal:t,setShowAuthModal:e}=yn(),[n,r]=A.useState("login"),[s,i]=A.useState(""),[o,a]=A.useState(""),[l,c]=A.useState(""),[u,h]=A.useState(""),[f,m]=A.useState(""),[g,y]=A.useState(!1),[v,w]=A.useState("");if(!t)return null;const _=()=>{e(!1),m(""),i(""),a(""),c(""),h("")},E=async N=>{N.preventDefault(),m(""),w(""),y(!0);try{if(n==="login")await Zt.login(s,o),w("ng nhp thnh cng!"),setTimeout(()=>{_(),w(""),y(!1)},500);else{if(!l){m("Vui lng nhp tn hin th"),y(!1);return}await Zt.register({email:s,password:o,displayName:l,username:u}),w("ng k thnh cng!"),setTimeout(()=>{_(),w(""),y(!1)},500)}}catch(R){console.error(R),y(!1),R.code==="auth/wrong-password"||R.code==="auth/user-not-found"||R.code==="auth/invalid-credential"?m("Email hoc mt khu khng ng"):R.code==="auth/email-already-in-use"?m("Email  c s dng"):m(" c li xy ra: "+R.message)}};return d.jsx("div",{className:"modal-overlay",onClick:N=>N.target===N.currentTarget&&_(),children:d.jsxs("div",{className:"auth-modal modal-content",children:[d.jsx("button",{className:"modal-close-btn",onClick:_,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsxs("div",{className:"auth-content",children:[d.jsx("h2",{children:n==="login"?"ng Nhp":"ng K"}),d.jsx("p",{className:"auth-subtitle",children:n==="login"?"ng nhp  lu setup yu thch v vit bnh lun":"To ti khon mi  tham gia cng ng DeskHub"}),f&&d.jsx("div",{className:"auth-error",children:f}),v&&d.jsx("div",{className:"auth-error",style:{color:"#059669",borderColor:"#059669",backgroundColor:"#ecfdf5"},children:v}),d.jsxs("form",{onSubmit:E,className:"auth-form",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Email"}),d.jsx("input",{type:"email",className:"input",value:s,onChange:N=>i(N.target.value),placeholder:"name@example.com",required:!0})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Mt khu"}),d.jsx("input",{type:"password",className:"input",value:o,onChange:N=>a(N.target.value),placeholder:"",required:!0,minLength:6})]}),n==="register"&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tn hin th"}),d.jsx("input",{type:"text",className:"input",value:l,onChange:N=>c(N.target.value),placeholder:"Tn ca bn",required:!0})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Username"}),d.jsx("input",{type:"text",className:"input",value:u,onChange:N=>h(N.target.value),placeholder:"username",required:!0,pattern:"[a-zA-Z0-9_-]+",title:"Ch cha ch ci, s, gch ngang v gch di"})]})]}),d.jsx("button",{type:"submit",className:"btn btn-primary auth-submit",disabled:g,style:{opacity:g?.7:1,cursor:g?"wait":"pointer"},children:g?"ang x l...":n==="login"?"ng Nhp":"ng K"})]}),d.jsx("div",{className:"auth-switch",children:n==="login"?d.jsxs("p",{children:["Cha c ti khon?"," ",d.jsx("button",{onClick:()=>r("register"),className:"link-btn",children:"ng k ngay"})]}):d.jsxs("p",{children:[" c ti khon?"," ",d.jsx("button",{onClick:()=>r("login"),className:"link-btn",children:"ng nhp"})]})}),d.jsx("div",{className:"auth-divider",children:d.jsx("span",{children:"hoc"})}),d.jsx("button",{className:"btn btn-secondary",onClick:_,children:"Tip tc vi ti khon Khch"}),d.jsx("p",{className:"auth-note",children:d.jsx("small",{children:"Ti khon Khch s dng IP my  lu d liu. D liu s c gi trn thit b ny."})})]})]})})},Gte=()=>{const{showProfileModal:t,setShowProfileModal:e,refreshUser:n,currentUser:r,logout:s}=yn(),[i,o]=A.useState((r==null?void 0:r.displayName)||""),[a,l]=A.useState((r==null?void 0:r.avatar)||""),[c,u]=A.useState("");if(!t)return null;const h=()=>{e(!1),u("")},f=async y=>{if(y.preventDefault(),u(""),r!=null&&r.isGuest)c5(i),n(),u(" cp nht tn hin th!"),setTimeout(()=>h(),1500);else try{const v=a&&a.startsWith("data:");if(uc.currentUser){const _={displayName:i};v||(_.photoURL=a),await fO(uc.currentUser,_)}const w=Wn(Ut,"users",r.id);await Mi(w,{displayName:i,avatar:a}),u("Cp nht thnh cng! ang ti li..."),setTimeout(()=>window.location.reload(),500)}catch(v){console.error(v),u("Li: "+v.message)}},m=y=>{const v=y.target.files[0];if(v){if(v.size>2e6)return alert("File qu ln (>2MB)");const w=new FileReader;w.onloadend=()=>{l(w.result)},w.readAsDataURL(v)}},g=async()=>{confirm("Bn c chc mun ng xut?")&&(await s(),h())};return d.jsx("div",{className:"modal-overlay",onClick:y=>y.target===y.currentTarget&&h(),children:d.jsxs("div",{className:"profile-modal modal-content",children:[d.jsx("button",{className:"modal-close-btn",onClick:h,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsxs("div",{className:"profile-content",children:[d.jsxs("div",{className:"profile-header",children:[d.jsx("img",{src:r==null?void 0:r.avatar,alt:r==null?void 0:r.displayName,className:"profile-avatar-large"}),d.jsx("h2",{children:r==null?void 0:r.displayName}),d.jsx("p",{className:"profile-role",children:r!=null&&r.isGuest?" Ti khon Khch":" Thnh vin"})]}),c&&d.jsx("div",{className:"profile-message success",children:c}),r!=null&&r.isGuest?d.jsxs("form",{onSubmit:f,className:"profile-form",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tn hin th"}),d.jsx("input",{type:"text",className:"input",value:i,onChange:y=>o(y.target.value),placeholder:"Tn ca bn",required:!0})]}),d.jsx("button",{type:"submit",className:"btn btn-primary",children:"Lu Thay i"})]}):d.jsxs("form",{onSubmit:f,className:"profile-form",children:[d.jsxs("div",{className:"form-group profile-avatar-edit",children:[d.jsx("label",{children:"nh i Din"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[d.jsx("img",{src:a||r.photoURL,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover",border:"2px solid var(--border-color)"},alt:"Avatar"}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"avatar-upload",className:"btn btn-primary",style:{padding:"0.4rem 0.8rem",fontSize:"0.85rem"},children:"Thay i"}),d.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:m,style:{display:"none"}})]})]})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tn hin th"}),d.jsx("input",{type:"text",className:"input",value:i,onChange:y=>o(y.target.value),placeholder:"Tn ca bn",required:!0})]}),d.jsxs("div",{className:"profile-info-readonly",style:{margin:"1rem 0",opacity:.8,fontSize:"0.9rem",background:"var(--bg-secondary)",padding:"0.75rem",borderRadius:"8px"},children:[d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[d.jsx("strong",{children:"Email:"})," ",r.email]}),d.jsxs("div",{children:[d.jsx("strong",{children:"Vai tr:"})," ",(r==null?void 0:r.role)==="admin"?"Qun tr vin":"Thnh vin"]})]}),d.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},children:"Lu Thay i"})]}),!(r!=null&&r.isGuest)&&d.jsx("button",{className:"btn btn-secondary logout-btn",onClick:g,children:"ng Xut"}),d.jsx("div",{className:"profile-note",children:d.jsx("small",{children:r!=null&&r.isGuest?"D liu ca bn c lu trn thit b ny. To ti khon  ng b trn nhiu thit b.":"Ti khon ca bn  c ng k v c th s dng trn nhiu thit b."})})]})]})})},Qte=()=>{const{showNewsletterModal:t,setShowNewsletterModal:e,subscribeNewsletter:n}=yn(),[r,s]=A.useState(""),[i,o]=A.useState(""),[a,l]=A.useState(""),[c,u]=A.useState(!1);if(!t)return null;const h=()=>{e(!1),s(""),o(""),l(""),u(!1)},f=async m=>{m.preventDefault();try{(await n({email:r,name:i})).success?(l("ng k thnh cng! Cm n bn."),u(!0),setTimeout(()=>{h()},2e3)):(l(" c li xy ra. Vui lng th li."),u(!1))}catch(g){l("Li: "+g.message),u(!1)}};return d.jsx("div",{className:"modal-overlay",onClick:m=>m.target===m.currentTarget&&h(),children:d.jsxs("div",{className:"newsletter-modal modal-content",children:[d.jsx("button",{className:"modal-close-btn",onClick:h,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsxs("div",{className:"newsletter-content",children:[d.jsx("div",{className:"newsletter-icon",children:d.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",children:[d.jsx("circle",{cx:"32",cy:"32",r:"30",fill:"url(#newsletter-gradient)",opacity:"0.1"}),d.jsx("path",{d:"M16 24l16 12 16-12M16 24v24h32V24M16 24h32",stroke:"url(#newsletter-gradient)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("defs",{children:d.jsxs("linearGradient",{id:"newsletter-gradient",x1:"0",y1:"0",x2:"64",y2:"64",children:[d.jsx("stop",{offset:"0%",stopColor:"hsl(220, 90%, 56%)"}),d.jsx("stop",{offset:"100%",stopColor:"hsl(280, 70%, 60%)"})]})})]})}),d.jsx("h2",{children:"ng K Newsletter"}),d.jsx("p",{className:"newsletter-subtitle",children:"Nhn nhng setup p nht mi tun v tips thit k workspace t DeskHub"}),a&&d.jsx("div",{className:`newsletter-message ${c?"success":"error"}`,children:a}),d.jsxs("form",{onSubmit:f,className:"newsletter-form",children:[d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Tn ca bn"}),d.jsx("input",{type:"text",className:"input",value:i,onChange:m=>o(m.target.value),placeholder:"Nguyn Vn A",required:!0})]}),d.jsxs("div",{className:"form-group",children:[d.jsx("label",{children:"Email"}),d.jsx("input",{type:"email",className:"input",value:r,onChange:m=>s(m.target.value),placeholder:"email@example.com",required:!0})]}),d.jsxs("button",{type:"submit",className:"btn btn-primary newsletter-submit",children:[d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:d.jsx("path",{d:"M18 2L9 11M18 2l-7 16-2-7-7-2 16-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"ng K Ngay"]})]}),d.jsx("p",{className:"newsletter-note",children:d.jsx("small",{children:"Chng ti s gi email mi tun v nhng setup c bnh chn p nht. Bn c th hy ng k bt c lc no."})})]})]})})},Jte=()=>{const{showCollectionsModal:t,setShowCollectionsModal:e,getSavedSetups:n,setSelectedSetup:r}=yn();if(!t)return null;const s=n(),i=rl(),o=()=>{e(!1)},a=l=>{o(),i(`/setup/${l.id}`)};return d.jsx("div",{className:"modal-overlay",onClick:l=>l.target===l.currentTarget&&o(),children:d.jsxs("div",{className:"collections-modal modal-content",children:[d.jsx("button",{className:"modal-close-btn",onClick:o,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),d.jsxs("div",{className:"collections-content",children:[d.jsxs("div",{className:"collections-header",children:[d.jsx("h2",{children:"Setup  Lu"}),d.jsxs("p",{className:"collections-count",children:[s.length," setup"]})]}),s.length===0?d.jsxs("div",{className:"collections-empty",children:[d.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",children:[d.jsx("circle",{cx:"60",cy:"60",r:"50",stroke:"var(--color-border)",strokeWidth:"2"}),d.jsx("path",{d:"M50 40h20a5 5 0 015 5v40l-15-8-15 8V45a5 5 0 015-5z",stroke:"var(--color-text-tertiary)",strokeWidth:"2"})]}),d.jsx("h3",{children:"Cha c setup no"}),d.jsx("p",{children:"Bm vo biu tng  trn cc setup  lu vo b su tp ca bn"})]}):d.jsx("div",{className:"collections-grid",children:s.map(l=>{var c;return d.jsxs("div",{className:"collection-item",onClick:()=>a(l),children:[d.jsx("div",{className:"collection-item-image",children:d.jsx("img",{src:l.mainImage,alt:l.title})}),d.jsxs("div",{className:"collection-item-content",children:[d.jsx("h4",{children:l.title}),d.jsx("p",{children:l.caption}),d.jsxs("div",{className:"collection-item-meta",children:[d.jsxs("span",{children:[" ",((c=l.likes)==null?void 0:c.length)||0]}),d.jsxs("span",{children:[" ",l.comments||0]})]})]})]},l.id)})})]})]})})},Yte=({product:t,isActive:e,onActivate:n})=>{const[r,s]=A.useState(!1),i=A.useRef(null),o=A.useRef(null),[a,l]=A.useState({horizontal:"center",vertical:"top"});A.useEffect(()=>{const f=()=>s(window.innerWidth<=768);return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]),A.useEffect(()=>{if(!e||r)return;const f=t.x,m=t.y;let g="center";f<25?g="left":f>75&&(g="right");let y="top";m<30&&(y="bottom"),l({horizontal:g,vertical:y})},[e,r,t.x,t.y]);const c=f=>{f.stopPropagation(),n(e?null:t)},u=()=>{const f={position:"absolute",background:"white",color:"#333",padding:"16px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)",minWidth:"260px",maxWidth:"300px",zIndex:1e4,animation:"fadeIn 0.2s ease-out",border:"1px solid rgba(0, 0, 0, 0.08)",whiteSpace:"normal"};return a.vertical==="top"?(f.bottom="100%",f.marginBottom="12px"):(f.top="100%",f.marginTop="12px"),a.horizontal==="center"?(f.left="50%",f.transform="translateX(-50%)"):a.horizontal==="left"?(f.left="0",f.transform="translateX(0)"):(f.right="0",f.left="auto",f.transform="translateX(0)"),f},h=()=>{const f={position:"absolute",width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent"};return a.vertical==="top"?(f.top="100%",f.borderTop="8px solid white"):(f.bottom="100%",f.borderBottom="8px solid white"),a.horizontal==="center"?(f.left="50%",f.transform="translateX(-50%)"):a.horizontal==="left"?f.left="16px":(f.right="16px",f.left="auto"),f};return d.jsxs("div",{className:"product-marker",ref:o,style:{left:`${t.x}%`,top:`${t.y}%`},onClick:c,children:[d.jsx("button",{className:`marker-btn ${e?"active":""}`,children:d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[d.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"var(--color-primary)"}),d.jsx("path",{d:"M10 6v8M6 10h8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),!r&&e&&d.jsxs("div",{ref:i,className:"product-tooltip-desktop",style:u(),onClick:f=>f.stopPropagation(),children:[d.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#333",margin:"0 0 8px 0",lineHeight:"1.4"},children:t.name}),d.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#ff6b35",margin:"0 0 12px 0",lineHeight:"1.2"},children:t.price}),t.link&&d.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"14px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"10px 20px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.3)",transition:"all 0.2s",border:"none"},children:[d.jsx("span",{children:"Xem sn phm"}),d.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",children:d.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),d.jsx("div",{style:h()})]})]})},Xte=()=>{var Ye,Ve,Jt;const{setupId:t}=Kg(),e=rl(),{setups:n,toggleLike:r,toggleSave:s,addComment:i,getComments:o,fetchCommentsForSetup:a,hasUserLiked:l,hasUserSaved:c,getSimilarSetups:u,currentUser:h,setShowAuthModal:f,loading:m}=yn(),[g,y]=A.useState(0),[v,w]=A.useState(""),[_,E]=A.useState(!0),[N,R]=A.useState(null),[O,S]=A.useState(!1),[T,k]=A.useState(!1),[I,M]=A.useState(null),[D,P]=A.useState(null),[pe,Ee]=A.useState(!1),[je,oe]=A.useState(1),[W,V]=A.useState(null),Z=A.useRef(null),[ce,U]=A.useState(!1),[he,we]=A.useState({x:0,y:0}),[dt,st]=A.useState({x:0,y:0}),it=A.useRef(null),$e=50,ae=n.find($=>$.id===t),Qt=((Ye=ae==null?void 0:ae.images)==null?void 0:Ye.length)>0?[...ae.images.map($=>({type:"image",url:$.url,products:$.products||[]})),...ae.youtubeVideo?[{type:"youtube",url:ae.youtubeVideo,poster:ae.mainImage}]:[]]:ae?[{type:"image",url:ae.mainImage,products:ae.products||[]},...(ae.moreImages||[]).map($=>({type:"image",url:$})),...ae.youtubeVideo?[{type:"youtube",url:ae.youtubeVideo,poster:ae.mainImage}]:[]]:[];if(A.useEffect(()=>{t&&a(t)},[t,a]),A.useEffect(()=>{const $=()=>S(window.innerWidth<=768);return $(),window.addEventListener("resize",$),()=>window.removeEventListener("resize",$)},[]),A.useEffect(()=>{O&&ae&&Qt.length>1&&(localStorage.getItem("hasSeenSwipeHint")||(k(!0),setTimeout(()=>{k(!1),localStorage.setItem("hasSeenSwipeHint","true")},3e3)))},[O,ae,Qt.length]),A.useEffect(()=>{const $=it.current;if(!$||O)return;const Ce=Re=>{Re.preventDefault(),Re.stopPropagation();const He=Re.deltaY>0?-.15:.15;oe(Yt=>{const Un=Math.max(1,Math.min(3,Yt+He));return Un===1&&we({x:0,y:0}),Un})};return $.addEventListener("wheel",Ce,{passive:!1}),()=>$.removeEventListener("wheel",Ce)},[O]),m||n.length===0&&!ae)return d.jsx("div",{className:"setup-detail-page",style:{paddingTop:"100px",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:d.jsx("div",{style:{color:"var(--color-text-primary)",fontSize:"18px"},children:"ang ti..."})});if(!m&&n.length>0&&!ae)return d.jsxs("div",{className:"setup-not-found",style:{paddingTop:"100px",textAlign:"center"},children:[d.jsx("h2",{children:"Setup khng tn ti"}),d.jsx("button",{onClick:()=>e("/"),style:{marginTop:"20px",padding:"10px 20px",cursor:"pointer"},children:"Quay v trang ch"})]});if(!ae)return d.jsx("div",{className:"setup-detail-page",style:{paddingTop:"100px",display:"flex",justifyContent:"center"},children:d.jsx("div",{style:{color:"var(--color-text-primary)"},children:"ang ti..."})});const Rn=Qt[g]||Qt[0],$r=l(ae.id),vr=c(ae.id),Pn=o(ae.id),tr=u(ae.id,16),wr=$=>{P(null),M($.targetTouches[0].clientX)},xr=$=>{P($.targetTouches[0].clientX)},q=()=>{if(!I||!D)return;const $=I-D,Ce=$>$e,Re=$<-$e;Ce&&g<Qt.length-1&&y(He=>He+1),Re&&g>0&&y(He=>He-1)},xe=()=>{if(!h){f(!0);return}r(ae.id)},Me=()=>{if(!h){f(!0);return}s(ae.id)},St=$=>{if($.preventDefault(),!h){f(!0);return}if(v.trim()){const Ce=h.photoURL||h.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(h.displayName||"User")}&background=random`,Re={text:v,author:h.displayName,userId:h.id,avatar:Ce};W&&(Re.replyTo={commentId:W.id,author:W.author}),i(ae.id,Re),w(""),V(null)}},K=$=>{var Re,He;if(!h){f(!0);return}const Ce=typeof $.author=="string"?$.author:((Re=$.author)==null?void 0:Re.name)||((He=$.author)==null?void 0:He.displayName)||"n danh";V({id:$.id,author:Ce}),w(`@${Ce} `),Z.current&&Z.current.focus()},X=()=>{V(null),w("")},ie=()=>{N&&R(null)},ge=$=>{if(!$||typeof $!="string")return $;const Ce=/(https?:\/\/[^\s<>"']+)/gi,Re=[];let He=0,Yt,Un=0;for(;(Yt=Ce.exec($))!==null;)Yt.index>He&&Re.push($.substring(He,Yt.index)),Re.push(d.jsx("a",{href:Yt[1],target:"_blank",rel:"noopener noreferrer",className:"text-link",onClick:Mn=>Mn.stopPropagation(),children:Yt[1]},`caption-link-${Un++}`)),He=Yt.index+Yt[0].length;return He<$.length&&Re.push($.substring(He)),Re.length>0?Re:$},se={"@context":"https://schema.org","@type":"Article",headline:ae.title,image:ae.mainImage,author:{"@type":"Person",name:ae.author},datePublished:ae.createdAt};return d.jsxs(d.Fragment,{children:[d.jsx(Iy,{title:`${ae.title} | DeskHub`,description:ae.caption,image:ae.mainImage,type:"article",schema:se}),d.jsxs("div",{className:"setup-detail-page",children:[T&&O&&d.jsxs("div",{className:"swipe-hint-popup",children:[d.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",children:[d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),d.jsx("path",{d:"M9 18l6-6-6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),d.jsx("p",{children:"Vut  xem nh tip theo"})]}),d.jsxs("div",{className:"setup-content",children:[d.jsxs("div",{className:"setup-left-column",children:[d.jsx("div",{className:"setup-gallery-section",children:d.jsxs("div",{className:"setup-main-image-container",onTouchStart:O?wr:void 0,onTouchMove:O?xr:void 0,onTouchEnd:O?q:void 0,onClick:ie,ref:it,onMouseDown:$=>{je>1&&!O&&($.preventDefault(),U(!0),st({x:$.clientX-he.x,y:$.clientY-he.y}))},onMouseMove:$=>{if(ce&&je>1){const Ce=$.clientX-dt.x,Re=$.clientY-dt.y,He=(je-1)*200;we({x:Math.max(-He,Math.min(He,Ce)),y:Math.max(-He,Math.min(He,Re))})}},onMouseUp:()=>U(!1),onMouseLeaveCapture:()=>U(!1),style:{cursor:je>1?ce?"grabbing":"grab":"default"},children:[d.jsx("button",{className:"back-btn",onClick:()=>e(-1),"aria-label":"Quay li",children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),d.jsxs("div",{className:"zoomable-wrapper",style:{transform:`scale(${je}) translate(${he.x/je}px, ${he.y/je}px)`,transition:ce?"none":"transform 0.2s ease",transformOrigin:"center center",position:"relative",width:"100%",height:"100%"},children:[d.jsx("img",{src:Rn.url,alt:ae.title,className:"setup-main-image",style:{pointerEvents:"none"}}),_&&Rn.products&&Rn.products.map(($,Ce)=>d.jsx(Yte,{product:$,isActive:N===$,onActivate:R},Ce))]}),!O&&d.jsxs("div",{className:"image-controls-stack",children:[d.jsxs("div",{className:"zoom-controls-vertical",children:[d.jsx("button",{className:"control-btn zoom-in",onClick:$=>{$.stopPropagation(),oe(Ce=>Math.min(Ce+.25,3))},title:"Phng to",children:d.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[d.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),d.jsx("button",{className:"control-btn zoom-out",onClick:$=>{$.stopPropagation(),oe(Ce=>{const Re=Math.max(Ce-.25,1);return Re===1&&we({x:0,y:0}),Re})},title:"Thu nh",disabled:je<=1,children:d.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:d.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})})]}),Rn.products&&Rn.products.length>0&&d.jsx("button",{className:"toggle-products-btn",onClick:$=>{$.stopPropagation(),E(!_)},children:d.jsx("div",{className:"toggle-content",children:d.jsx("span",{children:_?"n sn phm":"Hin sn phm"})})})]}),O&&Rn.products&&Rn.products.length>0&&d.jsx("button",{className:"toggle-products-btn-mobile",onClick:$=>{$.stopPropagation(),E(!_)},"aria-label":_?"n sn phm":"Hin sn phm",children:_?d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),d.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),d.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]})}),!O&&Qt.length>1&&d.jsxs(d.Fragment,{children:[d.jsx("button",{className:"nav-arrow prev",onClick:()=>{y($=>Math.max(0,$-1)),oe(1),we({x:0,y:0})},disabled:g===0,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),d.jsx("button",{className:"nav-arrow next",onClick:()=>{y($=>Math.min(Qt.length-1,$+1)),oe(1),we({x:0,y:0})},disabled:g===Qt.length-1,children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:d.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),Qt.length>1&&d.jsx("div",{className:"image-pagination-dots",children:Qt.map(($,Ce)=>d.jsx("button",{className:`pagination-dot ${Ce===g?"active":""}`,onClick:()=>y(Ce)},Ce))})]})}),d.jsxs("div",{className:"setup-details-section",children:[d.jsxs("div",{className:"setup-header-row",children:[d.jsxs("div",{className:"setup-author-simple",children:[d.jsx("img",{src:typeof ae.author=="object"?ae.author.avatar:ae.avatar,alt:typeof ae.author=="object"?ae.author.name:ae.author,className:"author-avatar-small"}),d.jsx("span",{className:"author-name-simple",children:typeof ae.author=="object"?ae.author.name:ae.author})]}),d.jsxs("div",{className:"setup-actions-row",children:[d.jsxs("button",{className:`action-btn-icon ${$r?"active":""}`,onClick:xe,title:"Thch",children:[d.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:$r?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),d.jsx("span",{className:"action-count",children:((Ve=ae.likes)==null?void 0:Ve.length)||0})]}),d.jsxs("button",{className:`action-btn-icon ${vr?"active":""}`,onClick:Me,title:"Lu",children:[d.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:vr?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})}),d.jsx("span",{className:"action-count",children:((Jt=ae.saves)==null?void 0:Jt.length)||0})]}),d.jsx("button",{className:"action-btn-icon",title:"Chia s",onClick:()=>{navigator.share?navigator.share({title:ae.title,text:ae.caption,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert(" copy link!"))},children:d.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[d.jsx("circle",{cx:"18",cy:"5",r:"3"}),d.jsx("circle",{cx:"6",cy:"12",r:"3"}),d.jsx("circle",{cx:"18",cy:"19",r:"3"}),d.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),d.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})})]})]}),d.jsx("p",{className:"setup-caption",children:ge(ae.caption)}),ae.tags&&ae.tags.length>0&&d.jsx("div",{className:"setup-tags",children:ae.tags.map(($,Ce)=>d.jsxs("span",{className:"setup-tag",children:["#",$]},Ce))}),d.jsxs("div",{className:"comments-section",children:[d.jsxs("h4",{children:["Bnh lun (",Pn.length,")"]}),W&&d.jsxs("div",{className:"reply-indicator",children:[d.jsxs("span",{children:["ang tr li ",d.jsxs("strong",{children:["@",W.author]})]}),d.jsx("button",{type:"button",className:"cancel-reply-btn",onClick:X,children:d.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:d.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),d.jsxs("form",{className:"comment-form",onSubmit:St,children:[d.jsx("input",{ref:Z,type:"text",placeholder:W?`Tr li @${W.author}...`:"Thm bnh lun...",value:v,onChange:$=>w($.target.value),className:"comment-input"}),d.jsx("button",{type:"submit",className:"btn-primary",children:"Gi"})]}),d.jsx("div",{className:"comments-list",children:Pn.length===0?d.jsx("p",{className:"no-comments",children:"Cha c bnh lun no"}):d.jsxs(d.Fragment,{children:[Pn.slice(0,pe?Pn.length:2).map($=>{var Un,Mn,xi,as;const Ce=typeof $.text=="string"?$.text:((Un=$.text)==null?void 0:Un.text)||JSON.stringify($.text)||"",Re=typeof $.author=="string"?$.author:((Mn=$.author)==null?void 0:Mn.name)||((xi=$.author)==null?void 0:xi.displayName)||"n danh",He=typeof $.avatar=="string"?$.avatar:((as=$.avatar)==null?void 0:as.url)||"https://ui-avatars.com/api/?name=User&background=random",Yt=Ur=>{const ls=/(https?:\/\/[^\s<>"']+)|(@\S+)/gi,H=[];let Q=0,_e,Mt=0;for(;(_e=ls.exec(Ur))!==null;)_e.index>Q&&H.push(Ur.substring(Q,_e.index)),_e[1]?H.push(d.jsx("a",{href:_e[1],target:"_blank",rel:"noopener noreferrer",className:"text-link",onClick:nr=>nr.stopPropagation(),children:_e[1]},`link-${Mt++}`)):_e[2]&&H.push(d.jsx("span",{className:"mention-tag",children:_e[2]},`mention-${Mt++}`)),Q=_e.index+_e[0].length;return Q<Ur.length&&H.push(Ur.substring(Q)),H.length>0?H:Ur};return d.jsxs("div",{className:"comment",children:[d.jsx("img",{src:He,alt:Re,className:"comment-avatar"}),d.jsxs("div",{className:"comment-content",children:[d.jsxs("div",{className:"comment-header",children:[d.jsx("p",{className:"comment-author",children:Re}),d.jsx("button",{type:"button",className:"reply-btn",onClick:()=>K($),children:"Tr li"})]}),$.replyTo&&d.jsxs("p",{className:"reply-to-indicator",children:[" Tr li ",d.jsxs("span",{className:"mention-tag",children:["@",$.replyTo.author]})]}),d.jsx("p",{className:"comment-text",children:Yt(Ce)})]})]},$.id)}),Pn.length>2&&!pe&&d.jsxs("button",{className:"show-more-comments",onClick:()=>Ee(!0),children:["Xem thm ",Pn.length-2," bnh lun"]})]})})]}),O&&tr.length>0&&d.jsx("div",{className:"similar-setups-section mobile-similar",children:d.jsx("div",{className:"similar-setups-grid",children:tr.slice(0,6).map($=>d.jsx("div",{className:"similar-setup-card",onClick:()=>e(`/setup/${$.id}`),children:d.jsx("img",{src:$.mainImage,alt:$.title})},$.id))})})]})]}),!O&&tr.length>0&&d.jsx("div",{className:"setup-right-column",children:d.jsx("div",{className:"similar-setups-section-desktop",children:d.jsx("div",{className:"similar-setups-grid-desktop",children:tr.map($=>d.jsx("div",{className:"similar-setup-card",onClick:()=>e(`/setup/${$.id}`),children:d.jsx("img",{src:$.mainImage,alt:$.title})},$.id))})})})]})]}),O&&N&&X_.createPortal(d.jsxs("div",{className:"product-tooltip-portal",style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:"380px",background:"rgba(20, 20, 20, 0.95)",backdropFilter:"blur(12px)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"20px",zIndex:1e5,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",borderRadius:"16px",display:"flex",flexDirection:"column",gap:"12px",animation:"slideUpFade 0.3s ease-out"},onClick:$=>$.stopPropagation(),children:[d.jsx("button",{style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"20px",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>R(null),children:""}),d.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"white",margin:"0 24px 0 0",lineHeight:"1.4"},children:N.name}),d.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:"#ff6b35",margin:"4px 0",lineHeight:"1.2"},children:N.price}),N.link&&d.jsxs("a",{href:N.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"15px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"14px 24px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"8px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.4)"},children:[d.jsx("span",{children:"Xem sn phm"}),d.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:d.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),document.body)]})},D0=()=>d.jsxs("div",{className:"gallery-layout",children:[d.jsx("div",{className:"desktop-sidebar-wrapper",children:d.jsx(qO,{})}),d.jsx("div",{className:"gallery-content",children:d.jsx(rq,{})})]}),Zte=()=>{const{subscribeNewsletter:t}=yn(),[e,n]=A.useState(""),[r,s]=A.useState("idle"),i=async o=>{o.preventDefault(),s("loading"),(await t({email:e})).success?(s("success"),n(""),setTimeout(()=>s("idle"),3e3)):(s("error"),setTimeout(()=>s("idle"),3e3))};return d.jsxs("div",{className:"footer-newsletter",children:[d.jsx("p",{className:"newsletter-label",children:" Nhn tin mi:"}),d.jsxs("form",{className:"newsletter-inline-form",onSubmit:i,children:[d.jsx("input",{type:"email",placeholder:"Email ca bn...",value:e,onChange:o=>n(o.target.value),required:!0,disabled:r==="loading"||r==="success"}),d.jsx("button",{type:"submit",className:`btn-newsletter-small ${r}`,disabled:r==="loading",children:r==="loading"?"...":r==="success"?"":"ng k"})]})]})},ene=()=>{const{selectedSetup:t,showAddSetupModal:e,setShowAddSetupModal:n,addSetup:r,setShowNewsletterModal:s}=yn(),i=mi();A.useEffect(()=>{window.scrollTo(0,0)},[i.pathname]);const o=async a=>{console.log(" App.handleSaveSetup called with:",a);const l=await r(a);console.log(" App.handleSaveSetup response:",l),l.success?(n(!1),alert(" thm setup thnh cng!")):alert(`Li: ${l.message||"C li xy ra"}`)};return d.jsxs("div",{className:"app",children:[d.jsx(eq,{}),d.jsx("main",{className:"main-content",children:d.jsxs(Z3,{children:[d.jsx(br,{path:"/",element:d.jsx(D0,{})}),d.jsx(br,{path:"/gallery",element:d.jsx(D0,{})}),d.jsx(br,{path:"/setup/:setupId",element:d.jsx(Xte,{})}),d.jsx(br,{path:"/blog",element:d.jsx(aq,{})}),d.jsx(br,{path:"/blog/:slug",element:d.jsx(Zq,{})}),d.jsx(br,{path:"/blog/seo-new",element:d.jsx(vA,{})}),d.jsx(br,{path:"/blog/seo-edit/:id",element:d.jsx(vA,{})}),d.jsx(br,{path:"/blog/new",element:d.jsx(CC,{})}),d.jsx(br,{path:"/blog/edit/:id",element:d.jsx(CC,{})}),d.jsx(br,{path:"/admin",element:d.jsx(qte,{})}),d.jsx(br,{path:"*",element:d.jsx(D0,{})})]})}),d.jsx("div",{className:"mobile-filter-wrapper",children:d.jsx(qO,{})}),t&&d.jsx(sq,{}),e&&d.jsx(aV,{onClose:()=>n(!1),onSave:o}),d.jsx(Kte,{}),d.jsx(Gte,{}),d.jsx(Qte,{}),d.jsx(Jte,{}),d.jsxs("footer",{className:"footer",children:[d.jsxs("div",{className:"container footer-content",children:[d.jsxs("div",{className:"footer-section",children:[d.jsx("h4",{children:"DeskHub"}),d.jsx("p",{children:"Khm ph v chia s nhng gc lm vic p nht t khp ni trn th gii."}),d.jsx(Zte,{})]}),d.jsxs("div",{className:"footer-section",children:[d.jsx("h5",{children:"Lin Kt"}),d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx("a",{href:"/",children:"B Su Tp"})}),d.jsx("li",{children:d.jsx("a",{href:"/blog",children:"Blog"})}),d.jsx("li",{children:d.jsx("a",{href:"#",children:"Gii Thiu"})}),d.jsx("li",{children:d.jsx("a",{href:"#",children:"Lin H"})})]})]}),d.jsxs("div",{className:"footer-section",children:[d.jsx("h5",{children:"Theo Di"}),d.jsxs("div",{className:"social-links",children:[d.jsx("a",{href:"#",className:"social-link","aria-label":"Facebook",children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"})})}),d.jsx("a",{href:"#",className:"social-link","aria-label":"Instagram",children:d.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5",ry:"5"}),d.jsx("path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"}),d.jsx("line",{x1:"17.5",y1:"6.5",x2:"17.51",y2:"6.5"})]})}),d.jsx("a",{href:"#",className:"social-link","aria-label":"YouTube",children:d.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:d.jsx("path",{d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.33 29 29 0 0 0-.46-5.33zM9.75 15.02V8.5l5.75 3.26z"})})})]})]})]}),d.jsx("div",{className:"footer-bottom",children:d.jsx("div",{className:"container",children:d.jsx("p",{children:" 2026 DeskHub. Tt c quyn c bo lu."})})})]})]})};function tne(){return d.jsx(ZW,{children:d.jsx(ene,{})})}j0.createRoot(document.getElementById("root")).render(d.jsx(qe.StrictMode,{children:d.jsx(iP,{children:d.jsx(TB,{children:d.jsx(tne,{})})})}));
