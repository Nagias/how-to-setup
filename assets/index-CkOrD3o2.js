var G4=Object.defineProperty;var Q4=(t,e,n)=>e in t?G4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Bs=(t,e,n)=>Q4(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();function Mo(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var OA={exports:{}},Ug={},DA={exports:{}},Ue={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sd=Symbol.for("react.element"),J4=Symbol.for("react.portal"),X4=Symbol.for("react.fragment"),Y4=Symbol.for("react.strict_mode"),Z4=Symbol.for("react.profiler"),e3=Symbol.for("react.provider"),t3=Symbol.for("react.context"),n3=Symbol.for("react.forward_ref"),r3=Symbol.for("react.suspense"),s3=Symbol.for("react.memo"),i3=Symbol.for("react.lazy"),rE=Symbol.iterator;function o3(t){return t===null||typeof t!="object"?null:(t=rE&&t[rE]||t["@@iterator"],typeof t=="function"?t:null)}var LA={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},jA=Object.assign,VA={};function Kc(t,e,n){this.props=t,this.context=e,this.refs=VA,this.updater=n||LA}Kc.prototype.isReactComponent={};Kc.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Kc.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function FA(){}FA.prototype=Kc.prototype;function g_(t,e,n){this.props=t,this.context=e,this.refs=VA,this.updater=n||LA}var y_=g_.prototype=new FA;y_.constructor=g_;jA(y_,Kc.prototype);y_.isPureReactComponent=!0;var sE=Array.isArray,BA=Object.prototype.hasOwnProperty,v_={current:null},UA={key:!0,ref:!0,__self:!0,__source:!0};function zA(t,e,n){var r,s={},i=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(i=""+e.key),e)BA.call(e,r)&&!UA.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];s.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:Sd,type:t,key:i,ref:o,props:s,_owner:v_.current}}function a3(t,e){return{$$typeof:Sd,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function w_(t){return typeof t=="object"&&t!==null&&t.$$typeof===Sd}function l3(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var iE=/\/+/g;function vv(t,e){return typeof t=="object"&&t!==null&&t.key!=null?l3(""+t.key):e.toString(36)}function lp(t,e,n,r,s){var i=typeof t;(i==="undefined"||i==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case Sd:case J4:o=!0}}if(o)return o=t,s=s(o),t=r===""?"."+vv(o,0):r,sE(s)?(n="",t!=null&&(n=t.replace(iE,"$&/")+"/"),lp(s,e,n,"",function(c){return c})):s!=null&&(w_(s)&&(s=a3(s,n+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(iE,"$&/")+"/")+t)),e.push(s)),1;if(o=0,r=r===""?".":r+":",sE(t))for(var a=0;a<t.length;a++){i=t[a];var l=r+vv(i,a);o+=lp(i,e,n,l,s)}else if(l=o3(t),typeof l=="function")for(t=l.call(t),a=0;!(i=t.next()).done;)i=i.value,l=r+vv(i,a++),o+=lp(i,e,n,l,s);else if(i==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function pf(t,e,n){if(t==null)return t;var r=[],s=0;return lp(t,r,"","",function(i){return e.call(n,i,s++)}),r}function c3(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Wn={current:null},cp={transition:null},u3={ReactCurrentDispatcher:Wn,ReactCurrentBatchConfig:cp,ReactCurrentOwner:v_};function $A(){throw Error("act(...) is not supported in production builds of React.")}Ue.Children={map:pf,forEach:function(t,e,n){pf(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return pf(t,function(){e++}),e},toArray:function(t){return pf(t,function(e){return e})||[]},only:function(t){if(!w_(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Ue.Component=Kc;Ue.Fragment=X4;Ue.Profiler=Z4;Ue.PureComponent=g_;Ue.StrictMode=Y4;Ue.Suspense=r3;Ue.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=u3;Ue.act=$A;Ue.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=jA({},t.props),s=t.key,i=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(i=e.ref,o=v_.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)BA.call(e,l)&&!UA.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:Sd,type:t.type,key:s,ref:i,props:r,_owner:o}};Ue.createContext=function(t){return t={$$typeof:t3,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:e3,_context:t},t.Consumer=t};Ue.createElement=zA;Ue.createFactory=function(t){var e=zA.bind(null,t);return e.type=t,e};Ue.createRef=function(){return{current:null}};Ue.forwardRef=function(t){return{$$typeof:n3,render:t}};Ue.isValidElement=w_;Ue.lazy=function(t){return{$$typeof:i3,_payload:{_status:-1,_result:t},_init:c3}};Ue.memo=function(t,e){return{$$typeof:s3,type:t,compare:e===void 0?null:e}};Ue.startTransition=function(t){var e=cp.transition;cp.transition={};try{t()}finally{cp.transition=e}};Ue.unstable_act=$A;Ue.useCallback=function(t,e){return Wn.current.useCallback(t,e)};Ue.useContext=function(t){return Wn.current.useContext(t)};Ue.useDebugValue=function(){};Ue.useDeferredValue=function(t){return Wn.current.useDeferredValue(t)};Ue.useEffect=function(t,e){return Wn.current.useEffect(t,e)};Ue.useId=function(){return Wn.current.useId()};Ue.useImperativeHandle=function(t,e,n){return Wn.current.useImperativeHandle(t,e,n)};Ue.useInsertionEffect=function(t,e){return Wn.current.useInsertionEffect(t,e)};Ue.useLayoutEffect=function(t,e){return Wn.current.useLayoutEffect(t,e)};Ue.useMemo=function(t,e){return Wn.current.useMemo(t,e)};Ue.useReducer=function(t,e,n){return Wn.current.useReducer(t,e,n)};Ue.useRef=function(t){return Wn.current.useRef(t)};Ue.useState=function(t){return Wn.current.useState(t)};Ue.useSyncExternalStore=function(t,e,n){return Wn.current.useSyncExternalStore(t,e,n)};Ue.useTransition=function(){return Wn.current.useTransition()};Ue.version="18.3.1";DA.exports=Ue;var V=DA.exports;const Xe=Mo(V);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var h3=V,d3=Symbol.for("react.element"),f3=Symbol.for("react.fragment"),p3=Object.prototype.hasOwnProperty,m3=h3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,g3={key:!0,ref:!0,__self:!0,__source:!0};function HA(t,e,n){var r,s={},i=null,o=null;n!==void 0&&(i=""+n),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(o=e.ref);for(r in e)p3.call(e,r)&&!g3.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:d3,type:t,key:i,ref:o,props:s,_owner:m3.current}}Ug.Fragment=f3;Ug.jsx=HA;Ug.jsxs=HA;OA.exports=Ug;var p=OA.exports,G0={},WA={exports:{}},_r={},qA={exports:{}},KA={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e($,U){var F=$.length;$.push(U);e:for(;0<F;){var X=F-1>>>1,H=$[X];if(0<s(H,U))$[X]=U,$[F]=H,F=X;else break e}}function n($){return $.length===0?null:$[0]}function r($){if($.length===0)return null;var U=$[0],F=$.pop();if(F!==U){$[0]=F;e:for(var X=0,H=$.length,J=H>>>1;X<J;){var z=2*(X+1)-1,W=$[z],de=z+1,Te=$[de];if(0>s(W,F))de<H&&0>s(Te,W)?($[X]=Te,$[de]=F,X=de):($[X]=W,$[z]=F,X=z);else if(de<H&&0>s(Te,F))$[X]=Te,$[de]=F,X=de;else break e}}return U}function s($,U){var F=$.sortIndex-U.sortIndex;return F!==0?F:$.id-U.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;t.unstable_now=function(){return i.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,d=3,f=!1,g=!1,y=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E($){for(var U=n(c);U!==null;){if(U.callback===null)r(c);else if(U.startTime<=$)r(c),U.sortIndex=U.expirationTime,e(l,U);else break;U=n(c)}}function R($){if(y=!1,E($),!g)if(n(l)!==null)g=!0,L(P);else{var U=n(c);U!==null&&O(R,U.startTime-$)}}function P($,U){g=!1,y&&(y=!1,w(_),_=-1),f=!0;var F=d;try{for(E(U),h=n(l);h!==null&&(!(h.expirationTime>U)||$&&!A());){var X=h.callback;if(typeof X=="function"){h.callback=null,d=h.priorityLevel;var H=X(h.expirationTime<=U);U=t.unstable_now(),typeof H=="function"?h.callback=H:h===n(l)&&r(l),E(U)}else r(l);h=n(l)}if(h!==null)var J=!0;else{var z=n(c);z!==null&&O(R,z.startTime-U),J=!1}return J}finally{h=null,d=F,f=!1}}var N=!1,k=null,_=-1,x=5,S=-1;function A(){return!(t.unstable_now()-S<x)}function M(){if(k!==null){var $=t.unstable_now();S=$;var U=!0;try{U=k(!0,$)}finally{U?I():(N=!1,k=null)}}else N=!1}var I;if(typeof T=="function")I=function(){T(M)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,B=j.port2;j.port1.onmessage=M,I=function(){B.postMessage(null)}}else I=function(){v(M,0)};function L($){k=$,N||(N=!0,I())}function O($,U){_=v(function(){$(t.unstable_now())},U)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function($){$.callback=null},t.unstable_continueExecution=function(){g||f||(g=!0,L(P))},t.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<$?Math.floor(1e3/$):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function($){switch(d){case 1:case 2:case 3:var U=3;break;default:U=d}var F=d;d=U;try{return $()}finally{d=F}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function($,U){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var F=d;d=$;try{return U()}finally{d=F}},t.unstable_scheduleCallback=function($,U,F){var X=t.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?X+F:X):F=X,$){case 1:var H=-1;break;case 2:H=250;break;case 5:H=1073741823;break;case 4:H=1e4;break;default:H=5e3}return H=F+H,$={id:u++,callback:U,priorityLevel:$,startTime:F,expirationTime:H,sortIndex:-1},F>X?($.sortIndex=F,e(c,$),n(l)===null&&$===n(c)&&(y?(w(_),_=-1):y=!0,O(R,F-X))):($.sortIndex=H,e(l,$),g||f||(g=!0,L(P))),$},t.unstable_shouldYield=A,t.unstable_wrapCallback=function($){var U=d;return function(){var F=d;d=U;try{return $.apply(this,arguments)}finally{d=F}}}})(KA);qA.exports=KA;var y3=qA.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var v3=V,vr=y3;function oe(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var GA=new Set,Mh={};function il(t,e){yc(t,e),yc(t+"Capture",e)}function yc(t,e){for(Mh[t]=e,t=0;t<e.length;t++)GA.add(e[t])}var ui=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Q0=Object.prototype.hasOwnProperty,w3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,oE={},aE={};function _3(t){return Q0.call(aE,t)?!0:Q0.call(oE,t)?!1:w3.test(t)?aE[t]=!0:(oE[t]=!0,!1)}function x3(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function b3(t,e,n,r){if(e===null||typeof e>"u"||x3(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qn(t,e,n,r,s,i,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=i,this.removeEmptyString=o}var xn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){xn[t]=new qn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];xn[e]=new qn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){xn[t]=new qn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){xn[t]=new qn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){xn[t]=new qn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){xn[t]=new qn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){xn[t]=new qn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){xn[t]=new qn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){xn[t]=new qn(t,5,!1,t.toLowerCase(),null,!1,!1)});var __=/[\-:]([a-z])/g;function x_(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(__,x_);xn[e]=new qn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(__,x_);xn[e]=new qn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(__,x_);xn[e]=new qn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){xn[t]=new qn(t,1,!1,t.toLowerCase(),null,!1,!1)});xn.xlinkHref=new qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){xn[t]=new qn(t,1,!1,t.toLowerCase(),null,!0,!0)});function b_(t,e,n,r){var s=xn.hasOwnProperty(e)?xn[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(b3(e,n,s,r)&&(n=null),r||s===null?_3(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var wi=v3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,mf=Symbol.for("react.element"),Vl=Symbol.for("react.portal"),Fl=Symbol.for("react.fragment"),T_=Symbol.for("react.strict_mode"),J0=Symbol.for("react.profiler"),QA=Symbol.for("react.provider"),JA=Symbol.for("react.context"),E_=Symbol.for("react.forward_ref"),X0=Symbol.for("react.suspense"),Y0=Symbol.for("react.suspense_list"),S_=Symbol.for("react.memo"),Bi=Symbol.for("react.lazy"),XA=Symbol.for("react.offscreen"),lE=Symbol.iterator;function yu(t){return t===null||typeof t!="object"?null:(t=lE&&t[lE]||t["@@iterator"],typeof t=="function"?t:null)}var kt=Object.assign,wv;function Uu(t){if(wv===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);wv=e&&e[1]||""}return`
`+wv+t}var _v=!1;function xv(t,e){if(!t||_v)return"";_v=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var s=c.stack.split(`
`),i=r.stack.split(`
`),o=s.length-1,a=i.length-1;1<=o&&0<=a&&s[o]!==i[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==i[a]){if(o!==1||a!==1)do if(o--,a--,0>a||s[o]!==i[a]){var l=`
`+s[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{_v=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Uu(t):""}function T3(t){switch(t.tag){case 5:return Uu(t.type);case 16:return Uu("Lazy");case 13:return Uu("Suspense");case 19:return Uu("SuspenseList");case 0:case 2:case 15:return t=xv(t.type,!1),t;case 11:return t=xv(t.type.render,!1),t;case 1:return t=xv(t.type,!0),t;default:return""}}function Z0(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Fl:return"Fragment";case Vl:return"Portal";case J0:return"Profiler";case T_:return"StrictMode";case X0:return"Suspense";case Y0:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case JA:return(t.displayName||"Context")+".Consumer";case QA:return(t._context.displayName||"Context")+".Provider";case E_:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case S_:return e=t.displayName||null,e!==null?e:Z0(t.type)||"Memo";case Bi:e=t._payload,t=t._init;try{return Z0(t(e))}catch{}}return null}function E3(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Z0(e);case 8:return e===T_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Eo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function YA(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function S3(t){var e=YA(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){r=""+o,i.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function gf(t){t._valueTracker||(t._valueTracker=S3(t))}function ZA(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=YA(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Qp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function ew(t,e){var n=e.checked;return kt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function cE(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Eo(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function eR(t,e){e=e.checked,e!=null&&b_(t,"checked",e,!1)}function tw(t,e){eR(t,e);var n=Eo(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?nw(t,e.type,n):e.hasOwnProperty("defaultValue")&&nw(t,e.type,Eo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function uE(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function nw(t,e,n){(e!=="number"||Qp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var zu=Array.isArray;function Zl(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Eo(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function rw(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(oe(91));return kt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function hE(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(oe(92));if(zu(n)){if(1<n.length)throw Error(oe(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Eo(n)}}function tR(t,e){var n=Eo(e.value),r=Eo(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function dE(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function nR(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sw(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?nR(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var yf,rR=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(yf=yf||document.createElement("div"),yf.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yf.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Oh(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var rh={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},k3=["Webkit","ms","Moz","O"];Object.keys(rh).forEach(function(t){k3.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),rh[e]=rh[t]})});function sR(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||rh.hasOwnProperty(t)&&rh[t]?(""+e).trim():e+"px"}function iR(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=sR(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var C3=kt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function iw(t,e){if(e){if(C3[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(oe(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(oe(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(oe(61))}if(e.style!=null&&typeof e.style!="object")throw Error(oe(62))}}function ow(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var aw=null;function k_(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var lw=null,ec=null,tc=null;function fE(t){if(t=Id(t)){if(typeof lw!="function")throw Error(oe(280));var e=t.stateNode;e&&(e=qg(e),lw(t.stateNode,t.type,e))}}function oR(t){ec?tc?tc.push(t):tc=[t]:ec=t}function aR(){if(ec){var t=ec,e=tc;if(tc=ec=null,fE(t),e)for(t=0;t<e.length;t++)fE(e[t])}}function lR(t,e){return t(e)}function cR(){}var bv=!1;function uR(t,e,n){if(bv)return t(e,n);bv=!0;try{return lR(t,e,n)}finally{bv=!1,(ec!==null||tc!==null)&&(cR(),aR())}}function Dh(t,e){var n=t.stateNode;if(n===null)return null;var r=qg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(oe(231,e,typeof n));return n}var cw=!1;if(ui)try{var vu={};Object.defineProperty(vu,"passive",{get:function(){cw=!0}}),window.addEventListener("test",vu,vu),window.removeEventListener("test",vu,vu)}catch{cw=!1}function I3(t,e,n,r,s,i,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var sh=!1,Jp=null,Xp=!1,uw=null,A3={onError:function(t){sh=!0,Jp=t}};function R3(t,e,n,r,s,i,o,a,l){sh=!1,Jp=null,I3.apply(A3,arguments)}function N3(t,e,n,r,s,i,o,a,l){if(R3.apply(this,arguments),sh){if(sh){var c=Jp;sh=!1,Jp=null}else throw Error(oe(198));Xp||(Xp=!0,uw=c)}}function ol(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function hR(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function pE(t){if(ol(t)!==t)throw Error(oe(188))}function P3(t){var e=t.alternate;if(!e){if(e=ol(t),e===null)throw Error(oe(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return pE(s),t;if(i===r)return pE(s),e;i=i.sibling}throw Error(oe(188))}if(n.return!==r.return)n=s,r=i;else{for(var o=!1,a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o){for(a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o)throw Error(oe(189))}}if(n.alternate!==r)throw Error(oe(190))}if(n.tag!==3)throw Error(oe(188));return n.stateNode.current===n?t:e}function dR(t){return t=P3(t),t!==null?fR(t):null}function fR(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=fR(t);if(e!==null)return e;t=t.sibling}return null}var pR=vr.unstable_scheduleCallback,mE=vr.unstable_cancelCallback,M3=vr.unstable_shouldYield,O3=vr.unstable_requestPaint,Vt=vr.unstable_now,D3=vr.unstable_getCurrentPriorityLevel,C_=vr.unstable_ImmediatePriority,mR=vr.unstable_UserBlockingPriority,Yp=vr.unstable_NormalPriority,L3=vr.unstable_LowPriority,gR=vr.unstable_IdlePriority,zg=null,Ss=null;function j3(t){if(Ss&&typeof Ss.onCommitFiberRoot=="function")try{Ss.onCommitFiberRoot(zg,t,void 0,(t.current.flags&128)===128)}catch{}}var ss=Math.clz32?Math.clz32:B3,V3=Math.log,F3=Math.LN2;function B3(t){return t>>>=0,t===0?32:31-(V3(t)/F3|0)|0}var vf=64,wf=4194304;function $u(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Zp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,i=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~s;a!==0?r=$u(a):(i&=o,i!==0&&(r=$u(i)))}else o=n&~s,o!==0?r=$u(o):i!==0&&(r=$u(i));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,i=e&-e,s>=i||s===16&&(i&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-ss(e),s=1<<n,r|=t[n],e&=~s;return r}function U3(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function z3(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,i=t.pendingLanes;0<i;){var o=31-ss(i),a=1<<o,l=s[o];l===-1?(!(a&n)||a&r)&&(s[o]=U3(a,e)):l<=e&&(t.expiredLanes|=a),i&=~a}}function hw(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yR(){var t=vf;return vf<<=1,!(vf&4194240)&&(vf=64),t}function Tv(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function kd(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ss(e),t[e]=n}function $3(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-ss(n),i=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~i}}function I_(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ss(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var Ze=0;function vR(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var wR,A_,_R,xR,bR,dw=!1,_f=[],oo=null,ao=null,lo=null,Lh=new Map,jh=new Map,Wi=[],H3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gE(t,e){switch(t){case"focusin":case"focusout":oo=null;break;case"dragenter":case"dragleave":ao=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":Lh.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":jh.delete(e.pointerId)}}function wu(t,e,n,r,s,i){return t===null||t.nativeEvent!==i?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[s]},e!==null&&(e=Id(e),e!==null&&A_(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function W3(t,e,n,r,s){switch(e){case"focusin":return oo=wu(oo,t,e,n,r,s),!0;case"dragenter":return ao=wu(ao,t,e,n,r,s),!0;case"mouseover":return lo=wu(lo,t,e,n,r,s),!0;case"pointerover":var i=s.pointerId;return Lh.set(i,wu(Lh.get(i)||null,t,e,n,r,s)),!0;case"gotpointercapture":return i=s.pointerId,jh.set(i,wu(jh.get(i)||null,t,e,n,r,s)),!0}return!1}function TR(t){var e=ua(t.target);if(e!==null){var n=ol(e);if(n!==null){if(e=n.tag,e===13){if(e=hR(n),e!==null){t.blockedOn=e,bR(t.priority,function(){_R(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function up(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=fw(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);aw=r,n.target.dispatchEvent(r),aw=null}else return e=Id(n),e!==null&&A_(e),t.blockedOn=n,!1;e.shift()}return!0}function yE(t,e,n){up(t)&&n.delete(e)}function q3(){dw=!1,oo!==null&&up(oo)&&(oo=null),ao!==null&&up(ao)&&(ao=null),lo!==null&&up(lo)&&(lo=null),Lh.forEach(yE),jh.forEach(yE)}function _u(t,e){t.blockedOn===e&&(t.blockedOn=null,dw||(dw=!0,vr.unstable_scheduleCallback(vr.unstable_NormalPriority,q3)))}function Vh(t){function e(s){return _u(s,t)}if(0<_f.length){_u(_f[0],t);for(var n=1;n<_f.length;n++){var r=_f[n];r.blockedOn===t&&(r.blockedOn=null)}}for(oo!==null&&_u(oo,t),ao!==null&&_u(ao,t),lo!==null&&_u(lo,t),Lh.forEach(e),jh.forEach(e),n=0;n<Wi.length;n++)r=Wi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Wi.length&&(n=Wi[0],n.blockedOn===null);)TR(n),n.blockedOn===null&&Wi.shift()}var nc=wi.ReactCurrentBatchConfig,em=!0;function K3(t,e,n,r){var s=Ze,i=nc.transition;nc.transition=null;try{Ze=1,R_(t,e,n,r)}finally{Ze=s,nc.transition=i}}function G3(t,e,n,r){var s=Ze,i=nc.transition;nc.transition=null;try{Ze=4,R_(t,e,n,r)}finally{Ze=s,nc.transition=i}}function R_(t,e,n,r){if(em){var s=fw(t,e,n,r);if(s===null)Mv(t,e,r,tm,n),gE(t,r);else if(W3(s,t,e,n,r))r.stopPropagation();else if(gE(t,r),e&4&&-1<H3.indexOf(t)){for(;s!==null;){var i=Id(s);if(i!==null&&wR(i),i=fw(t,e,n,r),i===null&&Mv(t,e,r,tm,n),i===s)break;s=i}s!==null&&r.stopPropagation()}else Mv(t,e,r,null,n)}}var tm=null;function fw(t,e,n,r){if(tm=null,t=k_(r),t=ua(t),t!==null)if(e=ol(t),e===null)t=null;else if(n=e.tag,n===13){if(t=hR(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return tm=t,null}function ER(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(D3()){case C_:return 1;case mR:return 4;case Yp:case L3:return 16;case gR:return 536870912;default:return 16}default:return 16}}var eo=null,N_=null,hp=null;function SR(){if(hp)return hp;var t,e=N_,n=e.length,r,s="value"in eo?eo.value:eo.textContent,i=s.length;for(t=0;t<n&&e[t]===s[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===s[i-r];r++);return hp=s.slice(t,1<r?1-r:void 0)}function dp(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function xf(){return!0}function vE(){return!1}function xr(t){function e(n,r,s,i,o){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(i):i[a]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?xf:vE,this.isPropagationStopped=vE,this}return kt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=xf)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=xf)},persist:function(){},isPersistent:xf}),e}var Gc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},P_=xr(Gc),Cd=kt({},Gc,{view:0,detail:0}),Q3=xr(Cd),Ev,Sv,xu,$g=kt({},Cd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:M_,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xu&&(xu&&t.type==="mousemove"?(Ev=t.screenX-xu.screenX,Sv=t.screenY-xu.screenY):Sv=Ev=0,xu=t),Ev)},movementY:function(t){return"movementY"in t?t.movementY:Sv}}),wE=xr($g),J3=kt({},$g,{dataTransfer:0}),X3=xr(J3),Y3=kt({},Cd,{relatedTarget:0}),kv=xr(Y3),Z3=kt({},Gc,{animationName:0,elapsedTime:0,pseudoElement:0}),eV=xr(Z3),tV=kt({},Gc,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),nV=xr(tV),rV=kt({},Gc,{data:0}),_E=xr(rV),sV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},iV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},oV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aV(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=oV[t])?!!e[t]:!1}function M_(){return aV}var lV=kt({},Cd,{key:function(t){if(t.key){var e=sV[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=dp(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?iV[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:M_,charCode:function(t){return t.type==="keypress"?dp(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?dp(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),cV=xr(lV),uV=kt({},$g,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xE=xr(uV),hV=kt({},Cd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:M_}),dV=xr(hV),fV=kt({},Gc,{propertyName:0,elapsedTime:0,pseudoElement:0}),pV=xr(fV),mV=kt({},$g,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),gV=xr(mV),yV=[9,13,27,32],O_=ui&&"CompositionEvent"in window,ih=null;ui&&"documentMode"in document&&(ih=document.documentMode);var vV=ui&&"TextEvent"in window&&!ih,kR=ui&&(!O_||ih&&8<ih&&11>=ih),bE=" ",TE=!1;function CR(t,e){switch(t){case"keyup":return yV.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function IR(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bl=!1;function wV(t,e){switch(t){case"compositionend":return IR(e);case"keypress":return e.which!==32?null:(TE=!0,bE);case"textInput":return t=e.data,t===bE&&TE?null:t;default:return null}}function _V(t,e){if(Bl)return t==="compositionend"||!O_&&CR(t,e)?(t=SR(),hp=N_=eo=null,Bl=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return kR&&e.locale!=="ko"?null:e.data;default:return null}}var xV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function EE(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!xV[t.type]:e==="textarea"}function AR(t,e,n,r){oR(r),e=nm(e,"onChange"),0<e.length&&(n=new P_("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var oh=null,Fh=null;function bV(t){BR(t,0)}function Hg(t){var e=$l(t);if(ZA(e))return t}function TV(t,e){if(t==="change")return e}var RR=!1;if(ui){var Cv;if(ui){var Iv="oninput"in document;if(!Iv){var SE=document.createElement("div");SE.setAttribute("oninput","return;"),Iv=typeof SE.oninput=="function"}Cv=Iv}else Cv=!1;RR=Cv&&(!document.documentMode||9<document.documentMode)}function kE(){oh&&(oh.detachEvent("onpropertychange",NR),Fh=oh=null)}function NR(t){if(t.propertyName==="value"&&Hg(Fh)){var e=[];AR(e,Fh,t,k_(t)),uR(bV,e)}}function EV(t,e,n){t==="focusin"?(kE(),oh=e,Fh=n,oh.attachEvent("onpropertychange",NR)):t==="focusout"&&kE()}function SV(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Hg(Fh)}function kV(t,e){if(t==="click")return Hg(e)}function CV(t,e){if(t==="input"||t==="change")return Hg(e)}function IV(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ls=typeof Object.is=="function"?Object.is:IV;function Bh(t,e){if(ls(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Q0.call(e,s)||!ls(t[s],e[s]))return!1}return!0}function CE(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function IE(t,e){var n=CE(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=CE(n)}}function PR(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?PR(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function MR(){for(var t=window,e=Qp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qp(t.document)}return e}function D_(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function AV(t){var e=MR(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&PR(n.ownerDocument.documentElement,n)){if(r!==null&&D_(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,i=Math.min(r.start,s);r=r.end===void 0?i:Math.min(r.end,s),!t.extend&&i>r&&(s=r,r=i,i=s),s=IE(n,i);var o=IE(n,r);s&&o&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),i>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var RV=ui&&"documentMode"in document&&11>=document.documentMode,Ul=null,pw=null,ah=null,mw=!1;function AE(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;mw||Ul==null||Ul!==Qp(r)||(r=Ul,"selectionStart"in r&&D_(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ah&&Bh(ah,r)||(ah=r,r=nm(pw,"onSelect"),0<r.length&&(e=new P_("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ul)))}function bf(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var zl={animationend:bf("Animation","AnimationEnd"),animationiteration:bf("Animation","AnimationIteration"),animationstart:bf("Animation","AnimationStart"),transitionend:bf("Transition","TransitionEnd")},Av={},OR={};ui&&(OR=document.createElement("div").style,"AnimationEvent"in window||(delete zl.animationend.animation,delete zl.animationiteration.animation,delete zl.animationstart.animation),"TransitionEvent"in window||delete zl.transitionend.transition);function Wg(t){if(Av[t])return Av[t];if(!zl[t])return t;var e=zl[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in OR)return Av[t]=e[n];return t}var DR=Wg("animationend"),LR=Wg("animationiteration"),jR=Wg("animationstart"),VR=Wg("transitionend"),FR=new Map,RE="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Oo(t,e){FR.set(t,e),il(e,[t])}for(var Rv=0;Rv<RE.length;Rv++){var Nv=RE[Rv],NV=Nv.toLowerCase(),PV=Nv[0].toUpperCase()+Nv.slice(1);Oo(NV,"on"+PV)}Oo(DR,"onAnimationEnd");Oo(LR,"onAnimationIteration");Oo(jR,"onAnimationStart");Oo("dblclick","onDoubleClick");Oo("focusin","onFocus");Oo("focusout","onBlur");Oo(VR,"onTransitionEnd");yc("onMouseEnter",["mouseout","mouseover"]);yc("onMouseLeave",["mouseout","mouseover"]);yc("onPointerEnter",["pointerout","pointerover"]);yc("onPointerLeave",["pointerout","pointerover"]);il("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));il("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));il("onBeforeInput",["compositionend","keypress","textInput","paste"]);il("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));il("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));il("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Hu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MV=new Set("cancel close invalid load scroll toggle".split(" ").concat(Hu));function NE(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,N3(r,e,void 0,t),t.currentTarget=null}function BR(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var i=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==i&&s.isPropagationStopped())break e;NE(s,a,c),i=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==i&&s.isPropagationStopped())break e;NE(s,a,c),i=l}}}if(Xp)throw t=uw,Xp=!1,uw=null,t}function ct(t,e){var n=e[_w];n===void 0&&(n=e[_w]=new Set);var r=t+"__bubble";n.has(r)||(UR(e,t,2,!1),n.add(r))}function Pv(t,e,n){var r=0;e&&(r|=4),UR(n,t,r,e)}var Tf="_reactListening"+Math.random().toString(36).slice(2);function Uh(t){if(!t[Tf]){t[Tf]=!0,GA.forEach(function(n){n!=="selectionchange"&&(MV.has(n)||Pv(n,!1,t),Pv(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Tf]||(e[Tf]=!0,Pv("selectionchange",!1,e))}}function UR(t,e,n,r){switch(ER(e)){case 1:var s=K3;break;case 4:s=G3;break;default:s=R_}n=s.bind(null,e,n,t),s=void 0,!cw||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Mv(t,e,n,r,s){var i=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===s||l.nodeType===8&&l.parentNode===s))return;o=o.return}for(;a!==null;){if(o=ua(a),o===null)return;if(l=o.tag,l===5||l===6){r=i=o;continue e}a=a.parentNode}}r=r.return}uR(function(){var c=i,u=k_(n),h=[];e:{var d=FR.get(t);if(d!==void 0){var f=P_,g=t;switch(t){case"keypress":if(dp(n)===0)break e;case"keydown":case"keyup":f=cV;break;case"focusin":g="focus",f=kv;break;case"focusout":g="blur",f=kv;break;case"beforeblur":case"afterblur":f=kv;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=wE;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=X3;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=dV;break;case DR:case LR:case jR:f=eV;break;case VR:f=pV;break;case"scroll":f=Q3;break;case"wheel":f=gV;break;case"copy":case"cut":case"paste":f=nV;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=xE}var y=(e&4)!==0,v=!y&&t==="scroll",w=y?d!==null?d+"Capture":null:d;y=[];for(var T=c,E;T!==null;){E=T;var R=E.stateNode;if(E.tag===5&&R!==null&&(E=R,w!==null&&(R=Dh(T,w),R!=null&&y.push(zh(T,R,E)))),v)break;T=T.return}0<y.length&&(d=new f(d,g,null,n,u),h.push({event:d,listeners:y}))}}if(!(e&7)){e:{if(d=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",d&&n!==aw&&(g=n.relatedTarget||n.fromElement)&&(ua(g)||g[hi]))break e;if((f||d)&&(d=u.window===u?u:(d=u.ownerDocument)?d.defaultView||d.parentWindow:window,f?(g=n.relatedTarget||n.toElement,f=c,g=g?ua(g):null,g!==null&&(v=ol(g),g!==v||g.tag!==5&&g.tag!==6)&&(g=null)):(f=null,g=c),f!==g)){if(y=wE,R="onMouseLeave",w="onMouseEnter",T="mouse",(t==="pointerout"||t==="pointerover")&&(y=xE,R="onPointerLeave",w="onPointerEnter",T="pointer"),v=f==null?d:$l(f),E=g==null?d:$l(g),d=new y(R,T+"leave",f,n,u),d.target=v,d.relatedTarget=E,R=null,ua(u)===c&&(y=new y(w,T+"enter",g,n,u),y.target=E,y.relatedTarget=v,R=y),v=R,f&&g)t:{for(y=f,w=g,T=0,E=y;E;E=yl(E))T++;for(E=0,R=w;R;R=yl(R))E++;for(;0<T-E;)y=yl(y),T--;for(;0<E-T;)w=yl(w),E--;for(;T--;){if(y===w||w!==null&&y===w.alternate)break t;y=yl(y),w=yl(w)}y=null}else y=null;f!==null&&PE(h,d,f,y,!1),g!==null&&v!==null&&PE(h,v,g,y,!0)}}e:{if(d=c?$l(c):window,f=d.nodeName&&d.nodeName.toLowerCase(),f==="select"||f==="input"&&d.type==="file")var P=TV;else if(EE(d))if(RR)P=CV;else{P=SV;var N=EV}else(f=d.nodeName)&&f.toLowerCase()==="input"&&(d.type==="checkbox"||d.type==="radio")&&(P=kV);if(P&&(P=P(t,c))){AR(h,P,n,u);break e}N&&N(t,d,c),t==="focusout"&&(N=d._wrapperState)&&N.controlled&&d.type==="number"&&nw(d,"number",d.value)}switch(N=c?$l(c):window,t){case"focusin":(EE(N)||N.contentEditable==="true")&&(Ul=N,pw=c,ah=null);break;case"focusout":ah=pw=Ul=null;break;case"mousedown":mw=!0;break;case"contextmenu":case"mouseup":case"dragend":mw=!1,AE(h,n,u);break;case"selectionchange":if(RV)break;case"keydown":case"keyup":AE(h,n,u)}var k;if(O_)e:{switch(t){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Bl?CR(t,n)&&(_="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(_="onCompositionStart");_&&(kR&&n.locale!=="ko"&&(Bl||_!=="onCompositionStart"?_==="onCompositionEnd"&&Bl&&(k=SR()):(eo=u,N_="value"in eo?eo.value:eo.textContent,Bl=!0)),N=nm(c,_),0<N.length&&(_=new _E(_,t,null,n,u),h.push({event:_,listeners:N}),k?_.data=k:(k=IR(n),k!==null&&(_.data=k)))),(k=vV?wV(t,n):_V(t,n))&&(c=nm(c,"onBeforeInput"),0<c.length&&(u=new _E("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=k))}BR(h,e)})}function zh(t,e,n){return{instance:t,listener:e,currentTarget:n}}function nm(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=Dh(t,n),i!=null&&r.unshift(zh(t,i,s)),i=Dh(t,e),i!=null&&r.push(zh(t,i,s))),t=t.return}return r}function yl(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function PE(t,e,n,r,s){for(var i=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,s?(l=Dh(n,i),l!=null&&o.unshift(zh(n,l,a))):s||(l=Dh(n,i),l!=null&&o.push(zh(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var OV=/\r\n?/g,DV=/\u0000|\uFFFD/g;function ME(t){return(typeof t=="string"?t:""+t).replace(OV,`
`).replace(DV,"")}function Ef(t,e,n){if(e=ME(e),ME(t)!==e&&n)throw Error(oe(425))}function rm(){}var gw=null,yw=null;function vw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ww=typeof setTimeout=="function"?setTimeout:void 0,LV=typeof clearTimeout=="function"?clearTimeout:void 0,OE=typeof Promise=="function"?Promise:void 0,jV=typeof queueMicrotask=="function"?queueMicrotask:typeof OE<"u"?function(t){return OE.resolve(null).then(t).catch(VV)}:ww;function VV(t){setTimeout(function(){throw t})}function Ov(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Vh(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Vh(e)}function co(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function DE(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qc=Math.random().toString(36).slice(2),xs="__reactFiber$"+Qc,$h="__reactProps$"+Qc,hi="__reactContainer$"+Qc,_w="__reactEvents$"+Qc,FV="__reactListeners$"+Qc,BV="__reactHandles$"+Qc;function ua(t){var e=t[xs];if(e)return e;for(var n=t.parentNode;n;){if(e=n[hi]||n[xs]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=DE(t);t!==null;){if(n=t[xs])return n;t=DE(t)}return e}t=n,n=t.parentNode}return null}function Id(t){return t=t[xs]||t[hi],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function $l(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(oe(33))}function qg(t){return t[$h]||null}var xw=[],Hl=-1;function Do(t){return{current:t}}function ht(t){0>Hl||(t.current=xw[Hl],xw[Hl]=null,Hl--)}function ot(t,e){Hl++,xw[Hl]=t.current,t.current=e}var So={},On=Do(So),nr=Do(!1),Oa=So;function vc(t,e){var n=t.type.contextTypes;if(!n)return So;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=e[i];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function rr(t){return t=t.childContextTypes,t!=null}function sm(){ht(nr),ht(On)}function LE(t,e,n){if(On.current!==So)throw Error(oe(168));ot(On,e),ot(nr,n)}function zR(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(oe(108,E3(t)||"Unknown",s));return kt({},n,r)}function im(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||So,Oa=On.current,ot(On,t),ot(nr,nr.current),!0}function jE(t,e,n){var r=t.stateNode;if(!r)throw Error(oe(169));n?(t=zR(t,e,Oa),r.__reactInternalMemoizedMergedChildContext=t,ht(nr),ht(On),ot(On,t)):ht(nr),ot(nr,n)}var Qs=null,Kg=!1,Dv=!1;function $R(t){Qs===null?Qs=[t]:Qs.push(t)}function UV(t){Kg=!0,$R(t)}function Lo(){if(!Dv&&Qs!==null){Dv=!0;var t=0,e=Ze;try{var n=Qs;for(Ze=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Qs=null,Kg=!1}catch(s){throw Qs!==null&&(Qs=Qs.slice(t+1)),pR(C_,Lo),s}finally{Ze=e,Dv=!1}}return null}var Wl=[],ql=0,om=null,am=0,Ar=[],Rr=0,Da=null,Ys=1,Zs="";function Yo(t,e){Wl[ql++]=am,Wl[ql++]=om,om=t,am=e}function HR(t,e,n){Ar[Rr++]=Ys,Ar[Rr++]=Zs,Ar[Rr++]=Da,Da=t;var r=Ys;t=Zs;var s=32-ss(r)-1;r&=~(1<<s),n+=1;var i=32-ss(e)+s;if(30<i){var o=s-s%5;i=(r&(1<<o)-1).toString(32),r>>=o,s-=o,Ys=1<<32-ss(e)+s|n<<s|r,Zs=i+t}else Ys=1<<i|n<<s|r,Zs=t}function L_(t){t.return!==null&&(Yo(t,1),HR(t,1,0))}function j_(t){for(;t===om;)om=Wl[--ql],Wl[ql]=null,am=Wl[--ql],Wl[ql]=null;for(;t===Da;)Da=Ar[--Rr],Ar[Rr]=null,Zs=Ar[--Rr],Ar[Rr]=null,Ys=Ar[--Rr],Ar[Rr]=null}var gr=null,fr=null,wt=!1,Yr=null;function WR(t,e){var n=Mr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function VE(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,gr=t,fr=co(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,gr=t,fr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Da!==null?{id:Ys,overflow:Zs}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Mr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,gr=t,fr=null,!0):!1;default:return!1}}function bw(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tw(t){if(wt){var e=fr;if(e){var n=e;if(!VE(t,e)){if(bw(t))throw Error(oe(418));e=co(n.nextSibling);var r=gr;e&&VE(t,e)?WR(r,n):(t.flags=t.flags&-4097|2,wt=!1,gr=t)}}else{if(bw(t))throw Error(oe(418));t.flags=t.flags&-4097|2,wt=!1,gr=t}}}function FE(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;gr=t}function Sf(t){if(t!==gr)return!1;if(!wt)return FE(t),wt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!vw(t.type,t.memoizedProps)),e&&(e=fr)){if(bw(t))throw qR(),Error(oe(418));for(;e;)WR(t,e),e=co(e.nextSibling)}if(FE(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(oe(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){fr=co(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}fr=null}}else fr=gr?co(t.stateNode.nextSibling):null;return!0}function qR(){for(var t=fr;t;)t=co(t.nextSibling)}function wc(){fr=gr=null,wt=!1}function V_(t){Yr===null?Yr=[t]:Yr.push(t)}var zV=wi.ReactCurrentBatchConfig;function bu(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(oe(309));var r=n.stateNode}if(!r)throw Error(oe(147,t));var s=r,i=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===i?e.ref:(e=function(o){var a=s.refs;o===null?delete a[i]:a[i]=o},e._stringRef=i,e)}if(typeof t!="string")throw Error(oe(284));if(!n._owner)throw Error(oe(290,t))}return t}function kf(t,e){throw t=Object.prototype.toString.call(e),Error(oe(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function BE(t){var e=t._init;return e(t._payload)}function KR(t){function e(w,T){if(t){var E=w.deletions;E===null?(w.deletions=[T],w.flags|=16):E.push(T)}}function n(w,T){if(!t)return null;for(;T!==null;)e(w,T),T=T.sibling;return null}function r(w,T){for(w=new Map;T!==null;)T.key!==null?w.set(T.key,T):w.set(T.index,T),T=T.sibling;return w}function s(w,T){return w=po(w,T),w.index=0,w.sibling=null,w}function i(w,T,E){return w.index=E,t?(E=w.alternate,E!==null?(E=E.index,E<T?(w.flags|=2,T):E):(w.flags|=2,T)):(w.flags|=1048576,T)}function o(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,T,E,R){return T===null||T.tag!==6?(T=zv(E,w.mode,R),T.return=w,T):(T=s(T,E),T.return=w,T)}function l(w,T,E,R){var P=E.type;return P===Fl?u(w,T,E.props.children,R,E.key):T!==null&&(T.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Bi&&BE(P)===T.type)?(R=s(T,E.props),R.ref=bu(w,T,E),R.return=w,R):(R=wp(E.type,E.key,E.props,null,w.mode,R),R.ref=bu(w,T,E),R.return=w,R)}function c(w,T,E,R){return T===null||T.tag!==4||T.stateNode.containerInfo!==E.containerInfo||T.stateNode.implementation!==E.implementation?(T=$v(E,w.mode,R),T.return=w,T):(T=s(T,E.children||[]),T.return=w,T)}function u(w,T,E,R,P){return T===null||T.tag!==7?(T=ba(E,w.mode,R,P),T.return=w,T):(T=s(T,E),T.return=w,T)}function h(w,T,E){if(typeof T=="string"&&T!==""||typeof T=="number")return T=zv(""+T,w.mode,E),T.return=w,T;if(typeof T=="object"&&T!==null){switch(T.$$typeof){case mf:return E=wp(T.type,T.key,T.props,null,w.mode,E),E.ref=bu(w,null,T),E.return=w,E;case Vl:return T=$v(T,w.mode,E),T.return=w,T;case Bi:var R=T._init;return h(w,R(T._payload),E)}if(zu(T)||yu(T))return T=ba(T,w.mode,E,null),T.return=w,T;kf(w,T)}return null}function d(w,T,E,R){var P=T!==null?T.key:null;if(typeof E=="string"&&E!==""||typeof E=="number")return P!==null?null:a(w,T,""+E,R);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case mf:return E.key===P?l(w,T,E,R):null;case Vl:return E.key===P?c(w,T,E,R):null;case Bi:return P=E._init,d(w,T,P(E._payload),R)}if(zu(E)||yu(E))return P!==null?null:u(w,T,E,R,null);kf(w,E)}return null}function f(w,T,E,R,P){if(typeof R=="string"&&R!==""||typeof R=="number")return w=w.get(E)||null,a(T,w,""+R,P);if(typeof R=="object"&&R!==null){switch(R.$$typeof){case mf:return w=w.get(R.key===null?E:R.key)||null,l(T,w,R,P);case Vl:return w=w.get(R.key===null?E:R.key)||null,c(T,w,R,P);case Bi:var N=R._init;return f(w,T,E,N(R._payload),P)}if(zu(R)||yu(R))return w=w.get(E)||null,u(T,w,R,P,null);kf(T,R)}return null}function g(w,T,E,R){for(var P=null,N=null,k=T,_=T=0,x=null;k!==null&&_<E.length;_++){k.index>_?(x=k,k=null):x=k.sibling;var S=d(w,k,E[_],R);if(S===null){k===null&&(k=x);break}t&&k&&S.alternate===null&&e(w,k),T=i(S,T,_),N===null?P=S:N.sibling=S,N=S,k=x}if(_===E.length)return n(w,k),wt&&Yo(w,_),P;if(k===null){for(;_<E.length;_++)k=h(w,E[_],R),k!==null&&(T=i(k,T,_),N===null?P=k:N.sibling=k,N=k);return wt&&Yo(w,_),P}for(k=r(w,k);_<E.length;_++)x=f(k,w,_,E[_],R),x!==null&&(t&&x.alternate!==null&&k.delete(x.key===null?_:x.key),T=i(x,T,_),N===null?P=x:N.sibling=x,N=x);return t&&k.forEach(function(A){return e(w,A)}),wt&&Yo(w,_),P}function y(w,T,E,R){var P=yu(E);if(typeof P!="function")throw Error(oe(150));if(E=P.call(E),E==null)throw Error(oe(151));for(var N=P=null,k=T,_=T=0,x=null,S=E.next();k!==null&&!S.done;_++,S=E.next()){k.index>_?(x=k,k=null):x=k.sibling;var A=d(w,k,S.value,R);if(A===null){k===null&&(k=x);break}t&&k&&A.alternate===null&&e(w,k),T=i(A,T,_),N===null?P=A:N.sibling=A,N=A,k=x}if(S.done)return n(w,k),wt&&Yo(w,_),P;if(k===null){for(;!S.done;_++,S=E.next())S=h(w,S.value,R),S!==null&&(T=i(S,T,_),N===null?P=S:N.sibling=S,N=S);return wt&&Yo(w,_),P}for(k=r(w,k);!S.done;_++,S=E.next())S=f(k,w,_,S.value,R),S!==null&&(t&&S.alternate!==null&&k.delete(S.key===null?_:S.key),T=i(S,T,_),N===null?P=S:N.sibling=S,N=S);return t&&k.forEach(function(M){return e(w,M)}),wt&&Yo(w,_),P}function v(w,T,E,R){if(typeof E=="object"&&E!==null&&E.type===Fl&&E.key===null&&(E=E.props.children),typeof E=="object"&&E!==null){switch(E.$$typeof){case mf:e:{for(var P=E.key,N=T;N!==null;){if(N.key===P){if(P=E.type,P===Fl){if(N.tag===7){n(w,N.sibling),T=s(N,E.props.children),T.return=w,w=T;break e}}else if(N.elementType===P||typeof P=="object"&&P!==null&&P.$$typeof===Bi&&BE(P)===N.type){n(w,N.sibling),T=s(N,E.props),T.ref=bu(w,N,E),T.return=w,w=T;break e}n(w,N);break}else e(w,N);N=N.sibling}E.type===Fl?(T=ba(E.props.children,w.mode,R,E.key),T.return=w,w=T):(R=wp(E.type,E.key,E.props,null,w.mode,R),R.ref=bu(w,T,E),R.return=w,w=R)}return o(w);case Vl:e:{for(N=E.key;T!==null;){if(T.key===N)if(T.tag===4&&T.stateNode.containerInfo===E.containerInfo&&T.stateNode.implementation===E.implementation){n(w,T.sibling),T=s(T,E.children||[]),T.return=w,w=T;break e}else{n(w,T);break}else e(w,T);T=T.sibling}T=$v(E,w.mode,R),T.return=w,w=T}return o(w);case Bi:return N=E._init,v(w,T,N(E._payload),R)}if(zu(E))return g(w,T,E,R);if(yu(E))return y(w,T,E,R);kf(w,E)}return typeof E=="string"&&E!==""||typeof E=="number"?(E=""+E,T!==null&&T.tag===6?(n(w,T.sibling),T=s(T,E),T.return=w,w=T):(n(w,T),T=zv(E,w.mode,R),T.return=w,w=T),o(w)):n(w,T)}return v}var _c=KR(!0),GR=KR(!1),lm=Do(null),cm=null,Kl=null,F_=null;function B_(){F_=Kl=cm=null}function U_(t){var e=lm.current;ht(lm),t._currentValue=e}function Ew(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function rc(t,e){cm=t,F_=Kl=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(er=!0),t.firstContext=null)}function Fr(t){var e=t._currentValue;if(F_!==t)if(t={context:t,memoizedValue:e,next:null},Kl===null){if(cm===null)throw Error(oe(308));Kl=t,cm.dependencies={lanes:0,firstContext:t}}else Kl=Kl.next=t;return e}var ha=null;function z_(t){ha===null?ha=[t]:ha.push(t)}function QR(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,z_(e)):(n.next=s.next,s.next=n),e.interleaved=n,di(t,r)}function di(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ui=!1;function $_(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JR(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function si(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function uo(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,qe&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,di(t,n)}return s=r.interleaved,s===null?(e.next=e,z_(r)):(e.next=s.next,s.next=e),r.interleaved=e,di(t,n)}function fp(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,I_(t,n)}}function UE(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=o:i=i.next=o,n=n.next}while(n!==null);i===null?s=i=e:i=i.next=e}else s=i=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function um(t,e,n,r){var s=t.updateQueue;Ui=!1;var i=s.firstBaseUpdate,o=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?i=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(i!==null){var h=s.baseState;o=0,u=c=l=null,a=i;do{var d=a.lane,f=a.eventTime;if((r&d)===d){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var g=t,y=a;switch(d=e,f=n,y.tag){case 1:if(g=y.payload,typeof g=="function"){h=g.call(f,h,d);break e}h=g;break e;case 3:g.flags=g.flags&-65537|128;case 0:if(g=y.payload,d=typeof g=="function"?g.call(f,h,d):g,d==null)break e;h=kt({},h,d);break e;case 2:Ui=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,d=s.effects,d===null?s.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=h):u=u.next=f,o|=d;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;d=a,a=d.next,d.next=null,s.lastBaseUpdate=d,s.shared.pending=null}}while(!0);if(u===null&&(l=h),s.baseState=l,s.firstBaseUpdate=c,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else i===null&&(s.shared.lanes=0);ja|=o,t.lanes=o,t.memoizedState=h}}function zE(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(oe(191,s));s.call(r)}}}var Ad={},ks=Do(Ad),Hh=Do(Ad),Wh=Do(Ad);function da(t){if(t===Ad)throw Error(oe(174));return t}function H_(t,e){switch(ot(Wh,e),ot(Hh,t),ot(ks,Ad),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:sw(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=sw(e,t)}ht(ks),ot(ks,e)}function xc(){ht(ks),ht(Hh),ht(Wh)}function XR(t){da(Wh.current);var e=da(ks.current),n=sw(e,t.type);e!==n&&(ot(Hh,t),ot(ks,n))}function W_(t){Hh.current===t&&(ht(ks),ht(Hh))}var bt=Do(0);function hm(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Lv=[];function q_(){for(var t=0;t<Lv.length;t++)Lv[t]._workInProgressVersionPrimary=null;Lv.length=0}var pp=wi.ReactCurrentDispatcher,jv=wi.ReactCurrentBatchConfig,La=0,Et=null,Xt=null,sn=null,dm=!1,lh=!1,qh=0,$V=0;function En(){throw Error(oe(321))}function K_(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ls(t[n],e[n]))return!1;return!0}function G_(t,e,n,r,s,i){if(La=i,Et=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,pp.current=t===null||t.memoizedState===null?KV:GV,t=n(r,s),lh){i=0;do{if(lh=!1,qh=0,25<=i)throw Error(oe(301));i+=1,sn=Xt=null,e.updateQueue=null,pp.current=QV,t=n(r,s)}while(lh)}if(pp.current=fm,e=Xt!==null&&Xt.next!==null,La=0,sn=Xt=Et=null,dm=!1,e)throw Error(oe(300));return t}function Q_(){var t=qh!==0;return qh=0,t}function ms(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return sn===null?Et.memoizedState=sn=t:sn=sn.next=t,sn}function Br(){if(Xt===null){var t=Et.alternate;t=t!==null?t.memoizedState:null}else t=Xt.next;var e=sn===null?Et.memoizedState:sn.next;if(e!==null)sn=e,Xt=t;else{if(t===null)throw Error(oe(310));Xt=t,t={memoizedState:Xt.memoizedState,baseState:Xt.baseState,baseQueue:Xt.baseQueue,queue:Xt.queue,next:null},sn===null?Et.memoizedState=sn=t:sn=sn.next=t}return sn}function Kh(t,e){return typeof e=="function"?e(t):e}function Vv(t){var e=Br(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=Xt,s=r.baseQueue,i=n.pending;if(i!==null){if(s!==null){var o=s.next;s.next=i.next,i.next=o}r.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,r=r.baseState;var a=o=null,l=null,c=i;do{var u=c.lane;if((La&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,Et.lanes|=u,ja|=u}c=c.next}while(c!==null&&c!==i);l===null?o=r:l.next=a,ls(r,e.memoizedState)||(er=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do i=s.lane,Et.lanes|=i,ja|=i,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Fv(t){var e=Br(),n=e.queue;if(n===null)throw Error(oe(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,i=e.memoizedState;if(s!==null){n.pending=null;var o=s=s.next;do i=t(i,o.action),o=o.next;while(o!==s);ls(i,e.memoizedState)||(er=!0),e.memoizedState=i,e.baseQueue===null&&(e.baseState=i),n.lastRenderedState=i}return[i,r]}function YR(){}function ZR(t,e){var n=Et,r=Br(),s=e(),i=!ls(r.memoizedState,s);if(i&&(r.memoizedState=s,er=!0),r=r.queue,J_(nN.bind(null,n,r,t),[t]),r.getSnapshot!==e||i||sn!==null&&sn.memoizedState.tag&1){if(n.flags|=2048,Gh(9,tN.bind(null,n,r,s,e),void 0,null),cn===null)throw Error(oe(349));La&30||eN(n,e,s)}return s}function eN(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function tN(t,e,n,r){e.value=n,e.getSnapshot=r,rN(e)&&sN(t)}function nN(t,e,n){return n(function(){rN(e)&&sN(t)})}function rN(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ls(t,n)}catch{return!0}}function sN(t){var e=di(t,1);e!==null&&is(e,t,1,-1)}function $E(t){var e=ms();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Kh,lastRenderedState:t},e.queue=t,t=t.dispatch=qV.bind(null,Et,t),[e.memoizedState,t]}function Gh(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=Et.updateQueue,e===null?(e={lastEffect:null,stores:null},Et.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function iN(){return Br().memoizedState}function mp(t,e,n,r){var s=ms();Et.flags|=t,s.memoizedState=Gh(1|e,n,void 0,r===void 0?null:r)}function Gg(t,e,n,r){var s=Br();r=r===void 0?null:r;var i=void 0;if(Xt!==null){var o=Xt.memoizedState;if(i=o.destroy,r!==null&&K_(r,o.deps)){s.memoizedState=Gh(e,n,i,r);return}}Et.flags|=t,s.memoizedState=Gh(1|e,n,i,r)}function HE(t,e){return mp(8390656,8,t,e)}function J_(t,e){return Gg(2048,8,t,e)}function oN(t,e){return Gg(4,2,t,e)}function aN(t,e){return Gg(4,4,t,e)}function lN(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function cN(t,e,n){return n=n!=null?n.concat([t]):null,Gg(4,4,lN.bind(null,e,t),n)}function X_(){}function uN(t,e){var n=Br();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&K_(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function hN(t,e){var n=Br();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&K_(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function dN(t,e,n){return La&21?(ls(n,e)||(n=yR(),Et.lanes|=n,ja|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,er=!0),t.memoizedState=n)}function HV(t,e){var n=Ze;Ze=n!==0&&4>n?n:4,t(!0);var r=jv.transition;jv.transition={};try{t(!1),e()}finally{Ze=n,jv.transition=r}}function fN(){return Br().memoizedState}function WV(t,e,n){var r=fo(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},pN(t))mN(e,n);else if(n=QR(t,e,n,r),n!==null){var s=Un();is(n,t,r,s),gN(n,e,r)}}function qV(t,e,n){var r=fo(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(pN(t))mN(e,s);else{var i=t.alternate;if(t.lanes===0&&(i===null||i.lanes===0)&&(i=e.lastRenderedReducer,i!==null))try{var o=e.lastRenderedState,a=i(o,n);if(s.hasEagerState=!0,s.eagerState=a,ls(a,o)){var l=e.interleaved;l===null?(s.next=s,z_(e)):(s.next=l.next,l.next=s),e.interleaved=s;return}}catch{}finally{}n=QR(t,e,s,r),n!==null&&(s=Un(),is(n,t,r,s),gN(n,e,r))}}function pN(t){var e=t.alternate;return t===Et||e!==null&&e===Et}function mN(t,e){lh=dm=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function gN(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,I_(t,n)}}var fm={readContext:Fr,useCallback:En,useContext:En,useEffect:En,useImperativeHandle:En,useInsertionEffect:En,useLayoutEffect:En,useMemo:En,useReducer:En,useRef:En,useState:En,useDebugValue:En,useDeferredValue:En,useTransition:En,useMutableSource:En,useSyncExternalStore:En,useId:En,unstable_isNewReconciler:!1},KV={readContext:Fr,useCallback:function(t,e){return ms().memoizedState=[t,e===void 0?null:e],t},useContext:Fr,useEffect:HE,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,mp(4194308,4,lN.bind(null,e,t),n)},useLayoutEffect:function(t,e){return mp(4194308,4,t,e)},useInsertionEffect:function(t,e){return mp(4,2,t,e)},useMemo:function(t,e){var n=ms();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=ms();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=WV.bind(null,Et,t),[r.memoizedState,t]},useRef:function(t){var e=ms();return t={current:t},e.memoizedState=t},useState:$E,useDebugValue:X_,useDeferredValue:function(t){return ms().memoizedState=t},useTransition:function(){var t=$E(!1),e=t[0];return t=HV.bind(null,t[1]),ms().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=Et,s=ms();if(wt){if(n===void 0)throw Error(oe(407));n=n()}else{if(n=e(),cn===null)throw Error(oe(349));La&30||eN(r,e,n)}s.memoizedState=n;var i={value:n,getSnapshot:e};return s.queue=i,HE(nN.bind(null,r,i,t),[t]),r.flags|=2048,Gh(9,tN.bind(null,r,i,n,e),void 0,null),n},useId:function(){var t=ms(),e=cn.identifierPrefix;if(wt){var n=Zs,r=Ys;n=(r&~(1<<32-ss(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=qh++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=$V++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},GV={readContext:Fr,useCallback:uN,useContext:Fr,useEffect:J_,useImperativeHandle:cN,useInsertionEffect:oN,useLayoutEffect:aN,useMemo:hN,useReducer:Vv,useRef:iN,useState:function(){return Vv(Kh)},useDebugValue:X_,useDeferredValue:function(t){var e=Br();return dN(e,Xt.memoizedState,t)},useTransition:function(){var t=Vv(Kh)[0],e=Br().memoizedState;return[t,e]},useMutableSource:YR,useSyncExternalStore:ZR,useId:fN,unstable_isNewReconciler:!1},QV={readContext:Fr,useCallback:uN,useContext:Fr,useEffect:J_,useImperativeHandle:cN,useInsertionEffect:oN,useLayoutEffect:aN,useMemo:hN,useReducer:Fv,useRef:iN,useState:function(){return Fv(Kh)},useDebugValue:X_,useDeferredValue:function(t){var e=Br();return Xt===null?e.memoizedState=t:dN(e,Xt.memoizedState,t)},useTransition:function(){var t=Fv(Kh)[0],e=Br().memoizedState;return[t,e]},useMutableSource:YR,useSyncExternalStore:ZR,useId:fN,unstable_isNewReconciler:!1};function Qr(t,e){if(t&&t.defaultProps){e=kt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Sw(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:kt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Qg={isMounted:function(t){return(t=t._reactInternals)?ol(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Un(),s=fo(t),i=si(r,s);i.payload=e,n!=null&&(i.callback=n),e=uo(t,i,s),e!==null&&(is(e,t,s,r),fp(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Un(),s=fo(t),i=si(r,s);i.tag=1,i.payload=e,n!=null&&(i.callback=n),e=uo(t,i,s),e!==null&&(is(e,t,s,r),fp(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Un(),r=fo(t),s=si(n,r);s.tag=2,e!=null&&(s.callback=e),e=uo(t,s,r),e!==null&&(is(e,t,r,n),fp(e,t,r))}};function WE(t,e,n,r,s,i,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,i,o):e.prototype&&e.prototype.isPureReactComponent?!Bh(n,r)||!Bh(s,i):!0}function yN(t,e,n){var r=!1,s=So,i=e.contextType;return typeof i=="object"&&i!==null?i=Fr(i):(s=rr(e)?Oa:On.current,r=e.contextTypes,i=(r=r!=null)?vc(t,s):So),e=new e(n,i),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Qg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=i),e}function qE(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Qg.enqueueReplaceState(e,e.state,null)}function kw(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs={},$_(t);var i=e.contextType;typeof i=="object"&&i!==null?s.context=Fr(i):(i=rr(e)?Oa:On.current,s.context=vc(t,i)),s.state=t.memoizedState,i=e.getDerivedStateFromProps,typeof i=="function"&&(Sw(t,e,i,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Qg.enqueueReplaceState(s,s.state,null),um(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function bc(t,e){try{var n="",r=e;do n+=T3(r),r=r.return;while(r);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:t,source:e,stack:s,digest:null}}function Bv(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Cw(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var JV=typeof WeakMap=="function"?WeakMap:Map;function vN(t,e,n){n=si(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){mm||(mm=!0,jw=r),Cw(t,e)},n}function wN(t,e,n){n=si(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){Cw(t,e)}}var i=t.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){Cw(t,e),typeof r!="function"&&(ho===null?ho=new Set([this]):ho.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function KE(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new JV;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=u5.bind(null,t,e,n),e.then(t,t))}function GE(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function QE(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=si(-1,1),e.tag=2,uo(n,e,1))),n.lanes|=1),t)}var XV=wi.ReactCurrentOwner,er=!1;function Fn(t,e,n,r){e.child=t===null?GR(e,null,n,r):_c(e,t.child,n,r)}function JE(t,e,n,r,s){n=n.render;var i=e.ref;return rc(e,s),r=G_(t,e,n,r,i,s),n=Q_(),t!==null&&!er?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,fi(t,e,s)):(wt&&n&&L_(e),e.flags|=1,Fn(t,e,r,s),e.child)}function XE(t,e,n,r,s){if(t===null){var i=n.type;return typeof i=="function"&&!ix(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=i,_N(t,e,i,r,s)):(t=wp(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(i=t.child,!(t.lanes&s)){var o=i.memoizedProps;if(n=n.compare,n=n!==null?n:Bh,n(o,r)&&t.ref===e.ref)return fi(t,e,s)}return e.flags|=1,t=po(i,r),t.ref=e.ref,t.return=e,e.child=t}function _N(t,e,n,r,s){if(t!==null){var i=t.memoizedProps;if(Bh(i,r)&&t.ref===e.ref)if(er=!1,e.pendingProps=r=i,(t.lanes&s)!==0)t.flags&131072&&(er=!0);else return e.lanes=t.lanes,fi(t,e,s)}return Iw(t,e,n,r,s)}function xN(t,e,n){var r=e.pendingProps,s=r.children,i=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot(Ql,lr),lr|=n;else{if(!(n&1073741824))return t=i!==null?i.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ot(Ql,lr),lr|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=i!==null?i.baseLanes:n,ot(Ql,lr),lr|=r}else i!==null?(r=i.baseLanes|n,e.memoizedState=null):r=n,ot(Ql,lr),lr|=r;return Fn(t,e,s,n),e.child}function bN(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Iw(t,e,n,r,s){var i=rr(n)?Oa:On.current;return i=vc(e,i),rc(e,s),n=G_(t,e,n,r,i,s),r=Q_(),t!==null&&!er?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,fi(t,e,s)):(wt&&r&&L_(e),e.flags|=1,Fn(t,e,n,s),e.child)}function YE(t,e,n,r,s){if(rr(n)){var i=!0;im(e)}else i=!1;if(rc(e,s),e.stateNode===null)gp(t,e),yN(e,n,r),kw(e,n,r,s),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=Fr(c):(c=rr(n)?Oa:On.current,c=vc(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&qE(e,o,r,c),Ui=!1;var d=e.memoizedState;o.state=d,um(e,r,o,s),l=e.memoizedState,a!==r||d!==l||nr.current||Ui?(typeof u=="function"&&(Sw(e,n,u,r),l=e.memoizedState),(a=Ui||WE(e,n,a,r,d,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,JR(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Qr(e.type,a),o.props=c,h=e.pendingProps,d=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=Fr(l):(l=rr(n)?Oa:On.current,l=vc(e,l));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||d!==l)&&qE(e,o,r,l),Ui=!1,d=e.memoizedState,o.state=d,um(e,r,o,s);var g=e.memoizedState;a!==h||d!==g||nr.current||Ui?(typeof f=="function"&&(Sw(e,n,f,r),g=e.memoizedState),(c=Ui||WE(e,n,c,r,d,g,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,g,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,g,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=g),o.props=r,o.state=g,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&d===t.memoizedState||(e.flags|=1024),r=!1)}return Aw(t,e,n,r,i,s)}function Aw(t,e,n,r,s,i){bN(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return s&&jE(e,n,!1),fi(t,e,i);r=e.stateNode,XV.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=_c(e,t.child,null,i),e.child=_c(e,null,a,i)):Fn(t,e,a,i),e.memoizedState=r.state,s&&jE(e,n,!0),e.child}function TN(t){var e=t.stateNode;e.pendingContext?LE(t,e.pendingContext,e.pendingContext!==e.context):e.context&&LE(t,e.context,!1),H_(t,e.containerInfo)}function ZE(t,e,n,r,s){return wc(),V_(s),e.flags|=256,Fn(t,e,n,r),e.child}var Rw={dehydrated:null,treeContext:null,retryLane:0};function Nw(t){return{baseLanes:t,cachePool:null,transitions:null}}function EN(t,e,n){var r=e.pendingProps,s=bt.current,i=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(i=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),ot(bt,s&1),t===null)return Tw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,i?(r=e.mode,i=e.child,o={mode:"hidden",children:o},!(r&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Yg(o,r,0,null),t=ba(t,r,n,null),i.return=e,t.return=e,i.sibling=t,e.child=i,e.child.memoizedState=Nw(n),e.memoizedState=Rw,t):Y_(e,o));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return YV(t,e,o,r,a,s,n);if(i){i=r.fallback,o=e.mode,s=t.child,a=s.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=po(s,l),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?i=po(a,i):(i=ba(i,o,n,null),i.flags|=2),i.return=e,r.return=e,r.sibling=i,e.child=r,r=i,i=e.child,o=t.child.memoizedState,o=o===null?Nw(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=t.childLanes&~n,e.memoizedState=Rw,r}return i=t.child,t=i.sibling,r=po(i,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Y_(t,e){return e=Yg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Cf(t,e,n,r){return r!==null&&V_(r),_c(e,t.child,null,n),t=Y_(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function YV(t,e,n,r,s,i,o){if(n)return e.flags&256?(e.flags&=-257,r=Bv(Error(oe(422))),Cf(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(i=r.fallback,s=e.mode,r=Yg({mode:"visible",children:r.children},s,0,null),i=ba(i,s,o,null),i.flags|=2,r.return=e,i.return=e,r.sibling=i,e.child=r,e.mode&1&&_c(e,t.child,null,o),e.child.memoizedState=Nw(o),e.memoizedState=Rw,i);if(!(e.mode&1))return Cf(t,e,o,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,i=Error(oe(419)),r=Bv(i,r,void 0),Cf(t,e,o,r)}if(a=(o&t.childLanes)!==0,er||a){if(r=cn,r!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|o)?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,di(t,s),is(r,t,s,-1))}return sx(),r=Bv(Error(oe(421))),Cf(t,e,o,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=h5.bind(null,t),s._reactRetry=e,null):(t=i.treeContext,fr=co(s.nextSibling),gr=e,wt=!0,Yr=null,t!==null&&(Ar[Rr++]=Ys,Ar[Rr++]=Zs,Ar[Rr++]=Da,Ys=t.id,Zs=t.overflow,Da=e),e=Y_(e,r.children),e.flags|=4096,e)}function eS(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Ew(t.return,e,n)}function Uv(t,e,n,r,s){var i=t.memoizedState;i===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(i.isBackwards=e,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=s)}function SN(t,e,n){var r=e.pendingProps,s=r.revealOrder,i=r.tail;if(Fn(t,e,r.children,n),r=bt.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&eS(t,n,e);else if(t.tag===19)eS(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ot(bt,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&hm(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Uv(e,!1,s,n,i);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&hm(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Uv(e,!0,n,null,i);break;case"together":Uv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function gp(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function fi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ja|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(oe(153));if(e.child!==null){for(t=e.child,n=po(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=po(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function ZV(t,e,n){switch(e.tag){case 3:TN(e),wc();break;case 5:XR(e);break;case 1:rr(e.type)&&im(e);break;case 4:H_(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;ot(lm,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ot(bt,bt.current&1),e.flags|=128,null):n&e.child.childLanes?EN(t,e,n):(ot(bt,bt.current&1),t=fi(t,e,n),t!==null?t.sibling:null);ot(bt,bt.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return SN(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),ot(bt,bt.current),r)break;return null;case 22:case 23:return e.lanes=0,xN(t,e,n)}return fi(t,e,n)}var kN,Pw,CN,IN;kN=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pw=function(){};CN=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,da(ks.current);var i=null;switch(n){case"input":s=ew(t,s),r=ew(t,r),i=[];break;case"select":s=kt({},s,{value:void 0}),r=kt({},r,{value:void 0}),i=[];break;case"textarea":s=rw(t,s),r=rw(t,r),i=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=rm)}iw(n,r);var o;n=null;for(c in s)if(!r.hasOwnProperty(c)&&s.hasOwnProperty(c)&&s[c]!=null)if(c==="style"){var a=s[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Mh.hasOwnProperty(c)?i||(i=[]):(i=i||[]).push(c,null));for(c in r){var l=r[c];if(a=s!=null?s[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(i||(i=[]),i.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(i=i||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Mh.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ct("scroll",t),i||a===l||(i=[])):(i=i||[]).push(c,l))}n&&(i=i||[]).push("style",n);var c=i;(e.updateQueue=c)&&(e.flags|=4)}};IN=function(t,e,n,r){n!==r&&(e.flags|=4)};function Tu(t,e){if(!wt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Sn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function e5(t,e,n){var r=e.pendingProps;switch(j_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Sn(e),null;case 1:return rr(e.type)&&sm(),Sn(e),null;case 3:return r=e.stateNode,xc(),ht(nr),ht(On),q_(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Sf(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Yr!==null&&(Bw(Yr),Yr=null))),Pw(t,e),Sn(e),null;case 5:W_(e);var s=da(Wh.current);if(n=e.type,t!==null&&e.stateNode!=null)CN(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(oe(166));return Sn(e),null}if(t=da(ks.current),Sf(e)){r=e.stateNode,n=e.type;var i=e.memoizedProps;switch(r[xs]=e,r[$h]=i,t=(e.mode&1)!==0,n){case"dialog":ct("cancel",r),ct("close",r);break;case"iframe":case"object":case"embed":ct("load",r);break;case"video":case"audio":for(s=0;s<Hu.length;s++)ct(Hu[s],r);break;case"source":ct("error",r);break;case"img":case"image":case"link":ct("error",r),ct("load",r);break;case"details":ct("toggle",r);break;case"input":cE(r,i),ct("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!i.multiple},ct("invalid",r);break;case"textarea":hE(r,i),ct("invalid",r)}iw(n,i),s=null;for(var o in i)if(i.hasOwnProperty(o)){var a=i[o];o==="children"?typeof a=="string"?r.textContent!==a&&(i.suppressHydrationWarning!==!0&&Ef(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(i.suppressHydrationWarning!==!0&&Ef(r.textContent,a,t),s=["children",""+a]):Mh.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ct("scroll",r)}switch(n){case"input":gf(r),uE(r,i,!0);break;case"textarea":gf(r),dE(r);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(r.onclick=rm)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=nR(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[xs]=e,t[$h]=r,kN(t,e,!1,!1),e.stateNode=t;e:{switch(o=ow(n,r),n){case"dialog":ct("cancel",t),ct("close",t),s=r;break;case"iframe":case"object":case"embed":ct("load",t),s=r;break;case"video":case"audio":for(s=0;s<Hu.length;s++)ct(Hu[s],t);s=r;break;case"source":ct("error",t),s=r;break;case"img":case"image":case"link":ct("error",t),ct("load",t),s=r;break;case"details":ct("toggle",t),s=r;break;case"input":cE(t,r),s=ew(t,r),ct("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=kt({},r,{value:void 0}),ct("invalid",t);break;case"textarea":hE(t,r),s=rw(t,r),ct("invalid",t);break;default:s=r}iw(n,s),a=s;for(i in a)if(a.hasOwnProperty(i)){var l=a[i];i==="style"?iR(t,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&rR(t,l)):i==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Oh(t,l):typeof l=="number"&&Oh(t,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Mh.hasOwnProperty(i)?l!=null&&i==="onScroll"&&ct("scroll",t):l!=null&&b_(t,i,l,o))}switch(n){case"input":gf(t),uE(t,r,!1);break;case"textarea":gf(t),dE(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Eo(r.value));break;case"select":t.multiple=!!r.multiple,i=r.value,i!=null?Zl(t,!!r.multiple,i,!1):r.defaultValue!=null&&Zl(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=rm)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Sn(e),null;case 6:if(t&&e.stateNode!=null)IN(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(oe(166));if(n=da(Wh.current),da(ks.current),Sf(e)){if(r=e.stateNode,n=e.memoizedProps,r[xs]=e,(i=r.nodeValue!==n)&&(t=gr,t!==null))switch(t.tag){case 3:Ef(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ef(r.nodeValue,n,(t.mode&1)!==0)}i&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[xs]=e,e.stateNode=r}return Sn(e),null;case 13:if(ht(bt),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(wt&&fr!==null&&e.mode&1&&!(e.flags&128))qR(),wc(),e.flags|=98560,i=!1;else if(i=Sf(e),r!==null&&r.dehydrated!==null){if(t===null){if(!i)throw Error(oe(318));if(i=e.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(oe(317));i[xs]=e}else wc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Sn(e),i=!1}else Yr!==null&&(Bw(Yr),Yr=null),i=!0;if(!i)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||bt.current&1?Yt===0&&(Yt=3):sx())),e.updateQueue!==null&&(e.flags|=4),Sn(e),null);case 4:return xc(),Pw(t,e),t===null&&Uh(e.stateNode.containerInfo),Sn(e),null;case 10:return U_(e.type._context),Sn(e),null;case 17:return rr(e.type)&&sm(),Sn(e),null;case 19:if(ht(bt),i=e.memoizedState,i===null)return Sn(e),null;if(r=(e.flags&128)!==0,o=i.rendering,o===null)if(r)Tu(i,!1);else{if(Yt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=hm(t),o!==null){for(e.flags|=128,Tu(i,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)i=n,t=r,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=t,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,t=o.dependencies,i.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ot(bt,bt.current&1|2),e.child}t=t.sibling}i.tail!==null&&Vt()>Tc&&(e.flags|=128,r=!0,Tu(i,!1),e.lanes=4194304)}else{if(!r)if(t=hm(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Tu(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!wt)return Sn(e),null}else 2*Vt()-i.renderingStartTime>Tc&&n!==1073741824&&(e.flags|=128,r=!0,Tu(i,!1),e.lanes=4194304);i.isBackwards?(o.sibling=e.child,e.child=o):(n=i.last,n!==null?n.sibling=o:e.child=o,i.last=o)}return i.tail!==null?(e=i.tail,i.rendering=e,i.tail=e.sibling,i.renderingStartTime=Vt(),e.sibling=null,n=bt.current,ot(bt,r?n&1|2:n&1),e):(Sn(e),null);case 22:case 23:return rx(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?lr&1073741824&&(Sn(e),e.subtreeFlags&6&&(e.flags|=8192)):Sn(e),null;case 24:return null;case 25:return null}throw Error(oe(156,e.tag))}function t5(t,e){switch(j_(e),e.tag){case 1:return rr(e.type)&&sm(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return xc(),ht(nr),ht(On),q_(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return W_(e),null;case 13:if(ht(bt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(oe(340));wc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ht(bt),null;case 4:return xc(),null;case 10:return U_(e.type._context),null;case 22:case 23:return rx(),null;case 24:return null;default:return null}}var If=!1,Rn=!1,n5=typeof WeakSet=="function"?WeakSet:Set,pe=null;function Gl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Nt(t,e,r)}else n.current=null}function Mw(t,e,n){try{n()}catch(r){Nt(t,e,r)}}var tS=!1;function r5(t,e){if(gw=em,t=MR(),D_(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,i=r.focusNode;r=r.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,d=null;t:for(;;){for(var f;h!==n||s!==0&&h.nodeType!==3||(a=o+s),h!==i||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(f=h.firstChild)!==null;)d=h,h=f;for(;;){if(h===t)break t;if(d===n&&++c===s&&(a=o),d===i&&++u===r&&(l=o),(f=h.nextSibling)!==null)break;h=d,d=h.parentNode}h=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(yw={focusedElem:t,selectionRange:n},em=!1,pe=e;pe!==null;)if(e=pe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pe=t;else for(;pe!==null;){e=pe;try{var g=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(g!==null){var y=g.memoizedProps,v=g.memoizedState,w=e.stateNode,T=w.getSnapshotBeforeUpdate(e.elementType===e.type?y:Qr(e.type,y),v);w.__reactInternalSnapshotBeforeUpdate=T}break;case 3:var E=e.stateNode.containerInfo;E.nodeType===1?E.textContent="":E.nodeType===9&&E.documentElement&&E.removeChild(E.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(oe(163))}}catch(R){Nt(e,e.return,R)}if(t=e.sibling,t!==null){t.return=e.return,pe=t;break}pe=e.return}return g=tS,tS=!1,g}function ch(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var i=s.destroy;s.destroy=void 0,i!==void 0&&Mw(e,n,i)}s=s.next}while(s!==r)}}function Jg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ow(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function AN(t){var e=t.alternate;e!==null&&(t.alternate=null,AN(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[xs],delete e[$h],delete e[_w],delete e[FV],delete e[BV])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function RN(t){return t.tag===5||t.tag===3||t.tag===4}function nS(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||RN(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Dw(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=rm));else if(r!==4&&(t=t.child,t!==null))for(Dw(t,e,n),t=t.sibling;t!==null;)Dw(t,e,n),t=t.sibling}function Lw(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Lw(t,e,n),t=t.sibling;t!==null;)Lw(t,e,n),t=t.sibling}var pn=null,Jr=!1;function Ni(t,e,n){for(n=n.child;n!==null;)NN(t,e,n),n=n.sibling}function NN(t,e,n){if(Ss&&typeof Ss.onCommitFiberUnmount=="function")try{Ss.onCommitFiberUnmount(zg,n)}catch{}switch(n.tag){case 5:Rn||Gl(n,e);case 6:var r=pn,s=Jr;pn=null,Ni(t,e,n),pn=r,Jr=s,pn!==null&&(Jr?(t=pn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):pn.removeChild(n.stateNode));break;case 18:pn!==null&&(Jr?(t=pn,n=n.stateNode,t.nodeType===8?Ov(t.parentNode,n):t.nodeType===1&&Ov(t,n),Vh(t)):Ov(pn,n.stateNode));break;case 4:r=pn,s=Jr,pn=n.stateNode.containerInfo,Jr=!0,Ni(t,e,n),pn=r,Jr=s;break;case 0:case 11:case 14:case 15:if(!Rn&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var i=s,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Mw(n,e,o),s=s.next}while(s!==r)}Ni(t,e,n);break;case 1:if(!Rn&&(Gl(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Nt(n,e,a)}Ni(t,e,n);break;case 21:Ni(t,e,n);break;case 22:n.mode&1?(Rn=(r=Rn)||n.memoizedState!==null,Ni(t,e,n),Rn=r):Ni(t,e,n);break;default:Ni(t,e,n)}}function rS(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new n5),e.forEach(function(r){var s=d5.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Kr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var i=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:pn=a.stateNode,Jr=!1;break e;case 3:pn=a.stateNode.containerInfo,Jr=!0;break e;case 4:pn=a.stateNode.containerInfo,Jr=!0;break e}a=a.return}if(pn===null)throw Error(oe(160));NN(i,o,s),pn=null,Jr=!1;var l=s.alternate;l!==null&&(l.return=null),s.return=null}catch(c){Nt(s,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)PN(e,t),e=e.sibling}function PN(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Kr(e,t),ps(t),r&4){try{ch(3,t,t.return),Jg(3,t)}catch(y){Nt(t,t.return,y)}try{ch(5,t,t.return)}catch(y){Nt(t,t.return,y)}}break;case 1:Kr(e,t),ps(t),r&512&&n!==null&&Gl(n,n.return);break;case 5:if(Kr(e,t),ps(t),r&512&&n!==null&&Gl(n,n.return),t.flags&32){var s=t.stateNode;try{Oh(s,"")}catch(y){Nt(t,t.return,y)}}if(r&4&&(s=t.stateNode,s!=null)){var i=t.memoizedProps,o=n!==null?n.memoizedProps:i,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&i.type==="radio"&&i.name!=null&&eR(s,i),ow(a,o);var c=ow(a,i);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?iR(s,h):u==="dangerouslySetInnerHTML"?rR(s,h):u==="children"?Oh(s,h):b_(s,u,h,c)}switch(a){case"input":tw(s,i);break;case"textarea":tR(s,i);break;case"select":var d=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var f=i.value;f!=null?Zl(s,!!i.multiple,f,!1):d!==!!i.multiple&&(i.defaultValue!=null?Zl(s,!!i.multiple,i.defaultValue,!0):Zl(s,!!i.multiple,i.multiple?[]:"",!1))}s[$h]=i}catch(y){Nt(t,t.return,y)}}break;case 6:if(Kr(e,t),ps(t),r&4){if(t.stateNode===null)throw Error(oe(162));s=t.stateNode,i=t.memoizedProps;try{s.nodeValue=i}catch(y){Nt(t,t.return,y)}}break;case 3:if(Kr(e,t),ps(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Vh(e.containerInfo)}catch(y){Nt(t,t.return,y)}break;case 4:Kr(e,t),ps(t);break;case 13:Kr(e,t),ps(t),s=t.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(tx=Vt())),r&4&&rS(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Rn=(c=Rn)||u,Kr(e,t),Rn=c):Kr(e,t),ps(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(pe=t,u=t.child;u!==null;){for(h=pe=u;pe!==null;){switch(d=pe,f=d.child,d.tag){case 0:case 11:case 14:case 15:ch(4,d,d.return);break;case 1:Gl(d,d.return);var g=d.stateNode;if(typeof g.componentWillUnmount=="function"){r=d,n=d.return;try{e=r,g.props=e.memoizedProps,g.state=e.memoizedState,g.componentWillUnmount()}catch(y){Nt(r,n,y)}}break;case 5:Gl(d,d.return);break;case 22:if(d.memoizedState!==null){iS(h);continue}}f!==null?(f.return=d,pe=f):iS(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{s=h.stateNode,c?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=sR("display",o))}catch(y){Nt(t,t.return,y)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(y){Nt(t,t.return,y)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Kr(e,t),ps(t),r&4&&rS(t);break;case 21:break;default:Kr(e,t),ps(t)}}function ps(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(RN(n)){var r=n;break e}n=n.return}throw Error(oe(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Oh(s,""),r.flags&=-33);var i=nS(t);Lw(t,i,s);break;case 3:case 4:var o=r.stateNode.containerInfo,a=nS(t);Dw(t,a,o);break;default:throw Error(oe(161))}}catch(l){Nt(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function s5(t,e,n){pe=t,MN(t)}function MN(t,e,n){for(var r=(t.mode&1)!==0;pe!==null;){var s=pe,i=s.child;if(s.tag===22&&r){var o=s.memoizedState!==null||If;if(!o){var a=s.alternate,l=a!==null&&a.memoizedState!==null||Rn;a=If;var c=Rn;if(If=o,(Rn=l)&&!c)for(pe=s;pe!==null;)o=pe,l=o.child,o.tag===22&&o.memoizedState!==null?oS(s):l!==null?(l.return=o,pe=l):oS(s);for(;i!==null;)pe=i,MN(i),i=i.sibling;pe=s,If=a,Rn=c}sS(t)}else s.subtreeFlags&8772&&i!==null?(i.return=s,pe=i):sS(t)}}function sS(t){for(;pe!==null;){var e=pe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Rn||Jg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Rn)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Qr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=e.updateQueue;i!==null&&zE(e,i,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}zE(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&Vh(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(oe(163))}Rn||e.flags&512&&Ow(e)}catch(d){Nt(e,e.return,d)}}if(e===t){pe=null;break}if(n=e.sibling,n!==null){n.return=e.return,pe=n;break}pe=e.return}}function iS(t){for(;pe!==null;){var e=pe;if(e===t){pe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,pe=n;break}pe=e.return}}function oS(t){for(;pe!==null;){var e=pe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Jg(4,e)}catch(l){Nt(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(l){Nt(e,s,l)}}var i=e.return;try{Ow(e)}catch(l){Nt(e,i,l)}break;case 5:var o=e.return;try{Ow(e)}catch(l){Nt(e,o,l)}}}catch(l){Nt(e,e.return,l)}if(e===t){pe=null;break}var a=e.sibling;if(a!==null){a.return=e.return,pe=a;break}pe=e.return}}var i5=Math.ceil,pm=wi.ReactCurrentDispatcher,Z_=wi.ReactCurrentOwner,Dr=wi.ReactCurrentBatchConfig,qe=0,cn=null,$t=null,_n=0,lr=0,Ql=Do(0),Yt=0,Qh=null,ja=0,Xg=0,ex=0,uh=null,Xn=null,tx=0,Tc=1/0,Ks=null,mm=!1,jw=null,ho=null,Af=!1,to=null,gm=0,hh=0,Vw=null,yp=-1,vp=0;function Un(){return qe&6?Vt():yp!==-1?yp:yp=Vt()}function fo(t){return t.mode&1?qe&2&&_n!==0?_n&-_n:zV.transition!==null?(vp===0&&(vp=yR()),vp):(t=Ze,t!==0||(t=window.event,t=t===void 0?16:ER(t.type)),t):1}function is(t,e,n,r){if(50<hh)throw hh=0,Vw=null,Error(oe(185));kd(t,n,r),(!(qe&2)||t!==cn)&&(t===cn&&(!(qe&2)&&(Xg|=n),Yt===4&&qi(t,_n)),sr(t,r),n===1&&qe===0&&!(e.mode&1)&&(Tc=Vt()+500,Kg&&Lo()))}function sr(t,e){var n=t.callbackNode;z3(t,e);var r=Zp(t,t===cn?_n:0);if(r===0)n!==null&&mE(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&mE(n),e===1)t.tag===0?UV(aS.bind(null,t)):$R(aS.bind(null,t)),jV(function(){!(qe&6)&&Lo()}),n=null;else{switch(vR(r)){case 1:n=C_;break;case 4:n=mR;break;case 16:n=Yp;break;case 536870912:n=gR;break;default:n=Yp}n=UN(n,ON.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function ON(t,e){if(yp=-1,vp=0,qe&6)throw Error(oe(327));var n=t.callbackNode;if(sc()&&t.callbackNode!==n)return null;var r=Zp(t,t===cn?_n:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=ym(t,r);else{e=r;var s=qe;qe|=2;var i=LN();(cn!==t||_n!==e)&&(Ks=null,Tc=Vt()+500,xa(t,e));do try{l5();break}catch(a){DN(t,a)}while(!0);B_(),pm.current=i,qe=s,$t!==null?e=0:(cn=null,_n=0,e=Yt)}if(e!==0){if(e===2&&(s=hw(t),s!==0&&(r=s,e=Fw(t,s))),e===1)throw n=Qh,xa(t,0),qi(t,r),sr(t,Vt()),n;if(e===6)qi(t,r);else{if(s=t.current.alternate,!(r&30)&&!o5(s)&&(e=ym(t,r),e===2&&(i=hw(t),i!==0&&(r=i,e=Fw(t,i))),e===1))throw n=Qh,xa(t,0),qi(t,r),sr(t,Vt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(oe(345));case 2:Zo(t,Xn,Ks);break;case 3:if(qi(t,r),(r&130023424)===r&&(e=tx+500-Vt(),10<e)){if(Zp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){Un(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=ww(Zo.bind(null,t,Xn,Ks),e);break}Zo(t,Xn,Ks);break;case 4:if(qi(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var o=31-ss(r);i=1<<o,o=e[o],o>s&&(s=o),r&=~i}if(r=s,r=Vt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*i5(r/1960))-r,10<r){t.timeoutHandle=ww(Zo.bind(null,t,Xn,Ks),r);break}Zo(t,Xn,Ks);break;case 5:Zo(t,Xn,Ks);break;default:throw Error(oe(329))}}}return sr(t,Vt()),t.callbackNode===n?ON.bind(null,t):null}function Fw(t,e){var n=uh;return t.current.memoizedState.isDehydrated&&(xa(t,e).flags|=256),t=ym(t,e),t!==2&&(e=Xn,Xn=n,e!==null&&Bw(e)),t}function Bw(t){Xn===null?Xn=t:Xn.push.apply(Xn,t)}function o5(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],i=s.getSnapshot;s=s.value;try{if(!ls(i(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function qi(t,e){for(e&=~ex,e&=~Xg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ss(e),r=1<<n;t[n]=-1,e&=~r}}function aS(t){if(qe&6)throw Error(oe(327));sc();var e=Zp(t,0);if(!(e&1))return sr(t,Vt()),null;var n=ym(t,e);if(t.tag!==0&&n===2){var r=hw(t);r!==0&&(e=r,n=Fw(t,r))}if(n===1)throw n=Qh,xa(t,0),qi(t,e),sr(t,Vt()),n;if(n===6)throw Error(oe(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Zo(t,Xn,Ks),sr(t,Vt()),null}function nx(t,e){var n=qe;qe|=1;try{return t(e)}finally{qe=n,qe===0&&(Tc=Vt()+500,Kg&&Lo())}}function Va(t){to!==null&&to.tag===0&&!(qe&6)&&sc();var e=qe;qe|=1;var n=Dr.transition,r=Ze;try{if(Dr.transition=null,Ze=1,t)return t()}finally{Ze=r,Dr.transition=n,qe=e,!(qe&6)&&Lo()}}function rx(){lr=Ql.current,ht(Ql)}function xa(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LV(n)),$t!==null)for(n=$t.return;n!==null;){var r=n;switch(j_(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&sm();break;case 3:xc(),ht(nr),ht(On),q_();break;case 5:W_(r);break;case 4:xc();break;case 13:ht(bt);break;case 19:ht(bt);break;case 10:U_(r.type._context);break;case 22:case 23:rx()}n=n.return}if(cn=t,$t=t=po(t.current,null),_n=lr=e,Yt=0,Qh=null,ex=Xg=ja=0,Xn=uh=null,ha!==null){for(e=0;e<ha.length;e++)if(n=ha[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,i=n.pending;if(i!==null){var o=i.next;i.next=s,r.next=o}n.pending=r}ha=null}return t}function DN(t,e){do{var n=$t;try{if(B_(),pp.current=fm,dm){for(var r=Et.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}dm=!1}if(La=0,sn=Xt=Et=null,lh=!1,qh=0,Z_.current=null,n===null||n.return===null){Yt=1,Qh=e,$t=null;break}e:{var i=t,o=n.return,a=n,l=e;if(e=_n,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var d=u.alternate;d?(u.updateQueue=d.updateQueue,u.memoizedState=d.memoizedState,u.lanes=d.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=GE(o);if(f!==null){f.flags&=-257,QE(f,o,a,i,e),f.mode&1&&KE(i,c,e),e=f,l=c;var g=e.updateQueue;if(g===null){var y=new Set;y.add(l),e.updateQueue=y}else g.add(l);break e}else{if(!(e&1)){KE(i,c,e),sx();break e}l=Error(oe(426))}}else if(wt&&a.mode&1){var v=GE(o);if(v!==null){!(v.flags&65536)&&(v.flags|=256),QE(v,o,a,i,e),V_(bc(l,a));break e}}i=l=bc(l,a),Yt!==4&&(Yt=2),uh===null?uh=[i]:uh.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,e&=-e,i.lanes|=e;var w=vN(i,l,e);UE(i,w);break e;case 1:a=l;var T=i.type,E=i.stateNode;if(!(i.flags&128)&&(typeof T.getDerivedStateFromError=="function"||E!==null&&typeof E.componentDidCatch=="function"&&(ho===null||!ho.has(E)))){i.flags|=65536,e&=-e,i.lanes|=e;var R=wN(i,a,e);UE(i,R);break e}}i=i.return}while(i!==null)}VN(n)}catch(P){e=P,$t===n&&n!==null&&($t=n=n.return);continue}break}while(!0)}function LN(){var t=pm.current;return pm.current=fm,t===null?fm:t}function sx(){(Yt===0||Yt===3||Yt===2)&&(Yt=4),cn===null||!(ja&268435455)&&!(Xg&268435455)||qi(cn,_n)}function ym(t,e){var n=qe;qe|=2;var r=LN();(cn!==t||_n!==e)&&(Ks=null,xa(t,e));do try{a5();break}catch(s){DN(t,s)}while(!0);if(B_(),qe=n,pm.current=r,$t!==null)throw Error(oe(261));return cn=null,_n=0,Yt}function a5(){for(;$t!==null;)jN($t)}function l5(){for(;$t!==null&&!M3();)jN($t)}function jN(t){var e=BN(t.alternate,t,lr);t.memoizedProps=t.pendingProps,e===null?VN(t):$t=e,Z_.current=null}function VN(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=t5(n,e),n!==null){n.flags&=32767,$t=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Yt=6,$t=null;return}}else if(n=e5(n,e,lr),n!==null){$t=n;return}if(e=e.sibling,e!==null){$t=e;return}$t=e=t}while(e!==null);Yt===0&&(Yt=5)}function Zo(t,e,n){var r=Ze,s=Dr.transition;try{Dr.transition=null,Ze=1,c5(t,e,n,r)}finally{Dr.transition=s,Ze=r}return null}function c5(t,e,n,r){do sc();while(to!==null);if(qe&6)throw Error(oe(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(oe(177));t.callbackNode=null,t.callbackPriority=0;var i=n.lanes|n.childLanes;if($3(t,i),t===cn&&($t=cn=null,_n=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Af||(Af=!0,UN(Yp,function(){return sc(),null})),i=(n.flags&15990)!==0,n.subtreeFlags&15990||i){i=Dr.transition,Dr.transition=null;var o=Ze;Ze=1;var a=qe;qe|=4,Z_.current=null,r5(t,n),PN(n,t),AV(yw),em=!!gw,yw=gw=null,t.current=n,s5(n),O3(),qe=a,Ze=o,Dr.transition=i}else t.current=n;if(Af&&(Af=!1,to=t,gm=s),i=t.pendingLanes,i===0&&(ho=null),j3(n.stateNode),sr(t,Vt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(mm)throw mm=!1,t=jw,jw=null,t;return gm&1&&t.tag!==0&&sc(),i=t.pendingLanes,i&1?t===Vw?hh++:(hh=0,Vw=t):hh=0,Lo(),null}function sc(){if(to!==null){var t=vR(gm),e=Dr.transition,n=Ze;try{if(Dr.transition=null,Ze=16>t?16:t,to===null)var r=!1;else{if(t=to,to=null,gm=0,qe&6)throw Error(oe(331));var s=qe;for(qe|=4,pe=t.current;pe!==null;){var i=pe,o=i.child;if(pe.flags&16){var a=i.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(pe=c;pe!==null;){var u=pe;switch(u.tag){case 0:case 11:case 15:ch(8,u,i)}var h=u.child;if(h!==null)h.return=u,pe=h;else for(;pe!==null;){u=pe;var d=u.sibling,f=u.return;if(AN(u),u===c){pe=null;break}if(d!==null){d.return=f,pe=d;break}pe=f}}}var g=i.alternate;if(g!==null){var y=g.child;if(y!==null){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(y!==null)}}pe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,pe=o;else e:for(;pe!==null;){if(i=pe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:ch(9,i,i.return)}var w=i.sibling;if(w!==null){w.return=i.return,pe=w;break e}pe=i.return}}var T=t.current;for(pe=T;pe!==null;){o=pe;var E=o.child;if(o.subtreeFlags&2064&&E!==null)E.return=o,pe=E;else e:for(o=T;pe!==null;){if(a=pe,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Jg(9,a)}}catch(P){Nt(a,a.return,P)}if(a===o){pe=null;break e}var R=a.sibling;if(R!==null){R.return=a.return,pe=R;break e}pe=a.return}}if(qe=s,Lo(),Ss&&typeof Ss.onPostCommitFiberRoot=="function")try{Ss.onPostCommitFiberRoot(zg,t)}catch{}r=!0}return r}finally{Ze=n,Dr.transition=e}}return!1}function lS(t,e,n){e=bc(n,e),e=vN(t,e,1),t=uo(t,e,1),e=Un(),t!==null&&(kd(t,1,e),sr(t,e))}function Nt(t,e,n){if(t.tag===3)lS(t,t,n);else for(;e!==null;){if(e.tag===3){lS(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ho===null||!ho.has(r))){t=bc(n,t),t=wN(e,t,1),e=uo(e,t,1),t=Un(),e!==null&&(kd(e,1,t),sr(e,t));break}}e=e.return}}function u5(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Un(),t.pingedLanes|=t.suspendedLanes&n,cn===t&&(_n&n)===n&&(Yt===4||Yt===3&&(_n&130023424)===_n&&500>Vt()-tx?xa(t,0):ex|=n),sr(t,e)}function FN(t,e){e===0&&(t.mode&1?(e=wf,wf<<=1,!(wf&130023424)&&(wf=4194304)):e=1);var n=Un();t=di(t,e),t!==null&&(kd(t,e,n),sr(t,n))}function h5(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),FN(t,n)}function d5(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(oe(314))}r!==null&&r.delete(e),FN(t,n)}var BN;BN=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||nr.current)er=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return er=!1,ZV(t,e,n);er=!!(t.flags&131072)}else er=!1,wt&&e.flags&1048576&&HR(e,am,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;gp(t,e),t=e.pendingProps;var s=vc(e,On.current);rc(e,n),s=G_(null,e,r,t,s,n);var i=Q_();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,rr(r)?(i=!0,im(e)):i=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,$_(e),s.updater=Qg,e.stateNode=s,s._reactInternals=e,kw(e,r,t,n),e=Aw(null,e,r,!0,i,n)):(e.tag=0,wt&&i&&L_(e),Fn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(gp(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=p5(r),t=Qr(r,t),s){case 0:e=Iw(null,e,r,t,n);break e;case 1:e=YE(null,e,r,t,n);break e;case 11:e=JE(null,e,r,t,n);break e;case 14:e=XE(null,e,r,Qr(r.type,t),n);break e}throw Error(oe(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Qr(r,s),Iw(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Qr(r,s),YE(t,e,r,s,n);case 3:e:{if(TN(e),t===null)throw Error(oe(387));r=e.pendingProps,i=e.memoizedState,s=i.element,JR(t,e),um(e,r,null,n);var o=e.memoizedState;if(r=o.element,i.isDehydrated)if(i={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=i,e.memoizedState=i,e.flags&256){s=bc(Error(oe(423)),e),e=ZE(t,e,r,n,s);break e}else if(r!==s){s=bc(Error(oe(424)),e),e=ZE(t,e,r,n,s);break e}else for(fr=co(e.stateNode.containerInfo.firstChild),gr=e,wt=!0,Yr=null,n=GR(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(wc(),r===s){e=fi(t,e,n);break e}Fn(t,e,r,n)}e=e.child}return e;case 5:return XR(e),t===null&&Tw(e),r=e.type,s=e.pendingProps,i=t!==null?t.memoizedProps:null,o=s.children,vw(r,s)?o=null:i!==null&&vw(r,i)&&(e.flags|=32),bN(t,e),Fn(t,e,o,n),e.child;case 6:return t===null&&Tw(e),null;case 13:return EN(t,e,n);case 4:return H_(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=_c(e,null,r,n):Fn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Qr(r,s),JE(t,e,r,s,n);case 7:return Fn(t,e,e.pendingProps,n),e.child;case 8:return Fn(t,e,e.pendingProps.children,n),e.child;case 12:return Fn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,i=e.memoizedProps,o=s.value,ot(lm,r._currentValue),r._currentValue=o,i!==null)if(ls(i.value,o)){if(i.children===s.children&&!nr.current){e=fi(t,e,n);break e}}else for(i=e.child,i!==null&&(i.return=e);i!==null;){var a=i.dependencies;if(a!==null){o=i.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(i.tag===1){l=si(-1,n&-n),l.tag=2;var c=i.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}i.lanes|=n,l=i.alternate,l!==null&&(l.lanes|=n),Ew(i.return,n,e),a.lanes|=n;break}l=l.next}}else if(i.tag===10)o=i.type===e.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(oe(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Ew(o,n,e),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===e){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}Fn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,rc(e,n),s=Fr(s),r=r(s),e.flags|=1,Fn(t,e,r,n),e.child;case 14:return r=e.type,s=Qr(r,e.pendingProps),s=Qr(r.type,s),XE(t,e,r,s,n);case 15:return _N(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Qr(r,s),gp(t,e),e.tag=1,rr(r)?(t=!0,im(e)):t=!1,rc(e,n),yN(e,r,s),kw(e,r,s,n),Aw(null,e,r,!0,t,n);case 19:return SN(t,e,n);case 22:return xN(t,e,n)}throw Error(oe(156,e.tag))};function UN(t,e){return pR(t,e)}function f5(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mr(t,e,n,r){return new f5(t,e,n,r)}function ix(t){return t=t.prototype,!(!t||!t.isReactComponent)}function p5(t){if(typeof t=="function")return ix(t)?1:0;if(t!=null){if(t=t.$$typeof,t===E_)return 11;if(t===S_)return 14}return 2}function po(t,e){var n=t.alternate;return n===null?(n=Mr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function wp(t,e,n,r,s,i){var o=2;if(r=t,typeof t=="function")ix(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Fl:return ba(n.children,s,i,e);case T_:o=8,s|=8;break;case J0:return t=Mr(12,n,e,s|2),t.elementType=J0,t.lanes=i,t;case X0:return t=Mr(13,n,e,s),t.elementType=X0,t.lanes=i,t;case Y0:return t=Mr(19,n,e,s),t.elementType=Y0,t.lanes=i,t;case XA:return Yg(n,s,i,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case QA:o=10;break e;case JA:o=9;break e;case E_:o=11;break e;case S_:o=14;break e;case Bi:o=16,r=null;break e}throw Error(oe(130,t==null?t:typeof t,""))}return e=Mr(o,n,e,s),e.elementType=t,e.type=r,e.lanes=i,e}function ba(t,e,n,r){return t=Mr(7,t,r,e),t.lanes=n,t}function Yg(t,e,n,r){return t=Mr(22,t,r,e),t.elementType=XA,t.lanes=n,t.stateNode={isHidden:!1},t}function zv(t,e,n){return t=Mr(6,t,null,e),t.lanes=n,t}function $v(t,e,n){return e=Mr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function m5(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Tv(0),this.expirationTimes=Tv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Tv(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function ox(t,e,n,r,s,i,o,a,l){return t=new m5(t,e,n,a,l),e===1?(e=1,i===!0&&(e|=8)):e=0,i=Mr(3,null,null,e),t.current=i,i.stateNode=t,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},$_(i),t}function g5(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Vl,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function zN(t){if(!t)return So;t=t._reactInternals;e:{if(ol(t)!==t||t.tag!==1)throw Error(oe(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(rr(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(oe(171))}if(t.tag===1){var n=t.type;if(rr(n))return zR(t,n,e)}return e}function $N(t,e,n,r,s,i,o,a,l){return t=ox(n,r,!0,t,s,i,o,a,l),t.context=zN(null),n=t.current,r=Un(),s=fo(n),i=si(r,s),i.callback=e??null,uo(n,i,s),t.current.lanes=s,kd(t,s,r),sr(t,r),t}function Zg(t,e,n,r){var s=e.current,i=Un(),o=fo(s);return n=zN(n),e.context===null?e.context=n:e.pendingContext=n,e=si(i,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=uo(s,e,o),t!==null&&(is(t,s,o,i),fp(t,s,o)),o}function vm(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function cS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function ax(t,e){cS(t,e),(t=t.alternate)&&cS(t,e)}function y5(){return null}var HN=typeof reportError=="function"?reportError:function(t){console.error(t)};function lx(t){this._internalRoot=t}ey.prototype.render=lx.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(oe(409));Zg(t,e,null,null)};ey.prototype.unmount=lx.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Va(function(){Zg(null,t,null,null)}),e[hi]=null}};function ey(t){this._internalRoot=t}ey.prototype.unstable_scheduleHydration=function(t){if(t){var e=xR();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Wi.length&&e!==0&&e<Wi[n].priority;n++);Wi.splice(n,0,t),n===0&&TR(t)}};function cx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function ty(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function uS(){}function v5(t,e,n,r,s){if(s){if(typeof r=="function"){var i=r;r=function(){var c=vm(o);i.call(c)}}var o=$N(e,r,t,0,null,!1,!1,"",uS);return t._reactRootContainer=o,t[hi]=o.current,Uh(t.nodeType===8?t.parentNode:t),Va(),o}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var c=vm(l);a.call(c)}}var l=ox(t,0,!1,null,null,!1,!1,"",uS);return t._reactRootContainer=l,t[hi]=l.current,Uh(t.nodeType===8?t.parentNode:t),Va(function(){Zg(e,l,n,r)}),l}function ny(t,e,n,r,s){var i=n._reactRootContainer;if(i){var o=i;if(typeof s=="function"){var a=s;s=function(){var l=vm(o);a.call(l)}}Zg(e,o,t,s)}else o=v5(n,e,t,s,r);return vm(o)}wR=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=$u(e.pendingLanes);n!==0&&(I_(e,n|1),sr(e,Vt()),!(qe&6)&&(Tc=Vt()+500,Lo()))}break;case 13:Va(function(){var r=di(t,1);if(r!==null){var s=Un();is(r,t,1,s)}}),ax(t,1)}};A_=function(t){if(t.tag===13){var e=di(t,134217728);if(e!==null){var n=Un();is(e,t,134217728,n)}ax(t,134217728)}};_R=function(t){if(t.tag===13){var e=fo(t),n=di(t,e);if(n!==null){var r=Un();is(n,t,e,r)}ax(t,e)}};xR=function(){return Ze};bR=function(t,e){var n=Ze;try{return Ze=t,e()}finally{Ze=n}};lw=function(t,e,n){switch(e){case"input":if(tw(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=qg(r);if(!s)throw Error(oe(90));ZA(r),tw(r,s)}}}break;case"textarea":tR(t,n);break;case"select":e=n.value,e!=null&&Zl(t,!!n.multiple,e,!1)}};lR=nx;cR=Va;var w5={usingClientEntryPoint:!1,Events:[Id,$l,qg,oR,aR,nx]},Eu={findFiberByHostInstance:ua,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},_5={bundleType:Eu.bundleType,version:Eu.version,rendererPackageName:Eu.rendererPackageName,rendererConfig:Eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:wi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=dR(t),t===null?null:t.stateNode},findFiberByHostInstance:Eu.findFiberByHostInstance||y5,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Rf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Rf.isDisabled&&Rf.supportsFiber)try{zg=Rf.inject(_5),Ss=Rf}catch{}}_r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=w5;_r.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!cx(e))throw Error(oe(200));return g5(t,e,null,n)};_r.createRoot=function(t,e){if(!cx(t))throw Error(oe(299));var n=!1,r="",s=HN;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=ox(t,1,!1,null,null,n,!1,r,s),t[hi]=e.current,Uh(t.nodeType===8?t.parentNode:t),new lx(e)};_r.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(oe(188)):(t=Object.keys(t).join(","),Error(oe(268,t)));return t=dR(e),t=t===null?null:t.stateNode,t};_r.flushSync=function(t){return Va(t)};_r.hydrate=function(t,e,n){if(!ty(e))throw Error(oe(200));return ny(null,t,e,!0,n)};_r.hydrateRoot=function(t,e,n){if(!cx(t))throw Error(oe(405));var r=n!=null&&n.hydratedSources||null,s=!1,i="",o=HN;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=$N(e,null,t,1,n??null,s,!1,i,o),t[hi]=e.current,Uh(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new ey(e)};_r.render=function(t,e,n){if(!ty(e))throw Error(oe(200));return ny(null,t,e,!1,n)};_r.unmountComponentAtNode=function(t){if(!ty(t))throw Error(oe(40));return t._reactRootContainer?(Va(function(){ny(null,null,t,!1,function(){t._reactRootContainer=null,t[hi]=null})}),!0):!1};_r.unstable_batchedUpdates=nx;_r.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!ty(n))throw Error(oe(200));if(t==null||t._reactInternals===void 0)throw Error(oe(38));return ny(t,e,n,!1,r)};_r.version="18.3.1-next-f1338f8080-20240426";function WN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(WN)}catch(t){console.error(t)}}WN(),WA.exports=_r;var qN=WA.exports;const ux=Mo(qN);var hS=qN;G0.createRoot=hS.createRoot,G0.hydrateRoot=hS.hydrateRoot;/**
 * react-router v7.11.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var dS="popstate";function x5(t={}){function e(s,i){let{pathname:o="/",search:a="",hash:l=""}=al(s.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Uw("",{pathname:o,search:a,hash:l},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(s,i){let o=s.document.querySelector("base"),a="";if(o&&o.getAttribute("href")){let l=s.location.href,c=l.indexOf("#");a=c===-1?l:l.slice(0,c)}return a+"#"+(typeof i=="string"?i:Jh(i))}function r(s,i){Ur(s.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(i)})`)}return T5(e,n,r,t)}function St(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Ur(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function b5(){return Math.random().toString(36).substring(2,10)}function fS(t,e){return{usr:t.state,key:t.key,idx:e}}function Uw(t,e,n=null,r){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?al(e):e,state:n,key:e&&e.key||r||b5()}}function Jh({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function al(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substring(r),t=t.substring(0,r)),t&&(e.pathname=t)}return e}function T5(t,e,n,r={}){let{window:s=document.defaultView,v5Compat:i=!1}=r,o=s.history,a="POP",l=null,c=u();c==null&&(c=0,o.replaceState({...o.state,idx:c},""));function u(){return(o.state||{idx:null}).idx}function h(){a="POP";let v=u(),w=v==null?null:v-c;c=v,l&&l({action:a,location:y.location,delta:w})}function d(v,w){a="PUSH";let T=Uw(y.location,v,w);n&&n(T,v),c=u()+1;let E=fS(T,c),R=y.createHref(T);try{o.pushState(E,"",R)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;s.location.assign(R)}i&&l&&l({action:a,location:y.location,delta:1})}function f(v,w){a="REPLACE";let T=Uw(y.location,v,w);n&&n(T,v),c=u();let E=fS(T,c),R=y.createHref(T);o.replaceState(E,"",R),i&&l&&l({action:a,location:y.location,delta:0})}function g(v){return E5(v)}let y={get action(){return a},get location(){return t(s,o)},listen(v){if(l)throw new Error("A history only accepts one active listener");return s.addEventListener(dS,h),l=v,()=>{s.removeEventListener(dS,h),l=null}},createHref(v){return e(s,v)},createURL:g,encodeLocation(v){let w=g(v);return{pathname:w.pathname,search:w.search,hash:w.hash}},push:d,replace:f,go(v){return o.go(v)}};return y}function E5(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),St(n,"No window.location.(origin|href) available to create URL");let r=typeof t=="string"?t:Jh(t);return r=r.replace(/ $/,"%20"),!e&&r.startsWith("//")&&(r=n+r),new URL(r,n)}function KN(t,e,n="/"){return S5(t,e,n,!1)}function S5(t,e,n,r){let s=typeof e=="string"?al(e):e,i=pi(s.pathname||"/",n);if(i==null)return null;let o=GN(t);k5(o);let a=null;for(let l=0;a==null&&l<o.length;++l){let c=j5(i);a=D5(o[l],c,r)}return a}function GN(t,e=[],n=[],r="",s=!1){let i=(o,a,l=s,c)=>{let u={relativePath:c===void 0?o.path||"":c,caseSensitive:o.caseSensitive===!0,childrenIndex:a,route:o};if(u.relativePath.startsWith("/")){if(!u.relativePath.startsWith(r)&&l)return;St(u.relativePath.startsWith(r),`Absolute route path "${u.relativePath}" nested under path "${r}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),u.relativePath=u.relativePath.slice(r.length)}let h=ii([r,u.relativePath]),d=n.concat(u);o.children&&o.children.length>0&&(St(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),GN(o.children,e,d,h,l)),!(o.path==null&&!o.index)&&e.push({path:h,score:M5(h,o.index),routesMeta:d})};return t.forEach((o,a)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,a);else for(let c of QN(o.path))i(o,a,!0,c)}),e}function QN(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),i=n.replace(/\?$/,"");if(r.length===0)return s?[i,""]:[i];let o=QN(r.join("/")),a=[];return a.push(...o.map(l=>l===""?i:[i,l].join("/"))),s&&a.push(...o),a.map(l=>t.startsWith("/")&&l===""?"/":l)}function k5(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:O5(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}var C5=/^:[\w-]+$/,I5=3,A5=2,R5=1,N5=10,P5=-2,pS=t=>t==="*";function M5(t,e){let n=t.split("/"),r=n.length;return n.some(pS)&&(r+=P5),e&&(r+=A5),n.filter(s=>!pS(s)).reduce((s,i)=>s+(C5.test(i)?I5:i===""?R5:N5),r)}function O5(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function D5(t,e,n=!1){let{routesMeta:r}=t,s={},i="/",o=[];for(let a=0;a<r.length;++a){let l=r[a],c=a===r.length-1,u=i==="/"?e:e.slice(i.length)||"/",h=wm({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},u),d=l.route;if(!h&&c&&n&&!r[r.length-1].route.index&&(h=wm({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},u)),!h)return null;Object.assign(s,h.params),o.push({params:s,pathname:ii([i,h.pathname]),pathnameBase:U5(ii([i,h.pathnameBase])),route:d}),h.pathnameBase!=="/"&&(i=ii([i,h.pathnameBase]))}return o}function wm(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=L5(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let i=s[0],o=i.replace(/(.)\/+$/,"$1"),a=s.slice(1);return{params:r.reduce((c,{paramName:u,isOptional:h},d)=>{if(u==="*"){let g=a[d]||"";o=i.slice(0,i.length-g.length).replace(/(.)\/+$/,"$1")}const f=a[d];return h&&!f?c[u]=void 0:c[u]=(f||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:o,pattern:t}}function L5(t,e=!1,n=!0){Ur(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,a,l)=>(r.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function j5(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Ur(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function pi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}var JN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,V5=t=>JN.test(t);function F5(t,e="/"){let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?al(t):t,i;if(n)if(V5(n))i=n;else{if(n.includes("//")){let o=n;n=n.replace(/\/\/+/g,"/"),Ur(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${n}`)}n.startsWith("/")?i=mS(n.substring(1),"/"):i=mS(n,e)}else i=e;return{pathname:i,search:z5(r),hash:$5(s)}}function mS(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function Hv(t,e,n,r){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(r)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function B5(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function XN(t){let e=B5(t);return e.map((n,r)=>r===e.length-1?n.pathname:n.pathnameBase)}function YN(t,e,n,r=!1){let s;typeof t=="string"?s=al(t):(s={...t},St(!s.pathname||!s.pathname.includes("?"),Hv("?","pathname","search",s)),St(!s.pathname||!s.pathname.includes("#"),Hv("#","pathname","hash",s)),St(!s.search||!s.search.includes("#"),Hv("#","search","hash",s)));let i=t===""||s.pathname==="",o=i?"/":s.pathname,a;if(o==null)a=n;else{let h=e.length-1;if(!r&&o.startsWith("..")){let d=o.split("/");for(;d[0]==="..";)d.shift(),h-=1;s.pathname=d.join("/")}a=h>=0?e[h]:"/"}let l=F5(s,a),c=o&&o!=="/"&&o.endsWith("/"),u=(i||o===".")&&n.endsWith("/");return!l.pathname.endsWith("/")&&(c||u)&&(l.pathname+="/"),l}var ii=t=>t.join("/").replace(/\/\/+/g,"/"),U5=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),z5=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,$5=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,H5=class{constructor(t,e,n,r=!1){this.status=t,this.statusText=e||"",this.internal=r,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function W5(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function q5(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var ZN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function e2(t,e){let n=t;if(typeof n!="string"||!JN.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let r=n,s=!1;if(ZN)try{let i=new URL(window.location.href),o=n.startsWith("//")?new URL(i.protocol+n):new URL(n),a=pi(o.pathname,e);o.origin===i.origin&&a!=null?n=a+o.search+o.hash:s=!0}catch{Ur(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:r,isExternal:s,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var t2=["POST","PUT","PATCH","DELETE"];new Set(t2);var K5=["GET",...t2];new Set(K5);var Jc=V.createContext(null);Jc.displayName="DataRouter";var ry=V.createContext(null);ry.displayName="DataRouterState";var G5=V.createContext(!1),n2=V.createContext({isTransitioning:!1});n2.displayName="ViewTransition";var Q5=V.createContext(new Map);Q5.displayName="Fetchers";var J5=V.createContext(null);J5.displayName="Await";var $r=V.createContext(null);$r.displayName="Navigation";var Rd=V.createContext(null);Rd.displayName="Location";var Ls=V.createContext({outlet:null,matches:[],isDataRoute:!1});Ls.displayName="Route";var hx=V.createContext(null);hx.displayName="RouteError";var r2="REACT_ROUTER_ERROR",X5="REDIRECT",Y5="ROUTE_ERROR_RESPONSE";function Z5(t){if(t.startsWith(`${r2}:${X5}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function eF(t){if(t.startsWith(`${r2}:${Y5}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new H5(e.status,e.statusText,e.data)}catch{}}function tF(t,{relative:e}={}){St(Nd(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:r}=V.useContext($r),{hash:s,pathname:i,search:o}=Pd(t,{relative:e}),a=i;return n!=="/"&&(a=i==="/"?n:ii([n,i])),r.createHref({pathname:a,search:o,hash:s})}function Nd(){return V.useContext(Rd)!=null}function _i(){return St(Nd(),"useLocation() may be used only in the context of a <Router> component."),V.useContext(Rd).location}var s2="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function i2(t){V.useContext($r).static||V.useLayoutEffect(t)}function Xc(){let{isDataRoute:t}=V.useContext(Ls);return t?pF():nF()}function nF(){St(Nd(),"useNavigate() may be used only in the context of a <Router> component.");let t=V.useContext(Jc),{basename:e,navigator:n}=V.useContext($r),{matches:r}=V.useContext(Ls),{pathname:s}=_i(),i=JSON.stringify(XN(r)),o=V.useRef(!1);return i2(()=>{o.current=!0}),V.useCallback((l,c={})=>{if(Ur(o.current,s2),!o.current)return;if(typeof l=="number"){n.go(l);return}let u=YN(l,JSON.parse(i),s,c.relative==="path");t==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:ii([e,u.pathname])),(c.replace?n.replace:n.push)(u,c.state,c)},[e,n,i,s,t])}V.createContext(null);function sy(){let{matches:t}=V.useContext(Ls),e=t[t.length-1];return e?e.params:{}}function Pd(t,{relative:e}={}){let{matches:n}=V.useContext(Ls),{pathname:r}=_i(),s=JSON.stringify(XN(n));return V.useMemo(()=>YN(t,JSON.parse(s),r,e==="path"),[t,s,r,e])}function rF(t,e){return o2(t,e)}function o2(t,e,n,r,s){var T;St(Nd(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=V.useContext($r),{matches:o}=V.useContext(Ls),a=o[o.length-1],l=a?a.params:{},c=a?a.pathname:"/",u=a?a.pathnameBase:"/",h=a&&a.route;{let E=h&&h.path||"";l2(c,!h||E.endsWith("*")||E.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${E}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${E}"> to <Route path="${E==="/"?"*":`${E}/*`}">.`)}let d=_i(),f;if(e){let E=typeof e=="string"?al(e):e;St(u==="/"||((T=E.pathname)==null?void 0:T.startsWith(u)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${u}" but pathname "${E.pathname}" was given in the \`location\` prop.`),f=E}else f=d;let g=f.pathname||"/",y=g;if(u!=="/"){let E=u.replace(/^\//,"").split("/");y="/"+g.replace(/^\//,"").split("/").slice(E.length).join("/")}let v=KN(t,{pathname:y});Ur(h||v!=null,`No routes matched location "${f.pathname}${f.search}${f.hash}" `),Ur(v==null||v[v.length-1].route.element!==void 0||v[v.length-1].route.Component!==void 0||v[v.length-1].route.lazy!==void 0,`Matched leaf route at location "${f.pathname}${f.search}${f.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let w=lF(v&&v.map(E=>Object.assign({},E,{params:Object.assign({},l,E.params),pathname:ii([u,i.encodeLocation?i.encodeLocation(E.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathname]),pathnameBase:E.pathnameBase==="/"?u:ii([u,i.encodeLocation?i.encodeLocation(E.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:E.pathnameBase])})),o,n,r,s);return e&&w?V.createElement(Rd.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...f},navigationType:"POP"}},w):w}function sF(){let t=fF(),e=W5(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,r="rgba(200,200,200, 0.5)",s={padding:"0.5rem",backgroundColor:r},i={padding:"2px 4px",backgroundColor:r},o=null;return console.error("Error handled by React Router default ErrorBoundary:",t),o=V.createElement(V.Fragment,null,V.createElement("p",null," Hey developer "),V.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",V.createElement("code",{style:i},"ErrorBoundary")," or"," ",V.createElement("code",{style:i},"errorElement")," prop on your route.")),V.createElement(V.Fragment,null,V.createElement("h2",null,"Unexpected Application Error!"),V.createElement("h3",{style:{fontStyle:"italic"}},e),n?V.createElement("pre",{style:s},n):null,o)}var iF=V.createElement(sF,null),a2=class extends V.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=eF(t.digest);n&&(t=n)}let e=t!==void 0?V.createElement(Ls.Provider,{value:this.props.routeContext},V.createElement(hx.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?V.createElement(oF,{error:t},e):e}};a2.contextType=G5;var Wv=new WeakMap;function oF({children:t,error:e}){let{basename:n}=V.useContext($r);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let r=Z5(e.digest);if(r){let s=Wv.get(e);if(s)throw s;let i=e2(r.location,n);if(ZN&&!Wv.get(e))if(i.isExternal||r.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:r.replace}));throw Wv.set(e,o),o}return V.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return t}function aF({routeContext:t,match:e,children:n}){let r=V.useContext(Jc);return r&&r.static&&r.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=e.route.id),V.createElement(Ls.Provider,{value:t},n)}function lF(t,e=[],n=null,r=null,s=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let i=t,o=n==null?void 0:n.errors;if(o!=null){let u=i.findIndex(h=>h.route.id&&(o==null?void 0:o[h.route.id])!==void 0);St(u>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),i=i.slice(0,Math.min(i.length,u+1))}let a=!1,l=-1;if(n)for(let u=0;u<i.length;u++){let h=i[u];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=u),h.route.id){let{loaderData:d,errors:f}=n,g=h.route.loader&&!d.hasOwnProperty(h.route.id)&&(!f||f[h.route.id]===void 0);if(h.route.lazy||g){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let c=n&&r?(u,h)=>{var d,f;r(u,{location:n.location,params:((f=(d=n.matches)==null?void 0:d[0])==null?void 0:f.params)??{},unstable_pattern:q5(n.matches),errorInfo:h})}:void 0;return i.reduceRight((u,h,d)=>{let f,g=!1,y=null,v=null;n&&(f=o&&h.route.id?o[h.route.id]:void 0,y=h.route.errorElement||iF,a&&(l<0&&d===0?(l2("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,v=null):l===d&&(g=!0,v=h.route.hydrateFallbackElement||null)));let w=e.concat(i.slice(0,d+1)),T=()=>{let E;return f?E=y:g?E=v:h.route.Component?E=V.createElement(h.route.Component,null):h.route.element?E=h.route.element:E=u,V.createElement(aF,{match:h,routeContext:{outlet:u,matches:w,isDataRoute:n!=null},children:E})};return n&&(h.route.ErrorBoundary||h.route.errorElement||d===0)?V.createElement(a2,{location:n.location,revalidation:n.revalidation,component:y,error:f,children:T(),routeContext:{outlet:null,matches:w,isDataRoute:!0},onError:c}):T()},null)}function dx(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function cF(t){let e=V.useContext(Jc);return St(e,dx(t)),e}function uF(t){let e=V.useContext(ry);return St(e,dx(t)),e}function hF(t){let e=V.useContext(Ls);return St(e,dx(t)),e}function fx(t){let e=hF(t),n=e.matches[e.matches.length-1];return St(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function dF(){return fx("useRouteId")}function fF(){var r;let t=V.useContext(hx),e=uF("useRouteError"),n=fx("useRouteError");return t!==void 0?t:(r=e.errors)==null?void 0:r[n]}function pF(){let{router:t}=cF("useNavigate"),e=fx("useNavigate"),n=V.useRef(!1);return i2(()=>{n.current=!0}),V.useCallback(async(s,i={})=>{Ur(n.current,s2),n.current&&(typeof s=="number"?await t.navigate(s):await t.navigate(s,{fromRouteId:e,...i}))},[t,e])}var gS={};function l2(t,e,n){!e&&!gS[t]&&(gS[t]=!0,Ur(!1,n))}V.memo(mF);function mF({routes:t,future:e,state:n,onError:r}){return o2(t,void 0,n,r,e)}function Er(t){St(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function gF({basename:t="/",children:e=null,location:n,navigationType:r="POP",navigator:s,static:i=!1,unstable_useTransitions:o}){St(!Nd(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=t.replace(/^\/*/,"/"),l=V.useMemo(()=>({basename:a,navigator:s,static:i,unstable_useTransitions:o,future:{}}),[a,s,i,o]);typeof n=="string"&&(n=al(n));let{pathname:c="/",search:u="",hash:h="",state:d=null,key:f="default"}=n,g=V.useMemo(()=>{let y=pi(c,a);return y==null?null:{location:{pathname:y,search:u,hash:h,state:d,key:f},navigationType:r}},[a,c,u,h,d,f,r]);return Ur(g!=null,`<Router basename="${a}"> is not able to match the URL "${c}${u}${h}" because it does not start with the basename, so the <Router> won't render anything.`),g==null?null:V.createElement($r.Provider,{value:l},V.createElement(Rd.Provider,{children:e,value:g}))}function yF({children:t,location:e}){return rF(zw(t),e)}function zw(t,e=[]){let n=[];return V.Children.forEach(t,(r,s)=>{if(!V.isValidElement(r))return;let i=[...e,s];if(r.type===V.Fragment){n.push.apply(n,zw(r.props.children,i));return}St(r.type===Er,`[${typeof r.type=="string"?r.type:r.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),St(!r.props.index||!r.props.children,"An index route cannot have child routes.");let o={id:r.props.id||i.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,middleware:r.props.middleware,loader:r.props.loader,action:r.props.action,hydrateFallbackElement:r.props.hydrateFallbackElement,HydrateFallback:r.props.HydrateFallback,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.hasErrorBoundary===!0||r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(o.children=zw(r.props.children,i)),n.push(o)}),n}var _p="get",xp="application/x-www-form-urlencoded";function iy(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function vF(t){return iy(t)&&t.tagName.toLowerCase()==="button"}function wF(t){return iy(t)&&t.tagName.toLowerCase()==="form"}function _F(t){return iy(t)&&t.tagName.toLowerCase()==="input"}function xF(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function bF(t,e){return t.button===0&&(!e||e==="_self")&&!xF(t)}var Nf=null;function TF(){if(Nf===null)try{new FormData(document.createElement("form"),0),Nf=!1}catch{Nf=!0}return Nf}var EF=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function qv(t){return t!=null&&!EF.has(t)?(Ur(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${xp}"`),null):t}function SF(t,e){let n,r,s,i,o;if(wF(t)){let a=t.getAttribute("action");r=a?pi(a,e):null,n=t.getAttribute("method")||_p,s=qv(t.getAttribute("enctype"))||xp,i=new FormData(t)}else if(vF(t)||_F(t)&&(t.type==="submit"||t.type==="image")){let a=t.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=t.getAttribute("formaction")||a.getAttribute("action");if(r=l?pi(l,e):null,n=t.getAttribute("formmethod")||a.getAttribute("method")||_p,s=qv(t.getAttribute("formenctype"))||qv(a.getAttribute("enctype"))||xp,i=new FormData(a,t),!TF()){let{name:c,type:u,value:h}=t;if(u==="image"){let d=c?`${c}.`:"";i.append(`${d}x`,"0"),i.append(`${d}y`,"0")}else c&&i.append(c,h)}}else{if(iy(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=_p,r=null,s=xp,o=t}return i&&s==="text/plain"&&(o=i,i=void 0),{action:r,method:n.toLowerCase(),encType:s,formData:i,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function px(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function kF(t,e,n){let r=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return r.pathname==="/"?r.pathname=`_root.${n}`:e&&pi(r.pathname,e)==="/"?r.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:r.pathname=`${r.pathname.replace(/\/$/,"")}.${n}`,r}async function CF(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function IF(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function AF(t,e,n){let r=await Promise.all(t.map(async s=>{let i=e.routes[s.route.id];if(i){let o=await CF(i,n);return o.links?o.links():[]}return[]}));return MF(r.flat(1).filter(IF).filter(s=>s.rel==="stylesheet"||s.rel==="preload").map(s=>s.rel==="stylesheet"?{...s,rel:"prefetch",as:"style"}:{...s,rel:"prefetch"}))}function yS(t,e,n,r,s,i){let o=(l,c)=>n[c]?l.route.id!==n[c].route.id:!0,a=(l,c)=>{var u;return n[c].pathname!==l.pathname||((u=n[c].route.path)==null?void 0:u.endsWith("*"))&&n[c].params["*"]!==l.params["*"]};return i==="assets"?e.filter((l,c)=>o(l,c)||a(l,c)):i==="data"?e.filter((l,c)=>{var h;let u=r.routes[l.route.id];if(!u||!u.hasLoader)return!1;if(o(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(s.pathname+s.search+s.hash,window.origin),currentParams:((h=n[0])==null?void 0:h.params)||{},nextUrl:new URL(t,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function RF(t,e,{includeHydrateFallback:n}={}){return NF(t.map(r=>{let s=e.routes[r.route.id];if(!s)return[];let i=[s.module];return s.clientActionModule&&(i=i.concat(s.clientActionModule)),s.clientLoaderModule&&(i=i.concat(s.clientLoaderModule)),n&&s.hydrateFallbackModule&&(i=i.concat(s.hydrateFallbackModule)),s.imports&&(i=i.concat(s.imports)),i}).flat(1))}function NF(t){return[...new Set(t)]}function PF(t){let e={},n=Object.keys(t).sort();for(let r of n)e[r]=t[r];return e}function MF(t,e){let n=new Set;return new Set(e),t.reduce((r,s)=>{let i=JSON.stringify(PF(s));return n.has(i)||(n.add(i),r.push({key:i,link:s})),r},[])}function c2(){let t=V.useContext(Jc);return px(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function OF(){let t=V.useContext(ry);return px(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var mx=V.createContext(void 0);mx.displayName="FrameworkContext";function u2(){let t=V.useContext(mx);return px(t,"You must render this element inside a <HydratedRouter> element"),t}function DF(t,e){let n=V.useContext(mx),[r,s]=V.useState(!1),[i,o]=V.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:u,onTouchStart:h}=e,d=V.useRef(null);V.useEffect(()=>{if(t==="render"&&o(!0),t==="viewport"){let y=w=>{w.forEach(T=>{o(T.isIntersecting)})},v=new IntersectionObserver(y,{threshold:.5});return d.current&&v.observe(d.current),()=>{v.disconnect()}}},[t]),V.useEffect(()=>{if(r){let y=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(y)}}},[r]);let f=()=>{s(!0)},g=()=>{s(!1),o(!1)};return n?t!=="intent"?[i,d,{}]:[i,d,{onFocus:Su(a,f),onBlur:Su(l,g),onMouseEnter:Su(c,f),onMouseLeave:Su(u,g),onTouchStart:Su(h,f)}]:[!1,d,{}]}function Su(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function LF({page:t,...e}){let{router:n}=c2(),r=V.useMemo(()=>KN(n.routes,t,n.basename),[n.routes,t,n.basename]);return r?V.createElement(VF,{page:t,matches:r,...e}):null}function jF(t){let{manifest:e,routeModules:n}=u2(),[r,s]=V.useState([]);return V.useEffect(()=>{let i=!1;return AF(t,e,n).then(o=>{i||s(o)}),()=>{i=!0}},[t,e,n]),r}function VF({page:t,matches:e,...n}){let r=_i(),{manifest:s,routeModules:i}=u2(),{basename:o}=c2(),{loaderData:a,matches:l}=OF(),c=V.useMemo(()=>yS(t,e,l,s,r,"data"),[t,e,l,s,r]),u=V.useMemo(()=>yS(t,e,l,s,r,"assets"),[t,e,l,s,r]),h=V.useMemo(()=>{if(t===r.pathname+r.search+r.hash)return[];let g=new Set,y=!1;if(e.forEach(w=>{var E;let T=s.routes[w.route.id];!T||!T.hasLoader||(!c.some(R=>R.route.id===w.route.id)&&w.route.id in a&&((E=i[w.route.id])!=null&&E.shouldRevalidate)||T.hasClientLoader?y=!0:g.add(w.route.id))}),g.size===0)return[];let v=kF(t,o,"data");return y&&g.size>0&&v.searchParams.set("_routes",e.filter(w=>g.has(w.route.id)).map(w=>w.route.id).join(",")),[v.pathname+v.search]},[o,a,r,s,c,e,t,i]),d=V.useMemo(()=>RF(u,s),[u,s]),f=jF(u);return V.createElement(V.Fragment,null,h.map(g=>V.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...n})),d.map(g=>V.createElement("link",{key:g,rel:"modulepreload",href:g,...n})),f.map(({key:g,link:y})=>V.createElement("link",{key:g,nonce:n.nonce,...y})))}function FF(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var BF=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{BF&&(window.__reactRouterVersion="7.11.0")}catch{}function UF({basename:t,children:e,unstable_useTransitions:n,window:r}){let s=V.useRef();s.current==null&&(s.current=x5({window:r,v5Compat:!0}));let i=s.current,[o,a]=V.useState({action:i.action,location:i.location}),l=V.useCallback(c=>{n===!1?a(c):V.startTransition(()=>a(c))},[n]);return V.useLayoutEffect(()=>i.listen(l),[i,l]),V.createElement(gF,{basename:t,children:e,location:o.location,navigationType:o.action,navigator:i,unstable_useTransitions:n})}var h2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Cr=V.forwardRef(function({onClick:e,discover:n="render",prefetch:r="none",relative:s,reloadDocument:i,replace:o,state:a,target:l,to:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:d,...f},g){let{basename:y,unstable_useTransitions:v}=V.useContext($r),w=typeof c=="string"&&h2.test(c),T=e2(c,y);c=T.to;let E=tF(c,{relative:s}),[R,P,N]=DF(r,f),k=WF(c,{replace:o,state:a,target:l,preventScrollReset:u,relative:s,viewTransition:h,unstable_defaultShouldRevalidate:d,unstable_useTransitions:v});function _(S){e&&e(S),S.defaultPrevented||k(S)}let x=V.createElement("a",{...f,...N,href:T.absoluteURL||E,onClick:T.isExternal||i?e:_,ref:FF(g,P),target:l,"data-discover":!w&&n==="render"?"true":void 0});return R&&!w?V.createElement(V.Fragment,null,x,V.createElement(LF,{page:E})):x});Cr.displayName="Link";var zF=V.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:r="",end:s=!1,style:i,to:o,viewTransition:a,children:l,...c},u){let h=Pd(o,{relative:c.relative}),d=_i(),f=V.useContext(ry),{navigator:g,basename:y}=V.useContext($r),v=f!=null&&JF(h)&&a===!0,w=g.encodeLocation?g.encodeLocation(h).pathname:h.pathname,T=d.pathname,E=f&&f.navigation&&f.navigation.location?f.navigation.location.pathname:null;n||(T=T.toLowerCase(),E=E?E.toLowerCase():null,w=w.toLowerCase()),E&&y&&(E=pi(E,y)||E);const R=w!=="/"&&w.endsWith("/")?w.length-1:w.length;let P=T===w||!s&&T.startsWith(w)&&T.charAt(R)==="/",N=E!=null&&(E===w||!s&&E.startsWith(w)&&E.charAt(w.length)==="/"),k={isActive:P,isPending:N,isTransitioning:v},_=P?e:void 0,x;typeof r=="function"?x=r(k):x=[r,P?"active":null,N?"pending":null,v?"transitioning":null].filter(Boolean).join(" ");let S=typeof i=="function"?i(k):i;return V.createElement(Cr,{...c,"aria-current":_,className:x,ref:u,style:S,to:o,viewTransition:a},typeof l=="function"?l(k):l)});zF.displayName="NavLink";var $F=V.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:r,replace:s,state:i,method:o=_p,action:a,onSubmit:l,relative:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:d,...f},g)=>{let{unstable_useTransitions:y}=V.useContext($r),v=GF(),w=QF(a,{relative:c}),T=o.toLowerCase()==="get"?"get":"post",E=typeof a=="string"&&h2.test(a),R=P=>{if(l&&l(P),P.defaultPrevented)return;P.preventDefault();let N=P.nativeEvent.submitter,k=(N==null?void 0:N.getAttribute("formmethod"))||o,_=()=>v(N||P.currentTarget,{fetcherKey:e,method:k,navigate:n,replace:s,state:i,relative:c,preventScrollReset:u,viewTransition:h,unstable_defaultShouldRevalidate:d});y&&n!==!1?V.startTransition(()=>_()):_()};return V.createElement("form",{ref:g,method:T,action:w,onSubmit:r?l:R,...f,"data-discover":!E&&t==="render"?"true":void 0})});$F.displayName="Form";function HF(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function d2(t){let e=V.useContext(Jc);return St(e,HF(t)),e}function WF(t,{target:e,replace:n,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let c=Xc(),u=_i(),h=Pd(t,{relative:i});return V.useCallback(d=>{if(bF(d,e)){d.preventDefault();let f=n!==void 0?n:Jh(u)===Jh(h),g=()=>c(t,{replace:f,state:r,preventScrollReset:s,relative:i,viewTransition:o,unstable_defaultShouldRevalidate:a});l?V.startTransition(()=>g()):g()}},[u,c,h,n,r,e,t,s,i,o,a,l])}var qF=0,KF=()=>`__${String(++qF)}__`;function GF(){let{router:t}=d2("useSubmit"),{basename:e}=V.useContext($r),n=dF(),r=t.fetch,s=t.navigate;return V.useCallback(async(i,o={})=>{let{action:a,method:l,encType:c,formData:u,body:h}=SF(i,e);if(o.navigate===!1){let d=o.fetcherKey||KF();await r(d,n,o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:h,formMethod:o.method||l,formEncType:o.encType||c,flushSync:o.flushSync})}else await s(o.action||a,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:u,body:h,formMethod:o.method||l,formEncType:o.encType||c,replace:o.replace,state:o.state,fromRouteId:n,flushSync:o.flushSync,viewTransition:o.viewTransition})},[r,s,e,n])}function QF(t,{relative:e}={}){let{basename:n}=V.useContext($r),r=V.useContext(Ls);St(r,"useFormAction must be used inside a RouteContext");let[s]=r.matches.slice(-1),i={...Pd(t||".",{relative:e})},o=_i();if(t==null){i.search=o.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(u=>u==="")){a.delete("index"),l.filter(h=>h).forEach(h=>a.append("index",h));let u=a.toString();i.search=u?`?${u}`:""}}return(!t||t===".")&&s.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(i.pathname=i.pathname==="/"?n:ii([n,i.pathname])),Jh(i)}function JF(t,{relative:e}={}){let n=V.useContext(n2);St(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:r}=d2("useViewTransitionState"),s=Pd(t,{relative:e});if(!n.isTransitioning)return!1;let i=pi(n.currentLocation.pathname,r)||n.currentLocation.pathname,o=pi(n.nextLocation.pathname,r)||n.nextLocation.pathname;return wm(s.pathname,o)!=null||wm(s.pathname,i)!=null}var XF=typeof Element<"u",YF=typeof Map=="function",ZF=typeof Set=="function",e6=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function bp(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var n,r,s;if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!bp(t[r],e[r]))return!1;return!0}var i;if(YF&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(i=t.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;for(i=t.entries();!(r=i.next()).done;)if(!bp(r.value[1],e.get(r.value[0])))return!1;return!0}if(ZF&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(i=t.entries();!(r=i.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(e6&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(t[r]!==e[r])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf&&typeof t.valueOf=="function"&&typeof e.valueOf=="function")return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString&&typeof t.toString=="function"&&typeof e.toString=="function")return t.toString()===e.toString();if(s=Object.keys(t),n=s.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,s[r]))return!1;if(XF&&t instanceof Element)return!1;for(r=n;r--!==0;)if(!((s[r]==="_owner"||s[r]==="__v"||s[r]==="__o")&&t.$$typeof)&&!bp(t[s[r]],e[s[r]]))return!1;return!0}return t!==t&&e!==e}var t6=function(e,n){try{return bp(e,n)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}};const f2=Mo(t6);var n6=function(t,e,n,r,s,i,o,a){if(!t){var l;if(e===void 0)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,r,s,i,o,a],u=0;l=new Error(e.replace(/%s/g,function(){return c[u++]})),l.name="Invariant Violation"}throw l.framesToPop=1,l}},r6=n6;const vS=Mo(r6);var s6=function(e,n,r,s){var i=r?r.call(s,e,n):void 0;if(i!==void 0)return!!i;if(e===n)return!0;if(typeof e!="object"||!e||typeof n!="object"||!n)return!1;var o=Object.keys(e),a=Object.keys(n);if(o.length!==a.length)return!1;for(var l=Object.prototype.hasOwnProperty.bind(n),c=0;c<o.length;c++){var u=o[c];if(!l(u))return!1;var h=e[u],d=n[u];if(i=r?r.call(s,h,d,u):void 0,i===!1||i===void 0&&h!==d)return!1}return!0};const i6=Mo(s6);var p2=(t=>(t.BASE="base",t.BODY="body",t.HEAD="head",t.HTML="html",t.LINK="link",t.META="meta",t.NOSCRIPT="noscript",t.SCRIPT="script",t.STYLE="style",t.TITLE="title",t.FRAGMENT="Symbol(react.fragment)",t))(p2||{}),Kv={link:{rel:["amphtml","canonical","alternate"]},script:{type:["application/ld+json"]},meta:{charset:"",name:["generator","robots","description"],property:["og:type","og:title","og:url","og:image","og:image:alt","og:description","twitter:url","twitter:title","twitter:description","twitter:image","twitter:image:alt","twitter:card","twitter:site"]}},wS=Object.values(p2),gx={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},o6=Object.entries(gx).reduce((t,[e,n])=>(t[n]=e,t),{}),es="data-rh",ic={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate",PRIORITIZE_SEO_TAGS:"prioritizeSeoTags"},oc=(t,e)=>{for(let n=t.length-1;n>=0;n-=1){const r=t[n];if(Object.prototype.hasOwnProperty.call(r,e))return r[e]}return null},a6=t=>{let e=oc(t,"title");const n=oc(t,ic.TITLE_TEMPLATE);if(Array.isArray(e)&&(e=e.join("")),n&&e)return n.replace(/%s/g,()=>e);const r=oc(t,ic.DEFAULT_TITLE);return e||r||void 0},l6=t=>oc(t,ic.ON_CHANGE_CLIENT_STATE)||(()=>{}),Gv=(t,e)=>e.filter(n=>typeof n[t]<"u").map(n=>n[t]).reduce((n,r)=>({...n,...r}),{}),c6=(t,e)=>e.filter(n=>typeof n.base<"u").map(n=>n.base).reverse().reduce((n,r)=>{if(!n.length){const s=Object.keys(r);for(let i=0;i<s.length;i+=1){const a=s[i].toLowerCase();if(t.indexOf(a)!==-1&&r[a])return n.concat(r)}}return n},[]),u6=t=>console&&typeof console.warn=="function"&&console.warn(t),ku=(t,e,n)=>{const r={};return n.filter(s=>Array.isArray(s[t])?!0:(typeof s[t]<"u"&&u6(`Helmet: ${t} should be of type "Array". Instead found type "${typeof s[t]}"`),!1)).map(s=>s[t]).reverse().reduce((s,i)=>{const o={};i.filter(l=>{let c;const u=Object.keys(l);for(let d=0;d<u.length;d+=1){const f=u[d],g=f.toLowerCase();e.indexOf(g)!==-1&&!(c==="rel"&&l[c].toLowerCase()==="canonical")&&!(g==="rel"&&l[g].toLowerCase()==="stylesheet")&&(c=g),e.indexOf(f)!==-1&&(f==="innerHTML"||f==="cssText"||f==="itemprop")&&(c=f)}if(!c||!l[c])return!1;const h=l[c].toLowerCase();return r[c]||(r[c]={}),o[c]||(o[c]={}),r[c][h]?!1:(o[c][h]=!0,!0)}).reverse().forEach(l=>s.push(l));const a=Object.keys(o);for(let l=0;l<a.length;l+=1){const c=a[l],u={...r[c],...o[c]};r[c]=u}return s},[]).reverse()},h6=(t,e)=>{if(Array.isArray(t)&&t.length){for(let n=0;n<t.length;n+=1)if(t[n][e])return!0}return!1},d6=t=>({baseTag:c6(["href"],t),bodyAttributes:Gv("bodyAttributes",t),defer:oc(t,ic.DEFER),encode:oc(t,ic.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:Gv("htmlAttributes",t),linkTags:ku("link",["rel","href"],t),metaTags:ku("meta",["name","charset","http-equiv","property","itemprop"],t),noscriptTags:ku("noscript",["innerHTML"],t),onChangeClientState:l6(t),scriptTags:ku("script",["src","innerHTML"],t),styleTags:ku("style",["cssText"],t),title:a6(t),titleAttributes:Gv("titleAttributes",t),prioritizeSeoTags:h6(t,ic.PRIORITIZE_SEO_TAGS)}),m2=t=>Array.isArray(t)?t.join(""):t,f6=(t,e)=>{const n=Object.keys(t);for(let r=0;r<n.length;r+=1)if(e[n[r]]&&e[n[r]].includes(t[n[r]]))return!0;return!1},Qv=(t,e)=>Array.isArray(t)?t.reduce((n,r)=>(f6(r,e)?n.priority.push(r):n.default.push(r),n),{priority:[],default:[]}):{default:t,priority:[]},_S=(t,e)=>({...t,[e]:void 0}),p6=["noscript","script","style"],$w=(t,e=!0)=>e===!1?String(t):String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;"),g2=t=>Object.keys(t).reduce((e,n)=>{const r=typeof t[n]<"u"?`${n}="${t[n]}"`:`${n}`;return e?`${e} ${r}`:r},""),m6=(t,e,n,r)=>{const s=g2(n),i=m2(e);return s?`<${t} ${es}="true" ${s}>${$w(i,r)}</${t}>`:`<${t} ${es}="true">${$w(i,r)}</${t}>`},g6=(t,e,n=!0)=>e.reduce((r,s)=>{const i=s,o=Object.keys(i).filter(c=>!(c==="innerHTML"||c==="cssText")).reduce((c,u)=>{const h=typeof i[u]>"u"?u:`${u}="${$w(i[u],n)}"`;return c?`${c} ${h}`:h},""),a=i.innerHTML||i.cssText||"",l=p6.indexOf(t)===-1;return`${r}<${t} ${es}="true" ${o}${l?"/>":`>${a}</${t}>`}`},""),y2=(t,e={})=>Object.keys(t).reduce((n,r)=>{const s=gx[r];return n[s||r]=t[r],n},e),y6=(t,e,n)=>{const r={key:e,[es]:!0},s=y2(n,r);return[Xe.createElement("title",s,e)]},Tp=(t,e)=>e.map((n,r)=>{const s={key:r,[es]:!0};return Object.keys(n).forEach(i=>{const a=gx[i]||i;if(a==="innerHTML"||a==="cssText"){const l=n.innerHTML||n.cssText;s.dangerouslySetInnerHTML={__html:l}}else s[a]=n[i]}),Xe.createElement(t,s)}),kr=(t,e,n=!0)=>{switch(t){case"title":return{toComponent:()=>y6(t,e.title,e.titleAttributes),toString:()=>m6(t,e.title,e.titleAttributes,n)};case"bodyAttributes":case"htmlAttributes":return{toComponent:()=>y2(e),toString:()=>g2(e)};default:return{toComponent:()=>Tp(t,e),toString:()=>g6(t,e,n)}}},v6=({metaTags:t,linkTags:e,scriptTags:n,encode:r})=>{const s=Qv(t,Kv.meta),i=Qv(e,Kv.link),o=Qv(n,Kv.script);return{priorityMethods:{toComponent:()=>[...Tp("meta",s.priority),...Tp("link",i.priority),...Tp("script",o.priority)],toString:()=>`${kr("meta",s.priority,r)} ${kr("link",i.priority,r)} ${kr("script",o.priority,r)}`},metaTags:s.default,linkTags:i.default,scriptTags:o.default}},w6=t=>{const{baseTag:e,bodyAttributes:n,encode:r=!0,htmlAttributes:s,noscriptTags:i,styleTags:o,title:a="",titleAttributes:l,prioritizeSeoTags:c}=t;let{linkTags:u,metaTags:h,scriptTags:d}=t,f={toComponent:()=>{},toString:()=>""};return c&&({priorityMethods:f,linkTags:u,metaTags:h,scriptTags:d}=v6(t)),{priority:f,base:kr("base",e,r),bodyAttributes:kr("bodyAttributes",n,r),htmlAttributes:kr("htmlAttributes",s,r),link:kr("link",u,r),meta:kr("meta",h,r),noscript:kr("noscript",i,r),script:kr("script",d,r),style:kr("style",o,r),title:kr("title",{title:a,titleAttributes:l},r)}},Hw=w6,Pf=[],v2=!!(typeof window<"u"&&window.document&&window.document.createElement),Ww=class{constructor(t,e){Bs(this,"instances",[]);Bs(this,"canUseDOM",v2);Bs(this,"context");Bs(this,"value",{setHelmet:t=>{this.context.helmet=t},helmetInstances:{get:()=>this.canUseDOM?Pf:this.instances,add:t=>{(this.canUseDOM?Pf:this.instances).push(t)},remove:t=>{const e=(this.canUseDOM?Pf:this.instances).indexOf(t);(this.canUseDOM?Pf:this.instances).splice(e,1)}}});this.context=t,this.canUseDOM=e||!1,e||(t.helmet=Hw({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}}))}},_6={},w2=Xe.createContext(_6),_a,_2=(_a=class extends V.Component{constructor(n){super(n);Bs(this,"helmetData");this.helmetData=new Ww(this.props.context||{},_a.canUseDOM)}render(){return Xe.createElement(w2.Provider,{value:this.helmetData.value},this.props.children)}},Bs(_a,"canUseDOM",v2),_a),vl=(t,e)=>{const n=document.head||document.querySelector("head"),r=n.querySelectorAll(`${t}[${es}]`),s=[].slice.call(r),i=[];let o;return e&&e.length&&e.forEach(a=>{const l=document.createElement(t);for(const c in a)if(Object.prototype.hasOwnProperty.call(a,c))if(c==="innerHTML")l.innerHTML=a.innerHTML;else if(c==="cssText")l.styleSheet?l.styleSheet.cssText=a.cssText:l.appendChild(document.createTextNode(a.cssText));else{const u=c,h=typeof a[u]>"u"?"":a[u];l.setAttribute(c,h)}l.setAttribute(es,"true"),s.some((c,u)=>(o=u,l.isEqualNode(c)))?s.splice(o,1):i.push(l)}),s.forEach(a=>{var l;return(l=a.parentNode)==null?void 0:l.removeChild(a)}),i.forEach(a=>n.appendChild(a)),{oldTags:s,newTags:i}},qw=(t,e)=>{const n=document.getElementsByTagName(t)[0];if(!n)return;const r=n.getAttribute(es),s=r?r.split(","):[],i=[...s],o=Object.keys(e);for(const a of o){const l=e[a]||"";n.getAttribute(a)!==l&&n.setAttribute(a,l),s.indexOf(a)===-1&&s.push(a);const c=i.indexOf(a);c!==-1&&i.splice(c,1)}for(let a=i.length-1;a>=0;a-=1)n.removeAttribute(i[a]);s.length===i.length?n.removeAttribute(es):n.getAttribute(es)!==o.join(",")&&n.setAttribute(es,o.join(","))},x6=(t,e)=>{typeof t<"u"&&document.title!==t&&(document.title=m2(t)),qw("title",e)},xS=(t,e)=>{const{baseTag:n,bodyAttributes:r,htmlAttributes:s,linkTags:i,metaTags:o,noscriptTags:a,onChangeClientState:l,scriptTags:c,styleTags:u,title:h,titleAttributes:d}=t;qw("body",r),qw("html",s),x6(h,d);const f={baseTag:vl("base",n),linkTags:vl("link",i),metaTags:vl("meta",o),noscriptTags:vl("noscript",a),scriptTags:vl("script",c),styleTags:vl("style",u)},g={},y={};Object.keys(f).forEach(v=>{const{newTags:w,oldTags:T}=f[v];w.length&&(g[v]=w),T.length&&(y[v]=f[v].oldTags)}),e&&e(),l(t,g,y)},Cu=null,b6=t=>{Cu&&cancelAnimationFrame(Cu),t.defer?Cu=requestAnimationFrame(()=>{xS(t,()=>{Cu=null})}):(xS(t),Cu=null)},T6=b6,bS=class extends V.Component{constructor(){super(...arguments);Bs(this,"rendered",!1)}shouldComponentUpdate(e){return!i6(e,this.props)}componentDidUpdate(){this.emitChange()}componentWillUnmount(){const{helmetInstances:e}=this.props.context;e.remove(this),this.emitChange()}emitChange(){const{helmetInstances:e,setHelmet:n}=this.props.context;let r=null;const s=d6(e.get().map(i=>{const o={...i.props};return delete o.context,o}));_2.canUseDOM?T6(s):Hw&&(r=Hw(s)),n(r)}init(){if(this.rendered)return;this.rendered=!0;const{helmetInstances:e}=this.props.context;e.add(this),this.emitChange()}render(){return this.init(),null}},K0,E6=(K0=class extends V.Component{shouldComponentUpdate(e){return!f2(_S(this.props,"helmetData"),_S(e,"helmetData"))}mapNestedChildrenToProps(e,n){if(!n)return null;switch(e.type){case"script":case"noscript":return{innerHTML:n};case"style":return{cssText:n};default:throw new Error(`<${e.type} /> elements are self-closing and can not contain children. Refer to our API for more information.`)}}flattenArrayTypeChildren(e,n,r,s){return{...n,[e.type]:[...n[e.type]||[],{...r,...this.mapNestedChildrenToProps(e,s)}]}}mapObjectTypeChildren(e,n,r,s){switch(e.type){case"title":return{...n,[e.type]:s,titleAttributes:{...r}};case"body":return{...n,bodyAttributes:{...r}};case"html":return{...n,htmlAttributes:{...r}};default:return{...n,[e.type]:{...r}}}}mapArrayTypeChildrenToProps(e,n){let r={...n};return Object.keys(e).forEach(s=>{r={...r,[s]:e[s]}}),r}warnOnInvalidChildren(e,n){return vS(wS.some(r=>e.type===r),typeof e.type=="function"?"You may be attempting to nest <Helmet> components within each other, which is not allowed. Refer to our API for more information.":`Only elements types ${wS.join(", ")} are allowed. Helmet does not support rendering <${e.type}> elements. Refer to our API for more information.`),vS(!n||typeof n=="string"||Array.isArray(n)&&!n.some(r=>typeof r!="string"),`Helmet expects a string as a child of <${e.type}>. Did you forget to wrap your children in braces? ( <${e.type}>{\`\`}</${e.type}> ) Refer to our API for more information.`),!0}mapChildrenToProps(e,n){let r={};return Xe.Children.forEach(e,s=>{if(!s||!s.props)return;const{children:i,...o}=s.props,a=Object.keys(o).reduce((c,u)=>(c[o6[u]||u]=o[u],c),{});let{type:l}=s;switch(typeof l=="symbol"?l=l.toString():this.warnOnInvalidChildren(s,i),l){case"Symbol(react.fragment)":n=this.mapChildrenToProps(i,n);break;case"link":case"meta":case"noscript":case"script":case"style":r=this.flattenArrayTypeChildren(s,r,a,i);break;default:n=this.mapObjectTypeChildren(s,n,a,i);break}}),this.mapArrayTypeChildrenToProps(r,n)}render(){const{children:e,...n}=this.props;let r={...n},{helmetData:s}=n;if(e&&(r=this.mapChildrenToProps(e,r)),s&&!(s instanceof Ww)){const i=s;s=new Ww(i.context,!0),delete r.helmetData}return s?Xe.createElement(bS,{...r,context:s.value}):Xe.createElement(w2.Consumer,null,i=>Xe.createElement(bS,{...r,context:i}))}},Bs(K0,"defaultProps",{defer:!0,encodeSpecialCharacters:!0,prioritizeSeoTags:!1}),K0);const S6=()=>{const t=document.createElement("canvas"),e=t.getContext("2d");e.textBaseline="top",e.font="14px Arial",e.fillText("fingerprint",2,2);const n={userAgent:navigator.userAgent,language:navigator.language,platform:navigator.platform,screenResolution:`${screen.width}x${screen.height}`,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,canvasFingerprint:t.toDataURL(),colorDepth:screen.colorDepth,deviceMemory:navigator.deviceMemory||"unknown",hardwareConcurrency:navigator.hardwareConcurrency||"unknown"},r=JSON.stringify(n);let s=0;for(let i=0;i<r.length;i++){const o=r.charCodeAt(i);s=(s<<5)-s+o,s=s&s}return`guest_${Math.abs(s).toString(36)}`},k6=()=>{let t=localStorage.getItem("deskhub_guest_id");return t||(t=S6(),localStorage.setItem("deskhub_guest_id",t)),t},Iu=()=>{const t=JSON.parse(localStorage.getItem("deskhub_current_user")||"null");if(t)return{id:t.id,username:t.username,displayName:t.displayName,avatar:t.avatar,role:t.role,isGuest:!1};const e=k6(),n=localStorage.getItem("deskhub_guest_name")||"Khch",r=localStorage.getItem("deskhub_guest_avatar")||"https://i.pravatar.cc/150?img=0";return{id:e,username:e,displayName:n,avatar:r,role:"guest",isGuest:!0}},C6=(t,e)=>{localStorage.setItem("deskhub_guest_name",t)},I6=()=>{};var TS={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x2=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=s&63|128):(s&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=s&63|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=s&63|128)}return e},A6=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((s&31)<<6|i&63)}else if(s>239&&s<365){const i=t[n++],o=t[n++],a=t[n++],l=((s&7)<<18|(i&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(l>>10)),e[r++]=String.fromCharCode(56320+(l&1023))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((s&15)<<12|(i&63)<<6|o&63)}}return e.join("")},b2={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<t.length;s+=3){const i=t[s],o=s+1<t.length,a=o?t[s+1]:0,l=s+2<t.length,c=l?t[s+2]:0,u=i>>2,h=(i&3)<<4|a>>4;let d=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(d=64)),r.push(n[u],n[h],n[d],n[f])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(x2(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):A6(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<t.length;){const i=n[t.charAt(s++)],a=s<t.length?n[t.charAt(s)]:0;++s;const c=s<t.length?n[t.charAt(s)]:64;++s;const h=s<t.length?n[t.charAt(s)]:64;if(++s,i==null||a==null||c==null||h==null)throw new R6;const d=i<<2|a>>4;if(r.push(d),c!==64){const f=a<<4&240|c>>2;if(r.push(f),h!==64){const g=c<<6&192|h;r.push(g)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class R6 extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const N6=function(t){const e=x2(t);return b2.encodeByteArray(e,!0)},_m=function(t){return N6(t).replace(/\./g,"")},T2=function(t){try{return b2.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E2(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P6=()=>E2().__FIREBASE_DEFAULTS__,M6=()=>{if(typeof process>"u"||typeof TS>"u")return;const t=TS.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},O6=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&T2(t[1]);return e&&JSON.parse(e)},oy=()=>{try{return I6()||P6()||M6()||O6()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},S2=t=>{var e,n;return(n=(e=oy())==null?void 0:e.emulatorHosts)==null?void 0:n[t]},k2=t=>{const e=S2(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},C2=()=>{var t;return(t=oy())==null?void 0:t.config},I2=t=>{var e;return(e=oy())==null?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D6{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jo(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function yx(t){return(await fetch(t,{credentials:"include"})).ok}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",s=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...t};return[_m(JSON.stringify(n)),_m(JSON.stringify(o)),""].join(".")}const dh={};function L6(){const t={prod:[],emulator:[]};for(const e of Object.keys(dh))dh[e]?t.emulator.push(e):t.prod.push(e);return t}function j6(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ES=!1;function vx(t,e){if(typeof window>"u"||typeof document>"u"||!jo(window.location.host)||dh[t]===e||dh[t]||ES)return;dh[t]=e;function n(d){return`__firebase__banner__${d}`}const r="__firebase__banner",i=L6().prod.length>0;function o(){const d=document.getElementById(r);d&&d.remove()}function a(d){d.style.display="flex",d.style.background="#7faaf0",d.style.position="fixed",d.style.bottom="5px",d.style.left="5px",d.style.padding=".5em",d.style.borderRadius="5px",d.style.alignItems="center"}function l(d,f){d.setAttribute("width","24"),d.setAttribute("id",f),d.setAttribute("height","24"),d.setAttribute("viewBox","0 0 24 24"),d.setAttribute("fill","none"),d.style.marginLeft="-6px"}function c(){const d=document.createElement("span");return d.style.cursor="pointer",d.style.marginLeft="16px",d.style.fontSize="24px",d.innerHTML=" &times;",d.onclick=()=>{ES=!0,o()},d}function u(d,f){d.setAttribute("id",f),d.innerText="Learn more",d.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",d.setAttribute("target","__blank"),d.style.paddingLeft="5px",d.style.textDecoration="underline"}function h(){const d=j6(r),f=n("text"),g=document.getElementById(f)||document.createElement("span"),y=n("learnmore"),v=document.getElementById(y)||document.createElement("a"),w=n("preprendIcon"),T=document.getElementById(w)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(d.created){const E=d.element;a(E),u(v,y);const R=c();l(T,w),E.append(T,g,v,R),document.body.appendChild(E)}i?(g.innerText="Preview backend disconnected.",T.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(T.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,g.innerText="Preview backend running in this workspace."),g.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function V6(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Zt())}function R2(){var e;const t=(e=oy())==null?void 0:e.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function F6(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function B6(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function U6(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function z6(){const t=Zt();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function N2(){return!R2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function P2(){return!R2()&&!!navigator.userAgent&&(navigator.userAgent.includes("Safari")||navigator.userAgent.includes("WebKit"))&&!navigator.userAgent.includes("Chrome")}function M2(){try{return typeof indexedDB=="object"}catch{return!1}}function $6(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var i;e(((i=s.error)==null?void 0:i.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H6="FirebaseError";class js extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=H6,Object.setPrototypeOf(this,js.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Md.prototype.create)}}class Md{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},s=`${this.service}/${e}`,i=this.errors[e],o=i?W6(i,r):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new js(s,a,r)}}function W6(t,e){return t.replace(q6,(n,r)=>{const s=e[r];return s!=null?String(s):`<${r}?>`})}const q6=/\{\$([^}]+)}/g;function K6(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Fa(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const i=t[s],o=e[s];if(SS(i)&&SS(o)){if(!Fa(i,o))return!1}else if(i!==o)return!1}for(const s of r)if(!n.includes(s))return!1;return!0}function SS(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Od(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(s=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Wu(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[s,i]=r.split("=");e[decodeURIComponent(s)]=decodeURIComponent(i)}}),e}function qu(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function G6(t,e){const n=new Q6(t,e);return n.subscribe.bind(n)}class Q6{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let s;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");J6(e,["next","error","complete"])?s=e:s={next:e,error:n,complete:r},s.next===void 0&&(s.next=Jv),s.error===void 0&&(s.error=Jv),s.complete===void 0&&(s.complete=Jv);const i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),i}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J6(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Jv(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ct(t){return t&&t._delegate?t._delegate:t}class ko{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ea="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X6{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new D6;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:n});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),r=(e==null?void 0:e.optional)??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Z6(e))try{this.getOrInitializeService({instanceIdentifier:ea})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(n);try{const i=this.getOrInitializeService({instanceIdentifier:s});r.resolve(i)}catch{}}}}clearInstance(e=ea){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ea){return this.instances.has(e)}getOptions(e=ea){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[i,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(i);r===a&&o.resolve(s)}return s}onInit(e,n){const r=this.normalizeInstanceIdentifier(n),s=this.onInitCallbacks.get(r)??new Set;s.add(e),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&e(i,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const s of r)try{s(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Y6(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ea){return this.component?this.component.multipleInstances?e:ea:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Y6(t){return t===ea?void 0:t}function Z6(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eB{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new X6(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var ze;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ze||(ze={}));const tB={debug:ze.DEBUG,verbose:ze.VERBOSE,info:ze.INFO,warn:ze.WARN,error:ze.ERROR,silent:ze.SILENT},nB=ze.INFO,rB={[ze.DEBUG]:"log",[ze.VERBOSE]:"log",[ze.INFO]:"info",[ze.WARN]:"warn",[ze.ERROR]:"error"},sB=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),s=rB[e];if(s)console[s](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class wx{constructor(e){this.name=e,this._logLevel=nB,this._logHandler=sB,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ze))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?tB[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ze.DEBUG,...e),this._logHandler(this,ze.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ze.VERBOSE,...e),this._logHandler(this,ze.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ze.INFO,...e),this._logHandler(this,ze.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ze.WARN,...e),this._logHandler(this,ze.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ze.ERROR,...e),this._logHandler(this,ze.ERROR,...e)}}const iB=(t,e)=>e.some(n=>t instanceof n);let kS,CS;function oB(){return kS||(kS=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function aB(){return CS||(CS=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const O2=new WeakMap,Kw=new WeakMap,D2=new WeakMap,Xv=new WeakMap,_x=new WeakMap;function lB(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",i),t.removeEventListener("error",o)},i=()=>{n(mo(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",i),t.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&O2.set(n,t)}).catch(()=>{}),_x.set(e,t),e}function cB(t){if(Kw.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",o),t.removeEventListener("abort",o)},i=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",i),t.addEventListener("error",o),t.addEventListener("abort",o)});Kw.set(t,e)}let Gw={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Kw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||D2.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return mo(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function uB(t){Gw=t(Gw)}function hB(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(Yv(this),e,...n);return D2.set(r,e.sort?e.sort():[e]),mo(r)}:aB().includes(t)?function(...e){return t.apply(Yv(this),e),mo(O2.get(this))}:function(...e){return mo(t.apply(Yv(this),e))}}function dB(t){return typeof t=="function"?hB(t):(t instanceof IDBTransaction&&cB(t),iB(t,oB())?new Proxy(t,Gw):t)}function mo(t){if(t instanceof IDBRequest)return lB(t);if(Xv.has(t))return Xv.get(t);const e=dB(t);return e!==t&&(Xv.set(t,e),_x.set(e,t)),e}const Yv=t=>_x.get(t);function fB(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=mo(o);return r&&o.addEventListener("upgradeneeded",l=>{r(mo(o.result),l.oldVersion,l.newVersion,mo(o.transaction),l)}),n&&o.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const pB=["get","getKey","getAll","getAllKeys","count"],mB=["put","add","delete","clear"],Zv=new Map;function IS(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Zv.get(e))return Zv.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=mB.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||pB.includes(n)))return;const i=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return Zv.set(e,i),i}uB(t=>({...t,get:(e,n,r)=>IS(e,n)||t.get(e,n,r),has:(e,n)=>!!IS(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gB{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(yB(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function yB(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Qw="@firebase/app",AS="0.14.6";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mi=new wx("@firebase/app"),vB="@firebase/app-compat",wB="@firebase/analytics-compat",_B="@firebase/analytics",xB="@firebase/app-check-compat",bB="@firebase/app-check",TB="@firebase/auth",EB="@firebase/auth-compat",SB="@firebase/database",kB="@firebase/data-connect",CB="@firebase/database-compat",IB="@firebase/functions",AB="@firebase/functions-compat",RB="@firebase/installations",NB="@firebase/installations-compat",PB="@firebase/messaging",MB="@firebase/messaging-compat",OB="@firebase/performance",DB="@firebase/performance-compat",LB="@firebase/remote-config",jB="@firebase/remote-config-compat",VB="@firebase/storage",FB="@firebase/storage-compat",BB="@firebase/firestore",UB="@firebase/ai",zB="@firebase/firestore-compat",$B="firebase",HB="12.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw="[DEFAULT]",WB={[Qw]:"fire-core",[vB]:"fire-core-compat",[_B]:"fire-analytics",[wB]:"fire-analytics-compat",[bB]:"fire-app-check",[xB]:"fire-app-check-compat",[TB]:"fire-auth",[EB]:"fire-auth-compat",[SB]:"fire-rtdb",[kB]:"fire-data-connect",[CB]:"fire-rtdb-compat",[IB]:"fire-fn",[AB]:"fire-fn-compat",[RB]:"fire-iid",[NB]:"fire-iid-compat",[PB]:"fire-fcm",[MB]:"fire-fcm-compat",[OB]:"fire-perf",[DB]:"fire-perf-compat",[LB]:"fire-rc",[jB]:"fire-rc-compat",[VB]:"fire-gcs",[FB]:"fire-gcs-compat",[BB]:"fire-fst",[zB]:"fire-fst-compat",[UB]:"fire-vertex","fire-js":"fire-js",[$B]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm=new Map,qB=new Map,Xw=new Map;function RS(t,e){try{t.container.addComponent(e)}catch(n){mi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Ba(t){const e=t.name;if(Xw.has(e))return mi.debug(`There were multiple attempts to register component ${e}.`),!1;Xw.set(e,t);for(const n of xm.values())RS(n,t);for(const n of qB.values())RS(n,t);return!0}function ay(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ur(t){return t==null?!1:t.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KB={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},go=new Md("app","Firebase",KB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GB{constructor(e,n,r){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ko("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw go.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ll=HB;function L2(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r={name:Jw,automaticDataCollectionEnabled:!0,...e},s=r.name;if(typeof s!="string"||!s)throw go.create("bad-app-name",{appName:String(s)});if(n||(n=C2()),!n)throw go.create("no-options");const i=xm.get(s);if(i){if(Fa(n,i.options)&&Fa(r,i.config))return i;throw go.create("duplicate-app",{appName:s})}const o=new eB(s);for(const l of Xw.values())o.addComponent(l);const a=new GB(n,r,o);return xm.set(s,a),a}function xx(t=Jw){const e=xm.get(t);if(!e&&t===Jw&&C2())return L2();if(!e)throw go.create("no-app",{appName:t});return e}function Cs(t,e,n){let r=WB[t]??t;n&&(r+=`-${n}`);const s=r.match(/\s|\//),i=e.match(/\s|\//);if(s||i){const o=[`Unable to register library "${r}" with version "${e}":`];s&&o.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&i&&o.push("and"),i&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),mi.warn(o.join(" "));return}Ba(new ko(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QB="firebase-heartbeat-database",JB=1,Xh="firebase-heartbeat-store";let e0=null;function j2(){return e0||(e0=fB(QB,JB,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(Xh)}catch(n){console.warn(n)}}}}).catch(t=>{throw go.create("idb-open",{originalErrorMessage:t.message})})),e0}async function XB(t){try{const n=(await j2()).transaction(Xh),r=await n.objectStore(Xh).get(V2(t));return await n.done,r}catch(e){if(e instanceof js)mi.warn(e.message);else{const n=go.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});mi.warn(n.message)}}}async function NS(t,e){try{const r=(await j2()).transaction(Xh,"readwrite");await r.objectStore(Xh).put(e,V2(t)),await r.done}catch(n){if(n instanceof js)mi.warn(n.message);else{const r=go.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});mi.warn(r.message)}}}function V2(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YB=1024,ZB=30;class eU{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new nU(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=PS();if(((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)==null?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(o=>o.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:s}),this._heartbeatsCache.heartbeats.length>ZB){const o=rU(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){mi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)==null?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=PS(),{heartbeatsToSend:r,unsentEntries:s}=tU(this._heartbeatsCache.heartbeats),i=_m(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(n){return mi.warn(n),""}}}function PS(){return new Date().toISOString().substring(0,10)}function tU(t,e=YB){const n=[];let r=t.slice();for(const s of t){const i=n.find(o=>o.agent===s.agent);if(i){if(i.dates.push(s.date),MS(n)>e){i.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),MS(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class nU{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return M2()?$6().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await XB(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return NS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const r=await this.read();return NS(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return}}function MS(t){return _m(JSON.stringify({version:2,heartbeats:t})).length}function rU(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sU(t){Ba(new ko("platform-logger",e=>new gB(e),"PRIVATE")),Ba(new ko("heartbeat",e=>new eU(e),"PRIVATE")),Cs(Qw,AS,t),Cs(Qw,AS,"esm2020"),Cs("fire-js","")}sU("");var OS=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var yo,F2;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,_){function x(){}x.prototype=_.prototype,k.F=_.prototype,k.prototype=new x,k.prototype.constructor=k,k.D=function(S,A,M){for(var I=Array(arguments.length-2),j=2;j<arguments.length;j++)I[j-2]=arguments[j];return _.prototype[A].apply(S,I)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(r,n),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(k,_,x){x||(x=0);const S=Array(16);if(typeof _=="string")for(var A=0;A<16;++A)S[A]=_.charCodeAt(x++)|_.charCodeAt(x++)<<8|_.charCodeAt(x++)<<16|_.charCodeAt(x++)<<24;else for(A=0;A<16;++A)S[A]=_[x++]|_[x++]<<8|_[x++]<<16|_[x++]<<24;_=k.g[0],x=k.g[1],A=k.g[2];let M=k.g[3],I;I=_+(M^x&(A^M))+S[0]+3614090360&4294967295,_=x+(I<<7&4294967295|I>>>25),I=M+(A^_&(x^A))+S[1]+3905402710&4294967295,M=_+(I<<12&4294967295|I>>>20),I=A+(x^M&(_^x))+S[2]+606105819&4294967295,A=M+(I<<17&4294967295|I>>>15),I=x+(_^A&(M^_))+S[3]+3250441966&4294967295,x=A+(I<<22&4294967295|I>>>10),I=_+(M^x&(A^M))+S[4]+4118548399&4294967295,_=x+(I<<7&4294967295|I>>>25),I=M+(A^_&(x^A))+S[5]+1200080426&4294967295,M=_+(I<<12&4294967295|I>>>20),I=A+(x^M&(_^x))+S[6]+2821735955&4294967295,A=M+(I<<17&4294967295|I>>>15),I=x+(_^A&(M^_))+S[7]+4249261313&4294967295,x=A+(I<<22&4294967295|I>>>10),I=_+(M^x&(A^M))+S[8]+1770035416&4294967295,_=x+(I<<7&4294967295|I>>>25),I=M+(A^_&(x^A))+S[9]+2336552879&4294967295,M=_+(I<<12&4294967295|I>>>20),I=A+(x^M&(_^x))+S[10]+4294925233&4294967295,A=M+(I<<17&4294967295|I>>>15),I=x+(_^A&(M^_))+S[11]+2304563134&4294967295,x=A+(I<<22&4294967295|I>>>10),I=_+(M^x&(A^M))+S[12]+1804603682&4294967295,_=x+(I<<7&4294967295|I>>>25),I=M+(A^_&(x^A))+S[13]+4254626195&4294967295,M=_+(I<<12&4294967295|I>>>20),I=A+(x^M&(_^x))+S[14]+2792965006&4294967295,A=M+(I<<17&4294967295|I>>>15),I=x+(_^A&(M^_))+S[15]+1236535329&4294967295,x=A+(I<<22&4294967295|I>>>10),I=_+(A^M&(x^A))+S[1]+4129170786&4294967295,_=x+(I<<5&4294967295|I>>>27),I=M+(x^A&(_^x))+S[6]+3225465664&4294967295,M=_+(I<<9&4294967295|I>>>23),I=A+(_^x&(M^_))+S[11]+643717713&4294967295,A=M+(I<<14&4294967295|I>>>18),I=x+(M^_&(A^M))+S[0]+3921069994&4294967295,x=A+(I<<20&4294967295|I>>>12),I=_+(A^M&(x^A))+S[5]+3593408605&4294967295,_=x+(I<<5&4294967295|I>>>27),I=M+(x^A&(_^x))+S[10]+38016083&4294967295,M=_+(I<<9&4294967295|I>>>23),I=A+(_^x&(M^_))+S[15]+3634488961&4294967295,A=M+(I<<14&4294967295|I>>>18),I=x+(M^_&(A^M))+S[4]+3889429448&4294967295,x=A+(I<<20&4294967295|I>>>12),I=_+(A^M&(x^A))+S[9]+568446438&4294967295,_=x+(I<<5&4294967295|I>>>27),I=M+(x^A&(_^x))+S[14]+3275163606&4294967295,M=_+(I<<9&4294967295|I>>>23),I=A+(_^x&(M^_))+S[3]+4107603335&4294967295,A=M+(I<<14&4294967295|I>>>18),I=x+(M^_&(A^M))+S[8]+1163531501&4294967295,x=A+(I<<20&4294967295|I>>>12),I=_+(A^M&(x^A))+S[13]+2850285829&4294967295,_=x+(I<<5&4294967295|I>>>27),I=M+(x^A&(_^x))+S[2]+4243563512&4294967295,M=_+(I<<9&4294967295|I>>>23),I=A+(_^x&(M^_))+S[7]+1735328473&4294967295,A=M+(I<<14&4294967295|I>>>18),I=x+(M^_&(A^M))+S[12]+2368359562&4294967295,x=A+(I<<20&4294967295|I>>>12),I=_+(x^A^M)+S[5]+4294588738&4294967295,_=x+(I<<4&4294967295|I>>>28),I=M+(_^x^A)+S[8]+2272392833&4294967295,M=_+(I<<11&4294967295|I>>>21),I=A+(M^_^x)+S[11]+1839030562&4294967295,A=M+(I<<16&4294967295|I>>>16),I=x+(A^M^_)+S[14]+4259657740&4294967295,x=A+(I<<23&4294967295|I>>>9),I=_+(x^A^M)+S[1]+2763975236&4294967295,_=x+(I<<4&4294967295|I>>>28),I=M+(_^x^A)+S[4]+1272893353&4294967295,M=_+(I<<11&4294967295|I>>>21),I=A+(M^_^x)+S[7]+4139469664&4294967295,A=M+(I<<16&4294967295|I>>>16),I=x+(A^M^_)+S[10]+3200236656&4294967295,x=A+(I<<23&4294967295|I>>>9),I=_+(x^A^M)+S[13]+681279174&4294967295,_=x+(I<<4&4294967295|I>>>28),I=M+(_^x^A)+S[0]+3936430074&4294967295,M=_+(I<<11&4294967295|I>>>21),I=A+(M^_^x)+S[3]+3572445317&4294967295,A=M+(I<<16&4294967295|I>>>16),I=x+(A^M^_)+S[6]+76029189&4294967295,x=A+(I<<23&4294967295|I>>>9),I=_+(x^A^M)+S[9]+3654602809&4294967295,_=x+(I<<4&4294967295|I>>>28),I=M+(_^x^A)+S[12]+3873151461&4294967295,M=_+(I<<11&4294967295|I>>>21),I=A+(M^_^x)+S[15]+530742520&4294967295,A=M+(I<<16&4294967295|I>>>16),I=x+(A^M^_)+S[2]+3299628645&4294967295,x=A+(I<<23&4294967295|I>>>9),I=_+(A^(x|~M))+S[0]+4096336452&4294967295,_=x+(I<<6&4294967295|I>>>26),I=M+(x^(_|~A))+S[7]+1126891415&4294967295,M=_+(I<<10&4294967295|I>>>22),I=A+(_^(M|~x))+S[14]+2878612391&4294967295,A=M+(I<<15&4294967295|I>>>17),I=x+(M^(A|~_))+S[5]+4237533241&4294967295,x=A+(I<<21&4294967295|I>>>11),I=_+(A^(x|~M))+S[12]+1700485571&4294967295,_=x+(I<<6&4294967295|I>>>26),I=M+(x^(_|~A))+S[3]+2399980690&4294967295,M=_+(I<<10&4294967295|I>>>22),I=A+(_^(M|~x))+S[10]+4293915773&4294967295,A=M+(I<<15&4294967295|I>>>17),I=x+(M^(A|~_))+S[1]+2240044497&4294967295,x=A+(I<<21&4294967295|I>>>11),I=_+(A^(x|~M))+S[8]+1873313359&4294967295,_=x+(I<<6&4294967295|I>>>26),I=M+(x^(_|~A))+S[15]+4264355552&4294967295,M=_+(I<<10&4294967295|I>>>22),I=A+(_^(M|~x))+S[6]+2734768916&4294967295,A=M+(I<<15&4294967295|I>>>17),I=x+(M^(A|~_))+S[13]+1309151649&4294967295,x=A+(I<<21&4294967295|I>>>11),I=_+(A^(x|~M))+S[4]+4149444226&4294967295,_=x+(I<<6&4294967295|I>>>26),I=M+(x^(_|~A))+S[11]+3174756917&4294967295,M=_+(I<<10&4294967295|I>>>22),I=A+(_^(M|~x))+S[2]+718787259&4294967295,A=M+(I<<15&4294967295|I>>>17),I=x+(M^(A|~_))+S[9]+3951481745&4294967295,k.g[0]=k.g[0]+_&4294967295,k.g[1]=k.g[1]+(A+(I<<21&4294967295|I>>>11))&4294967295,k.g[2]=k.g[2]+A&4294967295,k.g[3]=k.g[3]+M&4294967295}r.prototype.v=function(k,_){_===void 0&&(_=k.length);const x=_-this.blockSize,S=this.C;let A=this.h,M=0;for(;M<_;){if(A==0)for(;M<=x;)s(this,k,M),M+=this.blockSize;if(typeof k=="string"){for(;M<_;)if(S[A++]=k.charCodeAt(M++),A==this.blockSize){s(this,S),A=0;break}}else for(;M<_;)if(S[A++]=k[M++],A==this.blockSize){s(this,S),A=0;break}}this.h=A,this.o+=_},r.prototype.A=function(){var k=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);k[0]=128;for(var _=1;_<k.length-8;++_)k[_]=0;_=this.o*8;for(var x=k.length-8;x<k.length;++x)k[x]=_&255,_/=256;for(this.v(k),k=Array(16),_=0,x=0;x<4;++x)for(let S=0;S<32;S+=8)k[_++]=this.g[x]>>>S&255;return k};function i(k,_){var x=a;return Object.prototype.hasOwnProperty.call(x,k)?x[k]:x[k]=_(k)}function o(k,_){this.h=_;const x=[];let S=!0;for(let A=k.length-1;A>=0;A--){const M=k[A]|0;S&&M==_||(x[A]=M,S=!1)}this.g=x}var a={};function l(k){return-128<=k&&k<128?i(k,function(_){return new o([_|0],_<0?-1:0)}):new o([k|0],k<0?-1:0)}function c(k){if(isNaN(k)||!isFinite(k))return h;if(k<0)return v(c(-k));const _=[];let x=1;for(let S=0;k>=x;S++)_[S]=k/x|0,x*=4294967296;return new o(_,0)}function u(k,_){if(k.length==0)throw Error("number format error: empty string");if(_=_||10,_<2||36<_)throw Error("radix out of range: "+_);if(k.charAt(0)=="-")return v(u(k.substring(1),_));if(k.indexOf("-")>=0)throw Error('number format error: interior "-" character');const x=c(Math.pow(_,8));let S=h;for(let M=0;M<k.length;M+=8){var A=Math.min(8,k.length-M);const I=parseInt(k.substring(M,M+A),_);A<8?(A=c(Math.pow(_,A)),S=S.j(A).add(c(I))):(S=S.j(x),S=S.add(c(I)))}return S}var h=l(0),d=l(1),f=l(16777216);t=o.prototype,t.m=function(){if(y(this))return-v(this).m();let k=0,_=1;for(let x=0;x<this.g.length;x++){const S=this.i(x);k+=(S>=0?S:4294967296+S)*_,_*=4294967296}return k},t.toString=function(k){if(k=k||10,k<2||36<k)throw Error("radix out of range: "+k);if(g(this))return"0";if(y(this))return"-"+v(this).toString(k);const _=c(Math.pow(k,6));var x=this;let S="";for(;;){const A=R(x,_).g;x=w(x,A.j(_));let M=((x.g.length>0?x.g[0]:x.h)>>>0).toString(k);if(x=A,g(x))return M+S;for(;M.length<6;)M="0"+M;S=M+S}},t.i=function(k){return k<0?0:k<this.g.length?this.g[k]:this.h};function g(k){if(k.h!=0)return!1;for(let _=0;_<k.g.length;_++)if(k.g[_]!=0)return!1;return!0}function y(k){return k.h==-1}t.l=function(k){return k=w(this,k),y(k)?-1:g(k)?0:1};function v(k){const _=k.g.length,x=[];for(let S=0;S<_;S++)x[S]=~k.g[S];return new o(x,~k.h).add(d)}t.abs=function(){return y(this)?v(this):this},t.add=function(k){const _=Math.max(this.g.length,k.g.length),x=[];let S=0;for(let A=0;A<=_;A++){let M=S+(this.i(A)&65535)+(k.i(A)&65535),I=(M>>>16)+(this.i(A)>>>16)+(k.i(A)>>>16);S=I>>>16,M&=65535,I&=65535,x[A]=I<<16|M}return new o(x,x[x.length-1]&-2147483648?-1:0)};function w(k,_){return k.add(v(_))}t.j=function(k){if(g(this)||g(k))return h;if(y(this))return y(k)?v(this).j(v(k)):v(v(this).j(k));if(y(k))return v(this.j(v(k)));if(this.l(f)<0&&k.l(f)<0)return c(this.m()*k.m());const _=this.g.length+k.g.length,x=[];for(var S=0;S<2*_;S++)x[S]=0;for(S=0;S<this.g.length;S++)for(let A=0;A<k.g.length;A++){const M=this.i(S)>>>16,I=this.i(S)&65535,j=k.i(A)>>>16,B=k.i(A)&65535;x[2*S+2*A]+=I*B,T(x,2*S+2*A),x[2*S+2*A+1]+=M*B,T(x,2*S+2*A+1),x[2*S+2*A+1]+=I*j,T(x,2*S+2*A+1),x[2*S+2*A+2]+=M*j,T(x,2*S+2*A+2)}for(k=0;k<_;k++)x[k]=x[2*k+1]<<16|x[2*k];for(k=_;k<2*_;k++)x[k]=0;return new o(x,0)};function T(k,_){for(;(k[_]&65535)!=k[_];)k[_+1]+=k[_]>>>16,k[_]&=65535,_++}function E(k,_){this.g=k,this.h=_}function R(k,_){if(g(_))throw Error("division by zero");if(g(k))return new E(h,h);if(y(k))return _=R(v(k),_),new E(v(_.g),v(_.h));if(y(_))return _=R(k,v(_)),new E(v(_.g),_.h);if(k.g.length>30){if(y(k)||y(_))throw Error("slowDivide_ only works with positive integers.");for(var x=d,S=_;S.l(k)<=0;)x=P(x),S=P(S);var A=N(x,1),M=N(S,1);for(S=N(S,2),x=N(x,2);!g(S);){var I=M.add(S);I.l(k)<=0&&(A=A.add(x),M=I),S=N(S,1),x=N(x,1)}return _=w(k,A.j(_)),new E(A,_)}for(A=h;k.l(_)>=0;){for(x=Math.max(1,Math.floor(k.m()/_.m())),S=Math.ceil(Math.log(x)/Math.LN2),S=S<=48?1:Math.pow(2,S-48),M=c(x),I=M.j(_);y(I)||I.l(k)>0;)x-=S,M=c(x),I=M.j(_);g(M)&&(M=d),A=A.add(M),k=w(k,I)}return new E(A,k)}t.B=function(k){return R(this,k).h},t.and=function(k){const _=Math.max(this.g.length,k.g.length),x=[];for(let S=0;S<_;S++)x[S]=this.i(S)&k.i(S);return new o(x,this.h&k.h)},t.or=function(k){const _=Math.max(this.g.length,k.g.length),x=[];for(let S=0;S<_;S++)x[S]=this.i(S)|k.i(S);return new o(x,this.h|k.h)},t.xor=function(k){const _=Math.max(this.g.length,k.g.length),x=[];for(let S=0;S<_;S++)x[S]=this.i(S)^k.i(S);return new o(x,this.h^k.h)};function P(k){const _=k.g.length+1,x=[];for(let S=0;S<_;S++)x[S]=k.i(S)<<1|k.i(S-1)>>>31;return new o(x,k.h)}function N(k,_){const x=_>>5;_%=32;const S=k.g.length-x,A=[];for(let M=0;M<S;M++)A[M]=_>0?k.i(M+x)>>>_|k.i(M+x+1)<<32-_:k.i(M+x);return new o(A,k.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,F2=r,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=c,o.fromString=u,yo=o}).apply(typeof OS<"u"?OS:typeof self<"u"?self:typeof window<"u"?window:{});var Mf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var B2,Ku,U2,Ep,Yw,z2,$2,H2;(function(){var t,e=Object.defineProperty;function n(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof Mf=="object"&&Mf];for(var b=0;b<m.length;++b){var C=m[b];if(C&&C.Math==Math)return C}throw Error("Cannot find global object")}var r=n(this);function s(m,b){if(b)e:{var C=r;m=m.split(".");for(var D=0;D<m.length-1;D++){var K=m[D];if(!(K in C))break e;C=C[K]}m=m[m.length-1],D=C[m],b=b(D),b!=D&&b!=null&&e(C,m,{configurable:!0,writable:!0,value:b})}}s("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(m){return m||function(b){var C=[],D;for(D in b)Object.prototype.hasOwnProperty.call(b,D)&&C.push([D,b[D]]);return C}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var i=i||{},o=this||self;function a(m){var b=typeof m;return b=="object"&&m!=null||b=="function"}function l(m,b,C){return m.call.apply(m.bind,arguments)}function c(m,b,C){return c=l,c.apply(null,arguments)}function u(m,b){var C=Array.prototype.slice.call(arguments,1);return function(){var D=C.slice();return D.push.apply(D,arguments),m.apply(this,D)}}function h(m,b){function C(){}C.prototype=b.prototype,m.Z=b.prototype,m.prototype=new C,m.prototype.constructor=m,m.Ob=function(D,K,Q){for(var le=Array(arguments.length-2),De=2;De<arguments.length;De++)le[De-2]=arguments[De];return b.prototype[K].apply(D,le)}}var d=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function f(m){const b=m.length;if(b>0){const C=Array(b);for(let D=0;D<b;D++)C[D]=m[D];return C}return[]}function g(m,b){for(let D=1;D<arguments.length;D++){const K=arguments[D];var C=typeof K;if(C=C!="object"?C:K?Array.isArray(K)?"array":C:"null",C=="array"||C=="object"&&typeof K.length=="number"){C=m.length||0;const Q=K.length||0;m.length=C+Q;for(let le=0;le<Q;le++)m[C+le]=K[le]}else m.push(K)}}class y{constructor(b,C){this.i=b,this.j=C,this.h=0,this.g=null}get(){let b;return this.h>0?(this.h--,b=this.g,this.g=b.next,b.next=null):b=this.i(),b}}function v(m){o.setTimeout(()=>{throw m},0)}function w(){var m=k;let b=null;return m.g&&(b=m.g,m.g=m.g.next,m.g||(m.h=null),b.next=null),b}class T{constructor(){this.h=this.g=null}add(b,C){const D=E.get();D.set(b,C),this.h?this.h.next=D:this.g=D,this.h=D}}var E=new y(()=>new R,m=>m.reset());class R{constructor(){this.next=this.g=this.h=null}set(b,C){this.h=b,this.g=C,this.next=null}reset(){this.next=this.g=this.h=null}}let P,N=!1,k=new T,_=()=>{const m=Promise.resolve(void 0);P=()=>{m.then(x)}};function x(){for(var m;m=w();){try{m.h.call(m.g)}catch(C){v(C)}var b=E;b.j(m),b.h<100&&(b.h++,m.next=b.g,b.g=m)}N=!1}function S(){this.u=this.u,this.C=this.C}S.prototype.u=!1,S.prototype.dispose=function(){this.u||(this.u=!0,this.N())},S.prototype[Symbol.dispose]=function(){this.dispose()},S.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function A(m,b){this.type=m,this.g=this.target=b,this.defaultPrevented=!1}A.prototype.h=function(){this.defaultPrevented=!0};var M=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var m=!1,b=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const C=()=>{};o.addEventListener("test",C,b),o.removeEventListener("test",C,b)}catch{}return m}();function I(m){return/^[\s\xa0]*$/.test(m)}function j(m,b){A.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,b)}h(j,A),j.prototype.init=function(m,b){const C=this.type=m.type,D=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=b,b=m.relatedTarget,b||(C=="mouseover"?b=m.fromElement:C=="mouseout"&&(b=m.toElement)),this.relatedTarget=b,D?(this.clientX=D.clientX!==void 0?D.clientX:D.pageX,this.clientY=D.clientY!==void 0?D.clientY:D.pageY,this.screenX=D.screenX||0,this.screenY=D.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&j.Z.h.call(this)},j.prototype.h=function(){j.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var B="closure_listenable_"+(Math.random()*1e6|0),L=0;function O(m,b,C,D,K){this.listener=m,this.proxy=null,this.src=b,this.type=C,this.capture=!!D,this.ha=K,this.key=++L,this.da=this.fa=!1}function $(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function U(m,b,C){for(const D in m)b.call(C,m[D],D,m)}function F(m,b){for(const C in m)b.call(void 0,m[C],C,m)}function X(m){const b={};for(const C in m)b[C]=m[C];return b}const H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(m,b){let C,D;for(let K=1;K<arguments.length;K++){D=arguments[K];for(C in D)m[C]=D[C];for(let Q=0;Q<H.length;Q++)C=H[Q],Object.prototype.hasOwnProperty.call(D,C)&&(m[C]=D[C])}}function z(m){this.src=m,this.g={},this.h=0}z.prototype.add=function(m,b,C,D,K){const Q=m.toString();m=this.g[Q],m||(m=this.g[Q]=[],this.h++);const le=de(m,b,D,K);return le>-1?(b=m[le],C||(b.fa=!1)):(b=new O(b,this.src,Q,!!D,K),b.fa=C,m.push(b)),b};function W(m,b){const C=b.type;if(C in m.g){var D=m.g[C],K=Array.prototype.indexOf.call(D,b,void 0),Q;(Q=K>=0)&&Array.prototype.splice.call(D,K,1),Q&&($(b),m.g[C].length==0&&(delete m.g[C],m.h--))}}function de(m,b,C,D){for(let K=0;K<m.length;++K){const Q=m[K];if(!Q.da&&Q.listener==b&&Q.capture==!!C&&Q.ha==D)return K}return-1}var Te="closure_lm_"+(Math.random()*1e6|0),Ie={};function me(m,b,C,D,K){if(Array.isArray(b)){for(let Q=0;Q<b.length;Q++)me(m,b[Q],C,D,K);return null}return C=Z(C),m&&m[B]?m.J(b,C,a(D)?!!D.capture:!1,K):Ae(m,b,C,!1,D,K)}function Ae(m,b,C,D,K,Q){if(!b)throw Error("Invalid event type");const le=a(K)?!!K.capture:!!K;let De=Ke(m);if(De||(m[Te]=De=new z(m)),C=De.add(b,C,D,le,Q),C.proxy)return C;if(D=Re(),C.proxy=D,D.src=m,D.listener=C,m.addEventListener)M||(K=le),K===void 0&&(K=!1),m.addEventListener(b.toString(),D,K);else if(m.attachEvent)m.attachEvent(xt(b.toString()),D);else if(m.addListener&&m.removeListener)m.addListener(D);else throw Error("addEventListener and attachEvent are unavailable.");return C}function Re(){function m(C){return b.call(m.src,m.listener,C)}const b=Be;return m}function Oe(m,b,C,D,K){if(Array.isArray(b))for(var Q=0;Q<b.length;Q++)Oe(m,b[Q],C,D,K);else D=a(D)?!!D.capture:!!D,C=Z(C),m&&m[B]?(m=m.i,Q=String(b).toString(),Q in m.g&&(b=m.g[Q],C=de(b,C,D,K),C>-1&&($(b[C]),Array.prototype.splice.call(b,C,1),b.length==0&&(delete m.g[Q],m.h--)))):m&&(m=Ke(m))&&(b=m.g[b.toString()],m=-1,b&&(m=de(b,C,D,K)),(C=m>-1?b[m]:null)&&jt(C))}function jt(m){if(typeof m!="number"&&m&&!m.da){var b=m.src;if(b&&b[B])W(b.i,m);else{var C=m.type,D=m.proxy;b.removeEventListener?b.removeEventListener(C,D,m.capture):b.detachEvent?b.detachEvent(xt(C),D):b.addListener&&b.removeListener&&b.removeListener(D),(C=Ke(b))?(W(C,m),C.h==0&&(C.src=null,b[Te]=null)):$(m)}}}function xt(m){return m in Ie?Ie[m]:Ie[m]="on"+m}function Be(m,b){if(m.da)m=!0;else{b=new j(b,this);const C=m.listener,D=m.ha||m.src;m.fa&&jt(m),m=C.call(D,b)}return m}function Ke(m){return m=m[Te],m instanceof z?m:null}var Fe="__closure_events_fn_"+(Math.random()*1e9>>>0);function Z(m){return typeof m=="function"?m:(m[Fe]||(m[Fe]=function(b){return m.handleEvent(b)}),m[Fe])}function fe(){S.call(this),this.i=new z(this),this.M=this,this.G=null}h(fe,S),fe.prototype[B]=!0,fe.prototype.removeEventListener=function(m,b,C,D){Oe(this,m,b,C,D)};function Ee(m,b){var C,D=m.G;if(D)for(C=[];D;D=D.G)C.push(D);if(m=m.M,D=b.type||b,typeof b=="string")b=new A(b,m);else if(b instanceof A)b.target=b.target||m;else{var K=b;b=new A(D,m),J(b,K)}K=!0;let Q,le;if(C)for(le=C.length-1;le>=0;le--)Q=b.g=C[le],K=ee(Q,D,!0,b)&&K;if(Q=b.g=m,K=ee(Q,D,!0,b)&&K,K=ee(Q,D,!1,b)&&K,C)for(le=0;le<C.length;le++)Q=b.g=C[le],K=ee(Q,D,!1,b)&&K}fe.prototype.N=function(){if(fe.Z.N.call(this),this.i){var m=this.i;for(const b in m.g){const C=m.g[b];for(let D=0;D<C.length;D++)$(C[D]);delete m.g[b],m.h--}}this.G=null},fe.prototype.J=function(m,b,C,D){return this.i.add(String(m),b,!1,C,D)},fe.prototype.K=function(m,b,C,D){return this.i.add(String(m),b,!0,C,D)};function ee(m,b,C,D){if(b=m.i.g[String(b)],!b)return!0;b=b.concat();let K=!0;for(let Q=0;Q<b.length;++Q){const le=b[Q];if(le&&!le.da&&le.capture==C){const De=le.listener,Gt=le.ha||le.src;le.fa&&W(m.i,le),K=De.call(Gt,D)!==!1&&K}}return K&&!D.defaultPrevented}function re(m,b){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=c(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(b)>2147483647?-1:o.setTimeout(m,b||0)}function ne(m){m.g=re(()=>{m.g=null,m.i&&(m.i=!1,ne(m))},m.l);const b=m.h;m.h=null,m.m.apply(null,b)}class ce extends S{constructor(b,C){super(),this.m=b,this.l=C,this.h=null,this.i=!1,this.g=null}j(b){this.h=arguments,this.g?this.i=!0:ne(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function G(m){S.call(this),this.h=m,this.g={}}h(G,S);var we=[];function je(m){U(m.g,function(b,C){this.g.hasOwnProperty(C)&&jt(b)},m),m.g={}}G.prototype.N=function(){G.Z.N.call(this),je(this)},G.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ce=o.JSON.stringify,tn=o.JSON.parse,He=class{stringify(m){return o.JSON.stringify(m,void 0)}parse(m){return o.JSON.parse(m,void 0)}};function st(){}function tt(){}var Bt={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Ut(){A.call(this,"d")}h(Ut,A);function or(){A.call(this,"c")}h(or,A);var fn={},hs=null;function Tn(){return hs=hs||new fe}fn.Ia="serverreachability";function iu(m){A.call(this,fn.Ia,m)}h(iu,A);function Hr(m){const b=Tn();Ee(b,new iu(b))}fn.STAT_EVENT="statevent";function tf(m,b){A.call(this,fn.STAT_EVENT,m),this.stat=b}h(tf,A);function mt(m){const b=Tn();Ee(b,new tf(b,m))}fn.Ja="timingevent";function Wr(m,b){A.call(this,fn.Ja,m),this.size=b}h(Wr,A);function br(m,b){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){m()},b)}function qr(){this.g=!0}qr.prototype.ua=function(){this.g=!1};function nf(m,b,C,D,K,Q){m.info(function(){if(m.g)if(Q){var le="",De=Q.split("&");for(let nt=0;nt<De.length;nt++){var Gt=De[nt].split("=");if(Gt.length>1){const nn=Gt[0];Gt=Gt[1];const fs=nn.split("_");le=fs.length>=2&&fs[1]=="type"?le+(nn+"="+Gt+"&"):le+(nn+"=redacted&")}}}else le=null;else le=Q;return"XMLHTTP REQ ("+D+") [attempt "+K+"]: "+b+`
`+C+`
`+le})}function Fs(m,b,C,D,K,Q,le){m.info(function(){return"XMLHTTP RESP ("+D+") [ attempt "+K+"]: "+b+`
`+C+`
`+Q+" "+le})}function Kn(m,b,C,D){m.info(function(){return"XMLHTTP TEXT ("+b+"): "+A4(m,C)+(D?" "+D:"")})}function I4(m,b){m.info(function(){return"TIMEOUT: "+b})}qr.prototype.info=function(){};function A4(m,b){if(!m.g)return b;if(!b)return null;try{const Q=JSON.parse(b);if(Q){for(m=0;m<Q.length;m++)if(Array.isArray(Q[m])){var C=Q[m];if(!(C.length<2)){var D=C[1];if(Array.isArray(D)&&!(D.length<1)){var K=D[0];if(K!="noop"&&K!="stop"&&K!="close")for(let le=1;le<D.length;le++)D[le]=""}}}}return Ce(Q)}catch{return b}}var rf={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},vT={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},wT;function sv(){}h(sv,st),sv.prototype.g=function(){return new XMLHttpRequest},wT=new sv;function ou(m){return encodeURIComponent(String(m))}function R4(m){var b=1;m=m.split(":");const C=[];for(;b>0&&m.length;)C.push(m.shift()),b--;return m.length&&C.push(m.join(":")),C}function Si(m,b,C,D){this.j=m,this.i=b,this.l=C,this.S=D||1,this.V=new G(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new _T}function _T(){this.i=null,this.g="",this.h=!1}var xT={},iv={};function ov(m,b,C){m.M=1,m.A=of(ds(b)),m.u=C,m.R=!0,bT(m,null)}function bT(m,b){m.F=Date.now(),sf(m),m.B=ds(m.A);var C=m.B,D=m.S;Array.isArray(D)||(D=[String(D)]),DT(C.i,"t",D),m.C=0,C=m.j.L,m.h=new _T,m.g=ZT(m.j,C?b:null,!m.u),m.P>0&&(m.O=new ce(c(m.Y,m,m.g),m.P)),b=m.V,C=m.g,D=m.ba;var K="readystatechange";Array.isArray(K)||(K&&(we[0]=K.toString()),K=we);for(let Q=0;Q<K.length;Q++){const le=me(C,K[Q],D||b.handleEvent,!1,b.h||b);if(!le)break;b.g[le.key]=le}b=m.J?X(m.J):{},m.u?(m.v||(m.v="POST"),b["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,b)):(m.v="GET",m.g.ea(m.B,m.v,null,b)),Hr(),nf(m.i,m.v,m.B,m.l,m.S,m.u)}Si.prototype.ba=function(m){m=m.target;const b=this.O;b&&Ii(m)==3?b.j():this.Y(m)},Si.prototype.Y=function(m){try{if(m==this.g)e:{const De=Ii(this.g),Gt=this.g.ya(),nt=this.g.ca();if(!(De<3)&&(De!=3||this.g&&(this.h.h||this.g.la()||zT(this.g)))){this.K||De!=4||Gt==7||(Gt==8||nt<=0?Hr(3):Hr(2)),av(this);var b=this.g.ca();this.X=b;var C=N4(this);if(this.o=b==200,Fs(this.i,this.v,this.B,this.l,this.S,De,b),this.o){if(this.U&&!this.L){t:{if(this.g){var D,K=this.g;if((D=K.g?K.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(D)){var Q=D;break t}}Q=null}if(m=Q)Kn(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,lv(this,m);else{this.o=!1,this.m=3,mt(12),qo(this),au(this);break e}}if(this.R){m=!0;let nn;for(;!this.K&&this.C<C.length;)if(nn=P4(this,C),nn==iv){De==4&&(this.m=4,mt(14),m=!1),Kn(this.i,this.l,null,"[Incomplete Response]");break}else if(nn==xT){this.m=4,mt(15),Kn(this.i,this.l,C,"[Invalid Chunk]"),m=!1;break}else Kn(this.i,this.l,nn,null),lv(this,nn);if(TT(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),De!=4||C.length!=0||this.h.h||(this.m=1,mt(16),m=!1),this.o=this.o&&m,!m)Kn(this.i,this.l,C,"[Invalid Chunked Response]"),qo(this),au(this);else if(C.length>0&&!this.W){this.W=!0;var le=this.j;le.g==this&&le.aa&&!le.P&&(le.j.info("Great, no buffering proxy detected. Bytes received: "+C.length),gv(le),le.P=!0,mt(11))}}else Kn(this.i,this.l,C,null),lv(this,C);De==4&&qo(this),this.o&&!this.K&&(De==4?QT(this.j,this):(this.o=!1,sf(this)))}else q4(this.g),b==400&&C.indexOf("Unknown SID")>0?(this.m=3,mt(12)):(this.m=0,mt(13)),qo(this),au(this)}}}catch{}finally{}};function N4(m){if(!TT(m))return m.g.la();const b=zT(m.g);if(b==="")return"";let C="";const D=b.length,K=Ii(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return qo(m),au(m),"";m.h.i=new o.TextDecoder}for(let Q=0;Q<D;Q++)m.h.h=!0,C+=m.h.i.decode(b[Q],{stream:!(K&&Q==D-1)});return b.length=0,m.h.g+=C,m.C=0,m.h.g}function TT(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function P4(m,b){var C=m.C,D=b.indexOf(`
`,C);return D==-1?iv:(C=Number(b.substring(C,D)),isNaN(C)?xT:(D+=1,D+C>b.length?iv:(b=b.slice(D,D+C),m.C=D+C,b)))}Si.prototype.cancel=function(){this.K=!0,qo(this)};function sf(m){m.T=Date.now()+m.H,ET(m,m.H)}function ET(m,b){if(m.D!=null)throw Error("WatchDog timer not null");m.D=br(c(m.aa,m),b)}function av(m){m.D&&(o.clearTimeout(m.D),m.D=null)}Si.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(I4(this.i,this.B),this.M!=2&&(Hr(),mt(17)),qo(this),this.m=2,au(this)):ET(this,this.T-m)};function au(m){m.j.I==0||m.K||QT(m.j,m)}function qo(m){av(m);var b=m.O;b&&typeof b.dispose=="function"&&b.dispose(),m.O=null,je(m.V),m.g&&(b=m.g,m.g=null,b.abort(),b.dispose())}function lv(m,b){try{var C=m.j;if(C.I!=0&&(C.g==m||cv(C.h,m))){if(!m.L&&cv(C.h,m)&&C.I==3){try{var D=C.Ba.g.parse(b)}catch{D=null}if(Array.isArray(D)&&D.length==3){var K=D;if(K[0]==0){e:if(!C.v){if(C.g)if(C.g.F+3e3<m.F)hf(C),cf(C);else break e;mv(C),mt(18)}}else C.xa=K[1],0<C.xa-C.K&&K[2]<37500&&C.F&&C.A==0&&!C.C&&(C.C=br(c(C.Va,C),6e3));CT(C.h)<=1&&C.ta&&(C.ta=void 0)}else Go(C,11)}else if((m.L||C.g==m)&&hf(C),!I(b))for(K=C.Ba.g.parse(b),b=0;b<K.length;b++){let nt=K[b];const nn=nt[0];if(!(nn<=C.K))if(C.K=nn,nt=nt[1],C.I==2)if(nt[0]=="c"){C.M=nt[1],C.ba=nt[2];const fs=nt[3];fs!=null&&(C.ka=fs,C.j.info("VER="+C.ka));const Qo=nt[4];Qo!=null&&(C.za=Qo,C.j.info("SVER="+C.za));const Ai=nt[5];Ai!=null&&typeof Ai=="number"&&Ai>0&&(D=1.5*Ai,C.O=D,C.j.info("backChannelRequestTimeoutMs_="+D)),D=C;const Ri=m.g;if(Ri){const ff=Ri.g?Ri.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ff){var Q=D.h;Q.g||ff.indexOf("spdy")==-1&&ff.indexOf("quic")==-1&&ff.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(uv(Q,Q.h),Q.h=null))}if(D.G){const yv=Ri.g?Ri.g.getResponseHeader("X-HTTP-Session-Id"):null;yv&&(D.wa=yv,lt(D.J,D.G,yv))}}C.I=3,C.l&&C.l.ra(),C.aa&&(C.T=Date.now()-m.F,C.j.info("Handshake RTT: "+C.T+"ms")),D=C;var le=m;if(D.na=YT(D,D.L?D.ba:null,D.W),le.L){IT(D.h,le);var De=le,Gt=D.O;Gt&&(De.H=Gt),De.D&&(av(De),sf(De)),D.g=le}else KT(D);C.i.length>0&&uf(C)}else nt[0]!="stop"&&nt[0]!="close"||Go(C,7);else C.I==3&&(nt[0]=="stop"||nt[0]=="close"?nt[0]=="stop"?Go(C,7):pv(C):nt[0]!="noop"&&C.l&&C.l.qa(nt),C.A=0)}}Hr(4)}catch{}}var M4=class{constructor(m,b){this.g=m,this.map=b}};function ST(m){this.l=m||10,o.PerformanceNavigationTiming?(m=o.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function kT(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function CT(m){return m.h?1:m.g?m.g.size:0}function cv(m,b){return m.h?m.h==b:m.g?m.g.has(b):!1}function uv(m,b){m.g?m.g.add(b):m.h=b}function IT(m,b){m.h&&m.h==b?m.h=null:m.g&&m.g.has(b)&&m.g.delete(b)}ST.prototype.cancel=function(){if(this.i=AT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function AT(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let b=m.i;for(const C of m.g.values())b=b.concat(C.G);return b}return f(m.i)}var RT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function O4(m,b){if(m){m=m.split("&");for(let C=0;C<m.length;C++){const D=m[C].indexOf("=");let K,Q=null;D>=0?(K=m[C].substring(0,D),Q=m[C].substring(D+1)):K=m[C],b(K,Q?decodeURIComponent(Q.replace(/\+/g," ")):"")}}}function ki(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let b;m instanceof ki?(this.l=m.l,lu(this,m.j),this.o=m.o,this.g=m.g,cu(this,m.u),this.h=m.h,hv(this,LT(m.i)),this.m=m.m):m&&(b=String(m).match(RT))?(this.l=!1,lu(this,b[1]||"",!0),this.o=uu(b[2]||""),this.g=uu(b[3]||"",!0),cu(this,b[4]),this.h=uu(b[5]||"",!0),hv(this,b[6]||"",!0),this.m=uu(b[7]||"")):(this.l=!1,this.i=new du(null,this.l))}ki.prototype.toString=function(){const m=[];var b=this.j;b&&m.push(hu(b,NT,!0),":");var C=this.g;return(C||b=="file")&&(m.push("//"),(b=this.o)&&m.push(hu(b,NT,!0),"@"),m.push(ou(C).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C=this.u,C!=null&&m.push(":",String(C))),(C=this.h)&&(this.g&&C.charAt(0)!="/"&&m.push("/"),m.push(hu(C,C.charAt(0)=="/"?j4:L4,!0))),(C=this.i.toString())&&m.push("?",C),(C=this.m)&&m.push("#",hu(C,F4)),m.join("")},ki.prototype.resolve=function(m){const b=ds(this);let C=!!m.j;C?lu(b,m.j):C=!!m.o,C?b.o=m.o:C=!!m.g,C?b.g=m.g:C=m.u!=null;var D=m.h;if(C)cu(b,m.u);else if(C=!!m.h){if(D.charAt(0)!="/")if(this.g&&!this.h)D="/"+D;else{var K=b.h.lastIndexOf("/");K!=-1&&(D=b.h.slice(0,K+1)+D)}if(K=D,K==".."||K==".")D="";else if(K.indexOf("./")!=-1||K.indexOf("/.")!=-1){D=K.lastIndexOf("/",0)==0,K=K.split("/");const Q=[];for(let le=0;le<K.length;){const De=K[le++];De=="."?D&&le==K.length&&Q.push(""):De==".."?((Q.length>1||Q.length==1&&Q[0]!="")&&Q.pop(),D&&le==K.length&&Q.push("")):(Q.push(De),D=!0)}D=Q.join("/")}else D=K}return C?b.h=D:C=m.i.toString()!=="",C?hv(b,LT(m.i)):C=!!m.m,C&&(b.m=m.m),b};function ds(m){return new ki(m)}function lu(m,b,C){m.j=C?uu(b,!0):b,m.j&&(m.j=m.j.replace(/:$/,""))}function cu(m,b){if(b){if(b=Number(b),isNaN(b)||b<0)throw Error("Bad port number "+b);m.u=b}else m.u=null}function hv(m,b,C){b instanceof du?(m.i=b,B4(m.i,m.l)):(C||(b=hu(b,V4)),m.i=new du(b,m.l))}function lt(m,b,C){m.i.set(b,C)}function of(m){return lt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function uu(m,b){return m?b?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function hu(m,b,C){return typeof m=="string"?(m=encodeURI(m).replace(b,D4),C&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function D4(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var NT=/[#\/\?@]/g,L4=/[#\?:]/g,j4=/[#\?]/g,V4=/[#\?@]/g,F4=/#/g;function du(m,b){this.h=this.g=null,this.i=m||null,this.j=!!b}function Ko(m){m.g||(m.g=new Map,m.h=0,m.i&&O4(m.i,function(b,C){m.add(decodeURIComponent(b.replace(/\+/g," ")),C)}))}t=du.prototype,t.add=function(m,b){Ko(this),this.i=null,m=ml(this,m);let C=this.g.get(m);return C||this.g.set(m,C=[]),C.push(b),this.h+=1,this};function PT(m,b){Ko(m),b=ml(m,b),m.g.has(b)&&(m.i=null,m.h-=m.g.get(b).length,m.g.delete(b))}function MT(m,b){return Ko(m),b=ml(m,b),m.g.has(b)}t.forEach=function(m,b){Ko(this),this.g.forEach(function(C,D){C.forEach(function(K){m.call(b,K,D,this)},this)},this)};function OT(m,b){Ko(m);let C=[];if(typeof b=="string")MT(m,b)&&(C=C.concat(m.g.get(ml(m,b))));else for(m=Array.from(m.g.values()),b=0;b<m.length;b++)C=C.concat(m[b]);return C}t.set=function(m,b){return Ko(this),this.i=null,m=ml(this,m),MT(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[b]),this.h+=1,this},t.get=function(m,b){return m?(m=OT(this,m),m.length>0?String(m[0]):b):b};function DT(m,b,C){PT(m,b),C.length>0&&(m.i=null,m.g.set(ml(m,b),f(C)),m.h+=C.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],b=Array.from(this.g.keys());for(let D=0;D<b.length;D++){var C=b[D];const K=ou(C);C=OT(this,C);for(let Q=0;Q<C.length;Q++){let le=K;C[Q]!==""&&(le+="="+ou(C[Q])),m.push(le)}}return this.i=m.join("&")};function LT(m){const b=new du;return b.i=m.i,m.g&&(b.g=new Map(m.g),b.h=m.h),b}function ml(m,b){return b=String(b),m.j&&(b=b.toLowerCase()),b}function B4(m,b){b&&!m.j&&(Ko(m),m.i=null,m.g.forEach(function(C,D){const K=D.toLowerCase();D!=K&&(PT(this,D),DT(this,K,C))},m)),m.j=b}function U4(m,b){const C=new qr;if(o.Image){const D=new Image;D.onload=u(Ci,C,"TestLoadImage: loaded",!0,b,D),D.onerror=u(Ci,C,"TestLoadImage: error",!1,b,D),D.onabort=u(Ci,C,"TestLoadImage: abort",!1,b,D),D.ontimeout=u(Ci,C,"TestLoadImage: timeout",!1,b,D),o.setTimeout(function(){D.ontimeout&&D.ontimeout()},1e4),D.src=m}else b(!1)}function z4(m,b){const C=new qr,D=new AbortController,K=setTimeout(()=>{D.abort(),Ci(C,"TestPingServer: timeout",!1,b)},1e4);fetch(m,{signal:D.signal}).then(Q=>{clearTimeout(K),Q.ok?Ci(C,"TestPingServer: ok",!0,b):Ci(C,"TestPingServer: server error",!1,b)}).catch(()=>{clearTimeout(K),Ci(C,"TestPingServer: error",!1,b)})}function Ci(m,b,C,D,K){try{K&&(K.onload=null,K.onerror=null,K.onabort=null,K.ontimeout=null),D(C)}catch{}}function $4(){this.g=new He}function dv(m){this.i=m.Sb||null,this.h=m.ab||!1}h(dv,st),dv.prototype.g=function(){return new af(this.i,this.h)};function af(m,b){fe.call(this),this.H=m,this.o=b,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}h(af,fe),t=af.prototype,t.open=function(m,b){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=b,this.readyState=1,pu(this)},t.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const b={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(b.body=m),(this.H||o).fetch(new Request(this.D,b)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,fu(this)),this.readyState=0},t.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,pu(this)),this.g&&(this.readyState=3,pu(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;jT(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function jT(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}t.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var b=m.value?m.value:new Uint8Array(0);(b=this.B.decode(b,{stream:!m.done}))&&(this.response=this.responseText+=b)}m.done?fu(this):pu(this),this.readyState==3&&jT(this)}},t.Oa=function(m){this.g&&(this.response=this.responseText=m,fu(this))},t.Na=function(m){this.g&&(this.response=m,fu(this))},t.ga=function(){this.g&&fu(this)};function fu(m){m.readyState=4,m.l=null,m.j=null,m.B=null,pu(m)}t.setRequestHeader=function(m,b){this.A.append(m,b)},t.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],b=this.h.entries();for(var C=b.next();!C.done;)C=C.value,m.push(C[0]+": "+C[1]),C=b.next();return m.join(`\r
`)};function pu(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(af.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function VT(m){let b="";return U(m,function(C,D){b+=D,b+=":",b+=C,b+=`\r
`}),b}function fv(m,b,C){e:{for(D in C){var D=!1;break e}D=!0}D||(C=VT(C),typeof m=="string"?C!=null&&ou(C):lt(m,b,C))}function At(m){fe.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}h(At,fe);var H4=/^https?$/i,W4=["POST","PUT"];t=At.prototype,t.Fa=function(m){this.H=m},t.ea=function(m,b,C,D){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);b=b?b.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():wT.g(),this.g.onreadystatechange=d(c(this.Ca,this));try{this.B=!0,this.g.open(b,String(m),!0),this.B=!1}catch(Q){FT(this,Q);return}if(m=C||"",C=new Map(this.headers),D)if(Object.getPrototypeOf(D)===Object.prototype)for(var K in D)C.set(K,D[K]);else if(typeof D.keys=="function"&&typeof D.get=="function")for(const Q of D.keys())C.set(Q,D.get(Q));else throw Error("Unknown input type for opt_headers: "+String(D));D=Array.from(C.keys()).find(Q=>Q.toLowerCase()=="content-type"),K=o.FormData&&m instanceof o.FormData,!(Array.prototype.indexOf.call(W4,b,void 0)>=0)||D||K||C.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,le]of C)this.g.setRequestHeader(Q,le);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(Q){FT(this,Q)}};function FT(m,b){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=b,m.o=5,BT(m),lf(m)}function BT(m){m.A||(m.A=!0,Ee(m,"complete"),Ee(m,"error"))}t.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,Ee(this,"complete"),Ee(this,"abort"),lf(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),lf(this,!0)),At.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?UT(this):this.Xa())},t.Xa=function(){UT(this)};function UT(m){if(m.h&&typeof i<"u"){if(m.v&&Ii(m)==4)setTimeout(m.Ca.bind(m),0);else if(Ee(m,"readystatechange"),Ii(m)==4){m.h=!1;try{const Q=m.ca();e:switch(Q){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var b=!0;break e;default:b=!1}var C;if(!(C=b)){var D;if(D=Q===0){let le=String(m.D).match(RT)[1]||null;!le&&o.self&&o.self.location&&(le=o.self.location.protocol.slice(0,-1)),D=!H4.test(le?le.toLowerCase():"")}C=D}if(C)Ee(m,"complete"),Ee(m,"success");else{m.o=6;try{var K=Ii(m)>2?m.g.statusText:""}catch{K=""}m.l=K+" ["+m.ca()+"]",BT(m)}}finally{lf(m)}}}}function lf(m,b){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const C=m.g;m.g=null,b||Ee(m,"ready");try{C.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Ii(m){return m.g?m.g.readyState:0}t.ca=function(){try{return Ii(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(m){if(this.g){var b=this.g.responseText;return m&&b.indexOf(m)==0&&(b=b.substring(m.length)),tn(b)}};function zT(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function q4(m){const b={};m=(m.g&&Ii(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let D=0;D<m.length;D++){if(I(m[D]))continue;var C=R4(m[D]);const K=C[0];if(C=C[1],typeof C!="string")continue;C=C.trim();const Q=b[K]||[];b[K]=Q,Q.push(C)}F(b,function(D){return D.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function mu(m,b,C){return C&&C.internalChannelParams&&C.internalChannelParams[m]||b}function $T(m){this.za=0,this.i=[],this.j=new qr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=mu("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=mu("baseRetryDelayMs",5e3,m),this.Za=mu("retryDelaySeedMs",1e4,m),this.Ta=mu("forwardChannelMaxRetries",2,m),this.va=mu("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new ST(m&&m.concurrentRequestLimit),this.Ba=new $4,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=$T.prototype,t.ka=8,t.I=1,t.connect=function(m,b,C,D){mt(0),this.W=m,this.H=b||{},C&&D!==void 0&&(this.H.OSID=C,this.H.OAID=D),this.F=this.X,this.J=YT(this,null,this.W),uf(this)};function pv(m){if(HT(m),m.I==3){var b=m.V++,C=ds(m.J);if(lt(C,"SID",m.M),lt(C,"RID",b),lt(C,"TYPE","terminate"),gu(m,C),b=new Si(m,m.j,b),b.M=2,b.A=of(ds(C)),C=!1,o.navigator&&o.navigator.sendBeacon)try{C=o.navigator.sendBeacon(b.A.toString(),"")}catch{}!C&&o.Image&&(new Image().src=b.A,C=!0),C||(b.g=ZT(b.j,null),b.g.ea(b.A)),b.F=Date.now(),sf(b)}XT(m)}function cf(m){m.g&&(gv(m),m.g.cancel(),m.g=null)}function HT(m){cf(m),m.v&&(o.clearTimeout(m.v),m.v=null),hf(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&o.clearTimeout(m.m),m.m=null)}function uf(m){if(!kT(m.h)&&!m.m){m.m=!0;var b=m.Ea;P||_(),N||(P(),N=!0),k.add(b,m),m.D=0}}function K4(m,b){return CT(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=b.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=br(c(m.Ea,m,b),JT(m,m.D)),m.D++,!0)}t.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const K=new Si(this,this.j,m);let Q=this.o;if(this.U&&(Q?(Q=X(Q),J(Q,this.U)):Q=this.U),this.u!==null||this.R||(K.J=Q,Q=null),this.S)e:{for(var b=0,C=0;C<this.i.length;C++){t:{var D=this.i[C];if("__data__"in D.map&&(D=D.map.__data__,typeof D=="string")){D=D.length;break t}D=void 0}if(D===void 0)break;if(b+=D,b>4096){b=C;break e}if(b===4096||C===this.i.length-1){b=C+1;break e}}b=1e3}else b=1e3;b=qT(this,K,b),C=ds(this.J),lt(C,"RID",m),lt(C,"CVER",22),this.G&&lt(C,"X-HTTP-Session-Id",this.G),gu(this,C),Q&&(this.R?b="headers="+ou(VT(Q))+"&"+b:this.u&&fv(C,this.u,Q)),uv(this.h,K),this.Ra&&lt(C,"TYPE","init"),this.S?(lt(C,"$req",b),lt(C,"SID","null"),K.U=!0,ov(K,C,null)):ov(K,C,b),this.I=2}}else this.I==3&&(m?WT(this,m):this.i.length==0||kT(this.h)||WT(this))};function WT(m,b){var C;b?C=b.l:C=m.V++;const D=ds(m.J);lt(D,"SID",m.M),lt(D,"RID",C),lt(D,"AID",m.K),gu(m,D),m.u&&m.o&&fv(D,m.u,m.o),C=new Si(m,m.j,C,m.D+1),m.u===null&&(C.J=m.o),b&&(m.i=b.G.concat(m.i)),b=qT(m,C,1e3),C.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),uv(m.h,C),ov(C,D,b)}function gu(m,b){m.H&&U(m.H,function(C,D){lt(b,D,C)}),m.l&&U({},function(C,D){lt(b,D,C)})}function qT(m,b,C){C=Math.min(m.i.length,C);const D=m.l?c(m.l.Ka,m.l,m):null;e:{var K=m.i;let De=-1;for(;;){const Gt=["count="+C];De==-1?C>0?(De=K[0].g,Gt.push("ofs="+De)):De=0:Gt.push("ofs="+De);let nt=!0;for(let nn=0;nn<C;nn++){var Q=K[nn].g;const fs=K[nn].map;if(Q-=De,Q<0)De=Math.max(0,K[nn].g-100),nt=!1;else try{Q="req"+Q+"_"||"";try{var le=fs instanceof Map?fs:Object.entries(fs);for(const[Qo,Ai]of le){let Ri=Ai;a(Ai)&&(Ri=Ce(Ai)),Gt.push(Q+Qo+"="+encodeURIComponent(Ri))}}catch(Qo){throw Gt.push(Q+"type="+encodeURIComponent("_badmap")),Qo}}catch{D&&D(fs)}}if(nt){le=Gt.join("&");break e}}le=void 0}return m=m.i.splice(0,C),b.G=m,le}function KT(m){if(!m.g&&!m.v){m.Y=1;var b=m.Da;P||_(),N||(P(),N=!0),k.add(b,m),m.A=0}}function mv(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=br(c(m.Da,m),JT(m,m.A)),m.A++,!0)}t.Da=function(){if(this.v=null,GT(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=br(c(this.Wa,this),m)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,mt(10),cf(this),GT(this))};function gv(m){m.B!=null&&(o.clearTimeout(m.B),m.B=null)}function GT(m){m.g=new Si(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var b=ds(m.na);lt(b,"RID","rpc"),lt(b,"SID",m.M),lt(b,"AID",m.K),lt(b,"CI",m.F?"0":"1"),!m.F&&m.ia&&lt(b,"TO",m.ia),lt(b,"TYPE","xmlhttp"),gu(m,b),m.u&&m.o&&fv(b,m.u,m.o),m.O&&(m.g.H=m.O);var C=m.g;m=m.ba,C.M=1,C.A=of(ds(b)),C.u=null,C.R=!0,bT(C,m)}t.Va=function(){this.C!=null&&(this.C=null,cf(this),mv(this),mt(19))};function hf(m){m.C!=null&&(o.clearTimeout(m.C),m.C=null)}function QT(m,b){var C=null;if(m.g==b){hf(m),gv(m),m.g=null;var D=2}else if(cv(m.h,b))C=b.G,IT(m.h,b),D=1;else return;if(m.I!=0){if(b.o)if(D==1){C=b.u?b.u.length:0,b=Date.now()-b.F;var K=m.D;D=Tn(),Ee(D,new Wr(D,C)),uf(m)}else KT(m);else if(K=b.m,K==3||K==0&&b.X>0||!(D==1&&K4(m,b)||D==2&&mv(m)))switch(C&&C.length>0&&(b=m.h,b.i=b.i.concat(C)),K){case 1:Go(m,5);break;case 4:Go(m,10);break;case 3:Go(m,6);break;default:Go(m,2)}}}function JT(m,b){let C=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(C*=2),C*b}function Go(m,b){if(m.j.info("Error code "+b),b==2){var C=c(m.bb,m),D=m.Ua;const K=!D;D=new ki(D||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||lu(D,"https"),of(D),K?U4(D.toString(),C):z4(D.toString(),C)}else mt(2);m.I=0,m.l&&m.l.pa(b),XT(m),HT(m)}t.bb=function(m){m?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))};function XT(m){if(m.I=0,m.ja=[],m.l){const b=AT(m.h);(b.length!=0||m.i.length!=0)&&(g(m.ja,b),g(m.ja,m.i),m.h.i.length=0,f(m.i),m.i.length=0),m.l.oa()}}function YT(m,b,C){var D=C instanceof ki?ds(C):new ki(C);if(D.g!="")b&&(D.g=b+"."+D.g),cu(D,D.u);else{var K=o.location;D=K.protocol,b=b?b+"."+K.hostname:K.hostname,K=+K.port;const Q=new ki(null);D&&lu(Q,D),b&&(Q.g=b),K&&cu(Q,K),C&&(Q.h=C),D=Q}return C=m.G,b=m.wa,C&&b&&lt(D,C,b),lt(D,"VER",m.ka),gu(m,D),D}function ZT(m,b,C){if(b&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return b=m.Aa&&!m.ma?new At(new dv({ab:C})):new At(m.ma),b.Fa(m.L),b}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function eE(){}t=eE.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function df(){}df.prototype.g=function(m,b){return new ar(m,b)};function ar(m,b){fe.call(this),this.g=new $T(b),this.l=m,this.h=b&&b.messageUrlParams||null,m=b&&b.messageHeaders||null,b&&b.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=b&&b.initMessageHeaders||null,b&&b.messageContentType&&(m?m["X-WebChannel-Content-Type"]=b.messageContentType:m={"X-WebChannel-Content-Type":b.messageContentType}),b&&b.sa&&(m?m["X-WebChannel-Client-Profile"]=b.sa:m={"X-WebChannel-Client-Profile":b.sa}),this.g.U=m,(m=b&&b.Qb)&&!I(m)&&(this.g.u=m),this.A=b&&b.supportsCrossDomainXhr||!1,this.v=b&&b.sendRawJson||!1,(b=b&&b.httpSessionIdParam)&&!I(b)&&(this.g.G=b,m=this.h,m!==null&&b in m&&(m=this.h,b in m&&delete m[b])),this.j=new gl(this)}h(ar,fe),ar.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},ar.prototype.close=function(){pv(this.g)},ar.prototype.o=function(m){var b=this.g;if(typeof m=="string"){var C={};C.__data__=m,m=C}else this.v&&(C={},C.__data__=Ce(m),m=C);b.i.push(new M4(b.Ya++,m)),b.I==3&&uf(b)},ar.prototype.N=function(){this.g.l=null,delete this.j,pv(this.g),delete this.g,ar.Z.N.call(this)};function tE(m){Ut.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var b=m.__sm__;if(b){e:{for(const C in b){m=C;break e}m=void 0}(this.i=m)&&(m=this.i,b=b!==null&&m in b?b[m]:void 0),this.data=b}else this.data=m}h(tE,Ut);function nE(){or.call(this),this.status=1}h(nE,or);function gl(m){this.g=m}h(gl,eE),gl.prototype.ra=function(){Ee(this.g,"a")},gl.prototype.qa=function(m){Ee(this.g,new tE(m))},gl.prototype.pa=function(m){Ee(this.g,new nE)},gl.prototype.oa=function(){Ee(this.g,"b")},df.prototype.createWebChannel=df.prototype.g,ar.prototype.send=ar.prototype.o,ar.prototype.open=ar.prototype.m,ar.prototype.close=ar.prototype.close,H2=function(){return new df},$2=function(){return Tn()},z2=fn,Yw={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},rf.NO_ERROR=0,rf.TIMEOUT=8,rf.HTTP_ERROR=6,Ep=rf,vT.COMPLETE="complete",U2=vT,tt.EventType=Bt,Bt.OPEN="a",Bt.CLOSE="b",Bt.ERROR="c",Bt.MESSAGE="d",fe.prototype.listen=fe.prototype.J,Ku=tt,At.prototype.listenOnce=At.prototype.K,At.prototype.getLastError=At.prototype.Ha,At.prototype.getLastErrorCode=At.prototype.ya,At.prototype.getStatus=At.prototype.ca,At.prototype.getResponseJson=At.prototype.La,At.prototype.getResponseText=At.prototype.la,At.prototype.send=At.prototype.ea,At.prototype.setWithCredentials=At.prototype.Fa,B2=At}).apply(typeof Mf<"u"?Mf:typeof self<"u"?self:typeof window<"u"?window:{});const DS="@firebase/firestore",LS="4.9.3";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gn{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}gn.UNAUTHENTICATED=new gn(null),gn.GOOGLE_CREDENTIALS=new gn("google-credentials-uid"),gn.FIRST_PARTY=new gn("first-party-uid"),gn.MOCK_USER=new gn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Yc="12.7.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ua=new wx("@firebase/firestore");function Al(){return Ua.logLevel}function se(t,...e){if(Ua.logLevel<=ze.DEBUG){const n=e.map(bx);Ua.debug(`Firestore (${Yc}): ${t}`,...n)}}function Bn(t,...e){if(Ua.logLevel<=ze.ERROR){const n=e.map(bx);Ua.error(`Firestore (${Yc}): ${t}`,...n)}}function za(t,...e){if(Ua.logLevel<=ze.WARN){const n=e.map(bx);Ua.warn(`Firestore (${Yc}): ${t}`,...n)}}function bx(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ge(t,e,n){let r="Unexpected state";typeof e=="string"?r=e:n=e,W2(t,r,n)}function W2(t,e,n){let r=`FIRESTORE (${Yc}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{r+=" CONTEXT: "+JSON.stringify(n)}catch{r+=" CONTEXT: "+n}throw Bn(r),new Error(r)}function ye(t,e,n,r){let s="Unexpected state";typeof n=="string"?s=n:r=n,t||W2(e,s,r)}function Pe(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ae extends js{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q2{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iU{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n(gn.UNAUTHENTICATED))}shutdown(){}}class oU{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class aU{constructor(e){this.t=e,this.currentUser=gn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ye(this.o===void 0,42304);let r=this.i;const s=l=>this.i!==r?(r=this.i,n(l)):Promise.resolve();let i=new Is;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Is,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const l=i;e.enqueueRetryable(async()=>{await l.promise,await s(this.currentUser)})},a=l=>{se("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(se("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Is)}},0),o()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(se("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ye(typeof r.accessToken=="string",31837,{l:r}),new q2(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ye(e===null||typeof e=="string",2055,{h:e}),new gn(e)}}class lU{constructor(e,n,r){this.P=e,this.T=n,this.I=r,this.type="FirstParty",this.user=gn.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class cU{constructor(e,n,r){this.P=e,this.T=n,this.I=r}getToken(){return Promise.resolve(new lU(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable(()=>n(gn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class jS{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uU{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,ur(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ye(this.o===void 0,3512);const r=i=>{i.error!=null&&se("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${i.error.message}`);const o=i.token!==this.m;return this.m=i.token,se("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?n(i.token):Promise.resolve()};this.o=i=>{e.enqueueRetryable(()=>r(i))};const s=i=>{se("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=i,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(i=>s(i)),setTimeout(()=>{if(!this.appCheck){const i=this.V.getImmediate({optional:!0});i?s(i):se("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new jS(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ye(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new jS(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hU(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tx{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=hU(40);for(let i=0;i<s.length;++i)r.length<20&&s[i]<n&&(r+=e.charAt(s[i]%62))}return r}}function Ne(t,e){return t<e?-1:t>e?1:0}function Zw(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const s=t.charAt(r),i=e.charAt(r);if(s!==i)return t0(s)===t0(i)?Ne(s,i):t0(s)?1:-1}return Ne(t.length,e.length)}const dU=55296,fU=57343;function t0(t){const e=t.charCodeAt(0);return e>=dU&&e<=fU}function Ec(t,e,n){return t.length===e.length&&t.every((r,s)=>n(r,e[s]))}function K2(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VS="__name__";class ws{constructor(e,n,r){n===void 0?n=0:n>e.length&&ge(637,{offset:n,range:e.length}),r===void 0?r=e.length-n:r>e.length-n&&ge(1746,{length:r,range:e.length-n}),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return ws.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof ws?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let s=0;s<r;s++){const i=ws.compareSegments(e.get(s),n.get(s));if(i!==0)return i}return Ne(e.length,n.length)}static compareSegments(e,n){const r=ws.isNumericId(e),s=ws.isNumericId(n);return r&&!s?-1:!r&&s?1:r&&s?ws.extractNumericId(e).compare(ws.extractNumericId(n)):Zw(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return yo.fromString(e.substring(4,e.length-2))}}class Ge extends ws{construct(e,n,r){return new Ge(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new ae(Y.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(s=>s.length>0))}return new Ge(n)}static emptyPath(){return new Ge([])}}const pU=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Tt extends ws{construct(e,n,r){return new Tt(e,n,r)}static isValidIdentifier(e){return pU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Tt.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===VS}static keyField(){return new Tt([VS])}static fromServerFormat(e){const n=[];let r="",s=0;const i=()=>{if(r.length===0)throw new ae(Y.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new ae(Y.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const l=e[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new ae(Y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(r+=a,s++):(i(),s++)}if(i(),o)throw new ae(Y.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Tt(n)}static emptyPath(){return new Tt([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he{constructor(e){this.path=e}static fromPath(e){return new he(Ge.fromString(e))}static fromName(e){return new he(Ge.fromString(e).popFirst(5))}static empty(){return new he(Ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return Ge.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new he(new Ge(e.slice()))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G2(t,e,n){if(!n)throw new ae(Y.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function mU(t,e,n,r){if(e===!0&&r===!0)throw new ae(Y.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function FS(t){if(!he.isDocumentKey(t))throw new ae(Y.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function BS(t){if(he.isDocumentKey(t))throw new ae(Y.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Q2(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function ly(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":ge(12329,{type:typeof t})}function zr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ae(Y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ly(t);throw new ae(Y.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function gU(t,e){if(e<=0)throw new ae(Y.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ht(t,e){const n={typeString:t};return e&&(n.value=e),n}function Dd(t,e){if(!Q2(t))throw new ae(Y.INVALID_ARGUMENT,"JSON must be an object");let n;for(const r in e)if(e[r]){const s=e[r].typeString,i="value"in e[r]?{value:e[r].value}:void 0;if(!(r in t)){n=`JSON missing required field: '${r}'`;break}const o=t[r];if(s&&typeof o!==s){n=`JSON field '${r}' must be a ${s}.`;break}if(i!==void 0&&o!==i.value){n=`Expected '${r}' field to equal '${i.value}'`;break}}if(n)throw new ae(Y.INVALID_ARGUMENT,n);return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const US=-62135596800,zS=1e6;class Je{static now(){return Je.fromMillis(Date.now())}static fromDate(e){return Je.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor((e-1e3*n)*zS);return new Je(n,r)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new ae(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new ae(Y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<US)throw new ae(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new ae(Y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/zS}_compareTo(e){return this.seconds===e.seconds?Ne(this.nanoseconds,e.nanoseconds):Ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Je._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Dd(e,Je._jsonSchema))return new Je(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-US;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Je._jsonSchemaVersion="firestore/timestamp/1.0",Je._jsonSchema={type:Ht("string",Je._jsonSchemaVersion),seconds:Ht("number"),nanoseconds:Ht("number")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{static fromTimestamp(e){return new xe(e)}static min(){return new xe(new Je(0,0))}static max(){return new xe(new Je(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh=-1;class bm{constructor(e,n,r,s){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=s}}function e1(t){return t.fields.find(e=>e.kind===2)}function ta(t){return t.fields.filter(e=>e.kind!==2)}bm.UNKNOWN_ID=-1;class Sp{constructor(e,n){this.fieldPath=e,this.kind=n}}class Zh{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Zh(0,wr.min())}}function yU(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=xe.fromTimestamp(r===1e9?new Je(n+1,0):new Je(n,r));return new wr(s,he.empty(),e)}function J2(t){return new wr(t.readTime,t.key,Yh)}class wr{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new wr(xe.min(),he.empty(),Yh)}static max(){return new wr(xe.max(),he.empty(),Yh)}}function Ex(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=he.comparator(t.documentKey,e.documentKey),n!==0?n:Ne(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const X2="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Y2{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cl(t){if(t.code!==Y.FAILED_PRECONDITION||t.message!==X2)throw t;se("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&ge(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new q((r,s)=>{this.nextCallback=i=>{this.wrapSuccess(e,i).next(r,s)},this.catchCallback=i=>{this.wrapFailure(n,i).next(r,s)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof q?n:q.resolve(n)}catch(n){return q.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):q.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):q.reject(n)}static resolve(e){return new q((n,r)=>{n(e)})}static reject(e){return new q((n,r)=>{r(e)})}static waitFor(e){return new q((n,r)=>{let s=0,i=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++i,o&&i===s&&n()},l=>r(l))}),o=!0,i===s&&n()})}static or(e){let n=q.resolve(!1);for(const r of e)n=n.next(s=>s?q.resolve(s):r());return n}static forEach(e,n){const r=[];return e.forEach((s,i)=>{r.push(n.call(this,s,i))}),this.waitFor(r)}static mapArray(e,n){return new q((r,s)=>{const i=e.length,o=new Array(i);let a=0;for(let l=0;l<i;l++){const c=l;n(e[c]).next(u=>{o[c]=u,++a,a===i&&r(o)},u=>s(u))}})}static doWhile(e,n){return new q((r,s)=>{const i=()=>{e()===!0?n().next(()=>{i()},s):r()};i()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cr="SimpleDb";class cy{static open(e,n,r,s){try{return new cy(n,e.transaction(s,r))}catch(i){throw new fh(n,i)}}constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.S=new Is,this.transaction.oncomplete=()=>{this.S.resolve()},this.transaction.onabort=()=>{n.error?this.S.reject(new fh(e,n.error)):this.S.resolve()},this.transaction.onerror=r=>{const s=Sx(r.target.error);this.S.reject(new fh(e,s))}}get D(){return this.S.promise}abort(e){e&&this.S.reject(e),this.aborted||(se(cr,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}C(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new wU(n)}}class vo{static delete(e){return se(cr,"Removing database:",e),ra(E2().indexedDB.deleteDatabase(e)).toPromise()}static v(){if(!M2())return!1;if(vo.F())return!0;const e=Zt(),n=vo.M(e),r=0<n&&n<10,s=Z2(e),i=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||i)}static F(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)==null?void 0:e.__PRIVATE_USE_MOCK_PERSISTENCE)==="YES"}static O(e,n){return e.store(n)}static M(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}constructor(e,n,r){this.name=e,this.version=n,this.N=r,this.B=null,vo.M(Zt())===12.2&&Bn("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}async L(e){return this.db||(se(cr,"Opening database:",this.name),this.db=await new Promise((n,r)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=i=>{const o=i.target.result;n(o)},s.onblocked=()=>{r(new fh(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=i=>{const o=i.target.error;o.name==="VersionError"?r(new ae(Y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new ae(Y.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new fh(e,o))},s.onupgradeneeded=i=>{se(cr,'Database "'+this.name+'" requires upgrade from version:',i.oldVersion);const o=i.target.result;this.N.k(o,s.transaction,i.oldVersion,this.version).next(()=>{se(cr,"Database upgrade to version "+this.version+" complete")})}})),this.q&&(this.db.onversionchange=n=>this.q(n)),this.db}$(e){this.q=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,s){const i=n==="readonly";let o=0;for(;;){++o;try{this.db=await this.L(e);const a=cy.open(this.db,e,i?"readonly":"readwrite",r),l=s(a).next(c=>(a.C(),c)).catch(c=>(a.abort(c),q.reject(c))).toPromise();return l.catch(()=>{}),await a.D,l}catch(a){const l=a,c=l.name!=="FirebaseError"&&o<3;if(se(cr,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Z2(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class vU{constructor(e){this.U=e,this.K=!1,this.W=null}get isDone(){return this.K}get G(){return this.W}set cursor(e){this.U=e}done(){this.K=!0}j(e){this.W=e}delete(){return ra(this.U.delete())}}class fh extends ae{constructor(e,n){super(Y.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Vo(t){return t.name==="IndexedDbTransactionError"}class wU{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(se(cr,"PUT",this.store.name,e,n),r=this.store.put(n,e)):(se(cr,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ra(r)}add(e){return se(cr,"ADD",this.store.name,e,e),ra(this.store.add(e))}get(e){return ra(this.store.get(e)).next(n=>(n===void 0&&(n=null),se(cr,"GET",this.store.name,e,n),n))}delete(e){return se(cr,"DELETE",this.store.name,e),ra(this.store.delete(e))}count(){return se(cr,"COUNT",this.store.name),ra(this.store.count())}J(e,n){const r=this.options(e,n),s=r.index?this.store.index(r.index):this.store;if(typeof s.getAll=="function"){const i=s.getAll(r.range);return new q((o,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{o(l.target.result)}})}{const i=this.cursor(r),o=[];return this.H(i,(a,l)=>{o.push(l)}).next(()=>o)}}Y(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new q((s,i)=>{r.onerror=o=>{i(o.target.error)},r.onsuccess=o=>{s(o.target.result)}})}Z(e,n){se(cr,"DELETE ALL",this.store.name);const r=this.options(e,n);r.X=!1;const s=this.cursor(r);return this.H(s,(i,o,a)=>a.delete())}ee(e,n){let r;n?r=e:(r={},n=e);const s=this.cursor(r);return this.H(s,n)}te(e){const n=this.cursor({});return new q((r,s)=>{n.onerror=i=>{const o=Sx(i.target.error);s(o)},n.onsuccess=i=>{const o=i.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}H(e,n){const r=[];return new q((s,i)=>{e.onerror=o=>{i(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const l=new vU(a),c=n(a.primaryKey,a.value,l);if(c instanceof q){const u=c.catch(h=>(l.done(),q.reject(h)));r.push(u)}l.isDone?s():l.G===null?a.continue():a.continue(l.G)}}).next(()=>q.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function ra(t){return new q((e,n)=>{t.onsuccess=r=>{const s=r.target.result;e(s)},t.onerror=r=>{const s=Sx(r.target.error);n(s)}})}let $S=!1;function Sx(t){const e=vo.M(Zt());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new ae("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return $S||($S=!0,setTimeout(()=>{throw r},0)),r}}return t}const ph="IndexBackfiller";class _U{constructor(e,n){this.asyncQueue=e,this.ne=n,this.task=null}start(){this.re(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}re(e){se(ph,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{const n=await this.ne.ie();se(ph,`Documents written: ${n}`)}catch(n){Vo(n)?se(ph,"Ignoring IndexedDB error during index backfill: ",n):await cl(n)}await this.re(6e4)})}}class xU{constructor(e,n){this.localStore=e,this.persistence=n}async ie(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.se(n,e))}se(e,n){const r=new Set;let s=n,i=!0;return q.doWhile(()=>i===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return se(ph,`Processing collection: ${o}`),this.oe(e,o,s).next(a=>{s-=a,r.add(o)});i=!1})).next(()=>n-s)}oe(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(s=>this.localStore.localDocuments.getNextDocuments(e,n,s,r).next(i=>{const o=i.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this._e(s,i)).next(a=>(se(ph,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,n,a))).next(()=>o.size)}))}_e(e,n){let r=e;return n.changes.forEach((s,i)=>{const o=J2(i);Ex(o,r)>0&&(r=o)}),new wr(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Or{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>n.writeSequenceNumber(r))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Or.ce=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ta=-1;function uy(t){return t==null}function ed(t){return t===0&&1/t==-1/0}function bU(t){return typeof t=="number"&&Number.isInteger(t)&&!ed(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tm="";function Mn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=HS(e)),e=TU(t.get(n),e);return HS(e)}function TU(t,e){let n=e;const r=t.length;for(let s=0;s<r;s++){const i=t.charAt(s);switch(i){case"\0":n+="";break;case Tm:n+="";break;default:n+=i}}return n}function HS(t){return t+Tm+""}function bs(t){const e=t.length;if(ye(e>=2,64408,{path:t}),e===2)return ye(t.charAt(0)===Tm&&t.charAt(1)==="",56145,{path:t}),Ge.emptyPath();const n=e-2,r=[];let s="";for(let i=0;i<e;){const o=t.indexOf(Tm,i);switch((o<0||o>n)&&ge(50515,{path:t}),t.charAt(o+1)){case"":const a=t.substring(i,o);let l;s.length===0?l=a:(s+=a,l=s,s=""),r.push(l);break;case"":s+=t.substring(i,o),s+="\0";break;case"":s+=t.substring(i,o+1);break;default:ge(61167,{path:t})}i=o+2}return new Ge(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const na="remoteDocuments",Ld="owner",wl="owner",td="mutationQueues",EU="userId",Xr="mutations",WS="batchId",fa="userMutationsIndex",qS=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kp(t,e){return[t,Mn(e)]}function eP(t,e,n){return[t,Mn(e),n]}const SU={},Sc="documentMutations",Em="remoteDocumentsV14",kU=["prefixPath","collectionGroup","readTime","documentId"],Cp="documentKeyIndex",CU=["prefixPath","collectionGroup","documentId"],tP="collectionGroupIndex",IU=["collectionGroup","readTime","prefixPath","documentId"],nd="remoteDocumentGlobal",t1="remoteDocumentGlobalKey",kc="targets",nP="queryTargetsIndex",AU=["canonicalId","targetId"],Cc="targetDocuments",RU=["targetId","path"],kx="documentTargetsIndex",NU=["path","targetId"],Sm="targetGlobalKey",Ea="targetGlobal",rd="collectionParents",PU=["collectionId","parent"],Ic="clientMetadata",MU="clientId",hy="bundles",OU="bundleId",dy="namedQueries",DU="name",Cx="indexConfiguration",LU="indexId",n1="collectionGroupIndex",jU="collectionGroup",mh="indexState",VU=["indexId","uid"],rP="sequenceNumberIndex",FU=["uid","sequenceNumber"],gh="indexEntries",BU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],sP="documentKeyIndex",UU=["indexId","uid","orderedDocumentKey"],fy="documentOverlays",zU=["userId","collectionPath","documentId"],r1="collectionPathOverlayIndex",$U=["userId","collectionPath","largestBatchId"],iP="collectionGroupOverlayIndex",HU=["userId","collectionGroup","largestBatchId"],Ix="globals",WU="name",oP=[td,Xr,Sc,na,kc,Ld,Ea,Cc,Ic,nd,rd,hy,dy],qU=[...oP,fy],aP=[td,Xr,Sc,Em,kc,Ld,Ea,Cc,Ic,nd,rd,hy,dy,fy],lP=aP,Ax=[...lP,Cx,mh,gh],KU=Ax,cP=[...Ax,Ix],GU=cP;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s1 extends Y2{constructor(e,n){super(),this.le=e,this.currentSequenceNumber=n}}function en(t,e){const n=Pe(t);return vo.O(n.le,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KS(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Fo(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function uP(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _t{constructor(e,n){this.comparator=e,this.root=n||yn.EMPTY}insert(e,n){return new _t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,yn.BLACK,null,null))}remove(e){return new _t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,yn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(e,r.key);if(s===0)return n+r.left.size;s<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Of(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Of(this.root,e,this.comparator,!1)}getReverseIterator(){return new Of(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Of(this.root,e,this.comparator,!0)}}class Of{constructor(e,n,r,s){this.isReverse=s,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=n?r(e.key,n):1,n&&s&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(i===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class yn{constructor(e,n,r,s,i){this.key=e,this.value=n,this.color=r??yn.RED,this.left=s??yn.EMPTY,this.right=i??yn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,s,i){return new yn(e??this.key,n??this.value,r??this.color,s??this.left,i??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let s=this;const i=r(e,s.key);return s=i<0?s.copy(null,null,null,s.left.insert(e,n,r),null):i===0?s.copy(null,n,null,null,null):s.copy(null,null,null,null,s.right.insert(e,n,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return yn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,s=this;if(n(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,n),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),n(e,s.key)===0){if(s.right.isEmpty())return yn.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,n))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,yn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,yn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw ge(43730,{key:this.key,value:this.value});if(this.right.isRed())throw ge(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw ge(27949);return e+(this.isRed()?0:1)}}yn.EMPTY=null,yn.RED=!0,yn.BLACK=!1;yn.EMPTY=new class{constructor(){this.size=0}get key(){throw ge(57766)}get value(){throw ge(16141)}get color(){throw ge(16727)}get left(){throw ge(29726)}get right(){throw ge(36894)}copy(e,n,r,s,i){return this}insert(e,n,r){return new yn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class et{constructor(e){this.comparator=e,this.data=new _t(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,e[1])>=0)return;n(s.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new GS(this.data.getIterator())}getIteratorFrom(e){return new GS(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof et)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(this.comparator(s,i)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new et(this.comparator);return n.data=e,n}}class GS{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function _l(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tr{constructor(e){this.fields=e,e.sort(Tt.comparator)}static empty(){return new tr([])}unionWith(e){let n=new et(Tt.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new tr(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Ec(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hP extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(s){try{return atob(s)}catch(i){throw typeof DOMException<"u"&&i instanceof DOMException?new hP("Invalid base64 string: "+i):i}}(e);return new qt(n)}static fromUint8Array(e){const n=function(s){let i="";for(let o=0;o<s.length;++o)i+=String.fromCharCode(s[o]);return i}(e);return new qt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}qt.EMPTY_BYTE_STRING=new qt("");const QU=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gi(t){if(ye(!!t,39018),typeof t=="string"){let e=0;const n=QU.exec(t);if(ye(!!n,46558,{timestamp:t}),n[1]){let s=n[1];s=(s+"000000000").substr(0,9),e=Number(s)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:vt(t.seconds),nanos:vt(t.nanos)}}function vt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function yi(t){return typeof t=="string"?qt.fromBase64String(t):qt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP="server_timestamp",fP="__type__",pP="__previous_value__",mP="__local_write_time__";function Rx(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[fP])==null?void 0:r.stringValue)===dP}function py(t){const e=t.mapValue.fields[pP];return Rx(e)?py(e):e}function sd(t){const e=gi(t.mapValue.fields[mP].timestampValue);return new Je(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JU{constructor(e,n,r,s,i,o,a,l,c,u){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=s,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c,this.isUsingEmulator=u}}const km="(default)";class $a{constructor(e,n){this.projectId=e,this.database=n||km}static empty(){return new $a("","")}get isDefaultDatabase(){return this.database===km}isEqual(e){return e instanceof $a&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nx="__type__",gP="__max__",no={mapValue:{fields:{__type__:{stringValue:gP}}}},Px="__vector__",Ac="value",Ip={nullValue:"NULL_VALUE"};function Co(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Rx(t)?4:yP(t)?9007199254740991:my(t)?10:11:ge(28295,{value:t})}function Ms(t,e){if(t===e)return!0;const n=Co(t);if(n!==Co(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return sd(t).isEqual(sd(e));case 3:return function(s,i){if(typeof s.timestampValue=="string"&&typeof i.timestampValue=="string"&&s.timestampValue.length===i.timestampValue.length)return s.timestampValue===i.timestampValue;const o=gi(s.timestampValue),a=gi(i.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(s,i){return yi(s.bytesValue).isEqual(yi(i.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(s,i){return vt(s.geoPointValue.latitude)===vt(i.geoPointValue.latitude)&&vt(s.geoPointValue.longitude)===vt(i.geoPointValue.longitude)}(t,e);case 2:return function(s,i){if("integerValue"in s&&"integerValue"in i)return vt(s.integerValue)===vt(i.integerValue);if("doubleValue"in s&&"doubleValue"in i){const o=vt(s.doubleValue),a=vt(i.doubleValue);return o===a?ed(o)===ed(a):isNaN(o)&&isNaN(a)}return!1}(t,e);case 9:return Ec(t.arrayValue.values||[],e.arrayValue.values||[],Ms);case 10:case 11:return function(s,i){const o=s.mapValue.fields||{},a=i.mapValue.fields||{};if(KS(o)!==KS(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ms(o[l],a[l])))return!1;return!0}(t,e);default:return ge(52216,{left:t})}}function id(t,e){return(t.values||[]).find(n=>Ms(n,e))!==void 0}function Io(t,e){if(t===e)return 0;const n=Co(t),r=Co(e);if(n!==r)return Ne(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ne(t.booleanValue,e.booleanValue);case 2:return function(i,o){const a=vt(i.integerValue||i.doubleValue),l=vt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1}(t,e);case 3:return QS(t.timestampValue,e.timestampValue);case 4:return QS(sd(t),sd(e));case 5:return Zw(t.stringValue,e.stringValue);case 6:return function(i,o){const a=yi(i),l=yi(o);return a.compareTo(l)}(t.bytesValue,e.bytesValue);case 7:return function(i,o){const a=i.split("/"),l=o.split("/");for(let c=0;c<a.length&&c<l.length;c++){const u=Ne(a[c],l[c]);if(u!==0)return u}return Ne(a.length,l.length)}(t.referenceValue,e.referenceValue);case 8:return function(i,o){const a=Ne(vt(i.latitude),vt(o.latitude));return a!==0?a:Ne(vt(i.longitude),vt(o.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return JS(t.arrayValue,e.arrayValue);case 10:return function(i,o){var d,f,g,y;const a=i.fields||{},l=o.fields||{},c=(d=a[Ac])==null?void 0:d.arrayValue,u=(f=l[Ac])==null?void 0:f.arrayValue,h=Ne(((g=c==null?void 0:c.values)==null?void 0:g.length)||0,((y=u==null?void 0:u.values)==null?void 0:y.length)||0);return h!==0?h:JS(c,u)}(t.mapValue,e.mapValue);case 11:return function(i,o){if(i===no.mapValue&&o===no.mapValue)return 0;if(i===no.mapValue)return 1;if(o===no.mapValue)return-1;const a=i.fields||{},l=Object.keys(a),c=o.fields||{},u=Object.keys(c);l.sort(),u.sort();for(let h=0;h<l.length&&h<u.length;++h){const d=Zw(l[h],u[h]);if(d!==0)return d;const f=Io(a[l[h]],c[u[h]]);if(f!==0)return f}return Ne(l.length,u.length)}(t.mapValue,e.mapValue);default:throw ge(23264,{he:n})}}function QS(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Ne(t,e);const n=gi(t),r=gi(e),s=Ne(n.seconds,r.seconds);return s!==0?s:Ne(n.nanos,r.nanos)}function JS(t,e){const n=t.values||[],r=e.values||[];for(let s=0;s<n.length&&s<r.length;++s){const i=Io(n[s],r[s]);if(i)return i}return Ne(n.length,r.length)}function Rc(t){return i1(t)}function i1(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=gi(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return yi(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return he.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",s=!0;for(const i of n.values||[])s?s=!1:r+=",",r+=i1(i);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let s="{",i=!0;for(const o of r)i?i=!1:s+=",",s+=`${o}:${i1(n.fields[o])}`;return s+"}"}(t.mapValue):ge(61005,{value:t})}function Ap(t){switch(Co(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=py(t);return e?16+Ap(e):16;case 5:return 2*t.stringValue.length;case 6:return yi(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((s,i)=>s+Ap(i),0)}(t.arrayValue);case 10:case 11:return function(r){let s=0;return Fo(r.fields,(i,o)=>{s+=i.length+Ap(o)}),s}(t.mapValue);default:throw ge(13486,{value:t})}}function od(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function o1(t){return!!t&&"integerValue"in t}function ad(t){return!!t&&"arrayValue"in t}function XS(t){return!!t&&"nullValue"in t}function YS(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Rp(t){return!!t&&"mapValue"in t}function my(t){var n,r;return((r=(((n=t==null?void 0:t.mapValue)==null?void 0:n.fields)||{})[Nx])==null?void 0:r.stringValue)===Px}function yh(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return Fo(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=yh(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=yh(t.arrayValue.values[n]);return e}return{...t}}function yP(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===gP}const vP={mapValue:{fields:{[Nx]:{stringValue:Px},[Ac]:{arrayValue:{}}}}};function XU(t){return"nullValue"in t?Ip:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?od($a.empty(),he.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?my(t)?vP:{mapValue:{}}:ge(35942,{value:t})}function YU(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?od($a.empty(),he.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?vP:"mapValue"in t?my(t)?{mapValue:{}}:no:ge(61959,{value:t})}function ZS(t,e){const n=Io(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function ek(t,e){const n=Io(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nn{constructor(e){this.value=e}static empty(){return new Nn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!Rp(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=yh(n)}setAll(e){let n=Tt.emptyPath(),r={},s=[];e.forEach((o,a)=>{if(!n.isImmediateParentOf(a)){const l=this.getFieldsMap(n);this.applyChanges(l,r,s),r={},s=[],n=a.popLast()}o?r[a.lastSegment()]=yh(o):s.push(a.lastSegment())});const i=this.getFieldsMap(n);this.applyChanges(i,r,s)}delete(e){const n=this.field(e.popLast());Rp(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Ms(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let s=n.mapValue.fields[e.get(r)];Rp(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=s),n=s}return n.mapValue.fields}applyChanges(e,n,r){Fo(n,(s,i)=>e[s]=i);for(const s of r)delete e[s]}clone(){return new Nn(yh(this.value))}}function wP(t){const e=[];return Fo(t.fields,(n,r)=>{const s=new Tt([n]);if(Rp(r)){const i=wP(r.mapValue).fields;if(i.length===0)e.push(s);else for(const o of i)e.push(s.child(o))}else e.push(s)}),new tr(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mt{constructor(e,n,r,s,i,o,a){this.key=e,this.documentType=n,this.version=r,this.readTime=s,this.createTime=i,this.data=o,this.documentState=a}static newInvalidDocument(e){return new Mt(e,0,xe.min(),xe.min(),xe.min(),Nn.empty(),0)}static newFoundDocument(e,n,r,s){return new Mt(e,1,n,xe.min(),r,s,0)}static newNoDocument(e,n){return new Mt(e,2,n,xe.min(),xe.min(),Nn.empty(),0)}static newUnknownDocument(e,n){return new Mt(e,3,n,xe.min(),xe.min(),Nn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(xe.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Nn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Nn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=xe.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Mt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Mt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc{constructor(e,n){this.position=e,this.inclusive=n}}function tk(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(i.field.isKeyField()?r=he.comparator(he.fromName(o.referenceValue),n.key):r=Io(o,n.data.field(i.field)),i.dir==="desc"&&(r*=-1),r!==0)break}return r}function nk(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Ms(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(e,n="asc"){this.field=e,this.dir=n}}function ZU(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _P{}class $e extends _P{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new ez(e,n,r):n==="array-contains"?new rz(e,r):n==="in"?new kP(e,r):n==="not-in"?new sz(e,r):n==="array-contains-any"?new iz(e,r):new $e(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new tz(e,r):new nz(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(Io(n,this.value)):n!==null&&Co(this.value)===Co(n)&&this.matchesComparison(Io(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return ge(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ye extends _P{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new Ye(e,n)}matches(e){return Pc(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function Pc(t){return t.op==="and"}function a1(t){return t.op==="or"}function Mx(t){return xP(t)&&Pc(t)}function xP(t){for(const e of t.filters)if(e instanceof Ye)return!1;return!0}function l1(t){if(t instanceof $e)return t.field.canonicalString()+t.op.toString()+Rc(t.value);if(Mx(t))return t.filters.map(e=>l1(e)).join(",");{const e=t.filters.map(n=>l1(n)).join(",");return`${t.op}(${e})`}}function bP(t,e){return t instanceof $e?function(r,s){return s instanceof $e&&r.op===s.op&&r.field.isEqual(s.field)&&Ms(r.value,s.value)}(t,e):t instanceof Ye?function(r,s){return s instanceof Ye&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce((i,o,a)=>i&&bP(o,s.filters[a]),!0):!1}(t,e):void ge(19439)}function TP(t,e){const n=t.filters.concat(e);return Ye.create(n,t.op)}function EP(t){return t instanceof $e?function(n){return`${n.field.canonicalString()} ${n.op} ${Rc(n.value)}`}(t):t instanceof Ye?function(n){return n.op.toString()+" {"+n.getFilters().map(EP).join(" ,")+"}"}(t):"Filter"}class ez extends $e{constructor(e,n,r){super(e,n,r),this.key=he.fromName(r.referenceValue)}matches(e){const n=he.comparator(e.key,this.key);return this.matchesComparison(n)}}class tz extends $e{constructor(e,n){super(e,"in",n),this.keys=SP("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class nz extends $e{constructor(e,n){super(e,"not-in",n),this.keys=SP("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function SP(t,e){var n;return(((n=e.arrayValue)==null?void 0:n.values)||[]).map(r=>he.fromName(r.referenceValue))}class rz extends $e{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return ad(n)&&id(n.arrayValue,this.value)}}class kP extends $e{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&id(this.value.arrayValue,n)}}class sz extends $e{constructor(e,n){super(e,"not-in",n)}matches(e){if(id(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!id(this.value.arrayValue,n)}}class iz extends $e{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!ad(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>id(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oz{constructor(e,n=null,r=[],s=[],i=null,o=null,a=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=s,this.limit=i,this.startAt=o,this.endAt=a,this.Te=null}}function c1(t,e=null,n=[],r=[],s=null,i=null,o=null){return new oz(t,e,n,r,s,i,o)}function Ha(t){const e=Pe(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>l1(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(i){return i.field.canonicalString()+i.dir}(r)).join(","),uy(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Rc(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Rc(r)).join(",")),e.Te=n}return e.Te}function jd(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ZU(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!bP(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!nk(t.startAt,e.startAt)&&nk(t.endAt,e.endAt)}function Cm(t){return he.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Im(t,e){return t.filters.filter(n=>n instanceof $e&&n.field.isEqual(e))}function rk(t,e,n){let r=Ip,s=!0;for(const i of Im(t,e)){let o=Ip,a=!0;switch(i.op){case"<":case"<=":o=XU(i.value);break;case"==":case"in":case">=":o=i.value;break;case">":o=i.value,a=!1;break;case"!=":case"not-in":o=Ip}ZS({value:r,inclusive:s},{value:o,inclusive:a})<0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];ZS({value:r,inclusive:s},{value:o,inclusive:n.inclusive})<0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}function sk(t,e,n){let r=no,s=!0;for(const i of Im(t,e)){let o=no,a=!0;switch(i.op){case">=":case">":o=YU(i.value),a=!1;break;case"==":case"in":case"<=":o=i.value;break;case"<":o=i.value,a=!1;break;case"!=":case"not-in":o=no}ek({value:r,inclusive:s},{value:o,inclusive:a})>0&&(r=o,s=a)}if(n!==null){for(let i=0;i<t.orderBy.length;++i)if(t.orderBy[i].field.isEqual(e)){const o=n.position[i];ek({value:r,inclusive:s},{value:o,inclusive:n.inclusive})>0&&(r=o,s=n.inclusive);break}}return{value:r,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zc{constructor(e,n=null,r=[],s=[],i=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=s,this.limit=i,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function az(t,e,n,r,s,i,o,a){return new Zc(t,e,n,r,s,i,o,a)}function gy(t){return new Zc(t)}function ik(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function CP(t){return t.collectionGroup!==null}function vh(t){const e=Pe(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const i of e.explicitOrderBy)e.Ie.push(i),n.add(i.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new et(Tt.comparator);return o.filters.forEach(l=>{l.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(i=>{n.has(i.canonicalString())||i.isKeyField()||e.Ie.push(new ld(i,r))}),n.has(Tt.keyField().canonicalString())||e.Ie.push(new ld(Tt.keyField(),r))}return e.Ie}function Lr(t){const e=Pe(t);return e.Ee||(e.Ee=lz(e,vh(t))),e.Ee}function lz(t,e){if(t.limitType==="F")return c1(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(s=>{const i=s.dir==="desc"?"asc":"desc";return new ld(s.field,i)});const n=t.endAt?new Nc(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Nc(t.startAt.position,t.startAt.inclusive):null;return c1(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function u1(t,e){const n=t.filters.concat([e]);return new Zc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Am(t,e,n){return new Zc(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function yy(t,e){return jd(Lr(t),Lr(e))&&t.limitType===e.limitType}function IP(t){return`${Ha(Lr(t))}|lt:${t.limitType}`}function Rl(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(s=>EP(s)).join(", ")}]`),uy(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(s=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(s)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(s=>Rc(s)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(s=>Rc(s)).join(",")),`Target(${r})`}(Lr(t))}; limitType=${t.limitType})`}function Vd(t,e){return e.isFoundDocument()&&function(r,s){const i=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(i):he.isDocumentKey(r.path)?r.path.isEqual(i):r.path.isImmediateParentOf(i)}(t,e)&&function(r,s){for(const i of vh(r))if(!i.field.isKeyField()&&s.data.field(i.field)===null)return!1;return!0}(t,e)&&function(r,s){for(const i of r.filters)if(!i.matches(s))return!1;return!0}(t,e)&&function(r,s){return!(r.startAt&&!function(o,a,l){const c=tk(o,a,l);return o.inclusive?c<=0:c<0}(r.startAt,vh(r),s)||r.endAt&&!function(o,a,l){const c=tk(o,a,l);return o.inclusive?c>=0:c>0}(r.endAt,vh(r),s))}(t,e)}function cz(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function AP(t){return(e,n)=>{let r=!1;for(const s of vh(t)){const i=uz(s,e,n);if(i!==0)return i;r=r||s.field.isKeyField()}return 0}}function uz(t,e,n){const r=t.field.isKeyField()?he.comparator(e.key,n.key):function(i,o,a){const l=o.data.field(i),c=a.data.field(i);return l!==null&&c!==null?Io(l,c):ge(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return ge(19790,{direction:t.dir})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[s,i]of r)if(this.equalsFn(s,e))return i}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),s=this.inner[r];if(s===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let i=0;i<s.length;i++)if(this.equalsFn(s[i][0],e))return void(s[i]=[e,n]);s.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return r.length===1?delete this.inner[n]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Fo(this.inner,(n,r)=>{for(const[s,i]of r)e(s,i)})}isEmpty(){return uP(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hz=new _t(he.comparator);function pr(){return hz}const RP=new _t(he.comparator);function Gu(...t){let e=RP;for(const n of t)e=e.insert(n.key,n);return e}function NP(t){let e=RP;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function Ts(){return wh()}function PP(){return wh()}function wh(){return new xi(t=>t.toString(),(t,e)=>t.isEqual(e))}const dz=new _t(he.comparator),fz=new et(he.comparator);function Ve(...t){let e=fz;for(const n of t)e=e.add(n);return e}const pz=new et(Ne);function mz(){return pz}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ox(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ed(e)?"-0":e}}function MP(t){return{integerValue:""+t}}function OP(t,e){return bU(e)?MP(e):Ox(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vy{constructor(){this._=void 0}}function gz(t,e,n){return t instanceof cd?function(s,i){const o={fields:{[fP]:{stringValue:dP},[mP]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return i&&Rx(i)&&(i=py(i)),i&&(o.fields[pP]=i),{mapValue:o}}(n,e):t instanceof Mc?LP(t,e):t instanceof Oc?jP(t,e):function(s,i){const o=DP(s,i),a=ok(o)+ok(s.Ae);return o1(o)&&o1(s.Ae)?MP(a):Ox(s.serializer,a)}(t,e)}function yz(t,e,n){return t instanceof Mc?LP(t,e):t instanceof Oc?jP(t,e):n}function DP(t,e){return t instanceof Dc?function(r){return o1(r)||function(i){return!!i&&"doubleValue"in i}(r)}(e)?e:{integerValue:0}:null}class cd extends vy{}class Mc extends vy{constructor(e){super(),this.elements=e}}function LP(t,e){const n=VP(e);for(const r of t.elements)n.some(s=>Ms(s,r))||n.push(r);return{arrayValue:{values:n}}}class Oc extends vy{constructor(e){super(),this.elements=e}}function jP(t,e){let n=VP(e);for(const r of t.elements)n=n.filter(s=>!Ms(s,r));return{arrayValue:{values:n}}}class Dc extends vy{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function ok(t){return vt(t.integerValue||t.doubleValue)}function VP(t){return ad(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FP{constructor(e,n){this.field=e,this.transform=n}}function vz(t,e){return t.field.isEqual(e.field)&&function(r,s){return r instanceof Mc&&s instanceof Mc||r instanceof Oc&&s instanceof Oc?Ec(r.elements,s.elements,Ms):r instanceof Dc&&s instanceof Dc?Ms(r.Ae,s.Ae):r instanceof cd&&s instanceof cd}(t.transform,e.transform)}class wz{constructor(e,n){this.version=e,this.transformResults=n}}class Pn{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new Pn}static exists(e){return new Pn(void 0,e)}static updateTime(e){return new Pn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Np(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class wy{}function BP(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new _y(t.key,Pn.none()):new eu(t.key,t.data,Pn.none());{const n=t.data,r=Nn.empty();let s=new et(Tt.comparator);for(let i of e.fields)if(!s.has(i)){let o=n.field(i);o===null&&i.length>1&&(i=i.popLast(),o=n.field(i)),o===null?r.delete(i):r.set(i,o),s=s.add(i)}return new bi(t.key,r,new tr(s.toArray()),Pn.none())}}function _z(t,e,n){t instanceof eu?function(s,i,o){const a=s.value.clone(),l=lk(s.fieldTransforms,i,o.transformResults);a.setAll(l),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(t,e,n):t instanceof bi?function(s,i,o){if(!Np(s.precondition,i))return void i.convertToUnknownDocument(o.version);const a=lk(s.fieldTransforms,i,o.transformResults),l=i.data;l.setAll(UP(s)),l.setAll(a),i.convertToFoundDocument(o.version,l).setHasCommittedMutations()}(t,e,n):function(s,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,n)}function _h(t,e,n,r){return t instanceof eu?function(i,o,a,l){if(!Np(i.precondition,o))return a;const c=i.value.clone(),u=ck(i.fieldTransforms,l,o);return c.setAll(u),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(t,e,n,r):t instanceof bi?function(i,o,a,l){if(!Np(i.precondition,o))return a;const c=ck(i.fieldTransforms,l,o),u=o.data;return u.setAll(UP(i)),u.setAll(c),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),a===null?null:a.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(h=>h.field))}(t,e,n,r):function(i,o,a){return Np(i.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(t,e,n)}function xz(t,e){let n=null;for(const r of t.fieldTransforms){const s=e.data.field(r.field),i=DP(r.transform,s||null);i!=null&&(n===null&&(n=Nn.empty()),n.set(r.field,i))}return n||null}function ak(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ec(r,s,(i,o)=>vz(i,o))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class eu extends wy{constructor(e,n,r,s=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class bi extends wy{constructor(e,n,r,s,i=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=s,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function UP(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function lk(t,e,n){const r=new Map;ye(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,yz(o,a,n[s]))}return r}function ck(t,e,n){const r=new Map;for(const s of t){const i=s.transform,o=n.data.field(s.field);r.set(s.field,gz(i,o,e))}return r}class _y extends wy{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zP extends wy{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dx{constructor(e,n,r,s){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let s=0;s<this.mutations.length;s++){const i=this.mutations[s];i.key.isEqual(e.key)&&_z(i,e,r[s])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=_h(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=_h(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=PP();return this.mutations.forEach(s=>{const i=e.get(s.key),o=i.overlayedDocument;let a=this.applyToLocalView(o,i.mutatedFields);a=n.has(s.key)?null:a;const l=BP(o,a);l!==null&&r.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(xe.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Ve())}isEqual(e){return this.batchId===e.batchId&&Ec(this.mutations,e.mutations,(n,r)=>ak(n,r))&&Ec(this.baseMutations,e.baseMutations,(n,r)=>ak(n,r))}}class Lx{constructor(e,n,r,s){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=s}static from(e,n,r){ye(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let s=function(){return dz}();const i=e.mutations;for(let o=0;o<i.length;o++)s=s.insert(i[o].key,r[o].version);return new Lx(e,n,r,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jx{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bz{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var zt,We;function Tz(t){switch(t){case Y.OK:return ge(64938);case Y.CANCELLED:case Y.UNKNOWN:case Y.DEADLINE_EXCEEDED:case Y.RESOURCE_EXHAUSTED:case Y.INTERNAL:case Y.UNAVAILABLE:case Y.UNAUTHENTICATED:return!1;case Y.INVALID_ARGUMENT:case Y.NOT_FOUND:case Y.ALREADY_EXISTS:case Y.PERMISSION_DENIED:case Y.FAILED_PRECONDITION:case Y.ABORTED:case Y.OUT_OF_RANGE:case Y.UNIMPLEMENTED:case Y.DATA_LOSS:return!0;default:return ge(15467,{code:t})}}function $P(t){if(t===void 0)return Bn("GRPC error has no .code"),Y.UNKNOWN;switch(t){case zt.OK:return Y.OK;case zt.CANCELLED:return Y.CANCELLED;case zt.UNKNOWN:return Y.UNKNOWN;case zt.DEADLINE_EXCEEDED:return Y.DEADLINE_EXCEEDED;case zt.RESOURCE_EXHAUSTED:return Y.RESOURCE_EXHAUSTED;case zt.INTERNAL:return Y.INTERNAL;case zt.UNAVAILABLE:return Y.UNAVAILABLE;case zt.UNAUTHENTICATED:return Y.UNAUTHENTICATED;case zt.INVALID_ARGUMENT:return Y.INVALID_ARGUMENT;case zt.NOT_FOUND:return Y.NOT_FOUND;case zt.ALREADY_EXISTS:return Y.ALREADY_EXISTS;case zt.PERMISSION_DENIED:return Y.PERMISSION_DENIED;case zt.FAILED_PRECONDITION:return Y.FAILED_PRECONDITION;case zt.ABORTED:return Y.ABORTED;case zt.OUT_OF_RANGE:return Y.OUT_OF_RANGE;case zt.UNIMPLEMENTED:return Y.UNIMPLEMENTED;case zt.DATA_LOSS:return Y.DATA_LOSS;default:return ge(39323,{code:t})}}(We=zt||(zt={}))[We.OK=0]="OK",We[We.CANCELLED=1]="CANCELLED",We[We.UNKNOWN=2]="UNKNOWN",We[We.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",We[We.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",We[We.NOT_FOUND=5]="NOT_FOUND",We[We.ALREADY_EXISTS=6]="ALREADY_EXISTS",We[We.PERMISSION_DENIED=7]="PERMISSION_DENIED",We[We.UNAUTHENTICATED=16]="UNAUTHENTICATED",We[We.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",We[We.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",We[We.ABORTED=10]="ABORTED",We[We.OUT_OF_RANGE=11]="OUT_OF_RANGE",We[We.UNIMPLEMENTED=12]="UNIMPLEMENTED",We[We.INTERNAL=13]="INTERNAL",We[We.UNAVAILABLE=14]="UNAVAILABLE",We[We.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ez(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sz=new yo([4294967295,4294967295],0);function uk(t){const e=Ez().encode(t),n=new F2;return n.update(e),new Uint8Array(n.digest())}function hk(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new yo([n,r],0),new yo([s,i],0)]}class Vx{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new Qu(`Invalid padding: ${n}`);if(r<0)throw new Qu(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new Qu(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new Qu(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=yo.fromNumber(this.ge)}ye(e,n,r){let s=e.add(n.multiply(yo.fromNumber(r)));return s.compare(Sz)===1&&(s=new yo([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=uk(e),[r,s]=hk(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);if(!this.we(o))return!1}return!0}static create(e,n,r){const s=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),o=new Vx(i,s,n);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.ge===0)return;const n=uk(e),[r,s]=hk(n);for(let i=0;i<this.hashCount;i++){const o=this.ye(r,s,i);this.Se(o)}}Se(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class Qu extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xy{constructor(e,n,r,s,i){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const s=new Map;return s.set(e,Fd.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new xy(xe.min(),s,new _t(Ne),pr(),Ve())}}class Fd{constructor(e,n,r,s,i){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Fd(r,n,Ve(),Ve(),Ve())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pp{constructor(e,n,r,s){this.be=e,this.removedTargetIds=n,this.key=r,this.De=s}}class HP{constructor(e,n){this.targetId=e,this.Ce=n}}class WP{constructor(e,n,r=qt.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=s}}class dk{constructor(){this.ve=0,this.Fe=fk(),this.Me=qt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ve(),n=Ve(),r=Ve();return this.Fe.forEach((s,i)=>{switch(i){case 0:e=e.add(s);break;case 2:n=n.add(s);break;case 1:r=r.add(s);break;default:ge(38017,{changeType:i})}}),new Fd(this.Me,this.xe,e,n,r)}qe(){this.Oe=!1,this.Fe=fk()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ye(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class kz{constructor(e){this.Ge=e,this.ze=new Map,this.je=pr(),this.Je=Df(),this.He=Df(),this.Ye=new _t(Ne)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,n=>{const r=this.nt(n);switch(e.state){case 0:this.rt(n)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),r.Le(e.resumeToken));break;default:ge(56790,{state:e.state})}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach((r,s)=>{this.rt(s)&&n(s)})}st(e){const n=e.targetId,r=e.Ce.count,s=this.ot(n);if(s){const i=s.target;if(Cm(i))if(r===0){const o=new he(i.path);this.et(n,o,Mt.newNoDocument(o,xe.min()))}else ye(r===1,20013,{expectedCount:r});else{const o=this._t(n);if(o!==r){const a=this.ut(e),l=a?this.ct(a,e,o):1;if(l!==0){this.it(n);const c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,c)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:i=0}=n;let o,a;try{o=yi(r).toUint8Array()}catch(l){if(l instanceof hP)return za("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new Vx(o,s,i)}catch(l){return za(l instanceof Qu?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(e,n,r){return n.Ce.count===r-this.Pt(e,n.targetId)?0:2}Pt(e,n){const r=this.Ge.getRemoteKeysForTarget(n);let s=0;return r.forEach(i=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${i.path.canonicalString()}`;e.mightContain(a)||(this.et(n,i,null),s++)}),s}Tt(e){const n=new Map;this.ze.forEach((i,o)=>{const a=this.ot(o);if(a){if(i.current&&Cm(a.target)){const l=new he(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,Mt.newNoDocument(l,e))}i.Be&&(n.set(o,i.ke()),i.qe())}});let r=Ve();this.He.forEach((i,o)=>{let a=!0;o.forEachWhile(l=>{const c=this.ot(l);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(i))}),this.je.forEach((i,o)=>o.setReadTime(e));const s=new xy(e,n,this.Ye,this.je,r);return this.je=pr(),this.Je=Df(),this.He=Df(),this.Ye=new _t(Ne),s}Xe(e,n){if(!this.rt(e))return;const r=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,r),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,r){if(!this.rt(e))return;const s=this.nt(e);this.Et(e,n)?s.Qe(n,1):s.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),r&&(this.je=this.je.insert(n,r))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new dk,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new et(Ne),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new et(Ne),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||se("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new dk),this.Ge.getRemoteKeysForTarget(e).forEach(n=>{this.et(e,n,null)})}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function Df(){return new _t(he.comparator)}function fk(){return new _t(he.comparator)}const Cz={asc:"ASCENDING",desc:"DESCENDING"},Iz={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Az={and:"AND",or:"OR"};class Rz{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function h1(t,e){return t.useProto3Json||uy(e)?e:{value:e}}function Lc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function qP(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function Nz(t,e){return Lc(t,e.toTimestamp())}function zn(t){return ye(!!t,49232),xe.fromTimestamp(function(n){const r=gi(n);return new Je(r.seconds,r.nanos)}(t))}function Fx(t,e){return d1(t,e).canonicalString()}function d1(t,e){const n=function(s){return new Ge(["projects",s.projectId,"databases",s.database])}(t).child("documents");return e===void 0?n:n.child(e)}function KP(t){const e=Ge.fromString(t);return ye(nM(e),10190,{key:e.toString()}),e}function Rm(t,e){return Fx(t.databaseId,e.path)}function Sa(t,e){const n=KP(e);if(n.get(1)!==t.databaseId.projectId)throw new ae(Y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ae(Y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new he(JP(n))}function GP(t,e){return Fx(t.databaseId,e)}function QP(t){const e=KP(t);return e.length===4?Ge.emptyPath():JP(e)}function f1(t){return new Ge(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function JP(t){return ye(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function pk(t,e,n){return{name:Rm(t,e),fields:n.value.mapValue.fields}}function Pz(t,e,n){const r=Sa(t,e.name),s=zn(e.updateTime),i=e.createTime?zn(e.createTime):xe.min(),o=new Nn({mapValue:{fields:e.fields}}),a=Mt.newFoundDocument(r,s,i,o);return n&&a.setHasCommittedMutations(),n?a.setHasCommittedMutations():a}function Mz(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:ge(39313,{state:c})}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(c,u){return c.useProto3Json?(ye(u===void 0||typeof u=="string",58123),qt.fromBase64String(u||"")):(ye(u===void 0||u instanceof Buffer||u instanceof Uint8Array,16193),qt.fromUint8Array(u||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const u=c.code===void 0?Y.UNKNOWN:$P(c.code);return new ae(u,c.message||"")}(o);n=new WP(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=Sa(t,r.document.name),i=zn(r.document.updateTime),o=r.document.createTime?zn(r.document.createTime):xe.min(),a=new Nn({mapValue:{fields:r.document.fields}}),l=Mt.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Pp(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=Sa(t,r.document),i=r.readTime?zn(r.readTime):xe.min(),o=Mt.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Pp([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=Sa(t,r.document),i=r.removedTargetIds||[];n=new Pp([],i,s,null)}else{if(!("filter"in e))return ge(11601,{Rt:e});{e.filter;const r=e.filter;r.targetId;const{count:s=0,unchangedNames:i}=r,o=new bz(s,i),a=r.targetId;n=new HP(a,o)}}return n}function Nm(t,e){let n;if(e instanceof eu)n={update:pk(t,e.key,e.value)};else if(e instanceof _y)n={delete:Rm(t,e.key)};else if(e instanceof bi)n={update:pk(t,e.key,e.data),updateMask:Fz(e.fieldMask)};else{if(!(e instanceof zP))return ge(16599,{Vt:e.type});n={verify:Rm(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(i,o){const a=o.transform;if(a instanceof cd)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Mc)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Oc)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Dc)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw ge(20930,{transform:o.transform})}(0,r))),e.precondition.isNone||(n.currentDocument=function(s,i){return i.updateTime!==void 0?{updateTime:Nz(s,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:ge(27497)}(t,e.precondition)),n}function p1(t,e){const n=e.currentDocument?function(i){return i.updateTime!==void 0?Pn.updateTime(zn(i.updateTime)):i.exists!==void 0?Pn.exists(i.exists):Pn.none()}(e.currentDocument):Pn.none(),r=e.updateTransforms?e.updateTransforms.map(s=>function(o,a){let l=null;if("setToServerValue"in a)ye(a.setToServerValue==="REQUEST_TIME",16630,{proto:a}),l=new cd;else if("appendMissingElements"in a){const u=a.appendMissingElements.values||[];l=new Mc(u)}else if("removeAllFromArray"in a){const u=a.removeAllFromArray.values||[];l=new Oc(u)}else"increment"in a?l=new Dc(o,a.increment):ge(16584,{proto:a});const c=Tt.fromServerFormat(a.fieldPath);return new FP(c,l)}(t,s)):[];if(e.update){e.update.name;const s=Sa(t,e.update.name),i=new Nn({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(l){const c=l.fieldPaths||[];return new tr(c.map(u=>Tt.fromServerFormat(u)))}(e.updateMask);return new bi(s,i,o,n,r)}return new eu(s,i,n,r)}if(e.delete){const s=Sa(t,e.delete);return new _y(s,n)}if(e.verify){const s=Sa(t,e.verify);return new zP(s,n)}return ge(1463,{proto:e})}function Oz(t,e){return t&&t.length>0?(ye(e!==void 0,14353),t.map(n=>function(s,i){let o=s.updateTime?zn(s.updateTime):zn(i);return o.isEqual(xe.min())&&(o=zn(i)),new wz(o,s.transformResults||[])}(n,e))):[]}function XP(t,e){return{documents:[GP(t,e.path)]}}function YP(t,e){const n={structuredQuery:{}},r=e.path;let s;e.collectionGroup!==null?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=GP(t,s);const i=function(c){if(c.length!==0)return tM(Ye.create(c,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(c){if(c.length!==0)return c.map(u=>function(d){return{field:Nl(d.field),direction:Lz(d.dir)}}(u))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=h1(t,e.limit);return a!==null&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ft:n,parent:s}}function ZP(t){let e=QP(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){ye(r===1,65062);const u=n.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let i=[];n.where&&(i=function(h){const d=eM(h);return d instanceof Ye&&Mx(d)?d.getFilters():[d]}(n.where));let o=[];n.orderBy&&(o=function(h){return h.map(d=>function(g){return new ld(Pl(g.field),function(v){switch(v){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(g.direction))}(d))}(n.orderBy));let a=null;n.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,uy(d)?null:d}(n.limit));let l=null;n.startAt&&(l=function(h){const d=!!h.before,f=h.values||[];return new Nc(f,d)}(n.startAt));let c=null;return n.endAt&&(c=function(h){const d=!h.before,f=h.values||[];return new Nc(f,d)}(n.endAt)),az(e,s,o,i,a,"F",l,c)}function Dz(t,e){const n=function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return ge(28987,{purpose:s})}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function eM(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=Pl(n.unaryFilter.field);return $e.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Pl(n.unaryFilter.field);return $e.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Pl(n.unaryFilter.field);return $e.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=Pl(n.unaryFilter.field);return $e.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return ge(61313);default:return ge(60726)}}(t):t.fieldFilter!==void 0?function(n){return $e.create(Pl(n.fieldFilter.field),function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return ge(58110);default:return ge(50506)}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return Ye.create(n.compositeFilter.filters.map(r=>eM(r)),function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return ge(1026)}}(n.compositeFilter.op))}(t):ge(30097,{filter:t})}function Lz(t){return Cz[t]}function jz(t){return Iz[t]}function Vz(t){return Az[t]}function Nl(t){return{fieldPath:t.canonicalString()}}function Pl(t){return Tt.fromServerFormat(t.fieldPath)}function tM(t){return t instanceof $e?function(n){if(n.op==="=="){if(YS(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NAN"}};if(XS(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(YS(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NOT_NAN"}};if(XS(n.value))return{unaryFilter:{field:Nl(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Nl(n.field),op:jz(n.op),value:n.value}}}(t):t instanceof Ye?function(n){const r=n.getFilters().map(s=>tM(s));return r.length===1?r[0]:{compositeFilter:{op:Vz(n.op),filters:r}}}(t):ge(54877,{filter:t})}function Fz(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function nM(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,n,r,s,i=xe.min(),o=xe.min(),a=qt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new ei(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ei(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rM{constructor(e){this.yt=e}}function Bz(t,e){let n;if(e.document)n=Pz(t.yt,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=he.fromSegments(e.noDocument.path),s=qa(e.noDocument.readTime);n=Mt.newNoDocument(r,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return ge(56709);{const r=he.fromSegments(e.unknownDocument.path),s=qa(e.unknownDocument.version);n=Mt.newUnknownDocument(r,s)}}return e.readTime&&n.setReadTime(function(s){const i=new Je(s[0],s[1]);return xe.fromTimestamp(i)}(e.readTime)),n}function mk(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Pm(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(i,o){return{name:Rm(i,o.key),fields:o.data.value.mapValue.fields,updateTime:Lc(i,o.version.toTimestamp()),createTime:Lc(i,o.createTime.toTimestamp())}}(t.yt,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Wa(e.version)};else{if(!e.isUnknownDocument())return ge(57904,{document:e});r.unknownDocument={path:n.path.toArray(),version:Wa(e.version)}}return r}function Pm(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Wa(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function qa(t){const e=new Je(t.seconds,t.nanoseconds);return xe.fromTimestamp(e)}function sa(t,e){const n=(e.baseMutations||[]).map(i=>p1(t.yt,i));for(let i=0;i<e.mutations.length-1;++i){const o=e.mutations[i];if(i+1<e.mutations.length&&e.mutations[i+1].transform!==void 0){const a=e.mutations[i+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(i+1,1),++i}}const r=e.mutations.map(i=>p1(t.yt,i)),s=Je.fromMillis(e.localWriteTimeMs);return new Dx(e.batchId,s,n,r)}function Ju(t){const e=qa(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?qa(t.lastLimboFreeSnapshotVersion):xe.min();let r;return r=function(i){return i.documents!==void 0}(t.query)?function(i){const o=i.documents.length;return ye(o===1,1966,{count:o}),Lr(gy(QP(i.documents[0])))}(t.query):function(i){return Lr(ZP(i))}(t.query),new ei(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,qt.fromBase64String(t.resumeToken))}function sM(t,e){const n=Wa(e.snapshotVersion),r=Wa(e.lastLimboFreeSnapshotVersion);let s;s=Cm(e.target)?XP(t.yt,e.target):YP(t.yt,e.target).ft;const i=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Ha(e.target),readTime:n,resumeToken:i,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:s}}function iM(t){const e=ZP({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Am(e,e.limit,"L"):e}function n0(t,e){return new jx(e.largestBatchId,p1(t.yt,e.overlayMutation))}function gk(t,e){const n=e.path.lastSegment();return[t,Mn(e.path.popLast()),n]}function yk(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:Wa(r.readTime),documentKey:Mn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uz{getBundleMetadata(e,n){return vk(e).get(n).next(r=>{if(r)return function(i){return{id:i.bundleId,createTime:qa(i.createTime),version:i.version}}(r)})}saveBundleMetadata(e,n){return vk(e).put(function(s){return{bundleId:s.id,createTime:Wa(zn(s.createTime)),version:s.version}}(n))}getNamedQuery(e,n){return wk(e).get(n).next(r=>{if(r)return function(i){return{name:i.name,query:iM(i.bundledQuery),readTime:qa(i.readTime)}}(r)})}saveNamedQuery(e,n){return wk(e).put(function(s){return{name:s.name,readTime:Wa(zn(s.readTime)),bundledQuery:s.bundledQuery}}(n))}}function vk(t){return en(t,hy)}function wk(t){return en(t,dy)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class by{constructor(e,n){this.serializer=e,this.userId=n}static wt(e,n){const r=n.uid||"";return new by(e,r)}getOverlay(e,n){return Au(e).get(gk(this.userId,n)).next(r=>r?n0(this.serializer,r):null)}getOverlays(e,n){const r=Ts();return q.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){const s=[];return r.forEach((i,o)=>{const a=new jx(n,o);s.push(this.St(e,a))}),q.waitFor(s)}removeOverlaysForBatchId(e,n,r){const s=new Set;n.forEach(o=>s.add(Mn(o.getCollectionPath())));const i=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);i.push(Au(e).Z(r1,a))}),q.waitFor(i)}getOverlaysForCollection(e,n,r){const s=Ts(),i=Mn(n),o=IDBKeyRange.bound([this.userId,i,r],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Au(e).J(r1,o).next(a=>{for(const l of a){const c=n0(this.serializer,l);s.set(c.getKey(),c)}return s})}getOverlaysForCollectionGroup(e,n,r,s){const i=Ts();let o;const a=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return Au(e).ee({index:iP,range:a},(l,c,u)=>{const h=n0(this.serializer,c);i.size()<s||h.largestBatchId===o?(i.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>i)}St(e,n){return Au(e).put(function(s,i,o){const[a,l,c]=gk(i,o.mutation.key);return{userId:i,collectionPath:l,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Nm(s.yt,o.mutation)}}(this.serializer,this.userId,n))}}function Au(t){return en(t,fy)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zz{bt(e){return en(e,Ix)}getSessionToken(e){return this.bt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?qt.fromUint8Array(r):qt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.bt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ia{constructor(){}Dt(e,n){this.Ct(e,n),n.vt()}Ct(e,n){if("nullValue"in e)this.Ft(n,5);else if("booleanValue"in e)this.Ft(n,10),n.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(n,15),n.Mt(vt(e.integerValue));else if("doubleValue"in e){const r=vt(e.doubleValue);isNaN(r)?this.Ft(n,13):(this.Ft(n,15),ed(r)?n.Mt(0):n.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(n,20),typeof r=="string"&&(r=gi(r)),n.xt(`${r.seconds||""}`),n.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,n),this.Nt(n);else if("bytesValue"in e)this.Ft(n,30),n.Bt(yi(e.bytesValue)),this.Nt(n);else if("referenceValue"in e)this.Lt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(n,45),n.Mt(r.latitude||0),n.Mt(r.longitude||0)}else"mapValue"in e?yP(e)?this.Ft(n,Number.MAX_SAFE_INTEGER):my(e)?this.kt(e.mapValue,n):(this.qt(e.mapValue,n),this.Nt(n)):"arrayValue"in e?(this.Qt(e.arrayValue,n),this.Nt(n)):ge(19022,{$t:e})}Ot(e,n){this.Ft(n,25),this.Ut(e,n)}Ut(e,n){n.xt(e)}qt(e,n){const r=e.fields||{};this.Ft(n,55);for(const s of Object.keys(r))this.Ot(s,n),this.Ct(r[s],n)}kt(e,n){var o,a;const r=e.fields||{};this.Ft(n,53);const s=Ac,i=((a=(o=r[s].arrayValue)==null?void 0:o.values)==null?void 0:a.length)||0;this.Ft(n,15),n.Mt(vt(i)),this.Ot(s,n),this.Ct(r[s],n)}Qt(e,n){const r=e.values||[];this.Ft(n,50);for(const s of r)this.Ct(s,n)}Lt(e,n){this.Ft(n,37),he.fromName(e).path.forEach(r=>{this.Ft(n,60),this.Ut(r,n)})}Ft(e,n){e.Mt(n)}Nt(e){e.Mt(2)}}ia.Kt=new ia;/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law | agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES | CONDITIONS OF ANY KIND, either express | implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xl=255;function $z(t){if(t===0)return 8;let e=0;return t>>4||(e+=4,t<<=4),t>>6||(e+=2,t<<=2),t>>7||(e+=1),e}function _k(t){const e=64-function(r){let s=0;for(let i=0;i<8;++i){const o=$z(255&r[i]);if(s+=o,o!==8)break}return s}(t);return Math.ceil(e/8)}class Hz{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Wt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Gt(r.value),r=n.next();this.zt()}jt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Jt(r.value),r=n.next();this.Ht()}Yt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Gt(r);else if(r<2048)this.Gt(960|r>>>6),this.Gt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Gt(480|r>>>12),this.Gt(128|63&r>>>6),this.Gt(128|63&r);else{const s=n.codePointAt(0);this.Gt(240|s>>>18),this.Gt(128|63&s>>>12),this.Gt(128|63&s>>>6),this.Gt(128|63&s)}}this.zt()}Zt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Jt(r);else if(r<2048)this.Jt(960|r>>>6),this.Jt(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Jt(480|r>>>12),this.Jt(128|63&r>>>6),this.Jt(128|63&r);else{const s=n.codePointAt(0);this.Jt(240|s>>>18),this.Jt(128|63&s>>>12),this.Jt(128|63&s>>>6),this.Jt(128|63&s)}}this.Ht()}Xt(e){const n=this.en(e),r=_k(n);this.tn(1+r),this.buffer[this.position++]=255&r;for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=255&n[s]}nn(e){const n=this.en(e),r=_k(n);this.tn(1+r),this.buffer[this.position++]=~(255&r);for(let s=n.length-r;s<n.length;++s)this.buffer[this.position++]=~(255&n[s])}rn(){this.sn(xl),this.sn(255)}_n(){this.an(xl),this.an(255)}reset(){this.position=0}seed(e){this.tn(e.length),this.buffer.set(e,this.position),this.position+=e.length}un(){return this.buffer.slice(0,this.position)}en(e){const n=function(i){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,i,!1),new Uint8Array(o.buffer)}(e),r=!!(128&n[0]);n[0]^=r?255:128;for(let s=1;s<n.length;++s)n[s]^=r?255:0;return n}Gt(e){const n=255&e;n===0?(this.sn(0),this.sn(255)):n===xl?(this.sn(xl),this.sn(0)):this.sn(n)}Jt(e){const n=255&e;n===0?(this.an(0),this.an(255)):n===xl?(this.an(xl),this.an(0)):this.an(e)}zt(){this.sn(0),this.sn(1)}Ht(){this.an(0),this.an(1)}sn(e){this.tn(1),this.buffer[this.position++]=e}an(e){this.tn(1),this.buffer[this.position++]=~e}tn(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const s=new Uint8Array(r);s.set(this.buffer),this.buffer=s}}class Wz{constructor(e){this.cn=e}Bt(e){this.cn.Wt(e)}xt(e){this.cn.Yt(e)}Mt(e){this.cn.Xt(e)}vt(){this.cn.rn()}}class qz{constructor(e){this.cn=e}Bt(e){this.cn.jt(e)}xt(e){this.cn.Zt(e)}Mt(e){this.cn.nn(e)}vt(){this.cn._n()}}class Ru{constructor(){this.cn=new Hz,this.ln=new Wz(this.cn),this.hn=new qz(this.cn)}seed(e){this.cn.seed(e)}Pn(e){return e===0?this.ln:this.hn}un(){return this.cn.un()}reset(){this.cn.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,n,r,s){this.Tn=e,this.In=n,this.En=r,this.dn=s}An(){const e=this.dn.length,n=e===0||this.dn[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.dn,0),n!==e?r.set([0],this.dn.length):++r[r.length-1],new oa(this.Tn,this.In,this.En,r)}Rn(e,n,r){return{indexId:this.Tn,uid:e,arrayValue:Mp(this.En),directionalValue:Mp(this.dn),orderedDocumentKey:Mp(n),documentKey:r.path.toArray()}}Vn(e,n,r){const s=this.Rn(e,n,r);return[s.indexId,s.uid,s.arrayValue,s.directionalValue,s.orderedDocumentKey,s.documentKey]}}function Pi(t,e){let n=t.Tn-e.Tn;return n!==0?n:(n=xk(t.En,e.En),n!==0?n:(n=xk(t.dn,e.dn),n!==0?n:he.comparator(t.In,e.In)))}function xk(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}function Mp(t){return P2()?function(n){let r="";for(let s=0;s<n.length;s++)r+=String.fromCharCode(n[s]);return r}(t):t}function bk(t){return typeof t!="string"?t:function(n){const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}(t)}class Tk{constructor(e){this.mn=new et((n,r)=>Tt.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.fn=e.orderBy,this.gn=[];for(const n of e.filters){const r=n;r.isInequality()?this.mn=this.mn.add(r):this.gn.push(r)}}get pn(){return this.mn.size>1}yn(e){if(ye(e.collectionGroup===this.collectionId,49279),this.pn)return!1;const n=e1(e);if(n!==void 0&&!this.wn(n))return!1;const r=ta(e);let s=new Set,i=0,o=0;for(;i<r.length&&this.wn(r[i]);++i)s=s.add(r[i].fieldPath.canonicalString());if(i===r.length)return!0;if(this.mn.size>0){const a=this.mn.getIterator().getNext();if(!s.has(a.field.canonicalString())){const l=r[i];if(!this.Sn(a,l)||!this.bn(this.fn[o++],l))return!1}++i}for(;i<r.length;++i){const a=r[i];if(o>=this.fn.length||!this.bn(this.fn[o++],a))return!1}return!0}Dn(){if(this.pn)return null;let e=new et(Tt.comparator);const n=[];for(const r of this.gn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new Sp(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new Sp(r.field,0))}for(const r of this.fn)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new Sp(r.field,r.dir==="asc"?0:1)));return new bm(bm.UNKNOWN_ID,this.collectionId,n,Zh.empty())}wn(e){for(const n of this.gn)if(this.Sn(n,e))return!0;return!1}Sn(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}bn(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oM(t){var n,r;if(ye(t instanceof $e||t instanceof Ye,20012),t instanceof $e){if(t instanceof kP){const s=((r=(n=t.value.arrayValue)==null?void 0:n.values)==null?void 0:r.map(i=>$e.create(t.field,"==",i)))||[];return Ye.create(s,"or")}return t}const e=t.filters.map(s=>oM(s));return Ye.create(e,t.op)}function Kz(t){if(t.getFilters().length===0)return[];const e=y1(oM(t));return ye(aM(e),7391),m1(e)||g1(e)?[e]:e.getFilters()}function m1(t){return t instanceof $e}function g1(t){return t instanceof Ye&&Mx(t)}function aM(t){return m1(t)||g1(t)||function(n){if(n instanceof Ye&&a1(n)){for(const r of n.getFilters())if(!m1(r)&&!g1(r))return!1;return!0}return!1}(t)}function y1(t){if(ye(t instanceof $e||t instanceof Ye,34018),t instanceof $e)return t;if(t.filters.length===1)return y1(t.filters[0]);const e=t.filters.map(r=>y1(r));let n=Ye.create(e,t.op);return n=Mm(n),aM(n)?n:(ye(n instanceof Ye,64498),ye(Pc(n),40251),ye(n.filters.length>1,57927),n.filters.reduce((r,s)=>Bx(r,s)))}function Bx(t,e){let n;return ye(t instanceof $e||t instanceof Ye,38388),ye(e instanceof $e||e instanceof Ye,25473),n=t instanceof $e?e instanceof $e?function(s,i){return Ye.create([s,i],"and")}(t,e):Ek(t,e):e instanceof $e?Ek(e,t):function(s,i){if(ye(s.filters.length>0&&i.filters.length>0,48005),Pc(s)&&Pc(i))return TP(s,i.getFilters());const o=a1(s)?s:i,a=a1(s)?i:s,l=o.filters.map(c=>Bx(c,a));return Ye.create(l,"or")}(t,e),Mm(n)}function Ek(t,e){if(Pc(e))return TP(e,t.getFilters());{const n=e.filters.map(r=>Bx(t,r));return Ye.create(n,"or")}}function Mm(t){if(ye(t instanceof $e||t instanceof Ye,11850),t instanceof $e)return t;const e=t.getFilters();if(e.length===1)return Mm(e[0]);if(xP(t))return t;const n=e.map(s=>Mm(s)),r=[];return n.forEach(s=>{s instanceof $e?r.push(s):s instanceof Ye&&(s.op===t.op?r.push(...s.filters):r.push(s))}),r.length===1?r[0]:Ye.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gz{constructor(){this.Cn=new Ux}addToCollectionParentIndex(e,n){return this.Cn.add(n),q.resolve()}getCollectionParents(e,n){return q.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return q.resolve()}deleteFieldIndex(e,n){return q.resolve()}deleteAllFieldIndexes(e){return q.resolve()}createTargetIndexes(e,n){return q.resolve()}getDocumentsMatchingTarget(e,n){return q.resolve(null)}getIndexType(e,n){return q.resolve(0)}getFieldIndexes(e,n){return q.resolve([])}getNextCollectionGroupToUpdate(e){return q.resolve(null)}getMinOffset(e,n){return q.resolve(wr.min())}getMinOffsetFromCollectionGroup(e,n){return q.resolve(wr.min())}updateCollectionGroup(e,n,r){return q.resolve()}updateIndexEntries(e,n){return q.resolve()}}class Ux{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n]||new et(Ge.comparator),i=!s.has(r);return this.index[n]=s.add(r),i}has(e){const n=e.lastSegment(),r=e.popLast(),s=this.index[n];return s&&s.has(r)}getEntries(e){return(this.index[e]||new et(Ge.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sk="IndexedDbIndexManager",Lf=new Uint8Array(0);class Qz{constructor(e,n){this.databaseId=n,this.vn=new Ux,this.Fn=new xi(r=>Ha(r),(r,s)=>jd(r,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.vn.has(n)){const r=n.lastSegment(),s=n.popLast();e.addOnCommittedListener(()=>{this.vn.add(n)});const i={collectionId:r,parent:Mn(s)};return kk(e).put(i)}return q.resolve()}getCollectionParents(e,n){const r=[],s=IDBKeyRange.bound([n,""],[K2(n),""],!1,!0);return kk(e).J(s).next(i=>{for(const o of i){if(o.collectionId!==n)break;r.push(bs(o.parent))}return r})}addFieldIndex(e,n){const r=Nu(e),s=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(n);delete s.indexId;const i=r.add(s);if(n.indexState){const o=Tl(e);return i.next(a=>{o.put(yk(a,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return i.next()}deleteFieldIndex(e,n){const r=Nu(e),s=Tl(e),i=bl(e);return r.delete(n.indexId).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=Nu(e),r=bl(e),s=Tl(e);return n.Z().next(()=>r.Z()).next(()=>s.Z())}createTargetIndexes(e,n){return q.forEach(this.Mn(n),r=>this.getIndexType(e,r).next(s=>{if(s===0||s===1){const i=new Tk(r).Dn();if(i!=null)return this.addFieldIndex(e,i)}}))}getDocumentsMatchingTarget(e,n){const r=bl(e);let s=!0;const i=new Map;return q.forEach(this.Mn(n),o=>this.xn(e,o).next(a=>{s&&(s=!!a),i.set(o,a)})).next(()=>{if(s){let o=Ve();const a=[];return q.forEach(i,(l,c)=>{se(Sk,`Using index ${function(E){return`id=${E.indexId}|cg=${E.collectionGroup}|f=${E.fields.map(R=>`${R.fieldPath}:${R.kind}`).join(",")}`}(l)} to execute ${Ha(n)}`);const u=function(E,R){const P=e1(R);if(P===void 0)return null;for(const N of Im(E,P.fieldPath))switch(N.op){case"array-contains-any":return N.value.arrayValue.values||[];case"array-contains":return[N.value]}return null}(c,l),h=function(E,R){const P=new Map;for(const N of ta(R))for(const k of Im(E,N.fieldPath))switch(k.op){case"==":case"in":P.set(N.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return P.set(N.fieldPath.canonicalString(),k.value),Array.from(P.values())}return null}(c,l),d=function(E,R){const P=[];let N=!0;for(const k of ta(R)){const _=k.kind===0?rk(E,k.fieldPath,E.startAt):sk(E,k.fieldPath,E.startAt);P.push(_.value),N&&(N=_.inclusive)}return new Nc(P,N)}(c,l),f=function(E,R){const P=[];let N=!0;for(const k of ta(R)){const _=k.kind===0?sk(E,k.fieldPath,E.endAt):rk(E,k.fieldPath,E.endAt);P.push(_.value),N&&(N=_.inclusive)}return new Nc(P,N)}(c,l),g=this.On(l,c,d),y=this.On(l,c,f),v=this.Nn(l,c,h),w=this.Bn(l.indexId,u,g,d.inclusive,y,f.inclusive,v);return q.forEach(w,T=>r.Y(T,n.limit).next(E=>{E.forEach(R=>{const P=he.fromSegments(R.documentKey);o.has(P)||(o=o.add(P),a.push(P))})}))}).next(()=>a)}return q.resolve(null)})}Mn(e){let n=this.Fn.get(e);return n||(e.filters.length===0?n=[e]:n=Kz(Ye.create(e.filters,"and")).map(r=>c1(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Fn.set(e,n),n)}Bn(e,n,r,s,i,o,a){const l=(n!=null?n.length:1)*Math.max(r.length,i.length),c=l/(n!=null?n.length:1),u=[];for(let h=0;h<l;++h){const d=n?this.Ln(n[h/c]):Lf,f=this.kn(e,d,r[h%c],s),g=this.qn(e,d,i[h%c],o),y=a.map(v=>this.kn(e,d,v,!0));u.push(...this.createRange(f,g,y))}return u}kn(e,n,r,s){const i=new oa(e,he.empty(),n,r);return s?i:i.An()}qn(e,n,r,s){const i=new oa(e,he.empty(),n,r);return s?i.An():i}xn(e,n){const r=new Tk(n),s=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,s).next(i=>{let o=null;for(const a of i)r.yn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,n){let r=2;const s=this.Mn(n);return q.forEach(s,i=>this.xn(e,i).next(o=>{o?r!==0&&o.fields.length<function(l){let c=new et(Tt.comparator),u=!1;for(const h of l.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?u=!0:c=c.add(d.field));for(const h of l.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(u?1:0)}(i)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(n)&&s.length>1&&r===2?1:r)}Qn(e,n){const r=new Ru;for(const s of ta(e)){const i=n.data.field(s.fieldPath);if(i==null)return null;const o=r.Pn(s.kind);ia.Kt.Dt(i,o)}return r.un()}Ln(e){const n=new Ru;return ia.Kt.Dt(e,n.Pn(0)),n.un()}$n(e,n){const r=new Ru;return ia.Kt.Dt(od(this.databaseId,n),r.Pn(function(i){const o=ta(i);return o.length===0?0:o[o.length-1].kind}(e))),r.un()}Nn(e,n,r){if(r===null)return[];let s=[];s.push(new Ru);let i=0;for(const o of ta(e)){const a=r[i++];for(const l of s)if(this.Un(n,o.fieldPath)&&ad(a))s=this.Kn(s,o,a);else{const c=l.Pn(o.kind);ia.Kt.Dt(a,c)}}return this.Wn(s)}On(e,n,r){return this.Nn(e,n,r.position)}Wn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].un();return n}Kn(e,n,r){const s=[...e],i=[];for(const o of r.arrayValue.values||[])for(const a of s){const l=new Ru;l.seed(a.un()),ia.Kt.Dt(o,l.Pn(n.kind)),i.push(l)}return i}Un(e,n){return!!e.filters.find(r=>r instanceof $e&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=Nu(e),s=Tl(e);return(n?r.J(n1,IDBKeyRange.bound(n,n)):r.J()).next(i=>{const o=[];return q.forEach(i,a=>s.get([a.indexId,this.uid]).next(l=>{o.push(function(u,h){const d=h?new Zh(h.sequenceNumber,new wr(qa(h.readTime),new he(bs(h.documentKey)),h.largestBatchId)):Zh.empty(),f=u.fields.map(([g,y])=>new Sp(Tt.fromServerFormat(g),y));return new bm(u.indexId,u.collectionGroup,f,d)}(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,s)=>{const i=r.indexState.sequenceNumber-s.indexState.sequenceNumber;return i!==0?i:Ne(r.collectionGroup,s.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const s=Nu(e),i=Tl(e);return this.Gn(e).next(o=>s.J(n1,IDBKeyRange.bound(n,n)).next(a=>q.forEach(a,l=>i.put(yk(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,n){const r=new Map;return q.forEach(n,(s,i)=>{const o=r.get(s.collectionGroup);return(o?q.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(r.set(s.collectionGroup,a),q.forEach(a,l=>this.zn(e,s,l).next(c=>{const u=this.jn(i,l);return c.isEqual(u)?q.resolve():this.Jn(e,i,l,c,u)}))))})}Hn(e,n,r,s){return bl(e).put(s.Rn(this.uid,this.$n(r,n.key),n.key))}Yn(e,n,r,s){return bl(e).delete(s.Vn(this.uid,this.$n(r,n.key),n.key))}zn(e,n,r){const s=bl(e);let i=new et(Pi);return s.ee({index:sP,range:IDBKeyRange.only([r.indexId,this.uid,Mp(this.$n(r,n))])},(o,a)=>{i=i.add(new oa(r.indexId,n,bk(a.arrayValue),bk(a.directionalValue)))}).next(()=>i)}jn(e,n){let r=new et(Pi);const s=this.Qn(n,e);if(s==null)return r;const i=e1(n);if(i!=null){const o=e.data.field(i.fieldPath);if(ad(o))for(const a of o.arrayValue.values||[])r=r.add(new oa(n.indexId,e.key,this.Ln(a),s))}else r=r.add(new oa(n.indexId,e.key,Lf,s));return r}Jn(e,n,r,s,i){se(Sk,"Updating index entries for document '%s'",n.key);const o=[];return function(l,c,u,h,d){const f=l.getIterator(),g=c.getIterator();let y=_l(f),v=_l(g);for(;y||v;){let w=!1,T=!1;if(y&&v){const E=u(y,v);E<0?T=!0:E>0&&(w=!0)}else y!=null?T=!0:w=!0;w?(h(v),v=_l(g)):T?(d(y),y=_l(f)):(y=_l(f),v=_l(g))}}(s,i,Pi,a=>{o.push(this.Hn(e,n,r,a))},a=>{o.push(this.Yn(e,n,r,a))}),q.waitFor(o)}Gn(e){let n=1;return Tl(e).ee({index:rP,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,s,i)=>{i.done(),n=s.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((o,a)=>Pi(o,a)).filter((o,a,l)=>!a||Pi(o,l[a-1])!==0);const s=[];s.push(e);for(const o of r){const a=Pi(o,e),l=Pi(o,n);if(a===0)s[0]=e.An();else if(a>0&&l<0)s.push(o),s.push(o.An());else if(l>0)break}s.push(n);const i=[];for(let o=0;o<s.length;o+=2){if(this.Zn(s[o],s[o+1]))return[];const a=s[o].Vn(this.uid,Lf,he.empty()),l=s[o+1].Vn(this.uid,Lf,he.empty());i.push(IDBKeyRange.bound(a,l))}return i}Zn(e,n){return Pi(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(Ck)}getMinOffset(e,n){return q.mapArray(this.Mn(n),r=>this.xn(e,r).next(s=>s||ge(44426))).next(Ck)}}function kk(t){return en(t,rd)}function bl(t){return en(t,gh)}function Nu(t){return en(t,Cx)}function Tl(t){return en(t,mh)}function Ck(t){ye(t.length!==0,28825);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const s=t[r].indexState.offset;Ex(s,e)<0&&(e=s),n<s.largestBatchId&&(n=s.largestBatchId)}return new wr(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ik={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},lM=41943040;class An{static withCacheSize(e){return new An(e,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cM(t,e,n){const r=t.store(Xr),s=t.store(Sc),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const l=r.ee({range:o},(u,h,d)=>(a++,d.delete()));i.push(l.next(()=>{ye(a===1,47070,{batchId:n.batchId})}));const c=[];for(const u of n.mutations){const h=eP(e,u.key.path,n.batchId);i.push(s.delete(h)),c.push(u.key)}return q.waitFor(i).next(()=>c)}function Om(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw ge(14731);e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */An.DEFAULT_COLLECTION_PERCENTILE=10,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,An.DEFAULT=new An(lM,An.DEFAULT_COLLECTION_PERCENTILE,An.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),An.DISABLED=new An(-1,0,0);class Ty{constructor(e,n,r,s){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=s,this.Xn={}}static wt(e,n,r,s){ye(e.uid!=="",64387);const i=e.isAuthenticated()?e.uid:"";return new Ty(i,n,r,s)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).ee({index:fa,range:r},(s,i,o)=>{n=!1,o.done()}).next(()=>n)}addMutationBatch(e,n,r,s){const i=Ml(e),o=Mi(e);return o.add({}).next(a=>{ye(typeof a=="number",49019);const l=new Dx(a,n,r,s),c=function(f,g,y){const v=y.baseMutations.map(T=>Nm(f.yt,T)),w=y.mutations.map(T=>Nm(f.yt,T));return{userId:g,batchId:y.batchId,localWriteTimeMs:y.localWriteTime.toMillis(),baseMutations:v,mutations:w}}(this.serializer,this.userId,l),u=[];let h=new et((d,f)=>Ne(d.canonicalString(),f.canonicalString()));for(const d of s){const f=eP(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(c)),u.push(i.put(f,SU))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Xn[a]=l.keys()}),q.waitFor(u).next(()=>l)})}lookupMutationBatch(e,n){return Mi(e).get(n).next(r=>r?(ye(r.userId===this.userId,48,"Unexpected user for mutation batch",{userId:r.userId,batchId:n}),sa(this.serializer,r)):null)}er(e,n){return this.Xn[n]?q.resolve(this.Xn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const s=r.keys();return this.Xn[n]=s,s}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=IDBKeyRange.lowerBound([this.userId,r]);let i=null;return Mi(e).ee({index:fa,range:s},(o,a,l)=>{a.userId===this.userId&&(ye(a.batchId>=r,47524,{tr:r}),i=sa(this.serializer,a)),l.done()}).next(()=>i)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=Ta;return Mi(e).ee({index:fa,range:n,reverse:!0},(s,i,o)=>{r=i.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,Ta],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).J(fa,n).next(r=>r.map(s=>sa(this.serializer,s)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=kp(this.userId,n.path),s=IDBKeyRange.lowerBound(r),i=[];return Ml(e).ee({range:s},(o,a,l)=>{const[c,u,h]=o,d=bs(u);if(c===this.userId&&n.path.isEqual(d))return Mi(e).get(h).next(f=>{if(!f)throw ge(61480,{nr:o,batchId:h});ye(f.userId===this.userId,10503,"Unexpected user for mutation batch",{userId:f.userId,batchId:h}),i.push(sa(this.serializer,f))});l.done()}).next(()=>i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new et(Ne);const s=[];return n.forEach(i=>{const o=kp(this.userId,i.path),a=IDBKeyRange.lowerBound(o),l=Ml(e).ee({range:a},(c,u,h)=>{const[d,f,g]=c,y=bs(f);d===this.userId&&i.path.isEqual(y)?r=r.add(g):h.done()});s.push(l)}),q.waitFor(s).next(()=>this.rr(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1,i=kp(this.userId,r),o=IDBKeyRange.lowerBound(i);let a=new et(Ne);return Ml(e).ee({range:o},(l,c,u)=>{const[h,d,f]=l,g=bs(d);h===this.userId&&r.isPrefixOf(g)?g.length===s&&(a=a.add(f)):u.done()}).next(()=>this.rr(e,a))}rr(e,n){const r=[],s=[];return n.forEach(i=>{s.push(Mi(e).get(i).next(o=>{if(o===null)throw ge(35274,{batchId:i});ye(o.userId===this.userId,9748,"Unexpected user for mutation batch",{userId:o.userId,batchId:i}),r.push(sa(this.serializer,o))}))}),q.waitFor(s).next(()=>r)}removeMutationBatch(e,n){return cM(e.le,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.ir(n.batchId)}),q.forEach(r,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}ir(e){delete this.Xn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return q.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),s=[];return Ml(e).ee({range:r},(i,o,a)=>{if(i[0]===this.userId){const l=bs(i[1]);s.push(l)}else a.done()}).next(()=>{ye(s.length===0,56720,{sr:s.map(i=>i.canonicalString())})})})}containsKey(e,n){return uM(e,this.userId,n)}_r(e){return hM(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:Ta,lastStreamToken:""})}}function uM(t,e,n){const r=kp(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Ml(t).ee({range:i,X:!0},(a,l,c)=>{const[u,h,d]=a;u===e&&h===s&&(o=!0),c.done()}).next(()=>o)}function Mi(t){return en(t,Xr)}function Ml(t){return en(t,Sc)}function hM(t){return en(t,td)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ka{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Ka(0)}static cr(){return new Ka(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jz{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.lr(e).next(n=>{const r=new Ka(n.highestTargetId);return n.highestTargetId=r.next(),this.hr(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.lr(e).next(n=>xe.fromTimestamp(new Je(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.lr(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.lr(e).next(s=>(s.highestListenSequenceNumber=n,r&&(s.lastRemoteSnapshotVersion=r.toTimestamp()),n>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=n),this.hr(e,s)))}addTargetData(e,n){return this.Pr(e,n).next(()=>this.lr(e).next(r=>(r.targetCount+=1,this.Tr(n,r),this.hr(e,r))))}updateTargetData(e,n){return this.Pr(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>El(e).delete(n.targetId)).next(()=>this.lr(e)).next(r=>(ye(r.targetCount>0,8065),r.targetCount-=1,this.hr(e,r)))}removeTargets(e,n,r){let s=0;const i=[];return El(e).ee((o,a)=>{const l=Ju(a);l.sequenceNumber<=n&&r.get(l.targetId)===null&&(s++,i.push(this.removeTargetData(e,l)))}).next(()=>q.waitFor(i)).next(()=>s)}forEachTarget(e,n){return El(e).ee((r,s)=>{const i=Ju(s);n(i)})}lr(e){return Ak(e).get(Sm).next(n=>(ye(n!==null,2888),n))}hr(e,n){return Ak(e).put(Sm,n)}Pr(e,n){return El(e).put(sM(this.serializer,n))}Tr(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.lr(e).next(n=>n.targetCount)}getTargetData(e,n){const r=Ha(n),s=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let i=null;return El(e).ee({range:s,index:nP},(o,a,l)=>{const c=Ju(a);jd(n,c.target)&&(i=c,l.done())}).next(()=>i)}addMatchingKeys(e,n,r){const s=[],i=Ki(e);return n.forEach(o=>{const a=Mn(o.path);s.push(i.put({targetId:r,path:a})),s.push(this.referenceDelegate.addReference(e,r,o))}),q.waitFor(s)}removeMatchingKeys(e,n,r){const s=Ki(e);return q.forEach(n,i=>{const o=Mn(i.path);return q.waitFor([s.delete([r,o]),this.referenceDelegate.removeReference(e,r,i)])})}removeMatchingKeysForTargetId(e,n){const r=Ki(e),s=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(s)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),s=Ki(e);let i=Ve();return s.ee({range:r,X:!0},(o,a,l)=>{const c=bs(o[1]),u=new he(c);i=i.add(u)}).next(()=>i)}containsKey(e,n){const r=Mn(n.path),s=IDBKeyRange.bound([r],[K2(r)],!1,!0);let i=0;return Ki(e).ee({index:kx,X:!0,range:s},([o,a],l,c)=>{o!==0&&(i++,c.done())}).next(()=>i>0)}At(e,n){return El(e).get(n).next(r=>r?Ju(r):null)}}function El(t){return en(t,kc)}function Ak(t){return en(t,Ea)}function Ki(t){return en(t,Cc)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk="LruGarbageCollector",Xz=1048576;function Nk([t,e],[n,r]){const s=Ne(t,n);return s===0?Ne(e,r):s}class Yz{constructor(e){this.Ir=e,this.buffer=new et(Nk),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();Nk(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class dM{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){se(Rk,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Vo(n)?se(Rk,"Ignoring IndexedDB error during garbage collection: ",n):await cl(n)}await this.Vr(3e5)})}}class Zz{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return q.resolve(Or.ce);const r=new Yz(n);return this.mr.forEachTarget(e,s=>r.Ar(s.sequenceNumber)).next(()=>this.mr.pr(e,s=>r.Ar(s))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.mr.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(se("LruGarbageCollector","Garbage collection skipped; disabled"),q.resolve(Ik)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(se("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ik):this.yr(e,n))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let r,s,i,o,a,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(se("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,n))).next(h=>(i=h,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),Al()<=ze.DEBUG&&se("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${i} targets in `+(l-a)+`ms
	Removed ${h} documents in `+(c-l)+`ms
Total Duration: ${c-u}ms`),q.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:i,documentsRemoved:h})))}}function fM(t,e){return new Zz(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class e${constructor(e,n){this.db=e,this.garbageCollector=fM(this,n)}gr(e){const n=this.wr(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}pr(e,n){return this.Sr(e,(r,s)=>n(s))}addReference(e,n,r){return jf(e,r)}removeReference(e,n,r){return jf(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return jf(e,n)}br(e,n){return function(s,i){let o=!1;return hM(s).te(a=>uM(s,a,i).next(l=>(l&&(o=!0),q.resolve(!l)))).next(()=>o)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let i=0;return this.Sr(e,(o,a)=>{if(a<=n){const l=this.br(e,o).next(c=>{if(!c)return i++,r.getEntry(e,o).next(()=>(r.removeEntry(o,xe.min()),Ki(e).delete(function(h){return[0,Mn(h.path)]}(o))))});s.push(l)}}).next(()=>q.waitFor(s)).next(()=>r.apply(e)).next(()=>i)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return jf(e,n)}Sr(e,n){const r=Ki(e);let s,i=Or.ce;return r.ee({index:kx},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Or.ce&&n(new he(bs(s)),i),i=c,s=l):i=Or.ce}).next(()=>{i!==Or.ce&&n(new he(bs(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function jf(t,e){return Ki(t).put(function(r,s){return{targetId:0,path:Mn(r.path),sequenceNumber:s}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pM{constructor(){this.changes=new xi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Mt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?q.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class t${constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Jo(e).put(r)}removeEntry(e,n,r){return Jo(e).delete(function(i,o){const a=i.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Pm(o),a[a.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.Dr(e,r)))}getEntry(e,n){let r=Mt.newInvalidDocument(n);return Jo(e).ee({index:Cp,range:IDBKeyRange.only(Pu(n))},(s,i)=>{r=this.Cr(n,i)}).next(()=>r)}vr(e,n){let r={size:0,document:Mt.newInvalidDocument(n)};return Jo(e).ee({index:Cp,range:IDBKeyRange.only(Pu(n))},(s,i)=>{r={document:this.Cr(n,i),size:Om(i)}}).next(()=>r)}getEntries(e,n){let r=pr();return this.Fr(e,n,(s,i)=>{const o=this.Cr(s,i);r=r.insert(s,o)}).next(()=>r)}Mr(e,n){let r=pr(),s=new _t(he.comparator);return this.Fr(e,n,(i,o)=>{const a=this.Cr(i,o);r=r.insert(i,a),s=s.insert(i,Om(o))}).next(()=>({documents:r,Or:s}))}Fr(e,n,r){if(n.isEmpty())return q.resolve();let s=new et(Ok);n.forEach(l=>s=s.add(l));const i=IDBKeyRange.bound(Pu(s.first()),Pu(s.last())),o=s.getIterator();let a=o.getNext();return Jo(e).ee({index:Cp,range:i},(l,c,u)=>{const h=he.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&Ok(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.j(Pu(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,n,r,s,i){const o=n.path,a=[o.popLast().toArray(),o.lastSegment(),Pm(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Jo(e).J(IDBKeyRange.bound(a,l,!0)).next(c=>{i==null||i.incrementDocumentReadCount(c.length);let u=pr();for(const h of c){const d=this.Cr(he.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(Vd(n,d)||s.has(d.key))&&(u=u.insert(d.key,d))}return u})}getAllFromCollectionGroup(e,n,r,s){let i=pr();const o=Mk(n,r),a=Mk(n,wr.max());return Jo(e).ee({index:tP,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{const h=this.Cr(he.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);i=i.insert(h.key,h),i.size===s&&u.done()}).next(()=>i)}newChangeBuffer(e){return new n$(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return Pk(e).get(t1).next(n=>(ye(!!n,20021),n))}Dr(e,n){return Pk(e).put(t1,n)}Cr(e,n){if(n){const r=Bz(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(xe.min())))return r}return Mt.newInvalidDocument(e)}}function mM(t){return new t$(t)}class n$ extends pM{constructor(e,n){super(),this.Nr=e,this.trackRemovals=n,this.Br=new xi(r=>r.toString(),(r,s)=>r.isEqual(s))}applyChanges(e){const n=[];let r=0,s=new et((i,o)=>Ne(i.canonicalString(),o.canonicalString()));return this.changes.forEach((i,o)=>{const a=this.Br.get(i);if(n.push(this.Nr.removeEntry(e,i,a.readTime)),o.isValidDocument()){const l=mk(this.Nr.serializer,o);s=s.add(i.path.popLast());const c=Om(l);r+=c-a.size,n.push(this.Nr.addEntry(e,i,l))}else if(r-=a.size,this.trackRemovals){const l=mk(this.Nr.serializer,o.convertToNoDocument(xe.min()));n.push(this.Nr.addEntry(e,i,l))}}),s.forEach(i=>{n.push(this.Nr.indexManager.addToCollectionParentIndex(e,i))}),n.push(this.Nr.updateMetadata(e,r)),q.waitFor(n)}getFromCache(e,n){return this.Nr.vr(e,n).next(r=>(this.Br.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.Nr.Mr(e,n).next(({documents:r,Or:s})=>(s.forEach((i,o)=>{this.Br.set(i,{size:o,readTime:r.get(i).readTime})}),r))}}function Pk(t){return en(t,nd)}function Jo(t){return en(t,Em)}function Pu(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Mk(t,e){const n=e.documentKey.path.toArray();return[t,Pm(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Ok(t,e){const n=t.path.toArray(),r=e.path.toArray();let s=0;for(let i=0;i<n.length-2&&i<r.length-2;++i)if(s=Ne(n[i],r[i]),s)return s;return s=Ne(n.length,r.length),s||(s=Ne(n[n.length-2],r[r.length-2]),s||Ne(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class r${constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gM{constructor(e,n,r,s){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=s}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(s=>(r=s,this.remoteDocumentCache.getEntry(e,n))).next(s=>(r!==null&&_h(r.mutation,s,tr.empty(),Je.now()),s))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Ve()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Ve()){const s=Ts();return this.populateOverlays(e,s,n).next(()=>this.computeViews(e,n,s,r).next(i=>{let o=Gu();return i.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,n){const r=Ts();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Ve()))}populateOverlays(e,n,r){const s=[];return r.forEach(i=>{n.has(i)||s.push(i)}),this.documentOverlayCache.getOverlays(e,s).next(i=>{i.forEach((o,a)=>{n.set(o,a)})})}computeViews(e,n,r,s){let i=pr();const o=wh(),a=function(){return wh()}();return n.forEach((l,c)=>{const u=r.get(c.key);s.has(c.key)&&(u===void 0||u.mutation instanceof bi)?i=i.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),_h(u.mutation,c,u.mutation.getFieldMask(),Je.now())):o.set(c.key,tr.empty())}),this.recalculateAndSaveOverlays(e,i).next(l=>(l.forEach((c,u)=>o.set(c,u)),n.forEach((c,u)=>a.set(c,new r$(u,o.get(c)??null))),a))}recalculateAndSaveOverlays(e,n){const r=wh();let s=new _t((o,a)=>o-a),i=Ve();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(o=>{for(const a of o)a.keys().forEach(l=>{const c=n.get(l);if(c===null)return;let u=r.get(l)||tr.empty();u=a.applyToLocalView(c,u),r.set(l,u);const h=(s.get(a.batchId)||Ve()).add(l);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),c=l.key,u=l.value,h=PP();u.forEach(d=>{if(!i.has(d)){const f=BP(n.get(d),r.get(d));f!==null&&h.set(d,f),i=i.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return q.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,s){return function(o){return he.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):CP(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,s):this.getDocumentsMatchingCollectionQuery(e,n,r,s)}getNextDocuments(e,n,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,s).next(i=>{const o=s-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,s-i.size):q.resolve(Ts());let a=Yh,l=i;return o.next(c=>q.forEach(c,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),i.get(u)?q.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{l=l.insert(u,d)}))).next(()=>this.populateOverlays(e,c,i)).next(()=>this.computeViews(e,l,c,Ve())).next(u=>({batchId:a,changes:NP(u)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new he(n)).next(r=>{let s=Gu();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s})}getDocumentsMatchingCollectionGroupQuery(e,n,r,s){const i=n.collectionGroup;let o=Gu();return this.indexManager.getCollectionParents(e,i).next(a=>q.forEach(a,l=>{const c=function(h,d){return new Zc(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(n,l.child(i));return this.getDocumentsMatchingCollectionQuery(e,c,r,s).next(u=>{u.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,n,r,s){let i;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(o=>(i=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,i,s))).next(o=>{i.forEach((l,c)=>{const u=c.getKey();o.get(u)===null&&(o=o.insert(u,Mt.newInvalidDocument(u)))});let a=Gu();return o.forEach((l,c)=>{const u=i.get(l);u!==void 0&&_h(u.mutation,c,tr.empty(),Je.now()),Vd(n,c)&&(a=a.insert(l,c))}),a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class s${constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return q.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,function(s){return{id:s.id,version:s.version,createTime:zn(s.createTime)}}(n)),q.resolve()}getNamedQuery(e,n){return q.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,function(s){return{name:s.name,query:iM(s.bundledQuery),readTime:zn(s.readTime)}}(n)),q.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i${constructor(){this.overlays=new _t(he.comparator),this.qr=new Map}getOverlay(e,n){return q.resolve(this.overlays.get(n))}getOverlays(e,n){const r=Ts();return q.forEach(n,s=>this.getOverlay(e,s).next(i=>{i!==null&&r.set(s,i)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((s,i)=>{this.St(e,n,i)}),q.resolve()}removeOverlaysForBatchId(e,n,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach(i=>this.overlays=this.overlays.remove(i)),this.qr.delete(r)),q.resolve()}getOverlaysForCollection(e,n,r){const s=Ts(),i=n.length+1,o=new he(n.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,c=l.getKey();if(!n.isPrefixOf(c.path))break;c.path.length===i&&l.largestBatchId>r&&s.set(l.getKey(),l)}return q.resolve(s)}getOverlaysForCollectionGroup(e,n,r,s){let i=new _t((c,u)=>c-u);const o=this.overlays.getIterator();for(;o.hasNext();){const c=o.getNext().value;if(c.getKey().getCollectionGroup()===n&&c.largestBatchId>r){let u=i.get(c.largestBatchId);u===null&&(u=Ts(),i=i.insert(c.largestBatchId,u)),u.set(c.getKey(),c)}}const a=Ts(),l=i.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((c,u)=>a.set(c,u)),!(a.size()>=s)););return q.resolve(a)}St(e,n,r){const s=this.overlays.get(r.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new jx(n,r));let i=this.qr.get(n);i===void 0&&(i=Ve(),this.qr.set(n,i)),this.qr.set(n,i.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class o${constructor(){this.sessionToken=qt.EMPTY_BYTE_STRING}getSessionToken(e){return q.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,q.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zx{constructor(){this.Qr=new et(rn.$r),this.Ur=new et(rn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const r=new rn(e,n);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Gr(new rn(e,n))}zr(e,n){e.forEach(r=>this.removeReference(r,n))}jr(e){const n=new he(new Ge([])),r=new rn(n,e),s=new rn(n,e+1),i=[];return this.Ur.forEachInRange([r,s],o=>{this.Gr(o),i.push(o.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new he(new Ge([])),r=new rn(n,e),s=new rn(n,e+1);let i=Ve();return this.Ur.forEachInRange([r,s],o=>{i=i.add(o.key)}),i}containsKey(e){const n=new rn(e,0),r=this.Qr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class rn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return he.comparator(e.key,n.key)||Ne(e.Yr,n.Yr)}static Kr(e,n){return Ne(e.Yr,n.Yr)||he.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class a${constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new et(rn.$r)}checkEmpty(e){return q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,s){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Dx(i,n,r,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new rn(a.key,i)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return q.resolve(o)}lookupMutationBatch(e,n){return q.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,s=this.ei(r),i=s<0?0:s;return q.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return q.resolve(this.mutationQueue.length===0?Ta:this.tr-1)}getAllMutationBatches(e){return q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new rn(n,0),s=new rn(n,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,s],o=>{const a=this.Xr(o.Yr);i.push(a)}),q.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new et(Ne);return n.forEach(s=>{const i=new rn(s,0),o=new rn(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([i,o],a=>{r=r.add(a.Yr)})}),q.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,s=r.length+1;let i=r;he.isDocumentKey(i)||(i=i.child(""));const o=new rn(new he(i),0);let a=new et(Ne);return this.Zr.forEachWhile(l=>{const c=l.key.path;return!!r.isPrefixOf(c)&&(c.length===s&&(a=a.add(l.Yr)),!0)},o),q.resolve(this.ti(a))}ti(e){const n=[];return e.forEach(r=>{const s=this.Xr(r);s!==null&&n.push(s)}),n}removeMutationBatch(e,n){ye(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return q.forEach(n.mutations,s=>{const i=new rn(s.key,n.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,n){const r=new rn(n,0),s=this.Zr.firstAfterOrEqual(r);return q.resolve(n.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,q.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class l${constructor(e){this.ri=e,this.docs=function(){return new _t(he.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,s=this.docs.get(r),i=s?s.size:0,o=this.ri(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:o}),this.size+=o-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return q.resolve(r?r.document.mutableCopy():Mt.newInvalidDocument(n))}getEntries(e,n){let r=pr();return n.forEach(s=>{const i=this.docs.get(s);r=r.insert(s,i?i.document.mutableCopy():Mt.newInvalidDocument(s))}),q.resolve(r)}getDocumentsMatchingQuery(e,n,r,s){let i=pr();const o=n.path,a=new he(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Ex(J2(u),r)<=0||(s.has(u.key)||Vd(n,u))&&(i=i.insert(u.key,u.mutableCopy()))}return q.resolve(i)}getAllFromCollectionGroup(e,n,r,s){ge(9500)}ii(e,n){return q.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new c$(this)}getSize(e){return q.resolve(this.size)}}class c$ extends pM{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach((r,s)=>{s.isValidDocument()?n.push(this.Nr.addEntry(e,s)):this.Nr.removeEntry(r)}),q.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class u${constructor(e){this.persistence=e,this.si=new xi(n=>Ha(n),jd),this.lastRemoteSnapshotVersion=xe.min(),this.highestTargetId=0,this.oi=0,this._i=new zx,this.targetCount=0,this.ai=Ka.ur()}forEachTarget(e,n){return this.si.forEach((r,s)=>n(s)),q.resolve()}getLastRemoteSnapshotVersion(e){return q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return q.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),q.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.oi&&(this.oi=n),q.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Ka(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,q.resolve()}updateTargetData(e,n){return this.Pr(n),q.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,q.resolve()}removeTargets(e,n,r){let s=0;const i=[];return this.si.forEach((o,a)=>{a.sequenceNumber<=n&&r.get(a.targetId)===null&&(this.si.delete(o),i.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),q.waitFor(i).next(()=>s)}getTargetCount(e){return q.resolve(this.targetCount)}getTargetData(e,n){const r=this.si.get(n)||null;return q.resolve(r)}addMatchingKeys(e,n,r){return this._i.Wr(n,r),q.resolve()}removeMatchingKeys(e,n,r){this._i.zr(n,r);const s=this.persistence.referenceDelegate,i=[];return s&&n.forEach(o=>{i.push(s.markPotentiallyOrphaned(e,o))}),q.waitFor(i)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),q.resolve()}getMatchingKeysForTargetId(e,n){const r=this._i.Hr(n);return q.resolve(r)}containsKey(e,n){return q.resolve(this._i.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $x{constructor(e,n){this.ui={},this.overlays={},this.ci=new Or(0),this.li=!1,this.li=!0,this.hi=new o$,this.referenceDelegate=e(this),this.Pi=new u$(this),this.indexManager=new Gz,this.remoteDocumentCache=function(s){return new l$(s)}(r=>this.referenceDelegate.Ti(r)),this.serializer=new rM(n),this.Ii=new s$(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new i$,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.ui[e.toKey()];return r||(r=new a$(n,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,r){se("MemoryPersistence","Starting transaction:",e);const s=new h$(this.ci.next());return this.referenceDelegate.Ei(),r(s).next(i=>this.referenceDelegate.di(s).next(()=>i)).toPromise().then(i=>(s.raiseOnCommittedEvent(),i))}Ai(e,n){return q.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,n)))}}class h$ extends Y2{constructor(e){super(),this.currentSequenceNumber=e}}class Ey{constructor(e){this.persistence=e,this.Ri=new zx,this.Vi=null}static mi(e){return new Ey(e)}get fi(){if(this.Vi)return this.Vi;throw ge(60996)}addReference(e,n,r){return this.Ri.addReference(r,n),this.fi.delete(r.toString()),q.resolve()}removeReference(e,n,r){return this.Ri.removeReference(r,n),this.fi.add(r.toString()),q.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),q.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach(s=>this.fi.add(s.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(s=>{s.forEach(i=>this.fi.add(i.toString()))}).next(()=>r.removeTargetData(e,n))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return q.forEach(this.fi,r=>{const s=he.fromPath(r);return this.gi(e,s).next(i=>{i||n.removeEntry(s,xe.min())})}).next(()=>(this.Vi=null,n.apply(e)))}updateLimboDocument(e,n){return this.gi(e,n).next(r=>{r?this.fi.delete(n.toString()):this.fi.add(n.toString())})}Ti(e){return 0}gi(e,n){return q.or([()=>q.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Dm{constructor(e,n){this.persistence=e,this.pi=new xi(r=>Mn(r.path),(r,s)=>r.isEqual(s)),this.garbageCollector=fM(this,n)}static mi(e,n){return new Dm(e,n)}Ei(){}di(e){return q.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(s=>r+s))}wr(e){let n=0;return this.pr(e,r=>{n++}).next(()=>n)}pr(e,n){return q.forEach(this.pi,(r,s)=>this.br(e,r,s).next(i=>i?q.resolve():n(s)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const s=this.persistence.getRemoteDocumentCache(),i=s.newChangeBuffer();return s.ii(e,o=>this.br(e,o,n).next(a=>{a||(r++,i.removeEntry(o,xe.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),q.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),q.resolve()}removeReference(e,n,r){return this.pi.set(r,e.currentSequenceNumber),q.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),q.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=Ap(e.data.value)),n}br(e,n,r){return q.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const s=this.pi.get(n);return q.resolve(s!==void 0&&s>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class d${constructor(e){this.serializer=e}k(e,n,r,s){const i=new cy("createOrUpgrade",n);r<1&&s>=1&&(function(l){l.createObjectStore(Ld)}(e),function(l){l.createObjectStore(td,{keyPath:EU}),l.createObjectStore(Xr,{keyPath:WS,autoIncrement:!0}).createIndex(fa,qS,{unique:!0}),l.createObjectStore(Sc)}(e),Dk(e),function(l){l.createObjectStore(na)}(e));let o=q.resolve();return r<3&&s>=3&&(r!==0&&(function(l){l.deleteObjectStore(Cc),l.deleteObjectStore(kc),l.deleteObjectStore(Ea)}(e),Dk(e)),o=o.next(()=>function(l){const c=l.store(Ea),u={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:xe.min().toTimestamp(),targetCount:0};return c.put(Sm,u)}(i))),r<4&&s>=4&&(r!==0&&(o=o.next(()=>function(l,c){return c.store(Xr).J().next(h=>{l.deleteObjectStore(Xr),l.createObjectStore(Xr,{keyPath:WS,autoIncrement:!0}).createIndex(fa,qS,{unique:!0});const d=c.store(Xr),f=h.map(g=>d.put(g));return q.waitFor(f)})}(e,i))),o=o.next(()=>{(function(l){l.createObjectStore(Ic,{keyPath:MU})})(e)})),r<5&&s>=5&&(o=o.next(()=>this.yi(i))),r<6&&s>=6&&(o=o.next(()=>(function(l){l.createObjectStore(nd)}(e),this.wi(i)))),r<7&&s>=7&&(o=o.next(()=>this.Si(i))),r<8&&s>=8&&(o=o.next(()=>this.bi(e,i))),r<9&&s>=9&&(o=o.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&s>=10&&(o=o.next(()=>this.Di(i))),r<11&&s>=11&&(o=o.next(()=>{(function(l){l.createObjectStore(hy,{keyPath:OU})})(e),function(l){l.createObjectStore(dy,{keyPath:DU})}(e)})),r<12&&s>=12&&(o=o.next(()=>{(function(l){const c=l.createObjectStore(fy,{keyPath:zU});c.createIndex(r1,$U,{unique:!1}),c.createIndex(iP,HU,{unique:!1})})(e)})),r<13&&s>=13&&(o=o.next(()=>function(l){const c=l.createObjectStore(Em,{keyPath:kU});c.createIndex(Cp,CU),c.createIndex(tP,IU)}(e)).next(()=>this.Ci(e,i)).next(()=>e.deleteObjectStore(na))),r<14&&s>=14&&(o=o.next(()=>this.Fi(e,i))),r<15&&s>=15&&(o=o.next(()=>function(l){l.createObjectStore(Cx,{keyPath:LU,autoIncrement:!0}).createIndex(n1,jU,{unique:!1}),l.createObjectStore(mh,{keyPath:VU}).createIndex(rP,FU,{unique:!1}),l.createObjectStore(gh,{keyPath:BU}).createIndex(sP,UU,{unique:!1})}(e))),r<16&&s>=16&&(o=o.next(()=>{n.objectStore(mh).clear()}).next(()=>{n.objectStore(gh).clear()})),r<17&&s>=17&&(o=o.next(()=>{(function(l){l.createObjectStore(Ix,{keyPath:WU})})(e)})),r<18&&s>=18&&P2()&&(o=o.next(()=>{n.objectStore(mh).clear()}).next(()=>{n.objectStore(gh).clear()})),o}wi(e){let n=0;return e.store(na).ee((r,s)=>{n+=Om(s)}).next(()=>{const r={byteSize:n};return e.store(nd).put(t1,r)})}yi(e){const n=e.store(td),r=e.store(Xr);return n.J().next(s=>q.forEach(s,i=>{const o=IDBKeyRange.bound([i.userId,Ta],[i.userId,i.lastAcknowledgedBatchId]);return r.J(fa,o).next(a=>q.forEach(a,l=>{ye(l.userId===i.userId,18650,"Cannot process batch from unexpected user",{batchId:l.batchId});const c=sa(this.serializer,l);return cM(e,i.userId,c).next(()=>{})}))}))}Si(e){const n=e.store(Cc),r=e.store(na);return e.store(Ea).get(Sm).next(s=>{const i=[];return r.ee((o,a)=>{const l=new Ge(o),c=function(h){return[0,Mn(h)]}(l);i.push(n.get(c).next(u=>u?q.resolve():(h=>n.put({targetId:0,path:Mn(h),sequenceNumber:s.highestListenSequenceNumber}))(l)))}).next(()=>q.waitFor(i))})}bi(e,n){e.createObjectStore(rd,{keyPath:PU});const r=n.store(rd),s=new Ux,i=o=>{if(s.add(o)){const a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Mn(l)})}};return n.store(na).ee({X:!0},(o,a)=>{const l=new Ge(o);return i(l.popLast())}).next(()=>n.store(Sc).ee({X:!0},([o,a,l],c)=>{const u=bs(a);return i(u.popLast())}))}Di(e){const n=e.store(kc);return n.ee((r,s)=>{const i=Ju(s),o=sM(this.serializer,i);return n.put(o)})}Ci(e,n){const r=n.store(na),s=[];return r.ee((i,o)=>{const a=n.store(Em),l=function(h){return h.document?new he(Ge.fromString(h.document.name).popFirst(5)):h.noDocument?he.fromSegments(h.noDocument.path):h.unknownDocument?he.fromSegments(h.unknownDocument.path):ge(36783)}(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(c))}).next(()=>q.waitFor(s))}Fi(e,n){const r=n.store(Xr),s=mM(this.serializer),i=new $x(Ey.mi,this.serializer.yt);return r.J().next(o=>{const a=new Map;return o.forEach(l=>{let c=a.get(l.userId)??Ve();sa(this.serializer,l).keys().forEach(u=>c=c.add(u)),a.set(l.userId,c)}),q.forEach(a,(l,c)=>{const u=new gn(c),h=by.wt(this.serializer,u),d=i.getIndexManager(u),f=Ty.wt(u,this.serializer,d,i.referenceDelegate);return new gM(s,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new s1(n,Or.ce),l).next()})})}}function Dk(t){t.createObjectStore(Cc,{keyPath:RU}).createIndex(kx,NU,{unique:!0}),t.createObjectStore(kc,{keyPath:"targetId"}).createIndex(nP,AU,{unique:!0}),t.createObjectStore(Ea)}const Oi="IndexedDbPersistence",r0=18e5,s0=5e3,i0="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",f$="main";class Hx{constructor(e,n,r,s,i,o,a,l,c,u,h=18){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Mi=i,this.window=o,this.document=a,this.xi=c,this.Oi=u,this.Ni=h,this.ci=null,this.li=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bi=null,this.inForeground=!1,this.Li=null,this.ki=null,this.qi=Number.NEGATIVE_INFINITY,this.Qi=d=>Promise.resolve(),!Hx.v())throw new ae(Y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new e$(this,s),this.$i=n+f$,this.serializer=new rM(l),this.Ui=new vo(this.$i,this.Ni,new d$(this.serializer)),this.hi=new zz,this.Pi=new Jz(this.referenceDelegate,this.serializer),this.remoteDocumentCache=mM(this.serializer),this.Ii=new Uz,this.window&&this.window.localStorage?this.Ki=this.window.localStorage:(this.Ki=null,u===!1&&Bn(Oi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Wi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new ae(Y.FAILED_PRECONDITION,i0);return this.Gi(),this.zi(),this.ji(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Pi.getHighestSequenceNumber(e))}).then(e=>{this.ci=new Or(e,this.xi)}).then(()=>{this.li=!0}).catch(e=>(this.Ui&&this.Ui.close(),Promise.reject(e)))}Ji(e){return this.Qi=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ui.$(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Mi.enqueueAndForget(async()=>{this.started&&await this.Wi()}))}Wi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Vf(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.Hi(e).next(n=>{n||(this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)))})}).next(()=>this.Yi(e)).next(n=>this.isPrimary&&!n?this.Zi(e).next(()=>!1):!!n&&this.Xi(e).next(()=>!0))).catch(e=>{if(Vo(e))return se(Oi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return se(Oi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Mi.enqueueRetryable(()=>this.Qi(e)),this.isPrimary=e})}Hi(e){return Mu(e).get(wl).next(n=>q.resolve(this.es(n)))}ts(e){return Vf(e).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.rs(this.qi,r0)){this.qi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=en(n,Ic);return r.J().next(s=>{const i=this.ss(s,r0),o=s.filter(a=>i.indexOf(a)===-1);return q.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ki)for(const n of e)this.Ki.removeItem(this._s(n.clientId))}}ji(){this.ki=this.Mi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Wi().then(()=>this.ns()).then(()=>this.ji()))}es(e){return!!e&&e.ownerId===this.clientId}Yi(e){return this.Oi?q.resolve(!0):Mu(e).get(wl).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,s0)&&!this.us(n.ownerId)){if(this.es(n)&&this.networkEnabled)return!0;if(!this.es(n)){if(!n.allowTabSynchronization)throw new ae(Y.FAILED_PRECONDITION,i0);return!1}}return!(!this.networkEnabled||!this.inForeground)||Vf(e).J().next(r=>this.ss(r,s0).find(s=>{if(this.clientId!==s.clientId){const i=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(i||o&&a)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&se(Oi,`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.li=!1,this.cs(),this.ki&&(this.ki.cancel(),this.ki=null),this.ls(),this.hs(),await this.Ui.runTransaction("shutdown","readwrite",[Ld,Ic],e=>{const n=new s1(e,Or.ce);return this.Zi(n).next(()=>this.ts(n))}),this.Ui.close(),this.Ps()}ss(e,n){return e.filter(r=>this.rs(r.updateTimeMs,n)&&!this.us(r.clientId))}Ts(){return this.runTransaction("getActiveClients","readonly",e=>Vf(e).J().next(n=>this.ss(n,r0).map(r=>r.clientId)))}get started(){return this.li}getGlobalsCache(){return this.hi}getMutationQueue(e,n){return Ty.wt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Qz(e,this.serializer.yt.databaseId)}getDocumentOverlayCache(e){return by.wt(this.serializer,e)}getBundleCache(){return this.Ii}runTransaction(e,n,r){se(Oi,"Starting transaction:",e);const s=n==="readonly"?"readonly":"readwrite",i=function(l){return l===18?GU:l===17?cP:l===16?KU:l===15?Ax:l===14?lP:l===13?aP:l===12?qU:l===11?oP:void ge(60245)}(this.Ni);let o;return this.Ui.runTransaction(e,s,i,a=>(o=new s1(a,this.ci?this.ci.next():Or.ce),n==="readwrite-primary"?this.Hi(o).next(l=>!!l||this.Yi(o)).next(l=>{if(!l)throw Bn(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Mi.enqueueRetryable(()=>this.Qi(!1)),new ae(Y.FAILED_PRECONDITION,X2);return r(o)}).next(l=>this.Xi(o).next(()=>l)):this.Is(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Is(e){return Mu(e).get(wl).next(n=>{if(n!==null&&this.rs(n.leaseTimestampMs,s0)&&!this.us(n.ownerId)&&!this.es(n)&&!(this.Oi||this.allowTabSynchronization&&n.allowTabSynchronization))throw new ae(Y.FAILED_PRECONDITION,i0)})}Xi(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Mu(e).put(wl,n)}static v(){return vo.v()}Zi(e){const n=Mu(e);return n.get(wl).next(r=>this.es(r)?(se(Oi,"Releasing primary lease."),n.delete(wl)):q.resolve())}rs(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Bn(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Gi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Li=()=>{this.Mi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Wi()))},this.document.addEventListener("visibilitychange",this.Li),this.inForeground=this.document.visibilityState==="visible")}ls(){this.Li&&(this.document.removeEventListener("visibilitychange",this.Li),this.Li=null)}zi(){var e;typeof((e=this.window)==null?void 0:e.addEventListener)=="function"&&(this.Bi=()=>{this.cs();const n=/(?:Version|Mobile)\/1[456]/;N2()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.Mi.enterRestrictedMode(!0),this.Mi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Bi))}hs(){this.Bi&&(this.window.removeEventListener("pagehide",this.Bi),this.Bi=null)}us(e){var n;try{const r=((n=this.Ki)==null?void 0:n.getItem(this._s(e)))!==null;return se(Oi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Bn(Oi,"Failed to get zombied client id.",r),!1}}cs(){if(this.Ki)try{this.Ki.setItem(this._s(this.clientId),String(Date.now()))}catch(e){Bn("Failed to set zombie client id.",e)}}Ps(){if(this.Ki)try{this.Ki.removeItem(this._s(this.clientId))}catch{}}_s(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Mu(t){return en(t,Ld)}function Vf(t){return en(t,Ic)}function p$(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wx{constructor(e,n,r,s){this.targetId=e,this.fromCache=n,this.Es=r,this.ds=s}static As(e,n){let r=Ve(),s=Ve();for(const i of n.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:s=s.add(i.doc.key)}return new Wx(e,n.fromCache,r,s)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m${constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yM{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){return N2()?8:Z2(Zt())>0?6:4}()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,r,s){const i={result:null};return this.ys(e,n).next(o=>{i.result=o}).next(()=>{if(!i.result)return this.ws(e,n,s,r).next(o=>{i.result=o})}).next(()=>{if(i.result)return;const o=new m$;return this.Ss(e,n,o).next(a=>{if(i.result=a,this.Vs)return this.bs(e,n,o,a.size)})}).next(()=>i.result)}bs(e,n,r,s){return r.documentReadCount<this.fs?(Al()<=ze.DEBUG&&se("QueryEngine","SDK will not create cache indexes for query:",Rl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),q.resolve()):(Al()<=ze.DEBUG&&se("QueryEngine","Query:",Rl(n),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Al()<=ze.DEBUG&&se("QueryEngine","The SDK decides to create cache indexes for query:",Rl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Lr(n))):q.resolve())}ys(e,n){if(ik(n))return q.resolve(null);let r=Lr(n);return this.indexManager.getIndexType(e,r).next(s=>s===0?null:(n.limit!==null&&s===1&&(n=Am(n,null,"F"),r=Lr(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(i=>{const o=Ve(...i);return this.ps.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{const c=this.Ds(n,a);return this.Cs(n,c,o,l.readTime)?this.ys(e,Am(n,null,"F")):this.vs(e,c,n,l)}))})))}ws(e,n,r,s){return ik(n)||s.isEqual(xe.min())?q.resolve(null):this.ps.getDocuments(e,r).next(i=>{const o=this.Ds(n,i);return this.Cs(n,o,r,s)?q.resolve(null):(Al()<=ze.DEBUG&&se("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Rl(n)),this.vs(e,o,n,yU(s,Yh)).next(a=>a))})}Ds(e,n){let r=new et(AP(e));return n.forEach((s,i)=>{Vd(e,i)&&(r=r.add(i))}),r}Cs(e,n,r,s){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const i=e.limitType==="F"?n.last():n.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(s)>0)}Ss(e,n,r){return Al()<=ze.DEBUG&&se("QueryEngine","Using full collection scan to execute query:",Rl(n)),this.ps.getDocumentsMatchingQuery(e,n,wr.min(),r)}vs(e,n,r,s){return this.ps.getDocumentsMatchingQuery(e,r,s).next(i=>(n.forEach(o=>{i=i.insert(o.key,o)}),i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qx="LocalStore",g$=3e8;class y${constructor(e,n,r,s){this.persistence=e,this.Fs=n,this.serializer=s,this.Ms=new _t(Ne),this.xs=new xi(i=>Ha(i),jd),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gM(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.Ms))}}function vM(t,e,n,r){return new y$(t,e,n,r)}async function wM(t,e){const n=Pe(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let s;return n.mutationQueue.getAllMutationBatches(r).next(i=>(s=i,n.Bs(e),n.mutationQueue.getAllMutationBatches(r))).next(i=>{const o=[],a=[];let l=Ve();for(const c of s){o.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}for(const c of i){a.push(c.batchId);for(const u of c.mutations)l=l.add(u.key)}return n.localDocuments.getDocuments(r,l).next(c=>({Ls:c,removedBatchIds:o,addedBatchIds:a}))})})}function v$(t,e){const n=Pe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const s=e.batch.keys(),i=n.Ns.newChangeBuffer({trackRemovals:!0});return function(a,l,c,u){const h=c.batch,d=h.keys();let f=q.resolve();return d.forEach(g=>{f=f.next(()=>u.getEntry(l,g)).next(y=>{const v=c.docVersions.get(g);ye(v!==null,48541),y.version.compareTo(v)<0&&(h.applyToRemoteDocument(y,c),y.isValidDocument()&&(y.setReadTime(c.commitVersion),u.addEntry(y)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(l,h))}(n,r,e,i).next(()=>i.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,s,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let l=Ve();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(l=l.add(a.batch.mutations[c].key));return l}(e))).next(()=>n.localDocuments.getDocuments(r,s))})}function _M(t){const e=Pe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Pi.getLastRemoteSnapshotVersion(n))}function w$(t,e){const n=Pe(t),r=e.snapshotVersion;let s=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",i=>{const o=n.Ns.newChangeBuffer({trackRemovals:!0});s=n.Ms;const a=[];e.targetChanges.forEach((u,h)=>{const d=s.get(h);if(!d)return;a.push(n.Pi.removeMatchingKeys(i,u.removedDocuments,h).next(()=>n.Pi.addMatchingKeys(i,u.addedDocuments,h)));let f=d.withSequenceNumber(i.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(qt.EMPTY_BYTE_STRING,xe.min()).withLastLimboFreeSnapshotVersion(xe.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,r)),s=s.insert(h,f),function(y,v,w){return y.resumeToken.approximateByteSize()===0||v.snapshotVersion.toMicroseconds()-y.snapshotVersion.toMicroseconds()>=g$?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(d,f,u)&&a.push(n.Pi.updateTargetData(i,f))});let l=pr(),c=Ve();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(i,u))}),a.push(_$(i,o,e.documentUpdates).next(u=>{l=u.ks,c=u.qs})),!r.isEqual(xe.min())){const u=n.Pi.getLastRemoteSnapshotVersion(i).next(h=>n.Pi.setTargetsMetadata(i,i.currentSequenceNumber,r));a.push(u)}return q.waitFor(a).next(()=>o.apply(i)).next(()=>n.localDocuments.getLocalViewOfDocuments(i,l,c)).next(()=>l)}).then(i=>(n.Ms=s,i))}function _$(t,e,n){let r=Ve(),s=Ve();return n.forEach(i=>r=r.add(i)),e.getEntries(t,r).next(i=>{let o=pr();return n.forEach((a,l)=>{const c=i.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(xe.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):se(qx,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{ks:o,qs:s}})}function x$(t,e){const n=Pe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ta),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function b$(t,e){const n=Pe(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let s;return n.Pi.getTargetData(r,e).next(i=>i?(s=i,q.resolve(s)):n.Pi.allocateTargetId(r).next(o=>(s=new ei(e,o,"TargetPurposeListen",r.currentSequenceNumber),n.Pi.addTargetData(r,s).next(()=>s))))}).then(r=>{const s=n.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(r.targetId,r),n.xs.set(e,r.targetId)),r})}async function v1(t,e,n){const r=Pe(t),s=r.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,o=>r.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Vo(o))throw o;se(qx,`Failed to update sequence numbers for target ${e}: ${o}`)}r.Ms=r.Ms.remove(e),r.xs.delete(s.target)}function Lk(t,e,n){const r=Pe(t);let s=xe.min(),i=Ve();return r.persistence.runTransaction("Execute query","readwrite",o=>function(l,c,u){const h=Pe(l),d=h.xs.get(u);return d!==void 0?q.resolve(h.Ms.get(d)):h.Pi.getTargetData(c,u)}(r,o,Lr(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(o,a.targetId).next(l=>{i=l})}).next(()=>r.Fs.getDocumentsMatchingQuery(o,e,n?s:xe.min(),n?i:Ve())).next(a=>(T$(r,cz(e),a),{documents:a,Qs:i})))}function T$(t,e,n){let r=t.Os.get(e)||xe.min();n.forEach((s,i)=>{i.readTime.compareTo(r)>0&&(r=i.readTime)}),t.Os.set(e,r)}class jk{constructor(){this.activeTargetIds=mz()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class xM{constructor(){this.Mo=new jk,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,r){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new jk,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E${Oo(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk="ConnectivityMonitor";class Fk{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){se(Vk,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){se(Vk,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ff=null;function w1(){return Ff===null?Ff=function(){return 268435456+Math.round(2147483648*Math.random())}():Ff++,"0x"+Ff.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o0="RestConnection",S$={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class k${get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===km?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(e,n,r,s,i){const o=w1(),a=this.zo(e,n.toUriEncodedString());se(o0,`Sending RPC '${e}' ${o}:`,a,r);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,i);const{host:c}=new URL(a),u=jo(c);return this.Jo(e,a,l,r,u).then(h=>(se(o0,`Received RPC '${e}' ${o}: `,h),h),h=>{throw za(o0,`RPC '${e}' ${o} failed with error: `,h,"url: ",a,"request:",r),h})}Ho(e,n,r,s,i,o){return this.Go(e,n,r,s,i)}jo(e,n,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Yc}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,i)=>e[i]=s),r&&r.headers.forEach((s,i)=>e[i]=s)}zo(e,n){const r=S$[e];return`${this.Uo}/v1/${n}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class C${constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kn="WebChannelConnection";class I$ extends k${constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,r,s,i){const o=w1();return new Promise((a,l)=>{const c=new B2;c.setWithCredentials(!0),c.listenOnce(U2.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Ep.NO_ERROR:const h=c.getResponseJson();se(kn,`XHR for RPC '${e}' ${o} received:`,JSON.stringify(h)),a(h);break;case Ep.TIMEOUT:se(kn,`RPC '${e}' ${o} timed out`),l(new ae(Y.DEADLINE_EXCEEDED,"Request time out"));break;case Ep.HTTP_ERROR:const d=c.getStatus();if(se(kn,`RPC '${e}' ${o} failed with status:`,d,"response text:",c.getResponseText()),d>0){let f=c.getResponseJson();Array.isArray(f)&&(f=f[0]);const g=f==null?void 0:f.error;if(g&&g.status&&g.message){const y=function(w){const T=w.toLowerCase().replace(/_/g,"-");return Object.values(Y).indexOf(T)>=0?T:Y.UNKNOWN}(g.status);l(new ae(y,g.message))}else l(new ae(Y.UNKNOWN,"Server responded with status "+c.getStatus()))}else l(new ae(Y.UNAVAILABLE,"Connection failed."));break;default:ge(9055,{l_:e,streamId:o,h_:c.getLastErrorCode(),P_:c.getLastError()})}}finally{se(kn,`RPC '${e}' ${o} completed.`)}});const u=JSON.stringify(s);se(kn,`RPC '${e}' ${o} sending request:`,s),c.send(n,"POST",u,r,15)})}T_(e,n,r){const s=w1(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=H2(),a=$2(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(l.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,n,r),l.encodeInitMessageHeaders=!0;const u=i.join("");se(kn,`Creating RPC '${e}' stream ${s}: ${u}`,l);const h=o.createWebChannel(u,l);this.I_(h);let d=!1,f=!1;const g=new C$({Yo:v=>{f?se(kn,`Not sending because RPC '${e}' stream ${s} is closed:`,v):(d||(se(kn,`Opening RPC '${e}' stream ${s} transport.`),h.open(),d=!0),se(kn,`RPC '${e}' stream ${s} sending:`,v),h.send(v))},Zo:()=>h.close()}),y=(v,w,T)=>{v.listen(w,E=>{try{T(E)}catch(R){setTimeout(()=>{throw R},0)}})};return y(h,Ku.EventType.OPEN,()=>{f||(se(kn,`RPC '${e}' stream ${s} transport opened.`),g.o_())}),y(h,Ku.EventType.CLOSE,()=>{f||(f=!0,se(kn,`RPC '${e}' stream ${s} transport closed`),g.a_(),this.E_(h))}),y(h,Ku.EventType.ERROR,v=>{f||(f=!0,za(kn,`RPC '${e}' stream ${s} transport errored. Name:`,v.name,"Message:",v.message),g.a_(new ae(Y.UNAVAILABLE,"The operation could not be completed")))}),y(h,Ku.EventType.MESSAGE,v=>{var w;if(!f){const T=v.data[0];ye(!!T,16349);const E=T,R=(E==null?void 0:E.error)||((w=E[0])==null?void 0:w.error);if(R){se(kn,`RPC '${e}' stream ${s} received error:`,R);const P=R.status;let N=function(x){const S=zt[x];if(S!==void 0)return $P(S)}(P),k=R.message;N===void 0&&(N=Y.INTERNAL,k="Unknown error status: "+P+" with message "+R.message),f=!0,g.a_(new ae(N,k)),h.close()}else se(kn,`RPC '${e}' stream ${s} received:`,T),g.u_(T)}}),y(a,z2.STAT_EVENT,v=>{v.stat===Yw.PROXY?se(kn,`RPC '${e}' stream ${s} detected buffering proxy`):v.stat===Yw.NOPROXY&&se(kn,`RPC '${e}' stream ${s} detected no buffering proxy`)}),setTimeout(()=>{g.__()},0),g}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(n=>n===e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A$(){return typeof window<"u"?window:null}function Op(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sy(t){return new Rz(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bM{constructor(e,n,r=1e3,s=1.5,i=6e4){this.Mi=e,this.timerId=n,this.d_=r,this.A_=s,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,n-r);s>0&&se("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bk="PersistentStream";class TM{constructor(e,n,r,s,i,o,a,l){this.Mi=e,this.S_=r,this.b_=s,this.connection=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new bM(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===Y.RESOURCE_EXHAUSTED?(Bn(n.toString()),Bn("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===Y.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,s])=>{this.D_===n&&this.G_(r,s)},r=>{e(()=>{const s=new ae(Y.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)})})}G_(e,n){const r=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(s=>{r(()=>this.z_(s))}),this.stream.onMessage(s=>{r(()=>++this.F_==1?this.J_(s):this.onNext(s))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return se(Bk,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget(()=>this.D_===e?n():(se(Bk,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class R$ extends TM{constructor(e,n,r,s,i,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=Mz(this.serializer,e),r=function(i){if(!("targetChange"in i))return xe.min();const o=i.targetChange;return o.targetIds&&o.targetIds.length?xe.min():o.readTime?zn(o.readTime):xe.min()}(e);return this.listener.H_(n,r)}Y_(e){const n={};n.database=f1(this.serializer),n.addTarget=function(i,o){let a;const l=o.target;if(a=Cm(l)?{documents:XP(i,l)}:{query:YP(i,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=qP(i,o.resumeToken);const c=h1(i,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(xe.min())>0){a.readTime=Lc(i,o.snapshotVersion.toTimestamp());const c=h1(i,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);const r=Dz(this.serializer,e);r&&(n.labels=r),this.q_(n)}Z_(e){const n={};n.database=f1(this.serializer),n.removeTarget=e,this.q_(n)}}class N$ extends TM{constructor(e,n,r,s,i,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,s,o),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return ye(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ye(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ye(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=Oz(e.writeResults,e.commitTime),r=zn(e.commitTime);return this.listener.na(r,n)}ra(){const e={};e.database=f1(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>Nm(this.serializer,r))};this.q_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P${}class M$ extends P${constructor(e,n,r,s){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new ae(Y.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,o])=>this.connection.Go(e,d1(n,r),s,i,o)).catch(i=>{throw i.name==="FirebaseError"?(i.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new ae(Y.UNKNOWN,i.toString())})}Ho(e,n,r,s,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.Ho(e,d1(n,r),s,o,a,i)).catch(o=>{throw o.name==="FirebaseError"?(o.code===Y.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new ae(Y.UNKNOWN,o.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class O${constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Bn(n),this.aa=!1):se("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ga="RemoteStore";class D${constructor(e,n,r,s,i){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(o=>{r.enqueueAndForget(async()=>{ul(this)&&(se(Ga,"Restarting streams for network reachability change."),await async function(l){const c=Pe(l);c.Ea.add(4),await Bd(c),c.Ra.set("Unknown"),c.Ea.delete(4),await ky(c)}(this))})}),this.Ra=new O$(r,s)}}async function ky(t){if(ul(t))for(const e of t.da)await e(!0)}async function Bd(t){for(const e of t.da)await e(!1)}function EM(t,e){const n=Pe(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Jx(n)?Qx(n):tu(n).O_()&&Gx(n,e))}function Kx(t,e){const n=Pe(t),r=tu(n);n.Ia.delete(e),r.O_()&&SM(n,e),n.Ia.size===0&&(r.O_()?r.L_():ul(n)&&n.Ra.set("Unknown"))}function Gx(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(xe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}tu(t).Y_(e)}function SM(t,e){t.Va.Ue(e),tu(t).Z_(e)}function Qx(t){t.Va=new kz({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),tu(t).start(),t.Ra.ua()}function Jx(t){return ul(t)&&!tu(t).x_()&&t.Ia.size>0}function ul(t){return Pe(t).Ea.size===0}function kM(t){t.Va=void 0}async function L$(t){t.Ra.set("Online")}async function j$(t){t.Ia.forEach((e,n)=>{Gx(t,e)})}async function V$(t,e){kM(t),Jx(t)?(t.Ra.ha(e),Qx(t)):t.Ra.set("Unknown")}async function F$(t,e,n){if(t.Ra.set("Online"),e instanceof WP&&e.state===2&&e.cause)try{await async function(s,i){const o=i.cause;for(const a of i.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))}(t,e)}catch(r){se(Ga,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Lm(t,r)}else if(e instanceof Pp?t.Va.Ze(e):e instanceof HP?t.Va.st(e):t.Va.tt(e),!n.isEqual(xe.min()))try{const r=await _M(t.localStore);n.compareTo(r)>=0&&await function(i,o){const a=i.Va.Tt(o);return a.targetChanges.forEach((l,c)=>{if(l.resumeToken.approximateByteSize()>0){const u=i.Ia.get(c);u&&i.Ia.set(c,u.withResumeToken(l.resumeToken,o))}}),a.targetMismatches.forEach((l,c)=>{const u=i.Ia.get(l);if(!u)return;i.Ia.set(l,u.withResumeToken(qt.EMPTY_BYTE_STRING,u.snapshotVersion)),SM(i,l);const h=new ei(u.target,l,c,u.sequenceNumber);Gx(i,h)}),i.remoteSyncer.applyRemoteEvent(a)}(t,n)}catch(r){se(Ga,"Failed to raise snapshot:",r),await Lm(t,r)}}async function Lm(t,e,n){if(!Vo(e))throw e;t.Ea.add(1),await Bd(t),t.Ra.set("Offline"),n||(n=()=>_M(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{se(Ga,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await ky(t)})}function CM(t,e){return e().catch(n=>Lm(t,n,e))}async function Ud(t){const e=Pe(t),n=Ao(e);let r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:Ta;for(;B$(e);)try{const s=await x$(e.localStore,r);if(s===null){e.Ta.length===0&&n.L_();break}r=s.batchId,U$(e,s)}catch(s){await Lm(e,s)}IM(e)&&AM(e)}function B$(t){return ul(t)&&t.Ta.length<10}function U$(t,e){t.Ta.push(e);const n=Ao(t);n.O_()&&n.X_&&n.ea(e.mutations)}function IM(t){return ul(t)&&!Ao(t).x_()&&t.Ta.length>0}function AM(t){Ao(t).start()}async function z$(t){Ao(t).ra()}async function $$(t){const e=Ao(t);for(const n of t.Ta)e.ea(n.mutations)}async function H$(t,e,n){const r=t.Ta.shift(),s=Lx.from(r,e,n);await CM(t,()=>t.remoteSyncer.applySuccessfulWrite(s)),await Ud(t)}async function W$(t,e){e&&Ao(t).X_&&await async function(r,s){if(function(o){return Tz(o)&&o!==Y.ABORTED}(s.code)){const i=r.Ta.shift();Ao(r).B_(),await CM(r,()=>r.remoteSyncer.rejectFailedWrite(i.batchId,s)),await Ud(r)}}(t,e),IM(t)&&AM(t)}async function Uk(t,e){const n=Pe(t);n.asyncQueue.verifyOperationInProgress(),se(Ga,"RemoteStore received new credentials");const r=ul(n);n.Ea.add(3),await Bd(n),r&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await ky(n)}async function q$(t,e){const n=Pe(t);e?(n.Ea.delete(2),await ky(n)):e||(n.Ea.add(2),await Bd(n),n.Ra.set("Unknown"))}function tu(t){return t.ma||(t.ma=function(n,r,s){const i=Pe(n);return i.sa(),new R$(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:L$.bind(null,t),t_:j$.bind(null,t),r_:V$.bind(null,t),H_:F$.bind(null,t)}),t.da.push(async e=>{e?(t.ma.B_(),Jx(t)?Qx(t):t.Ra.set("Unknown")):(await t.ma.stop(),kM(t))})),t.ma}function Ao(t){return t.fa||(t.fa=function(n,r,s){const i=Pe(n);return i.sa(),new N$(r,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,s)}(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:z$.bind(null,t),r_:W$.bind(null,t),ta:$$.bind(null,t),na:H$.bind(null,t)}),t.da.push(async e=>{e?(t.fa.B_(),await Ud(t)):(await t.fa.stop(),t.Ta.length>0&&(se(Ga,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))})),t.fa}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xx{constructor(e,n,r,s,i){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=s,this.removalCallback=i,this.deferred=new Is,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,s,i){const o=Date.now()+r,a=new Xx(e,n,o,s,i);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new ae(Y.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Yx(t,e){if(Bn("AsyncQueue",`${e}: ${t}`),Vo(t))return new ae(Y.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ac{static emptySet(e){return new ac(e.comparator)}constructor(e){this.comparator=e?(n,r)=>e(n,r)||he.comparator(n.key,r.key):(n,r)=>he.comparator(n.key,r.key),this.keyedMap=Gu(),this.sortedSet=new _t(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof ac)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const s=n.getNext().key,i=r.getNext().key;if(!s.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new ac;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zk{constructor(){this.ga=new _t(he.comparator)}track(e){const n=e.doc.key,r=this.ga.get(n);r?e.type!==0&&r.type===3?this.ga=this.ga.insert(n,e):e.type===3&&r.type!==1?this.ga=this.ga.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.ga=this.ga.remove(n):e.type===1&&r.type===2?this.ga=this.ga.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):ge(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal((n,r)=>{e.push(r)}),e}}class jc{constructor(e,n,r,s,i,o,a,l,c){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,n,r,s,i){const o=[];return n.forEach(a=>{o.push({type:0,doc:a})}),new jc(e,n,ac.emptySet(n),o,r,s,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&yy(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let s=0;s<n.length;s++)if(n[s].type!==r[s].type||!n[s].doc.isEqual(r[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K${constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class G${constructor(){this.queries=$k(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,r){const s=Pe(n),i=s.queries;s.queries=$k(),i.forEach((o,a)=>{for(const l of a.Sa)l.onError(r)})})(this,new ae(Y.ABORTED,"Firestore shutting down"))}}function $k(){return new xi(t=>IP(t),yy)}async function RM(t,e){const n=Pe(t);let r=3;const s=e.query;let i=n.queries.get(s);i?!i.ba()&&e.Da()&&(r=2):(i=new K$,r=e.Da()?0:1);try{switch(r){case 0:i.wa=await n.onListen(s,!0);break;case 1:i.wa=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(o){const a=Yx(o,`Initialization of query '${Rl(e.query)}' failed`);return void e.onError(a)}n.queries.set(s,i),i.Sa.push(e),e.va(n.onlineState),i.wa&&e.Fa(i.wa)&&Zx(n)}async function NM(t,e){const n=Pe(t),r=e.query;let s=3;const i=n.queries.get(r);if(i){const o=i.Sa.indexOf(e);o>=0&&(i.Sa.splice(o,1),i.Sa.length===0?s=e.Da()?0:1:!i.ba()&&e.Da()&&(s=2))}switch(s){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function Q$(t,e){const n=Pe(t);let r=!1;for(const s of e){const i=s.query,o=n.queries.get(i);if(o){for(const a of o.Sa)a.Fa(s)&&(r=!0);o.wa=s}}r&&Zx(n)}function J$(t,e,n){const r=Pe(t),s=r.queries.get(e);if(s)for(const i of s.Sa)i.onError(n);r.queries.delete(e)}function Zx(t){t.Ca.forEach(e=>{e.next()})}var _1,Hk;(Hk=_1||(_1={})).Ma="default",Hk.Cache="cache";class PM{constructor(e,n,r){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const r=[];for(const s of e.docChanges)s.type!==3&&r.push(s);e=new jc(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const r=n!=="Offline";return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=jc.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==_1.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MM{constructor(e){this.key=e}}class OM{constructor(e){this.key=e}}class X${constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ve(),this.mutatedKeys=Ve(),this.eu=AP(e),this.tu=new ac(this.eu)}get nu(){return this.Ya}ru(e,n){const r=n?n.iu:new zk,s=n?n.tu:this.tu;let i=n?n.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,c=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const d=s.get(u),f=Vd(this.query,h)?h:null,g=!!d&&this.mutatedKeys.has(d.key),y=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let v=!1;d&&f?d.data.isEqual(f.data)?g!==y&&(r.track({type:3,doc:f}),v=!0):this.su(d,f)||(r.track({type:2,doc:f}),v=!0,(l&&this.eu(f,l)>0||c&&this.eu(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),v=!0):d&&!f&&(r.track({type:1,doc:d}),v=!0,(l||c)&&(a=!0)),v&&(f?(o=o.add(f),i=y?i.add(u):i.delete(u)):(o=o.delete(u),i=i.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),i=i.delete(u.key),r.track({type:1,doc:u})}return{tu:o,iu:r,Cs:a,mutatedKeys:i}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,s){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const o=e.iu.ya();o.sort((u,h)=>function(f,g){const y=v=>{switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return ge(20277,{Rt:v})}};return y(f)-y(g)}(u.type,h.type)||this.eu(u.doc,h.doc)),this.ou(r),s=s??!1;const a=n&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,c=l!==this.Za;return this.Za=l,o.length!==0||c?{snapshot:new jc(this.query,e.tu,i,o,e.mutatedKeys,l===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new zk,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(n=>this.Ya=this.Ya.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ya=this.Ya.delete(n)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ve(),this.tu.forEach(r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))});const n=[];return e.forEach(r=>{this.Xa.has(r)||n.push(new OM(r))}),this.Xa.forEach(r=>{e.has(r)||n.push(new MM(r))}),n}cu(e){this.Ya=e.Qs,this.Xa=Ve();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return jc.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const eb="SyncEngine";class Y${constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Z${constructor(e){this.key=e,this.hu=!1}}class e8{constructor(e,n,r,s,i,o){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=s,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new xi(a=>IP(a),yy),this.Iu=new Map,this.Eu=new Set,this.du=new _t(he.comparator),this.Au=new Map,this.Ru=new zx,this.Vu={},this.mu=new Map,this.fu=Ka.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function t8(t,e,n=!0){const r=BM(t);let s;const i=r.Tu.get(e);return i?(r.sharedClientState.addLocalQueryTarget(i.targetId),s=i.view.lu()):s=await DM(r,e,n,!0),s}async function n8(t,e){const n=BM(t);await DM(n,e,!0,!1)}async function DM(t,e,n,r){const s=await b$(t.localStore,Lr(e)),i=s.targetId,o=t.sharedClientState.addLocalQueryTarget(i,n);let a;return r&&(a=await r8(t,e,i,o==="current",s.resumeToken)),t.isPrimaryClient&&n&&EM(t.remoteStore,s),a}async function r8(t,e,n,r,s){t.pu=(h,d,f)=>async function(y,v,w,T){let E=v.view.ru(w);E.Cs&&(E=await Lk(y.localStore,v.query,!1).then(({documents:k})=>v.view.ru(k,E)));const R=T&&T.targetChanges.get(v.targetId),P=T&&T.targetMismatches.get(v.targetId)!=null,N=v.view.applyChanges(E,y.isPrimaryClient,R,P);return qk(y,v.targetId,N.au),N.snapshot}(t,h,d,f);const i=await Lk(t.localStore,e,!0),o=new X$(e,i.Qs),a=o.ru(i.documents),l=Fd.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",s),c=o.applyChanges(a,t.isPrimaryClient,l);qk(t,n,c.au);const u=new Y$(e,n,o);return t.Tu.set(e,u),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),c.snapshot}async function s8(t,e,n){const r=Pe(t),s=r.Tu.get(e),i=r.Iu.get(s.targetId);if(i.length>1)return r.Iu.set(s.targetId,i.filter(o=>!yy(o,e))),void r.Tu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await v1(r.localStore,s.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(s.targetId),n&&Kx(r.remoteStore,s.targetId),x1(r,s.targetId)}).catch(cl)):(x1(r,s.targetId),await v1(r.localStore,s.targetId,!0))}async function i8(t,e){const n=Pe(t),r=n.Tu.get(e),s=n.Iu.get(r.targetId);n.isPrimaryClient&&s.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Kx(n.remoteStore,r.targetId))}async function o8(t,e,n){const r=UM(t);try{const s=await function(o,a){const l=Pe(o),c=Je.now(),u=a.reduce((f,g)=>f.add(g.key),Ve());let h,d;return l.persistence.runTransaction("Locally write mutations","readwrite",f=>{let g=pr(),y=Ve();return l.Ns.getEntries(f,u).next(v=>{g=v,g.forEach((w,T)=>{T.isValidDocument()||(y=y.add(w))})}).next(()=>l.localDocuments.getOverlayedDocuments(f,g)).next(v=>{h=v;const w=[];for(const T of a){const E=xz(T,h.get(T.key).overlayedDocument);E!=null&&w.push(new bi(T.key,E,wP(E.value.mapValue),Pn.exists(!0)))}return l.mutationQueue.addMutationBatch(f,c,w,a)}).next(v=>{d=v;const w=v.applyToLocalDocumentSet(h,y);return l.documentOverlayCache.saveOverlays(f,v.batchId,w)})}).then(()=>({batchId:d.batchId,changes:NP(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(s.batchId),function(o,a,l){let c=o.Vu[o.currentUser.toKey()];c||(c=new _t(Ne)),c=c.insert(a,l),o.Vu[o.currentUser.toKey()]=c}(r,s.batchId,n),await zd(r,s.changes),await Ud(r.remoteStore)}catch(s){const i=Yx(s,"Failed to persist write");n.reject(i)}}async function LM(t,e){const n=Pe(t);try{const r=await w$(n.localStore,e);e.targetChanges.forEach((s,i)=>{const o=n.Au.get(i);o&&(ye(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?ye(o.hu,14607):s.removedDocuments.size>0&&(ye(o.hu,42227),o.hu=!1))}),await zd(n,r,e)}catch(r){await cl(r)}}function Wk(t,e,n){const r=Pe(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const s=[];r.Tu.forEach((i,o)=>{const a=o.view.va(e);a.snapshot&&s.push(a.snapshot)}),function(o,a){const l=Pe(o);l.onlineState=a;let c=!1;l.queries.forEach((u,h)=>{for(const d of h.Sa)d.va(a)&&(c=!0)}),c&&Zx(l)}(r.eventManager,e),s.length&&r.Pu.H_(s),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function a8(t,e,n){const r=Pe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Au.get(e),i=s&&s.key;if(i){let o=new _t(he.comparator);o=o.insert(i,Mt.newNoDocument(i,xe.min()));const a=Ve().add(i),l=new xy(xe.min(),new Map,new _t(Ne),o,a);await LM(r,l),r.du=r.du.remove(i),r.Au.delete(e),tb(r)}else await v1(r.localStore,e,!1).then(()=>x1(r,e,n)).catch(cl)}async function l8(t,e){const n=Pe(t),r=e.batch.batchId;try{const s=await v$(n.localStore,e);VM(n,r,null),jM(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await zd(n,s)}catch(s){await cl(s)}}async function c8(t,e,n){const r=Pe(t);try{const s=await function(o,a){const l=Pe(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let u;return l.mutationQueue.lookupMutationBatch(c,a).next(h=>(ye(h!==null,37113),u=h.keys(),l.mutationQueue.removeMutationBatch(c,h))).next(()=>l.mutationQueue.performConsistencyCheck(c)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(c,u,a)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,u)).next(()=>l.localDocuments.getDocuments(c,u))})}(r.localStore,e);VM(r,e,n),jM(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await zd(r,s)}catch(s){await cl(s)}}function jM(t,e){(t.mu.get(e)||[]).forEach(n=>{n.resolve()}),t.mu.delete(e)}function VM(t,e,n){const r=Pe(t);let s=r.Vu[r.currentUser.toKey()];if(s){const i=s.get(e);i&&(n?i.reject(n):i.resolve(),s=s.remove(e)),r.Vu[r.currentUser.toKey()]=s}}function x1(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Iu.get(e))t.Tu.delete(r),n&&t.Pu.yu(r,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach(r=>{t.Ru.containsKey(r)||FM(t,r)})}function FM(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(Kx(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),tb(t))}function qk(t,e,n){for(const r of n)r instanceof MM?(t.Ru.addReference(r.key,e),u8(t,r)):r instanceof OM?(se(eb,"Document no longer in limbo: "+r.key),t.Ru.removeReference(r.key,e),t.Ru.containsKey(r.key)||FM(t,r.key)):ge(19791,{wu:r})}function u8(t,e){const n=e.key,r=n.path.canonicalString();t.du.get(n)||t.Eu.has(r)||(se(eb,"New document in limbo: "+n),t.Eu.add(r),tb(t))}function tb(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new he(Ge.fromString(e)),r=t.fu.next();t.Au.set(r,new Z$(n)),t.du=t.du.insert(n,r),EM(t.remoteStore,new ei(Lr(gy(n.path)),r,"TargetPurposeLimboResolution",Or.ce))}}async function zd(t,e,n){const r=Pe(t),s=[],i=[],o=[];r.Tu.isEmpty()||(r.Tu.forEach((a,l)=>{o.push(r.pu(l,e,n).then(c=>{var u;if((c||n)&&r.isPrimaryClient){const h=c?!c.fromCache:(u=n==null?void 0:n.targetChanges.get(l.targetId))==null?void 0:u.current;r.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(c){s.push(c);const h=Wx.As(l.targetId,c);i.push(h)}}))}),await Promise.all(o),r.Pu.H_(s),await async function(l,c){const u=Pe(l);try{await u.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>q.forEach(c,d=>q.forEach(d.Es,f=>u.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>q.forEach(d.ds,f=>u.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Vo(h))throw h;se(qx,"Failed to update sequence numbers: "+h)}for(const h of c){const d=h.targetId;if(!h.fromCache){const f=u.Ms.get(d),g=f.snapshotVersion,y=f.withLastLimboFreeSnapshotVersion(g);u.Ms=u.Ms.insert(d,y)}}}(r.localStore,i))}async function h8(t,e){const n=Pe(t);if(!n.currentUser.isEqual(e)){se(eb,"User change. New user:",e.toKey());const r=await wM(n.localStore,e);n.currentUser=e,function(i,o){i.mu.forEach(a=>{a.forEach(l=>{l.reject(new ae(Y.CANCELLED,o))})}),i.mu.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await zd(n,r.Ls)}}function d8(t,e){const n=Pe(t),r=n.Au.get(e);if(r&&r.hu)return Ve().add(r.key);{let s=Ve();const i=n.Iu.get(e);if(!i)return s;for(const o of i){const a=n.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function BM(t){const e=Pe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=LM.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=d8.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=a8.bind(null,e),e.Pu.H_=Q$.bind(null,e.eventManager),e.Pu.yu=J$.bind(null,e.eventManager),e}function UM(t){const e=Pe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=l8.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=c8.bind(null,e),e}class ud{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Sy(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return vM(this.persistence,new yM,e.initialUser,this.serializer)}Cu(e){return new $x(Ey.mi,this.serializer)}Du(e){return new xM}async terminate(){var e,n;(e=this.gcScheduler)==null||e.stop(),(n=this.indexBackfillerScheduler)==null||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ud.provider={build:()=>new ud};class f8 extends ud{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){ye(this.persistence.referenceDelegate instanceof Dm,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new dM(r,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new $x(r=>Dm.mi(r,n),this.serializer)}}class p8 extends ud{constructor(e,n,r){super(),this.xu=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xu.initialize(this,e),await UM(this.xu.syncEngine),await Ud(this.xu.remoteStore),await this.persistence.Ji(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}vu(e){return vM(this.persistence,new yM,e.initialUser,this.serializer)}Fu(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new dM(r,e.asyncQueue,n)}Mu(e,n){const r=new xU(n,this.persistence);return new _U(e.asyncQueue,r)}Cu(e){const n=p$(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?An.withCacheSize(this.cacheSizeBytes):An.DEFAULT;return new Hx(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,A$(),Op(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Du(e){return new xM}}class jm{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Wk(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=h8.bind(null,this.syncEngine),await q$(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new G$}()}createDatastore(e){const n=Sy(e.databaseInfo.databaseId),r=function(i){return new I$(i)}(e.databaseInfo);return function(i,o,a,l){return new M$(i,o,a,l)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,s,i,o,a){return new D$(r,s,i,o,a)}(this.localStore,this.datastore,e.asyncQueue,n=>Wk(this.syncEngine,n,0),function(){return Fk.v()?new Fk:new E$}())}createSyncEngine(e,n){return function(s,i,o,a,l,c,u){const h=new e8(s,i,o,a,l,c);return u&&(h.gu=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(s){const i=Pe(s);se(Ga,"RemoteStore shutting down."),i.Ea.add(5),await Bd(i),i.Aa.shutdown(),i.Ra.set("Unknown")}(this.remoteStore),(e=this.datastore)==null||e.terminate(),(n=this.eventManager)==null||n.terminate()}}jm.provider={build:()=>new jm};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zM{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Bn("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ro="FirestoreClient";class m8{constructor(e,n,r,s,i){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=s,this.user=gn.UNAUTHENTICATED,this.clientId=Tx.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async o=>{se(Ro,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o}),this.appCheckCredentials.start(r,o=>(se(Ro,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Is;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=Yx(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function a0(t,e){t.asyncQueue.verifyOperationInProgress(),se(Ro,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async s=>{r.isEqual(s)||(await wM(e.localStore,s),r=s)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function Kk(t,e){t.asyncQueue.verifyOperationInProgress();const n=await g8(t);se(Ro,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>Uk(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,s)=>Uk(e.remoteStore,s)),t._onlineComponents=e}async function g8(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){se(Ro,"Using user provided OfflineComponentProvider");try{await a0(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(s){return s.name==="FirebaseError"?s.code===Y.FAILED_PRECONDITION||s.code===Y.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11}(n))throw n;za("Error using user provided cache. Falling back to memory cache: "+n),await a0(t,new ud)}}else se(Ro,"Using default OfflineComponentProvider"),await a0(t,new f8(void 0));return t._offlineComponents}async function $M(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(se(Ro,"Using user provided OnlineComponentProvider"),await Kk(t,t._uninitializedComponentsProvider._online)):(se(Ro,"Using default OnlineComponentProvider"),await Kk(t,new jm))),t._onlineComponents}function y8(t){return $M(t).then(e=>e.syncEngine)}async function HM(t){const e=await $M(t),n=e.eventManager;return n.onListen=t8.bind(null,e.syncEngine),n.onUnlisten=s8.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=n8.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=i8.bind(null,e.syncEngine),n}function v8(t,e,n={}){const r=new Is;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new zM({next:d=>{u.Nu(),o.enqueueAndForget(()=>NM(i,h));const f=d.docs.has(a);!f&&d.fromCache?c.reject(new ae(Y.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&l&&l.source==="server"?c.reject(new ae(Y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new PM(gy(a.path),u,{includeMetadataChanges:!0,qa:!0});return RM(i,h)}(await HM(t),t.asyncQueue,e,n,r)),r.promise}function w8(t,e,n={}){const r=new Is;return t.asyncQueue.enqueueAndForget(async()=>function(i,o,a,l,c){const u=new zM({next:d=>{u.Nu(),o.enqueueAndForget(()=>NM(i,h)),d.fromCache&&l.source==="server"?c.reject(new ae(Y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new PM(a,u,{includeMetadataChanges:!0,qa:!0});return RM(i,h)}(await HM(t),t.asyncQueue,e,n,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WM(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gk=new Map;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qM="firestore.googleapis.com",Qk=!0;class Jk{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new ae(Y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=qM,this.ssl=Qk}else this.host=e.host,this.ssl=e.ssl??Qk;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=lM;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<Xz)throw new ae(Y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}mU("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=WM(e.experimentalLongPollingOptions??{}),function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new ae(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new ae(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new ae(Y.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,s){return r.timeoutSeconds===s.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Cy{constructor(e,n,r,s){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Jk({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ae(Y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new ae(Y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Jk(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new iU;switch(r.type){case"firstParty":return new cU(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new ae(Y.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=Gk.get(n);r&&(se("ComponentProvider","Removing Datastore"),Gk.delete(n),r.terminate())}(this),Promise.resolve()}}function _8(t,e,n,r={}){var c;t=zr(t,Cy);const s=jo(e),i=t._getSettings(),o={...i,emulatorOptions:t._getEmulatorOptions()},a=`${e}:${n}`;s&&(yx(`https://${a}`),vx("Firestore",!0)),i.host!==qM&&i.host!==a&&za("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...i,host:a,ssl:s,emulatorOptions:r};if(!Fa(l,o)&&(t._setSettings(l),r.mockUserToken)){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=gn.MOCK_USER;else{u=A2(r.mockUserToken,(c=t._app)==null?void 0:c.options.projectId);const d=r.mockUserToken.sub||r.mockUserToken.user_id;if(!d)throw new ae(Y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new gn(d)}t._authCredentials=new oU(new q2(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Bo(this.firestore,e,this._query)}}class Ft{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wo(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ft(this.firestore,e,this._key)}toJSON(){return{type:Ft._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,r){if(Dd(n,Ft._jsonSchema))return new Ft(e,r||null,new he(Ge.fromString(n.referencePath)))}}Ft._jsonSchemaVersion="firestore/documentReference/1.0",Ft._jsonSchema={type:Ht("string",Ft._jsonSchemaVersion),referencePath:Ht("string")};class wo extends Bo{constructor(e,n,r){super(e,n,gy(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ft(this.firestore,null,new he(e))}withConverter(e){return new wo(this.firestore,e,this._path)}}function $d(t,e,...n){if(t=Ct(t),G2("collection","path",e),t instanceof Cy){const r=Ge.fromString(e,...n);return BS(r),new wo(t,null,r)}{if(!(t instanceof Ft||t instanceof wo))throw new ae(Y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return BS(r),new wo(t.firestore,null,r)}}function Qn(t,e,...n){if(t=Ct(t),arguments.length===1&&(e=Tx.newId()),G2("doc","path",e),t instanceof Cy){const r=Ge.fromString(e,...n);return FS(r),new Ft(t,null,new he(r))}{if(!(t instanceof Ft||t instanceof wo))throw new ae(Y.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(Ge.fromString(e,...n));return FS(r),new Ft(t.firestore,t instanceof wo?t.converter:null,new he(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xk="AsyncQueue";class Yk{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new bM(this,"async_queue_retry"),this._c=()=>{const r=Op();r&&se(Xk,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=e;const n=Op();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=Op();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const n=new Is;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Vo(e))throw e;se(Xk,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const n=this.ac.then(()=>(this.rc=!0,e().catch(r=>{throw this.nc=r,this.rc=!1,Bn("INTERNAL UNHANDLED ERROR: ",Zk(r)),r}).then(r=>(this.rc=!1,r))));return this.ac=n,n}enqueueAfterDelay(e,n,r){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const s=Xx.createAndSchedule(this,e,n,r,i=>this.hc(i));return this.tc.push(s),s}uc(){this.nc&&ge(47125,{Pc:Zk(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function Zk(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class Uo extends Cy{constructor(e,n,r,s){super(e,n,r,s),this.type="firestore",this._queue=new Yk,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Yk(e),this._firestoreClient=void 0,await e}}}function x8(t,e){const n=typeof t=="object"?t:xx(),r=typeof t=="string"?t:km,s=ay(n,"firestore").getImmediate({identifier:r});if(!s._initialized){const i=k2("firestore");i&&_8(s,...i)}return s}function nb(t){if(t._terminated)throw new ae(Y.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||KM(t),t._firestoreClient}function KM(t){var r,s,i;const e=t._freezeSettings(),n=function(a,l,c,u){return new JU(a,l,c,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,WM(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)}(t._databaseId,((r=t._app)==null?void 0:r.options.appId)||"",t._persistenceKey,e);t._componentsProvider||(s=e.localCache)!=null&&s._offlineComponentProvider&&((i=e.localCache)!=null&&i._onlineComponentProvider)&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new m8(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&function(a){const l=a==null?void 0:a._online.build();return{_offline:a==null?void 0:a._offline.build(l),_online:l}}(t._componentsProvider))}function b8(t,e){za("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return T8(t,jm.provider,{build:r=>new p8(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}function T8(t,e,n){if((t=zr(t,Uo))._firestoreClient||t._terminated)throw new ae(Y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new ae(Y.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},KM(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Nr(qt.fromBase64String(e))}catch(n){throw new ae(Y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Nr(qt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Nr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Dd(e,Nr._jsonSchema))return Nr.fromBase64String(e.bytes)}}Nr._jsonSchemaVersion="firestore/bytes/1.0",Nr._jsonSchema={type:Ht("string",Nr._jsonSchemaVersion),bytes:Ht("string")};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Iy{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new ae(Y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Tt(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ay{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class As{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new ae(Y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new ae(Y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ne(this._lat,e._lat)||Ne(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:As._jsonSchemaVersion}}static fromJSON(e){if(Dd(e,As._jsonSchema))return new As(e.latitude,e.longitude)}}As._jsonSchemaVersion="firestore/geoPoint/1.0",As._jsonSchema={type:Ht("string",As._jsonSchemaVersion),latitude:Ht("number"),longitude:Ht("number")};/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rs{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,s){if(r.length!==s.length)return!1;for(let i=0;i<r.length;++i)if(r[i]!==s[i])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Rs._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Dd(e,Rs._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(n=>typeof n=="number"))return new Rs(e.vectorValues);throw new ae(Y.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Rs._jsonSchemaVersion="firestore/vectorValue/1.0",Rs._jsonSchema={type:Ht("string",Rs._jsonSchemaVersion),vectorValues:Ht("object")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const E8=/^__.*__$/;class S8{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new bi(e,this.data,this.fieldMask,n,this.fieldTransforms):new eu(e,this.data,n,this.fieldTransforms)}}class GM{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new bi(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function QM(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw ge(40011,{Ac:t})}}class rb{constructor(e,n,r,s,i,o){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=s,i===void 0&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new rb({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.gc(e),r}yc(e){var s;const n=(s=this.path)==null?void 0:s.child(e),r=this.Vc({path:n,fc:!1});return r.Rc(),r}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Vm(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(QM(this.Ac)&&E8.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class k8{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||Sy(e)}Cc(e,n,r,s=!1){return new rb({Ac:e,methodName:n,Dc:r,path:Tt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ry(t){const e=t._freezeSettings(),n=Sy(t._databaseId);return new k8(t._databaseId,!!e.ignoreUndefinedProperties,n)}function JM(t,e,n,r,s,i={}){const o=t.Cc(i.merge||i.mergeFields?2:0,e,n,s);ib("Data must be an object, but it was:",o,r);const a=XM(r,o);let l,c;if(i.merge)l=new tr(o.fieldMask),c=o.fieldTransforms;else if(i.mergeFields){const u=[];for(const h of i.mergeFields){const d=b1(e,h,n);if(!o.contains(d))throw new ae(Y.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);ZM(u,d)||u.push(d)}l=new tr(u),c=o.fieldTransforms.filter(h=>l.covers(h.field))}else l=null,c=o.fieldTransforms;return new S8(new Nn(a),l,c)}class Ny extends Ay{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ny}}class sb extends Ay{constructor(e,n){super(e),this.Fc=n}_toFieldTransform(e){const n=new Dc(e.serializer,OP(e.serializer,this.Fc));return new FP(e.path,n)}isEqual(e){return e instanceof sb&&this.Fc===e.Fc}}function C8(t,e,n,r){const s=t.Cc(1,e,n);ib("Data must be an object, but it was:",s,r);const i=[],o=Nn.empty();Fo(r,(l,c)=>{const u=ob(e,l,n);c=Ct(c);const h=s.yc(u);if(c instanceof Ny)i.push(u);else{const d=Hd(c,h);d!=null&&(i.push(u),o.set(u,d))}});const a=new tr(i);return new GM(o,a,s.fieldTransforms)}function I8(t,e,n,r,s,i){const o=t.Cc(1,e,n),a=[b1(e,r,n)],l=[s];if(i.length%2!=0)throw new ae(Y.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<i.length;d+=2)a.push(b1(e,i[d])),l.push(i[d+1]);const c=[],u=Nn.empty();for(let d=a.length-1;d>=0;--d)if(!ZM(c,a[d])){const f=a[d];let g=l[d];g=Ct(g);const y=o.yc(f);if(g instanceof Ny)c.push(f);else{const v=Hd(g,y);v!=null&&(c.push(f),u.set(f,v))}}const h=new tr(c);return new GM(u,h,o.fieldTransforms)}function A8(t,e,n,r=!1){return Hd(n,t.Cc(r?4:3,e))}function Hd(t,e){if(YM(t=Ct(t)))return ib("Unsupported field value:",e,t),XM(t,e);if(t instanceof Ay)return function(r,s){if(!QM(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const i=r._toFieldTransform(s);i&&s.fieldTransforms.push(i)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return function(r,s){const i=[];let o=0;for(const a of r){let l=Hd(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),i.push(l),o++}return{arrayValue:{values:i}}}(t,e)}return function(r,s){if((r=Ct(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return OP(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const i=Je.fromDate(r);return{timestampValue:Lc(s.serializer,i)}}if(r instanceof Je){const i=new Je(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Lc(s.serializer,i)}}if(r instanceof As)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nr)return{bytesValue:qP(s.serializer,r._byteString)};if(r instanceof Ft){const i=s.databaseId,o=r.firestore._databaseId;if(!o.isEqual(i))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Fx(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Rs)return function(o,a){return{mapValue:{fields:{[Nx]:{stringValue:Px},[Ac]:{arrayValue:{values:o.toArray().map(c=>{if(typeof c!="number")throw a.Sc("VectorValues must only contain numeric values.");return Ox(a.serializer,c)})}}}}}}(r,s);throw s.Sc(`Unsupported field value: ${ly(r)}`)}(t,e)}function XM(t,e){const n={};return uP(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fo(t,(r,s)=>{const i=Hd(s,e.mc(r));i!=null&&(n[r]=i)}),{mapValue:{fields:n}}}function YM(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Je||t instanceof As||t instanceof Nr||t instanceof Ft||t instanceof Ay||t instanceof Rs)}function ib(t,e,n){if(!YM(n)||!Q2(n)){const r=ly(n);throw r==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+r)}}function b1(t,e,n){if((e=Ct(e))instanceof Iy)return e._internalPath;if(typeof e=="string")return ob(t,e);throw Vm("Field path arguments must be of type string or ",t,!1,void 0,n)}const R8=new RegExp("[~\\*/\\[\\]]");function ob(t,e,n){if(e.search(R8)>=0)throw Vm(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Iy(...e.split("."))._internalPath}catch{throw Vm(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Vm(t,e,n,r,s){const i=r&&!r.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(i||o)&&(l+=" (found",i&&(l+=` in field ${r}`),o&&(l+=` in document ${s}`),l+=")"),new ae(Y.INVALID_ARGUMENT,a+t+l)}function ZM(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eO{constructor(e,n,r,s,i){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=s,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Ft(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new N8(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Py("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class N8 extends eO{data(){return super.data()}}function Py(t,e){return typeof e=="string"?ob(t,e):e instanceof Iy?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function P8(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new ae(Y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ab{}class lb extends ab{}function l0(t,e,...n){let r=[];e instanceof ab&&r.push(e),r=r.concat(n),function(i){const o=i.filter(l=>l instanceof cb).length,a=i.filter(l=>l instanceof My).length;if(o>1||o>0&&a>0)throw new ae(Y.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const s of r)t=s._apply(t);return t}class My extends lb{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new My(e,n,r)}_apply(e){const n=this._parse(e);return tO(e._query,n),new Bo(e.firestore,e.converter,u1(e._query,n))}_parse(e){const n=Ry(e.firestore);return function(i,o,a,l,c,u,h){let d;if(c.isKeyField()){if(u==="array-contains"||u==="array-contains-any")throw new ae(Y.INVALID_ARGUMENT,`Invalid Query. You can't perform '${u}' queries on documentId().`);if(u==="in"||u==="not-in"){rC(h,u);const g=[];for(const y of h)g.push(nC(l,i,y));d={arrayValue:{values:g}}}else d=nC(l,i,h)}else u!=="in"&&u!=="not-in"&&u!=="array-contains-any"||rC(h,u),d=A8(a,o,h,u==="in"||u==="not-in");return $e.create(c,u,d)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function M8(t,e,n){const r=e,s=Py("where",t);return My._create(s,r,n)}class cb extends ab{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new cb(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:Ye.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(s,i){let o=s;const a=i.getFlattenedFilters();for(const l of a)tO(o,l),o=u1(o,l)}(e._query,n),new Bo(e.firestore,e.converter,u1(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class ub extends lb{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new ub(e,n)}_apply(e){const n=function(s,i,o){if(s.startAt!==null)throw new ae(Y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(s.endAt!==null)throw new ae(Y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ld(i,o)}(e._query,this._field,this._direction);return new Bo(e.firestore,e.converter,function(s,i){const o=s.explicitOrderBy.concat([i]);return new Zc(s.path,s.collectionGroup,o,s.filters.slice(),s.limit,s.limitType,s.startAt,s.endAt)}(e._query,n))}}function eC(t,e="asc"){const n=e,r=Py("orderBy",t);return ub._create(r,n)}class hb extends lb{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new hb(e,n,r)}_apply(e){return new Bo(e.firestore,e.converter,Am(e._query,this._limit,this._limitType))}}function tC(t){return gU("limit",t),hb._create("limit",t,"F")}function nC(t,e,n){if(typeof(n=Ct(n))=="string"){if(n==="")throw new ae(Y.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!CP(e)&&n.indexOf("/")!==-1)throw new ae(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Ge.fromString(n));if(!he.isDocumentKey(r))throw new ae(Y.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return od(t,new he(r))}if(n instanceof Ft)return od(t,n._key);throw new ae(Y.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ly(n)}.`)}function rC(t,e){if(!Array.isArray(t)||t.length===0)throw new ae(Y.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function tO(t,e){const n=function(s,i){for(const o of s)for(const a of o.getFlattenedFilters())if(i.indexOf(a.op)>=0)return a.op;return null}(t.filters,function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new ae(Y.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new ae(Y.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class O8{convertValue(e,n="none"){switch(Co(e)){case 0:return null;case 1:return e.booleanValue;case 2:return vt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(yi(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw ge(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Fo(e,(s,i)=>{r[s]=this.convertValue(i,n)}),r}convertVectorValue(e){var r,s,i;const n=(i=(s=(r=e.fields)==null?void 0:r[Ac].arrayValue)==null?void 0:s.values)==null?void 0:i.map(o=>vt(o.doubleValue));return new Rs(n)}convertGeoPoint(e){return new As(vt(e.latitude),vt(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=py(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(sd(e));default:return null}}convertTimestamp(e){const n=gi(e);return new Je(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=Ge.fromString(e);ye(nM(r),9688,{name:e});const s=new $a(r.get(1),r.get(3)),i=new he(r.popFirst(5));return s.isEqual(n)||Bn(`Document ${i} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(t,e,n){let r;return r=t?t.toFirestore(e):e,r}class Xu{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ka extends eO{constructor(e,n,r,s,i,o){super(e,n,r,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Dp(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field(Py("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(Y.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=ka._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}ka._jsonSchemaVersion="firestore/documentSnapshot/1.0",ka._jsonSchema={type:Ht("string",ka._jsonSchemaVersion),bundleSource:Ht("string","DocumentSnapshot"),bundleName:Ht("string"),bundle:Ht("string")};class Dp extends ka{data(e={}){return super.data(e)}}class lc{constructor(e,n,r,s){this._firestore=e,this._userDataWriter=n,this._snapshot=s,this.metadata=new Xu(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new Dp(this._firestore,this._userDataWriter,r.key,r,new Xu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new ae(Y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(s,i){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map(a=>{const l=new Dp(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Xu(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}})}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter(a=>i||a.type!==3).map(a=>{const l=new Dp(s._firestore,s._userDataWriter,a.doc.key,a.doc,new Xu(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let c=-1,u=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),u=o.indexOf(a.doc.key)),{type:D8(a.type),doc:l,oldIndex:c,newIndex:u}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new ae(Y.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=lc._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Tx.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],r=[],s=[];return this.docs.forEach(i=>{i._document!==null&&(n.push(i._document),r.push(this._userDataWriter.convertObjectMap(i._document.data.value.mapValue.fields,"previous")),s.push(i.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function D8(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return ge(61501,{type:t})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lp(t){t=zr(t,Ft);const e=zr(t.firestore,Uo);return v8(nb(e),t._key).then(n=>j8(e,t,n))}lc._jsonSchemaVersion="firestore/querySnapshot/1.0",lc._jsonSchema={type:Ht("string",lc._jsonSchemaVersion),bundleSource:Ht("string","QuerySnapshot"),bundleName:Ht("string"),bundle:Ht("string")};class rO extends O8{constructor(e){super(),this.firestore=e}convertBytes(e){return new Nr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ft(this.firestore,null,n)}}function c0(t){t=zr(t,Bo);const e=zr(t.firestore,Uo),n=nb(e),r=new rO(e);return P8(t._query),w8(n,t._query).then(s=>new lc(e,r,t,s))}function L8(t,e,n){t=zr(t,Ft);const r=zr(t.firestore,Uo),s=nO(t.converter,e);return Oy(r,[JM(Ry(r),"setDoc",t._key,s,t.converter!==null,n).toMutation(t._key,Pn.none())])}function Vi(t,e,n,...r){t=zr(t,Ft);const s=zr(t.firestore,Uo),i=Ry(s);let o;return o=typeof(e=Ct(e))=="string"||e instanceof Iy?I8(i,"updateDoc",t._key,e,n,r):C8(i,"updateDoc",t._key,e),Oy(s,[o.toMutation(t._key,Pn.exists(!0))])}function sC(t){return Oy(zr(t.firestore,Uo),[new _y(t._key,Pn.none())])}function Bf(t,e){const n=zr(t.firestore,Uo),r=Qn(t),s=nO(t.converter,e);return Oy(n,[JM(Ry(t.firestore),"addDoc",r._key,s,t.converter!==null,{}).toMutation(r._key,Pn.exists(!1))]).then(()=>r)}function Oy(t,e){return function(r,s){const i=new Is;return r.asyncQueue.enqueueAndForget(async()=>o8(await y8(r),s,i)),i.promise}(nb(t),e)}function j8(t,e,n){const r=n.docs.get(e._key),s=new rO(t);return new ka(t,s,e._key,r,new Xu(n.hasPendingWrites,n.fromCache),e.converter)}function iC(t){return new sb("increment",t)}(function(e,n=!0){(function(s){Yc=s})(ll),Ba(new ko("firestore",(r,{instanceIdentifier:s,options:i})=>{const o=r.getProvider("app").getImmediate(),a=new Uo(new aU(r.getProvider("auth-internal")),new uU(o,r.getProvider("app-check-internal")),function(c,u){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new ae(Y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $a(c.options.projectId,u)}(o,s),o);return i={useFetchStreams:n,...i},a._setSettings(i),a},"PUBLIC").setMultipleInstances(!0)),Cs(DS,LS,e),Cs(DS,LS,"esm2020")})();function sO(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const V8=sO,iO=new Md("auth","Firebase",sO());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fm=new wx("@firebase/auth");function F8(t,...e){Fm.logLevel<=ze.WARN&&Fm.warn(`Auth (${ll}): ${t}`,...e)}function jp(t,...e){Fm.logLevel<=ze.ERROR&&Fm.error(`Auth (${ll}): ${t}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cs(t,...e){throw db(t,...e)}function Ns(t,...e){return db(t,...e)}function oO(t,e,n){const r={...V8(),[e]:n};return new Md("auth","Firebase",r).create(e,{appName:t.name})}function oi(t){return oO(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function db(t,...e){if(typeof t!="string"){const n=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=t.name),t._errorFactory.create(n,...r)}return iO.create(t,...e)}function Se(t,e,...n){if(!t)throw db(e,...n)}function ti(t){const e="INTERNAL ASSERTION FAILED: "+t;throw jp(e),new Error(e)}function vi(t,e){t||ti(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T1(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.href)||""}function B8(){return oC()==="http:"||oC()==="https:"}function oC(){var t;return typeof self<"u"&&((t=self.location)==null?void 0:t.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U8(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(B8()||B6()||"connection"in navigator)?navigator.onLine:!0}function z8(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{constructor(e,n){this.shortDelay=e,this.longDelay=n,vi(n>e,"Short delay should be less than long delay!"),this.isMobile=V6()||U6()}get(){return U8()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fb(t,e){vi(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aO{static initialize(e,n,r){this.fetchImpl=e,n&&(this.headersImpl=n),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ti("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ti("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ti("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $8={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H8=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],W8=new Wd(3e4,6e4);function zo(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function Ti(t,e,n,r,s={}){return lO(t,s,async()=>{let i={},o={};r&&(e==="GET"?o=r:i={body:JSON.stringify(r)});const a=Od({key:t.config.apiKey,...o}).slice(1),l=await t._getAdditionalHeaders();l["Content-Type"]="application/json",t.languageCode&&(l["X-Firebase-Locale"]=t.languageCode);const c={method:e,headers:l,...i};return F6()||(c.referrerPolicy="no-referrer"),t.emulatorConfig&&jo(t.emulatorConfig.host)&&(c.credentials="include"),aO.fetch()(await cO(t,t.config.apiHost,n,a),c)})}async function lO(t,e,n){t._canInitEmulator=!1;const r={...$8,...e};try{const s=new K8(t),i=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const o=await i.json();if("needConfirmation"in o)throw Uf(t,"account-exists-with-different-credential",o);if(i.ok&&!("errorMessage"in o))return o;{const a=i.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Uf(t,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw Uf(t,"email-already-in-use",o);if(l==="USER_DISABLED")throw Uf(t,"user-disabled",o);const u=r[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw oO(t,u,c);cs(t,u)}}catch(s){if(s instanceof js)throw s;cs(t,"network-request-failed",{message:String(s)})}}async function qd(t,e,n,r,s={}){const i=await Ti(t,e,n,r,s);return"mfaPendingCredential"in i&&cs(t,"multi-factor-auth-required",{_serverResponse:i}),i}async function cO(t,e,n,r){const s=`${e}${n}?${r}`,i=t,o=i.config.emulator?fb(t.config,s):`${t.config.apiScheme}://${s}`;return H8.includes(n)&&(await i._persistenceManagerAvailable,i._getPersistenceType()==="COOKIE")?i._getPersistence()._getFinalTarget(o).toString():o}function q8(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class K8{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,r)=>{this.timer=setTimeout(()=>r(Ns(this.auth,"network-request-failed")),W8.get())})}}function Uf(t,e,n){const r={appName:t.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);const s=Ns(t,e,r);return s.customData._tokenResponse=n,s}function aC(t){return t!==void 0&&t.enterprise!==void 0}class G8{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return q8(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Q8(t,e){return Ti(t,"GET","/v2/recaptchaConfig",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function J8(t,e){return Ti(t,"POST","/v1/accounts:delete",e)}async function Bm(t,e){return Ti(t,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xh(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function X8(t,e=!1){const n=Ct(t),r=await n.getIdToken(e),s=pb(r);Se(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const i=typeof s.firebase=="object"?s.firebase:void 0,o=i==null?void 0:i.sign_in_provider;return{claims:s,token:r,authTime:xh(u0(s.auth_time)),issuedAtTime:xh(u0(s.iat)),expirationTime:xh(u0(s.exp)),signInProvider:o||null,signInSecondFactor:(i==null?void 0:i.sign_in_second_factor)||null}}function u0(t){return Number(t)*1e3}function pb(t){const[e,n,r]=t.split(".");if(e===void 0||n===void 0||r===void 0)return jp("JWT malformed, contained fewer than 3 sections"),null;try{const s=T2(n);return s?JSON.parse(s):(jp("Failed to decode base64 JWT payload"),null)}catch(s){return jp("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function lC(t){const e=pb(t);return Se(e,"internal-error"),Se(typeof e.exp<"u","internal-error"),Se(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Vc(t,e,n=!1){if(n)return e;try{return await e}catch(r){throw r instanceof js&&Y8(r)&&t.auth.currentUser===t&&await t.auth.signOut(),r}}function Y8({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z8{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const r=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=xh(this.lastLoginAt),this.creationTime=xh(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Um(t){var h;const e=t.auth,n=await t.getIdToken(),r=await Vc(t,Bm(e,{idToken:n}));Se(r==null?void 0:r.users.length,e,"internal-error");const s=r.users[0];t._notifyReloadListener(s);const i=(h=s.providerUserInfo)!=null&&h.length?uO(s.providerUserInfo):[],o=tH(t.providerData,i),a=t.isAnonymous,l=!(t.email&&s.passwordHash)&&!(o!=null&&o.length),c=a?l:!1,u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new E1(s.createdAt,s.lastLoginAt),isAnonymous:c};Object.assign(t,u)}async function eH(t){const e=Ct(t);await Um(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function tH(t,e){return[...t.filter(r=>!e.some(s=>s.providerId===r.providerId)),...e]}function uO(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nH(t,e){const n=await lO(t,{},async()=>{const r=Od({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:i}=t.config,o=await cO(t,s,"/v1/token",`key=${i}`),a=await t._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:r};return t.emulatorConfig&&jo(t.emulatorConfig.host)&&(l.credentials="include"),aO.fetch()(o,l)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function rH(t,e){return Ti(t,"POST","/v2/accounts:revokeToken",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cc{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Se(e.idToken,"internal-error"),Se(typeof e.idToken<"u","internal-error"),Se(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):lC(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Se(e.length!==0,"internal-error");const n=lC(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Se(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:r,refreshToken:s,expiresIn:i}=await nH(e,n);this.updateTokensAndExpiration(r,s,Number(i))}updateTokensAndExpiration(e,n,r){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,n){const{refreshToken:r,accessToken:s,expirationTime:i}=n,o=new cc;return r&&(Se(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),s&&(Se(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),i&&(Se(typeof i=="number","internal-error",{appName:e}),o.expirationTime=i),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new cc,this.toJSON())}_performRefresh(){return ti("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Di(t,e){Se(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class ts{constructor({uid:e,auth:n,stsTokenManager:r,...s}){this.providerId="firebase",this.proactiveRefresh=new Z8(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new E1(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const n=await Vc(this,this.stsTokenManager.getToken(this.auth,e));return Se(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return X8(this,e)}reload(){return eH(this)}_assign(e){this!==e&&(Se(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new ts({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Se(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),n&&await Um(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(ur(this.auth.app))return Promise.reject(oi(this.auth));const e=await this.getIdToken();return await Vc(this,J8(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const r=n.displayName??void 0,s=n.email??void 0,i=n.phoneNumber??void 0,o=n.photoURL??void 0,a=n.tenantId??void 0,l=n._redirectEventId??void 0,c=n.createdAt??void 0,u=n.lastLoginAt??void 0,{uid:h,emailVerified:d,isAnonymous:f,providerData:g,stsTokenManager:y}=n;Se(h&&y,e,"internal-error");const v=cc.fromJSON(this.name,y);Se(typeof h=="string",e,"internal-error"),Di(r,e.name),Di(s,e.name),Se(typeof d=="boolean",e,"internal-error"),Se(typeof f=="boolean",e,"internal-error"),Di(i,e.name),Di(o,e.name),Di(a,e.name),Di(l,e.name),Di(c,e.name),Di(u,e.name);const w=new ts({uid:h,auth:e,email:s,emailVerified:d,displayName:r,isAnonymous:f,photoURL:o,phoneNumber:i,tenantId:a,stsTokenManager:v,createdAt:c,lastLoginAt:u});return g&&Array.isArray(g)&&(w.providerData=g.map(T=>({...T}))),l&&(w._redirectEventId=l),w}static async _fromIdTokenResponse(e,n,r=!1){const s=new cc;s.updateFromServerResponse(n);const i=new ts({uid:n.localId,auth:e,stsTokenManager:s,isAnonymous:r});return await Um(i),i}static async _fromGetAccountInfoResponse(e,n,r){const s=n.users[0];Se(s.localId!==void 0,"internal-error");const i=s.providerUserInfo!==void 0?uO(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(i!=null&&i.length),a=new cc;a.updateFromIdToken(r);const l=new ts({uid:s.localId,auth:e,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:i,metadata:new E1(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(i!=null&&i.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cC=new Map;function ni(t){vi(t instanceof Function,"Expected a class definition");let e=cC.get(t);return e?(vi(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,cC.set(t,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hO{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}hO.type="NONE";const uC=hO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vp(t,e,n){return`firebase:${t}:${e}:${n}`}class uc{constructor(e,n,r){this.persistence=e,this.auth=n,this.userKey=r;const{config:s,name:i}=this.auth;this.fullUserKey=Vp(this.userKey,s.apiKey,i),this.fullPersistenceKey=Vp("persistence",s.apiKey,i),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Bm(this.auth,{idToken:e}).catch(()=>{});return n?ts._fromGetAccountInfoResponse(this.auth,n,e):null}return ts._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,r="authUser"){if(!n.length)return new uc(ni(uC),e,r);const s=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let i=s[0]||ni(uC);const o=Vp(r,e.config.apiKey,e.name);let a=null;for(const c of n)try{const u=await c._get(o);if(u){let h;if(typeof u=="string"){const d=await Bm(e,{idToken:u}).catch(()=>{});if(!d)break;h=await ts._fromGetAccountInfoResponse(e,d,u)}else h=ts._fromJSON(e,u);c!==i&&(a=h),i=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!i._shouldAllowMigration||!l.length?new uc(i,e,r):(i=l[0],a&&await i._set(o,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==i)try{await c._remove(o)}catch{}})),new uc(i,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hC(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(mO(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(dO(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(yO(e))return"Blackberry";if(vO(e))return"Webos";if(fO(e))return"Safari";if((e.includes("chrome/")||pO(e))&&!e.includes("edge/"))return"Chrome";if(gO(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=t.match(n);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function dO(t=Zt()){return/firefox\//i.test(t)}function fO(t=Zt()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function pO(t=Zt()){return/crios\//i.test(t)}function mO(t=Zt()){return/iemobile/i.test(t)}function gO(t=Zt()){return/android/i.test(t)}function yO(t=Zt()){return/blackberry/i.test(t)}function vO(t=Zt()){return/webos/i.test(t)}function mb(t=Zt()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function sH(t=Zt()){var e;return mb(t)&&!!((e=window.navigator)!=null&&e.standalone)}function iH(){return z6()&&document.documentMode===10}function wO(t=Zt()){return mb(t)||gO(t)||vO(t)||yO(t)||/windows phone/i.test(t)||mO(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _O(t,e=[]){let n;switch(t){case"Browser":n=hC(Zt());break;case"Worker":n=`${hC(Zt())}-${t}`;break;default:n=t}const r=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${ll}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oH{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const r=i=>new Promise((o,a)=>{try{const l=e(i);o(l)}catch(l){a(l)}});r.onAbort=n,this.queue.push(r);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const r of this.queue)await r(e),r.onAbort&&n.push(r.onAbort)}catch(r){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function aH(t,e={}){return Ti(t,"GET","/v2/passwordPolicy",zo(t,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lH=6;class cH{constructor(e){var r;const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??lH,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=((r=e.allowedNonAlphanumericCharacters)==null?void 0:r.join(""))??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const r=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;r&&(n.meetsMinPasswordLength=e.length>=r),s&&(n.meetsMaxPasswordLength=e.length<=s)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let r;for(let s=0;s<e.length;s++)r=e.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,n,r,s,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uH{constructor(e,n,r,s){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=r,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dC(this),this.idTokenSubscription=new dC(this),this.beforeStateQueue=new oH(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=iO,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(i=>this._resolvePersistenceManagerAvailable=i)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=ni(n)),this._initializationPromise=this.queue(async()=>{var r,s,i;if(!this._deleted&&(this.persistenceManager=await uc.create(this,e),(r=this._resolvePersistenceManagerAvailable)==null||r.call(this),!this._deleted)){if((s=this._popupRedirectResolver)!=null&&s._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((i=this.currentUser)==null?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Bm(this,{idToken:e}),r=await ts._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(r)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var i;if(ur(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let r=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(i=this.redirectUser)==null?void 0:i._redirectEventId,a=r==null?void 0:r._redirectEventId,l=await this.tryRedirectSignIn(e);(!o||o===a)&&(l!=null&&l.user)&&(r=l.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(r)}catch(o){r=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return Se(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Um(e)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=z8()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(ur(this.app))return Promise.reject(oi(this));const n=e?Ct(e):null;return n&&Se(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Se(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return ur(this.app)?Promise.reject(oi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return ur(this.app)?Promise.reject(oi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ni(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await aH(this),n=new cH(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Md("auth","Firebase",e())}onAuthStateChanged(e,n,r){return this.registerStateListener(this.authStateSubscription,e,n,r)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,r){return this.registerStateListener(this.idTokenSubscription,e,n,r)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(r.tenantId=this.tenantId),await rH(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)==null?void 0:e.toJSON()}}async _setRedirectUser(e,n){const r=await this.getOrInitRedirectPersistenceManager(n);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&ni(e)||this._popupRedirectResolver;Se(n,this,"argument-error"),this.redirectPersistenceManager=await uc.create(this,[ni(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var n,r;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)==null?void 0:n._redirectEventId)===e?this._currentUser:((r=this.redirectUser)==null?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=((n=this.currentUser)==null?void 0:n.uid)??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,r,s){if(this._deleted)return()=>{};const i=typeof n=="function"?n:n.next.bind(n);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(Se(a,this,"internal-error"),a.then(()=>{o||i(this.currentUser)}),typeof n=="function"){const l=e.addObserver(n,r,s);return()=>{o=!0,l()}}else{const l=e.addObserver(n);return()=>{o=!0,l()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Se(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=_O(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var s;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await((s=this.heartbeatServiceProvider.getImmediate({optional:!0}))==null?void 0:s.getHeartbeatsHeader());n&&(e["X-Firebase-Client"]=n);const r=await this._getAppCheckToken();return r&&(e["X-Firebase-AppCheck"]=r),e}async _getAppCheckToken(){var n;if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await((n=this.appCheckServiceProvider.getImmediate({optional:!0}))==null?void 0:n.getToken());return e!=null&&e.error&&F8(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function hl(t){return Ct(t)}class dC{constructor(e){this.auth=e,this.observer=null,this.addObserver=G6(n=>this.observer=n)}get next(){return Se(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Dy={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function hH(t){Dy=t}function xO(t){return Dy.loadJS(t)}function dH(){return Dy.recaptchaEnterpriseScript}function fH(){return Dy.gapiScript}function pH(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class mH{constructor(){this.enterprise=new gH}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class gH{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const yH="recaptcha-enterprise",bO="NO_RECAPTCHA";class vH{constructor(e){this.type=yH,this.auth=hl(e)}async verify(e="verify",n=!1){async function r(i){if(!n){if(i.tenantId==null&&i._agentRecaptchaConfig!=null)return i._agentRecaptchaConfig.siteKey;if(i.tenantId!=null&&i._tenantRecaptchaConfigs[i.tenantId]!==void 0)return i._tenantRecaptchaConfigs[i.tenantId].siteKey}return new Promise(async(o,a)=>{Q8(i,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(l=>{if(l.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const c=new G8(l);return i.tenantId==null?i._agentRecaptchaConfig=c:i._tenantRecaptchaConfigs[i.tenantId]=c,o(c.siteKey)}}).catch(l=>{a(l)})})}function s(i,o,a){const l=window.grecaptcha;aC(l)?l.enterprise.ready(()=>{l.enterprise.execute(i,{action:e}).then(c=>{o(c)}).catch(()=>{o(bO)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new mH().execute("siteKey",{action:"verify"}):new Promise((i,o)=>{r(this.auth).then(a=>{if(!n&&aC(window.grecaptcha))s(a,i,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}let l=dH();l.length!==0&&(l+=a),xO(l).then(()=>{s(a,i,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function fC(t,e,n,r=!1,s=!1){const i=new vH(t);let o;if(s)o=bO;else try{o=await i.verify(n)}catch{o=await i.verify(n,!0)}const a={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in a){const l=a.phoneEnrollmentInfo.phoneNumber,c=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:l,recaptchaToken:c,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const l=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:l,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function S1(t,e,n,r,s){var i;if((i=t._getRecaptchaConfig())!=null&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await fC(t,e,n,n==="getOobCode");return r(t,o)}else return r(t,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await fC(t,e,n,n==="getOobCode");return r(t,a)}else return Promise.reject(o)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wH(t,e){const n=ay(t,"auth");if(n.isInitialized()){const s=n.getImmediate(),i=n.getOptions();if(Fa(i,e??{}))return s;cs(s,"already-initialized")}return n.initialize({options:e})}function _H(t,e){const n=(e==null?void 0:e.persistence)||[],r=(Array.isArray(n)?n:[n]).map(ni);e!=null&&e.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function xH(t,e,n){const r=hl(t);Se(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const s=!1,i=TO(e),{host:o,port:a}=bH(e),l=a===null?"":`:${a}`,c={url:`${i}//${o}${l}/`},u=Object.freeze({host:o,port:a,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!r._canInitEmulator){Se(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Se(Fa(c,r.config.emulator)&&Fa(u,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=u,r.settings.appVerificationDisabledForTesting=!0,jo(o)?(yx(`${i}//${o}${l}`),vx("Auth",!0)):TH()}function TO(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function bH(t){const e=TO(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const r=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(r);if(s){const i=s[1];return{host:i,port:pC(r.substr(i.length+1))}}else{const[i,o]=r.split(":");return{host:i,port:pC(o)}}}function pC(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function TH(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gb{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return ti("not implemented")}_getIdTokenResponse(e){return ti("not implemented")}_linkToIdToken(e,n){return ti("not implemented")}_getReauthenticationResolver(e){return ti("not implemented")}}async function EH(t,e){return Ti(t,"POST","/v1/accounts:signUp",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SH(t,e){return qd(t,"POST","/v1/accounts:signInWithPassword",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kH(t,e){return qd(t,"POST","/v1/accounts:signInWithEmailLink",zo(t,e))}async function CH(t,e){return qd(t,"POST","/v1/accounts:signInWithEmailLink",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hd extends gb{constructor(e,n,r,s=null){super("password",r),this._email=e,this._password=n,this._tenantId=s}static _fromEmailAndPassword(e,n){return new hd(e,n,"password")}static _fromEmailAndCode(e,n,r=null){return new hd(e,n,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n!=null&&n.email&&(n!=null&&n.password)){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return S1(e,n,"signInWithPassword",SH);case"emailLink":return kH(e,{email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const r={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return S1(e,r,"signUpPassword",EH);case"emailLink":return CH(e,{idToken:n,email:this._email,oobCode:this._password});default:cs(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hc(t,e){return qd(t,"POST","/v1/accounts:signInWithIdp",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IH="http://localhost";class Qa extends gb{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Qa(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):cs("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:s,...i}=n;if(!r||!s)return null;const o=new Qa(r,s);return o.idToken=i.idToken||void 0,o.accessToken=i.accessToken||void 0,o.secret=i.secret,o.nonce=i.nonce,o.pendingToken=i.pendingToken||null,o}_getIdTokenResponse(e){const n=this.buildRequest();return hc(e,n)}_linkToIdToken(e,n){const r=this.buildRequest();return r.idToken=n,hc(e,r)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,hc(e,n)}buildRequest(){const e={requestUri:IH,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=Od(n)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AH(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function RH(t){const e=Wu(qu(t)).link,n=e?Wu(qu(e)).deep_link_id:null,r=Wu(qu(t)).deep_link_id;return(r?Wu(qu(r)).link:null)||r||n||e||t}class yb{constructor(e){const n=Wu(qu(e)),r=n.apiKey??null,s=n.oobCode??null,i=AH(n.mode??null);Se(r&&s&&i,"argument-error"),this.apiKey=r,this.operation=i,this.code=s,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=RH(e);try{return new yb(n)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nu{constructor(){this.providerId=nu.PROVIDER_ID}static credential(e,n){return hd._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const r=yb.parseLink(n);return Se(r,"argument-error"),hd._fromEmailAndCode(e,r.code,r.tenantId)}}nu.PROVIDER_ID="password";nu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";nu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EO{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd extends EO{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gi extends Kd{constructor(){super("facebook.com")}static credential(e){return Qa._fromParams({providerId:Gi.PROVIDER_ID,signInMethod:Gi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Gi.credentialFromTaggedObject(e)}static credentialFromError(e){return Gi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Gi.credential(e.oauthAccessToken)}catch{return null}}}Gi.FACEBOOK_SIGN_IN_METHOD="facebook.com";Gi.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js extends Kd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Qa._fromParams({providerId:Js.PROVIDER_ID,signInMethod:Js.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Js.credentialFromTaggedObject(e)}static credentialFromError(e){return Js.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:r}=e;if(!n&&!r)return null;try{return Js.credential(n,r)}catch{return null}}}Js.GOOGLE_SIGN_IN_METHOD="google.com";Js.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qi extends Kd{constructor(){super("github.com")}static credential(e){return Qa._fromParams({providerId:Qi.PROVIDER_ID,signInMethod:Qi.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Qi.credentialFromTaggedObject(e)}static credentialFromError(e){return Qi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Qi.credential(e.oauthAccessToken)}catch{return null}}}Qi.GITHUB_SIGN_IN_METHOD="github.com";Qi.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ji extends Kd{constructor(){super("twitter.com")}static credential(e,n){return Qa._fromParams({providerId:Ji.PROVIDER_ID,signInMethod:Ji.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Ji.credentialFromTaggedObject(e)}static credentialFromError(e){return Ji.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:r}=e;if(!n||!r)return null;try{return Ji.credential(n,r)}catch{return null}}}Ji.TWITTER_SIGN_IN_METHOD="twitter.com";Ji.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function NH(t,e){return qd(t,"POST","/v1/accounts:signUp",zo(t,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ja{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,r,s=!1){const i=await ts._fromIdTokenResponse(e,r,s),o=mC(r);return new Ja({user:i,providerId:o,_tokenResponse:r,operationType:n})}static async _forOperation(e,n,r){await e._updateTokensIfNecessary(r,!0);const s=mC(r);return new Ja({user:e,providerId:s,_tokenResponse:r,operationType:n})}}function mC(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zm extends js{constructor(e,n,r,s){super(n.code,n.message),this.operationType=r,this.user=s,Object.setPrototypeOf(this,zm.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,n,r,s){return new zm(e,n,r,s)}}function SO(t,e,n,r){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(i=>{throw i.code==="auth/multi-factor-auth-required"?zm._fromErrorAndOperation(t,i,e,r):i})}async function PH(t,e,n=!1){const r=await Vc(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return Ja._forOperation(t,"link",r)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MH(t,e,n=!1){const{auth:r}=t;if(ur(r.app))return Promise.reject(oi(r));const s="reauthenticate";try{const i=await Vc(t,SO(r,s,e,t),n);Se(i.idToken,r,"internal-error");const o=pb(i.idToken);Se(o,r,"internal-error");const{sub:a}=o;return Se(t.uid===a,r,"user-mismatch"),Ja._forOperation(t,s,i)}catch(i){throw(i==null?void 0:i.code)==="auth/user-not-found"&&cs(r,"user-mismatch"),i}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kO(t,e,n=!1){if(ur(t.app))return Promise.reject(oi(t));const r="signIn",s=await SO(t,r,e),i=await Ja._fromIdTokenResponse(t,r,s);return n||await t._updateCurrentUser(i.user),i}async function OH(t,e){return kO(hl(t),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function CO(t){const e=hl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function DH(t,e,n){if(ur(t.app))return Promise.reject(oi(t));const r=hl(t),o=await S1(r,{returnSecureToken:!0,email:e,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",NH).catch(l=>{throw l.code==="auth/password-does-not-meet-requirements"&&CO(t),l}),a=await Ja._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function LH(t,e,n){return ur(t.app)?Promise.reject(oi(t)):OH(Ct(t),nu.credential(e,n)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&CO(t),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jH(t,e){return Ti(t,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function IO(t,{displayName:e,photoURL:n}){if(e===void 0&&n===void 0)return;const r=Ct(t),i={idToken:await r.getIdToken(),displayName:e,photoUrl:n,returnSecureToken:!0},o=await Vc(r,jH(r.auth,i));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:l})=>l==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function VH(t,e,n,r){return Ct(t).onIdTokenChanged(e,n,r)}function FH(t,e,n){return Ct(t).beforeAuthStateChanged(e,n)}function BH(t){return Ct(t).signOut()}const $m="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AO{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem($m,"1"),this.storage.removeItem($m),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UH=1e3,zH=10;class RO extends AO{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=wO(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const r=this.storage.getItem(n),s=this.localCache[n];r!==s&&e(n,s,r)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const r=e.key;n?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(r);!n&&this.localCache[r]===o||this.notifyListeners(r,o)},i=this.storage.getItem(r);iH()&&i!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,zH):s()}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:r}),!0)})},UH)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}RO.type="LOCAL";const $H=RO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NO extends AO{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}NO.type="SESSION";const PO=NO;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HH(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ly{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(s=>s.isListeningto(e));if(n)return n;const r=new Ly(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:r,eventType:s,data:i}=n.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;n.ports[0].postMessage({status:"ack",eventId:r,eventType:s});const a=Array.from(o).map(async c=>c(n.origin,i)),l=await HH(a);n.ports[0].postMessage({status:"done",eventId:r,eventType:s,response:l})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ly.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vb(t="",e=10){let n="";for(let r=0;r<e;r++)n+=Math.floor(Math.random()*10);return t+n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WH{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,r=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let i,o;return new Promise((a,l)=>{const c=vb("",20);s.port1.start();const u=setTimeout(()=>{l(new Error("unsupported_event"))},r);o={messageChannel:s,onMessage(h){const d=h;if(d.data.eventId===c)switch(d.data.status){case"ack":clearTimeout(u),i=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(i),a(d.data.response);break;default:clearTimeout(u),clearTimeout(i),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:c,data:n},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(){return window}function qH(t){Ps().location.href=t}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MO(){return typeof Ps().WorkerGlobalScope<"u"&&typeof Ps().importScripts=="function"}async function KH(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function GH(){var t;return((t=navigator==null?void 0:navigator.serviceWorker)==null?void 0:t.controller)||null}function QH(){return MO()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OO="firebaseLocalStorageDb",JH=1,Hm="firebaseLocalStorage",DO="fbase_key";class Gd{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function jy(t,e){return t.transaction([Hm],e?"readwrite":"readonly").objectStore(Hm)}function XH(){const t=indexedDB.deleteDatabase(OO);return new Gd(t).toPromise()}function k1(){const t=indexedDB.open(OO,JH);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const r=t.result;try{r.createObjectStore(Hm,{keyPath:DO})}catch(s){n(s)}}),t.addEventListener("success",async()=>{const r=t.result;r.objectStoreNames.contains(Hm)?e(r):(r.close(),await XH(),e(await k1()))})})}async function gC(t,e,n){const r=jy(t,!0).put({[DO]:e,value:n});return new Gd(r).toPromise()}async function YH(t,e){const n=jy(t,!1).get(e),r=await new Gd(n).toPromise();return r===void 0?null:r.value}function yC(t,e){const n=jy(t,!0).delete(e);return new Gd(n).toPromise()}const ZH=800,e9=3;class LO{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await k1(),this.db)}async _withRetries(e){let n=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(n++>e9)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return MO()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ly._getInstance(QH()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){var n,r;if(this.activeServiceWorker=await KH(),!this.activeServiceWorker)return;this.sender=new WH(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&(n=e[0])!=null&&n.fulfilled&&(r=e[0])!=null&&r.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||GH()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await k1();return await gC(e,$m,"1"),await yC(e,$m),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(r=>gC(r,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(r=>YH(r,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>yC(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const i=jy(s,!1).getAll();return new Gd(i).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],r=new Set;if(e.length!==0)for(const{fbase_key:s,value:i}of e)r.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(i)&&(this.notifyListeners(s,i),n.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!r.has(s)&&(this.notifyListeners(s,null),n.push(s));return n}notifyListeners(e,n){this.localCache[e]=n;const r=this.listeners[e];if(r)for(const s of Array.from(r))s(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),ZH)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}LO.type="LOCAL";const t9=LO;new Wd(3e4,6e4);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function n9(t,e){return e?ni(e):(Se(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wb extends gb{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hc(e,this._buildIdpRequest())}_linkToIdToken(e,n){return hc(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return hc(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function r9(t){return kO(t.auth,new wb(t),t.bypassAuthState)}function s9(t){const{auth:e,user:n}=t;return Se(n,e,"internal-error"),MH(n,new wb(t),t.bypassAuthState)}async function i9(t){const{auth:e,user:n}=t;return Se(n,e,"internal-error"),PH(n,new wb(t),t.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jO{constructor(e,n,r,s,i=!1){this.auth=e,this.resolver=r,this.user=s,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:r,postBody:s,tenantId:i,error:o,type:a}=e;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:n,sessionId:r,tenantId:i||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return r9;case"linkViaPopup":case"linkViaRedirect":return i9;case"reauthViaPopup":case"reauthViaRedirect":return s9;default:cs(this.auth,"internal-error")}}resolve(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){vi(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o9=new Wd(2e3,1e4);class Jl extends jO{constructor(e,n,r,s,i){super(e,n,s,i),this.provider=r,this.authWindow=null,this.pollId=null,Jl.currentPopupAction&&Jl.currentPopupAction.cancel(),Jl.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Se(e,this.auth,"internal-error"),e}async onExecution(){vi(this.filter.length===1,"Popup operations only handle one event");const e=vb();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(Ns(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)==null?void 0:e.associatedEvent)||null}cancel(){this.reject(Ns(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Jl.currentPopupAction=null}pollUserCancellation(){const e=()=>{var n,r;if((r=(n=this.authWindow)==null?void 0:n.window)!=null&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ns(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,o9.get())};e()}}Jl.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a9="pendingRedirect",Fp=new Map;class l9 extends jO{constructor(e,n,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,r),this.eventId=null}async execute(){let e=Fp.get(this.auth._key());if(!e){try{const r=await c9(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(n){e=()=>Promise.reject(n)}Fp.set(this.auth._key(),e)}return this.bypassAuthState||Fp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function c9(t,e){const n=d9(e),r=h9(t);if(!await r._isAvailable())return!1;const s=await r._get(n)==="true";return await r._remove(n),s}function u9(t,e){Fp.set(t._key(),e)}function h9(t){return ni(t._redirectPersistence)}function d9(t){return Vp(a9,t.config.apiKey,t.name)}async function f9(t,e,n=!1){if(ur(t.app))return Promise.reject(oi(t));const r=hl(t),s=n9(r,e),o=await new l9(r,s,n).execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const p9=10*60*1e3;class m9{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(n=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!g9(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){var r;if(e.error&&!VO(e)){const s=((r=e.error.code)==null?void 0:r.split("auth/")[1])||"internal-error";n.onError(Ns(this.auth,s))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const r=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=p9&&this.cachedEventUids.clear(),this.cachedEventUids.has(vC(e))}saveEventToCache(e){this.cachedEventUids.add(vC(e)),this.lastProcessedEventTime=Date.now()}}function vC(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function VO({type:t,error:e}){return t==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function g9(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return VO(t);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function y9(t,e={}){return Ti(t,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const v9=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,w9=/^https?/;async function _9(t){if(t.config.emulator)return;const{authorizedDomains:e}=await y9(t);for(const n of e)try{if(x9(n))return}catch{}cs(t,"unauthorized-domain")}function x9(t){const e=T1(),{protocol:n,hostname:r}=new URL(e);if(t.startsWith("chrome-extension://")){const o=new URL(t);return o.hostname===""&&r===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&o.hostname===r}if(!w9.test(n))return!1;if(v9.test(t))return r===t;const s=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b9=new Wd(3e4,6e4);function wC(){const t=Ps().___jsl;if(t!=null&&t.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function T9(t){return new Promise((e,n)=>{var s,i,o;function r(){wC(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{wC(),n(Ns(t,"network-request-failed"))},timeout:b9.get()})}if((i=(s=Ps().gapi)==null?void 0:s.iframes)!=null&&i.Iframe)e(gapi.iframes.getContext());else if((o=Ps().gapi)!=null&&o.load)r();else{const a=pH("iframefcb");return Ps()[a]=()=>{gapi.load?r():n(Ns(t,"network-request-failed"))},xO(`${fH()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw Bp=null,e})}let Bp=null;function E9(t){return Bp=Bp||T9(t),Bp}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S9=new Wd(5e3,15e3),k9="__/auth/iframe",C9="emulator/auth/iframe",I9={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},A9=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function R9(t){const e=t.config;Se(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?fb(e,C9):`https://${t.config.authDomain}/${k9}`,r={apiKey:e.apiKey,appName:t.name,v:ll},s=A9.get(t.config.apiHost);s&&(r.eid=s);const i=t._getFrameworks();return i.length&&(r.fw=i.join(",")),`${n}?${Od(r).slice(1)}`}async function N9(t){const e=await E9(t),n=Ps().gapi;return Se(n,t,"internal-error"),e.open({where:document.body,url:R9(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:I9,dontclear:!0},r=>new Promise(async(s,i)=>{await r.restyle({setHideOnLeave:!1});const o=Ns(t,"network-request-failed"),a=Ps().setTimeout(()=>{i(o)},S9.get());function l(){Ps().clearTimeout(a),s(r)}r.ping(l).then(l,()=>{i(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P9={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},M9=500,O9=600,D9="_blank",L9="http://localhost";class _C{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function j9(t,e,n,r=M9,s=O9){const i=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const l={...P9,width:r.toString(),height:s.toString(),top:i,left:o},c=Zt().toLowerCase();n&&(a=pO(c)?D9:n),dO(c)&&(e=e||L9,l.scrollbars="yes");const u=Object.entries(l).reduce((d,[f,g])=>`${d}${f}=${g},`,"");if(sH(c)&&a!=="_self")return V9(e||"",a),new _C(null);const h=window.open(e||"",a,u);Se(h,t,"popup-blocked");try{h.focus()}catch{}return new _C(h)}function V9(t,e){const n=document.createElement("a");n.href=t,n.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const F9="__/auth/handler",B9="emulator/auth/handler",U9=encodeURIComponent("fac");async function xC(t,e,n,r,s,i){Se(t.config.authDomain,t,"auth-domain-config-required"),Se(t.config.apiKey,t,"invalid-api-key");const o={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:r,v:ll,eventId:s};if(e instanceof EO){e.setDefaultLanguage(t.languageCode),o.providerId=e.providerId||"",K6(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[u,h]of Object.entries({}))o[u]=h}if(e instanceof Kd){const u=e.getScopes().filter(h=>h!=="");u.length>0&&(o.scopes=u.join(","))}t.tenantId&&(o.tid=t.tenantId);const a=o;for(const u of Object.keys(a))a[u]===void 0&&delete a[u];const l=await t._getAppCheckToken(),c=l?`#${U9}=${encodeURIComponent(l)}`:"";return`${z9(t)}?${Od(a).slice(1)}${c}`}function z9({config:t}){return t.emulator?fb(t,B9):`https://${t.authDomain}/${F9}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const h0="webStorageSupport";class $9{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=PO,this._completeRedirectFn=f9,this._overrideRedirectResult=u9}async _openPopup(e,n,r,s){var o;vi((o=this.eventManagers[e._key()])==null?void 0:o.manager,"_initialize() not called before _openPopup()");const i=await xC(e,n,r,T1(),s);return j9(e,i,vb())}async _openRedirect(e,n,r,s){await this._originValidation(e);const i=await xC(e,n,r,T1(),s);return qH(i),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:s,promise:i}=this.eventManagers[n];return s?Promise.resolve(s):(vi(i,"If manager is not set, promise should be"),i)}const r=this.initAndGetManager(e);return this.eventManagers[n]={promise:r},r.catch(()=>{delete this.eventManagers[n]}),r}async initAndGetManager(e){const n=await N9(e),r=new m9(e);return n.register("authEvent",s=>(Se(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:r.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=n,r}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(h0,{type:h0},s=>{var o;const i=(o=s==null?void 0:s[0])==null?void 0:o[h0];i!==void 0&&n(!!i),cs(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=_9(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return wO()||fO()||mb()}}const H9=$9;var bC="@firebase/auth",TC="1.12.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W9{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)==null?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Se(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q9(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function K9(t){Ba(new ko("auth",(e,{options:n})=>{const r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),i=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;Se(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const l={apiKey:o,authDomain:a,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:_O(t)},c=new uH(r,s,i,l);return _H(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,r)=>{e.getProvider("auth-internal").initialize()})),Ba(new ko("auth-internal",e=>{const n=hl(e.getProvider("auth").getImmediate());return(r=>new W9(r))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Cs(bC,TC,q9(t)),Cs(bC,TC,"esm2020")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G9=5*60,Q9=I2("authIdTokenMaxAge")||G9;let EC=null;const J9=t=>async e=>{const n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>Q9)return;const s=n==null?void 0:n.token;EC!==s&&(EC=s,await fetch(t,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function X9(t=xx()){const e=ay(t,"auth");if(e.isInitialized())return e.getImmediate();const n=wH(t,{popupRedirectResolver:H9,persistence:[t9,$H,PO]}),r=I2("authTokenSyncURL");if(r&&typeof isSecureContext=="boolean"&&isSecureContext){const i=new URL(r,location.origin);if(location.origin===i.origin){const o=J9(i.toString());FH(n,o,()=>o(n.currentUser)),VH(n,a=>o(a))}}const s=S2("auth");return s&&xH(n,`http://${s}`),n}function Y9(){var t;return((t=document.getElementsByTagName("head"))==null?void 0:t[0])??document}hH({loadJS(t){return new Promise((e,n)=>{const r=document.createElement("script");r.setAttribute("src",t),r.onload=e,r.onerror=s=>{const i=Ns("internal-error");i.customData=s,n(i)},r.type="text/javascript",r.charset="UTF-8",Y9().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});K9("Browser");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FO="firebasestorage.googleapis.com",BO="storageBucket",Z9=2*60*1e3,e7=10*60*1e3,t7=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class It extends js{constructor(e,n,r=0){super(d0(e),`Firebase Storage: ${n} (${d0(e)})`),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,It.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return d0(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var dt;(function(t){t.UNKNOWN="unknown",t.OBJECT_NOT_FOUND="object-not-found",t.BUCKET_NOT_FOUND="bucket-not-found",t.PROJECT_NOT_FOUND="project-not-found",t.QUOTA_EXCEEDED="quota-exceeded",t.UNAUTHENTICATED="unauthenticated",t.UNAUTHORIZED="unauthorized",t.UNAUTHORIZED_APP="unauthorized-app",t.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",t.INVALID_CHECKSUM="invalid-checksum",t.CANCELED="canceled",t.INVALID_EVENT_NAME="invalid-event-name",t.INVALID_URL="invalid-url",t.INVALID_DEFAULT_BUCKET="invalid-default-bucket",t.NO_DEFAULT_BUCKET="no-default-bucket",t.CANNOT_SLICE_BLOB="cannot-slice-blob",t.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",t.NO_DOWNLOAD_URL="no-download-url",t.INVALID_ARGUMENT="invalid-argument",t.INVALID_ARGUMENT_COUNT="invalid-argument-count",t.APP_DELETED="app-deleted",t.INVALID_ROOT_OPERATION="invalid-root-operation",t.INVALID_FORMAT="invalid-format",t.INTERNAL_ERROR="internal-error",t.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(dt||(dt={}));function d0(t){return"storage/"+t}function _b(){const t="An unknown error occurred, please check the error payload for server response.";return new It(dt.UNKNOWN,t)}function n7(t){return new It(dt.OBJECT_NOT_FOUND,"Object '"+t+"' does not exist.")}function r7(t){return new It(dt.QUOTA_EXCEEDED,"Quota for bucket '"+t+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function s7(){const t="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new It(dt.UNAUTHENTICATED,t)}function i7(){return new It(dt.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function o7(t){return new It(dt.UNAUTHORIZED,"User does not have permission to access '"+t+"'.")}function UO(){return new It(dt.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function zO(){return new It(dt.CANCELED,"User canceled the upload/download.")}function a7(t){return new It(dt.INVALID_URL,"Invalid URL '"+t+"'.")}function l7(t){return new It(dt.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+t+"'.")}function c7(){return new It(dt.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+BO+"' property when initializing the app?")}function $O(){return new It(dt.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function u7(){return new It(dt.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function h7(){return new It(dt.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function d7(t){return new It(dt.UNSUPPORTED_ENVIRONMENT,`${t} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function C1(t){return new It(dt.INVALID_ARGUMENT,t)}function HO(){return new It(dt.APP_DELETED,"The Firebase app was deleted.")}function f7(t){return new It(dt.INVALID_ROOT_OPERATION,"The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function bh(t,e){return new It(dt.INVALID_FORMAT,"String does not match format '"+t+"': "+e)}function Ou(t){throw new It(dt.INTERNAL_ERROR,"Internal error: "+t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mr{constructor(e,n){this.bucket=e,this.path_=n}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,n){let r;try{r=mr.makeFromUrl(e,n)}catch{return new mr(e,"")}if(r.path==="")return r;throw l7(e)}static makeFromUrl(e,n){let r=null;const s="([A-Za-z0-9.\\-_]+)";function i(R){R.path.charAt(R.path.length-1)==="/"&&(R.path_=R.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),l={bucket:1,path:3};function c(R){R.path_=decodeURIComponent(R.path)}const u="v[A-Za-z0-9_]+",h=n.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${s}/o${d}`,"i"),g={bucket:1,path:3},y=n===FO?"(?:storage.googleapis.com|storage.cloud.google.com)":n,v="([^?#]*)",w=new RegExp(`^https?://${y}/${s}/${v}`,"i"),E=[{regex:a,indices:l,postModify:i},{regex:f,indices:g,postModify:c},{regex:w,indices:{bucket:1,path:2},postModify:c}];for(let R=0;R<E.length;R++){const P=E[R],N=P.regex.exec(e);if(N){const k=N[P.indices.bucket];let _=N[P.indices.path];_||(_=""),r=new mr(k,_),P.postModify(r);break}}if(r==null)throw a7(e);return r}}class p7{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function m7(t,e,n){let r=1,s=null,i=null,o=!1,a=0;function l(){return a===2}let c=!1;function u(...v){c||(c=!0,e.apply(null,v))}function h(v){s=setTimeout(()=>{s=null,t(f,l())},v)}function d(){i&&clearTimeout(i)}function f(v,...w){if(c){d();return}if(v){d(),u.call(null,v,...w);return}if(l()||o){d(),u.call(null,v,...w);return}r<64&&(r*=2);let E;a===1?(a=2,E=0):E=(r+Math.random())*1e3,h(E)}let g=!1;function y(v){g||(g=!0,d(),!c&&(s!==null?(v||(a=2),clearTimeout(s),h(0)):v||(a=1)))}return h(0),i=setTimeout(()=>{o=!0,y(!0)},n),y}function g7(t){t(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function y7(t){return t!==void 0}function v7(t){return typeof t=="function"}function w7(t){return typeof t=="object"&&!Array.isArray(t)}function Vy(t){return typeof t=="string"||t instanceof String}function SC(t){return xb()&&t instanceof Blob}function xb(){return typeof Blob<"u"}function kC(t,e,n,r){if(r<e)throw C1(`Invalid value for '${t}'. Expected ${e} or greater.`);if(r>n)throw C1(`Invalid value for '${t}'. Expected ${n} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qd(t,e,n){let r=e;return n==null&&(r=`https://${e}`),`${n}://${r}/v0${t}`}function WO(t){const e=encodeURIComponent;let n="?";for(const r in t)if(t.hasOwnProperty(r)){const s=e(r)+"="+e(t[r]);n=n+s+"&"}return n=n.slice(0,-1),n}var Ca;(function(t){t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT"})(Ca||(Ca={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qO(t,e){const n=t>=500&&t<600,s=[408,429].indexOf(t)!==-1,i=e.indexOf(t)!==-1;return n||s||i}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _7{constructor(e,n,r,s,i,o,a,l,c,u,h,d=!0,f=!1){this.url_=e,this.method_=n,this.headers_=r,this.body_=s,this.successCodes_=i,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=l,this.timeout_=c,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.isUsingEmulator=f,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((g,y)=>{this.resolve_=g,this.reject_=y,this.start_()})}start_(){const e=(r,s)=>{if(s){r(!1,new zf(!1,null,!0));return}const i=this.connectionFactory_();this.pendingConnection_=i;const o=a=>{const l=a.loaded,c=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(l,c)};this.progressCallback_!==null&&i.addUploadProgressListener(o),i.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&i.removeUploadProgressListener(o),this.pendingConnection_=null;const a=i.getErrorCode()===Ca.NO_ERROR,l=i.getStatus();if(!a||qO(l,this.additionalRetryCodes_)&&this.retry){const u=i.getErrorCode()===Ca.ABORT;r(!1,new zf(!1,null,u));return}const c=this.successCodes_.indexOf(l)!==-1;r(!0,new zf(c,i))})},n=(r,s)=>{const i=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const l=this.callback_(a,a.getResponse());y7(l)?i(l):i()}catch(l){o(l)}else if(a!==null){const l=_b();l.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,l)):o(l)}else if(s.canceled){const l=this.appDelete_?HO():zO();o(l)}else{const l=UO();o(l)}};this.canceled_?n(!1,new zf(!1,null,!0)):this.backoffId_=m7(e,n,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&g7(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class zf{constructor(e,n,r){this.wasSuccessCode=e,this.connection=n,this.canceled=!!r}}function x7(t,e){e!==null&&e.length>0&&(t.Authorization="Firebase "+e)}function b7(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function T7(t,e){e&&(t["X-Firebase-GMPID"]=e)}function E7(t,e){e!==null&&(t["X-Firebase-AppCheck"]=e)}function S7(t,e,n,r,s,i,o=!0,a=!1){const l=WO(t.urlParams),c=t.url+l,u=Object.assign({},t.headers);return T7(u,e),x7(u,n),b7(u,i),E7(u,r),new _7(c,t.method,u,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,s,o,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function k7(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function C7(...t){const e=k7();if(e!==void 0){const n=new e;for(let r=0;r<t.length;r++)n.append(t[r]);return n.getBlob()}else{if(xb())return new Blob(t);throw new It(dt.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function I7(t,e,n){return t.webkitSlice?t.webkitSlice(e,n):t.mozSlice?t.mozSlice(e,n):t.slice?t.slice(e,n):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function A7(t){if(typeof atob>"u")throw d7("base-64");return atob(t)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Es={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class f0{constructor(e,n){this.data=e,this.contentType=n||null}}function R7(t,e){switch(t){case Es.RAW:return new f0(KO(e));case Es.BASE64:case Es.BASE64URL:return new f0(GO(t,e));case Es.DATA_URL:return new f0(P7(e),M7(e))}throw _b()}function KO(t){const e=[];for(let n=0;n<t.length;n++){let r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|r&63);else if((r&64512)===55296)if(!(n<t.length-1&&(t.charCodeAt(n+1)&64512)===56320))e.push(239,191,189);else{const i=r,o=t.charCodeAt(++n);r=65536|(i&1023)<<10|o&1023,e.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63)}else(r&64512)===56320?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|r&63)}return new Uint8Array(e)}function N7(t){let e;try{e=decodeURIComponent(t)}catch{throw bh(Es.DATA_URL,"Malformed data URL.")}return KO(e)}function GO(t,e){switch(t){case Es.BASE64:{const s=e.indexOf("-")!==-1,i=e.indexOf("_")!==-1;if(s||i)throw bh(t,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Es.BASE64URL:{const s=e.indexOf("+")!==-1,i=e.indexOf("/")!==-1;if(s||i)throw bh(t,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let n;try{n=A7(e)}catch(s){throw s.message.includes("polyfill")?s:bh(t,"Invalid character found")}const r=new Uint8Array(n.length);for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);return r}class QO{constructor(e){this.base64=!1,this.contentType=null;const n=e.match(/^data:([^,]+)?,/);if(n===null)throw bh(Es.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=n[1]||null;r!=null&&(this.base64=O7(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}function P7(t){const e=new QO(t);return e.base64?GO(Es.BASE64,e.rest):N7(e.rest)}function M7(t){return new QO(t).contentType}function O7(t,e){return t.length>=e.length?t.substring(t.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs{constructor(e,n){let r=0,s="";SC(e)?(this.data_=e,r=e.size,s=e.type):e instanceof ArrayBuffer?(n?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(n?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,n){if(SC(this.data_)){const r=this.data_,s=I7(r,e,n);return s===null?null:new Xs(s)}else{const r=new Uint8Array(this.data_.buffer,e,n-e);return new Xs(r,!0)}}static getBlob(...e){if(xb()){const n=e.map(r=>r instanceof Xs?r.data_:r);return new Xs(C7.apply(null,n))}else{const n=e.map(o=>Vy(o)?R7(Es.RAW,o).data:o.data_);let r=0;n.forEach(o=>{r+=o.byteLength});const s=new Uint8Array(r);let i=0;return n.forEach(o=>{for(let a=0;a<o.length;a++)s[i++]=o[a]}),new Xs(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JO(t){let e;try{e=JSON.parse(t)}catch{return null}return w7(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D7(t){if(t.length===0)return null;const e=t.lastIndexOf("/");return e===-1?"":t.slice(0,e)}function L7(t,e){const n=e.split("/").filter(r=>r.length>0).join("/");return t.length===0?n:t+"/"+n}function XO(t){const e=t.lastIndexOf("/",t.length-2);return e===-1?t:t.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function j7(t,e){return e}let Vn=class{constructor(e,n,r,s){this.server=e,this.local=n||e,this.writable=!!r,this.xform=s||j7}},$f=null;function V7(t){return!Vy(t)||t.length<2?t:XO(t)}function bb(){if($f)return $f;const t=[];t.push(new Vn("bucket")),t.push(new Vn("generation")),t.push(new Vn("metageneration")),t.push(new Vn("name","fullPath",!0));function e(i,o){return V7(o)}const n=new Vn("name");n.xform=e,t.push(n);function r(i,o){return o!==void 0?Number(o):o}const s=new Vn("size");return s.xform=r,t.push(s),t.push(new Vn("timeCreated")),t.push(new Vn("updated")),t.push(new Vn("md5Hash",null,!0)),t.push(new Vn("cacheControl",null,!0)),t.push(new Vn("contentDisposition",null,!0)),t.push(new Vn("contentEncoding",null,!0)),t.push(new Vn("contentLanguage",null,!0)),t.push(new Vn("contentType",null,!0)),t.push(new Vn("metadata","customMetadata",!0)),$f=t,$f}function F7(t,e){function n(){const r=t.bucket,s=t.fullPath,i=new mr(r,s);return e._makeStorageReference(i)}Object.defineProperty(t,"ref",{get:n})}function B7(t,e,n){const r={};r.type="file";const s=n.length;for(let i=0;i<s;i++){const o=n[i];r[o.local]=o.xform(r,e[o.server])}return F7(r,t),r}function YO(t,e,n){const r=JO(e);return r===null?null:B7(t,r,n)}function U7(t,e,n,r){const s=JO(e);if(s===null||!Vy(s.downloadTokens))return null;const i=s.downloadTokens;if(i.length===0)return null;const o=encodeURIComponent;return i.split(",").map(c=>{const u=t.bucket,h=t.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=Qd(d,n,r),g=WO({alt:"media",token:c});return f+g})[0]}function ZO(t,e){const n={},r=e.length;for(let s=0;s<r;s++){const i=e[s];i.writable&&(n[i.server]=t[i.local])}return JSON.stringify(n)}class ru{constructor(e,n,r,s){this.url=e,this.method=n,this.handler=r,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ai(t){if(!t)throw _b()}function Tb(t,e){function n(r,s){const i=YO(t,s,e);return ai(i!==null),i}return n}function z7(t,e){function n(r,s){const i=YO(t,s,e);return ai(i!==null),U7(i,s,t.host,t._protocol)}return n}function Jd(t){function e(n,r){let s;return n.getStatus()===401?n.getErrorText().includes("Firebase App Check token is invalid")?s=i7():s=s7():n.getStatus()===402?s=r7(t.bucket):n.getStatus()===403?s=o7(t.path):s=r,s.status=n.getStatus(),s.serverResponse=r.serverResponse,s}return e}function eD(t){const e=Jd(t);function n(r,s){let i=e(r,s);return r.getStatus()===404&&(i=n7(t.path)),i.serverResponse=s.serverResponse,i}return n}function $7(t,e,n){const r=e.fullServerUrl(),s=Qd(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new ru(s,i,Tb(t,n),o);return a.errorHandler=eD(e),a}function H7(t,e,n){const r=e.fullServerUrl(),s=Qd(r,t.host,t._protocol),i="GET",o=t.maxOperationRetryTime,a=new ru(s,i,z7(t,n),o);return a.errorHandler=eD(e),a}function W7(t,e){return t&&t.contentType||e&&e.type()||"application/octet-stream"}function tD(t,e,n){const r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=W7(null,e)),r}function nD(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let E="";for(let R=0;R<2;R++)E=E+Math.random().toString().slice(2);return E}const l=a();o["Content-Type"]="multipart/related; boundary="+l;const c=tD(e,r,s),u=ZO(c,n),h="--"+l+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+l+`\r
Content-Type: `+c.contentType+`\r
\r
`,d=`\r
--`+l+"--",f=Xs.getBlob(h,r,d);if(f===null)throw $O();const g={name:c.fullPath},y=Qd(i,t.host,t._protocol),v="POST",w=t.maxUploadRetryTime,T=new ru(y,v,Tb(t,n),w);return T.urlParams=g,T.headers=o,T.body=f.uploadData(),T.errorHandler=Jd(e),T}class Wm{constructor(e,n,r,s){this.current=e,this.total=n,this.finalized=!!r,this.metadata=s||null}}function Eb(t,e){let n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch{ai(!1)}return ai(!!n&&(e||["active"]).indexOf(n)!==-1),n}function q7(t,e,n,r,s){const i=e.bucketOnlyServerUrl(),o=tD(e,r,s),a={name:o.fullPath},l=Qd(i,t.host,t._protocol),c="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${r.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=ZO(o,n),d=t.maxUploadRetryTime;function f(y){Eb(y);let v;try{v=y.getResponseHeader("X-Goog-Upload-URL")}catch{ai(!1)}return ai(Vy(v)),v}const g=new ru(l,c,f,d);return g.urlParams=a,g.headers=u,g.body=h,g.errorHandler=Jd(e),g}function K7(t,e,n,r){const s={"X-Goog-Upload-Command":"query"};function i(c){const u=Eb(c,["active","final"]);let h=null;try{h=c.getResponseHeader("X-Goog-Upload-Size-Received")}catch{ai(!1)}h||ai(!1);const d=Number(h);return ai(!isNaN(d)),new Wm(d,r.size(),u==="final")}const o="POST",a=t.maxUploadRetryTime,l=new ru(n,o,i,a);return l.headers=s,l.errorHandler=Jd(e),l}const CC=256*1024;function G7(t,e,n,r,s,i,o,a){const l=new Wm(0,0);if(o?(l.current=o.current,l.total=o.total):(l.current=0,l.total=r.size()),r.size()!==l.total)throw u7();const c=l.total-l.current;let u=c;s>0&&(u=Math.min(u,s));const h=l.current,d=h+u;let f="";u===0?f="finalize":c===u?f="upload, finalize":f="upload";const g={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${l.current}`},y=r.slice(h,d);if(y===null)throw $O();function v(R,P){const N=Eb(R,["active","final"]),k=l.current+u,_=r.size();let x;return N==="final"?x=Tb(e,i)(R,P):x=null,new Wm(k,_,N==="final",x)}const w="POST",T=e.maxUploadRetryTime,E=new ru(n,w,v,T);return E.headers=g,E.body=y.uploadData(),E.progressCallback=a||null,E.errorHandler=Jd(t),E}const Jn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function p0(t){switch(t){case"running":case"pausing":case"canceling":return Jn.RUNNING;case"paused":return Jn.PAUSED;case"success":return Jn.SUCCESS;case"canceled":return Jn.CANCELED;case"error":return Jn.ERROR;default:return Jn.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q7{constructor(e,n,r){if(v7(e)||n!=null||r!=null)this.next=e,this.error=n??void 0,this.complete=r??void 0;else{const i=e;this.next=i.next,this.error=i.error,this.complete=i.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sl(t){return(...e)=>{Promise.resolve().then(()=>t(...e))}}class J7{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Ca.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Ca.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Ca.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,n,r,s,i){if(this.sent_)throw Ou("cannot .send() more than once");if(jo(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(n,e,!0),i!==void 0)for(const o in i)i.hasOwnProperty(o)&&this.xhr_.setRequestHeader(o,i[o].toString());return s!==void 0?this.xhr_.send(s):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Ou("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Ou("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Ou("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Ou("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class X7 extends J7{initXhr(){this.xhr_.responseType="text"}}function aa(){return new X7}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y7{isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}constructor(e,n,r=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=n,this._metadata=r,this._mappings=bb(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(dt.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const i=this.isExponentialBackoffExpired();if(qO(s.status,[]))if(i)s=UO();else{this.sleepTime=Math.max(this.sleepTime*2,t7),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(dt.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,i)=>{this._resolve=s,this._reject=i,this._start()}),this._promise.then(null,()=>{})}_makeProgressCallback(){const e=this._transferred;return n=>this._updateProgress(e+n)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([n,r])=>{switch(this._state){case"running":e(n,r);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,n)=>{const r=q7(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,aa,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._uploadUrl=i,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((n,r)=>{const s=K7(this._ref.storage,this._ref._location,e,this._blob),i=this._ref.storage._makeRequest(s,aa,n,r);this._request=i,i.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=CC*this._chunkMultiplier,n=new Wm(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken((s,i)=>{let o;try{o=G7(this._ref._location,this._ref.storage,r,this._blob,e,this._mappings,n,this._makeProgressCallback())}catch(l){this._error=l,this._transition("error");return}const a=this._ref.storage._makeRequest(o,aa,s,i,!1);this._request=a,a.getPromise().then(l=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(l.current),l.finalized?(this._metadata=l.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){CC*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,n)=>{const r=$7(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(r,aa,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,n)=>{const r=nD(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(r,aa,e,n);this._request=s,s.getPromise().then(i=>{this._request=void 0,this._metadata=i,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const n=this._transferred;this._transferred=e,this._transferred!==n&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const n=this._state==="paused";this._state=e,n&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=zO(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=p0(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,n,r,s){const i=new Q7(n||void 0,r||void 0,s||void 0);return this._addObserver(i),()=>{this._removeObserver(i)}}then(e,n){return this._promise.then(e,n)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const n=this._observers.indexOf(e);n!==-1&&this._observers.splice(n,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(n=>{this._notifyObserver(n)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(p0(this._state)){case Jn.SUCCESS:Sl(this._resolve.bind(null,this.snapshot))();break;case Jn.CANCELED:case Jn.ERROR:const n=this._reject;Sl(n.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(p0(this._state)){case Jn.RUNNING:case Jn.PAUSED:e.next&&Sl(e.next.bind(e,this.snapshot))();break;case Jn.SUCCESS:e.complete&&Sl(e.complete.bind(e))();break;case Jn.CANCELED:case Jn.ERROR:e.error&&Sl(e.error.bind(e,this._error))();break;default:e.error&&Sl(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xa{constructor(e,n){this._service=e,n instanceof mr?this._location=n:this._location=mr.makeFromUrl(n,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,n){return new Xa(e,n)}get root(){const e=new mr(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return XO(this._location.path)}get storage(){return this._service}get parent(){const e=D7(this._location.path);if(e===null)return null;const n=new mr(this._location.bucket,e);return new Xa(this._service,n)}_throwIfRoot(e){if(this._location.path==="")throw f7(e)}}function Z7(t,e,n){t._throwIfRoot("uploadBytes");const r=nD(t.storage,t._location,bb(),new Xs(e,!0),n);return t.storage.makeRequestWithTokens(r,aa).then(s=>({metadata:s,ref:t}))}function eW(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new Y7(t,new Xs(e),n)}function tW(t){t._throwIfRoot("getDownloadURL");const e=H7(t.storage,t._location,bb());return t.storage.makeRequestWithTokens(e,aa).then(n=>{if(n===null)throw h7();return n})}function nW(t,e){const n=L7(t._location.path,e),r=new mr(t._location.bucket,n);return new Xa(t.storage,r)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rW(t){return/^[A-Za-z]+:\/\//.test(t)}function sW(t,e){return new Xa(t,e)}function rD(t,e){if(t instanceof Sb){const n=t;if(n._bucket==null)throw c7();const r=new Xa(n,n._bucket);return e!=null?rD(r,e):r}else return e!==void 0?nW(t,e):t}function iW(t,e){if(e&&rW(e)){if(t instanceof Sb)return sW(t,e);throw C1("To use ref(service, url), the first argument must be a Storage instance.")}else return rD(t,e)}function IC(t,e){const n=e==null?void 0:e[BO];return n==null?null:mr.makeFromBucketSpec(n,t)}function oW(t,e,n,r={}){t.host=`${e}:${n}`;const s=jo(e);s&&(yx(`https://${t.host}/b`),vx("Storage",!0)),t._isUsingEmulator=!0,t._protocol=s?"https":"http";const{mockUserToken:i}=r;i&&(t._overrideAuthToken=typeof i=="string"?i:A2(i,t.app.options.projectId))}class Sb{constructor(e,n,r,s,i,o=!1){this.app=e,this._authProvider=n,this._appCheckProvider=r,this._url=s,this._firebaseVersion=i,this._isUsingEmulator=o,this._bucket=null,this._host=FO,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Z9,this._maxUploadRetryTime=e7,this._requests=new Set,s!=null?this._bucket=mr.makeFromBucketSpec(s,this._host):this._bucket=IC(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=mr.makeFromBucketSpec(this._url,e):this._bucket=IC(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){kC("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){kC("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const n=await e.getToken();if(n!==null)return n.accessToken}return null}async _getAppCheckToken(){if(ur(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new Xa(this,e)}_makeRequest(e,n,r,s,i=!0){if(this._deleted)return new p7(HO());{const o=S7(e,this._appId,r,s,n,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,n){const[r,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,n,r,s).getPromise()}}const AC="@firebase/storage",RC="0.14.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sD="storage";function aW(t,e,n){return t=Ct(t),Z7(t,e,n)}function lW(t,e,n){return t=Ct(t),eW(t,e,n)}function NC(t){return t=Ct(t),tW(t)}function PC(t,e){return t=Ct(t),iW(t,e)}function cW(t=xx(),e){t=Ct(t);const r=ay(t,sD).getImmediate({identifier:e}),s=k2("storage");return s&&uW(r,...s),r}function uW(t,e,n,r={}){oW(t,e,n,r)}function hW(t,{instanceIdentifier:e}){const n=t.getProvider("app").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("app-check-internal");return new Sb(n,r,s,e,ll)}function dW(){Ba(new ko(sD,hW,"PUBLIC").setMultipleInstances(!0)),Cs(AC,RC,""),Cs(AC,RC,"esm2020")}dW();var fW="firebase",pW="12.7.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Cs(fW,pW,"app");const mW={apiKey:"AIzaSyAlMyf_NFJ8xrQLt24EhxAzWZTnQbPr6aQ",authDomain:"desksetup-web.firebaseapp.com",projectId:"desksetup-web",storageBucket:"desksetup-web.firebasestorage.app",messagingSenderId:"540303783708",appId:"1:540303783708:web:ef169c5fb08b7d9a822cd9",measurementId:"G-N1ZDZ3JWF0"},kb=L2(mW),dc=X9(kb),Jt=x8(kb);b8(Jt).catch(t=>{t.code==="failed-precondition"?console.warn("Firestore persistence disabled: Multiple tabs open"):t.code==="unimplemented"&&console.warn("Firestore persistence disabled: Browser not supported")});const MC=cW(kb);new Js;function gW(t,e){return e.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in t)){var s=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(t)}function iD(t,e){return new Promise(function(n,r){let s;return yW(t).then(function(i){try{return s=i,n(new Blob([e.slice(0,2),s,e.slice(2)],{type:"image/jpeg"}))}catch(o){return r(o)}},r)})}const yW=t=>new Promise((e,n)=>{const r=new FileReader;r.addEventListener("load",({target:{result:s}})=>{const i=new DataView(s);let o=0;if(i.getUint16(o)!==65496)return n("not a valid JPEG");for(o+=2;;){const a=i.getUint16(o);if(a===65498)break;const l=i.getUint16(o+2);if(a===65505&&i.getUint32(o+4)===1165519206){const c=o+10;let u;switch(i.getUint16(c)){case 18761:u=!0;break;case 19789:u=!1;break;default:return n("TIFF header contains invalid endian")}if(i.getUint16(c+2,u)!==42)return n("TIFF header contains invalid version");const h=i.getUint32(c+4,u),d=c+h+2+12*i.getUint16(c+h,u);for(let f=c+h+2;f<d;f+=12)if(i.getUint16(f,u)==274){if(i.getUint16(f+2,u)!==3)return n("Orientation data type is invalid");if(i.getUint32(f+4,u)!==1)return n("Orientation data count is invalid");i.setUint16(f+8,1,u);break}return e(s.slice(o,o+2+l))}o+=2+l}return e(new Blob)}),r.readAsArrayBuffer(t)});var qm={},vW={get exports(){return qm},set exports(t){qm=t}};(function(t){var e,n,r={};vW.exports=r,r.parse=function(s,i){for(var o=r.bin.readUshort,a=r.bin.readUint,l=0,c={},u=new Uint8Array(s),h=u.length-4;a(u,h)!=101010256;)h--;l=h,l+=4;var d=o(u,l+=4);o(u,l+=2);var f=a(u,l+=2),g=a(u,l+=4);l+=4,l=g;for(var y=0;y<d;y++){a(u,l),l+=4,l+=4,l+=4,a(u,l+=4),f=a(u,l+=4);var v=a(u,l+=4),w=o(u,l+=4),T=o(u,l+2),E=o(u,l+4);l+=6;var R=a(u,l+=8);l+=4,l+=w+T+E,r._readLocal(u,R,c,f,v,i)}return c},r._readLocal=function(s,i,o,a,l,c){var u=r.bin.readUshort,h=r.bin.readUint;h(s,i),u(s,i+=4),u(s,i+=2);var d=u(s,i+=2);h(s,i+=2),h(s,i+=4),i+=4;var f=u(s,i+=8),g=u(s,i+=2);i+=2;var y=r.bin.readUTF8(s,i,f);if(i+=f,i+=g,c)o[y]={size:l,csize:a};else{var v=new Uint8Array(s.buffer,i);if(d==0)o[y]=new Uint8Array(v.buffer.slice(i,i+a));else{if(d!=8)throw"unknown compression method: "+d;var w=new Uint8Array(l);r.inflateRaw(v,w),o[y]=w}}},r.inflateRaw=function(s,i){return r.F.inflate(s,i)},r.inflate=function(s,i){return s[0],s[1],r.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-6),i)},r.deflate=function(s,i){i==null&&(i={level:6});var o=0,a=new Uint8Array(50+Math.floor(1.1*s.length));a[o]=120,a[o+1]=156,o+=2,o=r.F.deflateRaw(s,a,o,i.level);var l=r.adler(s,0,s.length);return a[o+0]=l>>>24&255,a[o+1]=l>>>16&255,a[o+2]=l>>>8&255,a[o+3]=l>>>0&255,new Uint8Array(a.buffer,0,o+4)},r.deflateRaw=function(s,i){i==null&&(i={level:6});var o=new Uint8Array(50+Math.floor(1.1*s.length)),a=r.F.deflateRaw(s,o,a,i.level);return new Uint8Array(o.buffer,0,a)},r.encode=function(s,i){i==null&&(i=!1);var o=0,a=r.bin.writeUint,l=r.bin.writeUshort,c={};for(var u in s){var h=!r._noNeed(u)&&!i,d=s[u],f=r.crc.crc(d,0,d.length);c[u]={cpr:h,usize:d.length,crc:f,file:h?r.deflateRaw(d):d}}for(var u in c)o+=c[u].file.length+30+46+2*r.bin.sizeUTF8(u);o+=22;var g=new Uint8Array(o),y=0,v=[];for(var u in c){var w=c[u];v.push(y),y=r._writeHeader(g,y,u,w,0)}var T=0,E=y;for(var u in c)w=c[u],v.push(y),y=r._writeHeader(g,y,u,w,1,v[T++]);var R=y-E;return a(g,y,101010256),y+=4,l(g,y+=4,T),l(g,y+=2,T),a(g,y+=2,R),a(g,y+=4,E),y+=4,y+=2,g.buffer},r._noNeed=function(s){var i=s.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(i)!=-1},r._writeHeader=function(s,i,o,a,l,c){var u=r.bin.writeUint,h=r.bin.writeUshort,d=a.file;return u(s,i,l==0?67324752:33639248),i+=4,l==1&&(i+=2),h(s,i,20),h(s,i+=2,0),h(s,i+=2,a.cpr?8:0),u(s,i+=2,0),u(s,i+=4,a.crc),u(s,i+=4,d.length),u(s,i+=4,a.usize),h(s,i+=4,r.bin.sizeUTF8(o)),h(s,i+=2,0),i+=2,l==1&&(i+=2,i+=2,u(s,i+=6,c),i+=4),i+=r.bin.writeUTF8(s,i,o),l==0&&(s.set(d,i),i+=d.length),i},r.crc={table:function(){for(var s=new Uint32Array(256),i=0;i<256;i++){for(var o=i,a=0;a<8;a++)1&o?o=3988292384^o>>>1:o>>>=1;s[i]=o}return s}(),update:function(s,i,o,a){for(var l=0;l<a;l++)s=r.crc.table[255&(s^i[o+l])]^s>>>8;return s},crc:function(s,i,o){return 4294967295^r.crc.update(4294967295,s,i,o)}},r.adler=function(s,i,o){for(var a=1,l=0,c=i,u=i+o;c<u;){for(var h=Math.min(c+5552,u);c<h;)l+=a+=s[c++];a%=65521,l%=65521}return l<<16|a},r.bin={readUshort:function(s,i){return s[i]|s[i+1]<<8},writeUshort:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255},readUint:function(s,i){return 16777216*s[i+3]+(s[i+2]<<16|s[i+1]<<8|s[i])},writeUint:function(s,i,o){s[i]=255&o,s[i+1]=o>>8&255,s[i+2]=o>>16&255,s[i+3]=o>>24&255},readASCII:function(s,i,o){for(var a="",l=0;l<o;l++)a+=String.fromCharCode(s[i+l]);return a},writeASCII:function(s,i,o){for(var a=0;a<o.length;a++)s[i+a]=o.charCodeAt(a)},pad:function(s){return s.length<2?"0"+s:s},readUTF8:function(s,i,o){for(var a,l="",c=0;c<o;c++)l+="%"+r.bin.pad(s[i+c].toString(16));try{a=decodeURIComponent(l)}catch{return r.bin.readASCII(s,i,o)}return a},writeUTF8:function(s,i,o){for(var a=o.length,l=0,c=0;c<a;c++){var u=o.charCodeAt(c);if(!(4294967168&u))s[i+l]=u,l++;else if(!(4294965248&u))s[i+l]=192|u>>6,s[i+l+1]=128|u>>0&63,l+=2;else if(!(4294901760&u))s[i+l]=224|u>>12,s[i+l+1]=128|u>>6&63,s[i+l+2]=128|u>>0&63,l+=3;else{if(4292870144&u)throw"e";s[i+l]=240|u>>18,s[i+l+1]=128|u>>12&63,s[i+l+2]=128|u>>6&63,s[i+l+3]=128|u>>0&63,l+=4}}return l},sizeUTF8:function(s){for(var i=s.length,o=0,a=0;a<i;a++){var l=s.charCodeAt(a);if(!(4294967168&l))o++;else if(!(4294965248&l))o+=2;else if(!(4294901760&l))o+=3;else{if(4292870144&l)throw"e";o+=4}}return o}},r.F={},r.F.deflateRaw=function(s,i,o,a){var l=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],c=r.F.U,u=r.F._goodIndex;r.F._hash;var h=r.F._putsE,d=0,f=o<<3,g=0,y=s.length;if(a==0){for(;d<y;)h(i,f,d+(A=Math.min(65535,y-d))==y?1:0),f=r.F._copyExact(s,d,A,i,f+8),d+=A;return f>>>3}var v=c.lits,w=c.strt,T=c.prev,E=0,R=0,P=0,N=0,k=0,_=0;for(y>2&&(w[_=r.F._hash(s,0)]=0),d=0;d<y;d++){if(k=_,d+1<y-2){_=r.F._hash(s,d+1);var x=d+1&32767;T[x]=w[_],w[_]=x}if(g<=d){(E>14e3||R>26697)&&y-d>100&&(g<d&&(v[E]=d-g,E+=2,g=d),f=r.F._writeBlock(d==y-1||g==y?1:0,v,E,N,s,P,d-P,i,f),E=R=N=0,P=d);var S=0;d<y-2&&(S=r.F._bestMatch(s,d,T,k,Math.min(l[2],y-d),l[3]));var A=S>>>16,M=65535&S;if(S!=0){M=65535&S;var I=u(A=S>>>16,c.of0);c.lhst[257+I]++;var j=u(M,c.df0);c.dhst[j]++,N+=c.exb[I]+c.dxb[j],v[E]=A<<23|d-g,v[E+1]=M<<16|I<<8|j,E+=2,g=d+A}else c.lhst[s[d]]++;R++}}for(P==d&&s.length!=0||(g<d&&(v[E]=d-g,E+=2,g=d),f=r.F._writeBlock(1,v,E,N,s,P,d-P,i,f),E=0,R=0,E=R=N=0,P=d);7&f;)f++;return f>>>3},r.F._bestMatch=function(s,i,o,a,l,c){var u=32767&i,h=o[u],d=u-h+32768&32767;if(h==u||a!=r.F._hash(s,i-d))return 0;for(var f=0,g=0,y=Math.min(32767,i);d<=y&&--c!=0&&h!=u;){if(f==0||s[i+f]==s[i+f-d]){var v=r.F._howLong(s,i,d);if(v>f){if(g=d,(f=v)>=l)break;d+2<v&&(v=d+2);for(var w=0,T=0;T<v-2;T++){var E=i-d+T+32768&32767,R=E-o[E]+32768&32767;R>w&&(w=R,h=E)}}}d+=(u=h)-(h=o[u])+32768&32767}return f<<16|g},r.F._howLong=function(s,i,o){if(s[i]!=s[i-o]||s[i+1]!=s[i+1-o]||s[i+2]!=s[i+2-o])return 0;var a=i,l=Math.min(s.length,i+258);for(i+=3;i<l&&s[i]==s[i-o];)i++;return i-a},r.F._hash=function(s,i){return(s[i]<<8|s[i+1])+(s[i+2]<<4)&65535},r.saved=0,r.F._writeBlock=function(s,i,o,a,l,c,u,h,d){var f,g,y,v,w,T,E,R,P,N=r.F.U,k=r.F._putsF,_=r.F._putsE;N.lhst[256]++,g=(f=r.F.getTrees())[0],y=f[1],v=f[2],w=f[3],T=f[4],E=f[5],R=f[6],P=f[7];var x=32+(d+3&7?8-(d+3&7):0)+(u<<3),S=a+r.F.contSize(N.fltree,N.lhst)+r.F.contSize(N.fdtree,N.dhst),A=a+r.F.contSize(N.ltree,N.lhst)+r.F.contSize(N.dtree,N.dhst);A+=14+3*E+r.F.contSize(N.itree,N.ihst)+(2*N.ihst[16]+3*N.ihst[17]+7*N.ihst[18]);for(var M=0;M<286;M++)N.lhst[M]=0;for(M=0;M<30;M++)N.dhst[M]=0;for(M=0;M<19;M++)N.ihst[M]=0;var I=x<S&&x<A?0:S<A?1:2;if(k(h,d,s),k(h,d+1,I),d+=3,I==0){for(;7&d;)d++;d=r.F._copyExact(l,c,u,h,d)}else{var j,B;if(I==1&&(j=N.fltree,B=N.fdtree),I==2){r.F.makeCodes(N.ltree,g),r.F.revCodes(N.ltree,g),r.F.makeCodes(N.dtree,y),r.F.revCodes(N.dtree,y),r.F.makeCodes(N.itree,v),r.F.revCodes(N.itree,v),j=N.ltree,B=N.dtree,_(h,d,w-257),_(h,d+=5,T-1),_(h,d+=5,E-4),d+=4;for(var L=0;L<E;L++)_(h,d+3*L,N.itree[1+(N.ordr[L]<<1)]);d+=3*E,d=r.F._codeTiny(R,N.itree,h,d),d=r.F._codeTiny(P,N.itree,h,d)}for(var O=c,$=0;$<o;$+=2){for(var U=i[$],F=U>>>23,X=O+(8388607&U);O<X;)d=r.F._writeLit(l[O++],j,h,d);if(F!=0){var H=i[$+1],J=H>>16,z=H>>8&255,W=255&H;_(h,d=r.F._writeLit(257+z,j,h,d),F-N.of0[z]),d+=N.exb[z],k(h,d=r.F._writeLit(W,B,h,d),J-N.df0[W]),d+=N.dxb[W],O+=F}}d=r.F._writeLit(256,j,h,d)}return d},r.F._copyExact=function(s,i,o,a,l){var c=l>>>3;return a[c]=o,a[c+1]=o>>>8,a[c+2]=255-a[c],a[c+3]=255-a[c+1],c+=4,a.set(new Uint8Array(s.buffer,i,o),c),l+(o+4<<3)},r.F.getTrees=function(){for(var s=r.F.U,i=r.F._hufTree(s.lhst,s.ltree,15),o=r.F._hufTree(s.dhst,s.dtree,15),a=[],l=r.F._lenCodes(s.ltree,a),c=[],u=r.F._lenCodes(s.dtree,c),h=0;h<a.length;h+=2)s.ihst[a[h]]++;for(h=0;h<c.length;h+=2)s.ihst[c[h]]++;for(var d=r.F._hufTree(s.ihst,s.itree,7),f=19;f>4&&s.itree[1+(s.ordr[f-1]<<1)]==0;)f--;return[i,o,d,l,u,f,a,c]},r.F.getSecond=function(s){for(var i=[],o=0;o<s.length;o+=2)i.push(s[o+1]);return i},r.F.nonZero=function(s){for(var i="",o=0;o<s.length;o+=2)s[o+1]!=0&&(i+=(o>>1)+",");return i},r.F.contSize=function(s,i){for(var o=0,a=0;a<i.length;a++)o+=i[a]*s[1+(a<<1)];return o},r.F._codeTiny=function(s,i,o,a){for(var l=0;l<s.length;l+=2){var c=s[l],u=s[l+1];a=r.F._writeLit(c,i,o,a);var h=c==16?2:c==17?3:7;c>15&&(r.F._putsE(o,a,u,h),a+=h)}return a},r.F._lenCodes=function(s,i){for(var o=s.length;o!=2&&s[o-1]==0;)o-=2;for(var a=0;a<o;a+=2){var l=s[a+1],c=a+3<o?s[a+3]:-1,u=a+5<o?s[a+5]:-1,h=a==0?-1:s[a-1];if(l==0&&c==l&&u==l){for(var d=a+5;d+2<o&&s[d+2]==l;)d+=2;(f=Math.min(d+1-a>>>1,138))<11?i.push(17,f-3):i.push(18,f-11),a+=2*f-2}else if(l==h&&c==l&&u==l){for(d=a+5;d+2<o&&s[d+2]==l;)d+=2;var f=Math.min(d+1-a>>>1,6);i.push(16,f-3),a+=2*f-2}else i.push(l,0)}return o>>>1},r.F._hufTree=function(s,i,o){var a=[],l=s.length,c=i.length,u=0;for(u=0;u<c;u+=2)i[u]=0,i[u+1]=0;for(u=0;u<l;u++)s[u]!=0&&a.push({lit:u,f:s[u]});var h=a.length,d=a.slice(0);if(h==0)return 0;if(h==1){var f=a[0].lit;return d=f==0?1:0,i[1+(f<<1)]=1,i[1+(d<<1)]=1,1}a.sort(function(R,P){return R.f-P.f});var g=a[0],y=a[1],v=0,w=1,T=2;for(a[0]={lit:-1,f:g.f+y.f,l:g,r:y,d:0};w!=h-1;)g=v!=w&&(T==h||a[v].f<a[T].f)?a[v++]:a[T++],y=v!=w&&(T==h||a[v].f<a[T].f)?a[v++]:a[T++],a[w++]={lit:-1,f:g.f+y.f,l:g,r:y};var E=r.F.setDepth(a[w-1],0);for(E>o&&(r.F.restrictDepth(d,o,E),E=o),u=0;u<h;u++)i[1+(d[u].lit<<1)]=d[u].d;return E},r.F.setDepth=function(s,i){return s.lit!=-1?(s.d=i,i):Math.max(r.F.setDepth(s.l,i+1),r.F.setDepth(s.r,i+1))},r.F.restrictDepth=function(s,i,o){var a=0,l=1<<o-i,c=0;for(s.sort(function(h,d){return d.d==h.d?h.f-d.f:d.d-h.d}),a=0;a<s.length&&s[a].d>i;a++){var u=s[a].d;s[a].d=i,c+=l-(1<<o-u)}for(c>>>=o-i;c>0;)(u=s[a].d)<i?(s[a].d++,c-=1<<i-u-1):a++;for(;a>=0;a--)s[a].d==i&&c<0&&(s[a].d--,c++);c!=0&&console.log("debt left")},r.F._goodIndex=function(s,i){var o=0;return i[16|o]<=s&&(o|=16),i[8|o]<=s&&(o|=8),i[4|o]<=s&&(o|=4),i[2|o]<=s&&(o|=2),i[1|o]<=s&&(o|=1),o},r.F._writeLit=function(s,i,o,a){return r.F._putsF(o,a,i[s<<1]),a+i[1+(s<<1)]},r.F.inflate=function(s,i){var o=Uint8Array;if(s[0]==3&&s[1]==0)return i||new o(0);var a=r.F,l=a._bitsF,c=a._bitsE,u=a._decodeTiny,h=a.makeCodes,d=a.codes2map,f=a._get17,g=a.U,y=i==null;y&&(i=new o(s.length>>>2<<3));for(var v,w,T=0,E=0,R=0,P=0,N=0,k=0,_=0,x=0,S=0;T==0;)if(T=l(s,S,1),E=l(s,S+1,2),S+=3,E!=0){if(y&&(i=r.F._check(i,x+(1<<17))),E==1&&(v=g.flmap,w=g.fdmap,k=511,_=31),E==2){R=c(s,S,5)+257,P=c(s,S+5,5)+1,N=c(s,S+10,4)+4,S+=14;for(var A=0;A<38;A+=2)g.itree[A]=0,g.itree[A+1]=0;var M=1;for(A=0;A<N;A++){var I=c(s,S+3*A,3);g.itree[1+(g.ordr[A]<<1)]=I,I>M&&(M=I)}S+=3*N,h(g.itree,M),d(g.itree,M,g.imap),v=g.lmap,w=g.dmap,S=u(g.imap,(1<<M)-1,R+P,s,S,g.ttree);var j=a._copyOut(g.ttree,0,R,g.ltree);k=(1<<j)-1;var B=a._copyOut(g.ttree,R,P,g.dtree);_=(1<<B)-1,h(g.ltree,j),d(g.ltree,j,v),h(g.dtree,B),d(g.dtree,B,w)}for(;;){var L=v[f(s,S)&k];S+=15&L;var O=L>>>4;if(!(O>>>8))i[x++]=O;else{if(O==256)break;var $=x+O-254;if(O>264){var U=g.ldef[O-257];$=x+(U>>>3)+c(s,S,7&U),S+=7&U}var F=w[f(s,S)&_];S+=15&F;var X=F>>>4,H=g.ddef[X],J=(H>>>4)+l(s,S,15&H);for(S+=15&H,y&&(i=r.F._check(i,x+(1<<17)));x<$;)i[x]=i[x++-J],i[x]=i[x++-J],i[x]=i[x++-J],i[x]=i[x++-J];x=$}}}else{7&S&&(S+=8-(7&S));var z=4+(S>>>3),W=s[z-4]|s[z-3]<<8;y&&(i=r.F._check(i,x+W)),i.set(new o(s.buffer,s.byteOffset+z,W),x),S=z+W<<3,x+=W}return i.length==x?i:i.slice(0,x)},r.F._check=function(s,i){var o=s.length;if(i<=o)return s;var a=new Uint8Array(Math.max(o<<1,i));return a.set(s,0),a},r.F._decodeTiny=function(s,i,o,a,l,c){for(var u=r.F._bitsE,h=r.F._get17,d=0;d<o;){var f=s[h(a,l)&i];l+=15&f;var g=f>>>4;if(g<=15)c[d]=g,d++;else{var y=0,v=0;g==16?(v=3+u(a,l,2),l+=2,y=c[d-1]):g==17?(v=3+u(a,l,3),l+=3):g==18&&(v=11+u(a,l,7),l+=7);for(var w=d+v;d<w;)c[d]=y,d++}}return l},r.F._copyOut=function(s,i,o,a){for(var l=0,c=0,u=a.length>>>1;c<o;){var h=s[c+i];a[c<<1]=0,a[1+(c<<1)]=h,h>l&&(l=h),c++}for(;c<u;)a[c<<1]=0,a[1+(c<<1)]=0,c++;return l},r.F.makeCodes=function(s,i){for(var o,a,l,c,u=r.F.U,h=s.length,d=u.bl_count,f=0;f<=i;f++)d[f]=0;for(f=1;f<h;f+=2)d[s[f]]++;var g=u.next_code;for(o=0,d[0]=0,a=1;a<=i;a++)o=o+d[a-1]<<1,g[a]=o;for(l=0;l<h;l+=2)(c=s[l+1])!=0&&(s[l]=g[c],g[c]++)},r.F.codes2map=function(s,i,o){for(var a=s.length,l=r.F.U.rev15,c=0;c<a;c+=2)if(s[c+1]!=0)for(var u=c>>1,h=s[c+1],d=u<<4|h,f=i-h,g=s[c]<<f,y=g+(1<<f);g!=y;)o[l[g]>>>15-i]=d,g++},r.F.revCodes=function(s,i){for(var o=r.F.U.rev15,a=15-i,l=0;l<s.length;l+=2){var c=s[l]<<i-s[l+1];s[l]=o[c]>>>a}},r.F._putsE=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8},r.F._putsF=function(s,i,o){o<<=7&i;var a=i>>>3;s[a]|=o,s[a+1]|=o>>>8,s[a+2]|=o>>>16},r.F._bitsE=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8)>>>(7&i)&(1<<o)-1},r.F._bitsF=function(s,i,o){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)&(1<<o)-1},r.F._get17=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16)>>>(7&i)},r.F._get25=function(s,i){return(s[i>>>3]|s[1+(i>>>3)]<<8|s[2+(i>>>3)]<<16|s[3+(i>>>3)]<<24)>>>(7&i)},r.F.U=(e=Uint16Array,n=Uint32Array,{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new n(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new n(286),dhst:new n(30),ihst:new n(19),lits:new n(15e3),strt:new e(65536),prev:new e(32768)}),function(){for(var s=r.F.U,i=0;i<32768;i++){var o=i;o=(4278255360&(o=(4042322160&(o=(3435973836&(o=(2863311530&o)>>>1|(1431655765&o)<<1))>>>2|(858993459&o)<<2))>>>4|(252645135&o)<<4))>>>8|(16711935&o)<<8,s.rev15[i]=(o>>>16|o<<16)>>>17}function a(l,c,u){for(;c--!=0;)l.push(0,u)}for(i=0;i<32;i++)s.ldef[i]=s.of0[i]<<3|s.exb[i],s.ddef[i]=s.df0[i]<<4|s.dxb[i];a(s.fltree,144,8),a(s.fltree,112,9),a(s.fltree,24,7),a(s.fltree,8,8),r.F.makeCodes(s.fltree,9),r.F.codes2map(s.fltree,9,s.flmap),r.F.revCodes(s.fltree,9),a(s.fdtree,32,5),r.F.makeCodes(s.fdtree,5),r.F.codes2map(s.fdtree,5,s.fdmap),r.F.revCodes(s.fdtree,5),a(s.itree,19,0),a(s.ltree,286,0),a(s.dtree,30,0),a(s.ttree,320,0)}()})();var wW=gW({__proto__:null,default:qm},[qm]);const Gr=function(){var t={nextZero(u,h){for(;u[h]!=0;)h++;return h},readUshort:(u,h)=>u[h]<<8|u[h+1],writeUshort(u,h,d){u[h]=d>>8&255,u[h+1]=255&d},readUint:(u,h)=>16777216*u[h]+(u[h+1]<<16|u[h+2]<<8|u[h+3]),writeUint(u,h,d){u[h]=d>>24&255,u[h+1]=d>>16&255,u[h+2]=d>>8&255,u[h+3]=255&d},readASCII(u,h,d){let f="";for(let g=0;g<d;g++)f+=String.fromCharCode(u[h+g]);return f},writeASCII(u,h,d){for(let f=0;f<d.length;f++)u[h+f]=d.charCodeAt(f)},readBytes(u,h,d){const f=[];for(let g=0;g<d;g++)f.push(u[h+g]);return f},pad:u=>u.length<2?`0${u}`:u,readUTF8(u,h,d){let f,g="";for(let y=0;y<d;y++)g+=`%${t.pad(u[h+y].toString(16))}`;try{f=decodeURIComponent(g)}catch{return t.readASCII(u,h,d)}return f}};function e(u,h,d,f){const g=h*d,y=i(f),v=Math.ceil(h*y/8),w=new Uint8Array(4*g),T=new Uint32Array(w.buffer),{ctype:E}=f,{depth:R}=f,P=t.readUshort;if(E==6){const U=g<<2;if(R==8)for(var N=0;N<U;N+=4)w[N]=u[N],w[N+1]=u[N+1],w[N+2]=u[N+2],w[N+3]=u[N+3];if(R==16)for(N=0;N<U;N++)w[N]=u[N<<1]}else if(E==2){const U=f.tabs.tRNS;if(U==null){if(R==8)for(N=0;N<g;N++){var k=3*N;T[N]=255<<24|u[k+2]<<16|u[k+1]<<8|u[k]}if(R==16)for(N=0;N<g;N++)k=6*N,T[N]=255<<24|u[k+4]<<16|u[k+2]<<8|u[k]}else{var _=U[0];const F=U[1],X=U[2];if(R==8)for(N=0;N<g;N++){var x=N<<2;k=3*N,T[N]=255<<24|u[k+2]<<16|u[k+1]<<8|u[k],u[k]==_&&u[k+1]==F&&u[k+2]==X&&(w[x+3]=0)}if(R==16)for(N=0;N<g;N++)x=N<<2,k=6*N,T[N]=255<<24|u[k+4]<<16|u[k+2]<<8|u[k],P(u,k)==_&&P(u,k+2)==F&&P(u,k+4)==X&&(w[x+3]=0)}}else if(E==3){const U=f.tabs.PLTE,F=f.tabs.tRNS,X=F?F.length:0;if(R==1)for(var S=0;S<d;S++){var A=S*v,M=S*h;for(N=0;N<h;N++){x=M+N<<2;var I=3*(j=u[A+(N>>3)]>>7-((7&N)<<0)&1);w[x]=U[I],w[x+1]=U[I+1],w[x+2]=U[I+2],w[x+3]=j<X?F[j]:255}}if(R==2)for(S=0;S<d;S++)for(A=S*v,M=S*h,N=0;N<h;N++)x=M+N<<2,I=3*(j=u[A+(N>>2)]>>6-((3&N)<<1)&3),w[x]=U[I],w[x+1]=U[I+1],w[x+2]=U[I+2],w[x+3]=j<X?F[j]:255;if(R==4)for(S=0;S<d;S++)for(A=S*v,M=S*h,N=0;N<h;N++)x=M+N<<2,I=3*(j=u[A+(N>>1)]>>4-((1&N)<<2)&15),w[x]=U[I],w[x+1]=U[I+1],w[x+2]=U[I+2],w[x+3]=j<X?F[j]:255;if(R==8)for(N=0;N<g;N++){var j;x=N<<2,I=3*(j=u[N]),w[x]=U[I],w[x+1]=U[I+1],w[x+2]=U[I+2],w[x+3]=j<X?F[j]:255}}else if(E==4){if(R==8)for(N=0;N<g;N++){x=N<<2;var B=u[L=N<<1];w[x]=B,w[x+1]=B,w[x+2]=B,w[x+3]=u[L+1]}if(R==16)for(N=0;N<g;N++){var L;x=N<<2,B=u[L=N<<2],w[x]=B,w[x+1]=B,w[x+2]=B,w[x+3]=u[L+2]}}else if(E==0)for(_=f.tabs.tRNS?f.tabs.tRNS:-1,S=0;S<d;S++){const U=S*v,F=S*h;if(R==1)for(var O=0;O<h;O++){var $=(B=255*(u[U+(O>>>3)]>>>7-(7&O)&1))==255*_?0:255;T[F+O]=$<<24|B<<16|B<<8|B}else if(R==2)for(O=0;O<h;O++)$=(B=85*(u[U+(O>>>2)]>>>6-((3&O)<<1)&3))==85*_?0:255,T[F+O]=$<<24|B<<16|B<<8|B;else if(R==4)for(O=0;O<h;O++)$=(B=17*(u[U+(O>>>1)]>>>4-((1&O)<<2)&15))==17*_?0:255,T[F+O]=$<<24|B<<16|B<<8|B;else if(R==8)for(O=0;O<h;O++)$=(B=u[U+O])==_?0:255,T[F+O]=$<<24|B<<16|B<<8|B;else if(R==16)for(O=0;O<h;O++)B=u[U+(O<<1)],$=P(u,U+(O<<1))==_?0:255,T[F+O]=$<<24|B<<16|B<<8|B}return w}function n(u,h,d,f){const g=i(u),y=Math.ceil(d*g/8),v=new Uint8Array((y+1+u.interlace)*f);return h=u.tabs.CgBI?s(h,v):r(h,v),u.interlace==0?h=o(h,u,0,d,f):u.interlace==1&&(h=function(T,E){const R=E.width,P=E.height,N=i(E),k=N>>3,_=Math.ceil(R*N/8),x=new Uint8Array(P*_);let S=0;const A=[0,0,4,0,2,0,1],M=[0,4,0,2,0,1,0],I=[8,8,8,4,4,2,2],j=[8,8,4,4,2,2,1];let B=0;for(;B<7;){const O=I[B],$=j[B];let U=0,F=0,X=A[B];for(;X<P;)X+=O,F++;let H=M[B];for(;H<R;)H+=$,U++;const J=Math.ceil(U*N/8);o(T,E,S,U,F);let z=0,W=A[B];for(;W<P;){let de=M[B],Te=S+z*J<<3;for(;de<R;){var L;if(N==1&&(L=(L=T[Te>>3])>>7-(7&Te)&1,x[W*_+(de>>3)]|=L<<7-((7&de)<<0)),N==2&&(L=(L=T[Te>>3])>>6-(7&Te)&3,x[W*_+(de>>2)]|=L<<6-((3&de)<<1)),N==4&&(L=(L=T[Te>>3])>>4-(7&Te)&15,x[W*_+(de>>1)]|=L<<4-((1&de)<<2)),N>=8){const Ie=W*_+de*k;for(let me=0;me<k;me++)x[Ie+me]=T[(Te>>3)+me]}Te+=N,de+=$}z++,W+=O}U*F!=0&&(S+=F*(1+J)),B+=1}return x}(h,u)),h}function r(u,h){return s(new Uint8Array(u.buffer,2,u.length-6),h)}var s=function(){const u={H:{}};return u.H.N=function(h,d){const f=Uint8Array;let g,y,v=0,w=0,T=0,E=0,R=0,P=0,N=0,k=0,_=0;if(h[0]==3&&h[1]==0)return d||new f(0);const x=u.H,S=x.b,A=x.e,M=x.R,I=x.n,j=x.A,B=x.Z,L=x.m,O=d==null;for(O&&(d=new f(h.length>>>2<<5));v==0;)if(v=S(h,_,1),w=S(h,_+1,2),_+=3,w!=0){if(O&&(d=u.H.W(d,k+(1<<17))),w==1&&(g=L.J,y=L.h,P=511,N=31),w==2){T=A(h,_,5)+257,E=A(h,_+5,5)+1,R=A(h,_+10,4)+4,_+=14;let U=1;for(var $=0;$<38;$+=2)L.Q[$]=0,L.Q[$+1]=0;for($=0;$<R;$++){const H=A(h,_+3*$,3);L.Q[1+(L.X[$]<<1)]=H,H>U&&(U=H)}_+=3*R,I(L.Q,U),j(L.Q,U,L.u),g=L.w,y=L.d,_=M(L.u,(1<<U)-1,T+E,h,_,L.v);const F=x.V(L.v,0,T,L.C);P=(1<<F)-1;const X=x.V(L.v,T,E,L.D);N=(1<<X)-1,I(L.C,F),j(L.C,F,g),I(L.D,X),j(L.D,X,y)}for(;;){const U=g[B(h,_)&P];_+=15&U;const F=U>>>4;if(!(F>>>8))d[k++]=F;else{if(F==256)break;{let X=k+F-254;if(F>264){const de=L.q[F-257];X=k+(de>>>3)+A(h,_,7&de),_+=7&de}const H=y[B(h,_)&N];_+=15&H;const J=H>>>4,z=L.c[J],W=(z>>>4)+S(h,_,15&z);for(_+=15&z;k<X;)d[k]=d[k++-W],d[k]=d[k++-W],d[k]=d[k++-W],d[k]=d[k++-W];k=X}}}}else{7&_&&(_+=8-(7&_));const U=4+(_>>>3),F=h[U-4]|h[U-3]<<8;O&&(d=u.H.W(d,k+F)),d.set(new f(h.buffer,h.byteOffset+U,F),k),_=U+F<<3,k+=F}return d.length==k?d:d.slice(0,k)},u.H.W=function(h,d){const f=h.length;if(d<=f)return h;const g=new Uint8Array(f<<1);return g.set(h,0),g},u.H.R=function(h,d,f,g,y,v){const w=u.H.e,T=u.H.Z;let E=0;for(;E<f;){const R=h[T(g,y)&d];y+=15&R;const P=R>>>4;if(P<=15)v[E]=P,E++;else{let N=0,k=0;P==16?(k=3+w(g,y,2),y+=2,N=v[E-1]):P==17?(k=3+w(g,y,3),y+=3):P==18&&(k=11+w(g,y,7),y+=7);const _=E+k;for(;E<_;)v[E]=N,E++}}return y},u.H.V=function(h,d,f,g){let y=0,v=0;const w=g.length>>>1;for(;v<f;){const T=h[v+d];g[v<<1]=0,g[1+(v<<1)]=T,T>y&&(y=T),v++}for(;v<w;)g[v<<1]=0,g[1+(v<<1)]=0,v++;return y},u.H.n=function(h,d){const f=u.H.m,g=h.length;let y,v,w,T;const E=f.j;for(var R=0;R<=d;R++)E[R]=0;for(R=1;R<g;R+=2)E[h[R]]++;const P=f.K;for(y=0,E[0]=0,v=1;v<=d;v++)y=y+E[v-1]<<1,P[v]=y;for(w=0;w<g;w+=2)T=h[w+1],T!=0&&(h[w]=P[T],P[T]++)},u.H.A=function(h,d,f){const g=h.length,y=u.H.m.r;for(let v=0;v<g;v+=2)if(h[v+1]!=0){const w=v>>1,T=h[v+1],E=w<<4|T,R=d-T;let P=h[v]<<R;const N=P+(1<<R);for(;P!=N;)f[y[P]>>>15-d]=E,P++}},u.H.l=function(h,d){const f=u.H.m.r,g=15-d;for(let y=0;y<h.length;y+=2){const v=h[y]<<d-h[y+1];h[y]=f[v]>>>g}},u.H.M=function(h,d,f){f<<=7&d;const g=d>>>3;h[g]|=f,h[g+1]|=f>>>8},u.H.I=function(h,d,f){f<<=7&d;const g=d>>>3;h[g]|=f,h[g+1]|=f>>>8,h[g+2]|=f>>>16},u.H.e=function(h,d,f){return(h[d>>>3]|h[1+(d>>>3)]<<8)>>>(7&d)&(1<<f)-1},u.H.b=function(h,d,f){return(h[d>>>3]|h[1+(d>>>3)]<<8|h[2+(d>>>3)]<<16)>>>(7&d)&(1<<f)-1},u.H.Z=function(h,d){return(h[d>>>3]|h[1+(d>>>3)]<<8|h[2+(d>>>3)]<<16)>>>(7&d)},u.H.i=function(h,d){return(h[d>>>3]|h[1+(d>>>3)]<<8|h[2+(d>>>3)]<<16|h[3+(d>>>3)]<<24)>>>(7&d)},u.H.m=function(){const h=Uint16Array,d=Uint32Array;return{K:new h(16),j:new h(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new h(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new d(32),J:new h(512),_:[],h:new h(32),$:[],w:new h(32768),C:[],v:[],d:new h(32768),D:[],u:new h(512),Q:[],r:new h(32768),s:new d(286),Y:new d(30),a:new d(19),t:new d(15e3),k:new h(65536),g:new h(32768)}}(),function(){const h=u.H.m;for(var d=0;d<32768;d++){let g=d;g=(2863311530&g)>>>1|(1431655765&g)<<1,g=(3435973836&g)>>>2|(858993459&g)<<2,g=(4042322160&g)>>>4|(252645135&g)<<4,g=(4278255360&g)>>>8|(16711935&g)<<8,h.r[d]=(g>>>16|g<<16)>>>17}function f(g,y,v){for(;y--!=0;)g.push(0,v)}for(d=0;d<32;d++)h.q[d]=h.S[d]<<3|h.T[d],h.c[d]=h.p[d]<<4|h.z[d];f(h._,144,8),f(h._,112,9),f(h._,24,7),f(h._,8,8),u.H.n(h._,9),u.H.A(h._,9,h.J),u.H.l(h._,9),f(h.$,32,5),u.H.n(h.$,5),u.H.A(h.$,5,h.h),u.H.l(h.$,5),f(h.Q,19,0),f(h.C,286,0),f(h.D,30,0),f(h.v,320,0)}(),u.H.N}();function i(u){return[1,null,3,1,2,null,4][u.ctype]*u.depth}function o(u,h,d,f,g){let y=i(h);const v=Math.ceil(f*y/8);let w,T;y=Math.ceil(y/8);let E=u[d],R=0;if(E>1&&(u[d]=[0,0,1][E-2]),E==3)for(R=y;R<v;R++)u[R+1]=u[R+1]+(u[R+1-y]>>>1)&255;for(let P=0;P<g;P++)if(w=d+P*v,T=w+P+1,E=u[T-1],R=0,E==0)for(;R<v;R++)u[w+R]=u[T+R];else if(E==1){for(;R<y;R++)u[w+R]=u[T+R];for(;R<v;R++)u[w+R]=u[T+R]+u[w+R-y]}else if(E==2)for(;R<v;R++)u[w+R]=u[T+R]+u[w+R-v];else if(E==3){for(;R<y;R++)u[w+R]=u[T+R]+(u[w+R-v]>>>1);for(;R<v;R++)u[w+R]=u[T+R]+(u[w+R-v]+u[w+R-y]>>>1)}else{for(;R<y;R++)u[w+R]=u[T+R]+a(0,u[w+R-v],0);for(;R<v;R++)u[w+R]=u[T+R]+a(u[w+R-y],u[w+R-v],u[w+R-y-v])}return u}function a(u,h,d){const f=u+h-d,g=f-u,y=f-h,v=f-d;return g*g<=y*y&&g*g<=v*v?u:y*y<=v*v?h:d}function l(u,h,d){d.width=t.readUint(u,h),h+=4,d.height=t.readUint(u,h),h+=4,d.depth=u[h],h++,d.ctype=u[h],h++,d.compress=u[h],h++,d.filter=u[h],h++,d.interlace=u[h],h++}function c(u,h,d,f,g,y,v,w,T){const E=Math.min(h,g),R=Math.min(d,y);let P=0,N=0;for(let B=0;B<R;B++)for(let L=0;L<E;L++)if(v>=0&&w>=0?(P=B*h+L<<2,N=(w+B)*g+v+L<<2):(P=(-w+B)*h-v+L<<2,N=B*g+L<<2),T==0)f[N]=u[P],f[N+1]=u[P+1],f[N+2]=u[P+2],f[N+3]=u[P+3];else if(T==1){var k=u[P+3]*.00392156862745098,_=u[P]*k,x=u[P+1]*k,S=u[P+2]*k,A=f[N+3]*(1/255),M=f[N]*A,I=f[N+1]*A,j=f[N+2]*A;const O=1-k,$=k+A*O,U=$==0?0:1/$;f[N+3]=255*$,f[N+0]=(_+M*O)*U,f[N+1]=(x+I*O)*U,f[N+2]=(S+j*O)*U}else if(T==2)k=u[P+3],_=u[P],x=u[P+1],S=u[P+2],A=f[N+3],M=f[N],I=f[N+1],j=f[N+2],k==A&&_==M&&x==I&&S==j?(f[N]=0,f[N+1]=0,f[N+2]=0,f[N+3]=0):(f[N]=_,f[N+1]=x,f[N+2]=S,f[N+3]=k);else if(T==3){if(k=u[P+3],_=u[P],x=u[P+1],S=u[P+2],A=f[N+3],M=f[N],I=f[N+1],j=f[N+2],k==A&&_==M&&x==I&&S==j)continue;if(k<220&&A>20)return!1}return!0}return{decode:function(h){const d=new Uint8Array(h);let f=8;const g=t,y=g.readUshort,v=g.readUint,w={tabs:{},frames:[]},T=new Uint8Array(d.length);let E,R=0,P=0;const N=[137,80,78,71,13,10,26,10];for(var k=0;k<8;k++)if(d[k]!=N[k])throw"The input is not a PNG file!";for(;f<d.length;){const B=g.readUint(d,f);f+=4;const L=g.readASCII(d,f,4);if(f+=4,L=="IHDR")l(d,f,w);else if(L=="iCCP"){for(var _=f;d[_]!=0;)_++;g.readASCII(d,f,_-f),d[_+1];const O=d.slice(_+2,f+B);let $=null;try{$=r(O)}catch{$=s(O)}w.tabs[L]=$}else if(L=="CgBI")w.tabs[L]=d.slice(f,f+4);else if(L=="IDAT"){for(k=0;k<B;k++)T[R+k]=d[f+k];R+=B}else if(L=="acTL")w.tabs[L]={num_frames:v(d,f),num_plays:v(d,f+4)},E=new Uint8Array(d.length);else if(L=="fcTL"){P!=0&&((j=w.frames[w.frames.length-1]).data=n(w,E.slice(0,P),j.rect.width,j.rect.height),P=0);const O={x:v(d,f+12),y:v(d,f+16),width:v(d,f+4),height:v(d,f+8)};let $=y(d,f+22);$=y(d,f+20)/($==0?100:$);const U={rect:O,delay:Math.round(1e3*$),dispose:d[f+24],blend:d[f+25]};w.frames.push(U)}else if(L=="fdAT"){for(k=0;k<B-4;k++)E[P+k]=d[f+k+4];P+=B-4}else if(L=="pHYs")w.tabs[L]=[g.readUint(d,f),g.readUint(d,f+4),d[f+8]];else if(L=="cHRM")for(w.tabs[L]=[],k=0;k<8;k++)w.tabs[L].push(g.readUint(d,f+4*k));else if(L=="tEXt"||L=="zTXt"){w.tabs[L]==null&&(w.tabs[L]={});var x=g.nextZero(d,f),S=g.readASCII(d,f,x-f),A=f+B-x-1;if(L=="tEXt")I=g.readASCII(d,x+1,A);else{var M=r(d.slice(x+2,x+2+A));I=g.readUTF8(M,0,M.length)}w.tabs[L][S]=I}else if(L=="iTXt"){w.tabs[L]==null&&(w.tabs[L]={}),x=0,_=f,x=g.nextZero(d,_),S=g.readASCII(d,_,x-_);const O=d[_=x+1];var I;d[_+1],_+=2,x=g.nextZero(d,_),g.readASCII(d,_,x-_),_=x+1,x=g.nextZero(d,_),g.readUTF8(d,_,x-_),A=B-((_=x+1)-f),O==0?I=g.readUTF8(d,_,A):(M=r(d.slice(_,_+A)),I=g.readUTF8(M,0,M.length)),w.tabs[L][S]=I}else if(L=="PLTE")w.tabs[L]=g.readBytes(d,f,B);else if(L=="hIST"){const O=w.tabs.PLTE.length/3;for(w.tabs[L]=[],k=0;k<O;k++)w.tabs[L].push(y(d,f+2*k))}else if(L=="tRNS")w.ctype==3?w.tabs[L]=g.readBytes(d,f,B):w.ctype==0?w.tabs[L]=y(d,f):w.ctype==2&&(w.tabs[L]=[y(d,f),y(d,f+2),y(d,f+4)]);else if(L=="gAMA")w.tabs[L]=g.readUint(d,f)/1e5;else if(L=="sRGB")w.tabs[L]=d[f];else if(L=="bKGD")w.ctype==0||w.ctype==4?w.tabs[L]=[y(d,f)]:w.ctype==2||w.ctype==6?w.tabs[L]=[y(d,f),y(d,f+2),y(d,f+4)]:w.ctype==3&&(w.tabs[L]=d[f]);else if(L=="IEND")break;f+=B,g.readUint(d,f),f+=4}var j;return P!=0&&((j=w.frames[w.frames.length-1]).data=n(w,E.slice(0,P),j.rect.width,j.rect.height)),w.data=n(w,T,w.width,w.height),delete w.compress,delete w.interlace,delete w.filter,w},toRGBA8:function(h){const d=h.width,f=h.height;if(h.tabs.acTL==null)return[e(h.data,d,f,h).buffer];const g=[];h.frames[0].data==null&&(h.frames[0].data=h.data);const y=d*f*4,v=new Uint8Array(y),w=new Uint8Array(y),T=new Uint8Array(y);for(let R=0;R<h.frames.length;R++){const P=h.frames[R],N=P.rect.x,k=P.rect.y,_=P.rect.width,x=P.rect.height,S=e(P.data,_,x,h);if(R!=0)for(var E=0;E<y;E++)T[E]=v[E];if(P.blend==0?c(S,_,x,v,d,f,N,k,0):P.blend==1&&c(S,_,x,v,d,f,N,k,1),g.push(v.buffer.slice(0)),P.dispose!=0){if(P.dispose==1)c(w,_,x,v,d,f,N,k,0);else if(P.dispose==2)for(E=0;E<y;E++)v[E]=T[E]}}return g},_paeth:a,_copyTile:c,_bin:t}}();(function(){const{_copyTile:t}=Gr,{_bin:e}=Gr,n=Gr._paeth;var r={table:function(){const _=new Uint32Array(256);for(let x=0;x<256;x++){let S=x;for(let A=0;A<8;A++)1&S?S=3988292384^S>>>1:S>>>=1;_[x]=S}return _}(),update(_,x,S,A){for(let M=0;M<A;M++)_=r.table[255&(_^x[S+M])]^_>>>8;return _},crc:(_,x,S)=>4294967295^r.update(4294967295,_,x,S)};function s(_,x,S,A){x[S]+=_[0]*A>>4,x[S+1]+=_[1]*A>>4,x[S+2]+=_[2]*A>>4,x[S+3]+=_[3]*A>>4}function i(_){return Math.max(0,Math.min(255,_))}function o(_,x){const S=_[0]-x[0],A=_[1]-x[1],M=_[2]-x[2],I=_[3]-x[3];return S*S+A*A+M*M+I*I}function a(_,x,S,A,M,I,j){j==null&&(j=1);const B=A.length,L=[];for(var O=0;O<B;O++){const W=A[O];L.push([W>>>0&255,W>>>8&255,W>>>16&255,W>>>24&255])}for(O=0;O<B;O++){let W=4294967295;for(var $=0,U=0;U<B;U++){var F=o(L[O],L[U]);U!=O&&F<W&&(W=F,$=U)}}const X=new Uint32Array(M.buffer),H=new Int16Array(x*S*4),J=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(O=0;O<J.length;O++)J[O]=255*((J[O]+.5)/16-.5);for(let W=0;W<S;W++)for(let de=0;de<x;de++){var z;O=4*(W*x+de),j!=2?z=[i(_[O]+H[O]),i(_[O+1]+H[O+1]),i(_[O+2]+H[O+2]),i(_[O+3]+H[O+3])]:(F=J[4*(3&W)+(3&de)],z=[i(_[O]+F),i(_[O+1]+F),i(_[O+2]+F),i(_[O+3]+F)]),$=0;let Te=16777215;for(U=0;U<B;U++){const Ae=o(z,L[U]);Ae<Te&&(Te=Ae,$=U)}const Ie=L[$],me=[z[0]-Ie[0],z[1]-Ie[1],z[2]-Ie[2],z[3]-Ie[3]];j==1&&(de!=x-1&&s(me,H,O+4,7),W!=S-1&&(de!=0&&s(me,H,O+4*x-4,3),s(me,H,O+4*x,5),de!=x-1&&s(me,H,O+4*x+4,1))),I[O>>2]=$,X[O>>2]=A[$]}}function l(_,x,S,A,M){M==null&&(M={});const{crc:I}=r,j=e.writeUint,B=e.writeUshort,L=e.writeASCII;let O=8;const $=_.frames.length>1;let U,F=!1,X=33+($?20:0);if(M.sRGB!=null&&(X+=13),M.pHYs!=null&&(X+=21),M.iCCP!=null&&(U=pako.deflate(M.iCCP),X+=21+U.length+4),_.ctype==3){for(var H=_.plte.length,J=0;J<H;J++)_.plte[J]>>>24!=255&&(F=!0);X+=8+3*H+4+(F?8+1*H+4:0)}for(var z=0;z<_.frames.length;z++)$&&(X+=38),X+=(Ie=_.frames[z]).cimg.length+12,z!=0&&(X+=4);X+=12;const W=new Uint8Array(X),de=[137,80,78,71,13,10,26,10];for(J=0;J<8;J++)W[J]=de[J];if(j(W,O,13),O+=4,L(W,O,"IHDR"),O+=4,j(W,O,x),O+=4,j(W,O,S),O+=4,W[O]=_.depth,O++,W[O]=_.ctype,O++,W[O]=0,O++,W[O]=0,O++,W[O]=0,O++,j(W,O,I(W,O-17,17)),O+=4,M.sRGB!=null&&(j(W,O,1),O+=4,L(W,O,"sRGB"),O+=4,W[O]=M.sRGB,O++,j(W,O,I(W,O-5,5)),O+=4),M.iCCP!=null){const me=13+U.length;j(W,O,me),O+=4,L(W,O,"iCCP"),O+=4,L(W,O,"ICC profile"),O+=11,O+=2,W.set(U,O),O+=U.length,j(W,O,I(W,O-(me+4),me+4)),O+=4}if(M.pHYs!=null&&(j(W,O,9),O+=4,L(W,O,"pHYs"),O+=4,j(W,O,M.pHYs[0]),O+=4,j(W,O,M.pHYs[1]),O+=4,W[O]=M.pHYs[2],O++,j(W,O,I(W,O-13,13)),O+=4),$&&(j(W,O,8),O+=4,L(W,O,"acTL"),O+=4,j(W,O,_.frames.length),O+=4,j(W,O,M.loop!=null?M.loop:0),O+=4,j(W,O,I(W,O-12,12)),O+=4),_.ctype==3){for(j(W,O,3*(H=_.plte.length)),O+=4,L(W,O,"PLTE"),O+=4,J=0;J<H;J++){const me=3*J,Ae=_.plte[J],Re=255&Ae,Oe=Ae>>>8&255,jt=Ae>>>16&255;W[O+me+0]=Re,W[O+me+1]=Oe,W[O+me+2]=jt}if(O+=3*H,j(W,O,I(W,O-3*H-4,3*H+4)),O+=4,F){for(j(W,O,H),O+=4,L(W,O,"tRNS"),O+=4,J=0;J<H;J++)W[O+J]=_.plte[J]>>>24&255;O+=H,j(W,O,I(W,O-H-4,H+4)),O+=4}}let Te=0;for(z=0;z<_.frames.length;z++){var Ie=_.frames[z];$&&(j(W,O,26),O+=4,L(W,O,"fcTL"),O+=4,j(W,O,Te++),O+=4,j(W,O,Ie.rect.width),O+=4,j(W,O,Ie.rect.height),O+=4,j(W,O,Ie.rect.x),O+=4,j(W,O,Ie.rect.y),O+=4,B(W,O,A[z]),O+=2,B(W,O,1e3),O+=2,W[O]=Ie.dispose,O++,W[O]=Ie.blend,O++,j(W,O,I(W,O-30,30)),O+=4);const me=Ie.cimg;j(W,O,(H=me.length)+(z==0?0:4)),O+=4;const Ae=O;L(W,O,z==0?"IDAT":"fdAT"),O+=4,z!=0&&(j(W,O,Te++),O+=4),W.set(me,O),O+=H,j(W,O,I(W,Ae,O-Ae)),O+=4}return j(W,O,0),O+=4,L(W,O,"IEND"),O+=4,j(W,O,I(W,O-4,4)),O+=4,W.buffer}function c(_,x,S){for(let A=0;A<_.frames.length;A++){const M=_.frames[A];M.rect.width;const I=M.rect.height,j=new Uint8Array(I*M.bpl+I);M.cimg=f(M.img,I,M.bpp,M.bpl,j,x,S)}}function u(_,x,S,A,M){const I=M[0],j=M[1],B=M[2],L=M[3],O=M[4],$=M[5];let U=6,F=8,X=255;for(var H=0;H<_.length;H++){const Ke=new Uint8Array(_[H]);for(var J=Ke.length,z=0;z<J;z+=4)X&=Ke[z+3]}const W=X!=255,de=function(Fe,Z,fe,Ee,ee,re){const ne=[];for(var ce=0;ce<Fe.length;ce++){const He=new Uint8Array(Fe[ce]),st=new Uint32Array(He.buffer);var G;let tt=0,Bt=0,Ut=Z,or=fe,fn=Ee?1:0;if(ce!=0){const hs=re||Ee||ce==1||ne[ce-2].dispose!=0?1:2;let Tn=0,iu=1e9;for(let Hr=0;Hr<hs;Hr++){var we=new Uint8Array(Fe[ce-1-Hr]);const tf=new Uint32Array(Fe[ce-1-Hr]);let mt=Z,Wr=fe,br=-1,qr=-1;for(let Fs=0;Fs<fe;Fs++)for(let Kn=0;Kn<Z;Kn++)st[Ce=Fs*Z+Kn]!=tf[Ce]&&(Kn<mt&&(mt=Kn),Kn>br&&(br=Kn),Fs<Wr&&(Wr=Fs),Fs>qr&&(qr=Fs));br==-1&&(mt=Wr=br=qr=0),ee&&((1&mt)==1&&mt--,(1&Wr)==1&&Wr--);const nf=(br-mt+1)*(qr-Wr+1);nf<iu&&(iu=nf,Tn=Hr,tt=mt,Bt=Wr,Ut=br-mt+1,or=qr-Wr+1)}we=new Uint8Array(Fe[ce-1-Tn]),Tn==1&&(ne[ce-1].dispose=2),G=new Uint8Array(Ut*or*4),t(we,Z,fe,G,Ut,or,-tt,-Bt,0),fn=t(He,Z,fe,G,Ut,or,-tt,-Bt,3)?1:0,fn==1?d(He,Z,fe,G,{x:tt,y:Bt,width:Ut,height:or}):t(He,Z,fe,G,Ut,or,-tt,-Bt,0)}else G=He.slice(0);ne.push({rect:{x:tt,y:Bt,width:Ut,height:or},img:G,blend:fn,dispose:0})}if(Ee)for(ce=0;ce<ne.length;ce++){if((tn=ne[ce]).blend==1)continue;const He=tn.rect,st=ne[ce-1].rect,tt=Math.min(He.x,st.x),Bt=Math.min(He.y,st.y),Ut={x:tt,y:Bt,width:Math.max(He.x+He.width,st.x+st.width)-tt,height:Math.max(He.y+He.height,st.y+st.height)-Bt};ne[ce-1].dispose=1,ce-1!=0&&h(Fe,Z,fe,ne,ce-1,Ut,ee),h(Fe,Z,fe,ne,ce,Ut,ee)}let je=0;if(Fe.length!=1)for(var Ce=0;Ce<ne.length;Ce++){var tn;je+=(tn=ne[Ce]).rect.width*tn.rect.height}return ne}(_,x,S,I,j,B),Te={},Ie=[],me=[];if(A!=0){const Ke=[];for(z=0;z<de.length;z++)Ke.push(de[z].img.buffer);const Fe=function(ee){let re=0;for(var ne=0;ne<ee.length;ne++)re+=ee[ne].byteLength;const ce=new Uint8Array(re);let G=0;for(ne=0;ne<ee.length;ne++){const we=new Uint8Array(ee[ne]),je=we.length;for(let Ce=0;Ce<je;Ce+=4){let tn=we[Ce],He=we[Ce+1],st=we[Ce+2];const tt=we[Ce+3];tt==0&&(tn=He=st=0),ce[G+Ce]=tn,ce[G+Ce+1]=He,ce[G+Ce+2]=st,ce[G+Ce+3]=tt}G+=je}return ce.buffer}(Ke),Z=y(Fe,A);for(z=0;z<Z.plte.length;z++)Ie.push(Z.plte[z].est.rgba);let fe=0;for(z=0;z<de.length;z++){const Ee=(Re=de[z]).img.length;var Ae=new Uint8Array(Z.inds.buffer,fe>>2,Ee>>2);me.push(Ae);const ee=new Uint8Array(Z.abuf,fe,Ee);$&&a(Re.img,Re.rect.width,Re.rect.height,Ie,ee,Ae),Re.img.set(ee),fe+=Ee}}else for(H=0;H<de.length;H++){var Re=de[H];const Ke=new Uint32Array(Re.img.buffer);var Oe=Re.rect.width;for(J=Ke.length,Ae=new Uint8Array(J),me.push(Ae),z=0;z<J;z++){const Fe=Ke[z];if(z!=0&&Fe==Ke[z-1])Ae[z]=Ae[z-1];else if(z>Oe&&Fe==Ke[z-Oe])Ae[z]=Ae[z-Oe];else{let Z=Te[Fe];if(Z==null&&(Te[Fe]=Z=Ie.length,Ie.push(Fe),Ie.length>=300))break;Ae[z]=Z}}}const jt=Ie.length;for(jt<=256&&O==0&&(F=jt<=2?1:jt<=4?2:jt<=16?4:8,F=Math.max(F,L)),H=0;H<de.length;H++){(Re=de[H]).rect.x,Re.rect.y,Oe=Re.rect.width;const Ke=Re.rect.height;let Fe=Re.img;new Uint32Array(Fe.buffer);let Z=4*Oe,fe=4;if(jt<=256&&O==0){Z=Math.ceil(F*Oe/8);var xt=new Uint8Array(Z*Ke);const Ee=me[H];for(let ee=0;ee<Ke;ee++){z=ee*Z;const re=ee*Oe;if(F==8)for(var Be=0;Be<Oe;Be++)xt[z+Be]=Ee[re+Be];else if(F==4)for(Be=0;Be<Oe;Be++)xt[z+(Be>>1)]|=Ee[re+Be]<<4-4*(1&Be);else if(F==2)for(Be=0;Be<Oe;Be++)xt[z+(Be>>2)]|=Ee[re+Be]<<6-2*(3&Be);else if(F==1)for(Be=0;Be<Oe;Be++)xt[z+(Be>>3)]|=Ee[re+Be]<<7-1*(7&Be)}Fe=xt,U=3,fe=1}else if(W==0&&de.length==1){xt=new Uint8Array(Oe*Ke*3);const Ee=Oe*Ke;for(z=0;z<Ee;z++){const ee=3*z,re=4*z;xt[ee]=Fe[re],xt[ee+1]=Fe[re+1],xt[ee+2]=Fe[re+2]}Fe=xt,U=2,fe=3,Z=3*Oe}Re.img=Fe,Re.bpl=Z,Re.bpp=fe}return{ctype:U,depth:F,plte:Ie,frames:de}}function h(_,x,S,A,M,I,j){const B=Uint8Array,L=Uint32Array,O=new B(_[M-1]),$=new L(_[M-1]),U=M+1<_.length?new B(_[M+1]):null,F=new B(_[M]),X=new L(F.buffer);let H=x,J=S,z=-1,W=-1;for(let Te=0;Te<I.height;Te++)for(let Ie=0;Ie<I.width;Ie++){const me=I.x+Ie,Ae=I.y+Te,Re=Ae*x+me,Oe=X[Re];Oe==0||A[M-1].dispose==0&&$[Re]==Oe&&(U==null||U[4*Re+3]!=0)||(me<H&&(H=me),me>z&&(z=me),Ae<J&&(J=Ae),Ae>W&&(W=Ae))}z==-1&&(H=J=z=W=0),j&&((1&H)==1&&H--,(1&J)==1&&J--),I={x:H,y:J,width:z-H+1,height:W-J+1};const de=A[M];de.rect=I,de.blend=1,de.img=new Uint8Array(I.width*I.height*4),A[M-1].dispose==0?(t(O,x,S,de.img,I.width,I.height,-I.x,-I.y,0),d(F,x,S,de.img,I)):t(F,x,S,de.img,I.width,I.height,-I.x,-I.y,0)}function d(_,x,S,A,M){t(_,x,S,A,M.width,M.height,-M.x,-M.y,2)}function f(_,x,S,A,M,I,j){const B=[];let L,O=[0,1,2,3,4];I!=-1?O=[I]:(x*A>5e5||S==1)&&(O=[0]),j&&(L={level:0});const $=wW;for(var U=0;U<O.length;U++){for(let H=0;H<x;H++)g(M,_,H,A,S,O[U]);B.push($.deflate(M,L))}let F,X=1e9;for(U=0;U<B.length;U++)B[U].length<X&&(F=U,X=B[U].length);return B[F]}function g(_,x,S,A,M,I){const j=S*A;let B=j+S;if(_[B]=I,B++,I==0)if(A<500)for(var L=0;L<A;L++)_[B+L]=x[j+L];else _.set(new Uint8Array(x.buffer,j,A),B);else if(I==1){for(L=0;L<M;L++)_[B+L]=x[j+L];for(L=M;L<A;L++)_[B+L]=x[j+L]-x[j+L-M]+256&255}else if(S==0){for(L=0;L<M;L++)_[B+L]=x[j+L];if(I==2)for(L=M;L<A;L++)_[B+L]=x[j+L];if(I==3)for(L=M;L<A;L++)_[B+L]=x[j+L]-(x[j+L-M]>>1)+256&255;if(I==4)for(L=M;L<A;L++)_[B+L]=x[j+L]-n(x[j+L-M],0,0)+256&255}else{if(I==2)for(L=0;L<A;L++)_[B+L]=x[j+L]+256-x[j+L-A]&255;if(I==3){for(L=0;L<M;L++)_[B+L]=x[j+L]+256-(x[j+L-A]>>1)&255;for(L=M;L<A;L++)_[B+L]=x[j+L]+256-(x[j+L-A]+x[j+L-M]>>1)&255}if(I==4){for(L=0;L<M;L++)_[B+L]=x[j+L]+256-n(0,x[j+L-A],0)&255;for(L=M;L<A;L++)_[B+L]=x[j+L]+256-n(x[j+L-M],x[j+L-A],x[j+L-M-A])&255}}}function y(_,x){const S=new Uint8Array(_),A=S.slice(0),M=new Uint32Array(A.buffer),I=v(A,x),j=I[0],B=I[1],L=S.length,O=new Uint8Array(L>>2);let $;if(S.length<2e7)for(var U=0;U<L;U+=4)$=w(j,F=S[U]*(1/255),X=S[U+1]*(1/255),H=S[U+2]*(1/255),J=S[U+3]*(1/255)),O[U>>2]=$.ind,M[U>>2]=$.est.rgba;else for(U=0;U<L;U+=4){var F=S[U]*.00392156862745098,X=S[U+1]*(1/255),H=S[U+2]*(1/255),J=S[U+3]*(1/255);for($=j;$.left;)$=T($.est,F,X,H,J)<=0?$.left:$.right;O[U>>2]=$.ind,M[U>>2]=$.est.rgba}return{abuf:A.buffer,inds:O,plte:B}}function v(_,x,S){S==null&&(S=1e-4);const A=new Uint32Array(_.buffer),M={i0:0,i1:_.length,bst:null,est:null,tdst:0,left:null,right:null};M.bst=P(_,M.i0,M.i1),M.est=N(M.bst);const I=[M];for(;I.length<x;){let B=0,L=0;for(var j=0;j<I.length;j++)I[j].est.L>B&&(B=I[j].est.L,L=j);if(B<S)break;const O=I[L],$=E(_,A,O.i0,O.i1,O.est.e,O.est.eMq255);if(O.i0>=$||O.i1<=$){O.est.L=0;continue}const U={i0:O.i0,i1:$,bst:null,est:null,tdst:0,left:null,right:null};U.bst=P(_,U.i0,U.i1),U.est=N(U.bst);const F={i0:$,i1:O.i1,bst:null,est:null,tdst:0,left:null,right:null};for(F.bst={R:[],m:[],N:O.bst.N-U.bst.N},j=0;j<16;j++)F.bst.R[j]=O.bst.R[j]-U.bst.R[j];for(j=0;j<4;j++)F.bst.m[j]=O.bst.m[j]-U.bst.m[j];F.est=N(F.bst),O.left=U,O.right=F,I[L]=U,I.push(F)}for(I.sort((B,L)=>L.bst.N-B.bst.N),j=0;j<I.length;j++)I[j].ind=j;return[M,I]}function w(_,x,S,A,M){if(_.left==null)return _.tdst=function(U,F,X,H,J){const z=F-U[0],W=X-U[1],de=H-U[2],Te=J-U[3];return z*z+W*W+de*de+Te*Te}(_.est.q,x,S,A,M),_;const I=T(_.est,x,S,A,M);let j=_.left,B=_.right;I>0&&(j=_.right,B=_.left);const L=w(j,x,S,A,M);if(L.tdst<=I*I)return L;const O=w(B,x,S,A,M);return O.tdst<L.tdst?O:L}function T(_,x,S,A,M){const{e:I}=_;return I[0]*x+I[1]*S+I[2]*A+I[3]*M-_.eMq}function E(_,x,S,A,M,I){for(A-=4;S<A;){for(;R(_,S,M)<=I;)S+=4;for(;R(_,A,M)>I;)A-=4;if(S>=A)break;const j=x[S>>2];x[S>>2]=x[A>>2],x[A>>2]=j,S+=4,A-=4}for(;R(_,S,M)>I;)S-=4;return S+4}function R(_,x,S){return _[x]*S[0]+_[x+1]*S[1]+_[x+2]*S[2]+_[x+3]*S[3]}function P(_,x,S){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],M=[0,0,0,0],I=S-x>>2;for(let j=x;j<S;j+=4){const B=_[j]*.00392156862745098,L=_[j+1]*(1/255),O=_[j+2]*(1/255),$=_[j+3]*(1/255);M[0]+=B,M[1]+=L,M[2]+=O,M[3]+=$,A[0]+=B*B,A[1]+=B*L,A[2]+=B*O,A[3]+=B*$,A[5]+=L*L,A[6]+=L*O,A[7]+=L*$,A[10]+=O*O,A[11]+=O*$,A[15]+=$*$}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:M,N:I}}function N(_){const{R:x}=_,{m:S}=_,{N:A}=_,M=S[0],I=S[1],j=S[2],B=S[3],L=A==0?0:1/A,O=[x[0]-M*M*L,x[1]-M*I*L,x[2]-M*j*L,x[3]-M*B*L,x[4]-I*M*L,x[5]-I*I*L,x[6]-I*j*L,x[7]-I*B*L,x[8]-j*M*L,x[9]-j*I*L,x[10]-j*j*L,x[11]-j*B*L,x[12]-B*M*L,x[13]-B*I*L,x[14]-B*j*L,x[15]-B*B*L],$=O,U=k;let F=[Math.random(),Math.random(),Math.random(),Math.random()],X=0,H=0;if(A!=0)for(let z=0;z<16&&(F=U.multVec($,F),H=Math.sqrt(U.dot(F,F)),F=U.sml(1/H,F),!(z!=0&&Math.abs(H-X)<1e-9));z++)X=H;const J=[M*L,I*L,j*L,B*L];return{Cov:O,q:J,e:F,L:X,eMq255:U.dot(U.sml(255,J),F),eMq:U.dot(F,J),rgba:(Math.round(255*J[3])<<24|Math.round(255*J[2])<<16|Math.round(255*J[1])<<8|Math.round(255*J[0])<<0)>>>0}}var k={multVec:(_,x)=>[_[0]*x[0]+_[1]*x[1]+_[2]*x[2]+_[3]*x[3],_[4]*x[0]+_[5]*x[1]+_[6]*x[2]+_[7]*x[3],_[8]*x[0]+_[9]*x[1]+_[10]*x[2]+_[11]*x[3],_[12]*x[0]+_[13]*x[1]+_[14]*x[2]+_[15]*x[3]],dot:(_,x)=>_[0]*x[0]+_[1]*x[1]+_[2]*x[2]+_[3]*x[3],sml:(_,x)=>[_*x[0],_*x[1],_*x[2],_*x[3]]};Gr.encode=function(x,S,A,M,I,j,B){M==null&&(M=0),B==null&&(B=!1);const L=u(x,S,A,M,[!1,!1,!1,0,B,!1]);return c(L,-1),l(L,S,A,I,j)},Gr.encodeLL=function(x,S,A,M,I,j,B,L){const O={ctype:0+(M==1?0:2)+(I==0?0:4),depth:j,frames:[]},$=(M+I)*j,U=$*S;for(let F=0;F<x.length;F++)O.frames.push({rect:{x:0,y:0,width:S,height:A},img:new Uint8Array(x[F]),blend:0,dispose:1,bpp:Math.ceil($/8),bpl:Math.ceil(U/8)});return c(O,0,!0),l(O,S,A,B,L)},Gr.encode.compress=u,Gr.encode.dither=a,Gr.quantize=y,Gr.quantize.getKDtree=v,Gr.quantize.getNearest=w})();const oD={toArrayBuffer(t,e){const n=t.width,r=t.height,s=n<<2,i=t.getContext("2d").getImageData(0,0,n,r),o=new Uint32Array(i.data.buffer),a=(32*n+31)/32<<2,l=a*r,c=122+l,u=new ArrayBuffer(c),h=new DataView(u),d=1<<20;let f,g,y,v,w=d,T=0,E=0,R=0;function P(_){h.setUint16(E,_,!0),E+=2}function N(_){h.setUint32(E,_,!0),E+=4}function k(_){E+=_}P(19778),N(c),k(4),N(122),N(108),N(n),N(-r>>>0),P(1),P(32),N(3),N(l),N(2835),N(2835),k(8),N(16711680),N(65280),N(255),N(4278190080),N(1466527264),function _(){for(;T<r&&w>0;){for(v=122+T*a,f=0;f<s;)w--,g=o[R++],y=g>>>24,h.setUint32(v+f,g<<8|y),f+=4;T++}R<o.length?(w=d,setTimeout(_,oD._dly)):e(u)}()},toBlob(t,e){this.toArrayBuffer(t,n=>{e(new Blob([n],{type:"image/bmp"}))})},_dly:9};var Yn={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},_W={[Yn.CHROME]:16384,[Yn.FIREFOX]:11180,[Yn.DESKTOP_SAFARI]:16384,[Yn.IE]:8192,[Yn.IOS]:4096,[Yn.ETC]:8192};const Cb=typeof window<"u",aD=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,Km=Cb&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),xW=(Cb||aD)&&(Km&&Km.getOriginalSymbol(window,"File")||typeof File<"u"&&File),lD=(Cb||aD)&&(Km&&Km.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function Ib(t,e,n=Date.now()){return new Promise(r=>{const s=t.split(","),i=s[0].match(/:(.*?);/)[1],o=globalThis.atob(s[1]);let a=o.length;const l=new Uint8Array(a);for(;a--;)l[a]=o.charCodeAt(a);const c=new Blob([l],{type:i});c.name=e,c.lastModified=n,r(c)})}function cD(t){return new Promise((e,n)=>{const r=new lD;r.onload=()=>e(r.result),r.onerror=s=>n(s),r.readAsDataURL(t)})}function uD(t){return new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=s=>n(s),r.src=t})}function pa(){if(pa.cachedResult!==void 0)return pa.cachedResult;let t=Yn.ETC;const{userAgent:e}=navigator;return/Chrom(e|ium)/i.test(e)?t=Yn.CHROME:/iP(ad|od|hone)/i.test(e)&&/WebKit/i.test(e)?t=Yn.IOS:/Safari/i.test(e)?t=Yn.DESKTOP_SAFARI:/Firefox/i.test(e)?t=Yn.FIREFOX:(/MSIE/i.test(e)||document.documentMode)&&(t=Yn.IE),pa.cachedResult=t,pa.cachedResult}function hD(t,e){const n=pa(),r=_W[n];let s=t,i=e,o=s*i;const a=s>i?i/s:s/i;for(;o>r*r;){const l=(r+s)/2,c=(r+i)/2;l<c?(i=c,s=c*a):(i=l*a,s=l),o=s*i}return{width:s,height:i}}function Fy(t,e){let n,r;try{if(n=new OffscreenCanvas(t,e),r=n.getContext("2d"),r===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{n=document.createElement("canvas"),r=n.getContext("2d")}return n.width=t,n.height=e,[n,r]}function dD(t,e){const{width:n,height:r}=hD(t.width,t.height),[s,i]=Fy(n,r);return e&&/jpe?g/.test(e)&&(i.fillStyle="white",i.fillRect(0,0,s.width,s.height)),i.drawImage(t,0,0,s.width,s.height),s}function Up(){return Up.cachedResult!==void 0||(Up.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Up.cachedResult}function Gm(t,e={}){return new Promise(function(n,r){let s,i;var o=function(){try{return i=dD(s,e.fileType||t.type),n([s,i])}catch(l){return r(l)}},a=function(l){try{var c=function(u){try{throw u}catch(h){return r(h)}};try{let u;return cD(t).then(function(h){try{return u=h,uD(u).then(function(d){try{return s=d,function(){try{return o()}catch(f){return r(f)}}()}catch(f){return c(f)}},c)}catch(d){return c(d)}},c)}catch(u){c(u)}}catch(u){return r(u)}};try{if(Up()||[Yn.DESKTOP_SAFARI,Yn.MOBILE_SAFARI].includes(pa()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(t).then(function(l){try{return s=l,o()}catch{return a()}},a)}catch{a()}})}function Qm(t,e,n,r,s=1){return new Promise(function(i,o){let a;if(e==="image/png"){let h,d,f;return h=t.getContext("2d"),{data:d}=h.getImageData(0,0,t.width,t.height),f=Gr.encode([d.buffer],t.width,t.height,4096*s),a=new Blob([f],{type:e}),a.name=n,a.lastModified=r,l.call(this)}{let h=function(){return l.call(this)};var c=h;if(e==="image/bmp")return new Promise(d=>oD.toBlob(t,d)).then((function(d){try{return a=d,a.name=n,a.lastModified=r,h.call(this)}catch(f){return o(f)}}).bind(this),o);{let d=function(){return h.call(this)};var u=d;if(typeof OffscreenCanvas=="function"&&t instanceof OffscreenCanvas)return t.convertToBlob({type:e,quality:s}).then((function(f){try{return a=f,a.name=n,a.lastModified=r,d.call(this)}catch(g){return o(g)}}).bind(this),o);{let f;return f=t.toDataURL(e,s),Ib(f,n,r).then((function(g){try{return a=g,d.call(this)}catch(y){return o(y)}}).bind(this),o)}}}function l(){return i(a)}})}function _s(t){t.width=0,t.height=0}function Xl(){return new Promise(function(t,e){let n,r,s,i;return Xl.cachedResult!==void 0?t(Xl.cachedResult):Ib("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then(function(o){try{return n=o,Gm(n).then(function(a){try{return r=a[1],Qm(r,n.type,n.name,n.lastModified).then(function(l){try{return s=l,_s(r),Gm(s).then(function(c){try{return i=c[0],Xl.cachedResult=i.width===1&&i.height===2,t(Xl.cachedResult)}catch(u){return e(u)}},e)}catch(c){return e(c)}},e)}catch(l){return e(l)}},e)}catch(a){return e(a)}},e)})}function fD(t){return new Promise((e,n)=>{const r=new lD;r.onload=s=>{const i=new DataView(s.target.result);if(i.getUint16(0,!1)!=65496)return e(-2);const o=i.byteLength;let a=2;for(;a<o;){if(i.getUint16(a+2,!1)<=8)return e(-1);const l=i.getUint16(a,!1);if(a+=2,l==65505){if(i.getUint32(a+=2,!1)!=1165519206)return e(-1);const c=i.getUint16(a+=6,!1)==18761;a+=i.getUint32(a+4,c);const u=i.getUint16(a,c);a+=2;for(let h=0;h<u;h++)if(i.getUint16(a+12*h,c)==274)return e(i.getUint16(a+12*h+8,c))}else{if((65280&l)!=65280)break;a+=i.getUint16(a,!1)}}return e(-1)},r.onerror=s=>n(s),r.readAsArrayBuffer(t)})}function pD(t,e){const{width:n}=t,{height:r}=t,{maxWidthOrHeight:s}=e;let i,o=t;return isFinite(s)&&(n>s||r>s)&&([o,i]=Fy(n,r),n>r?(o.width=s,o.height=r/n*s):(o.width=n/r*s,o.height=s),i.drawImage(t,0,0,o.width,o.height),_s(t)),o}function mD(t,e){const{width:n}=t,{height:r}=t,[s,i]=Fy(n,r);switch(e>4&&e<9?(s.width=r,s.height=n):(s.width=n,s.height=r),e){case 2:i.transform(-1,0,0,1,n,0);break;case 3:i.transform(-1,0,0,-1,n,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,n);break;case 8:i.transform(0,-1,1,0,0,n)}return i.drawImage(t,0,0,n,r),_s(t),s}function OC(t,e,n=0){return new Promise(function(r,s){let i,o,a,l,c,u,h,d,f,g,y,v,w,T,E,R,P,N,k,_;function x(A=5){if(e.signal&&e.signal.aborted)throw e.signal.reason;i+=A,e.onProgress(Math.min(i,100))}function S(A){if(e.signal&&e.signal.aborted)throw e.signal.reason;i=Math.min(Math.max(A,i),100),e.onProgress(i)}return i=n,o=e.maxIteration||10,a=1024*e.maxSizeMB*1024,x(),Gm(t,e).then((function(A){try{return[,l]=A,x(),c=pD(l,e),x(),new Promise(function(M,I){var j;if(!(j=e.exifOrientation))return fD(t).then((function(L){try{return j=L,B.call(this)}catch(O){return I(O)}}).bind(this),I);function B(){return M(j)}return B.call(this)}).then((function(M){try{return u=M,x(),Xl().then((function(I){try{return h=I?c:mD(c,u),x(),d=e.initialQuality||1,f=e.fileType||t.type,Qm(h,f,t.name,t.lastModified,d).then((function(j){try{{let $=function(){if(o--&&(E>a||E>w)){let F,X;return F=_?.95*k.width:k.width,X=_?.95*k.height:k.height,[P,N]=Fy(F,X),N.drawImage(k,0,0,F,X),d*=f==="image/png"?.85:.95,Qm(P,f,t.name,t.lastModified,d).then(function(H){try{return R=H,_s(k),k=P,E=R.size,S(Math.min(99,Math.floor((T-E)/(T-a)*100))),$}catch(J){return s(J)}},s)}return[1]},U=function(){return _s(k),_s(P),_s(c),_s(h),_s(l),S(100),r(R)};var L=$,O=U;if(g=j,x(),y=g.size>a,v=g.size>t.size,!y&&!v)return S(100),r(g);var B;return w=t.size,T=g.size,E=T,k=h,_=!e.alwaysKeepResolution&&y,(B=(function(F){for(;F;){if(F.then)return void F.then(B,s);try{if(F.pop){if(F.length)return F.pop()?U.call(this):F;F=$}else F=F.call(this)}catch(X){return s(X)}}}).bind(this))($)}}catch($){return s($)}}).bind(this),s)}catch(j){return s(j)}}).bind(this),s)}catch(I){return s(I)}}).bind(this),s)}catch(M){return s(M)}}).bind(this),s)})}const bW=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let m0;function TW(t,e){return new Promise((n,r)=>{m0||(m0=function(o){const a=[];return a.push(o),URL.createObjectURL(new Blob(a))}(bW));const s=new Worker(m0);s.addEventListener("message",function(o){if(e.signal&&e.signal.aborted)s.terminate();else if(o.data.progress===void 0){if(o.data.error)return r(new Error(o.data.error)),void s.terminate();n(o.data.file),s.terminate()}else e.onProgress(o.data.progress)}),s.addEventListener("error",r),e.signal&&e.signal.addEventListener("abort",()=>{r(e.signal.reason),s.terminate()}),s.postMessage({file:t,imageCompressionLibUrl:e.libURL,options:{...e,onProgress:void 0,signal:void 0}})})}function Cn(t,e){return new Promise(function(n,r){let s,i,o,a,l,c;if(s={...e},o=0,{onProgress:a}=s,s.maxSizeMB=s.maxSizeMB||Number.POSITIVE_INFINITY,l=typeof s.useWebWorker!="boolean"||s.useWebWorker,delete s.useWebWorker,s.onProgress=f=>{o=f,typeof a=="function"&&a(o)},!(t instanceof Blob||t instanceof xW))return r(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(t.type))return r(new Error("The file given is not an image"));if(c=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!l||typeof Worker!="function"||c)return OC(t,s).then((function(f){try{return i=f,d.call(this)}catch(g){return r(g)}}).bind(this),r);var u=(function(){try{return d.call(this)}catch(f){return r(f)}}).bind(this),h=function(f){try{return OC(t,s).then(function(g){try{return i=g,u()}catch(y){return r(y)}},r)}catch(g){return r(g)}};try{return s.libURL=s.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",TW(t,s).then(function(f){try{return i=f,u()}catch{return h()}},h)}catch{h()}function d(){try{i.name=t.name,i.lastModified=t.lastModified}catch{}try{s.preserveExif&&t.type==="image/jpeg"&&(!s.fileType||s.fileType&&s.fileType===t.type)&&(i=iD(t,i))}catch{}return n(i)}})}Cn.getDataUrlFromFile=cD,Cn.getFilefromDataUrl=Ib,Cn.loadImage=uD,Cn.drawImageInCanvas=dD,Cn.drawFileInCanvas=Gm,Cn.canvasToFile=Qm,Cn.getExifOrientation=fD,Cn.handleMaxWidthOrHeight=pD,Cn.followExifOrientation=mD,Cn.cleanupCanvasMemory=_s,Cn.isAutoOrientationInBrowser=Xl,Cn.approximateBelowMaximumCanvasSizeOfBrowser=hD,Cn.copyExifWithoutOrientation=iD,Cn.getBrowserName=pa,Cn.version="2.0.2";const I1=[],ma=[],Yu={colorTone:[{value:"warm",label:"Tng Mu m",description:"G, be, nh sng du"},{value:"cool",label:"Tng Mu Lnh",description:"Trng, xm, nh sng xanh"},{value:"neutral",label:"Trung Tnh / Ti Gin",description:"Sch s v n gin"}],budget:[{value:"budget",label:"Tit Kim",description:"Di 10 triu"},{value:"mid-range",label:"Tm Trung",description:"10 - 50 triu"},{value:"premium",label:"Cao Cp",description:"Trn 50 triu"}],gender:[{value:"masculine",label:"Nam Tnh",description:"Mnh m v c tnh"},{value:"feminine",label:"N Tnh",description:"Nh nhng v thanh lch"},{value:"neutral",label:"Trung Tnh",description:"Ph hp mi ngi"}],purpose:[{value:"work-from-home",label:"Lm Vic Ti Nh",description:"Lm vic t xa chuyn nghip"},{value:"gaming",label:"Gaming",description:"Chi game v gii tr"},{value:"creative",label:"Sng To / Thit K",description:"Cng vic sng to"},{value:"productivity",label:"Nng Sut",description:"Hiu qu ti a"}],size:[{value:"small",label:"Khng Gian Nh",description:"Setup nh gn"},{value:"medium",label:"Trung Bnh",description:"Kch thc bn tiu chun"},{value:"large",label:"Ln / Studio",description:"Setup rng ri"}]},DC=$d(Jt,"setups"),LC=$d(Jt,"blogs");$d(Jt,"users");const jC=$d(Jt,"comments"),EW=$d(Jt,"newsletter"),la=["admin@deskhub.com","thanhdat.rces@gmail.com"],Qt={getData:async()=>{try{const t=l0(DC,eC("createdAt","desc"),tC(50)),n=(await c0(t)).docs.map(a=>({id:a.id,...a.data()})),r=l0(LC,eC("createdAt","desc"),tC(20)),i=(await c0(r)).docs.map(a=>({id:a.id,...a.data()}));return{setups:n,blogs:i,comments:{}}}catch(t){return console.error("Error getting data (using fallback):",t),{setups:I1,blogs:ma,comments:{}}}},login:async(t,e)=>{try{const n=t.includes("@")?t:`${t}@deskhub.com`,s=(await LH(dc,n,e)).user;let i={};try{const o=await Lp(Qn(Jt,"users",s.uid));o.exists()&&(i=o.data()),(la.includes(s.email)||la.includes(n))&&i.role!=="admin"&&(console.log(`Auto-promoting ${s.email} to Admin`),await Vi(Qn(Jt,"users",s.uid),{role:"admin"}),i.role="admin")}catch(o){console.warn("Firestore access failed (offline?):",o),(la.includes(s.email)||la.includes(n))&&(i.role="admin")}return{id:s.uid,email:s.email,displayName:s.displayName||i.displayName||t,photoURL:s.photoURL||i.avatar,role:i.role||"user"}}catch(n){throw console.error(n),n}},register:async t=>{try{const{email:e,password:n,username:r,displayName:s}=t,o=(await DH(dc,e,n)).user;await IO(o,{displayName:s});const a={username:r,displayName:s,email:e,role:la.includes(e)?"admin":"user",avatar:`https://ui-avatars.com/api/?name=${s}`,createdAt:new Date().toISOString()};return await L8(Qn(Jt,"users",o.uid),a),{success:!0,user:{id:o.uid,...a}}}catch(e){throw console.error(e),e}},logout:async()=>{await BH(dc)},toggleLike:async(t,e)=>{try{const n=Qn(Jt,"setups",t),r=await Lp(n);if(r.exists()){const i=r.data().likes||[],o=i.some(l=>l.userId===e||l===e);let a;return o?a=i.filter(l=>l.userId!==e&&l!==e):a=[...i,{userId:e,timestamp:new Date().toISOString()}],await Vi(n,{likes:a}),{success:!0,likes:a}}}catch(n){console.error(n)}return{success:!1}},toggleSave:async(t,e)=>{try{const n=Qn(Jt,"setups",t),r=await Lp(n);if(r.exists()){const i=r.data().saves||[],o=i.some(l=>l.userId===e||l===e);let a;return o?a=i.filter(l=>l.userId!==e&&l!==e):a=[...i,{userId:e,timestamp:new Date().toISOString()}],await Vi(n,{saves:a}),{success:!0,saves:a}}}catch(n){console.error(n)}return{success:!1}},addComment:async(t,e)=>{try{const n={setupId:t,text:e.text,author:e.author,userId:e.userId,avatar:e.avatar,timestamp:new Date().toISOString()};e.replyTo&&(n.replyTo=e.replyTo);const r=await Bf(jC,n),s=Qn(Jt,"setups",t);return await Vi(s,{comments:iC(1)}),{id:r.id,...n}}catch(n){throw console.error(n),n}},getCommentsForSetup:async t=>{try{const e=l0(jC,M8("setupId","==",t));return(await c0(e)).docs.map(s=>({id:s.id,...s.data()})).sort((s,i)=>{const o=s.timestamp?new Date(s.timestamp).getTime():0;return(i.timestamp?new Date(i.timestamp).getTime():0)-o})}catch(e){return console.error("Error fetching comments:",e),[]}},addSetup:async t=>{try{if(console.log(" addSetup called with data:",t),!t.title||!t.caption)throw new Error("Missing required fields: title or caption");const e={...t,likes:[],saves:[],comments:0,createdAt:new Date().toISOString()};console.log(" Calling addDoc with data:",JSON.stringify(e,null,2));const n=await Bf(DC,e);return console.log(" Setup added successfully with ID:",n.id),{success:!0,setup:{id:n.id,...e}}}catch(e){return console.error(" addSetup FAILED:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),console.error("Full error:",JSON.stringify(e,null,2)),e.code==="permission-denied"?{success:!1,message:"Permission denied. Check Firestore Security Rules."}:e.code==="unavailable"?{success:!1,message:"Network error. Check your internet connection."}:{success:!1,message:e.message||"Unknown error occurred"}}},deleteSetup:async t=>{try{return await sC(Qn(Jt,"setups",t)),{success:!0}}catch(e){return{success:!1,message:e.message}}},updateSetup:async(t,e)=>{try{const n=Qn(Jt,"setups",t);return await Vi(n,e),{success:!0,setup:{id:t,...e}}}catch(n){return{success:!1,message:n.message}}},addBlog:async t=>{try{if(console.log(" addBlog called with data:",t),!t.title||!t.excerpt||!t.content)throw new Error("Missing required fields: title, excerpt, or content");const e={...t,views:0,publishedAt:new Date().toISOString()};console.log(" Calling addDoc with data:",JSON.stringify(e,null,2));const n=await Bf(LC,e);return console.log(" Blog added successfully with ID:",n.id),{...e,id:n.id}}catch(e){throw console.error(" addBlog FAILED:",e),console.error("Error code:",e.code),console.error("Error message:",e.message),e.code==="permission-denied"?new Error("Permission denied. Check Firestore Security Rules."):e}},subscribeNewsletter:async t=>{try{return await Bf(EW,{...t,timestamp:new Date().toISOString()}),{success:!0}}catch(e){return console.error(e),{success:!1}}},incrementBlogView:async t=>{try{const e=Qn(Jt,"blogs",t);return await Vi(e,{views:iC(1)}),{success:!0}}catch{return{success:!1}}},deleteBlog:async t=>{try{return await sC(Qn(Jt,"blogs",t)),{success:!0}}catch(e){return console.error(e),{success:!1}}},updateBlog:async(t,e)=>{try{const n=Qn(Jt,"blogs",t);return await Vi(n,e),{success:!0,blog:{id:t,...e}}}catch{return{success:!1}}},_imgbbApiKey:"2a4945145b81f0e070078eeb4571403c",uploadFile:async t=>{var n;console.log(` Starting upload for ${t.name}`);let e=t;if(t.type.startsWith("image/"))try{e=await Cn(t,{maxSizeMB:1,maxWidthOrHeight:1920,useWebWorker:!0,initialQuality:.8}),console.log(`Image compressed: ${(t.size/1024).toFixed(1)}KB -> ${(e.size/1024).toFixed(1)}KB`)}catch(r){console.warn("Compression error, using original file:",r)}try{const r=`uploads/${Date.now()}_${t.name.replace(/[^a-zA-Z0-9.-]/g,"_")}`,s=PC(MC,r),i={contentType:t.type},o=await aW(s,e,i),a=await NC(o.ref);return console.log(` Upload success (Firebase): ${a}`),a}catch(r){console.error("Firebase upload failed, trying fallback to ImgBB...",r);try{const i=await(c=>new Promise((u,h)=>{const d=new FileReader;d.readAsDataURL(c),d.onload=()=>u(d.result.split(",")[1]),d.onerror=h}))(e),o=new FormData;o.append("key","2a4945145b81f0e070078eeb4571403c"),o.append("image",i);const l=await(await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:o})).json();if(l.success)return console.log(` Upload success (ImgBB Fallback): ${l.data.url}`),l.data.url;throw new Error(((n=l.error)==null?void 0:n.message)||"ImgBB error")}catch(s){throw console.error("ImgBB fallback also failed:",s),new Error(`Upload tht bi: ${r.message}`)}}},uploadVideo:async(t,e)=>new Promise((n,r)=>{const s=PC(MC,`videos/${Date.now()}_${t.name}`),i={contentType:t.type},o=lW(s,t,i);o.on("state_changed",a=>{const l=a.bytesTransferred/a.totalBytes*100;e&&e(l)},a=>{console.error("Video upload failed:",a),a.code==="storage/unauthorized"?r(new Error("Khng c quyn ti ln video (Li Storage Rules)")):a.code==="storage/canceled"?r(new Error(" hy ti ln")):r(a)},async()=>{try{const a=await NC(o.snapshot.ref);n(a)}catch(a){r(a)}})})},gD=V.createContext(),Hf="deskhub_cache_setups",VC="deskhub_cache_blogs",yD="deskhub_cache_timestamp",SW=5*60*1e3,kW=()=>{try{const t=localStorage.getItem(yD);return t&&Date.now()-parseInt(t)<SW}catch{return!1}},bn=()=>{const t=V.useContext(gD);if(!t)throw new Error("useApp must be used within AppProvider");return t},CW=({children:t})=>{const[e,n]=V.useState("light"),[r,s]=V.useState(()=>{try{const ee=localStorage.getItem(Hf);if(ee){const re=JSON.parse(ee);if(re&&re.length>0)return console.log(" Instant load:",re.length,"setups from cache"),re}}catch(ee){console.warn("Cache parse error:",ee)}return[]}),[i,o]=V.useState(()=>{try{const ee=localStorage.getItem(VC);if(ee){const re=JSON.parse(ee);if(re&&re.length>0)return re}}catch(ee){console.warn("Cache parse error:",ee)}return[]}),[a,l]=V.useState(null),[c,u]=V.useState(()=>{try{const ee=localStorage.getItem(Hf);if(ee){const re=JSON.parse(ee);return!(re&&re.length>0)}}catch{}return!0}),h=async()=>{let ee=!1;try{const ne=localStorage.getItem(Hf);if(ne){const ce=JSON.parse(ne);ee=ce&&ce.length>0}}catch{}const re=kW();if(ee&&re){console.log(" Cache is fresh with data, skipping network"),u(!1);return}console.log(" Fetching data from Firestore...",{hasData:ee,cacheFresh:re});try{const ne=await Qt.getData();if(ne.setups&&ne.setups.length>0){console.log(" Loaded",ne.setups.length,"setups from Firestore"),s(ne.setups);try{localStorage.setItem(Hf,JSON.stringify(ne.setups))}catch(ce){console.warn("Cache storage failed:",ce)}}else ee||(console.warn(" No data from Firestore, using sample data"),s(I1));if(ne.blogs&&ne.blogs.length>0){o(ne.blogs);try{localStorage.setItem(VC,JSON.stringify(ne.blogs))}catch(ce){console.warn("Cache storage failed:",ce)}}else o(ma);localStorage.setItem(yD,Date.now().toString()),O(ne.comments||{})}catch(ne){console.error(" Error loading data from Firestore:",ne),ee||(console.log(" Using sample data as fallback"),s(I1),o(ma))}finally{u(!1)}},[d,f]=V.useState({colorTone:[],budget:[],gender:[],purpose:[],size:[],search:""}),[g,y]=V.useState("gallery"),[v,w]=V.useState(null),[T,E]=V.useState(null),[R,P]=V.useState(!1),[N,k]=V.useState(!1),[_,x]=V.useState(!1),[S,A]=V.useState(!1),[M,I]=V.useState(!1),[j,B]=V.useState(!1),[L,O]=V.useState({});V.useEffect(()=>{h(),$();const ee=dc.onAuthStateChanged(async re=>{var ne;if(re){const ce=la.includes(re.email),G={id:re.uid,email:re.email,displayName:re.displayName||((ne=re.email)==null?void 0:ne.split("@")[0]),photoURL:re.photoURL,role:ce?"admin":"user"};l(G);try{const we=Qn(Jt,"users",re.uid);Lp(we).then(je=>{if(je.exists()){const Ce=je.data(),tn=la.includes(re.email);l(He=>({...He,displayName:Ce.displayName||He.displayName,photoURL:Ce.avatar||He.photoURL,role:tn?"admin":Ce.role||He.role}))}}).catch(je=>console.warn("Background user fetch failed:",je))}catch(we){console.warn("Failed to initiate user fetch:",we)}}else l(null)});return()=>ee()},[]);const $=()=>{const ee=localStorage.getItem("deskhub_theme")||"light";n(ee),document.documentElement.setAttribute("data-theme",ee)},Ee={refreshData:h,theme:e,toggleTheme:()=>{const ee=e==="light"?"dark":"light";n(ee),localStorage.setItem("deskhub_theme",ee),document.documentElement.setAttribute("data-theme",ee)},setups:r,loading:c,blogs:i,currentUser:a,refreshUser:()=>{a&&!a.isGuest||l(Iu())},filters:d,setFilters:f,currentView:g,setCurrentView:y,selectedSetup:v,setSelectedSetup:w,selectedBlog:T,setSelectedBlog:E,showAuthModal:R,setShowAuthModal:P,showProfileModal:N,setShowProfileModal:k,showNewsletterModal:_,setShowNewsletterModal:x,showCollectionsModal:S,setShowCollectionsModal:A,showAddSetupModal:M,setShowAddSetupModal:I,showMobileFilter:j,setShowMobileFilter:B,getFilteredSetups:()=>r.filter(ee=>{if(d.search){const ne=d.search.toLowerCase();if(!(ee.title.toLowerCase().includes(ne)||ee.caption.toLowerCase().includes(ne)||ee.tags.some(G=>G.toLowerCase().includes(ne))))return!1}const re=["colorTone","budget","gender","purpose","size"];for(const ne of re)if(d[ne].length>0&&!d[ne].includes(ee.filters[ne]))return!1;return!0}),toggleLike:async ee=>{if(!a){P(!0);return}const re=a,ne=await Qt.toggleLike(ee,re.id);ne.success&&s(ce=>ce.map(G=>G.id===ee?{...G,likes:ne.likes}:G))},toggleSave:async ee=>{if(!a){P(!0);return}const re=a,ne=await Qt.toggleSave(ee,re.id);ne.success&&s(ce=>ce.map(G=>G.id===ee?{...G,saves:ne.saves}:G))},hasUserLiked:ee=>{const re=a||Iu();if(!re)return!1;const ne=r.find(G=>G.id===ee);return ne?(ne.likes||[]).some(G=>G.userId===re.id||G===re.id):!1},hasUserSaved:ee=>{const re=a||Iu();if(!re)return!1;const ne=r.find(G=>G.id===ee);return ne?(ne.saves||[]).some(G=>G.userId===re.id||G===re.id):!1},getSavedSetups:()=>{const ee=a||Iu();return ee?r.filter(re=>(re.saves||[]).some(ce=>ce.userId===ee.id||ce===ee.id)):[]},addComment:async(ee,re)=>{const ne=a||Iu(),ce=ne.photoURL||ne.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(ne.displayName||"User")}&background=random`;let G;typeof re=="object"&&re!==null?G={text:re.text,author:re.author||ne.displayName,avatar:re.avatar||ce,userId:re.userId||ne.id}:G={text:re,author:ne.displayName,avatar:ce,userId:ne.id};const we=await Qt.addComment(ee,G);O(je=>({...je,[ee]:[...je[ee]||[],we]})),s(je=>je.map(Ce=>Ce.id===ee?{...Ce,comments:(Ce.comments||0)+1}:Ce))},getComments:ee=>L[ee]||[],fetchCommentsForSetup:async ee=>{try{const re=await Qt.getCommentsForSetup(ee);return O(ne=>({...ne,[ee]:re})),re}catch(re){return console.error("Error fetching comments:",re),[]}},subscribeNewsletter:async ee=>{const re={email:ee.email,name:ee.name||"Khch"};return await Qt.subscribeNewsletter(re)},addBlog:async ee=>{if(console.log(" AppContext.addBlog called"),(a==null?void 0:a.role)!=="admin")return console.warn(" Non-admin user attempted to add blog"),{success:!1,message:"Ch Admin mi c th vit blog!"};const re=a,ne=re.displayName||re.email||"Admin",ce=re.photoURL||re.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(ne)}&background=random`,G={...ee,author:{name:ne,avatar:ce}};console.log(" Blog data prepared:",G);const we=await Qt.addBlog(G);return o([we,...i]),{success:!0,blog:we}},updateBlog:async(ee,re)=>{if((a==null?void 0:a.role)!=="admin")return{success:!1,message:"Ch Admin mi c th chnh sa blog!"};const ne=await Qt.updateBlog(ee,re);return ne.success?(o(ce=>ce.map(G=>G.id===ee?ne.blog:G)),{success:!0,blog:ne.blog}):{success:!1,message:"Cp nht tht bi"}},deleteBlog:async ee=>(a==null?void 0:a.role)!=="admin"?{success:!1,message:"Ch Admin mi c th xa blog!"}:(await Qt.deleteBlog(ee)).success?(o(ne=>ne.filter(ce=>ce.id!==ee)),{success:!0}):{success:!1,message:"Xa tht bi"},addSetup:async ee=>{if(console.log(" AppContext.addSetup called"),(a==null?void 0:a.role)!=="admin")return console.warn(" Non-admin user attempted to add setup"),{success:!1,message:"Ch Admin mi c th thm setup!"};const re=a;console.log(" Current user:",{id:re.id,displayName:re.displayName,role:re.role});const ne=re.photoURL||re.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(re.displayName||"User")}`,ce={...ee,author:{name:re.displayName||re.email||"Anonymous",avatar:ne}};console.log(" Calling api.addSetup with setupToSave:",ce);const G=await Qt.addSetup(ce);return console.log(" api.addSetup response:",G),G.success?(s(we=>[G.setup,...we]),{success:!0,setup:G.setup}):{success:!1,message:G.message||"Thm setup tht bi"}},updateSetup:async(ee,re)=>{if((a==null?void 0:a.role)!=="admin")return{success:!1,message:"Ch Admin mi c th sa setup!"};const ne=await Qt.updateSetup(ee,re);return ne.success?(s(ce=>ce.map(G=>G.id===ee?ne.setup:G)),{success:!0,setup:ne.setup}):{success:!1,message:"Cp nht tht bi"}},deleteSetup:async ee=>(a==null?void 0:a.role)!=="admin"?{success:!1,message:"Ch Admin mi c th xa setup!"}:(await Qt.deleteSetup(ee)).success?(s(ne=>ne.filter(ce=>ce.id!==ee)),{success:!0}):{success:!1,message:"Xa tht bi"},logout:async()=>{await Qt.logout()},getSimilarSetups:(ee,re=4)=>{const ne=r.find(ce=>ce.id===ee);return ne?r.filter(ce=>ce.id!==ee).map(ce=>{let G=0;Object.keys(ne.filters).forEach(je=>{ce.filters[je]===ne.filters[je]&&(G+=1)});const we=ce.tags.filter(je=>ne.tags.includes(je)).length;return G+=we*.5,{...ce,similarityScore:G}}).sort((ce,G)=>G.similarityScore-ce.similarityScore).slice(0,re):[]},setBlogs:o};return p.jsx(gD.Provider,{value:Ee,children:t})},IW=()=>{const{theme:t,toggleTheme:e,filters:n,setFilters:r,currentUser:s,setShowAuthModal:i,setShowProfileModal:o,setShowNewsletterModal:a,setShowCollectionsModal:l,setShowAddSetupModal:c,setShowMobileFilter:u}=bn(),[h,d]=V.useState(!1),[f,g]=V.useState(!1),[y,v]=V.useState(!1),w=Xc(),T=_i(),E=T.pathname==="/"||T.pathname==="/gallery",R=_=>{r({...n,search:_.target.value}),T.pathname!=="/"&&T.pathname!=="/gallery"&&w("/")},P=()=>v(!1),k=Object.keys(n).reduce((_,x)=>x==="search"?_:_+n[x].length,0);return p.jsxs("header",{className:"header",children:[p.jsxs("div",{className:"container header-container",children:[p.jsxs(Cr,{to:"/",className:"header-logo",onClick:P,children:[p.jsxs("svg",{width:"32",height:"32",viewBox:"0 0 32 32",fill:"none",children:[p.jsx("rect",{width:"32",height:"32",rx:"8",fill:"url(#logo-gradient)"}),p.jsx("path",{d:"M8 12h16M8 16h16M8 20h12",stroke:"white",strokeWidth:"2",strokeLinecap:"round"}),p.jsx("defs",{children:p.jsxs("linearGradient",{id:"logo-gradient",x1:"0",y1:"0",x2:"32",y2:"32",children:[p.jsx("stop",{offset:"0%",stopColor:"hsl(220, 90%, 56%)"}),p.jsx("stop",{offset:"100%",stopColor:"hsl(280, 70%, 60%)"})]})})]}),p.jsx("span",{className:"header-logo-text",children:"DeskHub"})]}),p.jsxs("nav",{className:"header-nav desktop-only",children:[p.jsx(Cr,{to:"/",className:`nav-link ${T.pathname==="/"||T.pathname==="/gallery"?"active":""}`,children:"B Su Tp"}),p.jsx(Cr,{to:"/blog",className:`nav-link ${T.pathname.startsWith("/blog")?"active":""}`,children:"Blog"})]}),p.jsxs("div",{className:"header-actions",children:[(s==null?void 0:s.role)==="admin"&&p.jsxs("div",{className:"desktop-only",style:{display:"flex",alignItems:"center"},children:[p.jsx(Cr,{to:"/blog/seo-new",className:"btn",style:{padding:"0.5rem 1rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem",backgroundColor:"var(--bg-secondary)",color:"var(--text-primary)",marginRight:"0.5rem",textDecoration:"none",borderRadius:"8px"},children:" Blog"}),p.jsxs("button",{className:"btn btn-primary",style:{padding:"0.5rem 1rem",fontSize:"0.9rem",display:"flex",alignItems:"center",gap:"0.5rem"},onClick:()=>c(!0),children:[p.jsx("span",{children:"+"})," ng Gc"]})]}),p.jsxs("div",{className:`search-container ${h?"expanded":""}`,children:[p.jsx("input",{type:"text",className:"search-input",placeholder:"Tm kim...",value:n.search,onChange:R,onFocus:()=>d(!0),onBlur:()=>!n.search&&d(!1)}),p.jsx("svg",{className:"search-icon",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM19 19l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),E&&p.jsxs("button",{className:"btn-icon mobile-filter-btn mobile-only",onClick:()=>u(!0),title:"B lc",children:[p.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:p.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),k>0&&p.jsx("span",{className:"filter-badge",children:k})]}),p.jsx("button",{className:"btn-icon mobile-menu-toggle mobile-only",onClick:()=>v(!0),children:s?p.jsx("img",{src:s.avatar||`https://ui-avatars.com/api/?name=${s.displayName}`,alt:"",className:"mobile-avatar-btn"}):p.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),p.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),p.jsx("button",{className:"btn btn-icon desktop-only",onClick:()=>l(!0),title:"Setup  lu",style:{color:"var(--color-text-primary)"},children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"2"})})}),p.jsx("button",{className:"btn btn-icon theme-toggle desktop-only",onClick:e,title:"i theme",style:{color:"var(--color-text-primary)"},children:t==="light"?p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("path",{d:"M10 3V1M10 19v-2M17 10h2M1 10h2M15.657 4.343l1.414-1.414M3.343 16.657l1.414-1.414M15.657 15.657l1.414 1.414M3.343 3.343l1.414 1.414",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),p.jsx("circle",{cx:"10",cy:"10",r:"4",stroke:"currentColor",strokeWidth:"2"})]}):p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"currentColor",children:p.jsx("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),p.jsxs("div",{className:"user-menu-container desktop-only",children:[p.jsx("button",{className:"user-avatar-btn",onClick:()=>g(!f),children:p.jsx("img",{src:(s==null?void 0:s.avatar)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.displayName)||"Guest"}`,alt:""})}),f&&p.jsxs("div",{className:"user-menu",children:[p.jsxs("div",{className:"user-menu-header",children:[p.jsx("img",{src:(s==null?void 0:s.avatar)||`https://ui-avatars.com/api/?name=${(s==null?void 0:s.displayName)||"Guest"}`,alt:""}),p.jsxs("div",{children:[p.jsx("p",{className:"user-menu-name",children:(s==null?void 0:s.displayName)||"Khch"}),p.jsx("p",{className:"user-menu-role",children:s?s.role==="admin"?"Qun tr vin":"Thnh vin":"Cha ng nhp"})]})]}),p.jsxs("div",{className:"user-menu-items",children:[p.jsxs("button",{onClick:()=>{o(!0),g(!1)},children:[p.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M10 10a4 4 0 100-8 4 4 0 000 8zM3 18a7 7 0 0114 0",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"H S"]}),(s==null?void 0:s.role)==="admin"&&p.jsxs(Cr,{to:"/admin",onClick:()=>g(!1),style:{display:"flex",alignItems:"center",gap:"0.75rem",width:"100%",textAlign:"left",padding:"0.75rem 1rem",color:"var(--color-text-primary)",textDecoration:"none",fontSize:"0.95rem",background:"none",border:"none",cursor:"pointer"},onMouseEnter:_=>_.target.style.background="var(--color-surface-hover)",onMouseLeave:_=>_.target.style.background="transparent",children:[p.jsxs("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("rect",{x:"3",y:"3",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),p.jsx("rect",{x:"11",y:"3",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),p.jsx("rect",{x:"3",y:"11",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"}),p.jsx("rect",{x:"11",y:"11",width:"6",height:"6",rx:"1",stroke:"currentColor",strokeWidth:"2"})]}),"Dashboard"]}),p.jsxs("button",{onClick:()=>{l(!0),g(!1)},children:[p.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"2"})}),"Setup  Lu"]}),!s&&p.jsxs("button",{onClick:()=>{i(!0),g(!1)},children:[p.jsx("svg",{width:"18",height:"18",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M10 3v14M3 10h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"ng Nhp / ng K"]})]})]})]})]})]}),f&&p.jsx("div",{className:"user-menu-overlay",onClick:()=>g(!1)}),p.jsxs(p.Fragment,{children:[p.jsx("div",{className:`mobile-menu-backdrop ${y?"open":""}`,onClick:()=>v(!1)}),p.jsxs("div",{className:`mobile-menu-drawer ${y?"open":""}`,children:[p.jsxs("div",{className:"mobile-menu-header",children:[p.jsx("h3",{children:"Menu"}),p.jsx("button",{className:"mobile-close-btn",onClick:()=>v(!1),children:p.jsxs("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),p.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),s&&p.jsxs("div",{className:"mobile-user-profile",onClick:()=>{o(!0),P()},children:[p.jsx("img",{src:s.avatar,alt:"Avatar"}),p.jsxs("div",{children:[p.jsx("p",{className:"name",children:s.displayName}),p.jsx("p",{className:"role",children:s.role==="admin"?"Admin":"Member"})]})]}),p.jsxs("div",{className:"mobile-nav-links",children:[p.jsx(Cr,{to:"/",className:`mobile-nav-item ${T.pathname==="/"?"active":""}`,onClick:P,children:"Trang Ch"}),p.jsx(Cr,{to:"/blog",className:`mobile-nav-item ${T.pathname.startsWith("/blog")?"active":""}`,onClick:P,children:"Blog"}),(s==null?void 0:s.role)==="admin"&&p.jsx(Cr,{to:"/admin",className:"mobile-nav-item",onClick:P,children:"Qun L (Admin)"})]}),p.jsxs("div",{className:"mobile-actions",children:[p.jsx("button",{className:"mobile-action-btn",onClick:()=>{l(!0),P()},children:"Setup  Lu"}),(s==null?void 0:s.role)==="admin"&&p.jsx("button",{className:"mobile-action-btn primary",onClick:()=>{c(!0),P()},children:"+ ng Setup"}),!s&&p.jsx("button",{className:"mobile-action-btn primary",onClick:()=>{i(!0),P()},children:"ng Nhp"}),p.jsx("button",{className:"mobile-action-btn",onClick:e,children:t==="light"?"Ch  Ti":"Ch  Sng"})]})]})]})]})},vD=()=>{const{filters:t,setFilters:e,showMobileFilter:n,setShowMobileFilter:r}=bn(),[s,i]=V.useState(!1),o=(h,d)=>{const f=t[h],g=f.includes(d)?f.filter(y=>y!==d):[...f,d];e({...t,[h]:g})},a=()=>{e({colorTone:[],budget:[],gender:[],purpose:[],size:[],search:""})},c=Object.keys(t).reduce((h,d)=>d==="search"?h:h+t[d].length,0),u=n;return p.jsxs(p.Fragment,{children:[u&&p.jsx("div",{className:"filter-backdrop mobile-only",onClick:()=>r(!1)}),p.jsx("aside",{className:`filter-sidebar ${s?"collapsed":""} ${u?"mobile-open":""}`,children:p.jsxs("div",{className:"sidebar-content",children:[p.jsxs("div",{className:"sidebar-header",children:[p.jsx("button",{className:"sidebar-toggle desktop-only",onClick:()=>i(!s),title:s?"Hin b lc":"n b lc",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M3 6h14M3 10h14M3 14h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsx("button",{className:"sidebar-close mobile-only",onClick:()=>r(!1),children:p.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),p.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),p.jsxs("h3",{className:"sidebar-title",children:["B Lc",c>0&&p.jsx("span",{className:"filter-count",children:c})]}),c>0&&p.jsx("button",{className:"btn-clear-all",onClick:a,children:"Xa tt c"})]}),p.jsx("div",{className:"filter-groups",children:Object.entries(Yu).map(([h,d])=>p.jsx(AW,{category:h,options:d,selectedValues:t[h],onToggle:o},h))})]})})]})},AW=({category:t,options:e,selectedValues:n,onToggle:r})=>{const[s,i]=V.useState(!0),o={colorTone:"Tng Mu",budget:"Ngn Sch",gender:"Phong Cch",purpose:"Mc ch",size:"Kch Thc"};return p.jsxs("div",{className:"filter-group",children:[p.jsxs("button",{className:"filter-group-header",onClick:()=>i(!s),children:[p.jsx("span",{className:"filter-group-title",children:o[t]}),p.jsx("svg",{className:`expand-icon ${s?"expanded":""}`,width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:p.jsx("path",{d:"M4 6l4 4 4-4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}),s&&p.jsx("div",{className:"filter-options",children:e.map(a=>p.jsxs("label",{className:"filter-option",children:[p.jsx("input",{type:"checkbox",checked:n.includes(a.value),onChange:()=>r(t,a.value),className:"filter-checkbox"}),p.jsxs("span",{className:"filter-option-content",children:[p.jsx("span",{className:"filter-option-label",children:a.label}),p.jsx("span",{className:"filter-option-description",children:a.description})]})]},a.value))})]})},RW=({setup:t,index:e})=>{var k,_;const{toggleLike:n,toggleSave:r,hasUserLiked:s,hasUserSaved:i}=bn(),[o,a]=V.useState(!1),[l,c]=V.useState(!1),u=V.useRef(null),[h,d]=V.useState(!1),[f,g]=V.useState(!1),y=s(t.id),v=i(t.id),w=x=>{x.preventDefault(),x.stopPropagation(),n(t.id),g(!1)},T=x=>{x.preventDefault(),x.stopPropagation(),r(t.id),g(!1)},E=x=>{x.preventDefault(),x.stopPropagation();const S=`${window.location.origin}/setup/${t.id}`;navigator.share?navigator.share({title:t.title,text:t.caption,url:S}):(navigator.clipboard.writeText(S),alert(" copy link!")),g(!1)},R=x=>{x.preventDefault(),x.stopPropagation(),f||document.querySelectorAll(".setup-card").forEach(A=>{A.dispatchEvent(new CustomEvent("closeOtherMenus",{detail:{exceptId:t.id}}))}),g(!f)};Xe.useEffect(()=>{const x=document.querySelector(`[data-setup-id="${t.id}"]`);if(x){const S=A=>{A.detail.exceptId!==t.id&&g(!1)};return x.addEventListener("closeOtherMenus",S),()=>x.removeEventListener("closeOtherMenus",S)}},[t.id]),Xe.useEffect(()=>{if(f){const x=A=>{!A.target.closest(".mobile-menu-popup")&&!A.target.closest(".mobile-menu-btn")&&g(!1)},S=()=>{g(!1)};return document.addEventListener("click",x),window.addEventListener("scroll",S,{passive:!0}),()=>{document.removeEventListener("click",x),window.removeEventListener("scroll",S)}}},[f]);const P=()=>{if(t.thumbnailVideo&&u.current){const x=u.current.play();x!==void 0&&x.then(()=>d(!0)).catch(()=>{})}},N=()=>{t.thumbnailVideo&&u.current&&(u.current.pause(),u.current.currentTime=0,d(!1))};return p.jsxs(p.Fragment,{children:[p.jsx(Cr,{to:`/setup/${t.id}`,className:"setup-card","data-setup-id":t.id,onMouseEnter:P,onMouseLeave:N,children:p.jsxs("div",{className:"setup-card-image-container",children:[t.thumbnailVideo&&p.jsx("video",{ref:u,className:"setup-card-image",muted:!0,loop:!0,playsInline:!0,style:{display:h?"block":"none"},children:p.jsx("source",{src:t.thumbnailVideo,type:"video/mp4"})}),t.images&&t.images.length>0?p.jsx("img",{src:typeof t.images[0]=="string"?t.images[0]:((k=t.images[0])==null?void 0:k.url)||((_=t.images[0])==null?void 0:_.src),alt:t.title||"Setup image",className:`setup-card-image ${o?"loaded":""}`,loading:"lazy",decoding:"async",onLoad:()=>a(!0),onError:x=>{var S;console.error("Image load error:",{raw:t.images[0],type:typeof t.images[0],url:typeof t.images[0]=="string"?t.images[0]:(S=t.images[0])==null?void 0:S.url}),c(!0)},style:{display:t.thumbnailVideo&&h?"none":"block"}}):p.jsxs("div",{className:"image-error",children:[p.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:[p.jsx("path",{d:"M24 4L4 44h40L24 4z",stroke:"currentColor",strokeWidth:"2"}),p.jsx("path",{d:"M24 18v12M24 34v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),p.jsx("span",{children:"Khng c nh"})]}),!o&&!l&&p.jsx("div",{className:"skeleton-image-placeholder"}),t.thumbnailVideo&&!h&&p.jsx("div",{className:"video-play-indicator",children:p.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"white",children:[p.jsx("circle",{cx:"24",cy:"24",r:"24",opacity:"0.9"}),p.jsx("path",{d:"M18 14l16 10-16 10V14z",fill:"black"})]})}),l&&!t.thumbnailVideo&&p.jsxs("div",{className:"image-error",children:[p.jsxs("svg",{width:"48",height:"48",viewBox:"0 0 48 48",fill:"none",children:[p.jsx("path",{d:"M24 4L4 44h40L24 4z",stroke:"currentColor",strokeWidth:"2"}),p.jsx("path",{d:"M24 18v12M24 34v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),p.jsx("span",{children:"nh li"})]}),p.jsx("div",{className:"setup-card-overlay",style:{zIndex:4}}),p.jsxs("div",{className:"setup-card-actions",style:{zIndex:5},children:[p.jsx("button",{className:`action-btn ${y?"active":""}`,onClick:w,title:y?"B thch":"Thch",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:y?"currentColor":"none",children:p.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})})}),p.jsx("button",{className:`action-btn ${v?"active":""}`,onClick:T,title:v?"B lu":"Lu",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:v?"currentColor":"none",children:p.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})})}),p.jsx("button",{className:"action-btn",onClick:E,title:"Chia s",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M15 13v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3M10 3v10M10 3l-3 3M10 3l3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})})})]}),p.jsx("div",{className:"setup-card-tags",style:{zIndex:5},children:t.tags.slice(0,3).map(x=>p.jsxs("span",{className:"tag",children:["#",x]},x))}),p.jsx("button",{className:"mobile-menu-btn",onClick:R,style:{zIndex:6},children:p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("circle",{cx:"10",cy:"4",r:"1.5",fill:"currentColor"}),p.jsx("circle",{cx:"10",cy:"10",r:"1.5",fill:"currentColor"}),p.jsx("circle",{cx:"10",cy:"16",r:"1.5",fill:"currentColor"})]})})]})}),f&&p.jsxs("div",{className:"mobile-menu-popup",children:[p.jsxs("div",{className:"mobile-menu-header",children:[p.jsx("button",{className:"mobile-menu-close",onClick:x=>{x.preventDefault(),x.stopPropagation(),g(!1)},children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsx("h3",{children:"Ty chn"}),p.jsx("div",{style:{width:"24px"}})]}),p.jsxs("div",{className:"mobile-menu-actions",children:[p.jsxs("button",{onClick:w,className:y?"active":"",children:[p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:y?"currentColor":"none",children:p.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})}),p.jsx("span",{children:y?"B thch":"Thch"})]}),p.jsxs("button",{onClick:T,className:v?"active":"",children:[p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:v?"currentColor":"none",children:p.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})}),p.jsx("span",{children:v?" lu":"Lu"})]}),p.jsxs("button",{onClick:E,children:[p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M15 13v3a2 2 0 01-2 2H5a2 2 0 01-2-2v-3M10 3v10M10 3l-3 3M10 3l3 3",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),p.jsx("span",{children:"Chia s"})]})]})]})]})},By=({title:t,description:e,image:n,url:r,type:s="website",schema:i})=>{const o="DeskHub",a="DeskHub - Cng ng Chia S Gc Lm Vic p",l="Khm ph hng ngn  tng setup gc lm vic, bn gaming, v khng gian sng to t cng ng.",c="https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=1200&q=80",u=t?`${t} | ${o}`:a,h=e||l,d=n||c,f=r||window.location.href;return p.jsxs(E6,{children:[p.jsx("title",{children:u}),p.jsx("meta",{name:"description",content:h}),p.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),p.jsx("link",{rel:"canonical",href:f}),p.jsx("meta",{property:"og:site_name",content:o}),p.jsx("meta",{property:"og:title",content:u}),p.jsx("meta",{property:"og:description",content:h}),p.jsx("meta",{property:"og:image",content:d}),p.jsx("meta",{property:"og:url",content:f}),p.jsx("meta",{property:"og:type",content:s}),p.jsx("meta",{name:"twitter:card",content:"summary_large_image"}),p.jsx("meta",{name:"twitter:title",content:u}),p.jsx("meta",{name:"twitter:description",content:h}),p.jsx("meta",{name:"twitter:image",content:d}),i&&p.jsx("script",{type:"application/ld+json",children:JSON.stringify(i)})]})},NW=()=>{var R,P,N,k,_;const{getFilteredSetups:t,loading:e,filters:n,setups:r}=bn(),[s,i]=V.useState([]),[o,a]=V.useState(1),[l,c]=V.useState(!1),u=V.useRef(null),h=V.useRef(null),d=12,f=V.useMemo(()=>t(),[t]);V.useEffect(()=>{g(1)},[f]),V.useEffect(()=>{const x={root:null,rootMargin:"200px",threshold:.1};return u.current=new IntersectionObserver(S=>{S[0].isIntersecting&&!l&&y()},x),h.current&&u.current.observe(h.current),()=>{u.current&&u.current.disconnect()}},[l,o]);const g=x=>{c(!0);const S=0,A=x*d,M=f.slice(S,A);i(M),a(x),c(!1)},y=()=>{const x=o+1,S=x*d;if(s.length<f.length){c(!0);const A=f.slice(0,S);i(A),a(x),c(!1)}},v=s.length<f.length,w=n.search||((R=n.colorTone)==null?void 0:R.length)>0||((P=n.budget)==null?void 0:P.length)>0||((N=n.gender)==null?void 0:N.length)>0||((k=n.purpose)==null?void 0:k.length)>0||((_=n.size)==null?void 0:_.length)>0,T=e||r.length===0,E=!T&&w&&f.length===0;return p.jsxs("div",{className:"masonry-gallery",children:[p.jsx(By,{title:"Khm Ph Gc Lm Vic - DeskHub",description:"B su tp nhng gc lm vic, setup bn phm, mn hnh p nht c chia s bi cng ng."}),T&&p.jsxs("div",{className:"loading-state",children:[p.jsx("div",{className:"loading-spinner"}),p.jsx("h3",{children:"Sp load xong cc gc setup, bn ng thot nh "}),p.jsx("p",{children:"ang ti d liu t server..."})]}),E&&p.jsxs("div",{className:"empty-state",children:[p.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",children:[p.jsx("path",{d:"M60 20L20 100h80L60 20z",stroke:"currentColor",strokeWidth:"4"}),p.jsx("path",{d:"M60 45v30M60 85v4",stroke:"currentColor",strokeWidth:"4",strokeLinecap:"round"})]}),p.jsx("h3",{children:"Khng tm thy setup no"}),p.jsx("p",{children:"Th thay i b lc hoc tm kim vi t kha khc"})]}),!T&&s.length>0&&p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"masonry-grid",children:s.map((x,S)=>p.jsx(RW,{setup:x,index:S},x.id))}),v&&p.jsx("div",{ref:h,className:"load-more-trigger",children:l&&p.jsx("div",{style:{textAlign:"center",padding:"2rem"},children:p.jsx("p",{children:"ang ti..."})})}),!v&&s.length>0&&p.jsx("div",{className:"end-message",children:" Bn  xem ht tt c!"})]})]})},PW=()=>{var Be,Ke,Fe;const{selectedSetup:t,setSelectedSetup:e,toggleLike:n,toggleSave:r,addComment:s,getComments:i,fetchCommentsForSetup:o,hasUserLiked:a,hasUserSaved:l,getSimilarSetups:c,currentUser:u,setups:h,setShowAuthModal:d}=bn(),[f,g]=V.useState(null),[y,v]=V.useState(0),[w,T]=V.useState(""),[E,R]=V.useState(!0),[P,N]=V.useState(!1),[k,_]=V.useState(!1),[x,S]=V.useState(null),[A,M]=V.useState(null),[I,j]=V.useState(null),B=V.useRef(null),L=50;if(Xe.useEffect(()=>{t!=null&&t.id&&o(t.id)},[t==null?void 0:t.id,o]),Xe.useEffect(()=>{const Z=()=>N(window.innerWidth<=768);return Z(),window.addEventListener("resize",Z),()=>window.removeEventListener("resize",Z)},[]),Xe.useEffect(()=>{P&&t&&$.length>1&&(localStorage.getItem("hasSeenSwipeHint")||(_(!0),setTimeout(()=>{_(!1),localStorage.setItem("hasSeenSwipeHint","true")},3e3)))},[P,t]),!t)return null;const O=t,$=((Be=O.images)==null?void 0:Be.length)>0?[...O.images.map(Z=>({type:"image",url:Z.url,products:Z.products||[]})),...O.youtubeVideo?[{type:"youtube",url:O.youtubeVideo,poster:O.mainImage}]:[]]:[{type:"image",url:O.mainImage,products:O.products||[]},...(O.moreImages||[]).map(Z=>({type:"image",url:Z})),...O.youtubeVideo?[{type:"youtube",url:O.youtubeVideo,poster:O.mainImage}]:[]],U=$[y]||$[0],F=a(O.id),X=l(O.id),H=i(O.id),J=c(O.id),z=()=>{f&&g(null)},W=()=>{e(null),T("")},de=()=>{if(!u){d(!0);return}n(O.id)},Te=Z=>{if(Z.preventDefault(),!u){d(!0);return}if(w.trim()){const fe=u.photoURL||u.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(u.displayName||"User")}&background=random`,Ee={text:w,author:u.displayName,userId:u.id,avatar:fe};I&&(Ee.replyTo={commentId:I.id,author:I.author}),s(O.id,Ee),T(""),j(null)}},Ie=Z=>{var Ee,ee;if(!u){d(!0);return}const fe=typeof Z.author=="string"?Z.author:((Ee=Z.author)==null?void 0:Ee.name)||((ee=Z.author)==null?void 0:ee.displayName)||"n danh";j({id:Z.id,author:fe}),T(`@${fe} `),B.current&&B.current.focus()},me=()=>{j(null),T("")},Ae=Z=>{Z.target===Z.currentTarget&&W()},Re={"@context":"https://schema.org","@type":"CreativeWork",name:O.title,image:O.mainImage,creator:{"@type":"Person",name:O.author.name},description:O.caption,interactionStatistic:[{"@type":"InteractionCounter",interactionType:"https://schema.org/LikeAction",userInteractionCount:((Ke=O.likes)==null?void 0:Ke.length)||0}]},Oe=Z=>{M(null),S(Z.targetTouches[0].clientX)},jt=Z=>{M(Z.targetTouches[0].clientX)},xt=()=>{if(!x||!A)return;const Z=x-A,fe=Z>L,Ee=Z<-L;fe&&y<$.length-1&&v(ee=>ee+1),Ee&&y>0&&v(ee=>ee-1)};return p.jsxs("div",{className:"modal-overlay",onClick:Ae,children:[p.jsx(By,{title:O.title,description:O.caption,image:O.mainImage,type:"article",schema:Re}),p.jsxs("div",{className:"setup-detail-modal modal-content",children:[p.jsx("button",{className:"modal-close-btn",onClick:W,children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),k&&P&&p.jsxs("div",{className:"swipe-hint-popup",children:[p.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",children:[p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),p.jsx("path",{d:"M9 18l6-6-6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),p.jsx("p",{children:"Vut  xem nh tip theo"})]}),p.jsxs("div",{className:"modal-layout",children:[p.jsxs("div",{className:"modal-gallery",children:[p.jsxs("div",{className:"main-image-container",onClick:z,onTouchStart:P?Oe:void 0,onTouchMove:P?jt:void 0,onTouchEnd:P?xt:void 0,children:[U.type==="video"?p.jsx("video",{src:U.url,className:"main-image",controls:!0,autoPlay:!0,muted:!1,poster:U.poster,style:{objectFit:"contain",background:"#000"}}):U.type==="youtube"?p.jsx(MW,{url:U.url,poster:U.poster}):p.jsxs("div",{className:"image-wrapper-relative",children:[p.jsx("img",{src:U.url,alt:O.title,className:"main-image"}),E&&U.products&&Array.isArray(U.products)&&U.products.map((Z,fe)=>p.jsx(OW,{product:Z,isActive:f===Z,onActivate:g},fe)),p.jsx("button",{className:"toggle-products-btn",onClick:Z=>{Z.stopPropagation(),R(!E)},children:E?"n sn phm":"Hin sn phm"}),$.length>1&&p.jsxs(p.Fragment,{children:[p.jsx("button",{className:"nav-arrow prev",onClick:Z=>{Z.stopPropagation(),v(fe=>Math.max(0,fe-1))},disabled:y===0,"aria-label":"Previous image",children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),p.jsx("button",{className:"nav-arrow next",onClick:Z=>{Z.stopPropagation(),v(fe=>Math.min($.length-1,fe+1))},disabled:y===$.length-1,"aria-label":"Next image",children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),$.length>1&&p.jsx("div",{className:"image-pagination-dots",children:$.slice(0,5).map((Z,fe)=>{let Ee="pagination-dot";return fe===y&&(Ee+=" active"),fe===3&&(Ee+=" dot-small"),fe===4&&(Ee+=" dot-tiny"),p.jsx("button",{className:Ee,onClick:ee=>{ee.stopPropagation(),v(fe)},"aria-label":`Go to image ${fe+1}`},fe)})})]}),$.length>1&&p.jsx("div",{className:"image-thumbnails",children:$.map((Z,fe)=>p.jsx("button",{className:`thumbnail ${fe===y?"active":""}`,onClick:()=>v(fe),children:Z.type==="video"?p.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[p.jsx("img",{src:Z.poster,alt:"Video",style:{width:"100%",height:"100%",objectFit:"cover"}}),p.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"white",children:p.jsx("path",{d:"M8 5v14l11-7z"})})})]}):Z.type==="youtube"?p.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[p.jsx("img",{src:Z.poster,alt:"YouTube",style:{width:"100%",height:"100%",objectFit:"cover"}}),p.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"red",children:p.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})})]}):p.jsx("img",{src:Z.url,alt:`View ${fe+1}`})},fe))})]}),p.jsxs("div",{className:"modal-details",children:[p.jsxs("div",{className:"detail-header",children:[p.jsxs("div",{className:"author-info",children:[p.jsx("img",{src:O.author.avatar,alt:O.author.name,className:"author-avatar-large"}),p.jsxs("div",{children:[p.jsx("h2",{className:"detail-title",children:O.title}),p.jsx("p",{className:"author-name-large",children:O.author.name})]})]}),p.jsxs("div",{className:"detail-actions",children:[p.jsxs("button",{className:`action-btn-large ${F?"active":""}`,onClick:de,children:[p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:F?"currentColor":"none",children:p.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})}),p.jsx("span",{children:(((Fe=O.likes)==null?void 0:Fe.length)||0).toLocaleString()})]}),p.jsxs("button",{className:`action-btn-large ${X?"active":""}`,onClick:()=>r(O.id),children:[p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:X?"currentColor":"none",children:p.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})}),p.jsx("span",{children:X?" Lu":"Lu"})]})]})]}),p.jsx("p",{className:"detail-caption",children:O.caption}),p.jsx("div",{className:"detail-tags",children:O.tags&&Array.isArray(O.tags)&&O.tags.map(Z=>p.jsxs("span",{className:"detail-tag",children:["#",Z]},Z))}),p.jsxs("div",{className:"detail-filters",children:[p.jsx("h4",{children:"Chi Tit Setup"}),p.jsx("div",{className:"filter-badges",children:Object.entries(O.filters).map(([Z,fe])=>p.jsx("span",{className:"filter-badge",children:fe.replace("-"," ")},Z))})]}),p.jsxs("div",{className:"comments-section",children:[p.jsxs("h4",{children:["Bnh Lun (",H.length,")"]}),I&&p.jsxs("div",{className:"reply-indicator",children:[p.jsxs("span",{children:["ang tr li ",p.jsxs("strong",{children:["@",I.author]})]}),p.jsx("button",{type:"button",className:"cancel-reply-btn",onClick:me,children:p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),p.jsxs("form",{className:"comment-form",onSubmit:Te,children:[p.jsxs("div",{className:"comment-input-wrapper",children:[p.jsx("img",{src:(u==null?void 0:u.photoURL)||(u==null?void 0:u.avatar)||"https://ui-avatars.com/api/?name=User&background=random",alt:"Avatar",className:"comment-user-avatar"}),p.jsx("input",{ref:B,type:"text",className:"input comment-input",placeholder:I?`Tr li @${I.author}...`:u?`Bnh lun vi tn ${u.displayName}...`:"ng nhp  bnh lun...",value:w,onChange:Z=>T(Z.target.value),onClick:()=>!u&&d(!0)})]}),p.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!w.trim(),onClick:Z=>{u||(Z.preventDefault(),d(!0))},children:"Gi"})]}),p.jsx("div",{className:"comments-list",children:H.length===0?p.jsx("p",{className:"no-comments",children:"Cha c bnh lun no. Hy l ngi u tin!"}):H.map(Z=>{var ce,G,we,je;const fe=typeof Z.text=="string"?Z.text:((ce=Z.text)==null?void 0:ce.text)||JSON.stringify(Z.text)||"",Ee=typeof Z.author=="string"?Z.author:((G=Z.author)==null?void 0:G.name)||((we=Z.author)==null?void 0:we.displayName)||"n danh",ee=typeof Z.avatar=="string"?Z.avatar:((je=Z.avatar)==null?void 0:je.url)||"https://ui-avatars.com/api/?name=User&background=random",re=Z.timestamp?new Date(Z.timestamp).toLocaleDateString("vi-VN"):"",ne=Ce=>{const tn=/@(\S+)/g,He=[];let st=0,tt;for(;(tt=tn.exec(Ce))!==null;)tt.index>st&&He.push(Ce.substring(st,tt.index)),He.push(p.jsxs("span",{className:"mention-tag",children:["@",tt[1]]},tt.index)),st=tt.index+tt[0].length;return st<Ce.length&&He.push(Ce.substring(st)),He.length>0?He:Ce};return p.jsxs("div",{className:"comment",children:[p.jsx("img",{src:ee,alt:Ee,className:"comment-avatar"}),p.jsxs("div",{className:"comment-content",children:[p.jsxs("div",{className:"comment-header",children:[p.jsx("span",{className:"comment-author",children:Ee}),p.jsxs("div",{className:"comment-actions",children:[p.jsx("button",{type:"button",className:"reply-btn",onClick:()=>Ie(Z),children:"Tr li"}),p.jsx("span",{className:"comment-time",children:re})]})]}),Z.replyTo&&p.jsxs("p",{className:"reply-to-indicator",children:[" Tr li ",p.jsxs("span",{className:"mention-tag",children:["@",Z.replyTo.author]})]}),p.jsx("p",{className:"comment-text",children:ne(fe)})]})]},Z.id)})})]}),J.length>0&&p.jsxs("div",{className:"similar-setups",children:[p.jsx("h4",{children:"Setup Tng T"}),p.jsx("div",{className:"similar-grid",children:J.map(Z=>p.jsxs("div",{className:"similar-card",onClick:()=>{e(Z),v(0),T("")},children:[p.jsx("img",{src:Z.mainImage,alt:Z.title}),p.jsx("p",{className:"similar-title",children:Z.title})]},Z.id))})]})]})]})]}),P&&f&&ux.createPortal(p.jsxs("div",{className:"product-tooltip-portal",style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:"380px",background:"rgba(20, 20, 20, 0.95)",backdropFilter:"blur(12px)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"20px",zIndex:1e5,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)",borderRadius:"16px",display:"flex",flexDirection:"column",gap:"12px",animation:"slideUpFade 0.3s ease-out"},onClick:Z=>Z.stopPropagation(),children:[p.jsx("button",{style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"20px",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",lineHeight:"1"},onClick:Z=>{Z.stopPropagation(),g(null)},onMouseEnter:Z=>{Z.target.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:Z=>{Z.target.style.background="rgba(255, 255, 255, 0.1)"},children:""}),p.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"white",margin:"0 24px 0 0",lineHeight:"1.4",paddingRight:"8px"},children:f.name}),p.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:"#ff6b35",margin:"4px 0",lineHeight:"1.2"},children:f.price}),f.link&&p.jsxs("a",{href:f.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"15px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"14px 24px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"8px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.4)",transition:"all 0.2s",border:"none"},onMouseEnter:Z=>{Z.target.style.transform="translateY(-2px)",Z.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.5)"},onMouseLeave:Z=>{Z.target.style.transform="translateY(0)",Z.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.4)"},children:[p.jsx("span",{children:"Xem sn phm"}),p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",style:{marginTop:"1px"},children:p.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),document.body)]})},MW=({url:t,poster:e})=>{const[n,r]=V.useState(!1);return Xe.useEffect(()=>{r(!1)},[t]),n?p.jsx("iframe",{width:"100%",height:"100%",src:`${t}?autoplay=1&rel=0`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{aspectRatio:"16/9",borderRadius:"8px",minHeight:"400px"}}):p.jsxs("div",{className:"youtube-placeholder",onClick:()=>r(!0),style:{position:"relative",width:"100%",height:"100%",minHeight:"400px",cursor:"pointer",backgroundImage:`url(${e})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:[p.jsx("div",{style:{background:"red",width:"60px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:p.jsx("div",{style:{width:0,height:0,borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"16px solid white"}})}),p.jsx("div",{style:{position:"absolute",bottom:"10px",left:"10px",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:"Click  pht video"})]})},OW=({product:t,isActive:e,onActivate:n})=>{const[r,s]=V.useState(!1);Xe.useEffect(()=>{const o=()=>s(window.innerWidth<=768);return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const i=o=>{o.stopPropagation(),n(e?null:t)};return p.jsxs("div",{className:"product-marker",style:{left:`${t.x}%`,top:`${t.y}%`},onClick:i,children:[p.jsx("button",{className:`marker-btn ${e?"active":""}`,children:p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"var(--color-primary)"}),p.jsx("path",{d:"M10 6v8M6 10h8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),!r&&e&&p.jsxs("div",{className:"product-tooltip-desktop",style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%) translateY(-8px)",marginBottom:"8px",background:"white",color:"#333",padding:"16px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)",minWidth:"280px",maxWidth:"320px",zIndex:1e4,animation:"fadeIn 0.2s ease-out",border:"1px solid rgba(0, 0, 0, 0.08)"},onClick:o=>o.stopPropagation(),children:[p.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#333",margin:"0 0 8px 0",lineHeight:"1.4"},children:t.name}),p.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#ff6b35",margin:"0 0 12px 0",lineHeight:"1.2"},children:t.price}),t.link&&p.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"14px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"10px 20px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.3)",transition:"all 0.2s",border:"none"},onMouseEnter:o=>{o.target.style.transform="translateY(-2px)",o.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.4)"},onMouseLeave:o=>{o.target.style.transform="translateY(0)",o.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.3)"},children:[p.jsx("span",{children:"Xem sn phm"}),p.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",children:p.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),p.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"8px solid white",filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05))"}})]})]})},DW=()=>{const{blogs:t}=bn();return p.jsxs("div",{className:"blog-view",children:[p.jsx(By,{title:"Blog DeskHub - Kinh Nghim & Cm Hng",description:"Tng hp cc bi vit hng dn setup, review gear, v xu hng thit k gc lm vic mi nht."}),p.jsxs("div",{className:"blog-hero",children:[p.jsx("h1",{children:"Gc Nhn Desk Setup"}),p.jsx("p",{children:"Mo, xu hng v cm hng cho gc lm vic hon ho ca bn"})]}),p.jsx("div",{className:"blog-grid",children:t.map(e=>p.jsx(Cr,{to:`/blog/${e.slug||e.id}`,className:"blog-card-link",children:p.jsxs("article",{className:"blog-card",children:[p.jsxs("div",{className:"blog-card-image",children:[p.jsx("img",{src:e.coverImage,alt:e.title}),p.jsx("span",{className:"blog-category",children:e.category})]}),p.jsxs("div",{className:"blog-card-content",children:[p.jsx("h3",{className:"blog-card-title",children:e.title}),p.jsx("p",{className:"blog-card-excerpt",children:e.excerpt}),p.jsxs("div",{className:"blog-card-meta",children:[p.jsxs("div",{className:"blog-author",children:[p.jsx("img",{src:e.author.avatar,alt:e.author.name}),p.jsx("span",{children:e.author.name})]}),p.jsxs("div",{className:"blog-stats",children:[p.jsxs("span",{className:"read-time",children:[p.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"1.5"}),p.jsx("path",{d:"M10 6v4l3 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),e.readTime," min"]}),p.jsxs("span",{className:"views",children:[p.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("path",{d:"M1 10s3-7 9-7 9 7 9 7-3 7-9 7-9-7-9-7z",stroke:"currentColor",strokeWidth:"1.5"}),p.jsx("circle",{cx:"10",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),e.views]})]})]})]})]})},e.id))})]})};var wD={exports:{}},LW="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",jW=LW,VW=jW;function _D(){}function xD(){}xD.resetWarningCache=_D;var FW=function(){function t(r,s,i,o,a,l){if(l!==VW){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:xD,resetWarningCache:_D};return n.PropTypes=n,n};wD.exports=FW();var BW=wD.exports;const gt=Mo(BW);function UW(t){return t&&typeof t=="object"&&"default"in t?t.default:t}var bD=V,zW=UW(bD);function FC(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function $W(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var HW=!!(typeof window<"u"&&window.document&&window.document.createElement);function WW(t,e,n){if(typeof t!="function")throw new Error("Expected reducePropsToState to be a function.");if(typeof e!="function")throw new Error("Expected handleStateChangeOnClient to be a function.");if(typeof n<"u"&&typeof n!="function")throw new Error("Expected mapStateOnServer to either be undefined or a function.");function r(s){return s.displayName||s.name||"Component"}return function(i){if(typeof i!="function")throw new Error("Expected WrappedComponent to be a React component.");var o=[],a;function l(){a=t(o.map(function(u){return u.props})),c.canUseDOM?e(a):n&&(a=n(a))}var c=function(u){$W(h,u);function h(){return u.apply(this,arguments)||this}h.peek=function(){return a},h.rewind=function(){if(h.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var g=a;return a=void 0,o=[],g};var d=h.prototype;return d.UNSAFE_componentWillMount=function(){o.push(this),l()},d.componentDidUpdate=function(){l()},d.componentWillUnmount=function(){var g=o.indexOf(this);o.splice(g,1),l()},d.render=function(){return zW.createElement(i,this.props)},h}(bD.PureComponent);return FC(c,"displayName","SideEffect("+r(i)+")"),FC(c,"canUseDOM",HW),c}}var qW=WW;const KW=Mo(qW);/*
object-assign
(c) Sindre Sorhus
@license MIT
*/var BC=Object.getOwnPropertySymbols,GW=Object.prototype.hasOwnProperty,QW=Object.prototype.propertyIsEnumerable;function JW(t){if(t==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function XW(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de",Object.getOwnPropertyNames(t)[0]==="5")return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;var r=Object.getOwnPropertyNames(e).map(function(i){return e[i]});if(r.join("")!=="0123456789")return!1;var s={};return"abcdefghijklmnopqrst".split("").forEach(function(i){s[i]=i}),Object.keys(Object.assign({},s)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}var YW=XW()?Object.assign:function(t,e){for(var n,r=JW(t),s,i=1;i<arguments.length;i++){n=Object(arguments[i]);for(var o in n)GW.call(n,o)&&(r[o]=n[o]);if(BC){s=BC(n);for(var a=0;a<s.length;a++)QW.call(n,s[a])&&(r[s[a]]=n[s[a]])}}return r};const ZW=Mo(YW);var Ia={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},Me={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"};Object.keys(Me).map(function(t){return Me[t]});var yt={CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"},Jm={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},dd={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},eq=Object.keys(Jm).reduce(function(t,e){return t[Jm[e]]=e,t},{}),tq=[Me.NOSCRIPT,Me.SCRIPT,Me.STYLE],ns="data-react-helmet",nq=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},rq=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},sq=function(){function t(e,n){for(var r=0;r<n.length;r++){var s=n[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),Gn=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},iq=function(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},UC=function(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n},oq=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t},A1=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return n===!1?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},aq=function(e){var n=fc(e,Me.TITLE),r=fc(e,dd.TITLE_TEMPLATE);if(r&&n)return r.replace(/%s/g,function(){return Array.isArray(n)?n.join(""):n});var s=fc(e,dd.DEFAULT_TITLE);return n||s||void 0},lq=function(e){return fc(e,dd.ON_CHANGE_CLIENT_STATE)||function(){}},g0=function(e,n){return n.filter(function(r){return typeof r[e]<"u"}).map(function(r){return r[e]}).reduce(function(r,s){return Gn({},r,s)},{})},cq=function(e,n){return n.filter(function(r){return typeof r[Me.BASE]<"u"}).map(function(r){return r[Me.BASE]}).reverse().reduce(function(r,s){if(!r.length)for(var i=Object.keys(s),o=0;o<i.length;o++){var a=i[o],l=a.toLowerCase();if(e.indexOf(l)!==-1&&s[l])return r.concat(s)}return r},[])},Du=function(e,n,r){var s={};return r.filter(function(i){return Array.isArray(i[e])?!0:(typeof i[e]<"u"&&fq("Helmet: "+e+' should be of type "Array". Instead found type "'+nq(i[e])+'"'),!1)}).map(function(i){return i[e]}).reverse().reduce(function(i,o){var a={};o.filter(function(d){for(var f=void 0,g=Object.keys(d),y=0;y<g.length;y++){var v=g[y],w=v.toLowerCase();n.indexOf(w)!==-1&&!(f===yt.REL&&d[f].toLowerCase()==="canonical")&&!(w===yt.REL&&d[w].toLowerCase()==="stylesheet")&&(f=w),n.indexOf(v)!==-1&&(v===yt.INNER_HTML||v===yt.CSS_TEXT||v===yt.ITEM_PROP)&&(f=v)}if(!f||!d[f])return!1;var T=d[f].toLowerCase();return s[f]||(s[f]={}),a[f]||(a[f]={}),s[f][T]?!1:(a[f][T]=!0,!0)}).reverse().forEach(function(d){return i.push(d)});for(var l=Object.keys(a),c=0;c<l.length;c++){var u=l[c],h=ZW({},s[u],a[u]);s[u]=h}return i},[]).reverse()},fc=function(e,n){for(var r=e.length-1;r>=0;r--){var s=e[r];if(s.hasOwnProperty(n))return s[n]}return null},uq=function(e){return{baseTag:cq([yt.HREF,yt.TARGET],e),bodyAttributes:g0(Ia.BODY,e),defer:fc(e,dd.DEFER),encode:fc(e,dd.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:g0(Ia.HTML,e),linkTags:Du(Me.LINK,[yt.REL,yt.HREF],e),metaTags:Du(Me.META,[yt.NAME,yt.CHARSET,yt.HTTPEQUIV,yt.PROPERTY,yt.ITEM_PROP],e),noscriptTags:Du(Me.NOSCRIPT,[yt.INNER_HTML],e),onChangeClientState:lq(e),scriptTags:Du(Me.SCRIPT,[yt.SRC,yt.INNER_HTML],e),styleTags:Du(Me.STYLE,[yt.CSS_TEXT],e),title:aq(e),titleAttributes:g0(Ia.TITLE,e)}},R1=function(){var t=Date.now();return function(e){var n=Date.now();n-t>16?(t=n,e(n)):setTimeout(function(){R1(e)},0)}}(),zC=function(e){return clearTimeout(e)},hq=typeof window<"u"?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||R1:global.requestAnimationFrame||R1,dq=typeof window<"u"?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||zC:global.cancelAnimationFrame||zC,fq=function(e){return console&&typeof console.warn=="function"&&console.warn(e)},Lu=null,pq=function(e){Lu&&dq(Lu),e.defer?Lu=hq(function(){$C(e,function(){Lu=null})}):($C(e),Lu=null)},$C=function(e,n){var r=e.baseTag,s=e.bodyAttributes,i=e.htmlAttributes,o=e.linkTags,a=e.metaTags,l=e.noscriptTags,c=e.onChangeClientState,u=e.scriptTags,h=e.styleTags,d=e.title,f=e.titleAttributes;N1(Me.BODY,s),N1(Me.HTML,i),mq(d,f);var g={baseTag:kl(Me.BASE,r),linkTags:kl(Me.LINK,o),metaTags:kl(Me.META,a),noscriptTags:kl(Me.NOSCRIPT,l),scriptTags:kl(Me.SCRIPT,u),styleTags:kl(Me.STYLE,h)},y={},v={};Object.keys(g).forEach(function(w){var T=g[w],E=T.newTags,R=T.oldTags;E.length&&(y[w]=E),R.length&&(v[w]=g[w].oldTags)}),n&&n(),c(e,y,v)},TD=function(e){return Array.isArray(e)?e.join(""):e},mq=function(e,n){typeof e<"u"&&document.title!==e&&(document.title=TD(e)),N1(Me.TITLE,n)},N1=function(e,n){var r=document.getElementsByTagName(e)[0];if(r){for(var s=r.getAttribute(ns),i=s?s.split(","):[],o=[].concat(i),a=Object.keys(n),l=0;l<a.length;l++){var c=a[l],u=n[c]||"";r.getAttribute(c)!==u&&r.setAttribute(c,u),i.indexOf(c)===-1&&i.push(c);var h=o.indexOf(c);h!==-1&&o.splice(h,1)}for(var d=o.length-1;d>=0;d--)r.removeAttribute(o[d]);i.length===o.length?r.removeAttribute(ns):r.getAttribute(ns)!==a.join(",")&&r.setAttribute(ns,a.join(","))}},kl=function(e,n){var r=document.head||document.querySelector(Me.HEAD),s=r.querySelectorAll(e+"["+ns+"]"),i=Array.prototype.slice.call(s),o=[],a=void 0;return n&&n.length&&n.forEach(function(l){var c=document.createElement(e);for(var u in l)if(l.hasOwnProperty(u))if(u===yt.INNER_HTML)c.innerHTML=l.innerHTML;else if(u===yt.CSS_TEXT)c.styleSheet?c.styleSheet.cssText=l.cssText:c.appendChild(document.createTextNode(l.cssText));else{var h=typeof l[u]>"u"?"":l[u];c.setAttribute(u,h)}c.setAttribute(ns,"true"),i.some(function(d,f){return a=f,c.isEqualNode(d)})?i.splice(a,1):o.push(c)}),i.forEach(function(l){return l.parentNode.removeChild(l)}),o.forEach(function(l){return r.appendChild(l)}),{oldTags:i,newTags:o}},ED=function(e){return Object.keys(e).reduce(function(n,r){var s=typeof e[r]<"u"?r+'="'+e[r]+'"':""+r;return n?n+" "+s:s},"")},gq=function(e,n,r,s){var i=ED(r),o=TD(n);return i?"<"+e+" "+ns+'="true" '+i+">"+A1(o,s)+"</"+e+">":"<"+e+" "+ns+'="true">'+A1(o,s)+"</"+e+">"},yq=function(e,n,r){return n.reduce(function(s,i){var o=Object.keys(i).filter(function(c){return!(c===yt.INNER_HTML||c===yt.CSS_TEXT)}).reduce(function(c,u){var h=typeof i[u]>"u"?u:u+'="'+A1(i[u],r)+'"';return c?c+" "+h:h},""),a=i.innerHTML||i.cssText||"",l=tq.indexOf(e)===-1;return s+"<"+e+" "+ns+'="true" '+o+(l?"/>":">"+a+"</"+e+">")},"")},SD=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(r,s){return r[Jm[s]||s]=e[s],r},n)},vq=function(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Object.keys(e).reduce(function(r,s){return r[eq[s]||s]=e[s],r},n)},wq=function(e,n,r){var s,i=(s={key:n},s[ns]=!0,s),o=SD(r,i);return[Xe.createElement(Me.TITLE,o,n)]},_q=function(e,n){return n.map(function(r,s){var i,o=(i={key:s},i[ns]=!0,i);return Object.keys(r).forEach(function(a){var l=Jm[a]||a;if(l===yt.INNER_HTML||l===yt.CSS_TEXT){var c=r.innerHTML||r.cssText;o.dangerouslySetInnerHTML={__html:c}}else o[l]=r[a]}),Xe.createElement(e,o)})},Us=function(e,n,r){switch(e){case Me.TITLE:return{toComponent:function(){return wq(e,n.title,n.titleAttributes)},toString:function(){return gq(e,n.title,n.titleAttributes,r)}};case Ia.BODY:case Ia.HTML:return{toComponent:function(){return SD(n)},toString:function(){return ED(n)}};default:return{toComponent:function(){return _q(e,n)},toString:function(){return yq(e,n,r)}}}},kD=function(e){var n=e.baseTag,r=e.bodyAttributes,s=e.encode,i=e.htmlAttributes,o=e.linkTags,a=e.metaTags,l=e.noscriptTags,c=e.scriptTags,u=e.styleTags,h=e.title,d=h===void 0?"":h,f=e.titleAttributes;return{base:Us(Me.BASE,n,s),bodyAttributes:Us(Ia.BODY,r,s),htmlAttributes:Us(Ia.HTML,i,s),link:Us(Me.LINK,o,s),meta:Us(Me.META,a,s),noscript:Us(Me.NOSCRIPT,l,s),script:Us(Me.SCRIPT,c,s),style:Us(Me.STYLE,u,s),title:Us(Me.TITLE,{title:d,titleAttributes:f},s)}},xq=function(e){var n,r;return r=n=function(s){iq(i,s);function i(){return rq(this,i),oq(this,s.apply(this,arguments))}return i.prototype.shouldComponentUpdate=function(a){return!f2(this.props,a)},i.prototype.mapNestedChildrenToProps=function(a,l){if(!l)return null;switch(a.type){case Me.SCRIPT:case Me.NOSCRIPT:return{innerHTML:l};case Me.STYLE:return{cssText:l}}throw new Error("<"+a.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},i.prototype.flattenArrayTypeChildren=function(a){var l,c=a.child,u=a.arrayTypeChildren,h=a.newChildProps,d=a.nestedChildren;return Gn({},u,(l={},l[c.type]=[].concat(u[c.type]||[],[Gn({},h,this.mapNestedChildrenToProps(c,d))]),l))},i.prototype.mapObjectTypeChildren=function(a){var l,c,u=a.child,h=a.newProps,d=a.newChildProps,f=a.nestedChildren;switch(u.type){case Me.TITLE:return Gn({},h,(l={},l[u.type]=f,l.titleAttributes=Gn({},d),l));case Me.BODY:return Gn({},h,{bodyAttributes:Gn({},d)});case Me.HTML:return Gn({},h,{htmlAttributes:Gn({},d)})}return Gn({},h,(c={},c[u.type]=Gn({},d),c))},i.prototype.mapArrayTypeChildrenToProps=function(a,l){var c=Gn({},l);return Object.keys(a).forEach(function(u){var h;c=Gn({},c,(h={},h[u]=a[u],h))}),c},i.prototype.warnOnInvalidChildren=function(a,l){return!0},i.prototype.mapChildrenToProps=function(a,l){var c=this,u={};return Xe.Children.forEach(a,function(h){if(!(!h||!h.props)){var d=h.props,f=d.children,g=UC(d,["children"]),y=vq(g);switch(c.warnOnInvalidChildren(h,f),h.type){case Me.LINK:case Me.META:case Me.NOSCRIPT:case Me.SCRIPT:case Me.STYLE:u=c.flattenArrayTypeChildren({child:h,arrayTypeChildren:u,newChildProps:y,nestedChildren:f});break;default:l=c.mapObjectTypeChildren({child:h,newProps:l,newChildProps:y,nestedChildren:f});break}}}),l=this.mapArrayTypeChildrenToProps(u,l),l},i.prototype.render=function(){var a=this.props,l=a.children,c=UC(a,["children"]),u=Gn({},c);return l&&(u=this.mapChildrenToProps(l,u)),Xe.createElement(e,u)},sq(i,null,[{key:"canUseDOM",set:function(a){e.canUseDOM=a}}]),i}(Xe.Component),n.propTypes={base:gt.object,bodyAttributes:gt.object,children:gt.oneOfType([gt.arrayOf(gt.node),gt.node]),defaultTitle:gt.string,defer:gt.bool,encodeSpecialCharacters:gt.bool,htmlAttributes:gt.object,link:gt.arrayOf(gt.object),meta:gt.arrayOf(gt.object),noscript:gt.arrayOf(gt.object),onChangeClientState:gt.func,script:gt.arrayOf(gt.object),style:gt.arrayOf(gt.object),title:gt.string,titleAttributes:gt.object,titleTemplate:gt.string},n.defaultProps={defer:!0,encodeSpecialCharacters:!0},n.peek=e.peek,n.rewind=function(){var s=e.rewind();return s||(s=kD({baseTag:[],bodyAttributes:{},htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),s},r},bq=function(){return null},Tq=KW(uq,pq,kD)(bq),P1=xq(Tq);P1.renderStatic=P1.rewind;const Eq=({blogData:t})=>{const e=V.useMemo(()=>{var s,i,o,a,l,c,u,h,d,f,g,y;return t?{"@context":"https://schema.org","@type":"Article",headline:((s=t.seo)==null?void 0:s.seoTitle)||t.title,description:((i=t.seo)==null?void 0:i.metaDescription)||t.excerpt,image:t.coverImage||((o=t.seo)==null?void 0:o.ogImage),datePublished:((c=(l=(a=t.createdAt)==null?void 0:a.toDate)==null?void 0:l.call(a))==null?void 0:c.toISOString())||new Date().toISOString(),dateModified:((d=(h=(u=t.updatedAt)==null?void 0:u.toDate)==null?void 0:h.call(u))==null?void 0:d.toISOString())||new Date().toISOString(),author:t.author?{"@type":"Person",name:t.author.name,description:t.author.bio||"",url:t.author.avatar||""}:void 0,publisher:{"@type":"Organization",name:"DeskHub",logo:{"@type":"ImageObject",url:"https://deskhub.vn/logo.png"}},mainEntityOfPage:{"@type":"WebPage","@id":t.canonicalUrl||`https://deskhub.vn/blog/${t.slug}`},keywords:[(f=t.keywords)==null?void 0:f.primaryKeyword,...((g=t.keywords)==null?void 0:g.secondaryKeywords)||[],...((y=t.keywords)==null?void 0:y.lsiKeywords)||[]].filter(Boolean).join(", ")}:null},[t]),n=V.useMemo(()=>{var s,i;return!((s=t==null?void 0:t.schema)!=null&&s.enableFaqSchema)||!((i=t==null?void 0:t.faqItems)!=null&&i.length)?null:{"@context":"https://schema.org","@type":"FAQPage",mainEntity:t.faqItems.map(o=>({"@type":"Question",name:o.question,acceptedAnswer:{"@type":"Answer",text:o.answer}}))}},[t]),r=V.useMemo(()=>{var i,o,a;if(!((i=t==null?void 0:t.schema)!=null&&i.enableReviewSchema)||!((o=t==null?void 0:t.schema)!=null&&o.reviewData))return null;const{reviewData:s}=t.schema;return{"@context":"https://schema.org","@type":"Review",itemReviewed:{"@type":s.itemType||"Product",name:s.itemName},reviewRating:{"@type":"Rating",ratingValue:s.rating,bestRating:s.maxRating||5},author:{"@type":"Person",name:((a=t.author)==null?void 0:a.name)||"Anonymous"},reviewBody:s.summary||t.excerpt}},[t]);return e?p.jsxs(p.Fragment,{children:[p.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(e,null,2)}}),n&&p.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(n,null,2)}}),r&&p.jsx("script",{type:"application/ld+json",dangerouslySetInnerHTML:{__html:JSON.stringify(r,null,2)}})]}):null},Sq=t=>{var n,r,s,i,o,a,l,c,u,h,d,f,g,y,v,w,T,E,R,P;return t?[{name:"description",content:((n=t.seo)==null?void 0:n.metaDescription)||t.excerpt},{name:"keywords",content:[(r=t.keywords)==null?void 0:r.primaryKeyword,...((s=t.keywords)==null?void 0:s.secondaryKeywords)||[]].filter(Boolean).join(", ")},{name:"robots",content:t.noIndex?"noindex, nofollow":"index, follow"},{property:"og:title",content:((i=t.seo)==null?void 0:i.ogTitle)||((o=t.seo)==null?void 0:o.seoTitle)||t.title},{property:"og:description",content:((a=t.seo)==null?void 0:a.ogDescription)||((l=t.seo)==null?void 0:l.metaDescription)},{property:"og:image",content:((c=t.seo)==null?void 0:c.ogImage)||t.coverImage},{property:"og:url",content:t.canonicalUrl},{property:"og:type",content:"article"},{property:"og:site_name",content:"DeskHub"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:((u=t.seo)==null?void 0:u.ogTitle)||((h=t.seo)==null?void 0:h.seoTitle)||t.title},{name:"twitter:description",content:((d=t.seo)==null?void 0:d.ogDescription)||((f=t.seo)==null?void 0:f.metaDescription)},{name:"twitter:image",content:((g=t.seo)==null?void 0:g.ogImage)||t.coverImage},{property:"article:published_time",content:(w=(v=(y=t.createdAt)==null?void 0:y.toDate)==null?void 0:v.call(y))==null?void 0:w.toISOString()},{property:"article:modified_time",content:(R=(E=(T=t.updatedAt)==null?void 0:T.toDate)==null?void 0:E.call(T))==null?void 0:R.toISOString()},{property:"article:author",content:(P=t.author)==null?void 0:P.name},{property:"article:section",content:t.category},...(t.tags||[]).map(N=>({property:"article:tag",content:N}))].filter(N=>N.content):[]},kq=t=>t?t.canonicalUrl||`https://deskhub.vn/blog/${t.slug}`:null,Cq=()=>{var g,y;const{slug:t}=sy(),e=Xc(),{blogs:n,setBlogs:r,deleteBlog:s,currentUser:i}=bn(),[o,a]=V.useState(null);if(V.useEffect(()=>{let v=n.find(w=>w.slug===t||w.id==t);v||(v=ma.find(w=>w.slug===t||w.id==t)),v&&a(v)},[t,n]),V.useEffect(()=>{window.scrollTo(0,0)},[]),V.useEffect(()=>{if(!o)return;console.log("BlogDetail: Setting up view timer for blog:",o.id);const v=setTimeout(async()=>{console.log("BlogDetail: 5 seconds elapsed, incrementing view for blog:",o.id);try{const w=await Qt.incrementBlogView(o.id)}catch(w){console.error("BlogDetail: Error incrementing view:",w)}},5e3);return()=>clearTimeout(v)},[o==null?void 0:o.id]),!o)return p.jsxs("div",{className:"container",style:{padding:"2rem",textAlign:"center",minHeight:"50vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[p.jsx("h3",{children:"ang ti bi vit..."}),p.jsxs("div",{style:{color:"#666",marginTop:"1rem",fontSize:"0.9rem",textAlign:"left",background:"#f5f5f5",padding:"1rem",borderRadius:"8px"},children:[p.jsx("p",{children:p.jsx("strong",{children:"Debug Info:"})}),p.jsxs("p",{children:["Requested Slug/ID: ",t]}),p.jsxs("p",{children:["Context Blogs Loaded: ",n.length]}),p.jsxs("p",{children:["Sample Data Size: ",(ma==null?void 0:ma.length)||"undefined"]}),p.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",fontSize:"0.8rem"},children:"Nu s liu trn = 0, vui lng kim tra li kt ni mng hoc th li sau."})]})]});const l=()=>{e("/blog")},c=()=>{o.seo?e(`/blog/seo-edit/${o.id}`):e(`/blog/edit/${o.id}`)},u=async()=>{if(window.confirm("Bn c chc chn mun xa bi vit ny khng?")){const v=await s(o.id);v.success?e("/blog"):alert(v.message||"C li xy ra")}},h=Sq(o),d=kq(o),f=o.contentHtml||o.content;return p.jsxs("div",{className:"blog-detail-page",children:[p.jsxs(P1,{children:[p.jsxs("title",{children:[((g=o.seo)==null?void 0:g.seoTitle)||o.title," | DeskHub"]}),h.map((v,w)=>p.jsx("meta",{...v},w)),d&&p.jsx("link",{rel:"canonical",href:d})]}),p.jsx(Eq,{blogData:o}),p.jsxs("div",{className:"blog-detail-actions",style:{display:"flex",justifyContent:"space-between",gap:"var(--space-md)"},children:[p.jsxs("button",{className:"back-btn",onClick:l,children:[p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M12.5 15L7.5 10l5-5",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),"Quay li"]}),i&&i.role==="admin"&&p.jsxs("div",{style:{display:"flex",gap:"var(--space-sm)"},children:[p.jsxs("button",{className:"back-btn",style:{color:"#3b82f6",borderColor:"#3b82f6"},onClick:c,children:[p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),"Chnh sa"]}),p.jsxs("button",{className:"back-btn",style:{color:"#ef4444",borderColor:"#ef4444"},onClick:u,children:[p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M5 7h10M8 7V5a1 1 0 011-1h2a1 1 0 011 1v2m-5 0h6M6 7v10a1 1 0 001 1h6a1 1 0 001-1V7",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})}),"Xa bi vit"]})]})]}),p.jsxs("article",{className:"blog-article",children:[p.jsxs("div",{className:"blog-cover",children:[p.jsx("img",{src:o.coverImage,alt:o.title}),p.jsx("div",{className:"blog-cover-overlay",children:p.jsx("span",{className:"blog-category-large",children:o.category})})]}),p.jsxs("header",{className:"blog-header",children:[p.jsx("h1",{className:"blog-title",children:o.title}),p.jsxs("div",{className:"blog-meta-large",children:[p.jsxs("div",{className:"blog-author-large",children:[p.jsx("img",{src:o.author.avatar,alt:o.author.name}),p.jsxs("div",{children:[p.jsx("p",{className:"author-name",children:o.author.name}),p.jsx("p",{className:"publish-date",children:new Date(o.publishedAt).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric"})})]})]}),p.jsxs("div",{className:"blog-stats-large",children:[p.jsxs("span",{className:"stat",children:[p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("circle",{cx:"10",cy:"10",r:"8",stroke:"currentColor",strokeWidth:"1.5"}),p.jsx("path",{d:"M10 6v4l3 2",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]}),o.readTime," pht c"]}),p.jsxs("span",{className:"stat",children:[p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("path",{d:"M1 10s3-7 9-7 9 7 9 7-3 7-9 7-9-7-9-7z",stroke:"currentColor",strokeWidth:"1.5"}),p.jsx("circle",{cx:"10",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"1.5"})]}),o.views," lt xem"]})]})]})]}),p.jsx("div",{className:"blog-content",dangerouslySetInnerHTML:{__html:f}}),p.jsx("div",{className:"blog-tags",children:(y=o.tags)==null?void 0:y.map(v=>p.jsxs("span",{className:"blog-tag",children:["#",v]},v))})]})]})},pc=t=>{if(!t)return"";const e={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"i",:"i",:"i",:"i",:"i",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"y",:"y",:"y",:"y",:"y",:"d",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"I",:"I",:"I",:"I",:"I",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"Y",:"Y",:"Y",:"Y",:"Y",:"D"};let n=t.split("").map(r=>e[r]||r).join("");return n=n.toLowerCase(),n=n.replace(/\s+/g,"-"),n=n.replace(/[^a-z0-9-]/g,""),n=n.replace(/-+/g,"-"),n=n.replace(/^-+|-+$/g,""),n},HC=()=>{const{id:t}=sy(),e=Xc(),{addBlog:n,updateBlog:r,blogs:s}=bn(),i=!!t,[o,a]=V.useState(null),[l,c]=V.useState(""),[u,h]=V.useState(""),[d,f]=V.useState(""),[g,y]=V.useState(""),[v,w]=V.useState("Hng Dn"),[T,E]=V.useState(""),[R,P]=V.useState(5),[N,k]=V.useState(""),_=V.useRef(null),x=V.useRef(null),[S,A]=V.useState("image");V.useEffect(()=>{var H;if(i&&s.length>0){const J=s.find(z=>z.id==t);J?(a(J),c(J.title||""),h(J.slug||""),f(J.excerpt||""),y(J.coverImage||""),w(J.category||"Hng Dn"),E(((H=J.tags)==null?void 0:H.join(", "))||""),P(J.readTime||5),k(J.content||""),_.current&&(_.current.innerHTML=J.content||"")):(alert("Khng tm thy bi vit!"),e("/blog"))}},[i,t,s,e]);const M=H=>{const J=H.target.value;c(J);const z=pc(J);(!u||u===pc(l))&&h(z)},I=async H=>{H.preventDefault(),console.log(" Blog form submission started");const J={title:l,slug:u||pc(l),excerpt:d,coverImage:g||"https://images.unsplash.com/photo-1593062096033-9a26b09da705?w=1200",content:N,category:v,tags:T.split(",").map(z=>z.trim()).filter(Boolean),readTime:parseInt(R)||5};if(console.log(" Blog data to save:",J),i&&o){console.log(" Updating blog:",o.id);const z=await r(o.id,J);console.log(" Update response:",z),z.success?(alert(" cp nht bi vit thnh cng!"),e(`/blog/${o.id}`)):alert(`Li: ${z.message||"C li xy ra khi cp nht!"}`)}else{console.log(" Creating new blog");const z=await n(J);console.log(" Create response:",z),z.success?(alert(" ng bi vit thnh cng!"),e("/blog")):alert(`Li: ${z.message||"C li xy ra!"}`)}},j=(H,J=null)=>{var z;document.execCommand(H,!1,J),(z=_.current)==null||z.focus(),X()},B=H=>{const J=window.getSelection();if(J.rangeCount>0){const z=J.getRangeAt(0),W=document.createElement(`h${H}`);W.textContent=J.toString()||`Tiu  ${H}`,z.deleteContents(),z.insertNode(W),X()}},L=H=>{A(H),x.current&&(x.current.accept=H==="image"?"image/*":"video/*",x.current.click())},O=H=>{const J=H.target.files[0];if(J){const z=new FileReader;z.onload=W=>{const de=W.target.result;if(S==="image"){const Te=`<img src="${de}" style="max-width: 100%; height: auto; border-radius: 8px; margin: 10px 0;" alt="Uploaded image" />`;document.execCommand("insertHTML",!1,Te)}else{const Te=`<div class="video-container" style="margin: 10px 0;"><video controls width="100%" style="border-radius: 8px;"><source src="${de}" type="${J.type}">Trnh duyt ca bn khng h tr th video.</video></div><p><br/></p>`;document.execCommand("insertHTML",!1,Te)}X()},z.readAsDataURL(J)}H.target.value=""},$=()=>{const H=prompt("Nhp ng dn (URL):");H&&j("createLink",H)},U=H=>{j("fontName",H)},F=H=>{j("foreColor",H)},X=()=>{_.current&&k(_.current.innerHTML)};return p.jsxs("div",{className:"blog-editor",children:[p.jsx("input",{type:"file",ref:x,style:{display:"none"},onChange:O}),p.jsxs("div",{className:"editor-header",children:[p.jsx("h1",{children:i?"Chnh Sa Bi Vit":"To Bi Vit Mi"}),p.jsx("p",{children:i?"Cp nht ni dung bi vit ca bn":"Chia s kin thc v cm hng setup ca bn"})]}),p.jsxs("form",{onSubmit:I,className:"editor-form",children:[p.jsxs("div",{className:"form-section",children:[p.jsx("h3",{children:"Thng Tin C Bn"}),p.jsxs("div",{className:"form-grid",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{htmlFor:"title",children:"Tiu  *"}),p.jsx("input",{id:"title",type:"text",className:"input",value:l,onChange:M,placeholder:"Nhp tiu  bi vit",required:!0})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{htmlFor:"slug",children:"URL / Slug"}),p.jsx("input",{id:"slug",type:"text",className:"input",value:u,onChange:H=>h(H.target.value),placeholder:"tu-dong-tao-tu-tieu-de"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{htmlFor:"category",children:"Danh Mc *"}),p.jsxs("select",{id:"category",className:"input",value:v,onChange:H=>w(H.target.value),required:!0,children:[p.jsx("option",{value:"Hng Dn",children:"Hng Dn"}),p.jsx("option",{value:"Thit K",children:"Thit K"}),p.jsx("option",{value:"nh Gi",children:"nh Gi"}),p.jsx("option",{value:"Xu Hng",children:"Xu Hng"}),p.jsx("option",{value:"Mo",children:"Mo"})]})]}),p.jsxs("div",{className:"form-group full-width",children:[p.jsx("label",{htmlFor:"excerpt",children:"M T Ngn *"}),p.jsx("textarea",{id:"excerpt",className:"input",value:d,onChange:H=>f(H.target.value),placeholder:"M t ngn gn v ni dung bi vit",rows:"3",required:!0})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{htmlFor:"coverImage",children:"nh Ba (URL hoc Upload bn di)"}),p.jsxs("div",{style:{display:"flex",gap:"10px"},children:[p.jsx("input",{id:"coverImage",type:"url",className:"input",value:g,onChange:H=>y(H.target.value),placeholder:"https://example.com/image.jpg",style:{flex:1}}),p.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{A("image"),alert("Hin ti nh ba h tr URL. Tnh nng upload nh ba ang pht trin.")},children:"URL"})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{htmlFor:"readTime",children:"Thi Gian c (pht)"}),p.jsx("input",{id:"readTime",type:"number",className:"input",value:R,onChange:H=>P(H.target.value),min:"1",max:"60"})]}),p.jsxs("div",{className:"form-group full-width",children:[p.jsx("label",{htmlFor:"tags",children:"Th (phn cch bng du phy)"}),p.jsx("input",{id:"tags",type:"text",className:"input",value:T,onChange:H=>E(H.target.value),placeholder:"desk, productivity, ergonomics"})]})]})]}),p.jsxs("div",{className:"form-section",children:[p.jsx("h3",{children:"Ni Dung Bi Vit"}),p.jsxs("div",{className:"editor-toolbar",children:[p.jsxs("div",{className:"toolbar-group",children:[p.jsxs("select",{onChange:H=>B(H.target.value),className:"toolbar-select",children:[p.jsx("option",{value:"",children:"Tiu "}),p.jsx("option",{value:"2",children:"Heading 2"}),p.jsx("option",{value:"3",children:"Heading 3"}),p.jsx("option",{value:"4",children:"Heading 4"})]}),p.jsxs("select",{onChange:H=>U(H.target.value),className:"toolbar-select",children:[p.jsx("option",{value:"Arial",children:"Arial"}),p.jsx("option",{value:"Georgia",children:"Georgia"}),p.jsx("option",{value:"Courier New",children:"Courier New"}),p.jsx("option",{value:"Times New Roman",children:"Times New Roman"}),p.jsx("option",{value:"System-ui",children:"System UI"})]})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j("bold"),title:"In m",children:p.jsx("strong",{children:"B"})}),p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j("italic"),title:"In nghing",children:p.jsx("em",{children:"I"})}),p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j("underline"),title:"Gch chn",children:p.jsx("u",{children:"U"})}),p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>$(),title:"Chn Link",children:""})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j("insertUnorderedList"),title:"Danh sch",children:" List"}),p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>j("insertOrderedList"),title:"S th t",children:"1. List"})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>L("image"),title:"Ti nh ln",children:" nh"}),p.jsx("button",{type:"button",className:"toolbar-btn",onClick:()=>L("video"),title:"Ti video ln",children:" Video"})]}),p.jsx("div",{className:"toolbar-group",children:p.jsx("input",{type:"color",onChange:H=>F(H.target.value),title:"Mu ch",className:"toolbar-color-picker"})})]}),p.jsx("div",{ref:_,className:"content-editor",contentEditable:!0,onInput:X,"data-placeholder":"Bt u vit bi ti y..."})]}),p.jsxs("div",{className:"editor-actions",children:[p.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>e("/blog"),children:"Hy"}),p.jsx("button",{type:"submit",className:"btn btn-primary",children:i?"Cp Nht":"ng Bi"})]})]})]})},ju={title:"",slug:"",canonicalUrl:"",redirectsFrom:[],noIndex:!1,seo:{seoTitle:"",metaDescription:"",ogTitle:"",ogDescription:"",ogImage:""},keywords:{primaryKeyword:"",secondaryKeywords:[],lsiKeywords:[]},searchIntent:"informational",content:null,contentHtml:"",excerpt:"",images:[],author:null,references:[],schema:{enableArticleSchema:!0,enableFaqSchema:!1,enableReviewSchema:!1,reviewData:null},category:"Hng Dn",tags:[],readTime:5,coverImage:"",status:"draft",views:0},Li={seoTitle:{maxLength:70,idealLength:{min:50}},metaDescription:{maxLength:160,idealLength:{min:150}}},Iq={informational:{label:"Thng tin (Informational)",description:"Ngi dng mun tm hiu, hc hi",suggestedCTA:"c thm, Tm hiu thm",suggestedStructure:["Gii thiu","Cc phn chi tit","Kt lun"]},navigational:{label:"iu hng (Navigational)",description:"Ngi dng mun tm trang/ngun c th",suggestedCTA:"Truy cp, n trang",suggestedStructure:["Thng tin nhanh","Link trc tip"]},transactional:{label:"Giao dch (Transactional)",description:"Ngi dng mun mua/ng k",suggestedCTA:"Mua ngay, ng k, Thm vo gi",suggestedStructure:["Li ch","Tnh nng","Gi","CTA"]},commercial:{label:"Thng mi (Commercial Investigation)",description:"Ngi dng so snh trc khi mua",suggestedCTA:"So snh, Xem nh gi",suggestedStructure:["Tng quan","So snh","u/Nhc im","Kt lun"]}};var CD={exports:{}},ID={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fc=V;function Aq(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Rq=typeof Object.is=="function"?Object.is:Aq,Nq=Fc.useState,Pq=Fc.useEffect,Mq=Fc.useLayoutEffect,Oq=Fc.useDebugValue;function Dq(t,e){var n=e(),r=Nq({inst:{value:n,getSnapshot:e}}),s=r[0].inst,i=r[1];return Mq(function(){s.value=n,s.getSnapshot=e,y0(s)&&i({inst:s})},[t,n,e]),Pq(function(){return y0(s)&&i({inst:s}),t(function(){y0(s)&&i({inst:s})})},[t]),Oq(n),n}function y0(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Rq(t,n)}catch{return!0}}function Lq(t,e){return e()}var jq=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?Lq:Dq;ID.useSyncExternalStore=Fc.useSyncExternalStore!==void 0?Fc.useSyncExternalStore:jq;CD.exports=ID;var Ab=CD.exports;function mn(t){this.content=t}mn.prototype={constructor:mn,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,s=r.find(t),i=r.content.slice();return s==-1?i.push(n||t,e):(i[s+1]=e,n&&(i[s]=n)),new mn(i)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new mn(n)},addToStart:function(t,e){return new mn([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new mn(n)},addBefore:function(t,e,n){var r=this.remove(e),s=r.content.slice(),i=r.find(t);return s.splice(i==-1?s.length:i,0,e,n),new mn(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=mn.from(t),t.size?new mn(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=mn.from(t),t.size?new mn(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=mn.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};mn.from=function(t){if(t instanceof mn)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new mn(e)};function AD(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let s=t.child(r),i=e.child(r);if(s==i){n+=s.nodeSize;continue}if(!s.sameMarkup(i))return n;if(s.isText&&s.text!=i.text){for(let o=0;s.text[o]==i.text[o];o++)n++;return n}if(s.content.size||i.content.size){let o=AD(s.content,i.content,n+1);if(o!=null)return o}n+=s.nodeSize}}function RD(t,e,n,r){for(let s=t.childCount,i=e.childCount;;){if(s==0||i==0)return s==i?null:{a:n,b:r};let o=t.child(--s),a=e.child(--i),l=o.nodeSize;if(o==a){n-=l,r-=l;continue}if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let c=0,u=Math.min(o.text.length,a.text.length);for(;c<u&&o.text[o.text.length-c-1]==a.text[a.text.length-c-1];)c++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let c=RD(o.content,a.content,n-1,r-1);if(c)return c}n-=l,r-=l}}class te{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let r=0;r<e.length;r++)this.size+=e[r].nodeSize}nodesBetween(e,n,r,s=0,i){for(let o=0,a=0;a<n;o++){let l=this.content[o],c=a+l.nodeSize;if(c>e&&r(l,s+a,i||null,o)!==!1&&l.content.size){let u=a+1;l.nodesBetween(Math.max(0,e-u),Math.min(l.content.size,n-u),r,s+u)}a=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,r,s){let i="",o=!0;return this.nodesBetween(e,n,(a,l)=>{let c=a.isText?a.text.slice(Math.max(e,l)-l,n-l):a.isLeaf?s?typeof s=="function"?s(a):s:a.type.spec.leafText?a.type.spec.leafText(a):"":"";a.isBlock&&(a.isLeaf&&c||a.isTextblock)&&r&&(o?o=!1:i+=r),i+=c},0),i}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,r=e.firstChild,s=this.content.slice(),i=0;for(n.isText&&n.sameMarkup(r)&&(s[s.length-1]=n.withText(n.text+r.text),i=1);i<e.content.length;i++)s.push(e.content[i]);return new te(s,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let r=[],s=0;if(n>e)for(let i=0,o=0;o<n;i++){let a=this.content[i],l=o+a.nodeSize;l>e&&((o<e||l>n)&&(a.isText?a=a.cut(Math.max(0,e-o),Math.min(a.text.length,n-o)):a=a.cut(Math.max(0,e-o-1),Math.min(a.content.size,n-o-1))),r.push(a),s+=a.nodeSize),o=l}return new te(r,s)}cutByIndex(e,n){return e==n?te.empty:e==0&&n==this.content.length?this:new te(this.content.slice(e,n))}replaceChild(e,n){let r=this.content[e];if(r==n)return this;let s=this.content.slice(),i=this.size+n.nodeSize-r.nodeSize;return s[e]=n,new te(s,i)}addToStart(e){return new te([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new te(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,r=0;n<this.content.length;n++){let s=this.content[n];e(s,r,n),r+=s.nodeSize}}findDiffStart(e,n=0){return AD(this,e,n)}findDiffEnd(e,n=this.size,r=e.size){return RD(this,e,n,r)}findIndex(e){if(e==0)return Wf(0,e);if(e==this.size)return Wf(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e?Wf(n+1,i):Wf(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return te.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new te(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return te.empty;let n,r=0;for(let s=0;s<e.length;s++){let i=e[s];r+=i.nodeSize,s&&i.isText&&e[s-1].sameMarkup(i)?(n||(n=e.slice(0,s)),n[n.length-1]=i.withText(n[n.length-1].text+i.text)):n&&n.push(i)}return new te(n||e,r)}static from(e){if(!e)return te.empty;if(e instanceof te)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new te([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}te.empty=new te([],0);const v0={index:0,offset:0};function Wf(t,e){return v0.index=t,v0.offset=e,v0}function Xm(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let r=0;r<t.length;r++)if(!Xm(t[r],e[r]))return!1}else{for(let r in t)if(!(r in e)||!Xm(t[r],e[r]))return!1;for(let r in e)if(!(r in t))return!1}return!0}let rt=class M1{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,r=!1;for(let s=0;s<e.length;s++){let i=e[s];if(this.eq(i))return e;if(this.type.excludes(i.type))n||(n=e.slice(0,s));else{if(i.type.excludes(this.type))return e;!r&&i.type.rank>this.type.rank&&(n||(n=e.slice(0,s)),n.push(this),r=!0),n&&n.push(i)}}return n||(n=e.slice()),r||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Xm(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let r=e.marks[n.type];if(!r)throw new RangeError(`There is no mark type ${n.type} in this schema`);let s=r.create(n.attrs);return r.checkAttrs(s.attrs),s}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let r=0;r<e.length;r++)if(!e[r].eq(n[r]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return M1.none;if(e instanceof M1)return[e];let n=e.slice();return n.sort((r,s)=>r.type.rank-s.type.rank),n}};rt.none=[];class Ym extends Error{}class ue{constructor(e,n,r){this.content=e,this.openStart=n,this.openEnd=r}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let r=PD(this.content,e+this.openStart,n);return r&&new ue(r,this.openStart,this.openEnd)}removeBetween(e,n){return new ue(ND(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return ue.empty;let r=n.openStart||0,s=n.openEnd||0;if(typeof r!="number"||typeof s!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new ue(te.fromJSON(e,n.content),r,s)}static maxOpen(e,n=!0){let r=0,s=0;for(let i=e.firstChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.firstChild)r++;for(let i=e.lastChild;i&&!i.isLeaf&&(n||!i.type.spec.isolating);i=i.lastChild)s++;return new ue(e,r,s)}}ue.empty=new ue(te.empty,0,0);function ND(t,e,n){let{index:r,offset:s}=t.findIndex(e),i=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(s==e||i.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,i.copy(ND(i.content,e-s-1,n-s-1)))}function PD(t,e,n,r){let{index:s,offset:i}=t.findIndex(e),o=t.maybeChild(s);if(i==e||o.isText)return r&&!r.canReplace(s,s,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=PD(o.content,e-i-1,n,o);return a&&t.replaceChild(s,o.copy(a))}function Vq(t,e,n){if(n.openStart>t.depth)throw new Ym("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Ym("Inconsistent open depths");return MD(t,e,n,0)}function MD(t,e,n,r){let s=t.index(r),i=t.node(r);if(s==e.index(r)&&r<t.depth-n.openStart){let o=MD(t,e,n,r+1);return i.copy(i.content.replaceChild(s,o))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==r&&e.depth==r){let o=t.parent,a=o.content;return Ra(o,a.cut(0,t.parentOffset).append(n.content).append(a.cut(e.parentOffset)))}else{let{start:o,end:a}=Fq(n,t);return Ra(i,DD(t,o,a,e,r))}else return Ra(i,Zm(t,e,r))}function OD(t,e){if(!e.type.compatibleContent(t.type))throw new Ym("Cannot join "+e.type.name+" onto "+t.type.name)}function O1(t,e,n){let r=t.node(n);return OD(r,e.node(n)),r}function Aa(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function Th(t,e,n,r){let s=(e||t).node(n),i=0,o=e?e.index(n):s.childCount;t&&(i=t.index(n),t.depth>n?i++:t.textOffset&&(Aa(t.nodeAfter,r),i++));for(let a=i;a<o;a++)Aa(s.child(a),r);e&&e.depth==n&&e.textOffset&&Aa(e.nodeBefore,r)}function Ra(t,e){return t.type.checkContent(e),t.copy(e)}function DD(t,e,n,r,s){let i=t.depth>s&&O1(t,e,s+1),o=r.depth>s&&O1(n,r,s+1),a=[];return Th(null,t,s,a),i&&o&&e.index(s)==n.index(s)?(OD(i,o),Aa(Ra(i,DD(t,e,n,r,s+1)),a)):(i&&Aa(Ra(i,Zm(t,e,s+1)),a),Th(e,n,s,a),o&&Aa(Ra(o,Zm(n,r,s+1)),a)),Th(r,null,s,a),new te(a)}function Zm(t,e,n){let r=[];if(Th(null,t,n,r),t.depth>n){let s=O1(t,e,n+1);Aa(Ra(s,Zm(t,e,n+1)),r)}return Th(e,null,n,r),new te(r)}function Fq(t,e){let n=e.depth-t.openStart,s=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)s=e.node(i).copy(te.from(s));return{start:s.resolveNoCache(t.openStart+n),end:s.resolveNoCache(s.content.size-t.openEnd-n)}}class fd{constructor(e,n,r){this.pos=e,this.path=n,this.parentOffset=r,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let r=this.pos-this.path[this.path.length-1],s=e.child(n);return r?e.child(n).cut(r):s}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let r=this.path[n*3],s=n==0?0:this.path[n*3-1]+1;for(let i=0;i<e;i++)s+=r.child(i).nodeSize;return s}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return rt.none;if(this.textOffset)return e.child(n).marks;let r=e.maybeChild(n-1),s=e.maybeChild(n);if(!r){let a=r;r=s,s=a}let i=r.marks;for(var o=0;o<i.length;o++)i[o].type.spec.inclusive===!1&&(!s||!i[o].isInSet(s.marks))&&(i=i[o--].removeFromSet(i));return i}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let r=n.marks,s=e.parent.maybeChild(e.index());for(var i=0;i<r.length;i++)r[i].type.spec.inclusive===!1&&(!s||!r[i].isInSet(s.marks))&&(r=r[i--].removeFromSet(r));return r}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let r=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);r>=0;r--)if(e.pos<=this.end(r)&&(!n||n(this.node(r))))return new eg(this,e,r);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let r=[],s=0,i=n;for(let o=e;;){let{index:a,offset:l}=o.content.findIndex(i),c=i-l;if(r.push(o,a,s+l),!c||(o=o.child(a),o.isText))break;i=c-1,s+=l+1}return new fd(n,r,i)}static resolveCached(e,n){let r=WC.get(e);if(r)for(let i=0;i<r.elts.length;i++){let o=r.elts[i];if(o.pos==n)return o}else WC.set(e,r=new Bq);let s=r.elts[r.i]=fd.resolve(e,n);return r.i=(r.i+1)%Uq,s}}class Bq{constructor(){this.elts=[],this.i=0}}const Uq=12,WC=new WeakMap;class eg{constructor(e,n,r){this.$from=e,this.$to=n,this.depth=r}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const zq=Object.create(null);class as{constructor(e,n,r,s=rt.none){this.type=e,this.attrs=n,this.marks=s,this.content=r||te.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,r,s=0){this.content.nodesBetween(e,n,r,s,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,r,s){return this.content.textBetween(e,n,r,s)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,r){return this.type==e&&Xm(this.attrs,n||e.defaultAttrs||zq)&&rt.sameSet(this.marks,r||rt.none)}copy(e=null){return e==this.content?this:new as(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new as(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,r=!1){if(e==n)return ue.empty;let s=this.resolve(e),i=this.resolve(n),o=r?0:s.sharedDepth(n),a=s.start(o),c=s.node(o).content.cut(s.pos-a,i.pos-a);return new ue(c,s.depth-o,i.depth-o)}replace(e,n,r){return Vq(this.resolve(e),this.resolve(n),r)}nodeAt(e){for(let n=this;;){let{index:r,offset:s}=n.content.findIndex(e);if(n=n.maybeChild(r),!n)return null;if(s==e||n.isText)return n;e-=s+1}}childAfter(e){let{index:n,offset:r}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:r}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:r}=this.content.findIndex(e);if(r<e)return{node:this.content.child(n),index:n,offset:r};let s=this.content.child(n-1);return{node:s,index:n-1,offset:r-s.nodeSize}}resolve(e){return fd.resolveCached(this,e)}resolveNoCache(e){return fd.resolve(this,e)}rangeHasMark(e,n,r){let s=!1;return n>e&&this.nodesBetween(e,n,i=>(r.isInSet(i.marks)&&(s=!0),!s)),s}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),LD(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,r=te.empty,s=0,i=r.childCount){let o=this.contentMatchAt(e).matchFragment(r,s,i),a=o&&o.matchFragment(this.content,n);if(!a||!a.validEnd)return!1;for(let l=s;l<i;l++)if(!this.type.allowsMarks(r.child(l).marks))return!1;return!0}canReplaceWith(e,n,r,s){if(s&&!this.type.allowsMarks(s))return!1;let i=this.contentMatchAt(e).matchType(r),o=i&&i.matchFragment(this.content,n);return o?o.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=rt.none;for(let n=0;n<this.marks.length;n++){let r=this.marks[n];r.type.checkAttrs(r.attrs),e=r.addToSet(e)}if(!rt.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let r;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");r=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,r)}let s=te.fromJSON(e,n.content),i=e.nodeType(n.type).create(n.attrs,s,r);return i.type.checkAttrs(i.attrs),i}}as.prototype.text=void 0;class tg extends as{constructor(e,n,r,s){if(super(e,n,null,s),!r)throw new RangeError("Empty text nodes are not allowed");this.text=r}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):LD(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new tg(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new tg(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function LD(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Ya{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let r=new $q(e,n);if(r.next==null)return Ya.empty;let s=jD(r);r.next&&r.err("Unexpected trailing text");let i=Jq(Qq(s));return Xq(i,r),i}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,r=e.childCount){let s=this;for(let i=n;s&&i<r;i++)s=s.matchType(e.child(i).type);return s}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let r=0;r<e.next.length;r++)if(this.next[n].type==e.next[r].type)return!0;return!1}fillBefore(e,n=!1,r=0){let s=[this];function i(o,a){let l=o.matchFragment(e,r);if(l&&(!n||l.validEnd))return te.from(a.map(c=>c.createAndFill()));for(let c=0;c<o.next.length;c++){let{type:u,next:h}=o.next[c];if(!(u.isText||u.hasRequiredAttrs())&&s.indexOf(h)==-1){s.push(h);let d=i(h,a.concat(u));if(d)return d}}return null}return i(this,[])}findWrapping(e){for(let r=0;r<this.wrapCache.length;r+=2)if(this.wrapCache[r]==e)return this.wrapCache[r+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),r=[{match:this,type:null,via:null}];for(;r.length;){let s=r.shift(),i=s.match;if(i.matchType(e)){let o=[];for(let a=s;a.type;a=a.via)o.push(a.type);return o.reverse()}for(let o=0;o<i.next.length;o++){let{type:a,next:l}=i.next[o];!a.isLeaf&&!a.hasRequiredAttrs()&&!(a.name in n)&&(!s.type||l.validEnd)&&(r.push({match:a.contentMatch,type:a,via:s}),n[a.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(r){e.push(r);for(let s=0;s<r.next.length;s++)e.indexOf(r.next[s].next)==-1&&n(r.next[s].next)}return n(this),e.map((r,s)=>{let i=s+(r.validEnd?"*":" ")+" ";for(let o=0;o<r.next.length;o++)i+=(o?", ":"")+r.next[o].type.name+"->"+e.indexOf(r.next[o].next);return i}).join(`
`)}}Ya.empty=new Ya(!0);class $q{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function jD(t){let e=[];do e.push(Hq(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Hq(t){let e=[];do e.push(Wq(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Wq(t){let e=Gq(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=qq(t,e);else break;return e}function qC(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function qq(t,e){let n=qC(t),r=n;return t.eat(",")&&(t.next!="}"?r=qC(t):r=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function Kq(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let s=[];for(let i in n){let o=n[i];o.isInGroup(e)&&s.push(o)}return s.length==0&&t.err("No node type or group '"+e+"' found"),s}function Gq(t){if(t.eat("(")){let e=jD(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Kq(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Qq(t){let e=[[]];return s(i(t,0),n()),e;function n(){return e.push([])-1}function r(o,a,l){let c={term:l,to:a};return e[o].push(c),c}function s(o,a){o.forEach(l=>l.to=a)}function i(o,a){if(o.type=="choice")return o.exprs.reduce((l,c)=>l.concat(i(c,a)),[]);if(o.type=="seq")for(let l=0;;l++){let c=i(o.exprs[l],a);if(l==o.exprs.length-1)return c;s(c,a=n())}else if(o.type=="star"){let l=n();return r(a,l),s(i(o.expr,l),l),[r(l)]}else if(o.type=="plus"){let l=n();return s(i(o.expr,a),l),s(i(o.expr,l),l),[r(l)]}else{if(o.type=="opt")return[r(a)].concat(i(o.expr,a));if(o.type=="range"){let l=a;for(let c=0;c<o.min;c++){let u=n();s(i(o.expr,l),u),l=u}if(o.max==-1)s(i(o.expr,l),l);else for(let c=o.min;c<o.max;c++){let u=n();r(l,u),s(i(o.expr,l),u),l=u}return[r(l)]}else{if(o.type=="name")return[r(a,void 0,o.value)];throw new Error("Unknown expr type")}}}}function VD(t,e){return e-t}function KC(t,e){let n=[];return r(e),n.sort(VD);function r(s){let i=t[s];if(i.length==1&&!i[0].term)return r(i[0].to);n.push(s);for(let o=0;o<i.length;o++){let{term:a,to:l}=i[o];!a&&n.indexOf(l)==-1&&r(l)}}}function Jq(t){let e=Object.create(null);return n(KC(t,0));function n(r){let s=[];r.forEach(o=>{t[o].forEach(({term:a,to:l})=>{if(!a)return;let c;for(let u=0;u<s.length;u++)s[u][0]==a&&(c=s[u][1]);KC(t,l).forEach(u=>{c||s.push([a,c=[]]),c.indexOf(u)==-1&&c.push(u)})})});let i=e[r.join(",")]=new Ya(r.indexOf(t.length-1)>-1);for(let o=0;o<s.length;o++){let a=s[o][1].sort(VD);i.next.push({type:s[o][0],next:e[a.join(",")]||n(a)})}return i}}function Xq(t,e){for(let n=0,r=[t];n<r.length;n++){let s=r[n],i=!s.validEnd,o=[];for(let a=0;a<s.next.length;a++){let{type:l,next:c}=s.next[a];o.push(l.name),i&&!(l.isText||l.hasRequiredAttrs())&&(i=!1),r.indexOf(c)==-1&&r.push(c)}i&&e.err("Only non-generatable nodes ("+o.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function FD(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function BD(t,e){let n=Object.create(null);for(let r in t){let s=e&&e[r];if(s===void 0){let i=t[r];if(i.hasDefault)s=i.default;else throw new RangeError("No value supplied for attribute "+r)}n[r]=s}return n}function UD(t,e,n,r){for(let s in e)if(!(s in t))throw new RangeError(`Unsupported attribute ${s} for ${n} of type ${s}`);for(let s in t){let i=t[s];i.validate&&i.validate(e[s])}}function zD(t,e){let n=Object.create(null);if(e)for(let r in e)n[r]=new Zq(t,r,e[r]);return n}let GC=class $D{constructor(e,n,r){this.name=e,this.schema=n,this.spec=r,this.markSet=null,this.groups=r.group?r.group.split(" "):[],this.attrs=zD(e,r.attrs),this.defaultAttrs=FD(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(r.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Ya.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:BD(this.attrs,e)}create(e=null,n,r){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new as(this,this.computeAttrs(e),te.from(n),rt.setFrom(r))}createChecked(e=null,n,r){return n=te.from(n),this.checkContent(n),new as(this,this.computeAttrs(e),n,rt.setFrom(r))}createAndFill(e=null,n,r){if(e=this.computeAttrs(e),n=te.from(n),n.size){let o=this.contentMatch.fillBefore(n);if(!o)return null;n=o.append(n)}let s=this.contentMatch.matchFragment(n),i=s&&s.fillBefore(te.empty,!0);return i?new as(this,e,n.append(i),rt.setFrom(r)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let r=0;r<e.childCount;r++)if(!this.allowsMarks(e.child(r).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){UD(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let r=0;r<e.length;r++)this.allowsMarkType(e[r].type)?n&&n.push(e[r]):n||(n=e.slice(0,r));return n?n.length?n:rt.none:e}static compile(e,n){let r=Object.create(null);e.forEach((i,o)=>r[i]=new $D(i,n,o));let s=n.spec.topNode||"doc";if(!r[s])throw new RangeError("Schema is missing its top node type ('"+s+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let i in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}};function Yq(t,e,n){let r=n.split("|");return s=>{let i=s===null?"null":typeof s;if(r.indexOf(i)<0)throw new RangeError(`Expected value of type ${r} for attribute ${e} on type ${t}, got ${i}`)}}class Zq{constructor(e,n,r){this.hasDefault=Object.prototype.hasOwnProperty.call(r,"default"),this.default=r.default,this.validate=typeof r.validate=="string"?Yq(e,n,r.validate):r.validate}get isRequired(){return!this.hasDefault}}class Uy{constructor(e,n,r,s){this.name=e,this.rank=n,this.schema=r,this.spec=s,this.attrs=zD(e,s.attrs),this.excluded=null;let i=FD(this.attrs);this.instance=i?new rt(this,i):null}create(e=null){return!e&&this.instance?this.instance:new rt(this,BD(this.attrs,e))}static compile(e,n){let r=Object.create(null),s=0;return e.forEach((i,o)=>r[i]=new Uy(i,s++,n,o)),r}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){UD(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}}class HD{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let s in e)n[s]=e[s];n.nodes=mn.from(e.nodes),n.marks=mn.from(e.marks||{}),this.nodes=GC.compile(this.spec.nodes,this),this.marks=Uy.compile(this.spec.marks,this);let r=Object.create(null);for(let s in this.nodes){if(s in this.marks)throw new RangeError(s+" can not be both a node and a mark");let i=this.nodes[s],o=i.spec.content||"",a=i.spec.marks;if(i.contentMatch=r[o]||(r[o]=Ya.parse(o,this.nodes)),i.inlineContent=i.contentMatch.inlineContent,i.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!i.isInline||!i.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=i}i.markSet=a=="_"?null:a?QC(this,a.split(" ")):a==""||!i.inlineContent?[]:null}for(let s in this.marks){let i=this.marks[s],o=i.spec.excludes;i.excluded=o==null?[i]:o==""?[]:QC(this,o.split(" "))}this.nodeFromJSON=s=>as.fromJSON(this,s),this.markFromJSON=s=>rt.fromJSON(this,s),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,r,s){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof GC){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,r,s)}text(e,n){let r=this.nodes.text;return new tg(r,r.defaultAttrs,e,rt.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}}function QC(t,e){let n=[];for(let r=0;r<e.length;r++){let s=e[r],i=t.marks[s],o=i;if(i)n.push(i);else for(let a in t.marks){let l=t.marks[a];(s=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=l)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}function eK(t){return t.tag!=null}function tK(t){return t.style!=null}class _o{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let r=this.matchedStyles=[];n.forEach(s=>{if(eK(s))this.tags.push(s);else if(tK(s)){let i=/[^=]*/.exec(s.style)[0];r.indexOf(i)<0&&r.push(i),this.styles.push(s)}}),this.normalizeLists=!this.tags.some(s=>{if(!/^(ul|ol)\b/.test(s.tag)||!s.node)return!1;let i=e.nodes[s.node];return i.contentMatch.matchType(i)})}parse(e,n={}){let r=new XC(this,n,!1);return r.addAll(e,rt.none,n.from,n.to),r.finish()}parseSlice(e,n={}){let r=new XC(this,n,!0);return r.addAll(e,rt.none,n.from,n.to),ue.maxOpen(r.finish())}matchTag(e,n,r){for(let s=r?this.tags.indexOf(r)+1:0;s<this.tags.length;s++){let i=this.tags[s];if(sK(e,i.tag)&&(i.namespace===void 0||e.namespaceURI==i.namespace)&&(!i.context||n.matchesContext(i.context))){if(i.getAttrs){let o=i.getAttrs(e);if(o===!1)continue;i.attrs=o||void 0}return i}}}matchStyle(e,n,r,s){for(let i=s?this.styles.indexOf(s)+1:0;i<this.styles.length;i++){let o=this.styles[i],a=o.style;if(!(a.indexOf(e)!=0||o.context&&!r.matchesContext(o.context)||a.length>e.length&&(a.charCodeAt(e.length)!=61||a.slice(e.length+1)!=n))){if(o.getAttrs){let l=o.getAttrs(n);if(l===!1)continue;o.attrs=l||void 0}return o}}}static schemaRules(e){let n=[];function r(s){let i=s.priority==null?50:s.priority,o=0;for(;o<n.length;o++){let a=n[o];if((a.priority==null?50:a.priority)<i)break}n.splice(o,0,s)}for(let s in e.marks){let i=e.marks[s].spec.parseDOM;i&&i.forEach(o=>{r(o=YC(o)),o.mark||o.ignore||o.clearMark||(o.mark=s)})}for(let s in e.nodes){let i=e.nodes[s].spec.parseDOM;i&&i.forEach(o=>{r(o=YC(o)),o.node||o.ignore||o.mark||(o.node=s)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new _o(e,_o.schemaRules(e)))}}const WD={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},nK={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},qD={ol:!0,ul:!0},pd=1,D1=2,Eh=4;function JC(t,e,n){return e!=null?(e?pd:0)|(e==="full"?D1:0):t&&t.whitespace=="pre"?pd|D1:n&~Eh}class qf{constructor(e,n,r,s,i,o){this.type=e,this.attrs=n,this.marks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=rt.none,this.match=i||(o&Eh?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(te.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let r=this.type.contentMatch,s;return(s=r.findWrapping(e.type))?(this.match=r,s):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&pd)){let r=this.content[this.content.length-1],s;if(r&&r.isText&&(s=/[ \t\r\n\u000c]+$/.exec(r.text))){let i=r;r.text.length==s[0].length?this.content.pop():this.content[this.content.length-1]=i.withText(i.text.slice(0,i.text.length-s[0].length))}}let n=te.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(te.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!WD.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class XC{constructor(e,n,r){this.parser=e,this.options=n,this.isOpen=r,this.open=0,this.localPreserveWS=!1;let s=n.topNode,i,o=JC(null,n.preserveWhitespace,0)|(r?Eh:0);s?i=new qf(s.type,s.attrs,rt.none,!0,n.topMatch||s.type.contentMatch,o):r?i=new qf(null,null,rt.none,!0,null,o):i=new qf(e.schema.topNodeType,null,rt.none,!0,null,o),this.nodes=[i],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let r=e.nodeValue,s=this.top,i=s.options&D1?"full":this.localPreserveWS||(s.options&pd)>0,{schema:o}=this.parser;if(i==="full"||s.inlineContext(e)||/[^ \t\r\n\u000c]/.test(r)){if(i)if(i==="full")r=r.replace(/\r\n?/g,`
`);else if(o.linebreakReplacement&&/[\r\n]/.test(r)&&this.top.findWrapping(o.linebreakReplacement.create())){let a=r.split(/\r?\n|\r/);for(let l=0;l<a.length;l++)l&&this.insertNode(o.linebreakReplacement.create(),n,!0),a[l]&&this.insertNode(o.text(a[l]),n,!/\S/.test(a[l]));r=""}else r=r.replace(/\r?\n|\r/g," ");else if(r=r.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(r)&&this.open==this.nodes.length-1){let a=s.content[s.content.length-1],l=e.previousSibling;(!a||l&&l.nodeName=="BR"||a.isText&&/[ \t\r\n\u000c]$/.test(a.text))&&(r=r.slice(1))}r&&this.insertNode(o.text(r),n,!/\S/.test(r)),this.findInText(e)}else this.findInside(e)}addElement(e,n,r){let s=this.localPreserveWS,i=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let o=e.nodeName.toLowerCase(),a;qD.hasOwnProperty(o)&&this.parser.normalizeLists&&rK(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(a=this.parser.matchTag(e,this,r));e:if(l?l.ignore:nK.hasOwnProperty(o))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,u=this.needsBlock;if(WD.hasOwnProperty(o))i.content.length&&i.content[0].isInline&&this.open&&(this.open--,i=this.top),c=!0,i.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let h=l&&l.skip?n:this.readStyles(e,n);h&&this.addAll(e,h),c&&this.sync(i),this.needsBlock=u}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?a:void 0)}this.localPreserveWS=s}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let r=e.style;if(r&&r.length)for(let s=0;s<this.parser.matchedStyles.length;s++){let i=this.parser.matchedStyles[s],o=r.getPropertyValue(i);if(o)for(let a=void 0;;){let l=this.parser.matchStyle(i,o,this,a);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)a=l;else break}}return n}addElementByRule(e,n,r,s){let i,o;if(n.node)if(o=this.parser.schema.nodes[n.node],o.isLeaf)this.insertNode(o.create(n.attrs),r,e.nodeName=="BR")||this.leafFallback(e,r);else{let l=this.enter(o,n.attrs||null,r,n.preserveWhitespace);l&&(i=!0,r=l)}else{let l=this.parser.schema.marks[n.mark];r=r.concat(l.create(n.attrs))}let a=this.top;if(o&&o.isLeaf)this.findInside(e);else if(s)this.addElement(e,r,s);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,r,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,r),this.findAround(e,l,!1)}i&&this.sync(a)&&this.open--}addAll(e,n,r,s){let i=r||0;for(let o=r?e.childNodes[r]:e.firstChild,a=s==null?null:e.childNodes[s];o!=a;o=o.nextSibling,++i)this.findAtPoint(e,i),this.addDOM(o,n);this.findAtPoint(e,i)}findPlace(e,n,r){let s,i;for(let o=this.open,a=0;o>=0;o--){let l=this.nodes[o],c=l.findWrapping(e);if(c&&(!s||s.length>c.length+a)&&(s=c,i=l,!c.length))break;if(l.solid){if(r)break;a+=2}}if(!s)return null;this.sync(i);for(let o=0;o<s.length;o++)n=this.enterInner(s[o],null,n,!1);return n}insertNode(e,n,r){if(e.isInline&&this.needsBlock&&!this.top.type){let i=this.textblockFromContext();i&&(n=this.enterInner(i,null,n))}let s=this.findPlace(e,n,r);if(s){this.closeExtra();let i=this.top;i.match&&(i.match=i.match.matchType(e.type));let o=rt.none;for(let a of s.concat(e.marks))(i.type?i.type.allowsMarkType(a.type):ZC(a.type,e.type))&&(o=a.addToSet(o));return i.content.push(e.mark(o)),!0}return!1}enter(e,n,r,s){let i=this.findPlace(e.create(n),r,!1);return i&&(i=this.enterInner(e,n,r,!0,s)),i}enterInner(e,n,r,s=!1,i){this.closeExtra();let o=this.top;o.match=o.match&&o.match.matchType(e);let a=JC(e,i,o.options);o.options&Eh&&o.content.length==0&&(a|=Eh);let l=rt.none;return r=r.filter(c=>(o.type?o.type.allowsMarkType(c.type):ZC(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new qf(e,n,l,s,null,a)),this.open++,r}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=pd)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let r=this.nodes[n].content;for(let s=r.length-1;s>=0;s--)e+=r[s].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let r=0;r<this.find.length;r++)this.find[r].node==e&&this.find[r].offset==n&&(this.find[r].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,r){if(e!=n&&this.find)for(let s=0;s<this.find.length;s++)this.find[s].pos==null&&e.nodeType==1&&e.contains(this.find[s].node)&&n.compareDocumentPosition(this.find[s].node)&(r?2:4)&&(this.find[s].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),r=this.options.context,s=!this.isOpen&&(!r||r.parent.type==this.nodes[0].type),i=-(r?r.depth+1:0)+(s?0:1),o=(a,l)=>{for(;a>=0;a--){let c=n[a];if(c==""){if(a==n.length-1||a==0)continue;for(;l>=i;l--)if(o(a-1,l))return!0;return!1}else{let u=l>0||l==0&&s?this.nodes[l].type:r&&l>=i?r.node(l-i).type:null;if(!u||u.name!=c&&!u.isInGroup(c))return!1;l--}}return!0};return o(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let r=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(r&&r.isTextblock&&r.defaultAttrs)return r}for(let n in this.parser.schema.nodes){let r=this.parser.schema.nodes[n];if(r.isTextblock&&r.defaultAttrs)return r}}}function rK(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let r=e.nodeType==1?e.nodeName.toLowerCase():null;r&&qD.hasOwnProperty(r)&&n?(n.appendChild(e),e=n):r=="li"?n=e:r&&(n=null)}}function sK(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function YC(t){let e={};for(let n in t)e[n]=t[n];return e}function ZC(t,e){let n=e.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(t))continue;let i=[],o=a=>{i.push(a);for(let l=0;l<a.edgeCount;l++){let{type:c,next:u}=a.edge(l);if(c==e||i.indexOf(u)<0&&o(u))return!0}};if(o(s.contentMatch))return!0}}class dl{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},r){r||(r=w0(n).createDocumentFragment());let s=r,i=[];return e.forEach(o=>{if(i.length||o.marks.length){let a=0,l=0;for(;a<i.length&&l<o.marks.length;){let c=o.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(i[a][0])||c.type.spec.spanning===!1)break;a++,l++}for(;a<i.length;)s=i.pop()[1];for(;l<o.marks.length;){let c=o.marks[l++],u=this.serializeMark(c,o.isInline,n);u&&(i.push([c,s]),s.appendChild(u.dom),s=u.contentDOM||u.dom)}}s.appendChild(this.serializeNodeInner(o,n))}),r}serializeNodeInner(e,n){let{dom:r,contentDOM:s}=zp(w0(n),this.nodes[e.type.name](e),null,e.attrs);if(s){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,s)}return r}serializeNode(e,n={}){let r=this.serializeNodeInner(e,n);for(let s=e.marks.length-1;s>=0;s--){let i=this.serializeMark(e.marks[s],e.isInline,n);i&&((i.contentDOM||i.dom).appendChild(r),r=i.dom)}return r}serializeMark(e,n,r={}){let s=this.marks[e.type.name];return s&&zp(w0(r),s(e,n),null,e.attrs)}static renderSpec(e,n,r=null,s){return zp(e,n,r,s)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new dl(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=eI(e.nodes);return n.text||(n.text=r=>r.text),n}static marksFromSchema(e){return eI(e.marks)}}function eI(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function w0(t){return t.document||window.document}const tI=new WeakMap;function iK(t){let e=tI.get(t);return e===void 0&&tI.set(t,e=oK(t)),e}function oK(t){let e=null;function n(r){if(r&&typeof r=="object")if(Array.isArray(r))if(typeof r[0]=="string")e||(e=[]),e.push(r);else for(let s=0;s<r.length;s++)n(r[s]);else for(let s in r)n(r[s])}return n(t),e}function zp(t,e,n,r){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let s=e[0],i;if(typeof s!="string")throw new RangeError("Invalid array passed to renderSpec");if(r&&(i=iK(r))&&i.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let o=s.indexOf(" ");o>0&&(n=s.slice(0,o),s=s.slice(o+1));let a,l=n?t.createElementNS(n,s):t.createElement(s),c=e[1],u=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){u=2;for(let h in c)if(c[h]!=null){let d=h.indexOf(" ");d>0?l.setAttributeNS(h.slice(0,d),h.slice(d+1),c[h]):h=="style"&&l.style?l.style.cssText=c[h]:l.setAttribute(h,c[h])}}for(let h=u;h<e.length;h++){let d=e[h];if(d===0){if(h<e.length-1||h>u)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:g}=zp(t,d,n,r);if(l.appendChild(f),g){if(a)throw new RangeError("Multiple content holes");a=g}}}return{dom:l,contentDOM:a}}const KD=65535,GD=Math.pow(2,16);function aK(t,e){return t+e*GD}function nI(t){return t&KD}function lK(t){return(t-(t&KD))/GD}const QD=1,JD=2,$p=4,XD=8;class L1{constructor(e,n,r){this.pos=e,this.delInfo=n,this.recover=r}get deleted(){return(this.delInfo&XD)>0}get deletedBefore(){return(this.delInfo&(QD|$p))>0}get deletedAfter(){return(this.delInfo&(JD|$p))>0}get deletedAcross(){return(this.delInfo&$p)>0}}class hr{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&hr.empty)return hr.empty}recover(e){let n=0,r=nI(e);if(!this.inverted)for(let s=0;s<r;s++)n+=this.ranges[s*3+2]-this.ranges[s*3+1];return this.ranges[r*3]+n+lK(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,r){let s=0,i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[a+i],u=this.ranges[a+o],h=l+c;if(e<=h){let d=c?e==l?-1:e==h?1:n:n,f=l+s+(d<0?0:u);if(r)return f;let g=e==(n<0?l:h)?null:aK(a/3,e-l),y=e==l?JD:e==h?QD:$p;return(n<0?e!=l:e!=h)&&(y|=XD),new L1(f,y,g)}s+=u-c}return r?e+s:new L1(e+s,0,null)}touches(e,n){let r=0,s=nI(n),i=this.inverted?2:1,o=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let l=this.ranges[a]-(this.inverted?r:0);if(l>e)break;let c=this.ranges[a+i],u=l+c;if(e<=u&&a==s*3)return!0;r+=this.ranges[a+o]-c}return!1}forEach(e){let n=this.inverted?2:1,r=this.inverted?1:2;for(let s=0,i=0;s<this.ranges.length;s+=3){let o=this.ranges[s],a=o-(this.inverted?i:0),l=o+(this.inverted?0:i),c=this.ranges[s+n],u=this.ranges[s+r];e(a,a+c,l,l+u),i+=u-c}}invert(){return new hr(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?hr.empty:new hr(e<0?[0,-e,0]:[0,0,e])}}hr.empty=new hr([]);class md{constructor(e,n,r=0,s=e?e.length:0){this.mirror=n,this.from=r,this.to=s,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new md(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,r=this._maps.length;n<e._maps.length;n++){let s=e.getMirror(n);this.appendMap(e._maps[n],s!=null&&s<n?r+s:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,r=this._maps.length+e._maps.length;n>=0;n--){let s=e.getMirror(n);this.appendMap(e._maps[n].invert(),s!=null&&s>n?r-s-1:void 0)}}invert(){let e=new md;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let r=this.from;r<this.to;r++)e=this._maps[r].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,r){let s=0;for(let i=this.from;i<this.to;i++){let o=this._maps[i],a=o.mapResult(e,n);if(a.recover!=null){let l=this.getMirror(i);if(l!=null&&l>i&&l<this.to){i=l,e=this._maps[l].recover(a.recover);continue}}s|=a.delInfo,e=a.pos}return r?e:new L1(e,s,null)}}const _0=Object.create(null);class jn{getMap(){return hr.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let r=_0[n.stepType];if(!r)throw new RangeError(`No step type ${n.stepType} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in _0)throw new RangeError("Duplicate use of step JSON ID "+e);return _0[e]=n,n.prototype.jsonID=e,n}}class Wt{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new Wt(e,null)}static fail(e){return new Wt(null,e)}static fromReplace(e,n,r,s){try{return Wt.ok(e.replace(n,r,s))}catch(i){if(i instanceof Ym)return Wt.fail(i.message);throw i}}}function Rb(t,e,n){let r=[];for(let s=0;s<t.childCount;s++){let i=t.child(s);i.content.size&&(i=i.copy(Rb(i.content,e,i))),i.isInline&&(i=e(i,n,s)),r.push(i)}return te.fromArray(r)}class ro extends jn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=e.resolve(this.from),s=r.node(r.sharedDepth(this.to)),i=new ue(Rb(n.content,(o,a)=>!o.isAtom||!a.type.allowsMarkType(this.mark.type)?o:o.mark(this.mark.addToSet(o.marks)),s),n.openStart,n.openEnd);return Wt.fromReplace(e,this.from,this.to,i)}invert(){return new rs(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new ro(n.pos,r.pos,this.mark)}merge(e){return e instanceof ro&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new ro(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new ro(n.from,n.to,e.markFromJSON(n.mark))}}jn.jsonID("addMark",ro);class rs extends jn{constructor(e,n,r){super(),this.from=e,this.to=n,this.mark=r}apply(e){let n=e.slice(this.from,this.to),r=new ue(Rb(n.content,s=>s.mark(this.mark.removeFromSet(s.marks)),e),n.openStart,n.openEnd);return Wt.fromReplace(e,this.from,this.to,r)}invert(){return new ro(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deleted&&r.deleted||n.pos>=r.pos?null:new rs(n.pos,r.pos,this.mark)}merge(e){return e instanceof rs&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new rs(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new rs(n.from,n.to,e.markFromJSON(n.mark))}}jn.jsonID("removeMark",rs);class so extends jn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Wt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return Wt.fromReplace(e,this.pos,this.pos+1,new ue(te.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let r=this.mark.addToSet(n.marks);if(r.length==n.marks.length){for(let s=0;s<n.marks.length;s++)if(!n.marks[s].isInSet(r))return new so(this.pos,n.marks[s]);return new so(this.pos,this.mark)}}return new Za(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new so(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new so(n.pos,e.markFromJSON(n.mark))}}jn.jsonID("addNodeMark",so);class Za extends jn{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return Wt.fail("No node at mark step's position");let r=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return Wt.fromReplace(e,this.pos,this.pos+1,new ue(te.from(r),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new so(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new Za(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new Za(n.pos,e.markFromJSON(n.mark))}}jn.jsonID("removeNodeMark",Za);class on extends jn{constructor(e,n,r,s=!1){super(),this.from=e,this.to=n,this.slice=r,this.structure=s}apply(e){return this.structure&&j1(e,this.from,this.to)?Wt.fail("Structure replace would overwrite content"):Wt.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new hr([this.from,this.to-this.from,this.slice.size])}invert(e){return new on(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1);return n.deletedAcross&&r.deletedAcross?null:new on(n.pos,Math.max(n.pos,r.pos),this.slice,this.structure)}merge(e){if(!(e instanceof on)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?ue.empty:new ue(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new on(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?ue.empty:new ue(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new on(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new on(n.from,n.to,ue.fromJSON(e,n.slice),!!n.structure)}}jn.jsonID("replace",on);class un extends jn{constructor(e,n,r,s,i,o,a=!1){super(),this.from=e,this.to=n,this.gapFrom=r,this.gapTo=s,this.slice=i,this.insert=o,this.structure=a}apply(e){if(this.structure&&(j1(e,this.from,this.gapFrom)||j1(e,this.gapTo,this.to)))return Wt.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return Wt.fail("Gap is not a flat range");let r=this.slice.insertAt(this.insert,n.content);return r?Wt.fromReplace(e,this.from,this.to,r):Wt.fail("Content does not fit in gap")}getMap(){return new hr([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new un(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),r=e.mapResult(this.to,-1),s=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),i=this.to==this.gapTo?r.pos:e.map(this.gapTo,1);return n.deletedAcross&&r.deletedAcross||s<n.pos||i>r.pos?null:new un(n.pos,r.pos,s,i,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new un(n.from,n.to,n.gapFrom,n.gapTo,ue.fromJSON(e,n.slice),n.insert,!!n.structure)}}jn.jsonID("replaceAround",un);function j1(t,e,n){let r=t.resolve(e),s=n-e,i=r.depth;for(;s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount;)i--,s--;if(s>0){let o=r.node(i).maybeChild(r.indexAfter(i));for(;s>0;){if(!o||o.isLeaf)return!0;o=o.firstChild,s--}}return!1}function cK(t,e,n,r){let s=[],i=[],o,a;t.doc.nodesBetween(e,n,(l,c,u)=>{if(!l.isInline)return;let h=l.marks;if(!r.isInSet(h)&&u.type.allowsMarkType(r.type)){let d=Math.max(c,e),f=Math.min(c+l.nodeSize,n),g=r.addToSet(h);for(let y=0;y<h.length;y++)h[y].isInSet(g)||(o&&o.to==d&&o.mark.eq(h[y])?o.to=f:s.push(o=new rs(d,f,h[y])));a&&a.to==d?a.to=f:i.push(a=new ro(d,f,r))}}),s.forEach(l=>t.step(l)),i.forEach(l=>t.step(l))}function uK(t,e,n,r){let s=[],i=0;t.doc.nodesBetween(e,n,(o,a)=>{if(!o.isInline)return;i++;let l=null;if(r instanceof Uy){let c=o.marks,u;for(;u=r.isInSet(c);)(l||(l=[])).push(u),c=u.removeFromSet(c)}else r?r.isInSet(o.marks)&&(l=[r]):l=o.marks;if(l&&l.length){let c=Math.min(a+o.nodeSize,n);for(let u=0;u<l.length;u++){let h=l[u],d;for(let f=0;f<s.length;f++){let g=s[f];g.step==i-1&&h.eq(s[f].style)&&(d=g)}d?(d.to=c,d.step=i):s.push({style:h,from:Math.max(a,e),to:c,step:i})}}}),s.forEach(o=>t.step(new rs(o.from,o.to,o.style)))}function Nb(t,e,n,r=n.contentMatch,s=!0){let i=t.doc.nodeAt(e),o=[],a=e+1;for(let l=0;l<i.childCount;l++){let c=i.child(l),u=a+c.nodeSize,h=r.matchType(c.type);if(!h)o.push(new on(a,u,ue.empty));else{r=h;for(let d=0;d<c.marks.length;d++)n.allowsMarkType(c.marks[d].type)||t.step(new rs(a,u,c.marks[d]));if(s&&c.isText&&n.whitespace!="pre"){let d,f=/\r?\n|\r/g,g;for(;d=f.exec(c.text);)g||(g=new ue(te.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),o.push(new on(a+d.index,a+d.index+d[0].length,g))}}a=u}if(!r.validEnd){let l=r.fillBefore(te.empty,!0);t.replace(a,a,new ue(l,0,0))}for(let l=o.length-1;l>=0;l--)t.step(o[l])}function hK(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function su(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth,s=0,i=0;;--r){let o=t.$from.node(r),a=t.$from.index(r)+s,l=t.$to.indexAfter(r)-i;if(r<t.depth&&o.canReplace(a,l,n))return r;if(r==0||o.type.spec.isolating||!hK(o,a,l))break;a&&(s=1),l<o.childCount&&(i=1)}return null}function dK(t,e,n){let{$from:r,$to:s,depth:i}=e,o=r.before(i+1),a=s.after(i+1),l=o,c=a,u=te.empty,h=0;for(let g=i,y=!1;g>n;g--)y||r.index(g)>0?(y=!0,u=te.from(r.node(g).copy(u)),h++):l--;let d=te.empty,f=0;for(let g=i,y=!1;g>n;g--)y||s.after(g+1)<s.end(g)?(y=!0,d=te.from(s.node(g).copy(d)),f++):c++;t.step(new un(l,c,o,a,new ue(u.append(d),h,f),u.size-h,!0))}function Pb(t,e,n=null,r=t){let s=fK(t,e),i=s&&pK(r,e);return i?s.map(rI).concat({type:e,attrs:n}).concat(i.map(rI)):null}function rI(t){return{type:t,attrs:null}}function fK(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.contentMatchAt(r).findWrapping(e);if(!i)return null;let o=i.length?i[0]:e;return n.canReplaceWith(r,s,o)?i:null}function pK(t,e){let{parent:n,startIndex:r,endIndex:s}=t,i=n.child(r),o=e.contentMatch.findWrapping(i.type);if(!o)return null;let l=(o.length?o[o.length-1]:e).contentMatch;for(let c=r;l&&c<s;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:o}function mK(t,e,n){let r=te.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let a=n[o].type.contentMatch.matchFragment(r);if(!a||!a.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=te.from(n[o].type.create(n[o].attrs,r))}let s=e.start,i=e.end;t.step(new un(s,i,s,i,new ue(r,0,0),n.length,!0))}function gK(t,e,n,r,s){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let i=t.steps.length;t.doc.nodesBetween(e,n,(o,a)=>{let l=typeof s=="function"?s(o):s;if(o.isTextblock&&!o.hasMarkup(r,l)&&yK(t.doc,t.mapping.slice(i).map(a),r)){let c=null;if(r.schema.linebreakReplacement){let f=r.whitespace=="pre",g=!!r.contentMatch.matchType(r.schema.linebreakReplacement);f&&!g?c=!1:!f&&g&&(c=!0)}c===!1&&ZD(t,o,a,i),Nb(t,t.mapping.slice(i).map(a,1),r,void 0,c===null);let u=t.mapping.slice(i),h=u.map(a,1),d=u.map(a+o.nodeSize,1);return t.step(new un(h,d,h+1,d-1,new ue(te.from(r.create(l,null,o.marks)),0,0),1,!0)),c===!0&&YD(t,o,a,i),!1}})}function YD(t,e,n,r){e.forEach((s,i)=>{if(s.isText){let o,a=/\r?\n|\r/g;for(;o=a.exec(s.text);){let l=t.mapping.slice(r).map(n+1+i+o.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function ZD(t,e,n,r){e.forEach((s,i)=>{if(s.type==s.type.schema.linebreakReplacement){let o=t.mapping.slice(r).map(n+1+i);t.replaceWith(o,o+1,e.type.schema.text(`
`))}})}function yK(t,e,n){let r=t.resolve(e),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function vK(t,e,n,r,s){let i=t.doc.nodeAt(e);if(!i)throw new RangeError("No node at given position");n||(n=i.type);let o=n.create(r,null,s||i.marks);if(i.isLeaf)return t.replaceWith(e,e+i.nodeSize,o);if(!n.validContent(i.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new un(e,e+i.nodeSize,e+1,e+i.nodeSize-1,new ue(te.from(o),0,0),1,!0))}function li(t,e,n=1,r){let s=t.resolve(e),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let c=s.depth-1,u=n-2;c>i;c--,u--){let h=s.node(c),d=s.index(c);if(h.type.spec.isolating)return!1;let f=h.content.cutByIndex(d,h.childCount),g=r&&r[u+1];g&&(f=f.replaceChild(0,g.type.create(g.attrs)));let y=r&&r[u]||h;if(!h.canReplace(d+1,h.childCount)||!y.type.validContent(f))return!1}let a=s.indexAfter(i),l=r&&r[0];return s.node(i).canReplaceWith(a,a,l?l.type:s.node(i+1).type)}function wK(t,e,n=1,r){let s=t.doc.resolve(e),i=te.empty,o=te.empty;for(let a=s.depth,l=s.depth-n,c=n-1;a>l;a--,c--){i=te.from(s.node(a).copy(i));let u=r&&r[c];o=te.from(u?u.type.create(u.attrs,o):s.node(a).copy(o))}t.step(new on(e,e,new ue(i.append(o),n,n),!0))}function $o(t,e){let n=t.resolve(e),r=n.index();return eL(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function _K(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:r}=t.type.schema;for(let s=0;s<e.childCount;s++){let i=e.child(s),o=i.type==r?t.type.schema.nodes.text:i.type;if(n=n.matchType(o),!n||!t.type.allowsMarks(i.marks))return!1}return n.validEnd}function eL(t,e){return!!(t&&e&&!t.isLeaf&&_K(t,e))}function zy(t,e,n=-1){let r=t.resolve(e);for(let s=r.depth;;s--){let i,o,a=r.index(s);if(s==r.depth?(i=r.nodeBefore,o=r.nodeAfter):n>0?(i=r.node(s+1),a++,o=r.node(s).maybeChild(a)):(i=r.node(s).maybeChild(a-1),o=r.node(s+1)),i&&!i.isTextblock&&eL(i,o)&&r.node(s).canReplace(a,a+1))return e;if(s==0)break;e=n<0?r.before(s):r.after(s)}}function xK(t,e,n){let r=null,{linebreakReplacement:s}=t.doc.type.schema,i=t.doc.resolve(e-n),o=i.node().type;if(s&&o.inlineContent){let u=o.whitespace=="pre",h=!!o.contentMatch.matchType(s);u&&!h?r=!1:!u&&h&&(r=!0)}let a=t.steps.length;if(r===!1){let u=t.doc.resolve(e+n);ZD(t,u.node(),u.before(),a)}o.inlineContent&&Nb(t,e+n-1,o,i.node().contentMatchAt(i.index()),r==null);let l=t.mapping.slice(a),c=l.map(e-n);if(t.step(new on(c,l.map(e+n,-1),ue.empty,!0)),r===!0){let u=t.doc.resolve(c);YD(t,u.node(),u.before(),t.steps.length)}return t}function bK(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(r.parentOffset==0)for(let s=r.depth-1;s>=0;s--){let i=r.index(s);if(r.node(s).canReplaceWith(i,i,n))return r.before(s+1);if(i>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let i=r.indexAfter(s);if(r.node(s).canReplaceWith(i,i,n))return r.after(s+1);if(i<r.node(s).childCount)return null}return null}function tL(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(n.openStart==0&&n.size?2:1);i++)for(let o=r.depth;o>=0;o--){let a=o==r.depth?0:r.pos<=(r.start(o+1)+r.end(o+1))/2?-1:1,l=r.index(o)+(a>0?1:0),c=r.node(o),u=!1;if(i==1)u=c.canReplace(l,l,s);else{let h=c.contentMatchAt(l).findWrapping(s.firstChild.type);u=h&&c.canReplaceWith(l,l,h[0])}if(u)return a==0?r.pos:a<0?r.before(o+1):r.after(o+1)}return null}function $y(t,e,n=e,r=ue.empty){if(e==n&&!r.size)return null;let s=t.resolve(e),i=t.resolve(n);return nL(s,i,r)?new on(e,n,r):new TK(s,i,r).fit()}function nL(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}class TK{constructor(e,n,r){this.$from=e,this.$to=n,this.unplaced=r,this.frontier=[],this.placed=te.empty;for(let s=0;s<=e.depth;s++){let i=e.node(s);this.frontier.push({type:i.type,match:i.contentMatchAt(e.indexAfter(s))})}for(let s=e.depth;s>0;s--)this.placed=te.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,r=this.$from,s=this.close(e<0?this.$to:r.doc.resolve(e));if(!s)return null;let i=this.placed,o=r.depth,a=s.depth;for(;o&&a&&i.childCount==1;)i=i.firstChild.content,o--,a--;let l=new ue(i,o,a);return e>-1?new un(r.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||r.pos!=this.$to.pos?new on(r.pos,s.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,r=0,s=this.unplaced.openEnd;r<e;r++){let i=n.firstChild;if(n.childCount>1&&(s=0),i.type.spec.isolating&&s<=r){e=r;break}n=i.content}for(let n=1;n<=2;n++)for(let r=n==1?e:this.unplaced.openStart;r>=0;r--){let s,i=null;r?(i=x0(this.unplaced.content,r-1).firstChild,s=i.content):s=this.unplaced.content;let o=s.firstChild;for(let a=this.depth;a>=0;a--){let{type:l,match:c}=this.frontier[a],u,h=null;if(n==1&&(o?c.matchType(o.type)||(h=c.fillBefore(te.from(o),!1)):i&&l.compatibleContent(i.type)))return{sliceDepth:r,frontierDepth:a,parent:i,inject:h};if(n==2&&o&&(u=c.findWrapping(o.type)))return{sliceDepth:r,frontierDepth:a,parent:i,wrap:u};if(i&&c.matchType(i.type))break}}}openMore(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=x0(e,n);return!s.childCount||s.firstChild.isLeaf?!1:(this.unplaced=new ue(e,n+1,Math.max(r,s.size+n>=e.size-r?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:r}=this.unplaced,s=x0(e,n);if(s.childCount<=1&&n>0){let i=e.size-n<=n+s.size;this.unplaced=new ue(Zu(e,n-1,1),n-1,i?n-1:r)}else this.unplaced=new ue(Zu(e,n,1),n,r)}placeNodes({sliceDepth:e,frontierDepth:n,parent:r,inject:s,wrap:i}){for(;this.depth>n;)this.closeFrontierNode();if(i)for(let y=0;y<i.length;y++)this.openFrontierNode(i[y]);let o=this.unplaced,a=r?r.content:o.content,l=o.openStart-e,c=0,u=[],{match:h,type:d}=this.frontier[n];if(s){for(let y=0;y<s.childCount;y++)u.push(s.child(y));h=h.matchFragment(s)}let f=a.size+e-(o.content.size-o.openEnd);for(;c<a.childCount;){let y=a.child(c),v=h.matchType(y.type);if(!v)break;c++,(c>1||l==0||y.content.size)&&(h=v,u.push(rL(y.mark(d.allowedMarks(y.marks)),c==1?l:0,c==a.childCount?f:-1)))}let g=c==a.childCount;g||(f=-1),this.placed=eh(this.placed,n,te.from(u)),this.frontier[n].match=h,g&&f<0&&r&&r.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let y=0,v=a;y<f;y++){let w=v.lastChild;this.frontier.push({type:w.type,match:w.contentMatchAt(w.childCount)}),v=w.content}this.unplaced=g?e==0?ue.empty:new ue(Zu(o.content,e-1,1),e-1,f<0?o.openEnd:e-1):new ue(Zu(o.content,e,c),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!b0(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:r}=this.$to,s=this.$to.after(r);for(;r>1&&s==this.$to.end(--r);)++s;return s}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:r,type:s}=this.frontier[n],i=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),o=b0(e,n,s,r,i);if(o){for(let a=n-1;a>=0;a--){let{match:l,type:c}=this.frontier[a],u=b0(e,a,c,l,!0);if(!u||u.childCount)continue e}return{depth:n,fit:o,move:i?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=eh(this.placed,n.depth,n.fit)),e=n.move;for(let r=n.depth+1;r<=e.depth;r++){let s=e.node(r),i=s.type.contentMatch.fillBefore(s.content,!0,e.index(r));this.openFrontierNode(s.type,s.attrs,i)}return e}openFrontierNode(e,n=null,r){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=eh(this.placed,this.depth,te.from(e.create(n,r))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(te.empty,!0);n.childCount&&(this.placed=eh(this.placed,this.frontier.length,n))}}function Zu(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(Zu(t.firstChild.content,e-1,n)))}function eh(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(eh(t.lastChild.content,e-1,n)))}function x0(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function rL(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,rL(r.firstChild,e-1,r.childCount==1?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(te.empty,!0)))),t.copy(r)}function b0(t,e,n,r,s){let i=t.node(e),o=s?t.indexAfter(e):t.index(e);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!EK(n,i.content,o)?a:null}function EK(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function SK(t){return t.spec.defining||t.spec.definingForContent}function kK(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),i=t.doc.resolve(n);if(nL(s,i,r))return t.step(new on(e,n,r));let o=iL(s,i);o[o.length-1]==0&&o.pop();let a=-(s.depth+1);o.unshift(a);for(let d=s.depth,f=s.pos-1;d>0;d--,f--){let g=s.node(d).type.spec;if(g.defining||g.definingAsContext||g.isolating)break;o.indexOf(d)>-1?a=d:s.before(d)==f&&o.splice(1,0,-d)}let l=o.indexOf(a),c=[],u=r.openStart;for(let d=r.content,f=0;;f++){let g=d.firstChild;if(c.push(g),f==r.openStart)break;d=g.content}for(let d=u-1;d>=0;d--){let f=c[d],g=SK(f.type);if(g&&!f.sameMarkup(s.node(Math.abs(a)-1)))u=d;else if(g||!f.type.isTextblock)break}for(let d=r.openStart;d>=0;d--){let f=(d+u+1)%(r.openStart+1),g=c[f];if(g)for(let y=0;y<o.length;y++){let v=o[(y+l)%o.length],w=!0;v<0&&(w=!1,v=-v);let T=s.node(v-1),E=s.index(v-1);if(T.canReplaceWith(E,E,g.type,g.marks))return t.replace(s.before(v),w?i.after(v):n,new ue(sL(r.content,0,r.openStart,f),f,r.openEnd))}}let h=t.steps.length;for(let d=o.length-1;d>=0&&(t.replace(e,n,r),!(t.steps.length>h));d--){let f=o[d];f<0||(e=s.before(f),n=i.after(f))}}function sL(t,e,n,r,s){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(sL(i.content,e+1,n,r,i)))}if(e>r){let i=s.contentMatchAt(0),o=i.fillBefore(t).append(t);t=o.append(i.matchFragment(o).fillBefore(te.empty,!0))}return t}function CK(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let s=bK(t.doc,e,r.type);s!=null&&(e=n=s)}t.replaceRange(e,n,new ue(te.from(r),0,0))}function IK(t,e,n){let r=t.doc.resolve(e),s=t.doc.resolve(n),i=iL(r,s);for(let o=0;o<i.length;o++){let a=i[o],l=o==i.length-1;if(l&&a==0||r.node(a).type.contentMatch.validEnd)return t.delete(r.start(a),s.end(a));if(a>0&&(l||r.node(a-1).canReplace(r.index(a-1),s.indexAfter(a-1))))return t.delete(r.before(a),s.after(a))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o&&r.start(o-1)==s.start(o-1)&&r.node(o-1).canReplace(r.index(o-1),s.index(o-1)))return t.delete(r.before(o),n);t.delete(e,n)}function iL(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let s=r;s>=0;s--){let i=t.start(s);if(i<t.pos-(t.depth-s)||e.end(s)>e.pos+(e.depth-s)||t.node(s).type.spec.isolating||e.node(s).type.spec.isolating)break;(i==e.start(s)||s==t.depth&&s==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&s&&e.start(s-1)==i-1)&&n.push(s)}return n}class mc extends jn{constructor(e,n,r){super(),this.pos=e,this.attr=n,this.value=r}apply(e){let n=e.nodeAt(this.pos);if(!n)return Wt.fail("No node at attribute step's position");let r=Object.create(null);for(let i in n.attrs)r[i]=n.attrs[i];r[this.attr]=this.value;let s=n.type.create(r,null,n.marks);return Wt.fromReplace(e,this.pos,this.pos+1,new ue(te.from(s),0,n.isLeaf?0:1))}getMap(){return hr.empty}invert(e){return new mc(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new mc(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new mc(n.pos,n.attr,n.value)}}jn.jsonID("attr",mc);class gd extends jn{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let s in e.attrs)n[s]=e.attrs[s];n[this.attr]=this.value;let r=e.type.create(n,e.content,e.marks);return Wt.ok(r)}getMap(){return hr.empty}invert(e){return new gd(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new gd(n.attr,n.value)}}jn.jsonID("docAttr",gd);let Bc=class extends Error{};Bc=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};Bc.prototype=Object.create(Error.prototype);Bc.prototype.constructor=Bc;Bc.prototype.name="TransformError";class Mb{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new md}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new Bc(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,r=ue.empty){let s=$y(this.doc,e,n,r);return s&&this.step(s),this}replaceWith(e,n,r){return this.replace(e,n,new ue(te.from(r),0,0))}delete(e,n){return this.replace(e,n,ue.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,r){return kK(this,e,n,r),this}replaceRangeWith(e,n,r){return CK(this,e,n,r),this}deleteRange(e,n){return IK(this,e,n),this}lift(e,n){return dK(this,e,n),this}join(e,n=1){return xK(this,e,n),this}wrap(e,n){return mK(this,e,n),this}setBlockType(e,n=e,r,s=null){return gK(this,e,n,r,s),this}setNodeMarkup(e,n,r=null,s){return vK(this,e,n,r,s),this}setNodeAttribute(e,n,r){return this.step(new mc(e,n,r)),this}setDocAttribute(e,n){return this.step(new gd(e,n)),this}addNodeMark(e,n){return this.step(new so(e,n)),this}removeNodeMark(e,n){let r=this.doc.nodeAt(e);if(!r)throw new RangeError("No node at position "+e);if(n instanceof rt)n.isInSet(r.marks)&&this.step(new Za(e,n));else{let s=r.marks,i,o=[];for(;i=n.isInSet(s);)o.push(new Za(e,i)),s=i.removeFromSet(s);for(let a=o.length-1;a>=0;a--)this.step(o[a])}return this}split(e,n=1,r){return wK(this,e,n,r),this}addMark(e,n,r){return cK(this,e,n,r),this}removeMark(e,n,r){return uK(this,e,n,r),this}clearIncompatible(e,n,r){return Nb(this,e,n,r),this}}const T0=Object.create(null);class ke{constructor(e,n,r){this.$anchor=e,this.$head=n,this.ranges=r||[new oL(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=ue.empty){let r=n.content.lastChild,s=null;for(let a=0;a<n.openEnd;a++)s=r,r=r.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:l,$to:c}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(l.pos),u.map(c.pos),a?ue.empty:n),a==0&&oI(e,i,(r?r.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,n){let r=e.steps.length,s=this.ranges;for(let i=0;i<s.length;i++){let{$from:o,$to:a}=s[i],l=e.mapping.slice(r),c=l.map(o.pos),u=l.map(a.pos);i?e.deleteRange(c,u):(e.replaceRangeWith(c,u,n),oI(e,r,n.isInline?-1:1))}}static findFrom(e,n,r=!1){let s=e.parent.inlineContent?new be(e):Ol(e.node(0),e.parent,e.pos,e.index(),n,r);if(s)return s;for(let i=e.depth-1;i>=0;i--){let o=n<0?Ol(e.node(0),e.node(i),e.before(i+1),e.index(i),n,r):Ol(e.node(0),e.node(i),e.after(i+1),e.index(i)+1,n,r);if(o)return o}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new yr(e.node(0))}static atStart(e){return Ol(e,e,0,0,1)||new yr(e)}static atEnd(e){return Ol(e,e,e.content.size,e.childCount,-1)||new yr(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let r=T0[n.type];if(!r)throw new RangeError(`No selection type ${n.type} defined`);return r.fromJSON(e,n)}static jsonID(e,n){if(e in T0)throw new RangeError("Duplicate use of selection JSON ID "+e);return T0[e]=n,n.prototype.jsonID=e,n}getBookmark(){return be.between(this.$anchor,this.$head).getBookmark()}}ke.prototype.visible=!0;class oL{constructor(e,n){this.$from=e,this.$to=n}}let sI=!1;function iI(t){!sI&&!t.parent.inlineContent&&(sI=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class be extends ke{constructor(e,n=e){iI(e),iI(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let r=e.resolve(n.map(this.head));if(!r.parent.inlineContent)return ke.near(r);let s=e.resolve(n.map(this.anchor));return new be(s.parent.inlineContent?s:r,r)}replace(e,n=ue.empty){if(super.replace(e,n),n==ue.empty){let r=this.$from.marksAcross(this.$to);r&&e.ensureMarks(r)}}eq(e){return e instanceof be&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Hy(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new be(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){let s=e.resolve(n);return new this(s,r==n?s:e.resolve(r))}static between(e,n,r){let s=e.pos-n.pos;if((!r||s)&&(r=s>=0?1:-1),!n.parent.inlineContent){let i=ke.findFrom(n,r,!0)||ke.findFrom(n,-r,!0);if(i)n=i.$head;else return ke.near(n,r)}return e.parent.inlineContent||(s==0?e=n:(e=(ke.findFrom(e,-r,!0)||ke.findFrom(e,r,!0)).$anchor,e.pos<n.pos!=s<0&&(e=n))),new be(e,n)}}ke.jsonID("text",be);class Hy{constructor(e,n){this.anchor=e,this.head=n}map(e){return new Hy(e.map(this.anchor),e.map(this.head))}resolve(e){return be.between(e.resolve(this.anchor),e.resolve(this.head))}}class _e extends ke{constructor(e){let n=e.nodeAfter,r=e.node(0).resolve(e.pos+n.nodeSize);super(e,r),this.node=n}map(e,n){let{deleted:r,pos:s}=n.mapResult(this.anchor),i=e.resolve(s);return r?ke.near(i):new _e(i)}content(){return new ue(te.from(this.node),0,0)}eq(e){return e instanceof _e&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new Ob(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new _e(e.resolve(n.anchor))}static create(e,n){return new _e(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}}_e.prototype.visible=!1;ke.jsonID("node",_e);class Ob{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:r}=e.mapResult(this.anchor);return n?new Hy(r,r):new Ob(r)}resolve(e){let n=e.resolve(this.anchor),r=n.nodeAfter;return r&&_e.isSelectable(r)?new _e(n):ke.near(n)}}class yr extends ke{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=ue.empty){if(n==ue.empty){e.delete(0,e.doc.content.size);let r=ke.atStart(e.doc);r.eq(e.selection)||e.setSelection(r)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new yr(e)}map(e){return new yr(e)}eq(e){return e instanceof yr}getBookmark(){return AK}}ke.jsonID("all",yr);const AK={map(){return this},resolve(t){return new yr(t)}};function Ol(t,e,n,r,s,i=!1){if(e.inlineContent)return be.create(t,n);for(let o=r-(s>0?0:1);s>0?o<e.childCount:o>=0;o+=s){let a=e.child(o);if(a.isAtom){if(!i&&_e.isSelectable(a))return _e.create(t,n-(s<0?a.nodeSize:0))}else{let l=Ol(t,a,n+s,s<0?a.childCount:0,s,i);if(l)return l}n+=a.nodeSize*s}return null}function oI(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof on||s instanceof un))return;let i=t.mapping.maps[r],o;i.forEach((a,l,c,u)=>{o==null&&(o=u)}),t.setSelection(ke.near(t.doc.resolve(o),n))}const aI=1,Kf=2,lI=4;class RK extends Mb{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|aI)&~Kf,this.storedMarks=null,this}get selectionSet(){return(this.updated&aI)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Kf,this}ensureMarks(e){return rt.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Kf)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Kf,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let r=this.selection;return n&&(e=e.mark(this.storedMarks||(r.empty?r.$from.marks():r.$from.marksAcross(r.$to)||rt.none))),r.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,r){let s=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(s.text(e),!0):this.deleteSelection();{if(r==null&&(r=n),!e)return this.deleteRange(n,r);let i=this.storedMarks;if(!i){let o=this.doc.resolve(n);i=r==n?o.marks():o.marksAcross(this.doc.resolve(r))}return this.replaceRangeWith(n,r,s.text(e,i)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(ke.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=lI,this}get scrolledIntoView(){return(this.updated&lI)>0}}function cI(t,e){return!e||!t?t:t.bind(e)}class th{constructor(e,n,r){this.name=e,this.init=cI(n.init,r),this.apply=cI(n.apply,r)}}const NK=[new th("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new th("selection",{init(t,e){return t.selection||ke.atStart(e.doc)},apply(t){return t.selection}}),new th("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new th("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class E0{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=NK.slice(),n&&n.forEach(r=>{if(this.pluginsByKey[r.key])throw new RangeError("Adding different instances of a keyed plugin ("+r.key+")");this.plugins.push(r),this.pluginsByKey[r.key]=r,r.spec.state&&this.fields.push(new th(r.key,r.spec.state,r))})}}class Yl{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let r=0;r<this.config.plugins.length;r++)if(r!=n){let s=this.config.plugins[r];if(s.spec.filterTransaction&&!s.spec.filterTransaction.call(s,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],r=this.applyInner(e),s=null;for(;;){let i=!1;for(let o=0;o<this.config.plugins.length;o++){let a=this.config.plugins[o];if(a.spec.appendTransaction){let l=s?s[o].n:0,c=s?s[o].state:this,u=l<n.length&&a.spec.appendTransaction.call(a,l?n.slice(l):n,c,r);if(u&&r.filterTransaction(u,o)){if(u.setMeta("appendedTransaction",e),!s){s=[];for(let h=0;h<this.config.plugins.length;h++)s.push(h<o?{state:r,n:n.length}:{state:this,n:0})}n.push(u),r=r.applyInner(u),i=!0}s&&(s[o]={state:r,n:n.length})}}if(!i)return{state:r,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new Yl(this.config),r=this.config.fields;for(let s=0;s<r.length;s++){let i=r[s];n[i.name]=i.apply(e,this[i.name],this,n)}return n}get tr(){return new RK(this)}static create(e){let n=new E0(e.doc?e.doc.type.schema:e.schema,e.plugins),r=new Yl(n);for(let s=0;s<n.fields.length;s++)r[n.fields[s].name]=n.fields[s].init(e,r);return r}reconfigure(e){let n=new E0(this.schema,e.plugins),r=n.fields,s=new Yl(n);for(let i=0;i<r.length;i++){let o=r[i].name;s[o]=this.hasOwnProperty(o)?this[o]:r[i].init(e,s)}return s}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(r=>r.toJSON())),e&&typeof e=="object")for(let r in e){if(r=="doc"||r=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let s=e[r],i=s.spec.state;i&&i.toJSON&&(n[r]=i.toJSON.call(s,this[s.key]))}return n}static fromJSON(e,n,r){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new E0(e.schema,e.plugins),i=new Yl(s);return s.fields.forEach(o=>{if(o.name=="doc")i.doc=as.fromJSON(e.schema,n.doc);else if(o.name=="selection")i.selection=ke.fromJSON(i.doc,n.selection);else if(o.name=="storedMarks")n.storedMarks&&(i.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(r)for(let a in r){let l=r[a],c=l.spec.state;if(l.key==o.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,a)){i[o.name]=c.fromJSON.call(l,e,n[a],i);return}}i[o.name]=o.init(e,i)}}),i}}function aL(t,e,n){for(let r in t){let s=t[r];s instanceof Function?s=s.bind(e):r=="handleDOMEvents"&&(s=aL(s,e,{})),n[r]=s}return n}class pt{constructor(e){this.spec=e,this.props={},e.props&&aL(e.props,this,this.props),this.key=e.key?e.key.key:lL("plugin")}getState(e){return e[this.key]}}const S0=Object.create(null);function lL(t){return t in S0?t+"$"+ ++S0[t]:(S0[t]=0,t+"$")}class Dt{constructor(e="key"){this.key=lL(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}const Db=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function cL(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const uL=(t,e,n)=>{let r=cL(t,n);if(!r)return!1;let s=Lb(r);if(!s){let o=r.blockRange(),a=o&&su(o);return a==null?!1:(e&&e(t.tr.lift(o,a).scrollIntoView()),!0)}let i=s.nodeBefore;if(wL(t,s,e,-1))return!0;if(r.parent.content.size==0&&(Uc(i,"end")||_e.isSelectable(i)))for(let o=r.depth;;o--){let a=$y(t.doc,r.before(o),r.after(o),ue.empty);if(a&&a.slice.size<a.to-a.from){if(e){let l=t.tr.step(a);l.setSelection(Uc(i,"end")?ke.findFrom(l.doc.resolve(l.mapping.map(s.pos,-1)),-1):_e.create(l.doc,s.pos-i.nodeSize)),e(l.scrollIntoView())}return!0}if(o==1||r.node(o-1).childCount>1)break}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos-i.nodeSize,s.pos).scrollIntoView()),!0):!1},PK=(t,e,n)=>{let r=cL(t,n);if(!r)return!1;let s=Lb(r);return s?hL(t,s,e):!1},MK=(t,e,n)=>{let r=fL(t,n);if(!r)return!1;let s=jb(r);return s?hL(t,s,e):!1};function hL(t,e,n){let r=e.nodeBefore,s=r,i=e.pos-1;for(;!s.isTextblock;i--){if(s.type.spec.isolating)return!1;let u=s.lastChild;if(!u)return!1;s=u}let o=e.nodeAfter,a=o,l=e.pos+1;for(;!a.isTextblock;l++){if(a.type.spec.isolating)return!1;let u=a.firstChild;if(!u)return!1;a=u}let c=$y(t.doc,i,l,ue.empty);if(!c||c.from!=i||c instanceof on&&c.slice.size>=l-i)return!1;if(n){let u=t.tr.step(c);u.setSelection(be.create(u.doc,i)),n(u.scrollIntoView())}return!0}function Uc(t,e,n=!1){for(let r=t;r;r=e=="start"?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&r.childCount!=1)return!1}return!1}const dL=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;i=Lb(r)}let o=i&&i.nodeBefore;return!o||!_e.isSelectable(o)?!1:(e&&e(t.tr.setSelection(_e.create(t.doc,i.pos-o.nodeSize)).scrollIntoView()),!0)};function Lb(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function fL(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const pL=(t,e,n)=>{let r=fL(t,n);if(!r)return!1;let s=jb(r);if(!s)return!1;let i=s.nodeAfter;if(wL(t,s,e,1))return!0;if(r.parent.content.size==0&&(Uc(i,"start")||_e.isSelectable(i))){let o=$y(t.doc,r.before(),r.after(),ue.empty);if(o&&o.slice.size<o.to-o.from){if(e){let a=t.tr.step(o);a.setSelection(Uc(i,"start")?ke.findFrom(a.doc.resolve(a.mapping.map(s.pos)),1):_e.create(a.doc,a.mapping.map(s.pos))),e(a.scrollIntoView())}return!0}}return i.isAtom&&s.depth==r.depth-1?(e&&e(t.tr.delete(s.pos,s.pos+i.nodeSize).scrollIntoView()),!0):!1},mL=(t,e,n)=>{let{$head:r,empty:s}=t.selection,i=r;if(!s)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;i=jb(r)}let o=i&&i.nodeAfter;return!o||!_e.isSelectable(o)?!1:(e&&e(t.tr.setSelection(_e.create(t.doc,i.pos)).scrollIntoView()),!0)};function jb(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const OK=(t,e)=>{let n=t.selection,r=n instanceof _e,s;if(r){if(n.node.isTextblock||!$o(t.doc,n.from))return!1;s=n.from}else if(s=zy(t.doc,n.from,-1),s==null)return!1;if(e){let i=t.tr.join(s);r&&i.setSelection(_e.create(i.doc,s-t.doc.resolve(s).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},DK=(t,e)=>{let n=t.selection,r;if(n instanceof _e){if(n.node.isTextblock||!$o(t.doc,n.to))return!1;r=n.to}else if(r=zy(t.doc,n.to,1),r==null)return!1;return e&&e(t.tr.join(r).scrollIntoView()),!0},LK=(t,e)=>{let{$from:n,$to:r}=t.selection,s=n.blockRange(r),i=s&&su(s);return i==null?!1:(e&&e(t.tr.lift(s,i).scrollIntoView()),!0)},gL=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!n.parent.type.spec.code||!n.sameParent(r)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function Vb(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const jK=(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let s=n.node(-1),i=n.indexAfter(-1),o=Vb(s.contentMatchAt(i));if(!o||!s.canReplaceWith(i,i,o))return!1;if(e){let a=n.after(),l=t.tr.replaceWith(a,a,o.createAndFill());l.setSelection(ke.near(l.doc.resolve(a),1)),e(l.scrollIntoView())}return!0},yL=(t,e)=>{let n=t.selection,{$from:r,$to:s}=n;if(n instanceof yr||r.parent.inlineContent||s.parent.inlineContent)return!1;let i=Vb(s.parent.contentMatchAt(s.indexAfter()));if(!i||!i.isTextblock)return!1;if(e){let o=(!r.parentOffset&&s.index()<s.parent.childCount?r:s).pos,a=t.tr.insert(o,i.createAndFill());a.setSelection(be.create(a.doc,o+1)),e(a.scrollIntoView())}return!0},vL=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let i=n.before();if(li(t.doc,i))return e&&e(t.tr.split(i).scrollIntoView()),!0}let r=n.blockRange(),s=r&&su(r);return s==null?!1:(e&&e(t.tr.lift(r,s).scrollIntoView()),!0)};function VK(t){return(e,n)=>{let{$from:r,$to:s}=e.selection;if(e.selection instanceof _e&&e.selection.node.isBlock)return!r.parentOffset||!li(e.doc,r.pos)?!1:(n&&n(e.tr.split(r.pos).scrollIntoView()),!0);if(!r.depth)return!1;let i=[],o,a,l=!1,c=!1;for(let f=r.depth;;f--)if(r.node(f).isBlock){l=r.end(f)==r.pos+(r.depth-f),c=r.start(f)==r.pos-(r.depth-f),a=Vb(r.node(f-1).contentMatchAt(r.indexAfter(f-1))),i.unshift(l&&a?{type:a}:null),o=f;break}else{if(f==1)return!1;i.unshift(null)}let u=e.tr;(e.selection instanceof be||e.selection instanceof yr)&&u.deleteSelection();let h=u.mapping.map(r.pos),d=li(u.doc,h,i.length,i);if(d||(i[0]=a?{type:a}:null,d=li(u.doc,h,i.length,i)),!d)return!1;if(u.split(h,i.length,i),!l&&c&&r.node(o).type!=a){let f=u.mapping.map(r.before(o)),g=u.doc.resolve(f);a&&r.node(o-1).canReplaceWith(g.index(),g.index()+1,a)&&u.setNodeMarkup(u.mapping.map(r.before(o)),a)}return n&&n(u.scrollIntoView()),!0}}const FK=VK(),BK=(t,e)=>{let{$from:n,to:r}=t.selection,s,i=n.sharedDepth(r);return i==0?!1:(s=n.before(i),e&&e(t.tr.setSelection(_e.create(t.doc,s))),!0)};function UK(t,e,n){let r=e.nodeBefore,s=e.nodeAfter,i=e.index();return!r||!s||!r.type.compatibleContent(s.type)?!1:!r.content.size&&e.parent.canReplace(i-1,i)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(i,i+1)||!(s.isTextblock||$o(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function wL(t,e,n,r){let s=e.nodeBefore,i=e.nodeAfter,o,a,l=s.type.spec.isolating||i.type.spec.isolating;if(!l&&UK(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(o=(a=s.contentMatchAt(s.childCount)).findWrapping(i.type))&&a.matchType(o[0]||i.type).validEnd){if(n){let f=e.pos+i.nodeSize,g=te.empty;for(let w=o.length-1;w>=0;w--)g=te.from(o[w].create(null,g));g=te.from(s.copy(g));let y=t.tr.step(new un(e.pos-1,f,e.pos,f,new ue(g,1,0),o.length,!0)),v=y.doc.resolve(f+2*o.length);v.nodeAfter&&v.nodeAfter.type==s.type&&$o(y.doc,v.pos)&&y.join(v.pos),n(y.scrollIntoView())}return!0}let u=i.type.spec.isolating||r>0&&l?null:ke.findFrom(e,1),h=u&&u.$from.blockRange(u.$to),d=h&&su(h);if(d!=null&&d>=e.depth)return n&&n(t.tr.lift(h,d).scrollIntoView()),!0;if(c&&Uc(i,"start",!0)&&Uc(s,"end")){let f=s,g=[];for(;g.push(f),!f.isTextblock;)f=f.lastChild;let y=i,v=1;for(;!y.isTextblock;y=y.firstChild)v++;if(f.canReplace(f.childCount,f.childCount,y.content)){if(n){let w=te.empty;for(let E=g.length-1;E>=0;E--)w=te.from(g[E].copy(w));let T=t.tr.step(new un(e.pos-g.length,e.pos+i.nodeSize,e.pos+v,e.pos+i.nodeSize-v,new ue(w,g.length,0),0,!0));n(T.scrollIntoView())}return!0}}return!1}function _L(t){return function(e,n){let r=e.selection,s=t<0?r.$from:r.$to,i=s.depth;for(;s.node(i).isInline;){if(!i)return!1;i--}return s.node(i).isTextblock?(n&&n(e.tr.setSelection(be.create(e.doc,t<0?s.start(i):s.end(i)))),!0):!1}}const zK=_L(-1),$K=_L(1);function HK(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),a=o&&Pb(o,t,e);return a?(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0):!1}}function uI(t,e=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:o},$to:{pos:a}}=n.selection.ranges[i];n.doc.nodesBetween(o,a,(l,c)=>{if(s)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)s=!0;else{let u=n.doc.resolve(c),h=u.index();s=u.parent.canReplaceWith(h,h+1,t)}})}if(!s)return!1;if(r){let i=n.tr;for(let o=0;o<n.selection.ranges.length;o++){let{$from:{pos:a},$to:{pos:l}}=n.selection.ranges[o];i.setBlockType(a,l,t,e)}r(i.scrollIntoView())}return!0}}function Fb(...t){return function(e,n,r){for(let s=0;s<t.length;s++)if(t[s](e,n,r))return!0;return!1}}Fb(Db,uL,dL);Fb(Db,pL,mL);Fb(gL,yL,vL,FK);typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform&&os.platform()=="darwin";function WK(t,e=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i);if(!o)return!1;let a=r?n.tr:null;return qK(a,o,t,e)?(r&&r(a.scrollIntoView()),!0):!1}}function qK(t,e,n,r=null){let s=!1,i=e,o=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=o.resolve(e.start-2);i=new eg(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new eg(e.$from,o.resolve(e.$to.end(e.depth)),e.depth)),s=!0}let a=Pb(i,n,r,e);return a?(t&&KK(t,e,a,s,n),!0):!1}function KK(t,e,n,r,s){let i=te.empty;for(let u=n.length-1;u>=0;u--)i=te.from(n[u].type.create(n[u].attrs,i));t.step(new un(e.start-(r?2:0),e.end,e.start,e.end,new ue(i,0,0),n.length,!0));let o=0;for(let u=0;u<n.length;u++)n[u].type==s&&(o=u+1);let a=n.length-o,l=e.start+n.length-(r?2:0),c=e.parent;for(let u=e.startIndex,h=e.endIndex,d=!0;u<h;u++,d=!1)!d&&li(t.doc,l,a)&&(t.split(l,a),l+=2*a),l+=c.child(u).nodeSize;return t}function GK(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,o=>o.childCount>0&&o.firstChild.type==t);return i?n?r.node(i.depth-1).type==t?QK(e,n,t,i):JK(e,n,i):!0:!1}}function QK(t,e,n,r){let s=t.tr,i=r.end,o=r.$to.end(r.depth);i<o&&(s.step(new un(i-1,o,i,o,new ue(te.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new eg(s.doc.resolve(r.$from.pos),s.doc.resolve(o),r.depth));const a=su(r);if(a==null)return!1;s.lift(r,a);let l=s.doc.resolve(s.mapping.map(i,-1)-1);return $o(s.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&s.join(l.pos),e(s.scrollIntoView()),!0}function JK(t,e,n){let r=t.tr,s=n.parent;for(let f=n.end,g=n.endIndex-1,y=n.startIndex;g>y;g--)f-=s.child(g).nodeSize,r.delete(f-1,f+1);let i=r.doc.resolve(n.start),o=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let a=n.startIndex==0,l=n.endIndex==s.childCount,c=i.node(-1),u=i.index(-1);if(!c.canReplace(u+(a?0:1),u+1,o.content.append(l?te.empty:te.from(s))))return!1;let h=i.pos,d=h+o.nodeSize;return r.step(new un(h-(a?1:0),d+(l?1:0),h+1,d-1,new ue((a?te.empty:te.from(s.copy(te.empty))).append(l?te.empty:te.from(s.copy(te.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}function XK(t){return function(e,n){let{$from:r,$to:s}=e.selection,i=r.blockRange(s,c=>c.childCount>0&&c.firstChild.type==t);if(!i)return!1;let o=i.startIndex;if(o==0)return!1;let a=i.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==a.type,u=te.from(c?t.create():null),h=new ue(te.from(t.create(null,te.from(a.type.create(null,u)))),c?3:1,0),d=i.start,f=i.end;n(e.tr.step(new un(d-(c?3:1),f,d,f,h,1,!0)).scrollIntoView())}return!0}}const vn=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},zc=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e};let V1=null;const Gs=function(t,e,n){let r=V1||(V1=document.createRange());return r.setEnd(t,n??t.nodeValue.length),r.setStart(t,e||0),r},YK=function(){V1=null},el=function(t,e,n,r){return n&&(hI(t,e,n,r,-1)||hI(t,e,n,r,1))},ZK=/^(img|br|input|textarea|hr)$/i;function hI(t,e,n,r,s){for(var i;;){if(t==n&&e==r)return!0;if(e==(s<0?0:Pr(t))){let o=t.parentNode;if(!o||o.nodeType!=1||Xd(t)||ZK.test(t.nodeName)||t.contentEditable=="false")return!1;e=vn(t)+(s<0?0:1),t=o}else if(t.nodeType==1){let o=t.childNodes[e+(s<0?-1:0)];if(o.nodeType==1&&o.contentEditable=="false")if(!((i=o.pmViewDesc)===null||i===void 0)&&i.ignoreForSelection)e+=s;else return!1;else t=o,e=s<0?Pr(t):0}else return!1}}function Pr(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function eG(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Pr(t)}else if(t.parentNode&&!Xd(t))e=vn(t),t=t.parentNode;else return null}}function tG(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Xd(t))e=vn(t)+1,t=t.parentNode;else return null}}function nG(t,e,n){for(let r=e==0,s=e==Pr(t);r||s;){if(t==n)return!0;let i=vn(t);if(t=t.parentNode,!t)return!1;r=r&&i==0,s=s&&i==Pr(t)}}function Xd(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const Wy=function(t){return t.focusNode&&el(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function ca(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function rG(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function sG(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:Math.min(Pr(r.offsetNode),r.offset)}}catch{}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:Math.min(Pr(r.startContainer),r.startOffset)}}}const Os=typeof navigator<"u"?navigator:null,dI=typeof document<"u"?document:null,Ho=Os&&Os.userAgent||"",F1=/Edge\/(\d+)/.exec(Ho),xL=/MSIE \d/.exec(Ho),B1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Ho),ir=!!(xL||B1||F1),xo=xL?document.documentMode:B1?+B1[1]:F1?+F1[1]:0,jr=!ir&&/gecko\/(\d+)/i.test(Ho);jr&&+(/Firefox\/(\d+)/.exec(Ho)||[0,0])[1];const U1=!ir&&/Chrome\/(\d+)/.exec(Ho),an=!!U1,bL=U1?+U1[1]:0,Dn=!ir&&!!Os&&/Apple Computer/.test(Os.vendor),$c=Dn&&(/Mobile\/\w+/.test(Ho)||!!Os&&Os.maxTouchPoints>2),Ir=$c||(Os?/Mac/.test(Os.platform):!1),TL=Os?/Win/.test(Os.platform):!1,ri=/Android \d/.test(Ho),Yd=!!dI&&"webkitFontSmoothing"in dI.documentElement.style,iG=Yd?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function oG(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function zs(t,e){return typeof t=="number"?t:t[e]}function aG(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function fI(t,e,n){let r=t.someProp("scrollThreshold")||0,s=t.someProp("scrollMargin")||5,i=t.dom.ownerDocument;for(let o=n||t.dom;o;){if(o.nodeType!=1){o=zc(o);continue}let a=o,l=a==i.body,c=l?oG(i):aG(a),u=0,h=0;if(e.top<c.top+zs(r,"top")?h=-(c.top-e.top+zs(s,"top")):e.bottom>c.bottom-zs(r,"bottom")&&(h=e.bottom-e.top>c.bottom-c.top?e.top+zs(s,"top")-c.top:e.bottom-c.bottom+zs(s,"bottom")),e.left<c.left+zs(r,"left")?u=-(c.left-e.left+zs(s,"left")):e.right>c.right-zs(r,"right")&&(u=e.right-c.right+zs(s,"right")),u||h)if(l)i.defaultView.scrollBy(u,h);else{let f=a.scrollLeft,g=a.scrollTop;h&&(a.scrollTop+=h),u&&(a.scrollLeft+=u);let y=a.scrollLeft-f,v=a.scrollTop-g;e={left:e.left-y,top:e.top-v,right:e.right-y,bottom:e.bottom-v}}let d=l?"fixed":getComputedStyle(o).position;if(/^(fixed|sticky)$/.test(d))break;o=d=="absolute"?o.offsetParent:zc(o)}}function lG(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),r,s;for(let i=(e.left+e.right)/2,o=n+1;o<Math.min(innerHeight,e.bottom);o+=5){let a=t.root.elementFromPoint(i,o);if(!a||a==t.dom||!t.dom.contains(a))continue;let l=a.getBoundingClientRect();if(l.top>=n-20){r=a,s=l.top;break}}return{refDOM:r,refTop:s,stack:EL(t.dom)}}function EL(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=zc(r));return e}function cG({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;SL(n,r==0?0:r-e)}function SL(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:s,left:i}=t[n];r.scrollTop!=s+e&&(r.scrollTop=s+e),r.scrollLeft!=i&&(r.scrollLeft=i)}}let Cl=null;function uG(t){if(t.setActive)return t.setActive();if(Cl)return t.focus(Cl);let e=EL(t);t.focus(Cl==null?{get preventScroll(){return Cl={preventScroll:!0},!0}}:void 0),Cl||(Cl=!1,SL(e,0))}function kL(t,e){let n,r=2e8,s,i=0,o=e.top,a=e.top,l,c;for(let u=t.firstChild,h=0;u;u=u.nextSibling,h++){let d;if(u.nodeType==1)d=u.getClientRects();else if(u.nodeType==3)d=Gs(u).getClientRects();else continue;for(let f=0;f<d.length;f++){let g=d[f];if(g.top<=o&&g.bottom>=a){o=Math.max(g.bottom,o),a=Math.min(g.top,a);let y=g.left>e.left?g.left-e.left:g.right<e.left?e.left-g.right:0;if(y<r){n=u,r=y,s=y&&n.nodeType==3?{left:g.right<e.left?g.right:g.left,top:e.top}:e,u.nodeType==1&&y&&(i=h+(e.left>=(g.left+g.right)/2?1:0));continue}}else g.top>e.top&&!l&&g.left<=e.left&&g.right>=e.left&&(l=u,c={left:Math.max(g.left,Math.min(g.right,e.left)),top:g.top});!n&&(e.left>=g.right&&e.top>=g.top||e.left>=g.left&&e.top>=g.bottom)&&(i=h+1)}}return!n&&l&&(n=l,s=c,r=0),n&&n.nodeType==3?hG(n,s):!n||r&&n.nodeType==1?{node:t,offset:i}:kL(n,s)}function hG(t,e){let n=t.nodeValue.length,r=document.createRange(),s;for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let o=Fi(r,1);if(o.top!=o.bottom&&Bb(e,o)){s={node:t,offset:i+(e.left>=(o.left+o.right)/2?1:0)};break}}return r.detach(),s||{node:t,offset:0}}function Bb(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function dG(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function fG(t,e,n){let{node:r,offset:s}=kL(e,n),i=-1;if(r.nodeType==1&&!r.firstChild){let o=r.getBoundingClientRect();i=o.left!=o.right&&n.left>(o.left+o.right)/2?1:-1}return t.docView.posFromDOM(r,s,i)}function pG(t,e,n,r){let s=-1;for(let i=e,o=!1;i!=t.dom;){let a=t.docView.nearestDesc(i,!0),l;if(!a)return null;if(a.dom.nodeType==1&&(a.node.isBlock&&a.parent||!a.contentDOM)&&((l=a.dom.getBoundingClientRect()).width||l.height)&&(a.node.isBlock&&a.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(a.dom.nodeName)&&(!o&&l.left>r.left||l.top>r.top?s=a.posBefore:(!o&&l.right<r.left||l.bottom<r.top)&&(s=a.posAfter),o=!0),!a.contentDOM&&s<0&&!a.node.isText))return(a.node.isBlock?r.top<(l.top+l.bottom)/2:r.left<(l.left+l.right)/2)?a.posBefore:a.posAfter;i=a.dom.parentNode}return s>-1?s:t.docView.posFromDOM(e,n,-1)}function CL(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let o=t.childNodes[i];if(o.nodeType==1){let a=o.getClientRects();for(let l=0;l<a.length;l++){let c=a[l];if(Bb(e,c))return CL(o,e,c)}}if((i=(i+1)%r)==s)break}return t}function mG(t,e){let n=t.dom.ownerDocument,r,s=0,i=sG(n,e.left,e.top);i&&({node:r,offset:s}=i);let o=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),a;if(!o||!t.dom.contains(o.nodeType!=1?o.parentNode:o)){let c=t.dom.getBoundingClientRect();if(!Bb(e,c)||(o=CL(t.dom,e,c),!o))return null}if(Dn)for(let c=o;r&&c;c=zc(c))c.draggable&&(r=void 0);if(o=dG(o,e),r){if(jr&&r.nodeType==1&&(s=Math.min(s,r.childNodes.length),s<r.childNodes.length)){let u=r.childNodes[s],h;u.nodeName=="IMG"&&(h=u.getBoundingClientRect()).right<=e.left&&h.bottom>e.top&&s++}let c;Yd&&s&&r.nodeType==1&&(c=r.childNodes[s-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&s--,r==t.dom&&s==r.childNodes.length-1&&r.lastChild.nodeType==1&&e.top>r.lastChild.getBoundingClientRect().bottom?a=t.state.doc.content.size:(s==0||r.nodeType!=1||r.childNodes[s-1].nodeName!="BR")&&(a=pG(t,r,s,e))}a==null&&(a=fG(t,o,e));let l=t.docView.nearestDesc(o,!0);return{pos:a,inside:l?l.posAtStart-l.border:-1}}function pI(t){return t.top<t.bottom||t.left<t.right}function Fi(t,e){let n=t.getClientRects();if(n.length){let r=n[e<0?0:n.length-1];if(pI(r))return r}return Array.prototype.find.call(n,pI)||t.getBoundingClientRect()}const gG=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function IL(t,e,n){let{node:r,offset:s,atom:i}=t.docView.domFromPos(e,n<0?-1:1),o=Yd||jr;if(r.nodeType==3)if(o&&(gG.test(r.nodeValue)||(n<0?!s:s==r.nodeValue.length))){let l=Fi(Gs(r,s,s),n);if(jr&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let c=Fi(Gs(r,s-1,s-1),-1);if(c.top==l.top){let u=Fi(Gs(r,s,s+1),-1);if(u.top!=l.top)return Vu(u,u.left<c.left)}}return l}else{let l=s,c=s,u=n<0?1:-1;return n<0&&!s?(c++,u=-1):n>=0&&s==r.nodeValue.length?(l--,u=1):n<0?l--:c++,Vu(Fi(Gs(r,l,c),u),u<0)}if(!t.state.doc.resolve(e-(i||0)).parent.inlineContent){if(i==null&&s&&(n<0||s==Pr(r))){let l=r.childNodes[s-1];if(l.nodeType==1)return k0(l.getBoundingClientRect(),!1)}if(i==null&&s<Pr(r)){let l=r.childNodes[s];if(l.nodeType==1)return k0(l.getBoundingClientRect(),!0)}return k0(r.getBoundingClientRect(),n>=0)}if(i==null&&s&&(n<0||s==Pr(r))){let l=r.childNodes[s-1],c=l.nodeType==3?Gs(l,Pr(l)-(o?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return Vu(Fi(c,1),!1)}if(i==null&&s<Pr(r)){let l=r.childNodes[s];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Gs(l,0,o?0:1):l.nodeType==1?l:null:null;if(c)return Vu(Fi(c,-1),!0)}return Vu(Fi(r.nodeType==3?Gs(r):r,-n),n>=0)}function Vu(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function k0(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function AL(t,e,n){let r=t.state,s=t.root.activeElement;r!=e&&t.updateState(e),s!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),s!=t.dom&&s&&s.focus()}}function yG(t,e,n){let r=e.selection,s=n=="up"?r.$from:r.$to;return AL(t,e,()=>{let{node:i}=t.docView.domFromPos(s.pos,n=="up"?-1:1);for(;;){let a=t.docView.nearestDesc(i,!0);if(!a)break;if(a.node.isBlock){i=a.contentDOM||a.dom;break}i=a.dom.parentNode}let o=IL(t,s.pos,1);for(let a=i.firstChild;a;a=a.nextSibling){let l;if(a.nodeType==1)l=a.getClientRects();else if(a.nodeType==3)l=Gs(a,0,a.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let u=l[c];if(u.bottom>u.top+1&&(n=="up"?o.top-u.top>(u.bottom-o.top)*2:u.bottom-o.bottom>(o.bottom-u.top)*2))return!1}}return!0})}const vG=/[\u0590-\u08ac]/;function wG(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=t.domSelection();return a?!vG.test(r.parent.textContent)||!a.modify?n=="left"||n=="backward"?i:o:AL(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:u,anchorOffset:h}=t.domSelectionRange(),d=a.caretBidiLevel;a.modify("move",n,"character");let f=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:g,focusOffset:y}=t.domSelectionRange(),v=g&&!f.contains(g.nodeType==1?g:g.parentNode)||l==g&&c==y;try{a.collapse(u,h),l&&(l!=u||c!=h)&&a.extend&&a.extend(l,c)}catch{}return d!=null&&(a.caretBidiLevel=d),v}):r.pos==r.start()||r.pos==r.end()}let mI=null,gI=null,yI=!1;function _G(t,e,n){return mI==e&&gI==n?yI:(mI=e,gI=n,yI=n=="up"||n=="down"?yG(t,e,n):wG(t,e,n))}const Vr=0,vI=1,ga=2,Ds=3;class Zd{constructor(e,n,r,s){this.parent=e,this.children=n,this.dom=r,this.contentDOM=s,this.dirty=Vr,r.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,r){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,r=this.posAtStart;;n++){let s=this.children[n];if(s==e)return r;r+=s.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,r){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(r<0){let i,o;if(e==this.contentDOM)i=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.previousSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.previousSibling;return i?this.posBeforeChild(o)+o.size:this.posAtStart}else{let i,o;if(e==this.contentDOM)i=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;i=e.nextSibling}for(;i&&!((o=i.pmViewDesc)&&o.parent==this);)i=i.nextSibling;return i?this.posBeforeChild(o):this.posAtEnd}let s;if(e==this.dom&&this.contentDOM)s=n>vn(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))s=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!1;break}if(i.previousSibling)break}if(s==null&&n==e.childNodes.length)for(let i=e;;i=i.parentNode){if(i==this.dom){s=!0;break}if(i.nextSibling)break}}return s??r>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let r=!0,s=e;s;s=s.parentNode){let i=this.getDesc(s),o;if(i&&(!n||i.node))if(r&&(o=i.nodeDOM)&&!(o.nodeType==1?o.contains(e.nodeType==1?e:e.parentNode):o==e))r=!1;else return i}}getDesc(e){let n=e.pmViewDesc;for(let r=n;r;r=r.parent)if(r==this)return n}posFromDOM(e,n,r){for(let s=e;s;s=s.parentNode){let i=this.getDesc(s);if(i)return i.localPosFromDOM(e,n,r)}return-1}descAt(e){for(let n=0,r=0;n<this.children.length;n++){let s=this.children[n],i=r+s.size;if(r==e&&i!=r){for(;!s.border&&s.children.length;)for(let o=0;o<s.children.length;o++){let a=s.children[o];if(a.size){s=a;break}}return s}if(e<i)return s.descAt(e-r-s.border);r=i}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let r=0,s=0;for(let i=0;r<this.children.length;r++){let o=this.children[r],a=i+o.size;if(a>e||o instanceof NL){s=e-i;break}i=a}if(s)return this.children[r].domFromPos(s-this.children[r].border,n);for(let i;r&&!(i=this.children[r-1]).size&&i instanceof RL&&i.side>=0;r--);if(n<=0){let i,o=!0;for(;i=r?this.children[r-1]:null,!(!i||i.dom.parentNode==this.contentDOM);r--,o=!1);return i&&n&&o&&!i.border&&!i.domAtom?i.domFromPos(i.size,n):{node:this.contentDOM,offset:i?vn(i.dom)+1:0}}else{let i,o=!0;for(;i=r<this.children.length?this.children[r]:null,!(!i||i.dom.parentNode==this.contentDOM);r++,o=!1);return i&&o&&!i.border&&!i.domAtom?i.domFromPos(0,n):{node:this.contentDOM,offset:i?vn(i.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,r=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let s=-1,i=-1;for(let o=r,a=0;;a++){let l=this.children[a],c=o+l.size;if(s==-1&&e<=c){let u=o+l.border;if(e>=u&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,u);e=o;for(let h=a;h>0;h--){let d=this.children[h-1];if(d.size&&d.dom.parentNode==this.contentDOM&&!d.emptyChildAt(1)){s=vn(d.dom)+1;break}e-=d.size}s==-1&&(s=0)}if(s>-1&&(c>n||a==this.children.length-1)){n=c;for(let u=a+1;u<this.children.length;u++){let h=this.children[u];if(h.size&&h.dom.parentNode==this.contentDOM&&!h.emptyChildAt(-1)){i=vn(h.dom);break}n+=h.size}i==-1&&(i=this.contentDOM.childNodes.length);break}o=c}return{node:this.contentDOM,from:e,to:n,fromOffset:s,toOffset:i}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:r}=this.domFromPos(e,0);if(n.nodeType!=1||r==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[r]}setSelection(e,n,r,s=!1){let i=Math.min(e,n),o=Math.max(e,n);for(let f=0,g=0;f<this.children.length;f++){let y=this.children[f],v=g+y.size;if(i>g&&o<v)return y.setSelection(e-g-y.border,n-g-y.border,r,s);g=v}let a=this.domFromPos(e,e?-1:1),l=n==e?a:this.domFromPos(n,n?-1:1),c=r.root.getSelection(),u=r.domSelectionRange(),h=!1;if((jr||Dn)&&e==n){let{node:f,offset:g}=a;if(f.nodeType==3){if(h=!!(g&&f.nodeValue[g-1]==`
`),h&&g==f.nodeValue.length)for(let y=f,v;y;y=y.parentNode){if(v=y.nextSibling){v.nodeName=="BR"&&(a=l={node:v.parentNode,offset:vn(v)+1});break}let w=y.pmViewDesc;if(w&&w.node&&w.node.isBlock)break}}else{let y=f.childNodes[g-1];h=y&&(y.nodeName=="BR"||y.contentEditable=="false")}}if(jr&&u.focusNode&&u.focusNode!=l.node&&u.focusNode.nodeType==1){let f=u.focusNode.childNodes[u.focusOffset];f&&f.contentEditable=="false"&&(s=!0)}if(!(s||h&&Dn)&&el(a.node,a.offset,u.anchorNode,u.anchorOffset)&&el(l.node,l.offset,u.focusNode,u.focusOffset))return;let d=!1;if((c.extend||e==n)&&!(h&&jr)){c.collapse(a.node,a.offset);try{e!=n&&c.extend(l.node,l.offset),d=!0}catch{}}if(!d){if(e>n){let g=a;a=l,l=g}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(a.node,a.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let r=0,s=0;s<this.children.length;s++){let i=this.children[s],o=r+i.size;if(r==o?e<=o&&n>=r:e<o&&n>r){let a=r+i.border,l=o-i.border;if(e>=a&&n<=l){this.dirty=e==r||n==o?ga:vI,e==a&&n==l&&(i.contentLost||i.dom.parentNode!=this.contentDOM)?i.dirty=Ds:i.markDirty(e-a,n-a);return}else i.dirty=i.dom==i.contentDOM&&i.dom.parentNode==this.contentDOM&&!i.children.length?ga:Ds}r=o}this.dirty=ga}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let r=e==1?ga:vI;n.dirty<r&&(n.dirty=r)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}}class RL extends Zd{constructor(e,n,r,s){let i,o=n.type.toDOM;if(typeof o=="function"&&(o=o(r,()=>{if(!i)return s;if(i.parent)return i.parent.posBeforeChild(i)})),!n.type.spec.raw){if(o.nodeType!=1){let a=document.createElement("span");a.appendChild(o),o=a}o.contentEditable="false",o.classList.add("ProseMirror-widget")}super(e,[],o,null),this.widget=n,this.widget=n,i=this}matchesWidget(e){return this.dirty==Vr&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}}class xG extends Zd{constructor(e,n,r,s){super(e,[],n,null),this.textDOM=r,this.text=s}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}}class tl extends Zd{constructor(e,n,r,s,i){super(e,[],r,s),this.mark=n,this.spec=i}static create(e,n,r,s){let i=s.nodeViews[n.type.name],o=i&&i(n,s,r);return(!o||!o.dom)&&(o=dl.renderSpec(document,n.type.spec.toDOM(n,r),null,n.attrs)),new tl(e,n,o.dom,o.contentDOM||o.dom,o)}parseRule(){return this.dirty&Ds||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=Ds&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Vr){let r=this.parent;for(;!r.node;)r=r.parent;r.dirty<this.dirty&&(r.dirty=this.dirty),this.dirty=Vr}}slice(e,n,r){let s=tl.create(this.parent,this.mark,!0,r),i=this.children,o=this.size;n<o&&(i=$1(i,n,o,r)),e>0&&(i=$1(i,0,e,r));for(let a=0;a<i.length;a++)i[a].parent=s;return s.children=i,s}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}}class bo extends Zd{constructor(e,n,r,s,i,o,a,l,c){super(e,[],i,o),this.node=n,this.outerDeco=r,this.innerDeco=s,this.nodeDOM=a}static create(e,n,r,s,i,o){let a=i.nodeViews[n.type.name],l,c=a&&a(n,i,()=>{if(!l)return o;if(l.parent)return l.parent.posBeforeChild(l)},r,s),u=c&&c.dom,h=c&&c.contentDOM;if(n.isText){if(!u)u=document.createTextNode(n.text);else if(u.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else u||({dom:u,contentDOM:h}=dl.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!h&&!n.isText&&u.nodeName!="BR"&&(u.hasAttribute("contenteditable")||(u.contentEditable="false"),n.type.spec.draggable&&(u.draggable=!0));let d=u;return u=OL(u,r,n),c?l=new bG(e,n,r,s,u,h||null,d,c,i,o+1):n.isText?new qy(e,n,r,s,u,d,i):new bo(e,n,r,s,u,h||null,d,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let r=this.children[n];if(this.dom.contains(r.dom.parentNode)){e.contentElement=r.dom.parentNode;break}}e.contentElement||(e.getContent=()=>te.empty)}return e}matchesNode(e,n,r){return this.dirty==Vr&&e.eq(this.node)&&ng(n,this.outerDeco)&&r.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let r=this.node.inlineContent,s=n,i=e.composing?this.localCompositionInfo(e,n):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,l=new EG(this,o&&o.node,e);CG(this.node,this.innerDeco,(c,u,h)=>{c.spec.marks?l.syncToMarks(c.spec.marks,r,e):c.type.side>=0&&!h&&l.syncToMarks(u==this.node.childCount?rt.none:this.node.child(u).marks,r,e),l.placeWidget(c,e,s)},(c,u,h,d)=>{l.syncToMarks(c.marks,r,e);let f;l.findNodeMatch(c,u,h,d)||a&&e.state.selection.from>s&&e.state.selection.to<s+c.nodeSize&&(f=l.findIndexWithChild(i.node))>-1&&l.updateNodeAt(c,u,h,f,e)||l.updateNextNode(c,u,h,e,d,s)||l.addNode(c,u,h,e,s),s+=c.nodeSize}),l.syncToMarks([],r,e),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==ga)&&(o&&this.protectLocalComposition(e,o),PL(this.contentDOM,this.children,e),$c&&IG(this.dom))}localCompositionInfo(e,n){let{from:r,to:s}=e.state.selection;if(!(e.state.selection instanceof be)||r<n||s>n+this.node.content.size)return null;let i=e.input.compositionNode;if(!i||!this.dom.contains(i.parentNode))return null;if(this.node.inlineContent){let o=i.nodeValue,a=AG(this.node.content,o,r-n,s-n);return a<0?null:{node:i,pos:a,text:o}}else return{node:i,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:r,text:s}){if(this.getDesc(n))return;let i=n;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let o=new xG(this,i,n,s);e.input.compositionNodes.push(o),this.children=$1(this.children,r,r+s.length,e,o)}update(e,n,r,s){return this.dirty==Ds||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,r,s),!0)}updateInner(e,n,r,s){this.updateOuterDeco(n),this.node=e,this.innerDeco=r,this.contentDOM&&this.updateChildren(s,this.posAtStart),this.dirty=Vr}updateOuterDeco(e){if(ng(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,r=this.dom;this.dom=ML(this.dom,this.nodeDOM,z1(this.outerDeco,this.node,n),z1(e,this.node,n)),this.dom!=r&&(r.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}}function wI(t,e,n,r,s){OL(r,e,t);let i=new bo(void 0,t,e,n,r,r,r,s,0);return i.contentDOM&&i.updateChildren(s,0),i}class qy extends bo{constructor(e,n,r,s,i,o,a){super(e,n,r,s,i,null,o,a,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,r,s){return this.dirty==Ds||this.dirty!=Vr&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Vr||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,s.trackWrites==this.nodeDOM&&(s.trackWrites=null)),this.node=e,this.dirty=Vr,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,r){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,r)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,r){let s=this.node.cut(e,n),i=document.createTextNode(s.text);return new qy(this.parent,s,this.outerDeco,this.innerDeco,i,i,r)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=Ds)}get domAtom(){return!1}isText(e){return this.node.text==e}}class NL extends Zd{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Vr&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}}class bG extends bo{constructor(e,n,r,s,i,o,a,l,c,u){super(e,n,r,s,i,o,a,c,u),this.spec=l}update(e,n,r,s){if(this.dirty==Ds)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let i=this.spec.update(e,n,r);return i&&this.updateInner(e,n,r,s),i}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,r,s)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,r,s){this.spec.setSelection?this.spec.setSelection(e,n,r.root):super.setSelection(e,n,r,s)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function PL(t,e,n){let r=t.firstChild,s=!1;for(let i=0;i<e.length;i++){let o=e[i],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=_I(r),s=!0;r=r.nextSibling}else s=!0,t.insertBefore(a,r);if(o instanceof tl){let l=r?r.previousSibling:t.lastChild;PL(o.contentDOM,o.children,n),r=l?l.nextSibling:t.firstChild}}for(;r;)r=_I(r),s=!0;s&&n.trackWrites==t&&(n.trackWrites=null)}const Sh=function(t){t&&(this.nodeName=t)};Sh.prototype=Object.create(null);const ya=[new Sh];function z1(t,e,n){if(t.length==0)return ya;let r=n?ya[0]:new Sh,s=[r];for(let i=0;i<t.length;i++){let o=t[i].type.attrs;if(o){o.nodeName&&s.push(r=new Sh(o.nodeName));for(let a in o){let l=o[a];l!=null&&(n&&s.length==1&&s.push(r=new Sh(e.isInline?"span":"div")),a=="class"?r.class=(r.class?r.class+" ":"")+l:a=="style"?r.style=(r.style?r.style+";":"")+l:a!="nodeName"&&(r[a]=l))}}}return s}function ML(t,e,n,r){if(n==ya&&r==ya)return e;let s=e;for(let i=0;i<r.length;i++){let o=r[i],a=n[i];if(i){let l;a&&a.nodeName==o.nodeName&&s!=t&&(l=s.parentNode)&&l.nodeName.toLowerCase()==o.nodeName||(l=document.createElement(o.nodeName),l.pmIsDeco=!0,l.appendChild(s),a=ya[0]),s=l}TG(s,a||ya[0],o)}return s}function TG(t,e,n){for(let r in e)r!="class"&&r!="style"&&r!="nodeName"&&!(r in n)&&t.removeAttribute(r);for(let r in n)r!="class"&&r!="style"&&r!="nodeName"&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let i=0;i<r.length;i++)s.indexOf(r[i])==-1&&t.classList.remove(r[i]);for(let i=0;i<s.length;i++)r.indexOf(s[i])==-1&&t.classList.add(s[i]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,s;for(;s=r.exec(e.style);)t.style.removeProperty(s[1])}n.style&&(t.style.cssText+=n.style)}}function OL(t,e,n){return ML(t,t,ya,z1(e,n,t.nodeType!=1))}function ng(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function _I(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class EG{constructor(e,n,r){this.lock=n,this.view=r,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=SG(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let r=e;r<n;r++)this.top.children[r].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,r){let s=0,i=this.stack.length>>1,o=Math.min(i,e.length);for(;s<o&&(s==i-1?this.top:this.stack[s+1<<1]).matchesMark(e[s])&&e[s].type.spec.spanning!==!1;)s++;for(;s<i;)this.destroyRest(),this.top.dirty=Vr,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<e.length;){this.stack.push(this.top,this.index+1);let a=-1;for(let l=this.index;l<Math.min(this.index+3,this.top.children.length);l++){let c=this.top.children[l];if(c.matchesMark(e[i])&&!this.isLocked(c.dom)){a=l;break}}if(a>-1)a>this.index&&(this.changed=!0,this.destroyBetween(this.index,a)),this.top=this.top.children[this.index];else{let l=tl.create(this.top,e[i],n,r);this.top.children.splice(this.index,0,l),this.top=l,this.changed=!0}this.index=0,i++}}findNodeMatch(e,n,r,s){let i=-1,o;if(s>=this.preMatch.index&&(o=this.preMatch.matches[s-this.preMatch.index]).parent==this.top&&o.matchesNode(e,n,r))i=this.top.children.indexOf(o,this.index);else for(let a=this.index,l=Math.min(this.top.children.length,a+5);a<l;a++){let c=this.top.children[a];if(c.matchesNode(e,n,r)&&!this.preMatch.matched.has(c)){i=a;break}}return i<0?!1:(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,n,r,s,i){let o=this.top.children[s];return o.dirty==Ds&&o.dom==o.contentDOM&&(o.dirty=ga),o.update(e,n,r,i)?(this.destroyBetween(this.index,s),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let r=e.pmViewDesc;if(r){for(let s=this.index;s<this.top.children.length;s++)if(this.top.children[s]==r)return s}return-1}e=n}}updateNextNode(e,n,r,s,i,o){for(let a=this.index;a<this.top.children.length;a++){let l=this.top.children[a];if(l instanceof bo){let c=this.preMatch.matched.get(l);if(c!=null&&c!=i)return!1;let u=l.dom,h,d=this.isLocked(u)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=Ds&&ng(n,l.outerDeco));if(!d&&l.update(e,n,r,s))return this.destroyBetween(this.index,a),l.dom!=u&&(this.changed=!0),this.index++,!0;if(!d&&(h=this.recreateWrapper(l,e,n,r,s,o)))return this.destroyBetween(this.index,a),this.top.children[this.index]=h,h.contentDOM&&(h.dirty=ga,h.updateChildren(s,o+1),h.dirty=Vr),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,r,s,i,o){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!ng(r,e.outerDeco)||!s.eq(e.innerDeco))return null;let a=bo.create(this.top,n,r,s,i,o);if(a.contentDOM){a.children=e.children,e.children=[];for(let l of a.children)l.parent=a}return e.destroy(),a}addNode(e,n,r,s,i){let o=bo.create(this.top,e,n,r,s,i);o.contentDOM&&o.updateChildren(s,i+1),this.top.children.splice(this.index++,0,o),this.changed=!0}placeWidget(e,n,r){let s=this.index<this.top.children.length?this.top.children[this.index]:null;if(s&&s.matchesWidget(e)&&(e==s.widget||!s.widget.type.toDOM.parentNode))this.index++;else{let i=new RL(this.top,e,n,r);this.top.children.splice(this.index++,0,i),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof tl;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof qy)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((Dn||an)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let r=document.createElement(e);e=="IMG"&&(r.className="ProseMirror-separator",r.alt=""),e=="BR"&&(r.className="ProseMirror-trailingBreak");let s=new NL(this.top,[],r,null);n!=this.top?n.children.push(s):n.children.splice(this.index++,0,s),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}}function SG(t,e){let n=e,r=n.children.length,s=t.childCount,i=new Map,o=[];e:for(;s>0;){let a;for(;;)if(r){let c=n.children[r-1];if(c instanceof tl)n=c,r=c.children.length;else{a=c,r--;break}}else{if(n==e)break e;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function kG(t,e){return t.type.side-e.type.side}function CG(t,e,n,r){let s=e.locals(t),i=0;if(s.length==0){for(let c=0;c<t.childCount;c++){let u=t.child(c);r(u,s,e.forChild(i,u),c),i+=u.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let u,h;for(;o<s.length&&s[o].to==i;){let v=s[o++];v.widget&&(u?(h||(h=[u])).push(v):u=v)}if(u)if(h){h.sort(kG);for(let v=0;v<h.length;v++)n(h[v],c,!!l)}else n(u,c,!!l);let d,f;if(l)f=-1,d=l,l=null;else if(c<t.childCount)f=c,d=t.child(c++);else break;for(let v=0;v<a.length;v++)a[v].to<=i&&a.splice(v--,1);for(;o<s.length&&s[o].from<=i&&s[o].to>i;)a.push(s[o++]);let g=i+d.nodeSize;if(d.isText){let v=g;o<s.length&&s[o].from<v&&(v=s[o].from);for(let w=0;w<a.length;w++)a[w].to<v&&(v=a[w].to);v<g&&(l=d.cut(v-i),d=d.cut(0,v-i),g=v,f=-1)}else for(;o<s.length&&s[o].to<g;)o++;let y=d.isInline&&!d.isLeaf?a.filter(v=>!v.inline):a.slice();r(d,y,e.forChild(i,d),f),i=g}}function IG(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function AG(t,e,n,r){for(let s=0,i=0;s<t.childCount&&i<=r;){let o=t.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let l=o.text;for(;s<t.childCount;){let c=t.child(s++);if(i+=c.nodeSize,!c.isText)break;l+=c.text}if(i>=n){if(i>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let c=a<r?l.lastIndexOf(e,r-a-1):-1;if(c>=0&&c+e.length+a>=n)return a+c;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}function $1(t,e,n,r,s){let i=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,u=a+=l.size;c>=n||u<=e?i.push(l):(c<e&&i.push(l.slice(0,e-c,r)),s&&(i.push(s),s=void 0),u>n&&i.push(l.slice(n-c,l.size,r)))}return i}function Ub(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),i=s&&s.size==0,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a=r.resolve(o),l,c;if(Wy(n)){for(l=o;s&&!s.node;)s=s.parent;let h=s.node;if(s&&h.isAtom&&_e.isSelectable(h)&&s.parent&&!(h.isInline&&nG(n.focusNode,n.focusOffset,s.dom))){let d=s.posBefore;c=new _e(o==d?a:r.resolve(d))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let h=o,d=o;for(let f=0;f<n.rangeCount;f++){let g=n.getRangeAt(f);h=Math.min(h,t.docView.posFromDOM(g.startContainer,g.startOffset,1)),d=Math.max(d,t.docView.posFromDOM(g.endContainer,g.endOffset,-1))}if(h<0)return null;[l,o]=d==t.state.selection.anchor?[d,h]:[h,d],a=r.resolve(o)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let u=r.resolve(l);if(!c){let h=e=="pointer"||t.state.selection.head<a.pos&&!i?1:-1;c=zb(t,u,a,h)}return c}function DL(t){return t.editable?t.hasFocus():jL(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function ci(t,e=!1){let n=t.state.selection;if(LL(t,n),!!DL(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&an){let r=t.domSelectionRange(),s=t.domObserver.currentSelection;if(r.anchorNode&&s.anchorNode&&el(r.anchorNode,r.anchorOffset,s.anchorNode,s.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)NG(t);else{let{anchor:r,head:s}=n,i,o;xI&&!(n instanceof be)&&(n.$from.parent.inlineContent||(i=bI(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(o=bI(t,n.to))),t.docView.setSelection(r,s,t,e),xI&&(i&&TI(i),o&&TI(o)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&RG(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const xI=Dn||an&&bL<63;function bI(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(Dn&&s&&s.contentEditable=="false")return C0(s);if((!s||s.contentEditable=="false")&&(!i||i.contentEditable=="false")){if(s)return C0(s);if(i)return C0(i)}}function C0(t){return t.contentEditable="true",Dn&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function TI(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function RG(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=r||n.anchorOffset!=s)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!DL(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function NG(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,r=n.nodeName=="IMG";r?e.collapse(n.parentNode,vn(n)+1):e.collapse(n,0),!r&&!t.state.selection.visible&&ir&&xo<=11&&(n.disabled=!0,n.disabled=!1)}function LL(t,e){if(e instanceof _e){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(EI(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else EI(t)}function EI(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function zb(t,e,n,r){return t.someProp("createSelectionBetween",s=>s(t,e,n))||be.between(e,n,r)}function SI(t){return t.editable&&!t.hasFocus()?!1:jL(t)}function jL(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function PG(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return el(e.node,e.offset,n.anchorNode,n.anchorOffset)}function H1(t,e){let{$anchor:n,$head:r}=t.selection,s=e>0?n.max(r):n.min(r),i=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return i&&ke.findFrom(i,e)}function zi(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function kI(t,e,n){let r=t.state.selection;if(r instanceof be)if(n.indexOf("s")>-1){let{$head:s}=r,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let o=t.state.doc.resolve(s.pos+i.nodeSize*(e<0?-1:1));return zi(t,new be(r.$anchor,o))}else if(r.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let s=H1(t.state,e);return s&&s instanceof _e?zi(t,s):!1}else if(!(Ir&&n.indexOf("m")>-1)){let s=r.$head,i=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter,o;if(!i||i.isText)return!1;let a=e<0?s.pos-i.nodeSize:s.pos;return i.isAtom||(o=t.docView.descAt(a))&&!o.contentDOM?_e.isSelectable(i)?zi(t,new _e(e<0?t.state.doc.resolve(s.pos-i.nodeSize):s)):Yd?zi(t,new be(t.state.doc.resolve(e<0?a:a+i.nodeSize))):!1:!1}}else return!1;else{if(r instanceof _e&&r.node.isInline)return zi(t,new be(e>0?r.$to:r.$from));{let s=H1(t.state,e);return s?zi(t,s):!1}}}function rg(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function kh(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function Il(t,e){return e<0?MG(t):OG(t)}function MG(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s,i,o=!1;for(jr&&n.nodeType==1&&r<rg(n)&&kh(n.childNodes[r],-1)&&(o=!0);;)if(r>0){if(n.nodeType!=1)break;{let a=n.childNodes[r-1];if(kh(a,-1))s=n,i=--r;else if(a.nodeType==3)n=a,r=n.nodeValue.length;else break}}else{if(VL(n))break;{let a=n.previousSibling;for(;a&&kh(a,-1);)s=n.parentNode,i=vn(a),a=a.previousSibling;if(a)n=a,r=rg(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?W1(t,n,r):s&&W1(t,s,i)}function OG(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let s=rg(n),i,o;for(;;)if(r<s){if(n.nodeType!=1)break;let a=n.childNodes[r];if(kh(a,1))i=n,o=++r;else break}else{if(VL(n))break;{let a=n.nextSibling;for(;a&&kh(a,1);)i=a.parentNode,o=vn(a)+1,a=a.nextSibling;if(a)n=a,r=0,s=rg(n);else{if(n=n.parentNode,n==t.dom)break;r=s=0}}}i&&W1(t,i,o)}function VL(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function DG(t,e){for(;t&&e==t.childNodes.length&&!Xd(t);)e=vn(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function LG(t,e){for(;t&&!e&&!Xd(t);)e=vn(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function W1(t,e,n){if(e.nodeType!=3){let i,o;(o=DG(e,n))?(e=o,n=0):(i=LG(e,n))&&(e=i,n=i.nodeValue.length)}let r=t.domSelection();if(!r)return;if(Wy(r)){let i=document.createRange();i.setEnd(e,n),i.setStart(e,n),r.removeAllRanges(),r.addRange(i)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:s}=t;setTimeout(()=>{t.state==s&&ci(t)},50)}function CI(t,e){let n=t.state.doc.resolve(e);if(!(an||TL)&&n.parent.inlineContent){let s=t.coordsAtPos(e);if(e>n.start()){let i=t.coordsAtPos(e-1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left<s.left?"ltr":"rtl"}if(e<n.end()){let i=t.coordsAtPos(e+1),o=(i.top+i.bottom)/2;if(o>s.top&&o<s.bottom&&Math.abs(i.left-s.left)>1)return i.left>s.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function II(t,e,n){let r=t.state.selection;if(r instanceof be&&!r.empty||n.indexOf("s")>-1||Ir&&n.indexOf("m")>-1)return!1;let{$from:s,$to:i}=r;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let o=H1(t.state,e);if(o&&o instanceof _e)return zi(t,o)}if(!s.parent.inlineContent){let o=e<0?s:i,a=r instanceof yr?ke.near(o,e):ke.findFrom(o,e);return a?zi(t,a):!1}return!1}function AI(t,e){if(!(t.state.selection instanceof be))return!0;let{$head:n,$anchor:r,empty:s}=t.state.selection;if(!n.sameParent(r))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let i=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(i&&!i.isText){let o=t.state.tr;return e<0?o.delete(n.pos-i.nodeSize,n.pos):o.delete(n.pos,n.pos+i.nodeSize),t.dispatch(o),!0}return!1}function RI(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function jG(t){if(!Dn||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let r=e.firstChild;RI(t,r,"true"),setTimeout(()=>RI(t,r,"false"),20)}return!1}function VG(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function FG(t,e){let n=e.keyCode,r=VG(e);if(n==8||Ir&&n==72&&r=="c")return AI(t,-1)||Il(t,-1);if(n==46&&!e.shiftKey||Ir&&n==68&&r=="c")return AI(t,1)||Il(t,1);if(n==13||n==27)return!0;if(n==37||Ir&&n==66&&r=="c"){let s=n==37?CI(t,t.state.selection.from)=="ltr"?-1:1:-1;return kI(t,s,r)||Il(t,s)}else if(n==39||Ir&&n==70&&r=="c"){let s=n==39?CI(t,t.state.selection.from)=="ltr"?1:-1:1;return kI(t,s,r)||Il(t,s)}else{if(n==38||Ir&&n==80&&r=="c")return II(t,-1,r)||Il(t,-1);if(n==40||Ir&&n==78&&r=="c")return jG(t)||II(t,1,r)||Il(t,1);if(r==(Ir?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function $b(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:r,openStart:s,openEnd:i}=e;for(;s>1&&i>1&&r.childCount==1&&r.firstChild.childCount==1;){s--,i--;let f=r.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),r=f.content}let o=t.someProp("clipboardSerializer")||dl.fromSchema(t.state.schema),a=HL(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c=l.firstChild,u,h=0;for(;c&&c.nodeType==1&&(u=$L[c.nodeName.toLowerCase()]);){for(let f=u.length-1;f>=0;f--){let g=a.createElement(u[f]);for(;l.firstChild;)g.appendChild(l.firstChild);l.appendChild(g),h++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${s} ${i}${h?` -${h}`:""} ${JSON.stringify(n)}`);let d=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:d,slice:e}}function FL(t,e,n,r,s){let i=s.parent.type.spec.code,o,a;if(!n&&!e)return null;let l=!!e&&(r||i||!n);if(l){if(t.someProp("transformPastedText",d=>{e=d(e,i||r,t)}),i)return a=new ue(te.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",d=>{a=d(a,t,!0)}),a;let h=t.someProp("clipboardTextParser",d=>d(e,s,r,t));if(h)a=h;else{let d=s.marks(),{schema:f}=t.state,g=dl.fromSchema(f);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(y=>{let v=o.appendChild(document.createElement("p"));y&&v.appendChild(g.serializeNode(f.text(y,d)))})}}else t.someProp("transformPastedHTML",h=>{n=h(n,t)}),o=$G(n),Yd&&HG(o);let c=o&&o.querySelector("[data-pm-slice]"),u=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(u&&u[3])for(let h=+u[3];h>0;h--){let d=o.firstChild;for(;d&&d.nodeType!=1;)d=d.nextSibling;if(!d)break;o=d}if(a||(a=(t.someProp("clipboardParser")||t.someProp("domParser")||_o.fromSchema(t.state.schema)).parseSlice(o,{preserveWhitespace:!!(l||u),context:s,ruleFromNode(d){return d.nodeName=="BR"&&!d.nextSibling&&d.parentNode&&!BG.test(d.parentNode.nodeName)?{ignore:!0}:null}})),u)a=WG(NI(a,+u[1],+u[2]),u[4]);else if(a=ue.maxOpen(UG(a.content,s),!0),a.openStart||a.openEnd){let h=0,d=0;for(let f=a.content.firstChild;h<a.openStart&&!f.type.spec.isolating;h++,f=f.firstChild);for(let f=a.content.lastChild;d<a.openEnd&&!f.type.spec.isolating;d++,f=f.lastChild);a=NI(a,h,d)}return t.someProp("transformPasted",h=>{a=h(a,t,l)}),a}const BG=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function UG(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.index(n)),i,o=[];if(t.forEach(a=>{if(!o)return;let l=s.findWrapping(a.type),c;if(!l)return o=null;if(c=o.length&&i.length&&UL(l,i,a,o[o.length-1],0))o[o.length-1]=c;else{o.length&&(o[o.length-1]=zL(o[o.length-1],i.length));let u=BL(a,l);o.push(u),s=s.matchType(u.type),i=l}}),o)return te.from(o)}return t}function BL(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,te.from(t));return t}function UL(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let i=UL(t,e,n,r.lastChild,s+1);if(i)return r.copy(r.content.replaceChild(r.childCount-1,i));if(r.contentMatchAt(r.childCount).matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(te.from(BL(n,t,s+1))))}}function zL(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,zL(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(te.empty,!0);return t.copy(n.append(r))}function q1(t,e,n,r,s,i){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(i=0),s<r-1&&(a=q1(a,e,n,r,s+1,i)),s>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,i<=s).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(te.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function NI(t,e,n){return e<t.openStart&&(t=new ue(q1(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new ue(q1(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const $L={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let PI=null;function HL(){return PI||(PI=document.implementation.createHTMLDocument("title"))}let I0=null;function zG(t){let e=window.trustedTypes;return e?(I0||(I0=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),I0.createHTML(t)):t}function $G(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=HL().createElement("div"),r=/<([a-z][^>\s]+)/i.exec(t),s;if((s=r&&$L[r[1].toLowerCase()])&&(t=s.map(i=>"<"+i+">").join("")+t+s.map(i=>"</"+i+">").reverse().join("")),n.innerHTML=zG(t),s)for(let i=0;i<s.length;i++)n=n.querySelector(s[i])||n;return n}function HG(t){let e=t.querySelectorAll(an?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];r.childNodes.length==1&&r.textContent==""&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function WG(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,r;try{r=JSON.parse(e)}catch{return t}let{content:s,openStart:i,openEnd:o}=t;for(let a=r.length-2;a>=0;a-=2){let l=n.nodes[r[a]];if(!l||l.hasRequiredAttrs())break;s=te.from(l.create(r[a+1],s)),i++,o++}return new ue(s,i,o)}const $n={},Hn={},qG={touchstart:!0,touchmove:!0};class KG{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function GG(t){for(let e in $n){let n=$n[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=r=>{JG(t,r)&&!Hb(t,r)&&(t.editable||!(r.type in Hn))&&n(t,r)},qG[e]?{passive:!0}:void 0)}Dn&&t.dom.addEventListener("input",()=>null),K1(t)}function io(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function QG(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function K1(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=r=>Hb(t,r))})}function Hb(t,e){return t.someProp("handleDOMEvents",n=>{let r=n[e.type];return r?r(t,e)||e.defaultPrevented:!1})}function JG(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function XG(t,e){!Hb(t,e)&&$n[e.type]&&(t.editable||!(e.type in Hn))&&$n[e.type](t,e)}Hn.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!qL(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!(ri&&an&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),$c&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let r=Date.now();t.input.lastIOSEnter=r,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==r&&(t.someProp("handleKeyDown",s=>s(t,ca(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",r=>r(t,n))||FG(t,n)?n.preventDefault():io(t,"key")};Hn.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Hn.keypress=(t,e)=>{let n=e;if(qL(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Ir&&n.metaKey)return;if(t.someProp("handleKeyPress",s=>s(t,n))){n.preventDefault();return}let r=t.state.selection;if(!(r instanceof be)||!r.$from.sameParent(r.$to)){let s=String.fromCharCode(n.charCode),i=()=>t.state.tr.insertText(s).scrollIntoView();!/[\r\n]/.test(s)&&!t.someProp("handleTextInput",o=>o(t,r.$from.pos,r.$to.pos,s,i))&&t.dispatch(i()),n.preventDefault()}};function Ky(t){return{left:t.clientX,top:t.clientY}}function YG(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function Wb(t,e,n,r,s){if(r==-1)return!1;let i=t.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(t.someProp(e,a=>o>i.depth?a(t,n,i.nodeAfter,i.before(o),s,!0):a(t,n,i.node(o),i.before(o),s,!1)))return!0;return!1}function gc(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let r=t.state.tr.setSelection(e);r.setMeta("pointer",!0),t.dispatch(r)}function ZG(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return r&&r.isAtom&&_e.isSelectable(r)?(gc(t,new _e(n)),!0):!1}function eQ(t,e){if(e==-1)return!1;let n=t.state.selection,r,s;n instanceof _e&&(r=n.node);let i=t.state.doc.resolve(e);for(let o=i.depth+1;o>0;o--){let a=o>i.depth?i.nodeAfter:i.node(o);if(_e.isSelectable(a)){r&&n.$from.depth>0&&o>=n.$from.depth&&i.before(n.$from.depth+1)==n.$from.pos?s=i.before(n.$from.depth):s=i.before(o);break}}return s!=null?(gc(t,_e.create(t.state.doc,s)),!0):!1}function tQ(t,e,n,r,s){return Wb(t,"handleClickOn",e,n,r)||t.someProp("handleClick",i=>i(t,e,r))||(s?eQ(t,n):ZG(t,n))}function nQ(t,e,n,r){return Wb(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",s=>s(t,e,r))}function rQ(t,e,n,r){return Wb(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",s=>s(t,e,r))||sQ(t,n,r)}function sQ(t,e,n){if(n.button!=0)return!1;let r=t.state.doc;if(e==-1)return r.inlineContent?(gc(t,be.create(r,0,r.content.size)),!0):!1;let s=r.resolve(e);for(let i=s.depth+1;i>0;i--){let o=i>s.depth?s.nodeAfter:s.node(i),a=s.before(i);if(o.inlineContent)gc(t,be.create(r,a+1,a+1+o.content.size));else if(_e.isSelectable(o))gc(t,_e.create(r,a));else continue;return!0}}function qb(t){return sg(t)}const WL=Ir?"metaKey":"ctrlKey";$n.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=qb(t),s=Date.now(),i="singleClick";s-t.input.lastClick.time<500&&YG(n,t.input.lastClick)&&!n[WL]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?i="doubleClick":t.input.lastClick.type=="doubleClick"&&(i="tripleClick")),t.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i,button:n.button};let o=t.posAtCoords(Ky(n));o&&(i=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new iQ(t,o,n,!!r)):(i=="doubleClick"?nQ:rQ)(t,o.pos,o.inside,n)?n.preventDefault():io(t,"pointer"))};class iQ{constructor(e,n,r,s){this.view=e,this.pos=n,this.event=r,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!r[WL],this.allowDefault=r.shiftKey;let i,o;if(n.inside>-1)i=e.state.doc.nodeAt(n.inside),o=n.inside;else{let u=e.state.doc.resolve(n.pos);i=u.parent,o=u.depth?u.before():0}const a=s?null:r.target,l=a?e.docView.nearestDesc(a,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(r.button==0&&i.type.spec.draggable&&i.type.spec.selectable!==!1||c instanceof _e&&c.from<=o&&c.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&jr&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),io(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>ci(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Ky(e))),this.updateAllowDefault(e),this.allowDefault||!n?io(this.view,"pointer"):tQ(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||Dn&&this.mightDrag&&!this.mightDrag.node.isAtom||an&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(gc(this.view,ke.near(this.view.state.doc.resolve(n.pos))),e.preventDefault()):io(this.view,"pointer")}move(e){this.updateAllowDefault(e),io(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}$n.touchstart=t=>{t.input.lastTouch=Date.now(),qb(t),io(t,"pointer")};$n.touchmove=t=>{t.input.lastTouch=Date.now(),io(t,"pointer")};$n.contextmenu=t=>qb(t);function qL(t,e){return t.composing?!0:Dn&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}const oQ=ri?5e3:-1;Hn.compositionstart=Hn.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof be&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(r=>r.type.spec.inclusive===!1)||an&&TL&&aQ(t)))t.markCursor=t.state.storedMarks||n.marks(),sg(t,!0),t.markCursor=null;else if(sg(t,!e.selection.empty),jr&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let r=t.domSelectionRange();for(let s=r.focusNode,i=r.focusOffset;s&&s.nodeType==1&&i!=0;){let o=i<0?s.lastChild:s.childNodes[i-1];if(!o)break;if(o.nodeType==3){let a=t.domSelection();a&&a.collapse(o,o.nodeValue.length);break}else s=o,i=-1}}t.input.composing=!0}KL(t,oQ)};function aQ(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let r=e.childNodes[n];return r.nodeType==1&&r.contentEditable=="false"}Hn.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,KL(t,20))};function KL(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>sg(t),e))}function GL(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=cQ());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function lQ(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=eG(e.focusNode,e.focusOffset),r=tG(e.focusNode,e.focusOffset);if(n&&r&&n!=r){let s=r.pmViewDesc,i=t.domObserver.lastChangedTextNode;if(n==i||r==i)return i;if(!s||!s.isText(r.nodeValue))return r;if(t.input.compositionNode==r){let o=n.pmViewDesc;if(!(!o||!o.isText(n.nodeValue)))return r}}return n||r}function cQ(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function sg(t,e=!1){if(!(ri&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),GL(t),e||t.docView&&t.docView.dirty){let n=Ub(t),r=t.state.selection;return n&&!n.eq(r)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!r.$from.node(r.$from.sharedDepth(r.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function uQ(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}const yd=ir&&xo<15||$c&&iG<604;$n.copy=Hn.cut=(t,e)=>{let n=e,r=t.state.selection,s=n.type=="cut";if(r.empty)return;let i=yd?null:n.clipboardData,o=r.content(),{dom:a,text:l}=$b(t,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",l)):uQ(t,a),s&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function hQ(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function dQ(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let s=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?vd(t,r.value,null,s,e):vd(t,r.textContent,r.innerHTML,s,e)},50)}function vd(t,e,n,r,s){let i=FL(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,s,i||ue.empty)))return!0;if(!i)return!1;let o=hQ(i),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(i);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function QL(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Hn.paste=(t,e)=>{let n=e;if(t.composing&&!ri)return;let r=yd?null:n.clipboardData,s=t.input.shiftKey&&t.input.lastKeyCode!=45;r&&vd(t,QL(r),r.getData("text/html"),s,n)?n.preventDefault():dQ(t,n)};class JL{constructor(e,n,r){this.slice=e,this.move=n,this.node=r}}const fQ=Ir?"altKey":"ctrlKey";function XL(t,e){let n=t.someProp("dragCopies",r=>!r(e));return n??!e[fQ]}$n.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let s=t.state.selection,i=s.empty?null:t.posAtCoords(Ky(n)),o;if(!(i&&i.pos>=s.from&&i.pos<=(s instanceof _e?s.to-1:s.to))){if(r&&r.mightDrag)o=_e.create(t.state.doc,r.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let h=t.docView.nearestDesc(n.target,!0);h&&h.node.type.spec.draggable&&h!=t.docView&&(o=_e.create(t.state.doc,h.posBefore))}}let a=(o||t.state.selection).content(),{dom:l,text:c,slice:u}=$b(t,a);(!n.dataTransfer.files.length||!an||bL>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(yd?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",yd||n.dataTransfer.setData("text/plain",c),t.dragging=new JL(u,XL(t,n),o)};$n.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Hn.dragover=Hn.dragenter=(t,e)=>e.preventDefault();Hn.drop=(t,e)=>{try{pQ(t,e,t.dragging)}finally{t.dragging=null}};function pQ(t,e,n){if(!e.dataTransfer)return;let r=t.posAtCoords(Ky(e));if(!r)return;let s=t.state.doc.resolve(r.pos),i=n&&n.slice;i?t.someProp("transformPasted",f=>{i=f(i,t,!1)}):i=FL(t,QL(e.dataTransfer),yd?null:e.dataTransfer.getData("text/html"),!1,s);let o=!!(n&&XL(t,e));if(t.someProp("handleDrop",f=>f(t,e,i||ue.empty,o))){e.preventDefault();return}if(!i)return;e.preventDefault();let a=i?tL(t.state.doc,s.pos,i):s.pos;a==null&&(a=s.pos);let l=t.state.tr;if(o){let{node:f}=n;f?f.replace(l):l.deleteSelection()}let c=l.mapping.map(a),u=i.openStart==0&&i.openEnd==0&&i.content.childCount==1,h=l.doc;if(u?l.replaceRangeWith(c,c,i.content.firstChild):l.replaceRange(c,c,i),l.doc.eq(h))return;let d=l.doc.resolve(c);if(u&&_e.isSelectable(i.content.firstChild)&&d.nodeAfter&&d.nodeAfter.sameMarkup(i.content.firstChild))l.setSelection(new _e(d));else{let f=l.mapping.map(a);l.mapping.maps[l.mapping.maps.length-1].forEach((g,y,v,w)=>f=w),l.setSelection(zb(t,d,l.doc.resolve(f)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}$n.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&ci(t)},20))};$n.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};$n.beforeinput=(t,e)=>{if(an&&ri&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:r}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=r||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",i=>i(t,ca(8,"Backspace")))))return;let{$cursor:s}=t.state.selection;s&&s.pos>0&&t.dispatch(t.state.tr.delete(s.pos-1,s.pos).scrollIntoView())},50)}};for(let t in Hn)$n[t]=Hn[t];function wd(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class ig{constructor(e,n){this.toDOM=e,this.spec=n||Na,this.side=this.spec.side||0}map(e,n,r,s){let{pos:i,deleted:o}=e.mapResult(n.from+s,this.side<0?-1:1);return o?null:new ln(i-r,i-r,this)}valid(){return!0}eq(e){return this==e||e instanceof ig&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&wd(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class To{constructor(e,n){this.attrs=e,this.spec=n||Na}map(e,n,r,s){let i=e.map(n.from+s,this.spec.inclusiveStart?-1:1)-r,o=e.map(n.to+s,this.spec.inclusiveEnd?1:-1)-r;return i>=o?null:new ln(i,o,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof To&&wd(this.attrs,e.attrs)&&wd(this.spec,e.spec)}static is(e){return e.type instanceof To}destroy(){}}class Kb{constructor(e,n){this.attrs=e,this.spec=n||Na}map(e,n,r,s){let i=e.mapResult(n.from+s,1);if(i.deleted)return null;let o=e.mapResult(n.to+s,-1);return o.deleted||o.pos<=i.pos?null:new ln(i.pos-r,o.pos-r,this)}valid(e,n){let{index:r,offset:s}=e.content.findIndex(n.from),i;return s==n.from&&!(i=e.child(r)).isText&&s+i.nodeSize==n.to}eq(e){return this==e||e instanceof Kb&&wd(this.attrs,e.attrs)&&wd(this.spec,e.spec)}destroy(){}}class ln{constructor(e,n,r){this.from=e,this.to=n,this.type=r}copy(e,n){return new ln(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,r){return this.type.map(e,this,n,r)}static widget(e,n,r){return new ln(e,e,new ig(n,r))}static inline(e,n,r,s){return new ln(e,n,new To(r,s))}static node(e,n,r,s){return new ln(e,n,new Kb(r,s))}get spec(){return this.type.spec}get inline(){return this.type instanceof To}get widget(){return this.type instanceof ig}}const Dl=[],Na={};class it{constructor(e,n){this.local=e.length?e:Dl,this.children=n.length?n:Dl}static create(e,n){return n.length?og(n,e,0,Na):In}find(e,n,r){let s=[];return this.findInner(e??0,n??1e9,s,0,r),s}findInner(e,n,r,s,i){for(let o=0;o<this.local.length;o++){let a=this.local[o];a.from<=n&&a.to>=e&&(!i||i(a.spec))&&r.push(a.copy(a.from+s,a.to+s))}for(let o=0;o<this.children.length;o+=3)if(this.children[o]<n&&this.children[o+1]>e){let a=this.children[o]+1;this.children[o+2].findInner(e-a,n-a,r,s+a,i)}}map(e,n,r){return this==In||e.maps.length==0?this:this.mapInner(e,n,0,0,r||Na)}mapInner(e,n,r,s,i){let o;for(let a=0;a<this.local.length;a++){let l=this.local[a].map(e,r,s);l&&l.type.valid(n,l)?(o||(o=[])).push(l):i.onRemove&&i.onRemove(this.local[a].spec)}return this.children.length?mQ(this.children,o||[],e,n,r,s,i):o?new it(o.sort(Pa),Dl):In}add(e,n){return n.length?this==In?it.create(e,n):this.addInner(e,n,0):this}addInner(e,n,r){let s,i=0;e.forEach((a,l)=>{let c=l+r,u;if(u=ZL(n,a,c)){for(s||(s=this.children.slice());i<s.length&&s[i]<l;)i+=3;s[i]==l?s[i+2]=s[i+2].addInner(a,u,c+1):s.splice(i,0,l,l+a.nodeSize,og(u,a,c+1,Na)),i+=3}});let o=YL(i?ej(n):n,-r);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||o.splice(a--,1);return new it(o.length?this.local.concat(o).sort(Pa):this.local,s||this.children)}remove(e){return e.length==0||this==In?this:this.removeInner(e,0)}removeInner(e,n){let r=this.children,s=this.local;for(let i=0;i<r.length;i+=3){let o,a=r[i]+n,l=r[i+1]+n;for(let u=0,h;u<e.length;u++)(h=e[u])&&h.from>a&&h.to<l&&(e[u]=null,(o||(o=[])).push(h));if(!o)continue;r==this.children&&(r=this.children.slice());let c=r[i+2].removeInner(o,a+1);c!=In?r[i+2]=c:(r.splice(i,3),i-=3)}if(s.length){for(let i=0,o;i<e.length;i++)if(o=e[i])for(let a=0;a<s.length;a++)s[a].eq(o,n)&&(s==this.local&&(s=this.local.slice()),s.splice(a--,1))}return r==this.children&&s==this.local?this:s.length||r.length?new it(s,r):In}forChild(e,n){if(this==In)return this;if(n.isLeaf)return it.empty;let r,s;for(let a=0;a<this.children.length;a+=3)if(this.children[a]>=e){this.children[a]==e&&(r=this.children[a+2]);break}let i=e+1,o=i+n.content.size;for(let a=0;a<this.local.length;a++){let l=this.local[a];if(l.from<o&&l.to>i&&l.type instanceof To){let c=Math.max(i,l.from)-i,u=Math.min(o,l.to)-i;c<u&&(s||(s=[])).push(l.copy(c,u))}}if(s){let a=new it(s.sort(Pa),Dl);return r?new Xi([a,r]):a}return r||In}eq(e){if(this==e)return!0;if(!(e instanceof it)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return Gb(this.localsInner(e))}localsInner(e){if(this==In)return Dl;if(e.inlineContent||!this.local.some(To.is))return this.local;let n=[];for(let r=0;r<this.local.length;r++)this.local[r].type instanceof To||n.push(this.local[r]);return n}forEachSet(e){e(this)}}it.empty=new it([],[]);it.removeOverlap=Gb;const In=it.empty;class Xi{constructor(e){this.members=e}map(e,n){const r=this.members.map(s=>s.map(e,n,Na));return Xi.from(r)}forChild(e,n){if(n.isLeaf)return it.empty;let r=[];for(let s=0;s<this.members.length;s++){let i=this.members[s].forChild(e,n);i!=In&&(i instanceof Xi?r=r.concat(i.members):r.push(i))}return Xi.from(r)}eq(e){if(!(e instanceof Xi)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,r=!0;for(let s=0;s<this.members.length;s++){let i=this.members[s].localsInner(e);if(i.length)if(!n)n=i;else{r&&(n=n.slice(),r=!1);for(let o=0;o<i.length;o++)n.push(i[o])}}return n?Gb(r?n:n.sort(Pa)):Dl}static from(e){switch(e.length){case 0:return In;case 1:return e[0];default:return new Xi(e.every(n=>n instanceof it)?e:e.reduce((n,r)=>n.concat(r instanceof it?r:r.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}}function mQ(t,e,n,r,s,i,o){let a=t.slice();for(let c=0,u=i;c<n.maps.length;c++){let h=0;n.maps[c].forEach((d,f,g,y)=>{let v=y-g-(f-d);for(let w=0;w<a.length;w+=3){let T=a[w+1];if(T<0||d>T+u-h)continue;let E=a[w]+u-h;f>=E?a[w+1]=d<=E?-2:-1:d>=u&&v&&(a[w]+=v,a[w+1]+=v)}h+=v}),u=n.maps[c].map(u,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(a[c+1]==-2){l=!0,a[c+1]=-1;continue}let u=n.map(t[c]+i),h=u-s;if(h<0||h>=r.content.size){l=!0;continue}let d=n.map(t[c+1]+i,-1),f=d-s,{index:g,offset:y}=r.content.findIndex(h),v=r.maybeChild(g);if(v&&y==h&&y+v.nodeSize==f){let w=a[c+2].mapInner(n,v,u+1,t[c]+i+1,o);w!=In?(a[c]=h,a[c+1]=f,a[c+2]=w):(a[c+1]=-2,l=!0)}else l=!0}if(l){let c=gQ(a,t,e,n,s,i,o),u=og(c,r,0,o);e=u.local;for(let h=0;h<a.length;h+=3)a[h+1]<0&&(a.splice(h,3),h-=3);for(let h=0,d=0;h<u.children.length;h+=3){let f=u.children[h];for(;d<a.length&&a[d]<f;)d+=3;a.splice(d,0,u.children[h],u.children[h+1],u.children[h+2])}}return new it(e.sort(Pa),a)}function YL(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let s=t[r];n.push(new ln(s.from+e,s.to+e,s.type))}return n}function gQ(t,e,n,r,s,i,o){function a(l,c){for(let u=0;u<l.local.length;u++){let h=l.local[u].map(r,s,c);h?n.push(h):o.onRemove&&o.onRemove(l.local[u].spec)}for(let u=0;u<l.children.length;u+=3)a(l.children[u+2],l.children[u]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&a(t[l+2],e[l]+i+1);return n}function ZL(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,s=null;for(let i=0,o;i<t.length;i++)(o=t[i])&&o.from>n&&o.to<r&&((s||(s=[])).push(o),t[i]=null);return s}function ej(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function og(t,e,n,r){let s=[],i=!1;e.forEach((a,l)=>{let c=ZL(t,a,l+n);if(c){i=!0;let u=og(c,a,n+l+1,r);u!=In&&s.push(l,l+a.nodeSize,u)}});let o=YL(i?ej(t):t,-n).sort(Pa);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new it(o,s):In}function Pa(t,e){return t.from-e.from||t.to-e.to}function Gb(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let s=n+1;s<e.length;s++){let i=e[s];if(i.from==r.from){i.to!=r.to&&(e==t&&(e=t.slice()),e[s]=i.copy(i.from,r.to),MI(e,s+1,i.copy(r.to,i.to)));continue}else{i.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,i.from),MI(e,s,r.copy(i.from,r.to)));break}}}return e}function MI(t,e,n){for(;e<t.length&&Pa(n,t[e])>0;)e++;t.splice(e,0,n)}function A0(t){let e=[];return t.someProp("decorations",n=>{let r=n(t.state);r&&r!=In&&e.push(r)}),t.cursorWrapper&&e.push(it.create(t.state.doc,[t.cursorWrapper.deco])),Xi.from(e)}const yQ={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},vQ=ir&&xo<=11;class wQ{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class _Q{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new wQ,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(r=>{for(let s=0;s<r.length;s++)this.queue.push(r[s]);ir&&xo<=11&&r.some(s=>s.type=="childList"&&s.removedNodes.length||s.type=="characterData"&&s.oldValue.length>s.target.nodeValue.length)?this.flushSoon():this.flush()}),vQ&&(this.onCharData=r=>{this.queue.push({target:r.target,type:"characterData",oldValue:r.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,yQ)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(SI(this.view)){if(this.suppressingSelectionUpdates)return ci(this.view);if(ir&&xo<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&el(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,r;for(let i=e.focusNode;i;i=zc(i))n.add(i);for(let i=e.anchorNode;i;i=zc(i))if(n.has(i)){r=i;break}let s=r&&this.view.docView.nearestDesc(r);if(s&&s.ignoreMutation({type:"selection",target:r.nodeType==3?r.parentNode:r}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let r=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(r)&&SI(e)&&!this.ignoreSelectionChange(r),i=-1,o=-1,a=!1,l=[];if(e.editable)for(let u=0;u<n.length;u++){let h=this.registerMutation(n[u],l);h&&(i=i<0?h.from:Math.min(h.from,i),o=o<0?h.to:Math.max(h.to,o),h.typeOver&&(a=!0))}if(jr&&l.length){let u=l.filter(h=>h.nodeName=="BR");if(u.length==2){let[h,d]=u;h.parentNode&&h.parentNode.parentNode==d.parentNode?d.remove():h.remove()}else{let{focusNode:h}=this.currentSelection;for(let d of u){let f=d.parentNode;f&&f.nodeName=="LI"&&(!h||TQ(e,h)!=f)&&d.remove()}}}else if((an||Dn)&&l.some(u=>u.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let u of l)if(u.nodeName=="BR"&&u.parentNode){let h=u.nextSibling;h&&h.nodeType==1&&h.contentEditable=="false"&&u.parentNode.removeChild(u)}}let c=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Wy(r)&&(c=Ub(e))&&c.eq(ke.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,ci(e),this.currentSelection.set(r),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),xQ(e)),this.handleDOMChange(i,o,a,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(r)||ci(e),this.currentSelection.set(r))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let r=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(r==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!r||r.ignoreMutation(e))return null;if(e.type=="childList"){for(let u=0;u<e.addedNodes.length;u++){let h=e.addedNodes[u];n.push(h),h.nodeType==3&&(this.lastChangedTextNode=h)}if(r.contentDOM&&r.contentDOM!=r.dom&&!r.contentDOM.contains(e.target))return{from:r.posBefore,to:r.posAfter};let s=e.previousSibling,i=e.nextSibling;if(ir&&xo<=11&&e.addedNodes.length)for(let u=0;u<e.addedNodes.length;u++){let{previousSibling:h,nextSibling:d}=e.addedNodes[u];(!h||Array.prototype.indexOf.call(e.addedNodes,h)<0)&&(s=h),(!d||Array.prototype.indexOf.call(e.addedNodes,d)<0)&&(i=d)}let o=s&&s.parentNode==e.target?vn(s)+1:0,a=r.localPosFromDOM(e.target,o,-1),l=i&&i.parentNode==e.target?vn(i):e.target.childNodes.length,c=r.localPosFromDOM(e.target,l,1);return{from:a,to:c}}else return e.type=="attributes"?{from:r.posAtStart-r.border,to:r.posAtEnd+r.border}:(this.lastChangedTextNode=e.target,{from:r.posAtStart,to:r.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}}let OI=new WeakMap,DI=!1;function xQ(t){if(!OI.has(t)&&(OI.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=jr,DI)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),DI=!0}}function LI(t,e){let n=e.startContainer,r=e.startOffset,s=e.endContainer,i=e.endOffset,o=t.domAtPos(t.state.selection.anchor);return el(o.node,o.offset,s,i)&&([n,r,s,i]=[s,i,n,r]),{anchorNode:n,anchorOffset:r,focusNode:s,focusOffset:i}}function bQ(t,e){if(e.getComposedRanges){let s=e.getComposedRanges(t.root)[0];if(s)return LI(t,s)}let n;function r(s){s.preventDefault(),s.stopImmediatePropagation(),n=s.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",r,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",r,!0),n?LI(t,n):null}function TQ(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let r=t.docView.nearestDesc(n,!0);if(r&&r.node.isBlock)return n}return null}function EQ(t,e,n){let{node:r,fromOffset:s,toOffset:i,from:o,to:a}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,u=l.anchorNode;if(u&&t.dom.contains(u.nodeType==1?u:u.parentNode)&&(c=[{node:u,offset:l.anchorOffset}],Wy(l)||c.push({node:l.focusNode,offset:l.focusOffset})),an&&t.input.lastKeyCode===8)for(let v=i;v>s;v--){let w=r.childNodes[v-1],T=w.pmViewDesc;if(w.nodeName=="BR"&&!T){i=v;break}if(!T||T.size)break}let h=t.state.doc,d=t.someProp("domParser")||_o.fromSchema(t.state.schema),f=h.resolve(o),g=null,y=d.parse(r,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:s,to:i,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:SQ,context:f});if(c&&c[0].pos!=null){let v=c[0].pos,w=c[1]&&c[1].pos;w==null&&(w=v),g={anchor:v+o,head:w+o}}return{doc:y,sel:g,from:o,to:a}}function SQ(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(Dn&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||Dn&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const kQ=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function CQ(t,e,n,r,s){let i=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let k=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,_=Ub(t,k);if(_&&!t.state.selection.eq(_)){if(an&&ri&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",S=>S(t,ca(13,"Enter"))))return;let x=t.state.tr.setSelection(_);k=="pointer"?x.setMeta("pointer",!0):k=="key"&&x.scrollIntoView(),i&&x.setMeta("composition",i),t.dispatch(x)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l=t.state.selection,c=EQ(t,e,n),u=t.state.doc,h=u.slice(c.from,c.to),d,f;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(d=t.state.selection.to,f="end"):(d=t.state.selection.from,f="start"),t.input.lastKeyCode=null;let g=RQ(h.content,c.doc.content,c.from,d,f);if(g&&t.input.domChangeCount++,($c&&t.input.lastIOSEnter>Date.now()-225||ri)&&s.some(k=>k.nodeType==1&&!kQ.test(k.nodeName))&&(!g||g.endA>=g.endB)&&t.someProp("handleKeyDown",k=>k(t,ca(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!g)if(r&&l instanceof be&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))g={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let k=jI(t,t.state.doc,c.sel);if(k&&!k.eq(t.state.selection)){let _=t.state.tr.setSelection(k);i&&_.setMeta("composition",i),t.dispatch(_)}}return}t.state.selection.from<t.state.selection.to&&g.start==g.endB&&t.state.selection instanceof be&&(g.start>t.state.selection.from&&g.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?g.start=t.state.selection.from:g.endA<t.state.selection.to&&g.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(g.endB+=t.state.selection.to-g.endA,g.endA=t.state.selection.to)),ir&&xo<=11&&g.endB==g.start+1&&g.endA==g.start&&g.start>c.from&&c.doc.textBetween(g.start-c.from-1,g.start-c.from+1)==" "&&(g.start--,g.endA--,g.endB--);let y=c.doc.resolveNoCache(g.start-c.from),v=c.doc.resolveNoCache(g.endB-c.from),w=u.resolve(g.start),T=y.sameParent(v)&&y.parent.inlineContent&&w.end()>=g.endA;if(($c&&t.input.lastIOSEnter>Date.now()-225&&(!T||s.some(k=>k.nodeName=="DIV"||k.nodeName=="P"))||!T&&y.pos<c.doc.content.size&&(!y.sameParent(v)||!y.parent.inlineContent)&&y.pos<v.pos&&!/\S/.test(c.doc.textBetween(y.pos,v.pos,"","")))&&t.someProp("handleKeyDown",k=>k(t,ca(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>g.start&&AQ(u,g.start,g.endA,y,v)&&t.someProp("handleKeyDown",k=>k(t,ca(8,"Backspace")))){ri&&an&&t.domObserver.suppressSelectionUpdates();return}an&&g.endB==g.start&&(t.input.lastChromeDelete=Date.now()),ri&&!T&&y.start()!=v.start()&&v.parentOffset==0&&y.depth==v.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==g.endA&&(g.endB-=2,v=c.doc.resolveNoCache(g.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(k){return k(t,ca(13,"Enter"))})},20));let E=g.start,R=g.endA,P=k=>{let _=k||t.state.tr.replace(E,R,c.doc.slice(g.start-c.from,g.endB-c.from));if(c.sel){let x=jI(t,_.doc,c.sel);x&&!(an&&t.composing&&x.empty&&(g.start!=g.endB||t.input.lastChromeDelete<Date.now()-100)&&(x.head==E||x.head==_.mapping.map(R)-1)||ir&&x.empty&&x.head==E)&&_.setSelection(x)}return i&&_.setMeta("composition",i),_.scrollIntoView()},N;if(T)if(y.pos==v.pos){ir&&xo<=11&&y.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>ci(t),20));let k=P(t.state.tr.delete(E,R)),_=u.resolve(g.start).marksAcross(u.resolve(g.endA));_&&k.ensureMarks(_),t.dispatch(k)}else if(g.endA==g.endB&&(N=IQ(y.parent.content.cut(y.parentOffset,v.parentOffset),w.parent.content.cut(w.parentOffset,g.endA-w.start())))){let k=P(t.state.tr);N.type=="add"?k.addMark(E,R,N.mark):k.removeMark(E,R,N.mark),t.dispatch(k)}else if(y.parent.child(y.index()).isText&&y.index()==v.index()-(v.textOffset?0:1)){let k=y.parent.textBetween(y.parentOffset,v.parentOffset),_=()=>P(t.state.tr.insertText(k,E,R));t.someProp("handleTextInput",x=>x(t,E,R,k,_))||t.dispatch(_())}else t.dispatch(P());else t.dispatch(P())}function jI(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:zb(t,e.resolve(n.anchor),e.resolve(n.head))}function IQ(t,e){let n=t.firstChild.marks,r=e.firstChild.marks,s=n,i=r,o,a,l;for(let u=0;u<r.length;u++)s=r[u].removeFromSet(s);for(let u=0;u<n.length;u++)i=n[u].removeFromSet(i);if(s.length==1&&i.length==0)a=s[0],o="add",l=u=>u.mark(a.addToSet(u.marks));else if(s.length==0&&i.length==1)a=i[0],o="remove",l=u=>u.mark(a.removeFromSet(u.marks));else return null;let c=[];for(let u=0;u<e.childCount;u++)c.push(l(e.child(u)));if(te.from(c).eq(t))return{mark:a,type:o}}function AQ(t,e,n,r,s){if(n-e<=s.pos-r.pos||R0(r,!0,!1)<s.pos)return!1;let i=t.resolve(e);if(!r.parent.isTextblock){let a=i.nodeAfter;return a!=null&&n==e+a.nodeSize}if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=t.resolve(R0(i,!0,!0));return!o.parent.isTextblock||o.pos>n||R0(o,!0,!1)<n?!1:r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function R0(t,e,n){let r=t.depth,s=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,s++,e=!1;if(n){let i=t.node(r).maybeChild(t.indexAfter(r));for(;i&&!i.isLeaf;)i=i.firstChild,s++}return s}function RQ(t,e,n,r,s){let i=t.findDiffStart(e,n);if(i==null)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if(s=="end"){let l=Math.max(0,i-Math.min(o,a));r-=o+l-i}if(o<i&&t.size<e.size){let l=r<=i&&r>=o?i-r:0;i-=l,i&&i<e.size&&VI(e.textBetween(i-1,i+1))&&(i+=l?1:-1),a=i+(a-o),o=i}else if(a<i){let l=r<=i&&r>=a?i-r:0;i-=l,i&&i<t.size&&VI(t.textBetween(i-1,i+1))&&(i+=l?1:-1),o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}function VI(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}class tj{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new KG,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach($I),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=UI(this),BI(this),this.nodeViews=zI(this),this.docView=wI(this.state.doc,FI(this),A0(this),this.dom,this),this.domObserver=new _Q(this,(r,s,i,o)=>CQ(this,r,s,i,o)),this.domObserver.start(),GG(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&K1(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach($I),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let r in this._props)n[r]=this._props[r];n.state=this.state;for(let r in e)n[r]=e[r];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var r;let s=this.state,i=!1,o=!1;e.storedMarks&&this.composing&&(GL(this),o=!0),this.state=e;let a=s.plugins!=e.plugins||this._props.plugins!=n.plugins;if(a||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let f=zI(this);PQ(f,this.nodeViews)&&(this.nodeViews=f,i=!0)}(a||n.handleDOMEvents!=this._props.handleDOMEvents)&&K1(this),this.editable=UI(this),BI(this);let l=A0(this),c=FI(this),u=s.plugins!=e.plugins&&!s.doc.eq(e.doc)?"reset":e.scrollToSelection>s.scrollToSelection?"to selection":"preserve",h=i||!this.docView.matchesNode(e.doc,c,l);(h||!e.selection.eq(s.selection))&&(o=!0);let d=u=="preserve"&&o&&this.dom.style.overflowAnchor==null&&lG(this);if(o){this.domObserver.stop();let f=h&&(ir||an)&&!this.composing&&!s.selection.empty&&!e.selection.empty&&NQ(s.selection,e.selection);if(h){let g=an?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=lQ(this)),(i||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=wI(e.doc,c,l,this.dom,this)),g&&!this.trackWrites&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&PG(this))?ci(this,f):(LL(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(s),!((r=this.dragging)===null||r===void 0)&&r.node&&!s.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,s),u=="reset"?this.dom.scrollTop=0:u=="to selection"?this.scrollToSelection():d&&cG(d)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof _e){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&fI(this,n.getBoundingClientRect(),e)}else fI(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let r=this.directPlugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let r=this.state.plugins[n];r.spec.view&&this.pluginViews.push(r.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let r=this.pluginViews[n];r.update&&r.update(this,e)}}updateDraggedNode(e,n){let r=e.node,s=-1;if(this.state.doc.nodeAt(r.from)==r.node)s=r.from;else{let i=r.from+(this.state.doc.content.size-n.doc.content.size);(i>0&&this.state.doc.nodeAt(i))==r.node&&(s=i)}this.dragging=new JL(e.slice,e.move,s<0?void 0:_e.create(this.state.doc,s))}someProp(e,n){let r=this._props&&this._props[e],s;if(r!=null&&(s=n?n(r):r))return s;for(let o=0;o<this.directPlugins.length;o++){let a=this.directPlugins[o].props[e];if(a!=null&&(s=n?n(a):a))return s}let i=this.state.plugins;if(i)for(let o=0;o<i.length;o++){let a=i[o].props[e];if(a!=null&&(s=n?n(a):a))return s}}hasFocus(){if(ir){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&uG(this.dom),ci(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return mG(this,e)}coordsAtPos(e,n=1){return IL(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,r=-1){let s=this.docView.posFromDOM(e,n,r);if(s==null)throw new RangeError("DOM position not inside the editor");return s}endOfTextblock(e,n){return _G(this,n||this.state,e)}pasteHTML(e,n){return vd(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return vd(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return $b(this,e)}destroy(){this.docView&&(QG(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],A0(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,YK())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return XG(this,e)}domSelectionRange(){let e=this.domSelection();return e?Dn&&this.root.nodeType===11&&rG(this.dom.ownerDocument)==this.dom&&bQ(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}}tj.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function FI(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let r in n)r=="class"?e.class+=" "+n[r]:r=="style"?e.style=(e.style?e.style+";":"")+n[r]:!e[r]&&r!="contenteditable"&&r!="nodeName"&&(e[r]=String(n[r]))}),e.translate||(e.translate="no"),[ln.node(0,t.state.doc.content.size,e)]}function BI(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:ln.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function UI(t){return!t.someProp("editable",e=>e(t.state)===!1)}function NQ(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function zI(t){let e=Object.create(null);function n(r){for(let s in r)Object.prototype.hasOwnProperty.call(e,s)||(e[s]=r[s])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function PQ(t,e){let n=0,r=0;for(let s in t){if(t[s]!=e[s])return!0;n++}for(let s in e)r++;return n!=r}function $I(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var No={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},ag={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},MQ=typeof navigator<"u"&&/Mac/.test(navigator.platform),OQ=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var wn=0;wn<10;wn++)No[48+wn]=No[96+wn]=String(wn);for(var wn=1;wn<=24;wn++)No[wn+111]="F"+wn;for(var wn=65;wn<=90;wn++)No[wn]=String.fromCharCode(wn+32),ag[wn]=String.fromCharCode(wn);for(var N0 in No)ag.hasOwnProperty(N0)||(ag[N0]=No[N0]);function DQ(t){var e=MQ&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||OQ&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?ag:No)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}const LQ=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),jQ=typeof navigator<"u"&&/Win/.test(navigator.platform);function VQ(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a++){let l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))LQ?o=!0:s=!0;else throw new Error("Unrecognized modifier name: "+l)}return r&&(n="Alt-"+n),s&&(n="Ctrl-"+n),o&&(n="Meta-"+n),i&&(n="Shift-"+n),n}function FQ(t){let e=Object.create(null);for(let n in t)e[VQ(n)]=t[n];return e}function P0(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function BQ(t){return new pt({props:{handleKeyDown:Qb(t)}})}function Qb(t){let e=FQ(t);return function(n,r){let s=DQ(r),i,o=e[P0(s,r)];if(o&&o(n.state,n.dispatch,n))return!0;if(s.length==1&&s!=" "){if(r.shiftKey){let a=e[P0(s,r,!1)];if(a&&a(n.state,n.dispatch,n))return!0}if((r.altKey||r.metaKey||r.ctrlKey)&&!(jQ&&r.ctrlKey&&r.altKey)&&(i=No[r.keyCode])&&i!=s){let a=e[P0(i,r)];if(a&&a(n.state,n.dispatch,n))return!0}}return!1}}var UQ=Object.defineProperty,Jb=(t,e)=>{for(var n in e)UQ(t,n,{get:e[n],enumerable:!0})};function Gy(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}var Qy=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:s}=n,i=this.buildProps(s);return Object.fromEntries(Object.entries(t).map(([o,a])=>[o,(...c)=>{const u=a(...c)(i);return!s.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(s),u}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r,o=[],a=!!t,l=t||s.tr,c=()=>(!a&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),o.every(h=>h===!0)),u={...Object.fromEntries(Object.entries(n).map(([h,d])=>[h,(...g)=>{const y=this.buildProps(l,e),v=d(...g)(y);return o.push(v),u}])),run:c};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,s=t||n.tr,i=this.buildProps(s,r);return{...Object.fromEntries(Object.entries(e).map(([a,l])=>[a,(...c)=>l(...c)({...i,dispatch:void 0})])),chain:()=>this.createChain(s,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r,o={tr:t,editor:r,view:i,state:Gy({state:s,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([a,l])=>[a,(...c)=>l(...c)(o)]))}};return o}},nj={};Jb(nj,{blur:()=>zQ,clearContent:()=>$Q,clearNodes:()=>HQ,command:()=>WQ,createParagraphNear:()=>qQ,cut:()=>KQ,deleteCurrentNode:()=>GQ,deleteNode:()=>QQ,deleteRange:()=>JQ,deleteSelection:()=>XQ,enter:()=>YQ,exitCode:()=>ZQ,extendMarkRange:()=>eJ,first:()=>tJ,focus:()=>rJ,forEach:()=>sJ,insertContent:()=>iJ,insertContentAt:()=>lJ,joinBackward:()=>hJ,joinDown:()=>uJ,joinForward:()=>dJ,joinItemBackward:()=>fJ,joinItemForward:()=>pJ,joinTextblockBackward:()=>mJ,joinTextblockForward:()=>gJ,joinUp:()=>cJ,keyboardShortcut:()=>vJ,lift:()=>wJ,liftEmptyBlock:()=>_J,liftListItem:()=>xJ,newlineInCode:()=>bJ,resetAttributes:()=>TJ,scrollIntoView:()=>EJ,selectAll:()=>SJ,selectNodeBackward:()=>kJ,selectNodeForward:()=>CJ,selectParentNode:()=>IJ,selectTextblockEnd:()=>AJ,selectTextblockStart:()=>RJ,setContent:()=>NJ,setMark:()=>JJ,setMeta:()=>XJ,setNode:()=>YJ,setNodeSelection:()=>ZJ,setTextDirection:()=>eX,setTextSelection:()=>tX,sinkListItem:()=>nX,splitBlock:()=>rX,splitListItem:()=>sX,toggleList:()=>iX,toggleMark:()=>oX,toggleNode:()=>aX,toggleWrap:()=>lX,undoInputRule:()=>cX,unsetAllMarks:()=>uX,unsetMark:()=>hX,unsetTextDirection:()=>dX,updateAttributes:()=>fX,wrapIn:()=>pX,wrapInList:()=>mX});var zQ=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window==null?void 0:window.getSelection())==null||n.removeAllRanges())}),!0),$Q=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),HQ=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:s}=r;return n&&s.forEach(({$from:i,$to:o})=>{t.doc.nodesBetween(i.pos,o.pos,(a,l)=>{if(a.type.isText)return;const{doc:c,mapping:u}=e,h=c.resolve(u.map(l)),d=c.resolve(u.map(l+a.nodeSize)),f=h.blockRange(d);if(!f)return;const g=su(f);if(a.type.isTextblock){const{defaultType:y}=h.parent.contentMatchAt(h.index());e.setNodeMarkup(f.start,y)}(g||g===0)&&e.lift(f,g)})}),!0},WQ=t=>e=>t(e),qQ=()=>({state:t,dispatch:e})=>yL(t,e),KQ=(t,e)=>({editor:n,tr:r})=>{const{state:s}=n,i=s.doc.slice(t.from,t.to);r.deleteRange(t.from,t.to);const o=r.mapping.map(e);return r.insert(o,i.content),r.setSelection(new be(r.doc.resolve(Math.max(o-1,0)))),!0},GQ=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const s=t.selection.$anchor;for(let i=s.depth;i>0;i-=1)if(s.node(i).type===r.type){if(e){const a=s.before(i),l=s.after(i);t.delete(a,l).scrollIntoView()}return!0}return!1};function Kt(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var QQ=t=>({tr:e,state:n,dispatch:r})=>{const s=Kt(t,n.schema),i=e.selection.$anchor;for(let o=i.depth;o>0;o-=1)if(i.node(o).type===s){if(r){const l=i.before(o),c=i.after(o);e.delete(l,c).scrollIntoView()}return!0}return!1},JQ=t=>({tr:e,dispatch:n})=>{const{from:r,to:s}=t;return n&&e.delete(r,s),!0},XQ=()=>({state:t,dispatch:e})=>Db(t,e),YQ=()=>({commands:t})=>t.keyboardShortcut("Enter"),ZQ=()=>({state:t,dispatch:e})=>jK(t,e);function Xb(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function lg(t,e,n={strict:!0}){const r=Object.keys(e);return r.length?r.every(s=>n.strict?e[s]===t[s]:Xb(e[s])?e[s].test(t[s]):e[s]===t[s]):!0}function rj(t,e,n={}){return t.find(r=>r.type===e&&lg(Object.fromEntries(Object.keys(n).map(s=>[s,r.attrs[s]])),n))}function HI(t,e,n={}){return!!rj(t,e,n)}function Yb(t,e,n){var r;if(!t||!e)return;let s=t.parent.childAfter(t.parentOffset);if((!s.node||!s.node.marks.some(u=>u.type===e))&&(s=t.parent.childBefore(t.parentOffset)),!s.node||!s.node.marks.some(u=>u.type===e)||(n=n||((r=s.node.marks[0])==null?void 0:r.attrs),!rj([...s.node.marks],e,n)))return;let o=s.index,a=t.start()+s.offset,l=o+1,c=a+s.node.nodeSize;for(;o>0&&HI([...t.parent.child(o-1).marks],e,n);)o-=1,a-=t.parent.child(o).nodeSize;for(;l<t.parent.childCount&&HI([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:a,to:c}}function Ei(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var eJ=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const i=Ei(t,r.schema),{doc:o,selection:a}=n,{$from:l,from:c,to:u}=a;if(s){const h=Yb(l,i,e);if(h&&h.from<=c&&h.to>=u){const d=be.create(o,h.from,h.to);n.setSelection(d)}}return!0},tJ=t=>e=>{const n=typeof t=="function"?t(e):t;for(let r=0;r<n.length;r+=1)if(n[r](e))return!0;return!1};function sj(t){return t instanceof be}function va(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function ij(t,e=null){if(!e)return null;const n=ke.atStart(t),r=ke.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return r;const s=n.from,i=r.to;return e==="all"?be.create(t,va(0,s,i),va(t.content.size,s,i)):be.create(t,va(e,s,i),va(e,s,i))}function WI(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function cg(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function nJ(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var rJ=(t=null,e={})=>({editor:n,view:r,tr:s,dispatch:i})=>{e={scrollIntoView:!0,...e};const o=()=>{(cg()||WI())&&r.dom.focus(),nJ()&&!cg()&&!WI()&&r.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(r.focus(),e!=null&&e.scrollIntoView&&n.commands.scrollIntoView())})};if(r.hasFocus()&&t===null||t===!1)return!0;if(i&&t===null&&!sj(n.state.selection))return o(),!0;const a=ij(s.doc,t)||n.state.selection,l=n.state.selection.eq(a);return i&&(l||s.setSelection(a),l&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},sJ=(t,e)=>n=>t.every((r,s)=>e(r,{...n,index:s})),iJ=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),oj=t=>{const e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){const r=e[n];r.nodeType===3&&r.nodeValue&&/^(\n\s\s|\n)$/.test(r.nodeValue)?t.removeChild(r):r.nodeType===1&&oj(r)}return t};function Gf(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");const e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return oj(n)}function _d(t,e,n){if(t instanceof as||t instanceof te)return t;n={slice:!0,parseOptions:{},...n};const r=typeof t=="object"&&t!==null,s=typeof t=="string";if(r)try{if(Array.isArray(t)&&t.length>0)return te.fromArray(t.map(a=>e.nodeFromJSON(a)));const o=e.nodeFromJSON(t);return n.errorOnInvalidContent&&o.check(),o}catch(i){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:i});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",i),_d("",e,n)}if(s){if(n.errorOnInvalidContent){let o=!1,a="";const l=new HD({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(o=!0,a=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?_o.fromSchema(l).parseSlice(Gf(t),n.parseOptions):_o.fromSchema(l).parse(Gf(t),n.parseOptions),n.errorOnInvalidContent&&o)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${a}`)})}const i=_o.fromSchema(e);return n.slice?i.parseSlice(Gf(t),n.parseOptions).content:i.parse(Gf(t),n.parseOptions)}return _d("",e,n)}function oJ(t,e,n){const r=t.steps.length-1;if(r<e)return;const s=t.steps[r];if(!(s instanceof on||s instanceof un))return;const i=t.mapping.maps[r];let o=0;i.forEach((a,l,c,u)=>{o===0&&(o=u)}),t.setSelection(ke.near(t.doc.resolve(o),n))}var aJ=t=>!("type"in t),lJ=(t,e,n)=>({tr:r,dispatch:s,editor:i})=>{var o;if(s){n={parseOptions:i.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let a;const l=v=>{i.emit("contentError",{editor:i,error:v,disableCollaboration:()=>{"collaboration"in i.storage&&typeof i.storage.collaboration=="object"&&i.storage.collaboration&&(i.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!i.options.enableContentCheck&&i.options.emitContentError)try{_d(e,i.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(v){l(v)}try{a=_d(e,i.schema,{parseOptions:c,errorOnInvalidContent:(o=n.errorOnInvalidContent)!=null?o:i.options.enableContentCheck})}catch(v){return l(v),!1}let{from:u,to:h}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},d=!0,f=!0;if((aJ(a)?a:[a]).forEach(v=>{v.check(),d=d?v.isText&&v.marks.length===0:!1,f=f?v.isBlock:!1}),u===h&&f){const{parent:v}=r.doc.resolve(u);v.isTextblock&&!v.type.spec.code&&!v.childCount&&(u-=1,h+=1)}let y;if(d){if(Array.isArray(e))y=e.map(v=>v.text||"").join("");else if(e instanceof te){let v="";e.forEach(w=>{w.text&&(v+=w.text)}),y=v}else typeof e=="object"&&e&&e.text?y=e.text:y=e;r.insertText(y,u,h)}else{y=a;const v=r.doc.resolve(u),w=v.node(),T=v.parentOffset===0,E=w.isText||w.isTextblock,R=w.content.size>0;T&&E&&R&&(u=Math.max(0,u-1)),r.replaceWith(u,h,y)}n.updateSelection&&oJ(r,r.steps.length-1,-1),n.applyInputRules&&r.setMeta("applyInputRules",{from:u,text:y}),n.applyPasteRules&&r.setMeta("applyPasteRules",{from:u,text:y})}return!0},cJ=()=>({state:t,dispatch:e})=>OK(t,e),uJ=()=>({state:t,dispatch:e})=>DK(t,e),hJ=()=>({state:t,dispatch:e})=>uL(t,e),dJ=()=>({state:t,dispatch:e})=>pL(t,e),fJ=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zy(t.doc,t.selection.$from.pos,-1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},pJ=()=>({state:t,dispatch:e,tr:n})=>{try{const r=zy(t.doc,t.selection.$from.pos,1);return r==null?!1:(n.join(r,2),e&&e(n),!0)}catch{return!1}},mJ=()=>({state:t,dispatch:e})=>PK(t,e),gJ=()=>({state:t,dispatch:e})=>MK(t,e);function aj(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function yJ(t){const e=t.split(/-(?!$)/);let n=e[e.length-1];n==="Space"&&(n=" ");let r,s,i,o;for(let a=0;a<e.length-1;a+=1){const l=e[a];if(/^(cmd|meta|m)$/i.test(l))o=!0;else if(/^a(lt)?$/i.test(l))r=!0;else if(/^(c|ctrl|control)$/i.test(l))s=!0;else if(/^s(hift)?$/i.test(l))i=!0;else if(/^mod$/i.test(l))cg()||aj()?o=!0:s=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return r&&(n=`Alt-${n}`),s&&(n=`Ctrl-${n}`),o&&(n=`Meta-${n}`),i&&(n=`Shift-${n}`),n}var vJ=t=>({editor:e,view:n,tr:r,dispatch:s})=>{const i=yJ(t).split(/-(?!$)/),o=i.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),a=new KeyboardEvent("keydown",{key:o==="Space"?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,a))});return l==null||l.steps.forEach(c=>{const u=c.map(r.mapping);u&&s&&r.maybeStep(u)}),!0};function Po(t,e,n={}){const{from:r,to:s,empty:i}=t.selection,o=e?Kt(e,t.schema):null,a=[];t.doc.nodesBetween(r,s,(h,d)=>{if(h.isText)return;const f=Math.max(r,d),g=Math.min(s,d+h.nodeSize);a.push({node:h,from:f,to:g})});const l=s-r,c=a.filter(h=>o?o.name===h.node.type.name:!0).filter(h=>lg(h.node.attrs,n,{strict:!1}));return i?!!c.length:c.reduce((h,d)=>h+d.to-d.from,0)>=l}var wJ=(t,e={})=>({state:n,dispatch:r})=>{const s=Kt(t,n.schema);return Po(n,s,e)?LK(n,r):!1},_J=()=>({state:t,dispatch:e})=>vL(t,e),xJ=t=>({state:e,dispatch:n})=>{const r=Kt(t,e.schema);return GK(r)(e,n)},bJ=()=>({state:t,dispatch:e})=>gL(t,e);function Jy(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function qI(t,e){const n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((r,s)=>(n.includes(s)||(r[s]=t[s]),r),{})}var TJ=(t,e)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Jy(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(i=Kt(t,r.schema)),a==="mark"&&(o=Ei(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{r.doc.nodesBetween(c.$from.pos,c.$to.pos,(u,h)=>{i&&i===u.type&&(l=!0,s&&n.setNodeMarkup(h,void 0,qI(u.attrs,e))),o&&u.marks.length&&u.marks.forEach(d=>{o===d.type&&(l=!0,s&&n.addMark(h,h+u.nodeSize,o.create(qI(d.attrs,e))))})})}),l},EJ=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),SJ=()=>({tr:t,dispatch:e})=>{if(e){const n=new yr(t.doc);t.setSelection(n)}return!0},kJ=()=>({state:t,dispatch:e})=>dL(t,e),CJ=()=>({state:t,dispatch:e})=>mL(t,e),IJ=()=>({state:t,dispatch:e})=>BK(t,e),AJ=()=>({state:t,dispatch:e})=>$K(t,e),RJ=()=>({state:t,dispatch:e})=>zK(t,e);function G1(t,e,n={},r={}){return _d(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:r.errorOnInvalidContent})}var NJ=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:r={}}={})=>({editor:s,tr:i,dispatch:o,commands:a})=>{const{doc:l}=i;if(r.preserveWhitespace!=="full"){const c=G1(t,s.schema,r,{errorOnInvalidContent:e??s.options.enableContentCheck});return o&&i.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return o&&i.setMeta("preventUpdate",!n),a.insertContentAt({from:0,to:l.content.size},t,{parseOptions:r,errorOnInvalidContent:e??s.options.enableContentCheck})};function lj(t,e){const n=Ei(e,t.schema),{from:r,to:s,empty:i}=t.selection,o=[];i?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,s,l=>{o.push(...l.marks)});const a=o.find(l=>l.type.name===n.name);return a?{...a.attrs}:{}}function cj(t,e){const n=new Mb(t);return e.forEach(r=>{r.steps.forEach(s=>{n.step(s)})}),n}function PJ(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function MJ(t,e,n){const r=[];return t.nodesBetween(e.from,e.to,(s,i)=>{n(s)&&r.push({node:s,pos:i})}),r}function uj(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function Xy(t){return e=>uj(e.$from,t)}function ve(t,e,n){return t.config[e]===void 0&&t.parent?ve(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?ve(t.parent,e,n):null}):t.config[e]}function Zb(t){return t.map(e=>{const n={name:e.name,options:e.options,storage:e.storage},r=ve(e,"addExtensions",n);return r?[e,...Zb(r())]:e}).flat(10)}function eT(t,e){const n=dl.fromSchema(e).serializeFragment(t),s=document.implementation.createHTMLDocument().createElement("div");return s.appendChild(n),s.innerHTML}function hj(t){return typeof t=="function"}function Qe(t,e=void 0,...n){return hj(t)?e?t.bind(e)(...n):t(...n):t}function OJ(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Hc(t){const e=t.filter(s=>s.type==="extension"),n=t.filter(s=>s.type==="node"),r=t.filter(s=>s.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function dj(t){const e=[],{nodeExtensions:n,markExtensions:r}=Hc(t),s=[...n,...r],i={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage,extensions:s},l=ve(o,"addGlobalAttributes",a);if(!l)return;l().forEach(u=>{u.types.forEach(h=>{Object.entries(u.attributes).forEach(([d,f])=>{e.push({type:h,name:d,attribute:{...i,...f}})})})})}),s.forEach(o=>{const a={name:o.name,options:o.options,storage:o.storage},l=ve(o,"addAttributes",a);if(!l)return;const c=l();Object.entries(c).forEach(([u,h])=>{const d={...i,...h};typeof(d==null?void 0:d.default)=="function"&&(d.default=d.default()),d!=null&&d.isRequired&&(d==null?void 0:d.default)===void 0&&delete d.default,e.push({type:o.name,name:u,attribute:d})})}),e}function ft(...t){return t.filter(e=>!!e).reduce((e,n)=>{const r={...e};return Object.entries(n).forEach(([s,i])=>{if(!r[s]){r[s]=i;return}if(s==="class"){const a=i?String(i).split(" "):[],l=r[s]?r[s].split(" "):[],c=a.filter(u=>!l.includes(u));r[s]=[...l,...c].join(" ")}else if(s==="style"){const a=i?i.split(";").map(u=>u.trim()).filter(Boolean):[],l=r[s]?r[s].split(";").map(u=>u.trim()).filter(Boolean):[],c=new Map;l.forEach(u=>{const[h,d]=u.split(":").map(f=>f.trim());c.set(h,d)}),a.forEach(u=>{const[h,d]=u.split(":").map(f=>f.trim());c.set(h,d)}),r[s]=Array.from(c.entries()).map(([u,h])=>`${u}: ${h}`).join("; ")}else r[s]=i}),r},{})}function xd(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,r)=>ft(n,r),{})}function DJ(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function KI(t,e){return"style"in t?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(r===!1)return!1;const s=e.reduce((i,o)=>{const a=o.attribute.parseHTML?o.attribute.parseHTML(n):DJ(n.getAttribute(o.name));return a==null?i:{...i,[o.name]:a}},{});return{...r,...s}}}}function GI(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&OJ(n)?!1:n!=null))}function QI(t){var e,n;const r={};return!((e=t==null?void 0:t.attribute)!=null&&e.isRequired)&&"default"in((t==null?void 0:t.attribute)||{})&&(r.default=t.attribute.default),((n=t==null?void 0:t.attribute)==null?void 0:n.validate)!==void 0&&(r.validate=t.attribute.validate),[t.name,r]}function LJ(t,e){var n;const r=dj(t),{nodeExtensions:s,markExtensions:i}=Hc(t),o=(n=s.find(c=>ve(c,"topNode")))==null?void 0:n.name,a=Object.fromEntries(s.map(c=>{const u=r.filter(w=>w.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},d=t.reduce((w,T)=>{const E=ve(T,"extendNodeSchema",h);return{...w,...E?E(c):{}}},{}),f=GI({...d,content:Qe(ve(c,"content",h)),marks:Qe(ve(c,"marks",h)),group:Qe(ve(c,"group",h)),inline:Qe(ve(c,"inline",h)),atom:Qe(ve(c,"atom",h)),selectable:Qe(ve(c,"selectable",h)),draggable:Qe(ve(c,"draggable",h)),code:Qe(ve(c,"code",h)),whitespace:Qe(ve(c,"whitespace",h)),linebreakReplacement:Qe(ve(c,"linebreakReplacement",h)),defining:Qe(ve(c,"defining",h)),isolating:Qe(ve(c,"isolating",h)),attrs:Object.fromEntries(u.map(QI))}),g=Qe(ve(c,"parseHTML",h));g&&(f.parseDOM=g.map(w=>KI(w,u)));const y=ve(c,"renderHTML",h);y&&(f.toDOM=w=>y({node:w,HTMLAttributes:xd(w,u)}));const v=ve(c,"renderText",h);return v&&(f.toText=v),[c.name,f]})),l=Object.fromEntries(i.map(c=>{const u=r.filter(v=>v.type===c.name),h={name:c.name,options:c.options,storage:c.storage,editor:e},d=t.reduce((v,w)=>{const T=ve(w,"extendMarkSchema",h);return{...v,...T?T(c):{}}},{}),f=GI({...d,inclusive:Qe(ve(c,"inclusive",h)),excludes:Qe(ve(c,"excludes",h)),group:Qe(ve(c,"group",h)),spanning:Qe(ve(c,"spanning",h)),code:Qe(ve(c,"code",h)),attrs:Object.fromEntries(u.map(QI))}),g=Qe(ve(c,"parseHTML",h));g&&(f.parseDOM=g.map(v=>KI(v,u)));const y=ve(c,"renderHTML",h);return y&&(f.toDOM=v=>y({mark:v,HTMLAttributes:xd(v,u)})),[c.name,f]}));return new HD({topNode:o,nodes:a,marks:l})}function jJ(t){const e=t.filter((n,r)=>t.indexOf(n)!==r);return Array.from(new Set(e))}function ug(t){return t.sort((n,r)=>{const s=ve(n,"priority")||100,i=ve(r,"priority")||100;return s>i?-1:s<i?1:0})}function fj(t){const e=ug(Zb(t)),n=jJ(e.map(r=>r.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}function pj(t,e,n){const{from:r,to:s}=e,{blockSeparator:i=`

`,textSerializers:o={}}=n||{};let a="";return t.nodesBetween(r,s,(l,c,u,h)=>{var d;l.isBlock&&c>r&&(a+=i);const f=o==null?void 0:o[l.type.name];if(f)return u&&(a+=f({node:l,pos:c,parent:u,index:h,range:e})),!1;l.isText&&(a+=(d=l==null?void 0:l.text)==null?void 0:d.slice(Math.max(r,c)-c,s-c))}),a}function VJ(t,e){const n={from:0,to:t.content.size};return pj(t,n,e)}function mj(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function FJ(t,e){const n=Kt(e,t.schema),{from:r,to:s}=t.selection,i=[];t.doc.nodesBetween(r,s,a=>{i.push(a)});const o=i.reverse().find(a=>a.type.name===n.name);return o?{...o.attrs}:{}}function gj(t,e){const n=Jy(typeof e=="string"?e:e.name,t.schema);return n==="node"?FJ(t,e):n==="mark"?lj(t,e):{}}function BJ(t,e=JSON.stringify){const n={};return t.filter(r=>{const s=e(r);return Object.prototype.hasOwnProperty.call(n,s)?!1:n[s]=!0})}function UJ(t){const e=BJ(t);return e.length===1?e:e.filter((n,r)=>!e.filter((i,o)=>o!==r).some(i=>n.oldRange.from>=i.oldRange.from&&n.oldRange.to<=i.oldRange.to&&n.newRange.from>=i.newRange.from&&n.newRange.to<=i.newRange.to))}function yj(t){const{mapping:e,steps:n}=t,r=[];return e.maps.forEach((s,i)=>{const o=[];if(s.ranges.length)s.forEach((a,l)=>{o.push({from:a,to:l})});else{const{from:a,to:l}=n[i];if(a===void 0||l===void 0)return;o.push({from:a,to:l})}o.forEach(({from:a,to:l})=>{const c=e.slice(i).map(a,-1),u=e.slice(i).map(l),h=e.invert().map(c,-1),d=e.invert().map(u);r.push({oldRange:{from:h,to:d},newRange:{from:c,to:u}})})}),UJ(r)}function tT(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach(s=>{const i=n.resolve(t),o=Yb(i,s.type);o&&r.push({mark:s,...o})}):n.nodesBetween(t,e,(s,i)=>{!s||(s==null?void 0:s.nodeSize)===void 0||r.push(...s.marks.map(o=>({from:i,to:i+s.nodeSize,mark:o})))}),r}var zJ=(t,e,n,r=20)=>{const s=t.doc.resolve(n);let i=r,o=null;for(;i>0&&o===null;){const a=s.node(i);(a==null?void 0:a.type.name)===e?o=a:i-=1}return[o,i]};function Qf(t,e){return e.nodes[t]||e.marks[t]||null}function Hp(t,e,n){return Object.fromEntries(Object.entries(n).filter(([r])=>{const s=t.find(i=>i.type===e&&i.name===r);return s?s.attribute.keepOnSplit:!1}))}var $J=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,(s,i,o,a)=>{var l,c;const u=((c=(l=s.type.spec).toText)==null?void 0:c.call(l,{node:s,pos:i,parent:o,index:a}))||s.textContent||"%leaf%";n+=s.isAtom&&!s.isText?u:u.slice(0,Math.max(0,r-i))}),n};function Q1(t,e,n={}){const{empty:r,ranges:s}=t.selection,i=e?Ei(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter(h=>i?i.name===h.type.name:!0).find(h=>lg(h.attrs,n,{strict:!1}));let o=0;const a=[];if(s.forEach(({$from:h,$to:d})=>{const f=h.pos,g=d.pos;t.doc.nodesBetween(f,g,(y,v)=>{if(!y.isText&&!y.marks.length)return;const w=Math.max(f,v),T=Math.min(g,v+y.nodeSize),E=T-w;o+=E,a.push(...y.marks.map(R=>({mark:R,from:w,to:T})))})}),o===0)return!1;const l=a.filter(h=>i?i.name===h.mark.type.name:!0).filter(h=>lg(h.mark.attrs,n,{strict:!1})).reduce((h,d)=>h+d.to-d.from,0),c=a.filter(h=>i?h.mark.type!==i&&h.mark.type.excludes(i):!0).reduce((h,d)=>h+d.to-d.from,0);return(l>0?l+c:l)>=o}function HJ(t,e,n={}){if(!e)return Po(t,null,n)||Q1(t,null,n);const r=Jy(e,t.schema);return r==="node"?Po(t,e,n):r==="mark"?Q1(t,e,n):!1}var WJ=(t,e)=>{const{$from:n,$to:r,$anchor:s}=t.selection;if(e){const i=Xy(a=>a.type.name===e)(t.selection);if(!i)return!1;const o=t.doc.resolve(i.pos+1);return s.pos+1===o.end()}return!(r.parentOffset<r.parent.nodeSize-2||n.pos!==r.pos)},qJ=t=>{const{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function JI(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function XI(t,e){const{nodeExtensions:n}=Hc(e),r=n.find(o=>o.name===t);if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=Qe(ve(r,"group",s));return typeof i!="string"?!1:i.split(" ").includes("list")}function Yy(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var r;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((r=t.text)!=null?r:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let s=!0;return t.content.forEach(i=>{s!==!1&&(Yy(i,{ignoreWhitespace:n,checkChildren:e})||(s=!1))}),s}return!1}function vj(t){return t instanceof _e}var wj=class _j{constructor(e){this.position=e}static fromJSON(e){return new _j(e.position)}toJSON(){return{position:this.position}}};function KJ(t,e){const n=e.mapping.mapResult(t.position);return{position:new wj(n.pos),mapResult:n}}function GJ(t){return new wj(t)}function QJ(t,e,n){var r;const{selection:s}=e;let i=null;if(sj(s)&&(i=s.$cursor),i){const a=(r=t.storedMarks)!=null?r:i.marks();return i.parent.type.allowsMarkType(n)&&(!!n.isInSet(a)||!a.some(c=>c.type.excludes(n)))}const{ranges:o}=s;return o.some(({$from:a,$to:l})=>{let c=a.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(a.pos,l.pos,(u,h,d)=>{if(c)return!1;if(u.isInline){const f=!d||d.type.allowsMarkType(n),g=!!n.isInSet(u.marks)||!u.marks.some(y=>y.type.excludes(n));c=f&&g}return!c}),c})}var JJ=(t,e={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,l=Ei(t,r.schema);if(s)if(o){const c=lj(r,l);n.addStoredMark(l.create({...c,...e}))}else a.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;r.doc.nodesBetween(u,h,(d,f)=>{const g=Math.max(f,u),y=Math.min(f+d.nodeSize,h);d.marks.find(w=>w.type===l)?d.marks.forEach(w=>{l===w.type&&n.addMark(g,y,l.create({...w.attrs,...e}))}):n.addMark(g,y,l.create(e))})});return QJ(r,n,l)},XJ=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),YJ=(t,e={})=>({state:n,dispatch:r,chain:s})=>{const i=Kt(t,n.schema);let o;return n.selection.$anchor.sameParent(n.selection.$head)&&(o=n.selection.$anchor.parent.attrs),i.isTextblock?s().command(({commands:a})=>uI(i,{...o,...e})(n)?!0:a.clearNodes()).command(({state:a})=>uI(i,{...o,...e})(a,r)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},ZJ=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,s=va(t,0,r.content.size),i=_e.create(r,s);e.setSelection(i)}return!0},eX=(t,e)=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=r;let o,a;return typeof e=="number"?(o=e,a=e):e&&"from"in e&&"to"in e?(o=e.from,a=e.to):(o=i.from,a=i.to),s&&n.doc.nodesBetween(o,a,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},tX=t=>({tr:e,dispatch:n})=>{if(n){const{doc:r}=e,{from:s,to:i}=typeof t=="number"?{from:t,to:t}:t,o=be.atStart(r).from,a=be.atEnd(r).to,l=va(s,o,a),c=va(i,o,a),u=be.create(r,l,c);e.setSelection(u)}return!0},nX=t=>({state:e,dispatch:n})=>{const r=Kt(t,e.schema);return XK(r)(e,n)};function YI(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter(s=>e==null?void 0:e.includes(s.type.name));t.tr.ensureMarks(r)}}var rX=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:r,editor:s})=>{const{selection:i,doc:o}=e,{$from:a,$to:l}=i,c=s.extensionManager.attributes,u=Hp(c,a.node().type.name,a.node().attrs);if(i instanceof _e&&i.node.isBlock)return!a.parentOffset||!li(o,a.pos)?!1:(r&&(t&&YI(n,s.extensionManager.splittableMarks),e.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;const h=l.parentOffset===l.parent.content.size,d=a.depth===0?void 0:PJ(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=h&&d?[{type:d,attrs:u}]:void 0,g=li(e.doc,e.mapping.map(a.pos),1,f);if(!f&&!g&&li(e.doc,e.mapping.map(a.pos),1,d?[{type:d}]:void 0)&&(g=!0,f=d?[{type:d,attrs:u}]:void 0),r){if(g&&(i instanceof be&&e.deleteSelection(),e.split(e.mapping.map(a.pos),1,f),d&&!h&&!a.parentOffset&&a.parent.type!==d)){const y=e.mapping.map(a.before()),v=e.doc.resolve(y);a.node(-1).canReplaceWith(v.index(),v.index()+1,d)&&e.setNodeMarkup(e.mapping.map(a.before()),d)}t&&YI(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return g},sX=(t,e={})=>({tr:n,state:r,dispatch:s,editor:i})=>{var o;const a=Kt(t,r.schema),{$from:l,$to:c}=r.selection,u=r.selection.node;if(u&&u.isBlock||l.depth<2||!l.sameParent(c))return!1;const h=l.node(-1);if(h.type!==a)return!1;const d=i.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==a||l.index(-2)!==l.node(-2).childCount-1)return!1;if(s){let w=te.empty;const T=l.index(-1)?1:l.index(-2)?2:3;for(let _=l.depth-T;_>=l.depth-3;_-=1)w=te.from(l.node(_).copy(w));const E=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,R={...Hp(d,l.node().type.name,l.node().attrs),...e},P=((o=a.contentMatch.defaultType)==null?void 0:o.createAndFill(R))||void 0;w=w.append(te.from(a.createAndFill(null,P)||void 0));const N=l.before(l.depth-(T-1));n.replace(N,l.after(-E),new ue(w,4-T,0));let k=-1;n.doc.nodesBetween(N,n.doc.content.size,(_,x)=>{if(k>-1)return!1;_.isTextblock&&_.content.size===0&&(k=x+1)}),k>-1&&n.setSelection(be.near(n.doc.resolve(k))),n.scrollIntoView()}return!0}const f=c.pos===l.end()?h.contentMatchAt(0).defaultType:null,g={...Hp(d,h.type.name,h.attrs),...e},y={...Hp(d,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);const v=f?[{type:a,attrs:g},{type:f,attrs:y}]:[{type:a,attrs:g}];if(!li(n.doc,l.pos,2))return!1;if(s){const{selection:w,storedMarks:T}=r,{splittableMarks:E}=i.extensionManager,R=T||w.$to.parentOffset&&w.$from.marks();if(n.split(l.pos,2,v).scrollIntoView(),!R||!s)return!0;const P=R.filter(N=>E.includes(N.type.name));n.ensureMarks(P)}return!0},M0=(t,e)=>{const n=Xy(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&$o(t.doc,n.pos)&&t.join(n.pos),!0},O0=(t,e)=>{const n=Xy(o=>o.type===e)(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(r===void 0)return!0;const s=t.doc.nodeAt(r);return n.node.type===(s==null?void 0:s.type)&&$o(t.doc,r)&&t.join(r),!0},iX=(t,e,n,r={})=>({editor:s,tr:i,state:o,dispatch:a,chain:l,commands:c,can:u})=>{const{extensions:h,splittableMarks:d}=s.extensionManager,f=Kt(t,o.schema),g=Kt(e,o.schema),{selection:y,storedMarks:v}=o,{$from:w,$to:T}=y,E=w.blockRange(T),R=v||y.$to.parentOffset&&y.$from.marks();if(!E)return!1;const P=Xy(N=>XI(N.type.name,h))(y);if(E.depth>=1&&P&&E.depth-P.depth<=1){if(P.node.type===f)return c.liftListItem(g);if(XI(P.node.type.name,h)&&f.validContent(P.node.content)&&a)return l().command(()=>(i.setNodeMarkup(P.pos,f),!0)).command(()=>M0(i,f)).command(()=>O0(i,f)).run()}return!n||!R||!a?l().command(()=>u().wrapInList(f,r)?!0:c.clearNodes()).wrapInList(f,r).command(()=>M0(i,f)).command(()=>O0(i,f)).run():l().command(()=>{const N=u().wrapInList(f,r),k=R.filter(_=>d.includes(_.type.name));return i.ensureMarks(k),N?!0:c.clearNodes()}).wrapInList(f,r).command(()=>M0(i,f)).command(()=>O0(i,f)).run()},oX=(t,e={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=Ei(t,r.schema);return Q1(r,o,e)?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,e)},aX=(t,e,n={})=>({state:r,commands:s})=>{const i=Kt(t,r.schema),o=Kt(e,r.schema),a=Po(r,i,n);let l;return r.selection.$anchor.sameParent(r.selection.$head)&&(l=r.selection.$anchor.parent.attrs),a?s.setNode(o,l):s.setNode(i,{...l,...n})},lX=(t,e={})=>({state:n,commands:r})=>{const s=Kt(t,n.schema);return Po(n,s,e)?r.lift(s):r.wrapIn(s,e)},cX=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(t))){if(e){const o=t.tr,a=i.transform;for(let l=a.steps.length-1;l>=0;l-=1)o.step(a.steps[l].invert(a.docs[l]));if(i.text){const l=o.doc.resolve(i.from).marks();o.replaceWith(i.from,i.to,t.schema.text(i.text,l))}else o.delete(i.from,i.to)}return!0}}return!1},uX=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:s}=n;return r||e&&s.forEach(i=>{t.removeMark(i.$from.pos,i.$to.pos)}),!0},hX=(t,e={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,l=Ei(t,r.schema),{$from:c,empty:u,ranges:h}=a;if(!s)return!0;if(u&&o){let{from:d,to:f}=a;const g=(i=c.marks().find(v=>v.type===l))==null?void 0:i.attrs,y=Yb(c,l,g);y&&(d=y.from,f=y.to),n.removeMark(d,f,l)}else h.forEach(d=>{n.removeMark(d.$from.pos,d.$to.pos,l)});return n.removeStoredMark(l),!0},dX=t=>({tr:e,state:n,dispatch:r})=>{const{selection:s}=n;let i,o;return typeof t=="number"?(i=t,o=t):t&&"from"in t&&"to"in t?(i=t.from,o=t.to):(i=s.from,o=s.to),r&&e.doc.nodesBetween(i,o,(a,l)=>{if(a.isText)return;const c={...a.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},fX=(t,e={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=Jy(typeof t=="string"?t:t.name,r.schema);if(!a)return!1;a==="node"&&(i=Kt(t,r.schema)),a==="mark"&&(o=Ei(t,r.schema));let l=!1;return n.selection.ranges.forEach(c=>{const u=c.$from.pos,h=c.$to.pos;let d,f,g,y;n.selection.empty?r.doc.nodesBetween(u,h,(v,w)=>{i&&i===v.type&&(l=!0,g=Math.max(w,u),y=Math.min(w+v.nodeSize,h),d=w,f=v)}):r.doc.nodesBetween(u,h,(v,w)=>{w<u&&i&&i===v.type&&(l=!0,g=Math.max(w,u),y=Math.min(w+v.nodeSize,h),d=w,f=v),w>=u&&w<=h&&(i&&i===v.type&&(l=!0,s&&n.setNodeMarkup(w,void 0,{...v.attrs,...e})),o&&v.marks.length&&v.marks.forEach(T=>{if(o===T.type&&(l=!0,s)){const E=Math.max(w,u),R=Math.min(w+v.nodeSize,h);n.addMark(E,R,o.create({...T.attrs,...e}))}}))}),f&&(d!==void 0&&s&&n.setNodeMarkup(d,void 0,{...f.attrs,...e}),o&&f.marks.length&&f.marks.forEach(v=>{o===v.type&&s&&n.addMark(g,y,o.create({...v.attrs,...e}))}))}),l},pX=(t,e={})=>({state:n,dispatch:r})=>{const s=Kt(t,n.schema);return HK(s,e)(n,r)},mX=(t,e={})=>({state:n,dispatch:r})=>{const s=Kt(t,n.schema);return WK(s,e)(n,r)},gX=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach(r=>r.apply(this,e)),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(r=>r!==e):delete this.callbacks[t]),this}once(t,e){const n=(...r)=>{this.off(t,n),e.apply(this,r)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},Zy=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},yX=(t,e)=>{if(Xb(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function Jf(t){var e;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=t,{view:l}=n;if(l.composing)return!1;const c=l.state.doc.resolve(r);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(d=>d.type.spec.code))return!1;let u=!1;const h=$J(c)+i;return o.forEach(d=>{if(u)return;const f=yX(h,d.find);if(!f)return;const g=l.state.tr,y=Gy({state:l.state,transaction:g}),v={from:r-(f[0].length-i.length),to:s},{commands:w,chain:T,can:E}=new Qy({editor:n,state:y});d.handler({state:y,range:v,match:f,commands:w,chain:T,can:E})===null||!g.steps.length||(d.undoable&&g.setMeta(a,{transform:g,from:r,to:s,text:i}),l.dispatch(g),u=!0)}),u}function vX(t){const{editor:e,rules:n}=t,r=new pt({state:{init(){return null},apply(s,i,o){const a=s.getMeta(r);if(a)return a;const l=s.getMeta("applyInputRules");return!!l&&setTimeout(()=>{let{text:u}=l;typeof u=="string"?u=u:u=eT(te.from(u),o.schema);const{from:h}=l,d=h+u.length;Jf({editor:e,from:h,to:d,text:u,rules:n,plugin:r})}),s.selectionSet||s.docChanged?null:i}},props:{handleTextInput(s,i,o,a){return Jf({editor:e,from:i,to:o,text:a,rules:n,plugin:r})},handleDOMEvents:{compositionend:s=>(setTimeout(()=>{const{$cursor:i}=s.state.selection;i&&Jf({editor:e,from:i.pos,to:i.pos,text:"",rules:n,plugin:r})}),!1)},handleKeyDown(s,i){if(i.key!=="Enter")return!1;const{$cursor:o}=s.state.selection;return o?Jf({editor:e,from:o.pos,to:o.pos,text:`
`,rules:n,plugin:r}):!1}},isInputRules:!0});return r}function wX(t){return Object.prototype.toString.call(t).slice(8,-1)}function Xf(t){return wX(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function xj(t,e){const n={...t};return Xf(t)&&Xf(e)&&Object.keys(e).forEach(r=>{Xf(e[r])&&Xf(t[r])?n[r]=xj(t[r],e[r]):n[r]=e[r]}),n}var nT=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Qe(ve(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Qe(ve(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){const e=this.extend({...this.config,addOptions:()=>xj(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){const e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},fl=class bj extends nT{constructor(){super(...arguments),this.type="mark"}static create(e={}){const n=typeof e=="function"?e():e;return new bj(n)}static handleExit({editor:e,mark:n}){const{tr:r}=e.state,s=e.state.selection.$from;if(s.pos===s.end()){const o=s.marks();if(!!!o.find(c=>(c==null?void 0:c.type.name)===n.name))return!1;const l=o.find(c=>(c==null?void 0:c.type.name)===n.name);return l&&r.removeStoredMark(l),r.insertText(" ",s.pos),e.view.dispatch(r),!0}return!1}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function _X(t){return typeof t=="number"}var xX=class{constructor(t){this.find=t.find,this.handler=t.handler}},bX=(t,e,n)=>{if(Xb(e))return[...t.matchAll(e)];const r=e(t,n);return r?r.map(s=>{const i=[s.text];return i.index=s.index,i.input=t,i.data=s.data,s.replaceWith&&(s.text.includes(s.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),i.push(s.replaceWith)),i}):[]};function TX(t){const{editor:e,state:n,from:r,to:s,rule:i,pasteEvent:o,dropEvent:a}=t,{commands:l,chain:c,can:u}=new Qy({editor:e,state:n}),h=[];return n.doc.nodesBetween(r,s,(f,g)=>{var y,v,w,T,E;if((v=(y=f.type)==null?void 0:y.spec)!=null&&v.code||!(f.isText||f.isTextblock||f.isInline))return;const R=(E=(T=(w=f.content)==null?void 0:w.size)!=null?T:f.nodeSize)!=null?E:0,P=Math.max(r,g),N=Math.min(s,g+R);if(P>=N)return;const k=f.isText?f.text||"":f.textBetween(P-g,N-g,void 0,"");bX(k,i.find,o).forEach(x=>{if(x.index===void 0)return;const S=P+x.index+1,A=S+x[0].length,M={from:n.tr.mapping.map(S),to:n.tr.mapping.map(A)},I=i.handler({state:n,range:M,match:x,commands:l,chain:c,can:u,pasteEvent:o,dropEvent:a});h.push(I)})}),h.every(f=>f!==null)}var Yf=null,EX=t=>{var e;const n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function SX(t){const{editor:e,rules:n}=t;let r=null,s=!1,i=!1,o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a;try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}const l=({state:u,from:h,to:d,rule:f,pasteEvt:g})=>{const y=u.tr,v=Gy({state:u,transaction:y});if(!(!TX({editor:e,state:v,from:Math.max(h-1,0),to:d.b-1,rule:f,pasteEvent:g,dropEvent:a})||!y.steps.length)){try{a=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{a=null}return o=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,y}};return n.map(u=>new pt({view(h){const d=g=>{var y;r=(y=h.dom.parentElement)!=null&&y.contains(g.target)?h.dom.parentElement:null,r&&(Yf=e)},f=()=>{Yf&&(Yf=null)};return window.addEventListener("dragstart",d),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",d),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(h,d)=>{if(i=r===h.dom.parentElement,a=d,!i){const f=Yf;f!=null&&f.isEditable&&setTimeout(()=>{const g=f.state.selection;g&&f.commands.deleteRange({from:g.from,to:g.to})},10)}return!1},paste:(h,d)=>{var f;const g=(f=d.clipboardData)==null?void 0:f.getData("text/html");return o=d,s=!!(g!=null&&g.includes("data-pm-slice")),!1}}},appendTransaction:(h,d,f)=>{const g=h[0],y=g.getMeta("uiEvent")==="paste"&&!s,v=g.getMeta("uiEvent")==="drop"&&!i,w=g.getMeta("applyPasteRules"),T=!!w;if(!y&&!v&&!T)return;if(T){let{text:P}=w;typeof P=="string"?P=P:P=eT(te.from(P),f.schema);const{from:N}=w,k=N+P.length,_=EX(P);return l({rule:u,state:f,from:N,to:{b:k},pasteEvt:_})}const E=d.doc.content.findDiffStart(f.doc.content),R=d.doc.content.findDiffEnd(f.doc.content);if(!(!_X(E)||!R||E===R.b))return l({rule:u,state:f,from:E,to:R,pasteEvt:o})}}))}var ev=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=fj(t),this.schema=LJ(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{const n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Qf(e.name,this.schema)},r=ve(e,"addCommands",n);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this;return ug([...this.extensions].reverse()).flatMap(r=>{const s={name:r.name,options:r.options,storage:this.editor.extensionStorage[r.name],editor:t,type:Qf(r.name,this.schema)},i=[],o=ve(r,"addKeyboardShortcuts",s);let a={};if(r.type==="mark"&&ve(r,"exitable",s)&&(a.ArrowRight=()=>fl.handleExit({editor:t,mark:r})),o){const d=Object.fromEntries(Object.entries(o()).map(([f,g])=>[f,()=>g({editor:t})]));a={...a,...d}}const l=BQ(a);i.push(l);const c=ve(r,"addInputRules",s);if(JI(r,t.options.enableInputRules)&&c){const d=c();if(d&&d.length){const f=vX({editor:t,rules:d}),g=Array.isArray(f)?f:[f];i.push(...g)}}const u=ve(r,"addPasteRules",s);if(JI(r,t.options.enablePasteRules)&&u){const d=u();if(d&&d.length){const f=SX({editor:t,rules:d});i.push(...f)}}const h=ve(r,"addProseMirrorPlugins",s);if(h){const d=h();i.push(...d)}return i})}get attributes(){return dj(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Hc(this.extensions);return Object.fromEntries(e.filter(n=>!!ve(n,"addNodeView")).map(n=>{const r=this.attributes.filter(l=>l.type===n.name),s={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Kt(n.name,this.schema)},i=ve(n,"addNodeView",s);if(!i)return[];const o=i();if(!o)return[];const a=(l,c,u,h,d)=>{const f=xd(l,r);return o({node:l,view:c,getPos:u,decorations:h,innerDecorations:d,editor:t,extension:n,HTMLAttributes:f})};return[n.name,a]}))}dispatchTransaction(t){const{editor:e}=this;return ug([...this.extensions].reverse()).reduceRight((r,s)=>{const i={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:e,type:Qf(s.name,this.schema)},o=ve(s,"dispatchTransaction",i);return o?a=>{o.call(i,{transaction:a,next:r})}:r},t)}get markViews(){const{editor:t}=this,{markExtensions:e}=Hc(this.extensions);return Object.fromEntries(e.filter(n=>!!ve(n,"addMarkView")).map(n=>{const r=this.attributes.filter(a=>a.type===n.name),s={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Ei(n.name,this.schema)},i=ve(n,"addMarkView",s);if(!i)return[];const o=(a,l,c)=>{const u=xd(a,r);return i()({mark:a,view:l,inline:c,editor:t,extension:n,HTMLAttributes:u,updateAttributes:h=>{BX(a,t,h)}})};return[n.name,o]}))}setupExtensions(){const t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;const r={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:Qf(e.name,this.schema)};e.type==="mark"&&((n=Qe(ve(e,"keepOnSplit",r)))==null||n)&&this.splittableMarks.push(e.name);const s=ve(e,"onBeforeCreate",r),i=ve(e,"onCreate",r),o=ve(e,"onUpdate",r),a=ve(e,"onSelectionUpdate",r),l=ve(e,"onTransaction",r),c=ve(e,"onFocus",r),u=ve(e,"onBlur",r),h=ve(e,"onDestroy",r);s&&this.editor.on("beforeCreate",s),i&&this.editor.on("create",i),o&&this.editor.on("update",o),a&&this.editor.on("selectionUpdate",a),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),u&&this.editor.on("blur",u),h&&this.editor.on("destroy",h)})}};ev.resolve=fj;ev.sort=ug;ev.flatten=Zb;var kX={};Jb(kX,{ClipboardTextSerializer:()=>Ej,Commands:()=>Sj,Delete:()=>kj,Drop:()=>Cj,Editable:()=>Ij,FocusEvents:()=>Rj,Keymap:()=>Nj,Paste:()=>Pj,Tabindex:()=>Mj,TextDirection:()=>Oj,focusEventsPluginKey:()=>Aj});var Lt=class Tj extends nT{constructor(){super(...arguments),this.type="extension"}static create(e={}){const n=typeof e=="function"?e():e;return new Tj(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}},Ej=Lt.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new pt({key:new Dt("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:s}=e,{ranges:i}=s,o=Math.min(...i.map(u=>u.$from.pos)),a=Math.max(...i.map(u=>u.$to.pos)),l=mj(n);return pj(r,{from:o,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),Sj=Lt.create({name:"commands",addCommands(){return{...nj}}}),kj=Lt.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,r,s;const i=()=>{var o,a,l,c;if((c=(l=(a=(o=this.editor.options.coreExtensionOptions)==null?void 0:o.delete)==null?void 0:a.filterTransaction)==null?void 0:l.call(a,t))!=null?c:t.getMeta("y-sync$"))return;const u=cj(t.before,[t,...e]);yj(u).forEach(f=>{u.mapping.mapResult(f.oldRange.from).deletedAfter&&u.mapping.mapResult(f.oldRange.to).deletedBefore&&u.before.nodesBetween(f.oldRange.from,f.oldRange.to,(g,y)=>{const v=y+g.nodeSize-2,w=f.oldRange.from<=y&&v<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:g,from:y,to:v,newFrom:u.mapping.map(y),newTo:u.mapping.map(v),deletedRange:f.oldRange,newRange:f.newRange,partial:!w,editor:this.editor,transaction:t,combinedTransform:u})})});const d=u.mapping;u.steps.forEach((f,g)=>{var y,v;if(f instanceof rs){const w=d.slice(g).map(f.from,-1),T=d.slice(g).map(f.to),E=d.invert().map(w,-1),R=d.invert().map(T),P=(y=u.doc.nodeAt(w-1))==null?void 0:y.marks.some(k=>k.eq(f.mark)),N=(v=u.doc.nodeAt(T))==null?void 0:v.marks.some(k=>k.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:E,to:R},newRange:{from:w,to:T},partial:!!(N||P),editor:this.editor,transaction:t,combinedTransform:u})}})};(s=(r=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:r.async)==null||s?setTimeout(i,0):i()}}),Cj=Lt.create({name:"drop",addProseMirrorPlugins(){return[new pt({key:new Dt("tiptapDrop"),props:{handleDrop:(t,e,n,r)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:r})}}})]}}),Ij=Lt.create({name:"editable",addProseMirrorPlugins(){return[new pt({key:new Dt("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Aj=new Dt("focusEvents"),Rj=Lt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new pt({key:Aj,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),Nj=Lt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first(({commands:o})=>[()=>o.undoInputRule(),()=>o.command(({tr:a})=>{const{selection:l,doc:c}=a,{empty:u,$anchor:h}=l,{pos:d,parent:f}=h,g=h.parent.isTextblock&&d>0?a.doc.resolve(d-1):h,y=g.parent.type.spec.isolating,v=h.pos-h.parentOffset,w=y&&g.parent.childCount===1?v===h.pos:ke.atStart(c).from===d;return!u||!f.type.isTextblock||f.textContent.length||!w||w&&h.parent.type.name==="paragraph"?!1:o.clearNodes()}),()=>o.deleteSelection(),()=>o.joinBackward(),()=>o.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:o})=>[()=>o.deleteSelection(),()=>o.deleteCurrentNode(),()=>o.joinForward(),()=>o.selectNodeForward()]),r={Enter:()=>this.editor.commands.first(({commands:o})=>[()=>o.newlineInCode(),()=>o.createParagraphNear(),()=>o.liftEmptyBlock(),()=>o.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...r},i={...r,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return cg()||aj()?i:s},addProseMirrorPlugins(){return[new pt({key:new Dt("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(y=>y.getMeta("composition")))return;const r=t.some(y=>y.docChanged)&&!e.doc.eq(n.doc),s=t.some(y=>y.getMeta("preventClearDocument"));if(!r||s)return;const{empty:i,from:o,to:a}=e.selection,l=ke.atStart(e.doc).from,c=ke.atEnd(e.doc).to;if(i||!(o===l&&a===c)||!Yy(n.doc))return;const d=n.tr,f=Gy({state:n,transaction:d}),{commands:g}=new Qy({editor:this.editor,state:f});if(g.clearNodes(),!!d.steps.length)return d}})]}}),Pj=Lt.create({name:"paste",addProseMirrorPlugins(){return[new pt({key:new Dt("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Mj=Lt.create({name:"tabindex",addProseMirrorPlugins(){return[new pt({key:new Dt("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Oj=Lt.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];const{nodeExtensions:t}=Hc(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{const n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new pt({key:new Dt("textDirection"),props:{attributes:()=>{const t=this.options.direction;return t?{dir:t}:{}}}})]}}),CX=class Ll{constructor(e,n,r=!1,s=null){this.currentNode=null,this.actualDepth=null,this.isBlock=r,this.resolvedPos=e,this.editor=n,this.currentNode=s}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,r=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You cant set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,r=this.to-1}this.editor.commands.insertContentAt({from:n,to:r},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Ll(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Ll(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Ll(e,this.editor)}get children(){const e=[];return this.node.content.forEach((n,r)=>{const s=n.isBlock&&!n.isTextblock,i=n.isAtom&&!n.isText,o=this.pos+r+(i?0:1);if(o<0||o>this.resolvedPos.doc.nodeSize-2)return;const a=this.resolvedPos.doc.resolve(o);if(!s&&a.depth<=this.depth)return;const l=new Ll(a,this.editor,s,s?n:null);s&&(l.actualDepth=this.depth+1),e.push(new Ll(a,this.editor,s,s?n:null))}),e}get firstChild(){return this.children[0]||null}get lastChild(){const e=this.children;return e[e.length-1]||null}closest(e,n={}){let r=null,s=this.parent;for(;s&&!r;){if(s.node.type.name===e)if(Object.keys(n).length>0){const i=s.node.attrs,o=Object.keys(n);for(let a=0;a<o.length;a+=1){const l=o[a];if(i[l]!==n[l])break}}else r=s;s=s.parent}return r}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},r=!1){let s=[];if(!this.children||this.children.length===0)return s;const i=Object.keys(n);return this.children.forEach(o=>{r&&s.length>0||(o.node.type.name===e&&i.every(l=>n[l]===o.node.attrs[l])&&s.push(o),!(r&&s.length>0)&&(s=s.concat(o.querySelectorAll(e,n,r))))}),s}setAttribute(e){const{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},IX=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function AX(t,e,n){const r=document.querySelector("style[data-tiptap-style]");if(r!==null)return r;const s=document.createElement("style");return e&&s.setAttribute("nonce",e),s.setAttribute("data-tiptap-style",""),s.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(s),s}var RX=class extends gX{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:r})=>{throw r},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:KJ,createMappablePosition:GJ},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:r,slice:s,moved:i})=>this.options.onDrop(r,s,i)),this.on("paste",({event:r,slice:s})=>this.options.onPaste(r,s)),this.on("delete",this.options.onDelete);const e=this.createDoc(),n=ij(e,this.options.autofocus);this.editorState=Yl.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){const t=this.editorView.dom;t!=null&&t.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=AX(IX,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){const n=hj(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}unregisterPlugin(t){if(this.isDestroyed)return;const e=this.state.plugins;let n=e;if([].concat(t).forEach(s=>{const i=typeof s=="string"?`${s}$`:s.key;n=n.filter(o=>!o.key.startsWith(i))}),e.length===n.length)return;const r=this.state.reconfigure({plugins:n});return this.view.updateState(r),r}createExtensionManager(){var t,e;const r=[...this.options.enableCoreExtensions?[Ij,Ej.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),Sj,Rj,Nj,Mj,Cj,Pj,kj,Oj.configure({direction:this.options.textDirection})].filter(s=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[s.name]!==!1:!0):[],...this.options.extensions].filter(s=>["extension","node","mark"].includes(s==null?void 0:s.type));this.extensionManager=new ev(r,this)}createCommandManager(){this.commandManager=new Qy({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=G1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),t=G1(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){const{editorProps:e,enableExtensionDispatchTransaction:n}=this.options,r=e.dispatchTransaction||this.dispatchTransaction.bind(this),s=n?this.extensionManager.dispatchTransaction(r):r;this.editorView=new tj(t,{...e,attributes:{role:"textbox",...e==null?void 0:e.attributes},dispatchTransaction:s,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});const i=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(i),this.prependClass(),this.injectCSS();const o=this.view.dom;o.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(c=>{var u;return(u=this.capturedTransaction)==null?void 0:u.step(c)});return}const{state:e,transactions:n}=this.state.applyTransaction(t),r=!this.state.selection.eq(e.selection),s=n.includes(t),i=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!s)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),r&&this.emit("selectionUpdate",{editor:this,transaction:t});const o=n.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),a=o==null?void 0:o.getMeta("focus"),l=o==null?void 0:o.getMeta("blur");a&&this.emit("focus",{editor:this,event:a.event,transaction:o}),l&&this.emit("blur",{editor:this,event:l.event,transaction:o}),!(t.getMeta("preventUpdate")||!n.some(c=>c.docChanged)||i.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return gj(this.state,t)}isActive(t,e){const n=typeof t=="string"?t:null,r=typeof t=="string"?e:t;return HJ(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return eT(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return VJ(this.state.doc,{blockSeparator:e,textSerializers:{...mj(this.schema),...n}})}get isEmpty(){return Yy(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new CX(e,this)}get $doc(){return this.$pos(0)}};function Wc(t){return new Zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=Qe(t.getAttributes,void 0,r);if(s===!1||s===null)return null;const{tr:i}=e,o=r[r.length-1],a=r[0];if(o){const l=a.search(/\S/),c=n.from+a.indexOf(o),u=c+o.length;if(tT(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(y=>y===t.type&&y!==f.mark.type)).filter(f=>f.to>c).length)return null;u<n.to&&i.delete(u,n.to),c>n.from&&i.delete(n.from+l,c);const d=n.from+l+o.length;i.addMark(n.from+l,d,t.type.create(s||{})),i.removeStoredMark(t.type)}},undoable:t.undoable})}function Dj(t){return new Zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=Qe(t.getAttributes,void 0,r)||{},{tr:i}=e,o=n.from;let a=n.to;const l=t.type.create(s);if(r[1]){const c=r[0].lastIndexOf(r[1]);let u=o+c;u>a?u=a:a=u+r[1].length;const h=r[0][r[0].length-1];i.insertText(h,o+r[0].length-1),i.replaceWith(u,a,l)}else if(r[0]){const c=t.type.isInline?o:o-1;i.insert(c,t.type.create(s)).delete(i.mapping.map(o),i.mapping.map(a))}i.scrollIntoView()},undoable:t.undoable})}function J1(t){return new Zy({find:t.find,handler:({state:e,range:n,match:r})=>{const s=e.doc.resolve(n.from),i=Qe(t.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,i)},undoable:t.undoable})}function qc(t){return new Zy({find:t.find,handler:({state:e,range:n,match:r,chain:s})=>{const i=Qe(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),l=o.doc.resolve(n.from).blockRange(),c=l&&Pb(l,t.type,i);if(!c)return null;if(o.wrap(l,c),t.keepMarks&&t.editor){const{selection:h,storedMarks:d}=e,{splittableMarks:f}=t.editor.extensionManager,g=d||h.$to.parentOffset&&h.$from.marks();if(g){const y=g.filter(v=>f.includes(v.type.name));o.ensureMarks(y)}}if(t.keepAttributes){const h=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";s().updateAttributes(h,i).run()}const u=o.doc.resolve(n.from-1).nodeBefore;u&&u.type===t.type&&$o(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,u))&&o.join(n.from-1)},undoable:t.undoable})}var NX=t=>"touches"in t,PX=class{constructor(t){this.directions=["bottom-left","bottom-right","top-left","top-right"],this.minSize={height:8,width:8},this.preserveAspectRatio=!1,this.classNames={container:"",wrapper:"",handle:"",resizing:""},this.initialWidth=0,this.initialHeight=0,this.aspectRatio=1,this.isResizing=!1,this.activeHandle=null,this.startX=0,this.startY=0,this.startWidth=0,this.startHeight=0,this.isShiftKeyPressed=!1,this.lastEditableState=void 0,this.handleMap=new Map,this.handleMouseMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.clientX-this.startX,c=a.clientY-this.startY;this.handleResize(l,c)},this.handleTouchMove=a=>{if(!this.isResizing||!this.activeHandle)return;const l=a.touches[0];if(!l)return;const c=l.clientX-this.startX,u=l.clientY-this.startY;this.handleResize(c,u)},this.handleMouseUp=()=>{if(!this.isResizing)return;const a=this.element.offsetWidth,l=this.element.offsetHeight;this.onCommit(a,l),this.isResizing=!1,this.activeHandle=null,this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)},this.handleKeyDown=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!0)},this.handleKeyUp=a=>{a.key==="Shift"&&(this.isShiftKeyPressed=!1)};var e,n,r,s,i,o;this.node=t.node,this.editor=t.editor,this.element=t.element,this.contentElement=t.contentElement,this.getPos=t.getPos,this.onResize=t.onResize,this.onCommit=t.onCommit,this.onUpdate=t.onUpdate,(e=t.options)!=null&&e.min&&(this.minSize={...this.minSize,...t.options.min}),(n=t.options)!=null&&n.max&&(this.maxSize=t.options.max),(r=t==null?void 0:t.options)!=null&&r.directions&&(this.directions=t.options.directions),(s=t.options)!=null&&s.preserveAspectRatio&&(this.preserveAspectRatio=t.options.preserveAspectRatio),(i=t.options)!=null&&i.className&&(this.classNames={container:t.options.className.container||"",wrapper:t.options.className.wrapper||"",handle:t.options.className.handle||"",resizing:t.options.className.resizing||""}),(o=t.options)!=null&&o.createCustomHandle&&(this.createCustomHandle=t.options.createCustomHandle),this.wrapper=this.createWrapper(),this.container=this.createContainer(),this.applyInitialSize(),this.attachHandles(),this.editor.on("update",this.handleEditorUpdate.bind(this))}get dom(){return this.container}get contentDOM(){return this.contentElement}handleEditorUpdate(){const t=this.editor.isEditable;t!==this.lastEditableState&&(this.lastEditableState=t,t?t&&this.handleMap.size===0&&this.attachHandles():this.removeHandles())}update(t,e,n){return t.type!==this.node.type?!1:(this.node=t,this.onUpdate?this.onUpdate(t,e,n):!0)}destroy(){this.isResizing&&(this.container.dataset.resizeState="false",this.classNames.resizing&&this.container.classList.remove(this.classNames.resizing),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp),this.isResizing=!1,this.activeHandle=null),this.editor.off("update",this.handleEditorUpdate.bind(this)),this.container.remove()}createContainer(){const t=document.createElement("div");return t.dataset.resizeContainer="",t.dataset.node=this.node.type.name,t.style.display="flex",this.classNames.container&&(t.className=this.classNames.container),t.appendChild(this.wrapper),t}createWrapper(){const t=document.createElement("div");return t.style.position="relative",t.style.display="block",t.dataset.resizeWrapper="",this.classNames.wrapper&&(t.className=this.classNames.wrapper),t.appendChild(this.element),t}createHandle(t){const e=document.createElement("div");return e.dataset.resizeHandle=t,e.style.position="absolute",this.classNames.handle&&(e.className=this.classNames.handle),e}positionHandle(t,e){const n=e.includes("top"),r=e.includes("bottom"),s=e.includes("left"),i=e.includes("right");n&&(t.style.top="0"),r&&(t.style.bottom="0"),s&&(t.style.left="0"),i&&(t.style.right="0"),(e==="top"||e==="bottom")&&(t.style.left="0",t.style.right="0"),(e==="left"||e==="right")&&(t.style.top="0",t.style.bottom="0")}attachHandles(){this.directions.forEach(t=>{let e;this.createCustomHandle?e=this.createCustomHandle(t):e=this.createHandle(t),e instanceof HTMLElement||(console.warn(`[ResizableNodeView] createCustomHandle("${t}") did not return an HTMLElement. Falling back to default handle.`),e=this.createHandle(t)),this.createCustomHandle||this.positionHandle(e,t),e.addEventListener("mousedown",n=>this.handleResizeStart(n,t)),e.addEventListener("touchstart",n=>this.handleResizeStart(n,t)),this.handleMap.set(t,e),this.wrapper.appendChild(e)})}removeHandles(){this.handleMap.forEach(t=>t.remove()),this.handleMap.clear()}applyInitialSize(){const t=this.node.attrs.width,e=this.node.attrs.height;t?(this.element.style.width=`${t}px`,this.initialWidth=t):this.initialWidth=this.element.offsetWidth,e?(this.element.style.height=`${e}px`,this.initialHeight=e):this.initialHeight=this.element.offsetHeight,this.initialWidth>0&&this.initialHeight>0&&(this.aspectRatio=this.initialWidth/this.initialHeight)}handleResizeStart(t,e){t.preventDefault(),t.stopPropagation(),this.isResizing=!0,this.activeHandle=e,NX(t)?(this.startX=t.touches[0].clientX,this.startY=t.touches[0].clientY):(this.startX=t.clientX,this.startY=t.clientY),this.startWidth=this.element.offsetWidth,this.startHeight=this.element.offsetHeight,this.startWidth>0&&this.startHeight>0&&(this.aspectRatio=this.startWidth/this.startHeight),this.getPos(),this.container.dataset.resizeState="true",this.classNames.resizing&&this.container.classList.add(this.classNames.resizing),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("touchmove",this.handleTouchMove),document.addEventListener("mouseup",this.handleMouseUp),document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleResize(t,e){if(!this.activeHandle)return;const n=this.preserveAspectRatio||this.isShiftKeyPressed,{width:r,height:s}=this.calculateNewDimensions(this.activeHandle,t,e),i=this.applyConstraints(r,s,n);this.element.style.width=`${i.width}px`,this.element.style.height=`${i.height}px`,this.onResize&&this.onResize(i.width,i.height)}calculateNewDimensions(t,e,n){let r=this.startWidth,s=this.startHeight;const i=t.includes("right"),o=t.includes("left"),a=t.includes("bottom"),l=t.includes("top");return i?r=this.startWidth+e:o&&(r=this.startWidth-e),a?s=this.startHeight+n:l&&(s=this.startHeight-n),(t==="right"||t==="left")&&(r=this.startWidth+(i?e:-e)),(t==="top"||t==="bottom")&&(s=this.startHeight+(a?n:-n)),this.preserveAspectRatio||this.isShiftKeyPressed?this.applyAspectRatio(r,s,t):{width:r,height:s}}applyConstraints(t,e,n){var r,s,i,o;if(!n){let c=Math.max(this.minSize.width,t),u=Math.max(this.minSize.height,e);return(r=this.maxSize)!=null&&r.width&&(c=Math.min(this.maxSize.width,c)),(s=this.maxSize)!=null&&s.height&&(u=Math.min(this.maxSize.height,u)),{width:c,height:u}}let a=t,l=e;return a<this.minSize.width&&(a=this.minSize.width,l=a/this.aspectRatio),l<this.minSize.height&&(l=this.minSize.height,a=l*this.aspectRatio),(i=this.maxSize)!=null&&i.width&&a>this.maxSize.width&&(a=this.maxSize.width,l=a/this.aspectRatio),(o=this.maxSize)!=null&&o.height&&l>this.maxSize.height&&(l=this.maxSize.height,a=l*this.aspectRatio),{width:a,height:l}}applyAspectRatio(t,e,n){const r=n==="left"||n==="right",s=n==="top"||n==="bottom";return r?{width:t,height:t/this.aspectRatio}:s?{width:e*this.aspectRatio,height:e}:{width:t,height:t/this.aspectRatio}}};function MX(t,e){const{selection:n}=t,{$from:r}=n;if(n instanceof _e){const i=r.index();return r.parent.canReplaceWith(i,i+1,e)}let s=r.depth;for(;s>=0;){const i=r.index(s);if(r.node(s).contentMatchAt(i).matchType(e))return!0;s-=1}return!1}var OX={};Jb(OX,{createAtomBlockMarkdownSpec:()=>DX,createBlockMarkdownSpec:()=>LX,createInlineMarkdownSpec:()=>FX,parseAttributes:()=>rT,parseIndentedBlocks:()=>X1,renderNestedMarkdownContent:()=>iT,serializeAttributes:()=>sT});function rT(t){if(!(t!=null&&t.trim()))return{};const e={},n=[],r=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),s=r.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(s){const c=s.map(u=>u.trim().slice(1));e.class=c.join(" ")}const i=r.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);i&&(e.id=i[1]);const o=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(r.matchAll(o)).forEach(([,c,u])=>{var h;const d=parseInt(((h=u.match(/__QUOTED_(\d+)__/))==null?void 0:h[1])||"0",10),f=n[d];f&&(e[c]=f.slice(1,-1))});const l=r.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(u=>{u.match(/^[a-zA-Z][\w-]*$/)&&(e[u]=!0)}),e}function sT(t){if(!t||Object.keys(t).length===0)return"";const e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(r=>e.push(`.${r}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,r])=>{n==="class"||n==="id"||(r===!0?e.push(n):r!==!1&&r!=null&&e.push(`${n}="${String(r)}"`))}),e.join(" ")}function DX(t){const{nodeName:e,name:n,parseAttributes:r=rT,serializeAttributes:s=sT,defaultAttributes:i={},requiredAttributes:o=[],allowedAttributes:a}=t,l=n||e,c=u=>{if(!a)return u;const h={};return a.forEach(d=>{d in u&&(h[d]=u[d])}),h};return{parseMarkdown:(u,h)=>{const d={...i,...u.attributes};return h.createNode(e,d,[])},markdownTokenizer:{name:e,level:"block",start(u){var h;const d=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(h=u.match(d))==null?void 0:h.index;return f!==void 0?f:-1},tokenize(u,h,d){const f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),g=u.match(f);if(!g)return;const y=g[1]||"",v=r(y);if(!o.find(T=>!(T in v)))return{type:e,raw:g[0],attributes:v}}},renderMarkdown:u=>{const h=c(u.attrs||{}),d=s(h),f=d?` {${d}}`:"";return`:::${l}${f} :::`}}}function LX(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=rT,serializeAttributes:i=sT,defaultAttributes:o={},content:a="block",allowedAttributes:l}=t,c=n||e,u=h=>{if(!l)return h;const d={};return l.forEach(f=>{f in h&&(d[f]=h[f])}),d};return{parseMarkdown:(h,d)=>{let f;if(r){const y=r(h);f=typeof y=="string"?[{type:"text",text:y}]:y}else a==="block"?f=d.parseChildren(h.tokens||[]):f=d.parseInline(h.tokens||[]);const g={...o,...h.attributes};return d.createNode(e,g,f)},markdownTokenizer:{name:e,level:"block",start(h){var d;const f=new RegExp(`^:::${c}`,"m"),g=(d=h.match(f))==null?void 0:d.index;return g!==void 0?g:-1},tokenize(h,d,f){var g;const y=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),v=h.match(y);if(!v)return;const[w,T=""]=v,E=s(T);let R=1;const P=w.length;let N="";const k=/^:::([\w-]*)(\s.*)?/gm,_=h.slice(P);for(k.lastIndex=0;;){const x=k.exec(_);if(x===null)break;const S=x.index,A=x[1];if(!((g=x[2])!=null&&g.endsWith(":::"))){if(A)R+=1;else if(R-=1,R===0){const M=_.slice(0,S);N=M.trim();const I=h.slice(0,P+S+x[0].length);let j=[];if(N)if(a==="block")for(j=f.blockTokens(M),j.forEach(B=>{B.text&&(!B.tokens||B.tokens.length===0)&&(B.tokens=f.inlineTokens(B.text))});j.length>0;){const B=j[j.length-1];if(B.type==="paragraph"&&(!B.text||B.text.trim()===""))j.pop();else break}else j=f.inlineTokens(N);return{type:e,raw:I,attributes:E,content:N,tokens:j}}}}}},renderMarkdown:(h,d)=>{const f=u(h.attrs||{}),g=i(f),y=g?` {${g}}`:"",v=d.renderChildren(h.content||[],`

`);return`:::${c}${y}

${v}

:::`}}}function jX(t){if(!t.trim())return{};const e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g;let r=n.exec(t);for(;r!==null;){const[,s,i,o]=r;e[s]=i||o,r=n.exec(t)}return e}function VX(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function FX(t){const{nodeName:e,name:n,getContent:r,parseAttributes:s=jX,serializeAttributes:i=VX,defaultAttributes:o={},selfClosing:a=!1,allowedAttributes:l}=t,c=n||e,u=d=>{if(!l)return d;const f={};return l.forEach(g=>{const y=typeof g=="string"?g:g.name,v=typeof g=="string"?void 0:g.skipIfDefault;if(y in d){const w=d[y];if(v!==void 0&&w===v)return;f[y]=w}}),f},h=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(d,f)=>{const g={...o,...d.attributes};if(a)return f.createNode(e,g);const y=r?r(d):d.content||"";return y?f.createNode(e,g,[f.createTextNode(y)]):f.createNode(e,g,[])},markdownTokenizer:{name:e,level:"inline",start(d){const f=a?new RegExp(`\\[${h}\\s*[^\\]]*\\]`):new RegExp(`\\[${h}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${h}\\]`),g=d.match(f),y=g==null?void 0:g.index;return y!==void 0?y:-1},tokenize(d,f,g){const y=a?new RegExp(`^\\[${h}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${h}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${h}\\]`),v=d.match(y);if(!v)return;let w="",T="";if(a){const[,R]=v;T=R}else{const[,R,P]=v;T=R,w=P||""}const E=s(T.trim());return{type:e,raw:v[0],content:w.trim(),attributes:E}}},renderMarkdown:d=>{let f="";r?f=r(d):d.content&&d.content.length>0&&(f=d.content.filter(w=>w.type==="text").map(w=>w.text).join(""));const g=u(d.attrs||{}),y=i(g),v=y?` ${y}`:"";return a?`[${c}${v}]`:`[${c}${v}]${f}[/${c}]`}}}function X1(t,e,n){var r,s,i,o;const a=t.split(`
`),l=[];let c="",u=0;const h=e.baseIndentSize||2;for(;u<a.length;){const d=a[u],f=d.match(e.itemPattern);if(!f){if(l.length>0)break;if(d.trim()===""){u+=1,c=`${c}${d}
`;continue}else return}const g=e.extractItemData(f),{indentLevel:y,mainContent:v}=g;c=`${c}${d}
`;const w=[v];for(u+=1;u<a.length;){const P=a[u];if(P.trim()===""){const k=a.slice(u+1).findIndex(S=>S.trim()!=="");if(k===-1)break;if((((s=(r=a[u+1+k].match(/^(\s*)/))==null?void 0:r[1])==null?void 0:s.length)||0)>y){w.push(P),c=`${c}${P}
`,u+=1;continue}else break}if((((o=(i=P.match(/^(\s*)/))==null?void 0:i[1])==null?void 0:o.length)||0)>y)w.push(P),c=`${c}${P}
`,u+=1;else break}let T;const E=w.slice(1);if(E.length>0){const P=E.map(N=>N.slice(y+h)).join(`
`);P.trim()&&(e.customNestedParser?T=e.customNestedParser(P):T=n.blockTokens(P))}const R=e.createToken(g,T);l.push(R)}if(l.length!==0)return{items:l,raw:c}}function iT(t,e,n,r){if(!t||!Array.isArray(t.content))return"";const s=typeof n=="function"?n(r):n,[i,...o]=t.content,a=e.renderChildren([i]),l=[`${s}${a}`];return o&&o.length>0&&o.forEach(c=>{const u=e.renderChildren([c]);if(u){const h=u.split(`
`).map(d=>d?e.indent(d):"").join(`
`);l.push(h)}}),l.join(`
`)}function BX(t,e,n={}){const{state:r}=e,{doc:s,tr:i}=r,o=t;s.descendants((a,l)=>{const c=i.mapping.map(l),u=i.mapping.map(l)+a.nodeSize;let h=null;if(a.marks.forEach(f=>{if(f!==o)return!1;h=f}),!h)return;let d=!1;if(Object.keys(n).forEach(f=>{n[f]!==h.attrs[f]&&(d=!0)}),d){const f=t.type.create({...t.attrs,...n});i.removeMark(c,u,t.type),i.addMark(c,u,f)}}),i.docChanged&&e.view.dispatch(i)}var dn=class Lj extends nT{constructor(){super(...arguments),this.type="node"}static create(e={}){const n=typeof e=="function"?e():e;return new Lj(n)}configure(e){return super.configure(e)}extend(e){const n=typeof e=="function"?e():e;return super.extend(n)}};function nl(t){return new xX({find:t.find,handler:({state:e,range:n,match:r,pasteEvent:s})=>{const i=Qe(t.getAttributes,void 0,r,s);if(i===!1||i===null)return null;const{tr:o}=e,a=r[r.length-1],l=r[0];let c=n.to;if(a){const u=l.search(/\S/),h=n.from+l.indexOf(a),d=h+a.length;if(tT(n.from,n.to,e.doc).filter(g=>g.mark.type.excluded.find(v=>v===t.type&&v!==g.mark.type)).filter(g=>g.to>h).length)return null;d<n.to&&o.delete(d,n.to),h>n.from&&o.delete(n.from+u,h),c=n.from+u+a.length,o.addMark(n.from+u,c,t.type.create(i||{})),o.removeStoredMark(t.type)}}})}const{getOwnPropertyNames:UX,getOwnPropertySymbols:zX}=Object,{hasOwnProperty:$X}=Object.prototype;function D0(t,e){return function(r,s,i){return t(r,s,i)&&e(r,s,i)}}function Zf(t){return function(n,r,s){if(!n||!r||typeof n!="object"||typeof r!="object")return t(n,r,s);const{cache:i}=s,o=i.get(n),a=i.get(r);if(o&&a)return o===r&&a===n;i.set(n,r),i.set(r,n);const l=t(n,r,s);return i.delete(n),i.delete(r),l}}function HX(t){return t!=null?t[Symbol.toStringTag]:void 0}function ZI(t){return UX(t).concat(zX(t))}const WX=Object.hasOwn||((t,e)=>$X.call(t,e));function pl(t,e){return t===e||!t&&!e&&t!==t&&e!==e}const qX="__v",KX="__o",GX="_owner",{getOwnPropertyDescriptor:eA,keys:tA}=Object;function QX(t,e){return t.byteLength===e.byteLength&&hg(new Uint8Array(t),new Uint8Array(e))}function JX(t,e,n){let r=t.length;if(e.length!==r)return!1;for(;r-- >0;)if(!n.equals(t[r],e[r],r,r,t,e,n))return!1;return!0}function XX(t,e){return t.byteLength===e.byteLength&&hg(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength))}function YX(t,e){return pl(t.getTime(),e.getTime())}function ZX(t,e){return t.name===e.name&&t.message===e.message&&t.cause===e.cause&&t.stack===e.stack}function eY(t,e){return t===e}function nA(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=t.entries();let o,a,l=0;for(;(o=i.next())&&!o.done;){const c=e.entries();let u=!1,h=0;for(;(a=c.next())&&!a.done;){if(s[h]){h++;continue}const d=o.value,f=a.value;if(n.equals(d[0],f[0],l,h,t,e,n)&&n.equals(d[1],f[1],d[0],f[0],t,e,n)){u=s[h]=!0;break}h++}if(!u)return!1;l++}return!0}const tY=pl;function nY(t,e,n){const r=tA(t);let s=r.length;if(tA(e).length!==s)return!1;for(;s-- >0;)if(!jj(t,e,n,r[s]))return!1;return!0}function Fu(t,e,n){const r=ZI(t);let s=r.length;if(ZI(e).length!==s)return!1;let i,o,a;for(;s-- >0;)if(i=r[s],!jj(t,e,n,i)||(o=eA(t,i),a=eA(e,i),(o||a)&&(!o||!a||o.configurable!==a.configurable||o.enumerable!==a.enumerable||o.writable!==a.writable)))return!1;return!0}function rY(t,e){return pl(t.valueOf(),e.valueOf())}function sY(t,e){return t.source===e.source&&t.flags===e.flags}function rA(t,e,n){const r=t.size;if(r!==e.size)return!1;if(!r)return!0;const s=new Array(r),i=t.values();let o,a;for(;(o=i.next())&&!o.done;){const l=e.values();let c=!1,u=0;for(;(a=l.next())&&!a.done;){if(!s[u]&&n.equals(o.value,a.value,o.value,a.value,t,e,n)){c=s[u]=!0;break}u++}if(!c)return!1}return!0}function hg(t,e){let n=t.byteLength;if(e.byteLength!==n||t.byteOffset!==e.byteOffset)return!1;for(;n-- >0;)if(t[n]!==e[n])return!1;return!0}function iY(t,e){return t.hostname===e.hostname&&t.pathname===e.pathname&&t.protocol===e.protocol&&t.port===e.port&&t.hash===e.hash&&t.username===e.username&&t.password===e.password}function jj(t,e,n,r){return(r===GX||r===KX||r===qX)&&(t.$$typeof||e.$$typeof)?!0:WX(e,r)&&n.equals(t[r],e[r],r,r,t,e,n)}const oY="[object ArrayBuffer]",aY="[object Arguments]",lY="[object Boolean]",cY="[object DataView]",uY="[object Date]",hY="[object Error]",dY="[object Map]",fY="[object Number]",pY="[object Object]",mY="[object RegExp]",gY="[object Set]",yY="[object String]",vY={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},wY="[object URL]",_Y=Object.prototype.toString;function xY({areArrayBuffersEqual:t,areArraysEqual:e,areDataViewsEqual:n,areDatesEqual:r,areErrorsEqual:s,areFunctionsEqual:i,areMapsEqual:o,areNumbersEqual:a,areObjectsEqual:l,arePrimitiveWrappersEqual:c,areRegExpsEqual:u,areSetsEqual:h,areTypedArraysEqual:d,areUrlsEqual:f,unknownTagComparators:g}){return function(v,w,T){if(v===w)return!0;if(v==null||w==null)return!1;const E=typeof v;if(E!==typeof w)return!1;if(E!=="object")return E==="number"?a(v,w,T):E==="function"?i(v,w,T):!1;const R=v.constructor;if(R!==w.constructor)return!1;if(R===Object)return l(v,w,T);if(Array.isArray(v))return e(v,w,T);if(R===Date)return r(v,w,T);if(R===RegExp)return u(v,w,T);if(R===Map)return o(v,w,T);if(R===Set)return h(v,w,T);const P=_Y.call(v);if(P===uY)return r(v,w,T);if(P===mY)return u(v,w,T);if(P===dY)return o(v,w,T);if(P===gY)return h(v,w,T);if(P===pY)return typeof v.then!="function"&&typeof w.then!="function"&&l(v,w,T);if(P===wY)return f(v,w,T);if(P===hY)return s(v,w,T);if(P===aY)return l(v,w,T);if(vY[P])return d(v,w,T);if(P===oY)return t(v,w,T);if(P===cY)return n(v,w,T);if(P===lY||P===fY||P===yY)return c(v,w,T);if(g){let N=g[P];if(!N){const k=HX(v);k&&(N=g[k])}if(N)return N(v,w,T)}return!1}}function bY({circular:t,createCustomConfig:e,strict:n}){let r={areArrayBuffersEqual:QX,areArraysEqual:n?Fu:JX,areDataViewsEqual:XX,areDatesEqual:YX,areErrorsEqual:ZX,areFunctionsEqual:eY,areMapsEqual:n?D0(nA,Fu):nA,areNumbersEqual:tY,areObjectsEqual:n?Fu:nY,arePrimitiveWrappersEqual:rY,areRegExpsEqual:sY,areSetsEqual:n?D0(rA,Fu):rA,areTypedArraysEqual:n?D0(hg,Fu):hg,areUrlsEqual:iY,unknownTagComparators:void 0};if(e&&(r=Object.assign({},r,e(r))),t){const s=Zf(r.areArraysEqual),i=Zf(r.areMapsEqual),o=Zf(r.areObjectsEqual),a=Zf(r.areSetsEqual);r=Object.assign({},r,{areArraysEqual:s,areMapsEqual:i,areObjectsEqual:o,areSetsEqual:a})}return r}function TY(t){return function(e,n,r,s,i,o,a){return t(e,n,a)}}function EY({circular:t,comparator:e,createState:n,equals:r,strict:s}){if(n)return function(a,l){const{cache:c=t?new WeakMap:void 0,meta:u}=n();return e(a,l,{cache:c,equals:r,meta:u,strict:s})};if(t)return function(a,l){return e(a,l,{cache:new WeakMap,equals:r,meta:void 0,strict:s})};const i={cache:void 0,equals:r,meta:void 0,strict:s};return function(a,l){return e(a,l,i)}}const SY=Wo();Wo({strict:!0});Wo({circular:!0});Wo({circular:!0,strict:!0});Wo({createInternalComparator:()=>pl});Wo({strict:!0,createInternalComparator:()=>pl});Wo({circular:!0,createInternalComparator:()=>pl});Wo({circular:!0,createInternalComparator:()=>pl,strict:!0});function Wo(t={}){const{circular:e=!1,createInternalComparator:n,createState:r,strict:s=!1}=t,i=bY(t),o=xY(i),a=n?n(o):TY(o);return EY({circular:e,comparator:o,createState:r,equals:a,strict:s})}var Vj={exports:{}},Fj={};/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var tv=V,kY=Ab;function CY(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var IY=typeof Object.is=="function"?Object.is:CY,AY=kY.useSyncExternalStore,RY=tv.useRef,NY=tv.useEffect,PY=tv.useMemo,MY=tv.useDebugValue;Fj.useSyncExternalStoreWithSelector=function(t,e,n,r,s){var i=RY(null);if(i.current===null){var o={hasValue:!1,value:null};i.current=o}else o=i.current;i=PY(function(){function l(f){if(!c){if(c=!0,u=f,f=r(f),s!==void 0&&o.hasValue){var g=o.value;if(s(g,f))return h=g}return h=f}if(g=h,IY(u,f))return g;var y=r(f);return s!==void 0&&s(g,y)?(u=f,g):(u=f,h=y)}var c=!1,u,h,d=n===void 0?null:n;return[function(){return l(e())},d===null?void 0:function(){return l(d())}]},[e,n,r,s]);var a=AY(t,i[0],i[1]);return NY(function(){o.hasValue=!0,o.value=a},[a]),MY(a),a};Vj.exports=Fj;var OY=Vj.exports,DY=(...t)=>e=>{t.forEach(n=>{typeof n=="function"?n(e):n&&(n.current=e)})},LY=({contentComponent:t})=>{const e=Ab.useSyncExternalStore(t.subscribe,t.getSnapshot,t.getServerSnapshot);return p.jsx(p.Fragment,{children:Object.values(e)})};function jY(){const t=new Set;let e={};return{subscribe(n){return t.add(n),()=>{t.delete(n)}},getSnapshot(){return e},getServerSnapshot(){return e},setRenderer(n,r){e={...e,[n]:ux.createPortal(r.reactElement,r.element,n)},t.forEach(s=>s())},removeRenderer(n){const r={...e};delete r[n],e=r,t.forEach(s=>s())}}}var VY=class extends Xe.Component{constructor(t){var e;super(t),this.editorContentRef=Xe.createRef(),this.initialized=!1,this.state={hasContentComponentInitialized:!!((e=t.editor)!=null&&e.contentComponent)}}componentDidMount(){this.init()}componentDidUpdate(){this.init()}init(){var t;const e=this.props.editor;if(e&&!e.isDestroyed&&((t=e.view.dom)!=null&&t.parentNode)){if(e.contentComponent)return;const n=this.editorContentRef.current;n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n}),e.contentComponent=jY(),this.state.hasContentComponentInitialized||(this.unsubscribeToContentComponent=e.contentComponent.subscribe(()=>{this.setState(r=>r.hasContentComponentInitialized?r:{hasContentComponentInitialized:!0}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent()})),e.createNodeViews(),this.initialized=!0}}componentWillUnmount(){var t;const e=this.props.editor;if(e){this.initialized=!1,e.isDestroyed||e.view.setProps({nodeViews:{}}),this.unsubscribeToContentComponent&&this.unsubscribeToContentComponent(),e.contentComponent=null;try{if(!((t=e.view.dom)!=null&&t.parentNode))return;const n=document.createElement("div");n.append(...e.view.dom.parentNode.childNodes),e.setOptions({element:n})}catch{}}}render(){const{editor:t,innerRef:e,...n}=this.props;return p.jsxs(p.Fragment,{children:[p.jsx("div",{ref:DY(e,this.editorContentRef),...n}),(t==null?void 0:t.contentComponent)&&p.jsx(LY,{contentComponent:t.contentComponent})]})}},FY=V.forwardRef((t,e)=>{const n=Xe.useMemo(()=>Math.floor(Math.random()*4294967295).toString(),[t.editor]);return Xe.createElement(VY,{key:n,innerRef:e,...t})}),BY=Xe.memo(FY),UY=typeof window<"u"?V.useLayoutEffect:V.useEffect,zY=class{constructor(t){this.transactionNumber=0,this.lastTransactionNumber=0,this.subscribers=new Set,this.editor=t,this.lastSnapshot={editor:t,transactionNumber:0},this.getSnapshot=this.getSnapshot.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.watch=this.watch.bind(this),this.subscribe=this.subscribe.bind(this)}getSnapshot(){return this.transactionNumber===this.lastTransactionNumber?this.lastSnapshot:(this.lastTransactionNumber=this.transactionNumber,this.lastSnapshot={editor:this.editor,transactionNumber:this.transactionNumber},this.lastSnapshot)}getServerSnapshot(){return{editor:null,transactionNumber:0}}subscribe(t){return this.subscribers.add(t),()=>{this.subscribers.delete(t)}}watch(t){if(this.editor=t,this.editor){const e=()=>{this.transactionNumber+=1,this.subscribers.forEach(r=>r())},n=this.editor;return n.on("transaction",e),()=>{n.off("transaction",e)}}}};function $Y(t){var e;const[n]=V.useState(()=>new zY(t.editor)),r=OY.useSyncExternalStoreWithSelector(n.subscribe,n.getSnapshot,n.getServerSnapshot,t.selector,(e=t.equalityFn)!=null?e:SY);return UY(()=>n.watch(t.editor),[t.editor,n]),V.useDebugValue(r),r}var HY=!1,Y1=typeof window>"u",WY=Y1||!!(typeof window<"u"&&window.next),qY=class Bj{constructor(e){this.editor=null,this.subscriptions=new Set,this.isComponentMounted=!1,this.previousDeps=null,this.instanceId="",this.options=e,this.subscriptions=new Set,this.setEditor(this.getInitialEditor()),this.scheduleDestroy(),this.getEditor=this.getEditor.bind(this),this.getServerSnapshot=this.getServerSnapshot.bind(this),this.subscribe=this.subscribe.bind(this),this.refreshEditorInstance=this.refreshEditorInstance.bind(this),this.scheduleDestroy=this.scheduleDestroy.bind(this),this.onRender=this.onRender.bind(this),this.createEditor=this.createEditor.bind(this)}setEditor(e){this.editor=e,this.instanceId=Math.random().toString(36).slice(2,9),this.subscriptions.forEach(n=>n())}getInitialEditor(){return this.options.current.immediatelyRender===void 0?Y1||WY?null:this.createEditor():(this.options.current.immediatelyRender,this.options.current.immediatelyRender?this.createEditor():null)}createEditor(){const e={...this.options.current,onBeforeCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onBeforeCreate)==null?void 0:i.call(s,...r)},onBlur:(...r)=>{var s,i;return(i=(s=this.options.current).onBlur)==null?void 0:i.call(s,...r)},onCreate:(...r)=>{var s,i;return(i=(s=this.options.current).onCreate)==null?void 0:i.call(s,...r)},onDestroy:(...r)=>{var s,i;return(i=(s=this.options.current).onDestroy)==null?void 0:i.call(s,...r)},onFocus:(...r)=>{var s,i;return(i=(s=this.options.current).onFocus)==null?void 0:i.call(s,...r)},onSelectionUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onSelectionUpdate)==null?void 0:i.call(s,...r)},onTransaction:(...r)=>{var s,i;return(i=(s=this.options.current).onTransaction)==null?void 0:i.call(s,...r)},onUpdate:(...r)=>{var s,i;return(i=(s=this.options.current).onUpdate)==null?void 0:i.call(s,...r)},onContentError:(...r)=>{var s,i;return(i=(s=this.options.current).onContentError)==null?void 0:i.call(s,...r)},onDrop:(...r)=>{var s,i;return(i=(s=this.options.current).onDrop)==null?void 0:i.call(s,...r)},onPaste:(...r)=>{var s,i;return(i=(s=this.options.current).onPaste)==null?void 0:i.call(s,...r)},onDelete:(...r)=>{var s,i;return(i=(s=this.options.current).onDelete)==null?void 0:i.call(s,...r)}};return new RX(e)}getEditor(){return this.editor}getServerSnapshot(){return null}subscribe(e){return this.subscriptions.add(e),()=>{this.subscriptions.delete(e)}}static compareOptions(e,n){return Object.keys(e).every(r=>["onCreate","onBeforeCreate","onDestroy","onUpdate","onTransaction","onFocus","onBlur","onSelectionUpdate","onContentError","onDrop","onPaste"].includes(r)?!0:r==="extensions"&&e.extensions&&n.extensions?e.extensions.length!==n.extensions.length?!1:e.extensions.every((s,i)=>{var o;return s===((o=n.extensions)==null?void 0:o[i])}):e[r]===n[r])}onRender(e){return()=>(this.isComponentMounted=!0,clearTimeout(this.scheduledDestructionTimeout),this.editor&&!this.editor.isDestroyed&&e.length===0?Bj.compareOptions(this.options.current,this.editor.options)||this.editor.setOptions({...this.options.current,editable:this.editor.isEditable}):this.refreshEditorInstance(e),()=>{this.isComponentMounted=!1,this.scheduleDestroy()})}refreshEditorInstance(e){if(this.editor&&!this.editor.isDestroyed){if(this.previousDeps===null){this.previousDeps=e;return}if(this.previousDeps.length===e.length&&this.previousDeps.every((r,s)=>r===e[s]))return}this.editor&&!this.editor.isDestroyed&&this.editor.destroy(),this.setEditor(this.createEditor()),this.previousDeps=e}scheduleDestroy(){const e=this.instanceId,n=this.editor;this.scheduledDestructionTimeout=setTimeout(()=>{if(this.isComponentMounted&&this.instanceId===e){n&&n.setOptions(this.options.current);return}n&&!n.isDestroyed&&(n.destroy(),this.instanceId===e&&this.setEditor(null))},1)}};function KY(t={},e=[]){const n=V.useRef(t);n.current=t;const[r]=V.useState(()=>new qY(n)),s=Ab.useSyncExternalStore(r.subscribe,r.getEditor,r.getServerSnapshot);return V.useDebugValue(s),V.useEffect(r.onRender(e)),$Y({editor:s,selector:({transactionNumber:i})=>t.shouldRerenderOnTransaction===!1||t.shouldRerenderOnTransaction===void 0?null:t.immediatelyRender&&i===0?0:i+1}),s}var GY=V.createContext({editor:null});GY.Consumer;var QY=V.createContext({onDragStart:()=>{},nodeViewContentChildren:void 0,nodeViewContentRef:()=>{}}),JY=()=>V.useContext(QY);Xe.forwardRef((t,e)=>{const{onDragStart:n}=JY(),r=t.as||"div";return p.jsx(r,{...t,ref:e,"data-node-view-wrapper":"",onDragStart:n,style:{whiteSpace:"normal",...t.style}})});Xe.createContext({markViewContentRef:()=>{}});var dg=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);const{children:n,...r}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,r,n]},XY=/^\s*>\s$/,YY=dn.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return dg("blockquote",{...ft(this.options.HTMLAttributes,t),children:dg("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";const n=">",r=[];return t.content.forEach(s=>{const a=e.renderChildren([s]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);r.push(a.join(`
`))}),r.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[qc({find:XY,type:this.type})]}}),ZY=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,eZ=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,tZ=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,nZ=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,rZ=fl.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return dg("strong",{...ft(this.options.HTMLAttributes,t),children:dg("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[Wc({find:ZY,type:this.type}),Wc({find:tZ,type:this.type})]},addPasteRules(){return[nl({find:eZ,type:this.type}),nl({find:nZ,type:this.type})]}}),sZ=/(^|[^`])`([^`]+)`(?!`)$/,iZ=/(^|[^`])`([^`]+)`(?!`)/g,oZ=fl.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",ft(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[Wc({find:sZ,type:this.type})]},addPasteRules(){return[nl({find:iZ,type:this.type})]}}),L0=4,aZ=/^```([a-z]+)?[\s\n]$/,lZ=/^~~~([a-z]+)?[\s\n]$/,cZ=dn.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:L0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options;if(!n)return null;const i=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(o=>o.startsWith(n)).map(o=>o.replace(n,""))[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",ft(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let r="";const s=((n=t.attrs)==null?void 0:n.language)||"";return t.content?r=[`\`\`\`${s}`,e.renderChildren(t.content),"```"].join(`
`):r=`\`\`\`${s}

\`\`\``,r},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:L0,{state:r}=t,{selection:s}=r,{$from:i,empty:o}=s;if(i.parent.type!==this.type)return!1;const a=" ".repeat(n);return o?t.commands.insertContent(a):t.commands.command(({tr:l})=>{const{from:c,to:u}=s,f=r.doc.textBetween(c,u,`
`,`
`).split(`
`).map(g=>a+g).join(`
`);return l.replaceWith(c,u,r.schema.text(f)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;const n=(e=this.options.tabSize)!=null?e:L0,{state:r}=t,{selection:s}=r,{$from:i,empty:o}=s;return i.parent.type!==this.type?!1:o?t.commands.command(({tr:a})=>{var l;const{pos:c}=i,u=i.start(),h=i.end(),f=r.doc.textBetween(u,h,`
`,`
`).split(`
`);let g=0,y=0;const v=c-u;for(let N=0;N<f.length;N+=1){if(y+f[N].length>=v){g=N;break}y+=f[N].length+1}const T=((l=f[g].match(/^ */))==null?void 0:l[0])||"",E=Math.min(T.length,n);if(E===0)return!0;let R=u;for(let N=0;N<g;N+=1)R+=f[N].length+1;return a.delete(R,R+E),c-R<=E&&a.setSelection(be.create(a.doc,R)),!0}):t.commands.command(({tr:a})=>{const{from:l,to:c}=s,d=r.doc.textBetween(l,c,`
`,`
`).split(`
`).map(f=>{var g;const y=((g=f.match(/^ */))==null?void 0:g[0])||"",v=Math.min(y.length,n);return f.slice(v)}).join(`
`);return a.replaceWith(l,c,r.schema.text(d)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith(`

`);return!i||!o?!1:t.chain().command(({tr:a})=>(a.delete(r.pos-2,r.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type||!(s.parentOffset===s.parent.nodeSize-2))return!1;const a=s.after();return a===void 0?!1:r.nodeAt(a)?t.commands.command(({tr:c})=>(c.setSelection(ke.near(r.resolve(a))),!0)):t.commands.exitCode()}}},addInputRules(){return[J1({find:aZ,type:this.type,getAttributes:t=>({language:t[1]})}),J1({find:lZ,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new pt({key:new Dt("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=s==null?void 0:s.mode;if(!n||!i)return!1;const{tr:o,schema:a}=t.state,l=a.text(n.replace(/\r\n?/g,`
`));return o.replaceSelectionWith(this.type.create({language:i},l)),o.selection.$from.parent.type!==this.type&&o.setSelection(be.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),uZ=dn.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""}),hZ=dn.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",ft(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command(()=>{const{selection:s,storedMarks:i}=n;if(s.$from.parent.type.spec.isolating)return!1;const{keepMarks:o}=this.options,{splittableMarks:a}=r.extensionManager,l=i||s.$to.parentOffset&&s.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:u})=>{if(u&&l&&o){const h=l.filter(d=>a.includes(d.type.name));c.ensureMarks(h)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),dZ=dn.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,ft(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;const r=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,s="#".repeat(r);return t.content?`${s} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>J1({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}}),fZ=dn.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",ft(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!MX(e,e.schema.nodes[this.name]))return!1;const{selection:n}=e,{$to:r}=n,s=t();return vj(n)?s.insertContentAt(r.pos,{type:this.name}):s.insertContent({type:this.name}),s.command(({state:i,tr:o,dispatch:a})=>{if(a){const{$to:l}=o.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?o.setSelection(be.create(o.doc,l.pos+1)):l.nodeAfter.isBlock?o.setSelection(_e.create(o.doc,l.pos)):o.setSelection(be.create(o.doc,l.pos));else{const u=i.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,h=u==null?void 0:u.create();h&&(o.insert(c,h),o.setSelection(be.create(o.doc,c+1)))}o.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Dj({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}}),pZ=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,mZ=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,gZ=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,yZ=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,vZ=fl.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",ft(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[Wc({find:pZ,type:this.type}),Wc({find:gZ,type:this.type})]},addPasteRules(){return[nl({find:mZ,type:this.type}),nl({find:yZ,type:this.type})]}});const wZ="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5mgensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",_Z="121342632165322333335355455655552435435422463632574574330355524444661154543332344423364211133222221212112052232222232212222223222241112222224322321222",Z1="numeric",e_="ascii",t_="alpha",Ch="asciinumeric",nh="alphanumeric",n_="domain",Uj="emoji",xZ="scheme",bZ="slashscheme",j0="whitespace";function TZ(t,e){return t in e||(e[t]=[]),e[t]}function wa(t,e,n){e[Z1]&&(e[Ch]=!0,e[nh]=!0),e[e_]&&(e[Ch]=!0,e[t_]=!0),e[Ch]&&(e[nh]=!0),e[t_]&&(e[nh]=!0),e[nh]&&(e[n_]=!0),e[Uj]&&(e[n_]=!0);for(const r in e){const s=TZ(r,n);s.indexOf(t)<0&&s.push(t)}}function EZ(t,e){const n={};for(const r in e)e[r].indexOf(t)>=0&&(n[r]=!0);return n}function Zn(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Zn.groups={};Zn.prototype={accepts(){return!!this.t},go(t){const e=this,n=e.j[t];if(n)return n;for(let r=0;r<e.jr.length;r++){const s=e.jr[r][0],i=e.jr[r][1];if(i&&s.test(t))return i}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,r){for(let s=0;s<t.length;s++)this.tt(t[s],e,n,r)},tr(t,e,n,r){r=r||Zn.groups;let s;return e&&e.j?s=e:(s=new Zn(e),n&&r&&wa(e,n,r)),this.jr.push([t,s]),s},ts(t,e,n,r){let s=this;const i=t.length;if(!i)return s;for(let o=0;o<i-1;o++)s=s.tt(t[o]);return s.tt(t[i-1],e,n,r)},tt(t,e,n,r){r=r||Zn.groups;const s=this;if(e&&e.j)return s.j[t]=e,e;const i=e;let o,a=s.go(t);if(a?(o=new Zn,Object.assign(o.j,a.j),o.jr.push.apply(o.jr,a.jr),o.jd=a.jd,o.t=a.t):o=new Zn,i){if(r)if(o.t&&typeof o.t=="string"){const l=Object.assign(EZ(o.t,r),n);wa(i,l,r)}else n&&wa(i,n,r);o.t=i}return s.j[t]=o,o}};const Le=(t,e,n,r,s)=>t.ta(e,n,r,s),Rt=(t,e,n,r,s)=>t.tr(e,n,r,s),sA=(t,e,n,r,s)=>t.ts(e,n,r,s),ie=(t,e,n,r,s)=>t.tt(e,n,r,s),Ws="WORD",r_="UWORD",zj="ASCIINUMERICAL",$j="ALPHANUMERICAL",bd="LOCALHOST",s_="TLD",i_="UTLD",Wp="SCHEME",jl="SLASH_SCHEME",oT="NUM",o_="WS",aT="NL",Ih="OPENBRACE",Ah="CLOSEBRACE",fg="OPENBRACKET",pg="CLOSEBRACKET",mg="OPENPAREN",gg="CLOSEPAREN",yg="OPENANGLEBRACKET",vg="CLOSEANGLEBRACKET",wg="FULLWIDTHLEFTPAREN",_g="FULLWIDTHRIGHTPAREN",xg="LEFTCORNERBRACKET",bg="RIGHTCORNERBRACKET",Tg="LEFTWHITECORNERBRACKET",Eg="RIGHTWHITECORNERBRACKET",Sg="FULLWIDTHLESSTHAN",kg="FULLWIDTHGREATERTHAN",Cg="AMPERSAND",Ig="APOSTROPHE",Ag="ASTERISK",$i="AT",Rg="BACKSLASH",Ng="BACKTICK",Pg="CARET",Yi="COLON",lT="COMMA",Mg="DOLLAR",gs="DOT",Og="EQUALS",cT="EXCLAMATION",Sr="HYPHEN",Rh="PERCENT",Dg="PIPE",Lg="PLUS",jg="POUND",Nh="QUERY",uT="QUOTE",Hj="FULLWIDTHMIDDLEDOT",hT="SEMI",ys="SLASH",Ph="TILDE",Vg="UNDERSCORE",Wj="EMOJI",Fg="SYM";var qj=Object.freeze({__proto__:null,ALPHANUMERICAL:$j,AMPERSAND:Cg,APOSTROPHE:Ig,ASCIINUMERICAL:zj,ASTERISK:Ag,AT:$i,BACKSLASH:Rg,BACKTICK:Ng,CARET:Pg,CLOSEANGLEBRACKET:vg,CLOSEBRACE:Ah,CLOSEBRACKET:pg,CLOSEPAREN:gg,COLON:Yi,COMMA:lT,DOLLAR:Mg,DOT:gs,EMOJI:Wj,EQUALS:Og,EXCLAMATION:cT,FULLWIDTHGREATERTHAN:kg,FULLWIDTHLEFTPAREN:wg,FULLWIDTHLESSTHAN:Sg,FULLWIDTHMIDDLEDOT:Hj,FULLWIDTHRIGHTPAREN:_g,HYPHEN:Sr,LEFTCORNERBRACKET:xg,LEFTWHITECORNERBRACKET:Tg,LOCALHOST:bd,NL:aT,NUM:oT,OPENANGLEBRACKET:yg,OPENBRACE:Ih,OPENBRACKET:fg,OPENPAREN:mg,PERCENT:Rh,PIPE:Dg,PLUS:Lg,POUND:jg,QUERY:Nh,QUOTE:uT,RIGHTCORNERBRACKET:bg,RIGHTWHITECORNERBRACKET:Eg,SCHEME:Wp,SEMI:hT,SLASH:ys,SLASH_SCHEME:jl,SYM:Fg,TILDE:Ph,TLD:s_,UNDERSCORE:Vg,UTLD:i_,UWORD:r_,WORD:Ws,WS:o_});const $s=/[a-z]/,Bu=new RegExp("\\p{L}","u"),V0=new RegExp("\\p{Emoji}","u"),Hs=/\d/,F0=/\s/,iA="\r",B0=`
`,SZ="",kZ="",U0="";let ep=null,tp=null;function CZ(t=[]){const e={};Zn.groups=e;const n=new Zn;ep==null&&(ep=oA(wZ)),tp==null&&(tp=oA(_Z)),ie(n,"'",Ig),ie(n,"{",Ih),ie(n,"}",Ah),ie(n,"[",fg),ie(n,"]",pg),ie(n,"(",mg),ie(n,")",gg),ie(n,"<",yg),ie(n,">",vg),ie(n,"",wg),ie(n,"",_g),ie(n,"",xg),ie(n,"",bg),ie(n,"",Tg),ie(n,"",Eg),ie(n,"",Sg),ie(n,"",kg),ie(n,"&",Cg),ie(n,"*",Ag),ie(n,"@",$i),ie(n,"`",Ng),ie(n,"^",Pg),ie(n,":",Yi),ie(n,",",lT),ie(n,"$",Mg),ie(n,".",gs),ie(n,"=",Og),ie(n,"!",cT),ie(n,"-",Sr),ie(n,"%",Rh),ie(n,"|",Dg),ie(n,"+",Lg),ie(n,"#",jg),ie(n,"?",Nh),ie(n,'"',uT),ie(n,"/",ys),ie(n,";",hT),ie(n,"~",Ph),ie(n,"_",Vg),ie(n,"\\",Rg),ie(n,"",Hj);const r=Rt(n,Hs,oT,{[Z1]:!0});Rt(r,Hs,r);const s=Rt(r,$s,zj,{[Ch]:!0}),i=Rt(r,Bu,$j,{[nh]:!0}),o=Rt(n,$s,Ws,{[e_]:!0});Rt(o,Hs,s),Rt(o,$s,o),Rt(s,Hs,s),Rt(s,$s,s);const a=Rt(n,Bu,r_,{[t_]:!0});Rt(a,$s),Rt(a,Hs,i),Rt(a,Bu,a),Rt(i,Hs,i),Rt(i,$s),Rt(i,Bu,i);const l=ie(n,B0,aT,{[j0]:!0}),c=ie(n,iA,o_,{[j0]:!0}),u=Rt(n,F0,o_,{[j0]:!0});ie(n,U0,u),ie(c,B0,l),ie(c,U0,u),Rt(c,F0,u),ie(u,iA),ie(u,B0),Rt(u,F0,u),ie(u,U0,u);const h=Rt(n,V0,Wj,{[Uj]:!0});ie(h,"#"),Rt(h,V0,h),ie(h,SZ,h);const d=ie(h,kZ);ie(d,"#"),Rt(d,V0,h);const f=[[$s,o],[Hs,s]],g=[[$s,null],[Bu,a],[Hs,i]];for(let y=0;y<ep.length;y++)ji(n,ep[y],s_,Ws,f);for(let y=0;y<tp.length;y++)ji(n,tp[y],i_,r_,g);wa(s_,{tld:!0,ascii:!0},e),wa(i_,{utld:!0,alpha:!0},e),ji(n,"file",Wp,Ws,f),ji(n,"mailto",Wp,Ws,f),ji(n,"http",jl,Ws,f),ji(n,"https",jl,Ws,f),ji(n,"ftp",jl,Ws,f),ji(n,"ftps",jl,Ws,f),wa(Wp,{scheme:!0,ascii:!0},e),wa(jl,{slashscheme:!0,ascii:!0},e),t=t.sort((y,v)=>y[0]>v[0]?1:-1);for(let y=0;y<t.length;y++){const v=t[y][0],T=t[y][1]?{[xZ]:!0}:{[bZ]:!0};v.indexOf("-")>=0?T[n_]=!0:$s.test(v)?Hs.test(v)?T[Ch]=!0:T[e_]=!0:T[Z1]=!0,sA(n,v,v,T)}return sA(n,"localhost",bd,{ascii:!0}),n.jd=new Zn(Fg),{start:n,tokens:Object.assign({groups:e},qj)}}function Kj(t,e){const n=IZ(e.replace(/[A-Z]/g,a=>a.toLowerCase())),r=n.length,s=[];let i=0,o=0;for(;o<r;){let a=t,l=null,c=0,u=null,h=-1,d=-1;for(;o<r&&(l=a.go(n[o]));)a=l,a.accepts()?(h=0,d=0,u=a):h>=0&&(h+=n[o].length,d++),c+=n[o].length,i+=n[o].length,o++;i-=h,o-=d,c-=h,s.push({t:u.t,v:e.slice(i-c,i),s:i-c,e:i})}return s}function IZ(t){const e=[],n=t.length;let r=0;for(;r<n;){let s=t.charCodeAt(r),i,o=s<55296||s>56319||r+1===n||(i=t.charCodeAt(r+1))<56320||i>57343?t[r]:t.slice(r,r+2);e.push(o),r+=o.length}return e}function ji(t,e,n,r,s){let i;const o=e.length;for(let a=0;a<o-1;a++){const l=e[a];t.j[l]?i=t.j[l]:(i=new Zn(r),i.jr=s.slice(),t.j[l]=i),t=i}return i=new Zn(n),i.jr=s.slice(),t.j[e[o-1]]=i,i}function oA(t){const e=[],n=[];let r=0,s="0123456789";for(;r<t.length;){let i=0;for(;s.indexOf(t[r+i])>=0;)i++;if(i>0){e.push(n.join(""));for(let o=parseInt(t.substring(r,r+i),10);o>0;o--)n.pop();r+=i}else n.push(t[r]),r++}return e}const Td={defaultProtocol:"http",events:null,format:aA,formatHref:aA,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function dT(t,e=null){let n=Object.assign({},Td);t&&(n=Object.assign(n,t instanceof dT?t.o:t));const r=n.ignoreTags,s=[];for(let i=0;i<r.length;i++)s.push(r[i].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=s}dT.prototype={o:Td,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){const r=e!=null;let s=this.o[t];return s&&(typeof s=="object"?(s=n.t in s?s[n.t]:Td[t],typeof s=="function"&&r&&(s=s(e,n))):typeof s=="function"&&r&&(s=s(e,n.t,n)),s)},getObj(t,e,n){let r=this.o[t];return typeof r=="function"&&e!=null&&(r=r(e,n.t,n)),r},render(t){const e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function aA(t){return t}function Gj(t,e){this.t="token",this.v=t,this.tk=e}Gj.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){const e=this.toString(),n=t.get("truncate",e,this),r=t.get("format",e,this);return n&&r.length>n?r.substring(0,n)+"":r},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Td.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){const e=this,n=this.toHref(t.get("defaultProtocol")),r=t.get("formatHref",n,this),s=t.get("tagName",n,e),i=this.toFormattedString(t),o={},a=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),u=t.getObj("attributes",n,e),h=t.getObj("events",n,e);return o.href=r,a&&(o.class=a),l&&(o.target=l),c&&(o.rel=c),u&&Object.assign(o,u),{tagName:s,attributes:o,content:i,eventListeners:h}}};function nv(t,e){class n extends Gj{constructor(s,i){super(s,i),this.t=t}}for(const r in e)n.prototype[r]=e[r];return n.t=t,n}const lA=nv("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),cA=nv("text"),AZ=nv("nl"),np=nv("url",{isLink:!0,toHref(t=Td.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){const t=this.tk;return t.length>=2&&t[0].t!==bd&&t[1].t===Yi}}),Tr=t=>new Zn(t);function RZ({groups:t}){const e=t.domain.concat([Cg,Ag,$i,Rg,Ng,Pg,Mg,Og,Sr,oT,Rh,Dg,Lg,jg,ys,Fg,Ph,Vg]),n=[Ig,Yi,lT,gs,cT,Rh,Nh,uT,hT,yg,vg,Ih,Ah,pg,fg,mg,gg,wg,_g,xg,bg,Tg,Eg,Sg,kg],r=[Cg,Ig,Ag,Rg,Ng,Pg,Mg,Og,Sr,Ih,Ah,Rh,Dg,Lg,jg,Nh,ys,Fg,Ph,Vg],s=Tr(),i=ie(s,Ph);Le(i,r,i),Le(i,t.domain,i);const o=Tr(),a=Tr(),l=Tr();Le(s,t.domain,o),Le(s,t.scheme,a),Le(s,t.slashscheme,l),Le(o,r,i),Le(o,t.domain,o);const c=ie(o,$i);ie(i,$i,c),ie(a,$i,c),ie(l,$i,c);const u=ie(i,gs);Le(u,r,i),Le(u,t.domain,i);const h=Tr();Le(c,t.domain,h),Le(h,t.domain,h);const d=ie(h,gs);Le(d,t.domain,h);const f=Tr(lA);Le(d,t.tld,f),Le(d,t.utld,f),ie(c,bd,f);const g=ie(h,Sr);ie(g,Sr,g),Le(g,t.domain,h),Le(f,t.domain,h),ie(f,gs,d),ie(f,Sr,g);const y=ie(f,Yi);Le(y,t.numeric,lA);const v=ie(o,Sr),w=ie(o,gs);ie(v,Sr,v),Le(v,t.domain,o),Le(w,r,i),Le(w,t.domain,o);const T=Tr(np);Le(w,t.tld,T),Le(w,t.utld,T),Le(T,t.domain,o),Le(T,r,i),ie(T,gs,w),ie(T,Sr,v),ie(T,$i,c);const E=ie(T,Yi),R=Tr(np);Le(E,t.numeric,R);const P=Tr(np),N=Tr();Le(P,e,P),Le(P,n,N),Le(N,e,P),Le(N,n,N),ie(T,ys,P),ie(R,ys,P);const k=ie(a,Yi),_=ie(l,Yi),x=ie(_,ys),S=ie(x,ys);Le(a,t.domain,o),ie(a,gs,w),ie(a,Sr,v),Le(l,t.domain,o),ie(l,gs,w),ie(l,Sr,v),Le(k,t.domain,P),ie(k,ys,P),ie(k,Nh,P),Le(S,t.domain,P),Le(S,e,P),ie(S,ys,P);const A=[[Ih,Ah],[fg,pg],[mg,gg],[yg,vg],[wg,_g],[xg,bg],[Tg,Eg],[Sg,kg]];for(let M=0;M<A.length;M++){const[I,j]=A[M],B=ie(P,I);ie(N,I,B),ie(B,j,P);const L=Tr(np);Le(B,e,L);const O=Tr();Le(B,n),Le(L,e,L),Le(L,n,O),Le(O,e,L),Le(O,n,O),ie(L,j,P),ie(O,j,P)}return ie(s,bd,T),ie(s,aT,AZ),{start:s,tokens:qj}}function NZ(t,e,n){let r=n.length,s=0,i=[],o=[];for(;s<r;){let a=t,l=null,c=null,u=0,h=null,d=-1;for(;s<r&&!(l=a.go(n[s].t));)o.push(n[s++]);for(;s<r&&(c=l||a.go(n[s].t));)l=null,a=c,a.accepts()?(d=0,h=a):d>=0&&d++,s++,u++;if(d<0)s-=u,s<r&&(o.push(n[s]),s++);else{o.length>0&&(i.push(z0(cA,e,o)),o=[]),s-=d,u-=d;const f=h.t,g=n.slice(s-u,s);i.push(z0(f,e,g))}}return o.length>0&&i.push(z0(cA,e,o)),i}function z0(t,e,n){const r=n[0].s,s=n[n.length-1].e,i=e.slice(r,s);return new t(i,n)}const PZ=typeof console<"u"&&console&&console.warn||(()=>{}),MZ="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",ut={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function OZ(){return Zn.groups={},ut.scanner=null,ut.parser=null,ut.tokenQueue=[],ut.pluginQueue=[],ut.customSchemes=[],ut.initialized=!1,ut}function uA(t,e=!1){if(ut.initialized&&PZ(`linkifyjs: already initialized - will not register custom scheme "${t}" ${MZ}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);ut.customSchemes.push([t,e])}function DZ(){ut.scanner=CZ(ut.customSchemes);for(let t=0;t<ut.tokenQueue.length;t++)ut.tokenQueue[t][1]({scanner:ut.scanner});ut.parser=RZ(ut.scanner.tokens);for(let t=0;t<ut.pluginQueue.length;t++)ut.pluginQueue[t][1]({scanner:ut.scanner,parser:ut.parser});return ut.initialized=!0,ut}function fT(t){return ut.initialized||DZ(),NZ(ut.parser.start,t,Kj(ut.scanner.start,t))}fT.scan=Kj;function Qj(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}const r=new dT(n),s=fT(t),i=[];for(let o=0;o<s.length;o++){const a=s[o];a.isLink&&(!e||a.t===e)&&r.check(a)&&i.push(a.toFormattedObject(r))}return i}var pT="[\0- -\u2029]",LZ=new RegExp(pT),jZ=new RegExp(`${pT}$`),VZ=new RegExp(pT,"g");function FZ(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function BZ(t){return new pt({key:new Dt("autolink"),appendTransaction:(e,n,r)=>{const s=e.some(c=>c.docChanged)&&!n.doc.eq(r.doc),i=e.some(c=>c.getMeta("preventAutolink"));if(!s||i)return;const{tr:o}=r,a=cj(n.doc,[...e]);if(yj(a).forEach(({newRange:c})=>{const u=MJ(r.doc,c,f=>f.isTextblock);let h,d;if(u.length>1)h=u[0],d=r.doc.textBetween(h.pos,h.pos+h.node.nodeSize,void 0," ");else if(u.length){const f=r.doc.textBetween(c.from,c.to," "," ");if(!jZ.test(f))return;h=u[0],d=r.doc.textBetween(h.pos,c.to,void 0," ")}if(h&&d){const f=d.split(LZ).filter(Boolean);if(f.length<=0)return!1;const g=f[f.length-1],y=h.pos+d.lastIndexOf(g);if(!g)return!1;const v=fT(g).map(w=>w.toObject(t.defaultProtocol));if(!FZ(v))return!1;v.filter(w=>w.isLink).map(w=>({...w,from:y+w.start+1,to:y+w.end+1})).filter(w=>r.schema.marks.code?!r.doc.rangeHasMark(w.from,w.to,r.schema.marks.code):!0).filter(w=>t.validate(w.value)).filter(w=>t.shouldAutoLink(w.value)).forEach(w=>{tT(w.from,w.to,r.doc).some(T=>T.mark.type===t.type)||o.addMark(w.from,w.to,t.type.create({href:w.href}))})}}),!!o.steps.length)return o}})}function UZ(t){return new pt({key:new Dt("handleClickLink"),props:{handleClick:(e,n,r)=>{var s,i;if(r.button!==0||!e.editable)return!1;let o=!1;if(t.enableClickSelection&&(o=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){let a=null;if(r.target instanceof HTMLAnchorElement)a=r.target;else{let h=r.target;const d=[];for(;h.nodeName!=="DIV";)d.push(h),h=h.parentNode;a=d.find(f=>f.nodeName==="A")}if(!a)return o;const l=gj(e.state,t.type.name),c=(s=a==null?void 0:a.href)!=null?s:l.href,u=(i=a==null?void 0:a.target)!=null?i:l.target;a&&c&&(window.open(c,u),o=!0)}return o}}})}function zZ(t){return new pt({key:new Dt("handlePasteLink"),props:{handlePaste:(e,n,r)=>{const{shouldAutoLink:s}=t,{state:i}=e,{selection:o}=i,{empty:a}=o;if(a)return!1;let l="";r.content.forEach(u=>{l+=u.textContent});const c=Qj(l,{defaultProtocol:t.defaultProtocol}).find(u=>u.isLink&&u.value===l);return!l||!c||s!==void 0&&!s(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function Xo(t,e){const n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(r=>{const s=typeof r=="string"?r:r.scheme;s&&n.push(s)}),!t||t.replace(VZ,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var Jj=fl.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){uA(t);return}uA(t.scheme,t.optionalSlashes)})},onDestroy(){OZ()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Xo(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{const e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;const s=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(s)||!/\./.test(s))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{const e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Xo(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Xo(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",ft(this.options.HTMLAttributes,t),0]:["a",ft(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n;const r=((n=t.attrs)==null?void 0:n.href)||"";return`[${e.renderChildren(t)}](${r})`},addCommands(){return{setLink:t=>({chain:e})=>{const{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:r=>!!Xo(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{const{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:r=>!!Xo(r,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[nl({find:t=>{const e=[];if(t){const{protocols:n,defaultProtocol:r}=this.options,s=Qj(t).filter(i=>i.isLink&&this.options.isAllowedUri(i.value,{defaultValidate:o=>!!Xo(o,n),protocols:n,defaultProtocol:r}));s.length&&s.forEach(i=>{this.options.shouldAutoLink(i.value)&&e.push({text:i.value,data:{href:i.href},index:i.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){const t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(BZ({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:r=>this.options.isAllowedUri(r,{defaultValidate:s=>!!Xo(s,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(UZ({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(zZ({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),$Z=Jj,HZ=Object.defineProperty,WZ=(t,e)=>{for(var n in e)HZ(t,n,{get:e[n],enumerable:!0})},qZ="listItem",hA="textStyle",dA=/^\s*([-+*])\s$/,Xj=dn.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",ft(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(qZ,this.editor.getAttributes(hA)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=qc({find:dA,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=qc({find:dA,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(hA),editor:this.editor})),[t]}}),Yj=dn.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",ft(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(s=>s.type==="paragraph"))n=e.parseChildren(t.tokens);else{const s=t.tokens[0];if(s&&s.type==="text"&&s.tokens&&s.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(s.tokens)}],t.tokens.length>1){const o=t.tokens.slice(1),a=e.parseChildren(o);n.push(...a)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>iT(t,e,r=>r.parentType==="bulletList"?"- ":r.parentType==="orderedList"?`${r.index+1}. `:"- ",n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),KZ={};WZ(KZ,{findListItemPos:()=>ef,getNextListDepth:()=>mT,handleBackspace:()=>a_,handleDelete:()=>l_,hasListBefore:()=>Zj,hasListItemAfter:()=>GZ,hasListItemBefore:()=>e4,listItemHasSubList:()=>t4,nextListIsDeeper:()=>n4,nextListIsHigher:()=>r4});var ef=(t,e)=>{const{$from:n}=e.selection,r=Kt(t,e.schema);let s=null,i=n.depth,o=n.pos,a=null;for(;i>0&&a===null;)s=n.node(i),s.type===r?a=i:(i-=1,o-=1);return a===null?null:{$pos:e.doc.resolve(o),depth:a}},mT=(t,e)=>{const n=ef(t,e);if(!n)return!1;const[,r]=zJ(e,t,n.$pos.pos+4);return r},Zj=(t,e,n)=>{const{$anchor:r}=t.selection,s=Math.max(0,r.pos-2),i=t.doc.resolve(s).node();return!(!i||!n.includes(i.type.name))},e4=(t,e)=>{var n;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-2);return!(s.index()===0||((n=s.nodeBefore)==null?void 0:n.type.name)!==t)},t4=(t,e,n)=>{if(!n)return!1;const r=Kt(t,e.schema);let s=!1;return n.descendants(i=>{i.type===r&&(s=!0)}),s},a_=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!Po(t.state,e)&&Zj(t.state,e,n)){const{$anchor:a}=t.state.selection,l=t.state.doc.resolve(a.before()-1),c=[];l.node().descendants((d,f)=>{d.type.name===e&&c.push({node:d,pos:f})});const u=c.at(-1);if(!u)return!1;const h=t.state.doc.resolve(l.start()+u.pos+1);return t.chain().cut({from:a.start()-1,to:a.end()+1},h.end()).joinForward().run()}if(!Po(t.state,e)||!qJ(t.state))return!1;const r=ef(e,t.state);if(!r)return!1;const i=t.state.doc.resolve(r.$pos.pos-2).node(r.depth),o=t4(e,t.state,i);return e4(e,t.state)&&!o?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},n4=(t,e)=>{const n=mT(t,e),r=ef(t,e);return!r||!n?!1:n>r.depth},r4=(t,e)=>{const n=mT(t,e),r=ef(t,e);return!r||!n?!1:n<r.depth},l_=(t,e)=>{if(!Po(t.state,e)||!WJ(t.state,e))return!1;const{selection:n}=t.state,{$from:r,$to:s}=n;return!n.empty&&r.sameParent(s)?!1:n4(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():r4(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},GZ=(t,e)=>{var n;const{$anchor:r}=e.selection,s=e.doc.resolve(r.pos-r.parentOffset-2);return!(s.index()===s.parent.childCount-1||((n=s.nodeAfter)==null?void 0:n.type.name)!==t)},s4=Lt.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&l_(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&l_(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&a_(t,n,r)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:r})=>{t.state.schema.nodes[n]!==void 0&&a_(t,n,r)&&(e=!0)}),e}}}}),fA=/^(\s*)(\d+)\.\s+(.*)$/,QZ=/^\s/;function JZ(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n],i=s.match(fA);if(!i)break;const[,o,a,l]=i,c=o.length;let u=l,h=n+1;const d=[s];for(;h<t.length;){const f=t[h];if(f.match(fA))break;if(f.trim()==="")d.push(f),u+=`
`,h+=1;else if(f.match(QZ))d.push(f),u+=`
${f.slice(c+2)}`,h+=1;else break}e.push({indent:c,number:parseInt(a,10),content:u.trim(),raw:d.join(`
`)}),r=h,n=h}return[e,r]}function i4(t,e,n){var r;const s=[];let i=0;for(;i<t.length;){const o=t[i];if(o.indent===e){const a=o.content.split(`
`),l=((r=a[0])==null?void 0:r.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});const u=a.slice(1).join(`
`).trim();if(u){const f=n.blockTokens(u);c.push(...f)}let h=i+1;const d=[];for(;h<t.length&&t[h].indent>e;)d.push(t[h]),h+=1;if(d.length>0){const f=Math.min(...d.map(y=>y.indent)),g=i4(d,f,n);c.push({type:"list",ordered:!0,start:d[0].number,items:g,raw:d.map(y=>y.raw).join(`
`)})}s.push({type:"list_item",raw:o.raw,tokens:c}),i=h}else i+=1}return s}function XZ(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];const r=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(s=>{if(s.type==="paragraph"||s.type==="list"||s.type==="blockquote"||s.type==="code")r.push(...e.parseChildren([s]));else if(s.type==="text"&&s.tokens){const i=e.parseChildren([s]);r.push({type:"paragraph",content:i})}else{const i=e.parseChildren([s]);i.length>0&&r.push(...i)}}),{type:"listItem",content:r}})}var YZ="listItem",pA="textStyle",mA=/^(\d+)\.\s$/,o4=dn.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return e===1?["ol",ft(this.options.HTMLAttributes,n),0]:["ol",ft(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];const n=t.start||1,r=t.items?XZ(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:r}:{type:"orderedList",content:r}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{const e=t.match(/^(\s*)(\d+)\.\s+/),n=e==null?void 0:e.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var r;const s=t.split(`
`),[i,o]=JZ(s);if(i.length===0)return;const a=i4(i,0,n);return a.length===0?void 0:{type:"list",ordered:!0,start:((r=i[0])==null?void 0:r.number)||1,items:a,raw:s.slice(0,o).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(YZ,this.editor.getAttributes(pA)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=qc({find:mA,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=qc({find:mA,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(pA)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),ZZ=/^\s*(\[([( |x])?\])\s$/,eee=dn.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{const e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",ft(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{const n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){const r=e.parseChildren(t.nestedTokens);n.push(...r)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;const s=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return iT(t,e,s)},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),l=document.createElement("div"),c=h=>{var d,f;a.ariaLabel=((f=(d=this.options.a11y)==null?void 0:d.checkboxLabel)==null?void 0:f.call(d,h,a.checked))||`Task item checkbox for ${h.textContent||"empty task item"}`};c(t),i.contentEditable="false",a.type="checkbox",a.addEventListener("mousedown",h=>h.preventDefault()),a.addEventListener("change",h=>{if(!r.isEditable&&!this.options.onReadOnlyChecked){a.checked=!a.checked;return}const{checked:d}=h.target;r.isEditable&&typeof n=="function"&&r.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{const g=n();if(typeof g!="number")return!1;const y=f.doc.nodeAt(g);return f.setNodeMarkup(g,void 0,{...y==null?void 0:y.attrs,checked:d}),!0}).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,d)||(a.checked=!a.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([h,d])=>{s.setAttribute(h,d)}),s.dataset.checked=t.attrs.checked,a.checked=t.attrs.checked,i.append(a,o),s.append(i,l),Object.entries(e).forEach(([h,d])=>{s.setAttribute(h,d)});let u=new Set(Object.keys(e));return{dom:s,contentDOM:l,update:h=>{if(h.type!==this.type)return!1;s.dataset.checked=h.attrs.checked,a.checked=h.attrs.checked,c(h);const d=r.extensionManager.attributes,f=xd(h,d),g=new Set(Object.keys(f)),y=this.options.HTMLAttributes;return u.forEach(v=>{g.has(v)||(v in y?s.setAttribute(v,y[v]):s.removeAttribute(v))}),Object.entries(f).forEach(([v,w])=>{w==null?v in y?s.setAttribute(v,y[v]):s.removeAttribute(v):s.setAttribute(v,w)}),u=g,!0}}}},addInputRules(){return[qc({find:ZZ,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),tee=dn.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",ft(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;const n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){const r=i=>{const o=X1(i,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:a=>({indentLevel:a[1].length,mainContent:a[4],checked:a[3].toLowerCase()==="x"}),createToken:(a,l)=>({type:"taskItem",raw:"",mainContent:a.mainContent,indentLevel:a.indentLevel,checked:a.checked,text:a.mainContent,tokens:n.inlineTokens(a.mainContent),nestedTokens:l}),customNestedParser:r},n);return o?[{type:"taskList",raw:o.raw,items:o.items}]:n.blockTokens(i)},s=X1(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,o)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:n.inlineTokens(i.mainContent),nestedTokens:o}),customNestedParser:r},n);if(s)return{type:"taskList",raw:s.raw,items:s.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}});Lt.create({name:"listKit",addExtensions(){const t=[];return this.options.bulletList!==!1&&t.push(Xj.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(Yj.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(s4.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(o4.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(eee.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(tee.configure(this.options.taskList)),t}});var nee=dn.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",ft(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{const n=t.tokens||[];return n.length===1&&n[0].type==="image"?e.parseChildren([n[0]]):e.createNode("paragraph",void 0,e.parseInline(n))},renderMarkdown:(t,e)=>!t||!Array.isArray(t.content)?"":e.renderChildren(t.content),addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),ree=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,see=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,iee=fl.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",ft(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[Wc({find:ree,type:this.type})]},addPasteRules(){return[nl({find:see,type:this.type})]}}),oee=dn.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""}),aee=fl.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",ft(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){const s=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!s)return;const i=s[2].trim();return{type:"underline",raw:s[0],text:i,tokens:n.inlineTokens(i)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}});function lee(t={}){return new pt({view(e){return new cee(e,t)}})}class cee{constructor(e,n){var r;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(r=n.width)!==null&&r!==void 0?r:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(s=>{let i=o=>{this[s](o)};return e.dom.addEventListener(s,i),{name:s,handler:i}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,r,s=this.editorView.dom,i=s.getBoundingClientRect(),o=i.width/s.offsetWidth,a=i.height/s.offsetHeight;if(n){let h=e.nodeBefore,d=e.nodeAfter;if(h||d){let f=this.editorView.nodeDOM(this.cursorPos-(h?h.nodeSize:0));if(f){let g=f.getBoundingClientRect(),y=h?g.bottom:g.top;h&&d&&(y=(y+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let v=this.width/2*a;r={left:g.left,right:g.right,top:y-v,bottom:y+v}}}}if(!r){let h=this.editorView.coordsAtPos(this.cursorPos),d=this.width/2*o;r={left:h.left-d,right:h.left+d,top:h.top,bottom:h.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,u;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,u=-pageYOffset;else{let h=l.getBoundingClientRect(),d=h.width/l.offsetWidth,f=h.height/l.offsetHeight;c=h.left-l.scrollLeft*d,u=h.top-l.scrollTop*f}this.element.style.left=(r.left-c)/o+"px",this.element.style.top=(r.top-u)/a+"px",this.element.style.width=(r.right-r.left)/o+"px",this.element.style.height=(r.bottom-r.top)/a+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),r=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),s=r&&r.type.spec.disableDropCursor,i=typeof s=="function"?s(this.editorView,n,e):s;if(n&&!i){let o=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let a=tL(this.editorView.state.doc,o,this.editorView.dragging.slice);a!=null&&(o=a)}this.setCursor(o),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}class Pt extends ke{constructor(e){super(e,e)}map(e,n){let r=e.resolve(n.map(this.head));return Pt.valid(r)?new Pt(r):ke.near(r)}content(){return ue.empty}eq(e){return e instanceof Pt&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new Pt(e.resolve(n.pos))}getBookmark(){return new gT(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!uee(e)||!hee(e))return!1;let r=n.type.spec.allowGapCursor;if(r!=null)return r;let s=n.contentMatchAt(e.index()).defaultType;return s&&s.isTextblock}static findGapCursorFrom(e,n,r=!1){e:for(;;){if(!r&&Pt.valid(e))return e;let s=e.pos,i=null;for(let o=e.depth;;o--){let a=e.node(o);if(n>0?e.indexAfter(o)<a.childCount:e.index(o)>0){i=a.child(n>0?e.indexAfter(o):e.index(o)-1);break}else if(o==0)return null;s+=n;let l=e.doc.resolve(s);if(Pt.valid(l))return l}for(;;){let o=n>0?i.firstChild:i.lastChild;if(!o){if(i.isAtom&&!i.isText&&!_e.isSelectable(i)){e=e.doc.resolve(s+i.nodeSize*n),r=!1;continue e}break}i=o,s+=n;let a=e.doc.resolve(s);if(Pt.valid(a))return a}return null}}}Pt.prototype.visible=!1;Pt.findFrom=Pt.findGapCursorFrom;ke.jsonID("gapcursor",Pt);class gT{constructor(e){this.pos=e}map(e){return new gT(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return Pt.valid(n)?new Pt(n):ke.near(n)}}function a4(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function uee(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(n==0){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n-1);;s=s.lastChild){if(s.childCount==0&&!s.inlineContent||a4(s.type))return!0;if(s.inlineContent)return!1}}return!0}function hee(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n==r.childCount){if(r.type.spec.isolating)return!0;continue}for(let s=r.child(n);;s=s.firstChild){if(s.childCount==0&&!s.inlineContent||a4(s.type))return!0;if(s.inlineContent)return!1}}return!0}function dee(){return new pt({props:{decorations:gee,createSelectionBetween(t,e,n){return e.pos==n.pos&&Pt.valid(n)?new Pt(n):null},handleClick:pee,handleKeyDown:fee,handleDOMEvents:{beforeinput:mee}}})}const fee=Qb({ArrowLeft:rp("horiz",-1),ArrowRight:rp("horiz",1),ArrowUp:rp("vert",-1),ArrowDown:rp("vert",1)});function rp(t,e){const n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(r,s,i){let o=r.selection,a=e>0?o.$to:o.$from,l=o.empty;if(o instanceof be){if(!i.endOfTextblock(n)||a.depth==0)return!1;l=!1,a=r.doc.resolve(e>0?a.after():a.before())}let c=Pt.findGapCursorFrom(a,e,l);return c?(s&&s(r.tr.setSelection(new Pt(c))),!0):!1}}function pee(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!Pt.valid(r))return!1;let s=t.posAtCoords({left:n.clientX,top:n.clientY});return s&&s.inside>-1&&_e.isSelectable(t.state.doc.nodeAt(s.inside))?!1:(t.dispatch(t.state.tr.setSelection(new Pt(r))),!0)}function mee(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof Pt))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let s=te.empty;for(let o=r.length-1;o>=0;o--)s=te.from(r[o].createAndFill(null,s));let i=t.state.tr.replace(n.pos,n.pos,new ue(s,0,0));return i.setSelection(be.near(i.doc.resolve(n.pos+1))),t.dispatch(i),!1}function gee(t){if(!(t.selection instanceof Pt))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",it.create(t.doc,[ln.widget(t.selection.head,e,{key:"gapcursor"})])}var Bg=200,hn=function(){};hn.prototype.append=function(e){return e.length?(e=hn.from(e),!this.length&&e||e.length<Bg&&this.leafAppend(e)||this.length<Bg&&e.leafPrepend(this)||this.appendInner(e)):this};hn.prototype.prepend=function(e){return e.length?hn.from(e).append(this):this};hn.prototype.appendInner=function(e){return new yee(this,e)};hn.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?hn.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};hn.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};hn.prototype.forEach=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length),n<=r?this.forEachInner(e,n,r,0):this.forEachInvertedInner(e,n,r,0)};hn.prototype.map=function(e,n,r){n===void 0&&(n=0),r===void 0&&(r=this.length);var s=[];return this.forEach(function(i,o){return s.push(e(i,o))},n,r),s};hn.from=function(e){return e instanceof hn?e:e&&e.length?new l4(e):hn.empty};var l4=function(t){function e(r){t.call(this),this.values=r}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(s,i){return s==0&&i==this.length?this:new e(this.values.slice(s,i))},e.prototype.getInner=function(s){return this.values[s]},e.prototype.forEachInner=function(s,i,o,a){for(var l=i;l<o;l++)if(s(this.values[l],a+l)===!1)return!1},e.prototype.forEachInvertedInner=function(s,i,o,a){for(var l=i-1;l>=o;l--)if(s(this.values[l],a+l)===!1)return!1},e.prototype.leafAppend=function(s){if(this.length+s.length<=Bg)return new e(this.values.concat(s.flatten()))},e.prototype.leafPrepend=function(s){if(this.length+s.length<=Bg)return new e(s.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(hn);hn.empty=new l4([]);var yee=function(t){function e(n,r){t.call(this),this.left=n,this.right=r,this.length=n.length+r.length,this.depth=Math.max(n.depth,r.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(r){return r<this.left.length?this.left.get(r):this.right.get(r-this.left.length)},e.prototype.forEachInner=function(r,s,i,o){var a=this.left.length;if(s<a&&this.left.forEachInner(r,s,Math.min(i,a),o)===!1||i>a&&this.right.forEachInner(r,Math.max(s-a,0),Math.min(this.length,i)-a,o+a)===!1)return!1},e.prototype.forEachInvertedInner=function(r,s,i,o){var a=this.left.length;if(s>a&&this.right.forEachInvertedInner(r,s-a,Math.max(i,a)-a,o+a)===!1||i<a&&this.left.forEachInvertedInner(r,Math.min(s,a),i,o)===!1)return!1},e.prototype.sliceInner=function(r,s){if(r==0&&s==this.length)return this;var i=this.left.length;return s<=i?this.left.slice(r,s):r>=i?this.right.slice(r-i,s-i):this.left.slice(r,i).append(this.right.slice(0,s-i))},e.prototype.leafAppend=function(r){var s=this.right.leafAppend(r);if(s)return new e(this.left,s)},e.prototype.leafPrepend=function(r){var s=this.left.leafPrepend(r);if(s)return new e(s,this.right)},e.prototype.appendInner=function(r){return this.left.depth>=Math.max(this.right.depth,r.depth)+1?new e(this.left,new e(this.right,r)):new e(this,r)},e}(hn);const vee=500;class Zr{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let r=this.items.length;for(;;r--)if(this.items.get(r-1).selection){--r;break}let s,i;n&&(s=this.remapping(r,this.items.length),i=s.maps.length);let o=e.tr,a,l,c=[],u=[];return this.items.forEach((h,d)=>{if(!h.step){s||(s=this.remapping(r,d+1),i=s.maps.length),i--,u.push(h);return}if(s){u.push(new vs(h.map));let f=h.step.map(s.slice(i)),g;f&&o.maybeStep(f).doc&&(g=o.mapping.maps[o.mapping.maps.length-1],c.push(new vs(g,void 0,void 0,c.length+u.length))),i--,g&&s.appendMap(g,i)}else o.maybeStep(h.step);if(h.selection)return a=s?h.selection.map(s.slice(i)):h.selection,l=new Zr(this.items.slice(0,r).append(u.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:o,selection:a}}addTransform(e,n,r,s){let i=[],o=this.eventCount,a=this.items,l=!s&&a.length?a.get(a.length-1):null;for(let u=0;u<e.steps.length;u++){let h=e.steps[u].invert(e.docs[u]),d=new vs(e.mapping.maps[u],h,n),f;(f=l&&l.merge(d))&&(d=f,u?i.pop():a=a.slice(0,a.length-1)),i.push(d),n&&(o++,n=void 0),s||(l=d)}let c=o-r.depth;return c>_ee&&(a=wee(a,c),o-=c),new Zr(a.append(i),o)}remapping(e,n){let r=new md;return this.items.forEach((s,i)=>{let o=s.mirrorOffset!=null&&i-s.mirrorOffset>=e?r.maps.length-s.mirrorOffset:void 0;r.appendMap(s.map,o)},e,n),r}addMaps(e){return this.eventCount==0?this:new Zr(this.items.append(e.map(n=>new vs(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let r=[],s=Math.max(0,this.items.length-n),i=e.mapping,o=e.steps.length,a=this.eventCount;this.items.forEach(d=>{d.selection&&a--},s);let l=n;this.items.forEach(d=>{let f=i.getMirror(--l);if(f==null)return;o=Math.min(o,f);let g=i.maps[f];if(d.step){let y=e.steps[f].invert(e.docs[f]),v=d.selection&&d.selection.map(i.slice(l+1,f));v&&a++,r.push(new vs(g,y,v))}else r.push(new vs(g))},s);let c=[];for(let d=n;d<o;d++)c.push(new vs(i.maps[d]));let u=this.items.slice(0,s).append(c).append(r),h=new Zr(u,a);return h.emptyItemCount()>vee&&(h=h.compress(this.items.length-r.length)),h}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),r=n.maps.length,s=[],i=0;return this.items.forEach((o,a)=>{if(a>=e)s.push(o),o.selection&&i++;else if(o.step){let l=o.step.map(n.slice(r)),c=l&&l.getMap();if(r--,c&&n.appendMap(c,r),l){let u=o.selection&&o.selection.map(n.slice(r));u&&i++;let h=new vs(c.invert(),l,u),d,f=s.length-1;(d=s.length&&s[f].merge(h))?s[f]=d:s.push(h)}}else o.map&&r--},this.items.length,0),new Zr(hn.from(s.reverse()),i)}}Zr.empty=new Zr(hn.empty,0);function wee(t,e){let n;return t.forEach((r,s)=>{if(r.selection&&e--==0)return n=s,!1}),t.slice(n)}class vs{constructor(e,n,r,s){this.map=e,this.step=n,this.selection=r,this.mirrorOffset=s}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new vs(n.getMap().invert(),n,this.selection)}}}class Hi{constructor(e,n,r,s,i){this.done=e,this.undone=n,this.prevRanges=r,this.prevTime=s,this.prevComposition=i}}const _ee=20;function xee(t,e,n,r){let s=n.getMeta(Ma),i;if(s)return s.historyState;n.getMeta(Eee)&&(t=new Hi(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(o&&o.getMeta(Ma))return o.getMeta(Ma).redo?new Hi(t.done.addTransform(n,void 0,r,qp(e)),t.undone,gA(n.mapping.maps),t.prevTime,t.prevComposition):new Hi(t.done,t.undone.addTransform(n,void 0,r,qp(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(o&&o.getMeta("addToHistory")===!1)){let a=n.getMeta("composition"),l=t.prevTime==0||!o&&t.prevComposition!=a&&(t.prevTime<(n.time||0)-r.newGroupDelay||!bee(n,t.prevRanges)),c=o?$0(t.prevRanges,n.mapping):gA(n.mapping.maps);return new Hi(t.done.addTransform(n,l?e.selection.getBookmark():void 0,r,qp(e)),Zr.empty,c,n.time,a??t.prevComposition)}else return(i=n.getMeta("rebased"))?new Hi(t.done.rebased(n,i),t.undone.rebased(n,i),$0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Hi(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),$0(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function bee(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((r,s)=>{for(let i=0;i<e.length;i+=2)r<=e[i+1]&&s>=e[i]&&(n=!0)}),n}function gA(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((r,s,i,o)=>e.push(i,o));return e}function $0(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let s=e.map(t[r],1),i=e.map(t[r+1],-1);s<=i&&n.push(s,i)}return n}function Tee(t,e,n){let r=qp(e),s=Ma.get(e).spec.config,i=(n?t.undone:t.done).popEvent(e,r);if(!i)return null;let o=i.selection.resolve(i.transform.doc),a=(n?t.done:t.undone).addTransform(i.transform,e.selection.getBookmark(),s,r),l=new Hi(n?a:i.remaining,n?i.remaining:a,null,0,-1);return i.transform.setSelection(o).setMeta(Ma,{redo:n,historyState:l})}let H0=!1,yA=null;function qp(t){let e=t.plugins;if(yA!=e){H0=!1,yA=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){H0=!0;break}}return H0}const Ma=new Dt("history"),Eee=new Dt("closeHistory");function See(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new pt({key:Ma,state:{init(){return new Hi(Zr.empty,Zr.empty,null,0,-1)},apply(e,n,r){return xee(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let r=n.inputType,s=r=="historyUndo"?u4:r=="historyRedo"?h4:null;return!s||!e.editable?!1:(n.preventDefault(),s(e.state,e.dispatch))}}}})}function c4(t,e){return(n,r)=>{let s=Ma.getState(n);if(!s||(t?s.undone:s.done).eventCount==0)return!1;if(r){let i=Tee(s,n,t);i&&r(e?i.scrollIntoView():i)}return!0}}const u4=c4(!1,!0),h4=c4(!0,!0);Lt.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc;if(((t==null?void 0:t.mode)||this.options.mode)==="textSize"){const r=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(r)}return e.nodeSize},this.storage.words=t=>{const e=(t==null?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new pt({key:new Dt("characterCount"),appendTransaction:(e,n,r)=>{if(t)return;const s=this.options.limit;if(s==null||s===0){t=!0;return}const i=this.storage.characters({node:r.doc});if(i>s){const o=i-s,a=0,l=o;console.warn(`[CharacterCount] Initial content exceeded limit of ${s} characters. Content was automatically trimmed.`);const c=r.tr.deleteRange(a,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{const r=this.options.limit;if(!e.docChanged||r===0||r===null||r===void 0)return!0;const s=this.storage.characters({node:n.doc}),i=this.storage.characters({node:e.doc});if(i<=r||s>r&&i>r&&i<=s)return!0;if(s>r&&i>r&&i>s||!e.getMeta("paste"))return!1;const a=e.selection.$head.pos,l=i-r,c=a-l,u=a;return e.deleteRange(c,u),!(this.storage.characters({node:e.doc})>r)}})]}});var kee=Lt.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[lee(this.options)]}});Lt.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new pt({key:new Dt("focus"),props:{decorations:({doc:t,selection:e})=>{const{isEditable:n,isFocused:r}=this.editor,{anchor:s}=e,i=[];if(!n||!r)return it.create(t,[]);let o=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(s>=c&&s<=c+l.nodeSize-1))return!1;o+=1});let a=0;return t.descendants((l,c)=>{if(l.isText||!(s>=c&&s<=c+l.nodeSize-1))return!1;if(a+=1,this.options.mode==="deepest"&&o-a>0||this.options.mode==="shallowest"&&a>1)return this.options.mode==="deepest";i.push(ln.node(c,c+l.nodeSize,{class:this.options.className}))}),it.create(t,i)}}})]}});var Cee=Lt.create({name:"gapCursor",addProseMirrorPlugins(){return[dee()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Qe(ve(t,"allowGapCursor",n)))!=null?e:null}}}),Iee=Lt.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",placeholder:"Write something ",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){return[new pt({key:new Dt("placeholder"),props:{decorations:({doc:t,selection:e})=>{const n=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:r}=e,s=[];if(!n)return null;const i=this.editor.isEmpty;return t.descendants((o,a)=>{const l=r>=a&&r<=a+o.nodeSize,c=!o.isLeaf&&Yy(o);if((l||!this.options.showOnlyCurrent)&&c){const u=[this.options.emptyNodeClass];i&&u.push(this.options.emptyEditorClass);const h=ln.node(a,a+o.nodeSize,{class:u.join(" "),"data-placeholder":typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:o,pos:a,hasAnchor:l}):this.options.placeholder});s.push(h)}return this.options.includeChildren}),it.create(t,s)}}})]}});Lt.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){const{editor:t,options:e}=this;return[new pt({key:new Dt("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||vj(n.selection)||t.view.dragging?null:it.create(n.doc,[ln.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function vA({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||(e==null?void 0:e.type)===t}var Aee=Lt.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;const e=new Dt(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",r=Object.entries(this.editor.schema.nodes).map(([,s])=>s).filter(s=>(this.options.notAfter||[]).concat(n).includes(s.name));return[new pt({key:e,appendTransaction:(s,i,o)=>{const{doc:a,tr:l,schema:c}=o,u=e.getState(o),h=a.content.size,d=c.nodes[n];if(u)return l.insert(h,d.create())},state:{init:(s,i)=>{const o=i.tr.doc.lastChild;return!vA({node:o,types:r})},apply:(s,i)=>{if(!s.docChanged||s.getMeta("__uniqueIDTransaction"))return i;const o=s.doc.lastChild;return!vA({node:o,types:r})}}})]}}),Ree=Lt.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>u4(t,e),redo:()=>({state:t,dispatch:e})=>h4(t,e)}},addProseMirrorPlugins(){return[See(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-":()=>this.editor.commands.undo(),"Shift-Mod-":()=>this.editor.commands.redo()}}}),Nee=Lt.create({name:"starterKit",addExtensions(){var t,e,n,r;const s=[];return this.options.bold!==!1&&s.push(rZ.configure(this.options.bold)),this.options.blockquote!==!1&&s.push(YY.configure(this.options.blockquote)),this.options.bulletList!==!1&&s.push(Xj.configure(this.options.bulletList)),this.options.code!==!1&&s.push(oZ.configure(this.options.code)),this.options.codeBlock!==!1&&s.push(cZ.configure(this.options.codeBlock)),this.options.document!==!1&&s.push(uZ.configure(this.options.document)),this.options.dropcursor!==!1&&s.push(kee.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&s.push(Cee.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&s.push(hZ.configure(this.options.hardBreak)),this.options.heading!==!1&&s.push(dZ.configure(this.options.heading)),this.options.undoRedo!==!1&&s.push(Ree.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&s.push(fZ.configure(this.options.horizontalRule)),this.options.italic!==!1&&s.push(vZ.configure(this.options.italic)),this.options.listItem!==!1&&s.push(Yj.configure(this.options.listItem)),this.options.listKeymap!==!1&&s.push(s4.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&s.push(Jj.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&s.push(o4.configure(this.options.orderedList)),this.options.paragraph!==!1&&s.push(nee.configure(this.options.paragraph)),this.options.strike!==!1&&s.push(iee.configure(this.options.strike)),this.options.text!==!1&&s.push(oee.configure(this.options.text)),this.options.underline!==!1&&s.push(aee.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&s.push(Aee.configure((r=this.options)==null?void 0:r.trailingNode)),s}}),Pee=Nee,Mee=/(?:^|\s)(!\[(.+|:?)]\((\S+)(?:(?:\s+)["'](\S+)["'])?\))$/,Oee=dn.create({name:"image",addOptions(){return{inline:!1,allowBase64:!1,HTMLAttributes:{},resize:!1}},inline(){return this.options.inline},group(){return this.options.inline?"inline":"block"},draggable:!0,addAttributes(){return{src:{default:null},alt:{default:null},title:{default:null},width:{default:null},height:{default:null}}},parseHTML(){return[{tag:this.options.allowBase64?"img[src]":'img[src]:not([src^="data:"])'}]},renderHTML({HTMLAttributes:t}){return["img",ft(this.options.HTMLAttributes,t)]},parseMarkdown:(t,e)=>e.createNode("image",{src:t.href,title:t.title,alt:t.text}),renderMarkdown:t=>{var e,n,r,s,i,o;const a=(n=(e=t.attrs)==null?void 0:e.src)!=null?n:"",l=(s=(r=t.attrs)==null?void 0:r.alt)!=null?s:"",c=(o=(i=t.attrs)==null?void 0:i.title)!=null?o:"";return c?`![${l}](${a} "${c}")`:`![${l}](${a})`},addNodeView(){if(!this.options.resize||!this.options.resize.enabled||typeof document>"u")return null;const{directions:t,minWidth:e,minHeight:n,alwaysPreserveAspectRatio:r}=this.options.resize;return({node:s,getPos:i,HTMLAttributes:o,editor:a})=>{const l=document.createElement("img");Object.entries(o).forEach(([h,d])=>{if(d!=null)switch(h){case"width":case"height":break;default:l.setAttribute(h,d);break}}),l.src=o.src;const c=new PX({element:l,editor:a,node:s,getPos:i,onResize:(h,d)=>{l.style.width=`${h}px`,l.style.height=`${d}px`},onCommit:(h,d)=>{const f=i();f!==void 0&&this.editor.chain().setNodeSelection(f).updateAttributes(this.name,{width:h,height:d}).run()},onUpdate:(h,d,f)=>h.type===s.type,options:{directions:t,min:{width:e,height:n},preserveAspectRatio:r===!0}}),u=c.dom;return u.style.visibility="hidden",u.style.pointerEvents="none",l.onload=()=>{u.style.visibility="",u.style.pointerEvents=""},c}},addCommands(){return{setImage:t=>({commands:e})=>e.insertContent({type:this.name,attrs:t})}},addInputRules(){return[Dj({find:Mee,type:this.type,getAttributes:t=>{const[,,e,n,r]=t;return{src:n,alt:e,title:r}}})]}}),Dee=Oee,Lee=Iee;let c_,u_;if(typeof WeakMap<"u"){let t=new WeakMap;c_=e=>t.get(e),u_=(e,n)=>(t.set(e,n),n)}else{const t=[];let n=0;c_=r=>{for(let s=0;s<t.length;s+=2)if(t[s]==r)return t[s+1]},u_=(r,s)=>(n==10&&(n=0),t[n++]=r,t[n++]=s)}var Ot=class{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,s=e/this.width|0;let i=r+1,o=s+1;for(let a=1;i<this.width&&this.map[e+a]==n;a++)i++;for(let a=1;o<this.height&&this.map[e+this.width*a]==n;a++)o++;return{left:r,top:s,right:i,bottom:o}}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:s,top:i,bottom:o}=this.findCell(t);return e=="horiz"?(n<0?r==0:s==this.width)?null:this.map[i*this.width+(n<0?r-1:s)]:(n<0?i==0:o==this.height)?null:this.map[r+this.width*(n<0?i-1:o)]}rectBetween(t,e){const{left:n,right:r,top:s,bottom:i}=this.findCell(t),{left:o,right:a,top:l,bottom:c}=this.findCell(e);return{left:Math.min(n,o),top:Math.min(s,l),right:Math.max(r,a),bottom:Math.max(i,c)}}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let s=t.left;s<t.right;s++){const i=r*this.width+s,o=this.map[i];n[o]||(n[o]=!0,!(s==t.left&&s&&this.map[i-1]==o||r==t.top&&r&&this.map[i-this.width]==o)&&e.push(o))}return e}positionAt(t,e,n){for(let r=0,s=0;;r++){const i=s+n.child(r).nodeSize;if(r==t){let o=e+t*this.width;const a=(t+1)*this.width;for(;o<a&&this.map[o]<s;)o++;return o==a?i-1:this.map[o]}s=i}}static get(t){return c_(t)||u_(t,jee(t))}};function jee(t){if(t.type.spec.tableRole!="table")throw new RangeError("Not a table node: "+t.type.name);const e=Vee(t),n=t.childCount,r=[];let s=0,i=null;const o=[];for(let c=0,u=e*n;c<u;c++)r[c]=0;for(let c=0,u=0;c<n;c++){const h=t.child(c);u++;for(let g=0;;g++){for(;s<r.length&&r[s]!=0;)s++;if(g==h.childCount)break;const y=h.child(g),{colspan:v,rowspan:w,colwidth:T}=y.attrs;for(let E=0;E<w;E++){if(E+c>=n){(i||(i=[])).push({type:"overlong_rowspan",pos:u,n:w-E});break}const R=s+E*e;for(let P=0;P<v;P++){r[R+P]==0?r[R+P]=u:(i||(i=[])).push({type:"collision",row:c,pos:u,n:v-P});const N=T&&T[P];if(N){const k=(R+P)%e*2,_=o[k];_==null||_!=N&&o[k+1]==1?(o[k]=N,o[k+1]=1):_==N&&o[k+1]++}}}s+=v,u+=y.nodeSize}const d=(c+1)*e;let f=0;for(;s<d;)r[s++]==0&&f++;f&&(i||(i=[])).push({type:"missing",row:c,n:f}),u++}(e===0||n===0)&&(i||(i=[])).push({type:"zero_sized"});const a=new Ot(e,n,r,i);let l=!1;for(let c=0;!l&&c<o.length;c+=2)o[c]!=null&&o[c+1]<n&&(l=!0);return l&&Fee(a,o,t),a}function Vee(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const s=t.child(r);let i=0;if(n)for(let o=0;o<r;o++){const a=t.child(o);for(let l=0;l<a.childCount;l++){const c=a.child(l);o+c.attrs.rowspan>r&&(i+=c.attrs.colspan)}}for(let o=0;o<s.childCount;o++){const a=s.child(o);i+=a.attrs.colspan,a.attrs.rowspan>1&&(n=!0)}e==-1?e=i:e!=i&&(e=Math.max(e,i))}return e}function Fee(t,e,n){t.problems||(t.problems=[]);const r={};for(let s=0;s<t.map.length;s++){const i=t.map[s];if(r[i])continue;r[i]=!0;const o=n.nodeAt(i);if(!o)throw new RangeError(`No cell with offset ${i} found`);let a=null;const l=o.attrs;for(let c=0;c<l.colspan;c++){const u=e[(s+c)%t.width*2];u!=null&&(!l.colwidth||l.colwidth[c]!=u)&&((a||(a=Bee(l)))[c]=u)}a&&t.problems.unshift({type:"colwidth mismatch",pos:i,colwidth:a})}}function Bee(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}function Ln(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],s=r.spec.tableRole;s&&(e[s]=r)}}return e}const Zi=new Dt("selectingCells");function rl(t){for(let e=t.depth-1;e>0;e--)if(t.node(e).type.spec.tableRole=="row")return t.node(0).resolve(t.before(e+1));return null}function Uee(t){for(let e=t.depth;e>0;e--){const n=t.node(e).type.spec.tableRole;if(n==="cell"||n==="header_cell")return t.node(e)}return null}function us(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if(e.node(n).type.spec.tableRole=="row")return!0;return!1}function rv(t){const e=t.selection;if("$anchorCell"in e&&e.$anchorCell)return e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell;if("node"in e&&e.node&&e.node.type.spec.tableRole=="cell")return e.$anchor;const n=rl(e.$head)||zee(e.$head);if(n)return n;throw new RangeError(`No cell found around position ${e.head}`)}function zee(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if(r=="cell"||r=="header_cell")return t.doc.resolve(n-e.nodeSize)}}function h_(t){return t.parent.type.spec.tableRole=="row"&&!!t.nodeAfter}function $ee(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}function yT(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function d4(t,e,n){const r=t.node(-1),s=Ot.get(r),i=t.start(-1),o=s.nextCell(t.pos-i,e,n);return o==null?null:t.node(0).resolve(i+o)}function sl(t,e,n=1){const r={...t,colspan:t.colspan-n};return r.colwidth&&(r.colwidth=r.colwidth.slice(),r.colwidth.splice(e,n),r.colwidth.some(s=>s>0)||(r.colwidth=null)),r}function f4(t,e,n=1){const r={...t,colspan:t.colspan+n};if(r.colwidth){r.colwidth=r.colwidth.slice();for(let s=0;s<n;s++)r.colwidth.splice(e,0,0)}return r}function Hee(t,e,n){const r=Ln(e.type.schema).header_cell;for(let s=0;s<t.height;s++)if(e.nodeAt(t.map[n+s*t.width]).type!=r)return!1;return!0}var at=class qs extends ke{constructor(e,n=e){const r=e.node(-1),s=Ot.get(r),i=e.start(-1),o=s.rectBetween(e.pos-i,n.pos-i),a=e.node(0),l=s.cellsInRect(o).filter(u=>u!=n.pos-i);l.unshift(n.pos-i);const c=l.map(u=>{const h=r.nodeAt(u);if(!h)throw new RangeError(`No cell with offset ${u} found`);const d=i+u+1;return new oL(a.resolve(d),a.resolve(d+h.content.size))});super(c[0].$from,c[0].$to,c),this.$anchorCell=e,this.$headCell=n}map(e,n){const r=e.resolve(n.map(this.$anchorCell.pos)),s=e.resolve(n.map(this.$headCell.pos));if(h_(r)&&h_(s)&&yT(r,s)){const i=this.$anchorCell.node(-1)!=r.node(-1);return i&&this.isRowSelection()?qs.rowSelection(r,s):i&&this.isColSelection()?qs.colSelection(r,s):new qs(r,s)}return be.between(r,s)}content(){const e=this.$anchorCell.node(-1),n=Ot.get(e),r=this.$anchorCell.start(-1),s=n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r),i={},o=[];for(let l=s.top;l<s.bottom;l++){const c=[];for(let u=l*n.width+s.left,h=s.left;h<s.right;h++,u++){const d=n.map[u];if(i[d])continue;i[d]=!0;const f=n.findCell(d);let g=e.nodeAt(d);if(!g)throw new RangeError(`No cell with offset ${d} found`);const y=s.left-f.left,v=f.right-s.right;if(y>0||v>0){let w=g.attrs;if(y>0&&(w=sl(w,0,y)),v>0&&(w=sl(w,w.colspan-v,v)),f.left<s.left){if(g=g.type.createAndFill(w),!g)throw new RangeError(`Could not create cell with attrs ${JSON.stringify(w)}`)}else g=g.type.create(w,g.content)}if(f.top<s.top||f.bottom>s.bottom){const w={...g.attrs,rowspan:Math.min(f.bottom,s.bottom)-Math.max(f.top,s.top)};f.top<s.top?g=g.type.createAndFill(w):g=g.type.create(w,g.content)}c.push(g)}o.push(e.child(l).copy(te.from(c)))}const a=this.isColSelection()&&this.isRowSelection()?e:o;return new ue(te.from(a),1,1)}replace(e,n=ue.empty){const r=e.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){const{$from:a,$to:l}=s[o],c=e.mapping.slice(r);e.replace(c.map(a.pos),c.map(l.pos),o?ue.empty:n)}const i=ke.findFrom(e.doc.resolve(e.mapping.slice(r).map(this.to)),-1);i&&e.setSelection(i)}replaceWith(e,n){this.replace(e,new ue(te.from(n),0,0))}forEachCell(e){const n=this.$anchorCell.node(-1),r=Ot.get(n),s=this.$anchorCell.start(-1),i=r.cellsInRect(r.rectBetween(this.$anchorCell.pos-s,this.$headCell.pos-s));for(let o=0;o<i.length;o++)e(n.nodeAt(i[o]),s+i[o])}isColSelection(){const e=this.$anchorCell.index(-1),n=this.$headCell.index(-1);if(Math.min(e,n)>0)return!1;const r=e+this.$anchorCell.nodeAfter.attrs.rowspan,s=n+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(r,s)==this.$headCell.node(-1).childCount}static colSelection(e,n=e){const r=e.node(-1),s=Ot.get(r),i=e.start(-1),o=s.findCell(e.pos-i),a=s.findCell(n.pos-i),l=e.node(0);return o.top<=a.top?(o.top>0&&(e=l.resolve(i+s.map[o.left])),a.bottom<s.height&&(n=l.resolve(i+s.map[s.width*(s.height-1)+a.right-1]))):(a.top>0&&(n=l.resolve(i+s.map[a.left])),o.bottom<s.height&&(e=l.resolve(i+s.map[s.width*(s.height-1)+o.right-1]))),new qs(e,n)}isRowSelection(){const e=this.$anchorCell.node(-1),n=Ot.get(e),r=this.$anchorCell.start(-1),s=n.colCount(this.$anchorCell.pos-r),i=n.colCount(this.$headCell.pos-r);if(Math.min(s,i)>0)return!1;const o=s+this.$anchorCell.nodeAfter.attrs.colspan,a=i+this.$headCell.nodeAfter.attrs.colspan;return Math.max(o,a)==n.width}eq(e){return e instanceof qs&&e.$anchorCell.pos==this.$anchorCell.pos&&e.$headCell.pos==this.$headCell.pos}static rowSelection(e,n=e){const r=e.node(-1),s=Ot.get(r),i=e.start(-1),o=s.findCell(e.pos-i),a=s.findCell(n.pos-i),l=e.node(0);return o.left<=a.left?(o.left>0&&(e=l.resolve(i+s.map[o.top*s.width])),a.right<s.width&&(n=l.resolve(i+s.map[s.width*(a.top+1)-1]))):(a.left>0&&(n=l.resolve(i+s.map[a.top*s.width])),o.right<s.width&&(e=l.resolve(i+s.map[s.width*(o.top+1)-1]))),new qs(e,n)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(e,n){return new qs(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,r=n){return new qs(e.resolve(n),e.resolve(r))}getBookmark(){return new Wee(this.$anchorCell.pos,this.$headCell.pos)}};at.prototype.visible=!1;ke.jsonID("cell",at);var Wee=class p4{constructor(e,n){this.anchor=e,this.head=n}map(e){return new p4(e.map(this.anchor),e.map(this.head))}resolve(e){const n=e.resolve(this.anchor),r=e.resolve(this.head);return n.parent.type.spec.tableRole=="row"&&r.parent.type.spec.tableRole=="row"&&n.index()<n.parent.childCount&&r.index()<r.parent.childCount&&yT(n,r)?new at(n,r):ke.near(r,1)}};function qee(t){if(!(t.selection instanceof at))return null;const e=[];return t.selection.forEachCell((n,r)=>{e.push(ln.node(r,r+n.nodeSize,{class:"selectedCell"}))}),it.create(t.doc,e)}function Kee({$from:t,$to:e}){if(t.pos==e.pos||t.pos<e.pos-6)return!1;let n=t.pos,r=e.pos,s=t.depth;for(;s>=0&&!(t.after(s+1)<t.end(s));s--,n++);for(let i=e.depth;i>=0&&!(e.before(i+1)>e.start(i));i--,r--);return n==r&&/row|table/.test(t.node(s).type.spec.tableRole)}function Gee({$from:t,$to:e}){let n,r;for(let s=t.depth;s>0;s--){const i=t.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){n=i;break}}for(let s=e.depth;s>0;s--){const i=e.node(s);if(i.type.spec.tableRole==="cell"||i.type.spec.tableRole==="header_cell"){r=i;break}}return n!==r&&e.parentOffset===0}function Qee(t,e,n){const r=(e||t).selection,s=(e||t).doc;let i,o;if(r instanceof _e&&(o=r.node.type.spec.tableRole)){if(o=="cell"||o=="header_cell")i=at.create(s,r.from);else if(o=="row"){const a=s.resolve(r.from+1);i=at.rowSelection(a,a)}else if(!n){const a=Ot.get(r.node),l=r.from+1,c=l+a.map[a.width*a.height-1];i=at.create(s,l+1,c)}}else r instanceof be&&Kee(r)?i=be.create(s,r.from):r instanceof be&&Gee(r)&&(i=be.create(s,r.$from.start(),r.$from.end()));return i&&(e||(e=t.tr)).setSelection(i),e}const Jee=new Dt("fix-tables");function m4(t,e,n,r){const s=t.childCount,i=e.childCount;e:for(let o=0,a=0;o<i;o++){const l=e.child(o);for(let c=a,u=Math.min(s,o+3);c<u;c++)if(t.child(c)==l){a=c+1,n+=l.nodeSize;continue e}r(l,n),a<s&&t.child(a).sameMarkup(l)?m4(t.child(a),l,n+1,r):l.nodesBetween(0,l.content.size,r,n+1),n+=l.nodeSize}}function g4(t,e){let n;const r=(s,i)=>{s.type.spec.tableRole=="table"&&(n=Xee(t,s,i,n))};return e?e.doc!=t.doc&&m4(e.doc,t.doc,0,r):t.doc.descendants(r),n}function Xee(t,e,n,r){const s=Ot.get(e);if(!s.problems)return r;r||(r=t.tr);const i=[];for(let l=0;l<s.height;l++)i.push(0);for(let l=0;l<s.problems.length;l++){const c=s.problems[l];if(c.type=="collision"){const u=e.nodeAt(c.pos);if(!u)continue;const h=u.attrs;for(let d=0;d<h.rowspan;d++)i[c.row+d]+=c.n;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,sl(h,h.colspan-c.n,c.n))}else if(c.type=="missing")i[c.row]+=c.n;else if(c.type=="overlong_rowspan"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,rowspan:u.attrs.rowspan-c.n})}else if(c.type=="colwidth mismatch"){const u=e.nodeAt(c.pos);if(!u)continue;r.setNodeMarkup(r.mapping.map(n+1+c.pos),null,{...u.attrs,colwidth:c.colwidth})}else if(c.type=="zero_sized"){const u=r.mapping.map(n);r.delete(u,u+e.nodeSize)}}let o,a;for(let l=0;l<i.length;l++)i[l]&&(o==null&&(o=l),a=l);for(let l=0,c=n+1;l<s.height;l++){const u=e.child(l),h=c+u.nodeSize,d=i[l];if(d>0){let f="cell";u.firstChild&&(f=u.firstChild.type.spec.tableRole);const g=[];for(let v=0;v<d;v++){const w=Ln(t.schema)[f].createAndFill();w&&g.push(w)}const y=(l==0||o==l-1)&&a==l?c+1:h-1;r.insert(r.mapping.map(y),g)}c=h}return r.setMeta(Jee,{fixTables:!0})}function Vs(t){const e=t.selection,n=rv(t),r=n.node(-1),s=n.start(-1),i=Ot.get(r);return{...e instanceof at?i.rectBetween(e.$anchorCell.pos-s,e.$headCell.pos-s):i.findCell(n.pos-s),tableStart:s,map:i,table:r}}function y4(t,{map:e,tableStart:n,table:r},s){let i=s>0?-1:0;Hee(e,r,s+i)&&(i=s==0||s==e.width?null:0);for(let o=0;o<e.height;o++){const a=o*e.width+s;if(s>0&&s<e.width&&e.map[a-1]==e.map[a]){const l=e.map[a],c=r.nodeAt(l);t.setNodeMarkup(t.mapping.map(n+l),null,f4(c.attrs,s-e.colCount(l))),o+=c.attrs.rowspan-1}else{const l=i==null?Ln(r.type.schema).cell:r.nodeAt(e.map[a+i]).type,c=e.positionAt(o,s,r);t.insert(t.mapping.map(n+c),l.createAndFill())}}return t}function Yee(t,e){if(!us(t))return!1;if(e){const n=Vs(t);e(y4(t.tr,n,n.left))}return!0}function Zee(t,e){if(!us(t))return!1;if(e){const n=Vs(t);e(y4(t.tr,n,n.right))}return!0}function ete(t,{map:e,table:n,tableStart:r},s){const i=t.mapping.maps.length;for(let o=0;o<e.height;){const a=o*e.width+s,l=e.map[a],c=n.nodeAt(l),u=c.attrs;if(s>0&&e.map[a-1]==l||s<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(i).map(r+l),null,sl(u,s-e.colCount(l)));else{const h=t.mapping.slice(i).map(r+l);t.delete(h,h+c.nodeSize)}o+=u.rowspan}}function tte(t,e){if(!us(t))return!1;if(e){const n=Vs(t),r=t.tr;if(n.left==0&&n.right==n.map.width)return!1;for(let s=n.right-1;ete(r,n,s),s!=n.left;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Ot.get(i)}e(r)}return!0}function nte(t,e,n){var r;const s=Ln(e.type.schema).header_cell;for(let i=0;i<t.width;i++)if(((r=e.nodeAt(t.map[i+n*t.width]))===null||r===void 0?void 0:r.type)!=s)return!1;return!0}function v4(t,{map:e,tableStart:n,table:r},s){let i=n;for(let c=0;c<s;c++)i+=r.child(c).nodeSize;const o=[];let a=s>0?-1:0;nte(e,r,s+a)&&(a=s==0||s==e.height?null:0);for(let c=0,u=e.width*s;c<e.width;c++,u++)if(s>0&&s<e.height&&e.map[u]==e.map[u-e.width]){const h=e.map[u],d=r.nodeAt(h).attrs;t.setNodeMarkup(n+h,null,{...d,rowspan:d.rowspan+1}),c+=d.colspan-1}else{var l;const h=a==null?Ln(r.type.schema).cell:(l=r.nodeAt(e.map[u+a*e.width]))===null||l===void 0?void 0:l.type,d=h==null?void 0:h.createAndFill();d&&o.push(d)}return t.insert(i,Ln(r.type.schema).row.create(null,o)),t}function rte(t,e){if(!us(t))return!1;if(e){const n=Vs(t);e(v4(t.tr,n,n.top))}return!0}function ste(t,e){if(!us(t))return!1;if(e){const n=Vs(t);e(v4(t.tr,n,n.bottom))}return!0}function ite(t,{map:e,table:n,tableStart:r},s){let i=0;for(let c=0;c<s;c++)i+=n.child(c).nodeSize;const o=i+n.child(s).nodeSize,a=t.mapping.maps.length;t.delete(i+r,o+r);const l=new Set;for(let c=0,u=s*e.width;c<e.width;c++,u++){const h=e.map[u];if(!l.has(h)){if(l.add(h),s>0&&h==e.map[u-e.width]){const d=n.nodeAt(h).attrs;t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,{...d,rowspan:d.rowspan-1}),c+=d.colspan-1}else if(s<e.height&&h==e.map[u+e.width]){const d=n.nodeAt(h),f=d.attrs,g=d.type.create({...f,rowspan:d.attrs.rowspan-1},d.content),y=e.positionAt(s+1,c,n);t.insert(t.mapping.slice(a).map(r+y),g),c+=f.colspan-1}}}}function ote(t,e){if(!us(t))return!1;if(e){const n=Vs(t),r=t.tr;if(n.top==0&&n.bottom==n.map.height)return!1;for(let s=n.bottom-1;ite(r,n,s),s!=n.top;s--){const i=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc;if(!i)throw new RangeError("No table found");n.table=i,n.map=Ot.get(n.table)}e(r)}return!0}function wA(t){const e=t.content;return e.childCount==1&&e.child(0).isTextblock&&e.child(0).childCount==0}function ate({width:t,height:e,map:n},r){let s=r.top*t+r.left,i=s,o=(r.bottom-1)*t+r.left,a=s+(r.right-r.left-1);for(let l=r.top;l<r.bottom;l++){if(r.left>0&&n[i]==n[i-1]||r.right<t&&n[a]==n[a+1])return!0;i+=t,a+=t}for(let l=r.left;l<r.right;l++){if(r.top>0&&n[s]==n[s-t]||r.bottom<e&&n[o]==n[o+t])return!0;s++,o++}return!1}function _A(t,e){const n=t.selection;if(!(n instanceof at)||n.$anchorCell.pos==n.$headCell.pos)return!1;const r=Vs(t),{map:s}=r;if(ate(s,r))return!1;if(e){const i=t.tr,o={};let a=te.empty,l,c;for(let u=r.top;u<r.bottom;u++)for(let h=r.left;h<r.right;h++){const d=s.map[u*s.width+h],f=r.table.nodeAt(d);if(!(o[d]||!f))if(o[d]=!0,l==null)l=d,c=f;else{wA(f)||(a=a.append(f.content));const g=i.mapping.map(d+r.tableStart);i.delete(g,g+f.nodeSize)}}if(l==null||c==null)return!0;if(i.setNodeMarkup(l+r.tableStart,null,{...f4(c.attrs,c.attrs.colspan,r.right-r.left-c.attrs.colspan),rowspan:r.bottom-r.top}),a.size>0){const u=l+1+c.content.size,h=wA(c)?l+1:u;i.replaceWith(h+r.tableStart,u+r.tableStart,a)}i.setSelection(new at(i.doc.resolve(l+r.tableStart))),e(i)}return!0}function xA(t,e){const n=Ln(t.schema);return lte(({node:r})=>n[r.type.spec.tableRole])(t,e)}function lte(t){return(e,n)=>{const r=e.selection;let s,i;if(r instanceof at){if(r.$anchorCell.pos!=r.$headCell.pos)return!1;s=r.$anchorCell.nodeAfter,i=r.$anchorCell.pos}else{var o;if(s=Uee(r.$from),!s)return!1;i=(o=rl(r.$from))===null||o===void 0?void 0:o.pos}if(s==null||i==null||s.attrs.colspan==1&&s.attrs.rowspan==1)return!1;if(n){let a=s.attrs;const l=[],c=a.colwidth;a.rowspan>1&&(a={...a,rowspan:1}),a.colspan>1&&(a={...a,colspan:1});const u=Vs(e),h=e.tr;for(let f=0;f<u.right-u.left;f++)l.push(c?{...a,colwidth:c&&c[f]?[c[f]]:null}:a);let d;for(let f=u.top;f<u.bottom;f++){let g=u.map.positionAt(f,u.left,u.table);f==u.top&&(g+=s.nodeSize);for(let y=u.left,v=0;y<u.right;y++,v++)y==u.left&&f==u.top||h.insert(d=h.mapping.map(g+u.tableStart,1),t({node:s,row:f,col:y}).createAndFill(l[v]))}h.setNodeMarkup(i,t({node:s,row:u.top,col:u.left}),l[0]),r instanceof at&&h.setSelection(new at(h.doc.resolve(r.$anchorCell.pos),d?h.doc.resolve(d):void 0)),n(h)}return!0}}function cte(t,e){return function(n,r){if(!us(n))return!1;const s=rv(n);if(s.nodeAfter.attrs[t]===e)return!1;if(r){const i=n.tr;n.selection instanceof at?n.selection.forEachCell((o,a)=>{o.attrs[t]!==e&&i.setNodeMarkup(a,null,{...o.attrs,[t]:e})}):i.setNodeMarkup(s.pos,null,{...s.nodeAfter.attrs,[t]:e}),r(i)}return!0}}function ute(t){return function(e,n){if(!us(e))return!1;if(n){const r=Ln(e.schema),s=Vs(e),i=e.tr,o=s.map.cellsInRect(t=="column"?{left:s.left,top:0,right:s.right,bottom:s.map.height}:t=="row"?{left:0,top:s.top,right:s.map.width,bottom:s.bottom}:s),a=o.map(l=>s.table.nodeAt(l));for(let l=0;l<o.length;l++)a[l].type==r.header_cell&&i.setNodeMarkup(s.tableStart+o[l],r.cell,a[l].attrs);if(i.steps.length===0)for(let l=0;l<o.length;l++)i.setNodeMarkup(s.tableStart+o[l],r.header_cell,a[l].attrs);n(i)}return!0}}function bA(t,e,n){const r=e.map.cellsInRect({left:0,top:0,right:t=="row"?e.map.width:1,bottom:t=="column"?e.map.height:1});for(let s=0;s<r.length;s++){const i=e.table.nodeAt(r[s]);if(i&&i.type!==n.header_cell)return!1}return!0}function Ed(t,e){return e=e||{useDeprecatedLogic:!1},e.useDeprecatedLogic?ute(t):function(n,r){if(!us(n))return!1;if(r){const s=Ln(n.schema),i=Vs(n),o=n.tr,a=bA("row",i,s),l=bA("column",i,s),c=(t==="column"?a:t==="row"&&l)?1:0,u=t=="column"?{left:0,top:c,right:1,bottom:i.map.height}:t=="row"?{left:c,top:0,right:i.map.width,bottom:1}:i,h=t=="column"?l?s.cell:s.header_cell:t=="row"?a?s.cell:s.header_cell:s.cell;i.map.cellsInRect(u).forEach(d=>{const f=d+i.tableStart,g=o.doc.nodeAt(f);g&&o.setNodeMarkup(f,h,g.attrs)}),r(o)}return!0}}Ed("row",{useDeprecatedLogic:!0});Ed("column",{useDeprecatedLogic:!0});const hte=Ed("cell",{useDeprecatedLogic:!0});function dte(t,e){if(e<0){const n=t.nodeBefore;if(n)return t.pos-n.nodeSize;for(let r=t.index(-1)-1,s=t.before();r>=0;r--){const i=t.node(-1).child(r),o=i.lastChild;if(o)return s-1-o.nodeSize;s-=i.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const n=t.node(-1);for(let r=t.indexAfter(-1),s=t.after();r<n.childCount;r++){const i=n.child(r);if(i.childCount)return s+1;s+=i.nodeSize}}return null}function TA(t){return function(e,n){if(!us(e))return!1;const r=dte(rv(e),t);if(r==null)return!1;if(n){const s=e.doc.resolve(r);n(e.tr.setSelection(be.between(s,$ee(s))).scrollIntoView())}return!0}}function fte(t,e){const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if(n.node(r).type.spec.tableRole=="table")return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1}function sp(t,e){const n=t.selection;if(!(n instanceof at))return!1;if(e){const r=t.tr,s=Ln(t.schema).cell.createAndFill().content;n.forEachCell((i,o)=>{i.content.eq(s)||r.replace(r.mapping.map(o+1),r.mapping.map(o+i.nodeSize-1),new ue(s,0,0))}),r.docChanged&&e(r)}return!0}function pte(t){if(t.size===0)return null;let{content:e,openStart:n,openEnd:r}=t;for(;e.childCount==1&&(n>0&&r>0||e.child(0).type.spec.tableRole=="table");)n--,r--,e=e.child(0).content;const s=e.child(0),i=s.type.spec.tableRole,o=s.type.schema,a=[];if(i=="row")for(let l=0;l<e.childCount;l++){let c=e.child(l).content;const u=l?0:Math.max(0,n-1),h=l<e.childCount-1?0:Math.max(0,r-1);(u||h)&&(c=d_(Ln(o).row,new ue(c,u,h)).content),a.push(c)}else if(i=="cell"||i=="header_cell")a.push(n||r?d_(Ln(o).row,new ue(e,n,r)).content:e);else return null;return mte(o,a)}function mte(t,e){const n=[];for(let s=0;s<e.length;s++){const i=e[s];for(let o=i.childCount-1;o>=0;o--){const{rowspan:a,colspan:l}=i.child(o).attrs;for(let c=s;c<s+a;c++)n[c]=(n[c]||0)+l}}let r=0;for(let s=0;s<n.length;s++)r=Math.max(r,n[s]);for(let s=0;s<n.length;s++)if(s>=e.length&&e.push(te.empty),n[s]<r){const i=Ln(t).cell.createAndFill(),o=[];for(let a=n[s];a<r;a++)o.push(i);e[s]=e[s].append(te.from(o))}return{height:e.length,width:r,rows:e}}function d_(t,e){const n=t.createAndFill();return new Mb(n).replace(0,n.content.size,e).doc}function gte({width:t,height:e,rows:n},r,s){if(t!=r){const i=[],o=[];for(let a=0;a<n.length;a++){const l=n[a],c=[];for(let u=i[a]||0,h=0;u<r;h++){let d=l.child(h%l.childCount);u+d.attrs.colspan>r&&(d=d.type.createChecked(sl(d.attrs,d.attrs.colspan,u+d.attrs.colspan-r),d.content)),c.push(d),u+=d.attrs.colspan;for(let f=1;f<d.attrs.rowspan;f++)i[a+f]=(i[a+f]||0)+d.attrs.colspan}o.push(te.from(c))}n=o,t=r}if(e!=s){const i=[];for(let o=0,a=0;o<s;o++,a++){const l=[],c=n[a%e];for(let u=0;u<c.childCount;u++){let h=c.child(u);o+h.attrs.rowspan>s&&(h=h.type.create({...h.attrs,rowspan:Math.max(1,s-h.attrs.rowspan)},h.content)),l.push(h)}i.push(te.from(l))}n=i,e=s}return{width:t,height:e,rows:n}}function yte(t,e,n,r,s,i,o){const a=t.doc.type.schema,l=Ln(a);let c,u;if(s>e.width)for(let h=0,d=0;h<e.height;h++){const f=n.child(h);d+=f.nodeSize;const g=[];let y;f.lastChild==null||f.lastChild.type==l.cell?y=c||(c=l.cell.createAndFill()):y=u||(u=l.header_cell.createAndFill());for(let v=e.width;v<s;v++)g.push(y);t.insert(t.mapping.slice(o).map(d-1+r),g)}if(i>e.height){const h=[];for(let g=0,y=(e.height-1)*e.width;g<Math.max(e.width,s);g++){const v=g>=e.width?!1:n.nodeAt(e.map[y+g]).type==l.header_cell;h.push(v?u||(u=l.header_cell.createAndFill()):c||(c=l.cell.createAndFill()))}const d=l.row.create(null,te.from(h)),f=[];for(let g=e.height;g<i;g++)f.push(d);t.insert(t.mapping.slice(o).map(r+n.nodeSize-2),f)}return!!(c||u)}function EA(t,e,n,r,s,i,o,a){if(o==0||o==e.height)return!1;let l=!1;for(let c=s;c<i;c++){const u=o*e.width+c,h=e.map[u];if(e.map[u-e.width]==h){l=!0;const d=n.nodeAt(h),{top:f,left:g}=e.findCell(h);t.setNodeMarkup(t.mapping.slice(a).map(h+r),null,{...d.attrs,rowspan:o-f}),t.insert(t.mapping.slice(a).map(e.positionAt(o,g,n)),d.type.createAndFill({...d.attrs,rowspan:f+d.attrs.rowspan-o})),c+=d.attrs.colspan-1}}return l}function SA(t,e,n,r,s,i,o,a){if(o==0||o==e.width)return!1;let l=!1;for(let c=s;c<i;c++){const u=c*e.width+o,h=e.map[u];if(e.map[u-1]==h){l=!0;const d=n.nodeAt(h),f=e.colCount(h),g=t.mapping.slice(a).map(h+r);t.setNodeMarkup(g,null,sl(d.attrs,o-f,d.attrs.colspan-(o-f))),t.insert(g+d.nodeSize,d.type.createAndFill(sl(d.attrs,0,o-f))),c+=d.attrs.rowspan-1}}return l}function kA(t,e,n,r,s){let i=n?t.doc.nodeAt(n-1):t.doc;if(!i)throw new Error("No table found");let o=Ot.get(i);const{top:a,left:l}=r,c=l+s.width,u=a+s.height,h=t.tr;let d=0;function f(){if(i=n?h.doc.nodeAt(n-1):h.doc,!i)throw new Error("No table found");o=Ot.get(i),d=h.mapping.maps.length}yte(h,o,i,n,c,u,d)&&f(),EA(h,o,i,n,l,c,a,d)&&f(),EA(h,o,i,n,l,c,u,d)&&f(),SA(h,o,i,n,a,u,l,d)&&f(),SA(h,o,i,n,a,u,c,d)&&f();for(let g=a;g<u;g++){const y=o.positionAt(g,l,i),v=o.positionAt(g,c,i);h.replace(h.mapping.slice(d).map(y+n),h.mapping.slice(d).map(v+n),new ue(s.rows[g-a],0,0))}f(),h.setSelection(new at(h.doc.resolve(n+o.positionAt(a,l,i)),h.doc.resolve(n+o.positionAt(u-1,c-1,i)))),e(h)}const vte=Qb({ArrowLeft:ip("horiz",-1),ArrowRight:ip("horiz",1),ArrowUp:ip("vert",-1),ArrowDown:ip("vert",1),"Shift-ArrowLeft":op("horiz",-1),"Shift-ArrowRight":op("horiz",1),"Shift-ArrowUp":op("vert",-1),"Shift-ArrowDown":op("vert",1),Backspace:sp,"Mod-Backspace":sp,Delete:sp,"Mod-Delete":sp});function Kp(t,e,n){return n.eq(t.selection)?!1:(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function ip(t,e){return(n,r,s)=>{if(!s)return!1;const i=n.selection;if(i instanceof at)return Kp(n,r,ke.near(i.$headCell,e));if(t!="horiz"&&!i.empty)return!1;const o=w4(s,t,e);if(o==null)return!1;if(t=="horiz")return Kp(n,r,ke.near(n.doc.resolve(i.head+e),e));{const a=n.doc.resolve(o),l=d4(a,t,e);let c;return l?c=ke.near(l,1):e<0?c=ke.near(n.doc.resolve(a.before(-1)),-1):c=ke.near(n.doc.resolve(a.after(-1)),1),Kp(n,r,c)}}}function op(t,e){return(n,r,s)=>{if(!s)return!1;const i=n.selection;let o;if(i instanceof at)o=i;else{const l=w4(s,t,e);if(l==null)return!1;o=new at(n.doc.resolve(l))}const a=d4(o.$headCell,t,e);return a?Kp(n,r,new at(o.$anchorCell,a)):!1}}function wte(t,e){const n=t.state.doc,r=rl(n.resolve(e));return r?(t.dispatch(t.state.tr.setSelection(new at(r))),!0):!1}function _te(t,e,n){if(!us(t.state))return!1;let r=pte(n);const s=t.state.selection;if(s instanceof at){r||(r={width:1,height:1,rows:[te.from(d_(Ln(t.state.schema).cell,n))]});const i=s.$anchorCell.node(-1),o=s.$anchorCell.start(-1),a=Ot.get(i).rectBetween(s.$anchorCell.pos-o,s.$headCell.pos-o);return r=gte(r,a.right-a.left,a.bottom-a.top),kA(t.state,t.dispatch,o,a,r),!0}else if(r){const i=rv(t.state),o=i.start(-1);return kA(t.state,t.dispatch,o,Ot.get(i.node(-1)).findCell(i.pos-o),r),!0}else return!1}function xte(t,e){var n;if(e.button!=0||e.ctrlKey||e.metaKey)return;const r=CA(t,e.target);let s;if(e.shiftKey&&t.state.selection instanceof at)i(t.state.selection.$anchorCell,e),e.preventDefault();else if(e.shiftKey&&r&&(s=rl(t.state.selection.$anchor))!=null&&((n=W0(t,e))===null||n===void 0?void 0:n.pos)!=s.pos)i(s,e),e.preventDefault();else if(!r)return;function i(l,c){let u=W0(t,c);const h=Zi.getState(t.state)==null;if(!u||!yT(l,u))if(h)u=l;else return;const d=new at(l,u);if(h||!t.state.selection.eq(d)){const f=t.state.tr.setSelection(d);h&&f.setMeta(Zi,l.pos),t.dispatch(f)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",a),Zi.getState(t.state)!=null&&t.dispatch(t.state.tr.setMeta(Zi,-1))}function a(l){const c=l,u=Zi.getState(t.state);let h;if(u!=null)h=t.state.doc.resolve(u);else if(CA(t,c.target)!=r&&(h=W0(t,e),!h))return o();h&&i(h,c)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",a)}function w4(t,e,n){if(!(t.state.selection instanceof be))return null;const{$head:r}=t.state.selection;for(let s=r.depth-1;s>=0;s--){const i=r.node(s);if((n<0?r.index(s):r.indexAfter(s))!=(n<0?0:i.childCount))return null;if(i.type.spec.tableRole=="cell"||i.type.spec.tableRole=="header_cell"){const o=r.before(s),a=e=="vert"?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(a)?o:null}}return null}function CA(t,e){for(;e&&e!=t.dom;e=e.parentNode)if(e.nodeName=="TD"||e.nodeName=="TH")return e;return null}function W0(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});if(!n)return null;let{inside:r,pos:s}=n;return r>=0&&rl(t.state.doc.resolve(r))||rl(t.state.doc.resolve(s))}var bte=class{constructor(e,n){this.node=e,this.defaultCellMinWidth=n,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.table.style.setProperty("--default-cell-min-width",`${n}px`),this.colgroup=this.table.appendChild(document.createElement("colgroup")),f_(e,this.colgroup,this.table,n),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(e){return e.type!=this.node.type?!1:(this.node=e,f_(e,this.colgroup,this.table,this.defaultCellMinWidth),!0)}ignoreMutation(e){return e.type=="attributes"&&(e.target==this.table||this.colgroup.contains(e.target))}};function f_(t,e,n,r,s,i){let o=0,a=!0,l=e.firstChild;const c=t.firstChild;if(c){for(let h=0,d=0;h<c.childCount;h++){const{colspan:f,colwidth:g}=c.child(h).attrs;for(let y=0;y<f;y++,d++){const v=s==d?i:g&&g[y],w=v?v+"px":"";if(o+=v||r,v||(a=!1),l)l.style.width!=w&&(l.style.width=w),l=l.nextSibling;else{const T=document.createElement("col");T.style.width=w,e.appendChild(T)}}}for(;l;){var u;const h=l.nextSibling;(u=l.parentNode)===null||u===void 0||u.removeChild(l),l=h}a?(n.style.width=o+"px",n.style.minWidth=""):(n.style.width="",n.style.minWidth=o+"px")}}const dr=new Dt("tableColumnResizing");function Tte({handleWidth:t=5,cellMinWidth:e=25,defaultCellMinWidth:n=100,View:r=bte,lastColumnResizable:s=!0}={}){const i=new pt({key:dr,state:{init(o,a){var l;const c=(l=i.spec)===null||l===void 0||(l=l.props)===null||l===void 0?void 0:l.nodeViews,u=Ln(a.schema).table.name;return r&&c&&(c[u]=(h,d)=>new r(h,n,d)),new Ete(-1,!1)},apply(o,a){return a.apply(o)}},props:{attributes:o=>{const a=dr.getState(o);return a&&a.activeHandle>-1?{class:"resize-cursor"}:{}},handleDOMEvents:{mousemove:(o,a)=>{Ste(o,a,t,s)},mouseleave:o=>{kte(o)},mousedown:(o,a)=>{Cte(o,a,e,n)}},decorations:o=>{const a=dr.getState(o);if(a&&a.activeHandle>-1)return Pte(o,a.activeHandle)},nodeViews:{}}});return i}var Ete=class Gp{constructor(e,n){this.activeHandle=e,this.dragging=n}apply(e){const n=this,r=e.getMeta(dr);if(r&&r.setHandle!=null)return new Gp(r.setHandle,!1);if(r&&r.setDragging!==void 0)return new Gp(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let s=e.mapping.map(n.activeHandle,-1);return h_(e.doc.resolve(s))||(s=-1),new Gp(s,n.dragging)}return n}};function Ste(t,e,n,r){if(!t.editable)return;const s=dr.getState(t.state);if(s&&!s.dragging){const i=Ate(e.target);let o=-1;if(i){const{left:a,right:l}=i.getBoundingClientRect();e.clientX-a<=n?o=IA(t,e,"left",n):l-e.clientX<=n&&(o=IA(t,e,"right",n))}if(o!=s.activeHandle){if(!r&&o!==-1){const a=t.state.doc.resolve(o),l=a.node(-1),c=Ot.get(l),u=a.start(-1);if(c.colCount(a.pos-u)+a.nodeAfter.attrs.colspan-1==c.width-1)return}_4(t,o)}}}function kte(t){if(!t.editable)return;const e=dr.getState(t.state);e&&e.activeHandle>-1&&!e.dragging&&_4(t,-1)}function Cte(t,e,n,r){var s;if(!t.editable)return!1;const i=(s=t.dom.ownerDocument.defaultView)!==null&&s!==void 0?s:window,o=dr.getState(t.state);if(!o||o.activeHandle==-1||o.dragging)return!1;const a=t.state.doc.nodeAt(o.activeHandle),l=Ite(t,o.activeHandle,a.attrs);t.dispatch(t.state.tr.setMeta(dr,{setDragging:{startX:e.clientX,startWidth:l}}));function c(h){i.removeEventListener("mouseup",c),i.removeEventListener("mousemove",u);const d=dr.getState(t.state);d!=null&&d.dragging&&(Rte(t,d.activeHandle,AA(d.dragging,h,n)),t.dispatch(t.state.tr.setMeta(dr,{setDragging:null})))}function u(h){if(!h.which)return c(h);const d=dr.getState(t.state);if(d&&d.dragging){const f=AA(d.dragging,h,n);RA(t,d.activeHandle,f,r)}}return RA(t,o.activeHandle,l,r),i.addEventListener("mouseup",c),i.addEventListener("mousemove",u),e.preventDefault(),!0}function Ite(t,e,{colspan:n,colwidth:r}){const s=r&&r[r.length-1];if(s)return s;const i=t.domAtPos(e);let o=i.node.childNodes[i.offset].offsetWidth,a=n;if(r)for(let l=0;l<n;l++)r[l]&&(o-=r[l],a--);return o/a}function Ate(t){for(;t&&t.nodeName!="TD"&&t.nodeName!="TH";)t=t.classList&&t.classList.contains("ProseMirror")?null:t.parentNode;return t}function IA(t,e,n,r){const s=n=="right"?-r:r,i=t.posAtCoords({left:e.clientX+s,top:e.clientY});if(!i)return-1;const{pos:o}=i,a=rl(t.state.doc.resolve(o));if(!a)return-1;if(n=="right")return a.pos;const l=Ot.get(a.node(-1)),c=a.start(-1),u=l.map.indexOf(a.pos-c);return u%l.width==0?-1:c+l.map[u-1]}function AA(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function _4(t,e){t.dispatch(t.state.tr.setMeta(dr,{setHandle:e}))}function Rte(t,e,n){const r=t.state.doc.resolve(e),s=r.node(-1),i=Ot.get(s),o=r.start(-1),a=i.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<i.height;c++){const u=c*i.width+a;if(c&&i.map[u]==i.map[u-i.width])continue;const h=i.map[u],d=s.nodeAt(h).attrs,f=d.colspan==1?0:a-i.colCount(h);if(d.colwidth&&d.colwidth[f]==n)continue;const g=d.colwidth?d.colwidth.slice():Nte(d.colspan);g[f]=n,l.setNodeMarkup(o+h,null,{...d,colwidth:g})}l.docChanged&&t.dispatch(l)}function RA(t,e,n,r){const s=t.state.doc.resolve(e),i=s.node(-1),o=s.start(-1),a=Ot.get(i).colCount(s.pos-o)+s.nodeAfter.attrs.colspan-1;let l=t.domAtPos(s.start(-1)).node;for(;l&&l.nodeName!="TABLE";)l=l.parentNode;l&&f_(i,l.firstChild,l,r,a,n)}function Nte(t){return Array(t).fill(0)}function Pte(t,e){const n=[],r=t.doc.resolve(e),s=r.node(-1);if(!s)return it.empty;const i=Ot.get(s),o=r.start(-1),a=i.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1;for(let c=0;c<i.height;c++){const u=a+c*i.width;if((a==i.width-1||i.map[u]!=i.map[u+1])&&(c==0||i.map[u]!=i.map[u-i.width])){var l;const h=i.map[u],d=o+h+s.nodeAt(h).nodeSize-1,f=document.createElement("div");f.className="column-resize-handle",!((l=dr.getState(t))===null||l===void 0)&&l.dragging&&n.push(ln.node(o+h,o+h+s.nodeAt(h).nodeSize,{class:"column-resize-dragging"})),n.push(ln.widget(d,f))}}return it.create(t.doc,n)}function Mte({allowTableNodeSelection:t=!1}={}){return new pt({key:Zi,state:{init(){return null},apply(e,n){const r=e.getMeta(Zi);if(r!=null)return r==-1?null:r;if(n==null||!e.docChanged)return n;const{deleted:s,pos:i}=e.mapping.mapResult(n);return s?null:i}},props:{decorations:qee,handleDOMEvents:{mousedown:xte},createSelectionBetween(e){return Zi.getState(e.state)!=null?e.state.selection:null},handleTripleClick:wte,handleKeyDown:vte,handlePaste:_te},appendTransaction(e,n,r){return Qee(r,g4(r,n),t)}})}var x4=dn.create({name:"tableCell",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{var e,n;const r=t.getAttribute("colwidth"),s=r?r.split(",").map(i=>parseInt(i,10)):null;if(!s){const i=(e=t.closest("table"))==null?void 0:e.querySelectorAll("colgroup > col"),o=Array.from(((n=t.parentElement)==null?void 0:n.children)||[]).indexOf(t);if(o&&o>-1&&i&&i[o]){const a=i[o].getAttribute("width");return a?[parseInt(a,10)]:null}}return s}}}},tableRole:"cell",isolating:!0,parseHTML(){return[{tag:"td"}]},renderHTML({HTMLAttributes:t}){return["td",ft(this.options.HTMLAttributes,t),0]}}),b4=dn.create({name:"tableHeader",addOptions(){return{HTMLAttributes:{}}},content:"block+",addAttributes(){return{colspan:{default:1},rowspan:{default:1},colwidth:{default:null,parseHTML:t=>{const e=t.getAttribute("colwidth");return e?e.split(",").map(r=>parseInt(r,10)):null}}}},tableRole:"header_cell",isolating:!0,parseHTML(){return[{tag:"th"}]},renderHTML({HTMLAttributes:t}){return["th",ft(this.options.HTMLAttributes,t),0]}}),T4=dn.create({name:"tableRow",addOptions(){return{HTMLAttributes:{}}},content:"(tableCell | tableHeader)*",tableRole:"row",parseHTML(){return[{tag:"tr"}]},renderHTML({HTMLAttributes:t}){return["tr",ft(this.options.HTMLAttributes,t),0]}});function p_(t,e){return e?["width",`${Math.max(e,t)}px`]:["min-width",`${t}px`]}function NA(t,e,n,r,s,i){var o;let a=0,l=!0,c=e.firstChild;const u=t.firstChild;if(u!==null)for(let d=0,f=0;d<u.childCount;d+=1){const{colspan:g,colwidth:y}=u.child(d).attrs;for(let v=0;v<g;v+=1,f+=1){const w=s===f?i:y&&y[v],T=w?`${w}px`:"";if(a+=w||r,w||(l=!1),c){if(c.style.width!==T){const[E,R]=p_(r,w);c.style.setProperty(E,R)}c=c.nextSibling}else{const E=document.createElement("col"),[R,P]=p_(r,w);E.style.setProperty(R,P),e.appendChild(E)}}}for(;c;){const d=c.nextSibling;(o=c.parentNode)==null||o.removeChild(c),c=d}const h=t.attrs.style&&typeof t.attrs.style=="string"&&/\bwidth\s*:/i.test(t.attrs.style);l&&!h?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}var Ote=class{constructor(t,e){this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),t.attrs.style&&(this.table.style.cssText=t.attrs.style),this.colgroup=this.table.appendChild(document.createElement("colgroup")),NA(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type!==this.node.type?!1:(this.node=t,NA(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){const e=t.target,n=this.dom.contains(e),r=this.contentDOM.contains(e);return!!(n&&!r&&(t.type==="attributes"||t.type==="childList"||t.type==="characterData"))}};function Dte(t,e,n,r){let s=0,i=!0;const o=[],a=t.firstChild;if(!a)return{};for(let h=0,d=0;h<a.childCount;h+=1){const{colspan:f,colwidth:g}=a.child(h).attrs;for(let y=0;y<f;y+=1,d+=1){const v=n===d?r:g&&g[y];s+=v||e,v||(i=!1);const[w,T]=p_(e,v);o.push(["col",{style:`${w}: ${T}`}])}}const l=i?`${s}px`:"",c=i?"":`${s}px`;return{colgroup:["colgroup",{},...o],tableWidth:l,tableMinWidth:c}}function PA(t,e){return t.createAndFill()}function Lte(t){if(t.cached.tableNodeTypes)return t.cached.tableNodeTypes;const e={};return Object.keys(t.nodes).forEach(n=>{const r=t.nodes[n];r.spec.tableRole&&(e[r.spec.tableRole]=r)}),t.cached.tableNodeTypes=e,e}function jte(t,e,n,r,s){const i=Lte(t),o=[],a=[];for(let c=0;c<n;c+=1){const u=PA(i.cell);if(u&&a.push(u),r){const h=PA(i.header_cell);h&&o.push(h)}}const l=[];for(let c=0;c<e;c+=1)l.push(i.row.createChecked(null,r&&c===0?o:a));return i.table.createChecked(null,l)}function Vte(t){return t instanceof at}var ap=({editor:t})=>{const{selection:e}=t.state;if(!Vte(e))return!1;let n=0;const r=uj(e.ranges[0].$from,i=>i.type.name==="table");return r==null||r.node.descendants(i=>{if(i.type.name==="table")return!1;["tableCell","tableHeader"].includes(i.type.name)&&(n+=1)}),n===e.ranges.length?(t.commands.deleteTable(),!0):!1},Fte="";function Bte(t){return(t||"").replace(/\s+/g," ").trim()}function Ute(t,e,n={}){var r;const s=(r=n.cellLineSeparator)!=null?r:Fte;if(!t||!t.content||t.content.length===0)return"";const i=[];t.content.forEach(g=>{const y=[];g.content&&g.content.forEach(v=>{let w="";v.content&&Array.isArray(v.content)&&v.content.length>1?w=v.content.map(P=>e.renderChildren(P)).join(s):w=v.content?e.renderChildren(v.content):"";const T=Bte(w),E=v.type==="tableHeader";y.push({text:T,isHeader:E})}),i.push(y)});const o=i.reduce((g,y)=>Math.max(g,y.length),0);if(o===0)return"";const a=new Array(o).fill(0);i.forEach(g=>{var y;for(let v=0;v<o;v+=1){const T=(((y=g[v])==null?void 0:y.text)||"").length;T>a[v]&&(a[v]=T),a[v]<3&&(a[v]=3)}});const l=(g,y)=>g+" ".repeat(Math.max(0,y-g.length)),c=i[0],u=c.some(g=>g.isHeader);let h=`
`;const d=new Array(o).fill(0).map((g,y)=>u&&c[y]&&c[y].text||"");return h+=`| ${d.map((g,y)=>l(g,a[y])).join(" | ")} |
`,h+=`| ${a.map(g=>"-".repeat(Math.max(3,g))).join(" | ")} |
`,(u?i.slice(1):i).forEach(g=>{h+=`| ${new Array(o).fill(0).map((y,v)=>l(g[v]&&g[v].text||"",a[v])).join(" | ")} |
`}),h}var zte=Ute,E4=dn.create({name:"table",addOptions(){return{HTMLAttributes:{},resizable:!1,renderWrapper:!1,handleWidth:5,cellMinWidth:25,View:Ote,lastColumnResizable:!0,allowTableNodeSelection:!1}},content:"tableRow+",tableRole:"table",isolating:!0,group:"block",parseHTML(){return[{tag:"table"}]},renderHTML({node:t,HTMLAttributes:e}){const{colgroup:n,tableWidth:r,tableMinWidth:s}=Dte(t,this.options.cellMinWidth),i=e.style;function o(){return i||(r?`width: ${r}`:`min-width: ${s}`)}const a=["table",ft(this.options.HTMLAttributes,e,{style:o()}),n,["tbody",0]];return this.options.renderWrapper?["div",{class:"tableWrapper"},a]:a},parseMarkdown:(t,e)=>{const n=[];if(t.header){const r=[];t.header.forEach(s=>{r.push(e.createNode("tableHeader",{},[{type:"paragraph",content:e.parseInline(s.tokens)}]))}),n.push(e.createNode("tableRow",{},r))}return t.rows&&t.rows.forEach(r=>{const s=[];r.forEach(i=>{s.push(e.createNode("tableCell",{},[{type:"paragraph",content:e.parseInline(i.tokens)}]))}),n.push(e.createNode("tableRow",{},s))}),e.createNode("table",void 0,n)},renderMarkdown:(t,e)=>zte(t,e),addCommands(){return{insertTable:({rows:t=3,cols:e=3,withHeaderRow:n=!0}={})=>({tr:r,dispatch:s,editor:i})=>{const o=jte(i.schema,t,e,n);if(s){const a=r.selection.from+1;r.replaceSelectionWith(o).scrollIntoView().setSelection(be.near(r.doc.resolve(a)))}return!0},addColumnBefore:()=>({state:t,dispatch:e})=>Yee(t,e),addColumnAfter:()=>({state:t,dispatch:e})=>Zee(t,e),deleteColumn:()=>({state:t,dispatch:e})=>tte(t,e),addRowBefore:()=>({state:t,dispatch:e})=>rte(t,e),addRowAfter:()=>({state:t,dispatch:e})=>ste(t,e),deleteRow:()=>({state:t,dispatch:e})=>ote(t,e),deleteTable:()=>({state:t,dispatch:e})=>fte(t,e),mergeCells:()=>({state:t,dispatch:e})=>_A(t,e),splitCell:()=>({state:t,dispatch:e})=>xA(t,e),toggleHeaderColumn:()=>({state:t,dispatch:e})=>Ed("column")(t,e),toggleHeaderRow:()=>({state:t,dispatch:e})=>Ed("row")(t,e),toggleHeaderCell:()=>({state:t,dispatch:e})=>hte(t,e),mergeOrSplit:()=>({state:t,dispatch:e})=>_A(t,e)?!0:xA(t,e),setCellAttribute:(t,e)=>({state:n,dispatch:r})=>cte(t,e)(n,r),goToNextCell:()=>({state:t,dispatch:e})=>TA(1)(t,e),goToPreviousCell:()=>({state:t,dispatch:e})=>TA(-1)(t,e),fixTables:()=>({state:t,dispatch:e})=>(e&&g4(t),!0),setCellSelection:t=>({tr:e,dispatch:n})=>{if(n){const r=at.create(e.doc,t.anchorCell,t.headCell);e.setSelection(r)}return!0}}},addKeyboardShortcuts(){return{Tab:()=>this.editor.commands.goToNextCell()?!0:this.editor.can().addRowAfter()?this.editor.chain().addRowAfter().goToNextCell().run():!1,"Shift-Tab":()=>this.editor.commands.goToPreviousCell(),Backspace:ap,"Mod-Backspace":ap,Delete:ap,"Mod-Delete":ap}},addProseMirrorPlugins(){return[...this.options.resizable&&this.editor.isEditable?[Tte({handleWidth:this.options.handleWidth,cellMinWidth:this.options.cellMinWidth,defaultCellMinWidth:this.options.cellMinWidth,View:this.options.View,lastColumnResizable:this.options.lastColumnResizable})]:[],Mte({allowTableNodeSelection:this.options.allowTableNodeSelection})]},extendNodeSchema(t){const e={name:t.name,options:t.options,storage:t.storage};return{tableRole:Qe(ve(t,"tableRole",e))}}});Lt.create({name:"tableKit",addExtensions(){const t=[];return this.options.table!==!1&&t.push(E4.configure(this.options.table)),this.options.tableCell!==!1&&t.push(x4.configure(this.options.tableCell)),this.options.tableHeader!==!1&&t.push(b4.configure(this.options.tableHeader)),this.options.tableRow!==!1&&t.push(T4.configure(this.options.tableRow)),t}});const $te=Pee.configure({heading:{levels:[2,3,4]}}),Hte=({content:t,onUpdate:e,onImageAdd:n,placeholder:r="Bt u vit bi ti y..."})=>{const s=KY({extensions:[$te,Dee.configure({HTMLAttributes:{class:"blog-image"}}),$Z.configure({openOnClick:!1,HTMLAttributes:{class:"blog-link",target:"_blank",rel:"noopener noreferrer"}}),Lee.configure({placeholder:r}),E4.configure({resizable:!0}),T4,b4,x4],content:t||"",onUpdate:({editor:c})=>{const u=c.getJSON(),h=c.getHTML();e({json:u,html:h})}});V.useEffect(()=>{if(s&&t&&typeof t=="object"){const c=s.getJSON();JSON.stringify(c)!==JSON.stringify(t)&&s.commands.setContent(t)}},[t,s]);const i=V.useCallback((c,u="")=>{s&&(s.chain().focus().setImage({src:c,alt:u}).run(),n&&n({url:c,alt:u}))},[s,n]),o=V.useCallback(()=>{const c=prompt("Nhp URL:");c&&s&&s.chain().focus().extendMarkRange("link").setLink({href:c}).run()},[s]),a=V.useCallback(()=>{s&&s.chain().focus().insertTable({rows:3,cols:3,withHeaderRow:!0}).run()},[s]),l=V.useCallback(()=>{const c=document.createElement("input");c.type="file",c.accept="image/*",c.onchange=async u=>{const h=u.target.files[0];if(h){const d=new FileReader;d.onload=f=>{const g=prompt("Nhp Alt text cho nh (bt buc cho SEO):")||"";i(f.target.result,g)},d.readAsDataURL(h)}},c.click()},[i]);return s?p.jsxs("div",{className:"tiptap-editor-wrapper",children:[p.jsxs("div",{className:"tiptap-toolbar",children:[p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleHeading({level:2}).run(),className:`toolbar-btn ${s.isActive("heading",{level:2})?"active":""}`,title:"Heading 2",children:"H2"}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleHeading({level:3}).run(),className:`toolbar-btn ${s.isActive("heading",{level:3})?"active":""}`,title:"Heading 3",children:"H3"}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleHeading({level:4}).run(),className:`toolbar-btn ${s.isActive("heading",{level:4})?"active":""}`,title:"Heading 4",children:"H4"})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleBold().run(),className:`toolbar-btn ${s.isActive("bold")?"active":""}`,title:"In m",children:p.jsx("strong",{children:"B"})}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleItalic().run(),className:`toolbar-btn ${s.isActive("italic")?"active":""}`,title:"In nghing",children:p.jsx("em",{children:"I"})}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleStrike().run(),className:`toolbar-btn ${s.isActive("strike")?"active":""}`,title:"Gch ngang",children:p.jsx("s",{children:"S"})})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleBulletList().run(),className:`toolbar-btn ${s.isActive("bulletList")?"active":""}`,title:"Danh sch",children:" List"}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleOrderedList().run(),className:`toolbar-btn ${s.isActive("orderedList")?"active":""}`,title:"Danh sch s",children:"1. List"})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:()=>s.chain().focus().toggleBlockquote().run(),className:`toolbar-btn ${s.isActive("blockquote")?"active":""}`,title:"Trch dn",children:'" Quote'}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().setHorizontalRule().run(),className:"toolbar-btn",title:"ng k ngang",children:""})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:l,className:"toolbar-btn",title:"Chn nh",children:" nh"}),p.jsx("button",{type:"button",onClick:o,className:`toolbar-btn ${s.isActive("link")?"active":""}`,title:"Chn link",children:" Link"}),p.jsx("button",{type:"button",onClick:a,className:"toolbar-btn",title:"Chn bng",children:" Bng"})]}),p.jsxs("div",{className:"toolbar-group",children:[p.jsx("button",{type:"button",onClick:()=>s.chain().focus().undo().run(),disabled:!s.can().undo(),className:"toolbar-btn",title:"Hon tc",children:""}),p.jsx("button",{type:"button",onClick:()=>s.chain().focus().redo().run(),disabled:!s.can().redo(),className:"toolbar-btn",title:"Lm li",children:""})]})]}),p.jsx(BY,{editor:s,className:"tiptap-content"})]}):p.jsx("div",{className:"tiptap-loading",children:"ang ti editor..."})},Wte=({seoData:t,onChange:e,content:n,keywords:r,onKeywordsChange:s,searchIntent:i,onIntentChange:o,activeTab:a,setActiveTab:l})=>{const c=[{id:"meta",label:"Meta Tags",icon:""},{id:"keywords",label:"Keywords",icon:""},{id:"social",label:"Social",icon:""},{id:"intent",label:"Intent",icon:""}];return p.jsxs("div",{className:"seo-panel",children:[p.jsx("div",{className:"seo-panel-header",children:p.jsx("h3",{children:"SEO Settings"})}),p.jsx("div",{className:"seo-tabs",children:c.map(u=>p.jsxs("button",{type:"button",className:`seo-tab ${a===u.id?"active":""}`,onClick:()=>l(u.id),children:[p.jsx("span",{className:"tab-icon",children:u.icon}),p.jsx("span",{className:"tab-label",children:u.label})]},u.id))}),p.jsxs("div",{className:"seo-tab-content",children:[a==="meta"&&p.jsx(qte,{seoData:t,onChange:e}),a==="keywords"&&p.jsx(Kte,{keywords:r,onChange:s,content:n}),a==="social"&&p.jsx(Gte,{seoData:t,onChange:e}),a==="intent"&&p.jsx(Qte,{searchIntent:i,onChange:o})]})]})},qte=({seoData:t,onChange:e})=>{var o,a;const n=((o=t.seoTitle)==null?void 0:o.length)||0,r=((a=t.metaDescription)==null?void 0:a.length)||0,s=V.useMemo(()=>n===0?"empty":n<Li.seoTitle.idealLength.min?"short":n>Li.seoTitle.maxLength?"long":"good",[n]),i=V.useMemo(()=>r===0?"empty":r<Li.metaDescription.idealLength.min?"short":r>Li.metaDescription.maxLength?"long":"good",[r]);return p.jsxs("div",{className:"seo-meta-tab",children:[p.jsxs("div",{className:"seo-field",children:[p.jsxs("label",{children:["SEO Title",p.jsxs("span",{className:`char-counter ${s}`,children:[n," / ",Li.seoTitle.maxLength]})]}),p.jsx("input",{type:"text",value:t.seoTitle||"",onChange:l=>e({...t,seoTitle:l.target.value}),placeholder:"Tiu  hin th trn Google",className:"seo-input",maxLength:Li.seoTitle.maxLength}),p.jsxs("div",{className:"seo-hint",children:[s==="short"&&" Qu ngn - Nn c 50-60 k t",s==="long"&&" Qu di - S b ct trn Google",s==="good"&&"  di tt",s==="empty"&&" Bt buc nhp SEO Title"]})]}),p.jsxs("div",{className:"seo-field",children:[p.jsxs("label",{children:["Meta Description",p.jsxs("span",{className:`char-counter ${i}`,children:[r," / ",Li.metaDescription.maxLength]})]}),p.jsx("textarea",{value:t.metaDescription||"",onChange:l=>e({...t,metaDescription:l.target.value}),placeholder:"M t ngn hin th trn kt qu tm kim",className:"seo-input",rows:3,maxLength:Li.metaDescription.maxLength}),p.jsxs("div",{className:"seo-hint",children:[i==="short"&&" Qu ngn - Nn c 150-155 k t",i==="long"&&" Qu di - S b ct trn Google",i==="good"&&"  di tt",i==="empty"&&" Bt buc nhp Meta Description"]})]}),p.jsxs("div",{className:"google-preview",children:[p.jsx("h4",{children:"Google Preview"}),p.jsxs("div",{className:"google-result",children:[p.jsx("div",{className:"google-title",children:t.seoTitle||"Tiu  bi vit ca bn"}),p.jsxs("div",{className:"google-url",children:["deskhub.vn  blog  ",t.slug||"url-bai-viet"]}),p.jsx("div",{className:"google-desc",children:t.metaDescription||"M t bi vit ca bn s hin th  y..."})]})]})]})},Kte=({keywords:t,onChange:e,content:n})=>{var a,l;const r=()=>{const c=prompt("Nhp secondary keyword:");c&&!t.secondaryKeywords.includes(c.trim())&&e({...t,secondaryKeywords:[...t.secondaryKeywords,c.trim()]})},s=c=>{e({...t,secondaryKeywords:t.secondaryKeywords.filter((u,h)=>h!==c)})},i=()=>{const c=prompt("Nhp LSI/semantic keyword:");c&&!t.lsiKeywords.includes(c.trim())&&e({...t,lsiKeywords:[...t.lsiKeywords,c.trim()]})},o=c=>{e({...t,lsiKeywords:t.lsiKeywords.filter((u,h)=>h!==c)})};return p.jsxs("div",{className:"seo-keywords-tab",children:[p.jsxs("div",{className:"seo-field",children:[p.jsxs("label",{children:["Primary Keyword ",p.jsx("span",{className:"required",children:"*"})]}),p.jsx("input",{type:"text",value:t.primaryKeyword||"",onChange:c=>e({...t,primaryKeyword:c.target.value}),placeholder:"T kha chnh bn mun rank",className:"seo-input primary-keyword-input"}),!t.primaryKeyword&&p.jsx("div",{className:"seo-hint error",children:" Bt buc c primary keyword"})]}),p.jsxs("div",{className:"seo-field",children:[p.jsx("label",{children:"Secondary Keywords"}),p.jsxs("div",{className:"keyword-tags",children:[(a=t.secondaryKeywords)==null?void 0:a.map((c,u)=>p.jsxs("span",{className:"keyword-tag",children:[c,p.jsx("button",{type:"button",onClick:()=>s(u),children:""})]},u)),p.jsx("button",{type:"button",className:"add-keyword-btn",onClick:r,children:"+ Thm"})]})]}),p.jsxs("div",{className:"seo-field",children:[p.jsx("label",{children:"LSI / Semantic Keywords"}),p.jsxs("div",{className:"keyword-tags",children:[(l=t.lsiKeywords)==null?void 0:l.map((c,u)=>p.jsxs("span",{className:"keyword-tag lsi",children:[c,p.jsx("button",{type:"button",onClick:()=>o(u),children:""})]},u)),p.jsx("button",{type:"button",className:"add-keyword-btn",onClick:i,children:"+ Thm"})]})]})]})},Gte=({seoData:t,onChange:e})=>p.jsxs("div",{className:"seo-social-tab",children:[p.jsxs("div",{className:"seo-field",children:[p.jsx("label",{children:"OG Title"}),p.jsx("input",{type:"text",value:t.ogTitle||"",onChange:n=>e({...t,ogTitle:n.target.value}),placeholder:"Tiu  khi chia s ( trng = dng SEO Title)",className:"seo-input"})]}),p.jsxs("div",{className:"seo-field",children:[p.jsx("label",{children:"OG Description"}),p.jsx("textarea",{value:t.ogDescription||"",onChange:n=>e({...t,ogDescription:n.target.value}),placeholder:"M t khi chia s ( trng = dng Meta Description)",className:"seo-input",rows:2})]}),p.jsxs("div",{className:"seo-field",children:[p.jsx("label",{children:"OG Image URL"}),p.jsx("input",{type:"url",value:t.ogImage||"",onChange:n=>e({...t,ogImage:n.target.value}),placeholder:"https://example.com/image.jpg",className:"seo-input"})]}),p.jsxs("div",{className:"social-preview",children:[p.jsx("h4",{children:"Facebook Preview"}),p.jsxs("div",{className:"fb-card",children:[p.jsx("div",{className:"fb-image",children:t.ogImage?p.jsx("img",{src:t.ogImage,alt:"OG Preview"}):p.jsx("div",{className:"fb-image-placeholder",children:"Cha c nh"})}),p.jsxs("div",{className:"fb-content",children:[p.jsx("div",{className:"fb-domain",children:"deskhub.vn"}),p.jsx("div",{className:"fb-title",children:t.ogTitle||t.seoTitle||"Tiu  bi vit"}),p.jsx("div",{className:"fb-desc",children:t.ogDescription||t.metaDescription||"M t bi vit..."})]})]})]})]}),Qte=({searchIntent:t,onChange:e})=>{const n=[{value:"informational",label:"Thng tin (Informational)",icon:"",desc:"Ngi dng mun tm hiu, hc hi",cta:"c thm, Tm hiu thm"},{value:"navigational",label:"iu hng (Navigational)",icon:"",desc:"Ngi dng mun tm trang/ngun c th",cta:"Truy cp, n trang"},{value:"transactional",label:"Giao dch (Transactional)",icon:"",desc:"Ngi dng mun mua/ng k",cta:"Mua ngay, ng k"},{value:"commercial",label:"Thng mi (Commercial)",icon:"",desc:"Ngi dng so snh trc khi mua",cta:"So snh, Xem nh gi"}];return p.jsxs("div",{className:"seo-intent-tab",children:[p.jsx("p",{className:"intent-intro",children:"Chn search intent ph hp  ti u cu trc ni dung"}),p.jsx("div",{className:"intent-options",children:n.map(r=>p.jsxs("div",{className:`intent-option ${t===r.value?"selected":""}`,onClick:()=>e(r.value),children:[p.jsx("div",{className:"intent-icon",children:r.icon}),p.jsxs("div",{className:"intent-info",children:[p.jsx("div",{className:"intent-label",children:r.label}),p.jsx("div",{className:"intent-desc",children:r.desc}),p.jsxs("div",{className:"intent-cta",children:["CTA gi : ",r.cta]})]})]},r.value))})]})},Jte=({primaryKeyword:t,title:e,content:n,contentJson:r})=>{const s=V.useMemo(()=>{if(!t)return{hasKeyword:!1,checks:[]};const l=t.toLowerCase().trim(),c=S4(n||""),u=c.toLowerCase(),h=k4(r,2),d=(e==null?void 0:e.toLowerCase())||"",f=c.split(/\s+/).filter(Boolean).length,g=(u.match(new RegExp(l,"gi"))||[]).length,y=f>0?g/f:0,v=[{id:"first150",label:"Keyword trong 150 k t u",passed:u.substring(0,150).includes(l),priority:"high"},{id:"last150",label:"Keyword trong 150 k t cui",passed:u.slice(-150).includes(l),priority:"medium"},{id:"h1",label:"Keyword trong H1 (tiu )",passed:d.includes(l),priority:"high"},{id:"h2",label:"Keyword trong t nht 1 H2",passed:h.some(w=>w.toLowerCase().includes(l)),priority:"high"},{id:"density",label:`Mt  keyword: ${(y*100).toFixed(1)}%`,passed:y<=.03&&y>=.005,warning:y>.03,priority:"medium",hint:y>.03?"Qu dy! Nn < 3%":y<.005?"Qu tha! Nn 0.5-3%":""}];return{hasKeyword:!0,keyword:l,keywordCount:g,wordCount:f,density:y,checks:v}},[t,e,n,r]);if(!s.hasKeyword)return p.jsxs("div",{className:"keyword-analyzer empty",children:[p.jsx("h4",{children:" Keyword Analysis"}),p.jsx("p",{className:"no-keyword",children:"Cha c primary keyword"})]});const i=s.checks.filter(l=>l.passed).length,o=s.checks.length,a=Math.round(i/o*100);return p.jsxs("div",{className:"keyword-analyzer",children:[p.jsxs("div",{className:"analyzer-header",children:[p.jsx("h4",{children:" Keyword Analysis"}),p.jsxs("div",{className:`keyword-score ${a>=70?"good":a>=40?"medium":"poor"}`,children:[a,"%"]})]}),p.jsxs("div",{className:"keyword-target",children:[p.jsx("span",{className:"label",children:"Target:"}),p.jsx("span",{className:"keyword",children:s.keyword}),p.jsxs("span",{className:"count",children:["(",s.keywordCount,"x trong ",s.wordCount," t)"]})]}),p.jsx("div",{className:"keyword-checks",children:s.checks.map(l=>p.jsxs("div",{className:`check-item ${l.passed?"passed":"failed"} ${l.warning?"warning":""}`,children:[p.jsx("span",{className:"check-icon",children:l.passed?"":l.warning?"":""}),p.jsx("span",{className:"check-label",children:l.label}),l.hint&&p.jsx("span",{className:"check-hint",children:l.hint})]},l.id))})]})},Xte=({title:t,content:e,contentJson:n})=>{const r=V.useMemo(()=>{const a=S4(e||""),l=m_(n,2),c=m_(n,3),u=Zte(n),d=tne(n).filter(y=>y.wordCount>100),f=a.split(/\s+/).filter(Boolean).length;return{checks:[{id:"singleH1",label:"Ch c 1 H1 (tiu  bi)",passed:!u,hint:u?"Khng nn dng H1 trong ni dung":"",priority:"high"},{id:"hasH2",label:`C t nht 1 H2 (hin c ${l})`,passed:l>=1,priority:"high"},{id:"multipleH2",label:`C t nht 3 sections H2 (hin c ${l})`,passed:l>=3,priority:"medium"},{id:"headingHierarchy",label:"Khng b cp heading (H1H2H3)",passed:ene(n),priority:"high"},{id:"paragraphLength",label:`Paragraphs ngn (${d.length} qu di)`,passed:d.length===0,hint:d.length>0?"Nn chia nh on > 100 t":"",priority:"medium"},{id:"minWords",label:` di ni dung (${f} t)`,passed:f>=300,hint:f<300?"Nn c t nht 300 t":"",priority:"medium"}],wordCount:f,h2Count:l,h3Count:c}},[t,e,n]),s=r.checks.filter(a=>a.passed).length,i=r.checks.length,o=Math.round(s/i*100);return p.jsxs("div",{className:"readability-checker",children:[p.jsxs("div",{className:"checker-header",children:[p.jsx("h4",{children:" Readability"}),p.jsxs("div",{className:`readability-score ${o>=70?"good":o>=40?"medium":"poor"}`,children:[o,"%"]})]}),p.jsxs("div",{className:"readability-stats",children:[p.jsxs("span",{children:[r.wordCount," t"]}),p.jsx("span",{children:""}),p.jsxs("span",{children:[r.h2Count," H2"]}),p.jsx("span",{children:""}),p.jsxs("span",{children:[r.h3Count," H3"]})]}),p.jsx("div",{className:"readability-checks",children:r.checks.map(a=>p.jsxs("div",{className:`check-item ${a.passed?"passed":"failed"}`,children:[p.jsx("span",{className:"check-icon",children:a.passed?"":""}),p.jsx("span",{className:"check-label",children:a.label}),a.hint&&p.jsx("span",{className:"check-hint",children:a.hint})]},a.id))})]})},Yte=({seoData:t,keywords:e,title:n,slug:r,content:s,contentJson:i,images:o,author:a,onFix:l})=>{const c=V.useMemo(()=>{const f=m_(i,2),g=(o==null?void 0:o.filter(v=>!v.alt||v.alt.trim()===""))||[],y=o&&o.length>0;return[{id:"seoTitle",label:"SEO Title",passed:(t==null?void 0:t.seoTitle)&&t.seoTitle.length>=30,blocking:!0},{id:"metaDesc",label:"Meta Description",passed:(t==null?void 0:t.metaDescription)&&t.metaDescription.length>=120,blocking:!0},{id:"primaryKeyword",label:"Primary Keyword",passed:(e==null?void 0:e.primaryKeyword)&&e.primaryKeyword.trim()!=="",blocking:!0},{id:"hasH2",label:"C t nht 1 H2",passed:f>=1,blocking:!0},{id:"slug",label:"URL Slug",passed:r&&r.trim()!=="",blocking:!0},{id:"title",label:"Tiu  bi vit",passed:n&&n.trim()!=="",blocking:!0},{id:"imageAlt",label:"nh c Alt text",passed:y&&g.length===0,blocking:!0,hint:y?g.length>0?`${g.length} nh thiu alt`:"":"Cn t nht 1 nh trong bi vit"},{id:"author",label:"Tc gi",passed:a&&a.name,blocking:!1}]},[t,e,n,r,s,i,o,a]),u=c.filter(f=>f.blocking).every(f=>f.passed),h=c.filter(f=>f.passed).length,d={seoTitle:"meta",metaDesc:"meta",primaryKeyword:"keywords"};return p.jsxs("div",{className:"publish-checklist",children:[p.jsxs("div",{className:"checklist-header",children:[p.jsx("h4",{children:" Pre-Publish Checklist"}),p.jsx("span",{className:`checklist-status ${u?"ready":"not-ready"}`,children:u?" Ready":` ${c.filter(f=>f.blocking&&!f.passed).length} li`})]}),p.jsx("div",{className:"checklist-items",children:c.map(f=>p.jsxs("div",{className:`checklist-item ${f.passed?"passed":"failed"}`,style:{flexWrap:"wrap"},children:[p.jsxs("div",{style:{display:"flex",alignItems:"center",flex:1},children:[p.jsx("span",{className:"checklist-icon",children:f.passed?"":f.blocking?"":""}),p.jsxs("span",{className:"checklist-label",children:[f.label,f.blocking&&!f.passed&&p.jsx("span",{className:"blocking-badge",children:"Bt buc"})]})]}),!f.passed&&d[f.id]&&l&&p.jsx("button",{className:"checklist-fix-btn",onClick:()=>l(d[f.id]),title:"i ti ci t",children:" Nhp"}),f.hint&&p.jsx("div",{className:"checklist-hint",style:{width:"100%",paddingLeft:"24px"},children:f.hint})]},f.id))}),p.jsxs("div",{className:"checklist-summary",children:[h,"/",c.length," hon thnh"]})]})};function S4(t){const e=document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText||""}function k4(t,e){const n=[];if(!t||!t.content)return n;function r(s){var i,o;if(s.type==="heading"&&((i=s.attrs)==null?void 0:i.level)===e){const a=((o=s.content)==null?void 0:o.map(l=>l.text||"").join(""))||"";n.push(a)}s.content&&s.content.forEach(r)}return r(t),n}function m_(t,e){return k4(t,e).length}function Zte(t){if(!t||!t.content)return!1;function e(n){var r;return n.type==="heading"&&((r=n.attrs)==null?void 0:r.level)===1?!0:n.content?n.content.some(e):!1}return e(t)}function ene(t){if(!t||!t.content)return!0;let e=1,n=!0;function r(s){var i;if(s.type==="heading"&&((i=s.attrs)!=null&&i.level)){const o=s.attrs.level;o>e+1&&(n=!1),e=o}s.content&&n&&s.content.forEach(r)}return r(t),n}function tne(t){const e=[];if(!t||!t.content)return e;function n(r){var s;if(r.type==="paragraph"){const i=((s=r.content)==null?void 0:s.map(a=>a.text||"").join(""))||"",o=i.split(/\s+/).filter(Boolean).length;e.push({text:i,wordCount:o})}r.content&&r.content.forEach(n)}return n(t),e}const MA=()=>{var I;const{id:t}=sy(),e=Xc(),{addBlog:n,updateBlog:r,blogs:s,currentUser:i}=bn(),o=!!t,[a,l]=V.useState({...ju,author:i?{id:i.id,name:i.displayName||"Anonymous",bio:"",expertise:"",avatar:i.photoURL||""}:null}),[c,u]=V.useState(!1),[h,d]=V.useState(!1),[f,g]=V.useState("meta"),[y,v]=V.useState(null),[w,T]=V.useState([]);V.useEffect(()=>{if(o&&s.length>0){const j=s.find(B=>B.id===t);j?(l({...ju,...j,seo:{...ju.seo,...j.seo},keywords:{...ju.keywords,...j.keywords},schema:{...ju.schema,...j.schema}}),j.content&&typeof j.content=="object"&&v(j.content)):(alert("Khng tm thy bi vit!"),e("/blog"))}},[o,t,s,e]),V.useEffect(()=>{i&&!a.author&&l(j=>({...j,author:{id:i.id,name:i.displayName||"Anonymous",bio:"",expertise:"",avatar:i.photoURL||""}}))},[i,a.author]);const E=V.useCallback(j=>{l(B=>{const L=B.slug===pc(B.title)||!B.slug?pc(j):B.slug;return{...B,title:j,slug:L}})},[]),R=V.useCallback(({json:j,html:B})=>{v(j),l(O=>({...O,content:j,contentHtml:B}));const L=nne(j);T(L)},[]),P=V.useCallback(j=>{T(B=>[...B,j])},[]),N=V.useCallback(j=>{l(B=>({...B,seo:j}))},[]),k=V.useCallback(j=>{l(B=>({...B,keywords:j}))},[]),_=V.useCallback(j=>{l(B=>({...B,searchIntent:j}))},[]),x=V.useMemo(()=>{const{seo:j,keywords:B,title:L,slug:O}=a,$=rne(y,2),U=w.filter(F=>!F.alt);return j.seoTitle&&j.seoTitle.length>=30&&j.metaDescription&&j.metaDescription.length>=120&&B.primaryKeyword&&B.primaryKeyword.trim()!==""&&$>=1&&O&&O.trim()!==""&&L&&L.trim()!==""&&U.length===0},[a,y,w]),S=async j=>{const B=j.target.files[0];if(B){if(!B.type.startsWith("image/")){alert("Vui lng chn file nh!");return}if(B.size>5*1024*1024){alert("File nh qu ln (ti a 5MB)");return}d(!0);try{const L=await Qt.uploadFile(B);l(O=>({...O,coverImage:L,seo:{...O.seo,ogImage:L}}))}catch(L){console.error("Upload failed:",L),alert(`Ti nh tht bi: ${L.message}`)}finally{d(!1),j.target.value=null}}},A=async(j="draft")=>{if(j==="published"&&!x){alert("Vui lng hon thnh tt c yu cu SEO trc khi ng!");return}u(!0);const B={...a,status:j,canonicalUrl:`https://deskhub.vn/blog/${a.slug}`,excerpt:a.excerpt||a.seo.metaDescription,coverImage:a.coverImage||a.seo.ogImage,readTime:sne(a.contentHtml)};try{if(o){const L=await r(t,B);L.success?(alert(j==="published"?" ng bi thnh cng!":" lu nhp!"),e(`/blog/${t}`)):alert(`Li: ${L.message}`)}else{const L=await n(B);L.success?(alert(j==="published"?" ng bi thnh cng!":" lu nhp!"),e("/blog")):alert(`Li: ${L.message}`)}}catch(L){console.error("Save error:",L),alert("C li xy ra khi lu bi vit!")}finally{u(!1)}},M=Iq[a.searchIntent];return p.jsxs("div",{className:"seo-blog-editor",children:[p.jsxs("div",{className:"editor-header",children:[p.jsxs("div",{className:"header-left",children:[p.jsx("button",{type:"button",className:"back-btn",onClick:()=>e("/blog"),children:" Quay li"}),p.jsx("h1",{children:o?"Chnh Sa Bi Vit":"To Bi Vit Mi"})]}),p.jsxs("div",{className:"header-actions",children:[p.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>A("draft"),disabled:c,children:c?"ang lu...":"Lu Nhp"}),p.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>A("published"),disabled:c||!x,title:x?"":"Hon thnh cc yu cu SEO  ng bi",children:c?"ang ng...":"ng Bi"})]})]}),p.jsxs("div",{className:"editor-layout",children:[p.jsxs("div",{className:"editor-main",children:[p.jsxs("div",{className:"title-section",children:[p.jsx("input",{type:"text",value:a.title,onChange:j=>E(j.target.value),placeholder:"Tiu  bi vit (H1)",className:"title-input",maxLength:100}),p.jsxs("div",{className:"title-meta",children:[p.jsxs("span",{children:[a.title.length,"/100 k t"]}),p.jsx("span",{children:""}),p.jsxs("span",{children:["Slug: /",a.slug||"auto-generated"]})]})]}),p.jsxs("div",{className:"slug-section",children:[p.jsx("label",{children:"URL Slug:"}),p.jsxs("div",{className:"slug-input-wrapper",children:[p.jsx("span",{className:"slug-prefix",children:"deskhub.vn/blog/"}),p.jsx("input",{type:"text",value:a.slug,onChange:j=>l(B=>({...B,slug:pc(j.target.value)})),placeholder:"url-bai-viet",className:"slug-input"})]})]}),M&&p.jsxs("div",{className:"intent-suggestion",children:[p.jsx("span",{className:"intent-badge",children:M.label}),p.jsxs("span",{className:"intent-hint",children:["Cu trc  xut: ",M.suggestedStructure.join("  ")]})]}),p.jsx("div",{className:"content-section",children:p.jsx(Hte,{content:y,onUpdate:R,onImageAdd:P,placeholder:"Bt u vit ni dung bi vit..."})}),p.jsxs("div",{className:"cover-section",children:[p.jsx("label",{children:"nh Ba / OG Image:"}),a.coverImage?p.jsxs("div",{className:"cover-preview-container",children:[p.jsx("img",{src:a.coverImage,className:"cover-preview-img",alt:"Cover"}),p.jsx("button",{className:"remove-cover-btn",onClick:()=>l(j=>({...j,coverImage:"",seo:{...j.seo,ogImage:""}})),children:" G nh"})]}):p.jsxs("div",{className:"cover-upload-box",onClick:()=>document.getElementById("cover-upload").click(),children:[p.jsx("input",{id:"cover-upload",type:"file",accept:"image/*",onChange:S,style:{display:"none"},disabled:h}),p.jsx("div",{className:"upload-label",children:h?p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"upload-icon",children:""}),p.jsx("span",{children:"ang ti nh ln..."})]}):p.jsxs(p.Fragment,{children:[p.jsx("span",{className:"upload-icon",children:""}),p.jsx("span",{children:"Nhn  ti nh ln"}),p.jsx("small",{children:"(Max 5MB)"})]})})]}),p.jsxs("details",{className:"url-fallback",children:[p.jsx("summary",{children:"Hoc nhp URL nh th cng"}),p.jsx("input",{type:"url",value:a.coverImage,onChange:j=>l(B=>({...B,coverImage:j.target.value,seo:{...B.seo,ogImage:j.target.value}})),placeholder:"https://example.com/cover.jpg",className:"cover-input",style:{marginTop:"8px"}})]})]}),p.jsxs("div",{className:"excerpt-section",children:[p.jsx("label",{children:"M t ngn (Excerpt):"}),p.jsx("textarea",{value:a.excerpt,onChange:j=>l(B=>({...B,excerpt:j.target.value})),placeholder:"M t ngn v bi vit...",className:"excerpt-input",rows:3,maxLength:300})]}),p.jsxs("div",{className:"meta-section",children:[p.jsxs("div",{className:"meta-field",children:[p.jsx("label",{children:"Danh mc:"}),p.jsxs("select",{value:a.category,onChange:j=>l(B=>({...B,category:j.target.value})),className:"meta-select",children:[p.jsx("option",{value:"Hng Dn",children:"Hng Dn"}),p.jsx("option",{value:"Thit K",children:"Thit K"}),p.jsx("option",{value:"nh Gi",children:"nh Gi"}),p.jsx("option",{value:"Xu Hng",children:"Xu Hng"}),p.jsx("option",{value:"Mo",children:"Mo"})]})]}),p.jsxs("div",{className:"meta-field",children:[p.jsx("label",{children:"Tags (phn cch bng du phy):"}),p.jsx("input",{type:"text",value:((I=a.tags)==null?void 0:I.join(", "))||"",onChange:j=>l(B=>({...B,tags:j.target.value.split(",").map(L=>L.trim()).filter(Boolean)})),placeholder:"desk setup, productivity, gaming",className:"meta-input"})]})]}),p.jsx("div",{className:"index-section",children:p.jsxs("label",{className:"toggle-label",children:[p.jsx("input",{type:"checkbox",checked:a.noIndex,onChange:j=>l(B=>({...B,noIndex:j.target.checked}))}),p.jsx("span",{children:"No Index (khng cho Google index bi ny)"})]})})]}),p.jsxs("div",{className:"editor-sidebar",children:[p.jsx(Wte,{seoData:a.seo,onChange:N,content:a.contentHtml,keywords:a.keywords,onKeywordsChange:k,searchIntent:a.searchIntent,onIntentChange:_,activeTab:f,setActiveTab:g}),p.jsx(Jte,{primaryKeyword:a.keywords.primaryKeyword,title:a.title,content:a.contentHtml,contentJson:y}),p.jsx(Xte,{title:a.title,content:a.contentHtml,contentJson:y}),p.jsx(Yte,{seoData:a.seo,keywords:a.keywords,title:a.title,slug:a.slug,content:a.contentHtml,contentJson:y,images:w,author:a.author,onFix:j=>{g(j);const B=document.querySelector(".editor-sidebar");B&&(B.scrollTop=0)}})]})]})]})};function nne(t){const e=[];if(!t||!t.content)return e;function n(r){var s,i;r.type==="image"&&e.push({url:(s=r.attrs)==null?void 0:s.src,alt:((i=r.attrs)==null?void 0:i.alt)||""}),r.content&&r.content.forEach(n)}return n(t),e}function rne(t,e){let n=0;if(!t||!t.content)return n;function r(s){var i;s.type==="heading"&&((i=s.attrs)==null?void 0:i.level)===e&&n++,s.content&&s.content.forEach(r)}return r(t),n}function sne(t){if(!t)return 5;const e=document.createElement("div");e.innerHTML=t;const r=(e.textContent||"").split(/\s+/).filter(Boolean).length;return Math.max(1,Math.ceil(r/200))}const C4=({onClose:t,onSave:e,initialData:n=null})=>{var L,O,$,U;const[r,s]=V.useState({title:(n==null?void 0:n.title)||"",caption:(n==null?void 0:n.caption)||"",authorName:((L=n==null?void 0:n.author)==null?void 0:L.name)||"",authorAvatar:((O=n==null?void 0:n.author)==null?void 0:O.avatar)||"",filters:(n==null?void 0:n.filters)||{colorTone:"neutral",budget:"mid-range",gender:"neutral",purpose:"productivity",size:"medium"},tags:(($=n==null?void 0:n.tags)==null?void 0:$.join(", "))||""}),[i,o]=V.useState(()=>n!=null&&n.media&&n.media.length>0?n.media:n!=null&&n.image?[{id:Date.now().toString(),type:"image",url:n.image,products:n.products||[]}]:[]),[a,l]=V.useState(null),[c,u]=V.useState(!1),[h,d]=V.useState(null),[f,g]=V.useState(((U=n==null?void 0:n.author)==null?void 0:U.avatar)||"");V.useEffect(()=>{i.length>0&&!a&&l(i[0].id)},[i,a]);const y=i.find(F=>F.id===a),[v,w]=V.useState(null),[T,E]=V.useState(!1),R=V.useRef(null),P=(F,X)=>{o(H=>H.map(J=>J.id===F?{...J,...X}:J))},N=F=>{const{name:X,value:H}=F.target;if(X.startsWith("filter.")){const J=X.split(".")[1];s(z=>({...z,filters:{...z.filters,[J]:H}}))}else s(J=>({...J,[X]:H}))},k=F=>{const X=Array.from(F.target.files);if(X.length===0)return;const H=X.map(J=>J.size>10*1024*1024?(alert(`nh ${J.name} qu ln (>10MB).`),null):{id:Date.now()+Math.random().toString(),type:"image",url:URL.createObjectURL(J),file:J,products:[]}).filter(Boolean);o(J=>[...J,...H]),!a&&H.length>0&&l(H[0].id)},_=(F,X)=>{var J;X.stopPropagation();const H=i.filter(z=>z.id!==F);o(H),a===F&&l(((J=H[0])==null?void 0:J.id)||null)},x=F=>{const X=F.target.files[0];if(X){if(X.size>5*1024*1024){alert("Avatar qu ln (>5MB).");return}d(X),g(URL.createObjectURL(X))}},S=F=>{if(!y||y.type!=="image")return;const X=R.current.getBoundingClientRect(),H=(F.clientX-X.left)/X.width*100,J=(F.clientY-X.top)/X.height*100,z={id:Date.now().toString(),x:H,y:J,name:"",price:"",link:""};w(z),E(!0)},A=(F,X)=>{F.stopPropagation(),w(X),E(!0)},M=()=>{if(!v.name)return alert("Vui lng nhp tn sn phm");const F=y.products||[],X=F.find(J=>J.id===v.id);let H;X?H=F.map(J=>J.id===v.id?v:J):H=[...F,v],P(a,{products:H}),w(null),E(!1)},I=()=>{const X=(y.products||[]).filter(H=>H.id!==v.id);P(a,{products:X}),w(null),E(!1)},j=(F,X=2560,H=.95)=>new Promise(J=>{const z=new FileReader;z.readAsDataURL(F),z.onload=W=>{const de=new Image;de.src=W.target.result,de.onload=()=>{const Te=document.createElement("canvas"),Ie=Te.getContext("2d"),me=X,Ae=X;let Re=de.width,Oe=de.height;Re>Oe?Re>me&&(Oe*=me/Re,Re=me):Oe>Ae&&(Re*=Ae/Oe,Oe=Ae),Te.width=Re,Te.height=Oe,Ie.drawImage(de,0,0,Re,Oe),J(Te.toDataURL("image/jpeg",H))}}}),B=async F=>{var X,H,J;F.preventDefault(),console.log(" Form submission started"),u(!0);try{if(i.length===0){alert("Vui lng thm t nht mt nh hoc video!"),u(!1);return}console.log(" Processing media uploads...");let z=f;if(h)try{console.log(" Uploading avatar...");const me=await j(h,500),Ae=await(await fetch(me)).blob(),Re=new File([Ae],"avatar.jpg",{type:"image/jpeg"});z=await Qt.uploadFile(Re),console.log(" Avatar uploaded:",z)}catch(me){console.error(" Avatar upload failed:",me);try{z=await j(h,300)}catch(Ae){console.error("Avatar compression failed:",Ae),z="https://ui-avatars.com/api/?name="+encodeURIComponent(r.authorName||"User")}}const W=await Promise.all(i.map(async me=>{if(me.file)try{console.log(` Compressing image: ${me.file.name}`);const Ae=await j(me.file,2560,.92),Re=await(await fetch(Ae)).blob(),Oe=new File([Re],me.file.name.replace(/\.[^/.]+$/,"")+".jpg",{type:"image/jpeg"});console.log(` Starting upload (Compressed): ${(Oe.size/1024).toFixed(0)} KB`);let jt=null,xt=null;for(let Be=1;Be<=3;Be++)try{console.log(` Upload attempt ${Be}/3...`);const Ke=Qt.uploadFile(Oe),Fe=new Promise((Z,fe)=>setTimeout(()=>fe(new Error("TIMEOUT")),6e4));jt=await Promise.race([Ke,Fe]),console.log(` Image uploaded on attempt ${Be}: ${jt}`);break}catch(Ke){xt=Ke,console.warn(` Attempt ${Be} failed:`,Ke.message),Be<3&&(console.log(" Waiting 2s before retry..."),await new Promise(Fe=>setTimeout(Fe,2e3)))}if(!jt)throw new Error(`Upload tht bi sau 3 ln th: ${(xt==null?void 0:xt.message)||"Network error"}`);return{...me,url:jt,file:null}}catch(Ae){throw console.error(" Image upload failed:",Ae),new Error(`Khng th ti nh "${me.file.name}": ${Ae.message}`)}return me}));console.log(" Media processing complete:",W);const de=r.tags.split(",").map(me=>me.trim()).filter(me=>me),Te=W.filter(me=>me.type==="image").map(me=>({url:me.url,products:me.products||[]})),Ie={title:r.caption.substring(0,50)||"Setup",caption:r.caption,filters:r.filters,tags:de,author:{name:r.authorName||"Anonymous",avatar:z||"https://ui-avatars.com/api/?name="+encodeURIComponent(r.authorName||"User")},images:Te,media:W,mainImage:((X=W[0])==null?void 0:X.url)||"",image:((H=W[0])==null?void 0:H.url)||"",products:((J=Te[0])==null?void 0:J.products)||[],updatedAt:new Date().toISOString()};console.log(" Final setupData to save:",Ie),console.log(" Calling onSave..."),n!=null&&n.id?await e(n.id,Ie):await e(Ie),console.log(" onSave completed successfully")}catch(z){console.error(" Form submission error:",z),alert(z.message||"C li xy ra khi lu setup.")}finally{u(!1)}};return p.jsx("div",{className:"modal-overlay",onClick:t,children:p.jsxs("div",{className:"modal-content add-setup-modal",onClick:F=>F.stopPropagation(),children:[p.jsxs("div",{className:"modal-header",children:[p.jsx("h2",{children:n?"Chnh Sa Setup":"Thm Gc Setup Mi"}),p.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[c&&p.jsx("span",{style:{color:"var(--accent-color)"},children:" ang ti ln... Vui lng ch"}),p.jsx("button",{className:"close-btn",onClick:t,children:""})]})]}),p.jsx("div",{className:"add-setup-body",children:p.jsxs("form",{id:"setupForm",onSubmit:B,className:"setup-form-layout",children:[p.jsxs("div",{className:"form-column",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"M t"}),p.jsx("textarea",{name:"caption",value:r.caption,onChange:N,required:!0,placeholder:"M t v gc setup ny...",rows:"4"})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Media (nh/Video)"}),p.jsxs("div",{className:"media-gallery-preview",children:[i.map(F=>p.jsxs("div",{className:`media-thumb ${a===F.id?"active":""}`,onClick:()=>l(F.id),children:[F.type==="video"&&F.platform==="youtube"?p.jsxs(p.Fragment,{children:[p.jsx("img",{src:F.thumb||F.thumbnail,alt:"yt-thumb",style:{opacity:.8}}),p.jsx("div",{className:"video-icon",style:{fontSize:"12px"},children:""})]}):F.type==="video"?p.jsx("div",{className:"video-icon",children:""}):p.jsx("img",{src:F.url,alt:"thumb"}),p.jsx("button",{type:"button",className:"btn-remove-media",onClick:X=>_(F.id,X),children:""})]},F.id)),p.jsxs("label",{className:"add-media-btn",children:[p.jsx("input",{type:"file",multiple:!0,accept:"image/*,video/*",onChange:k,style:{display:"none"}}),p.jsx("span",{children:"+ Thm"})]})]}),p.jsx("small",{style:{display:"block",marginTop:"5px",color:"#888"},children:"H tr ti a 8 nh (Max 10MB/nh)."})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tn ngi ng"}),p.jsx("input",{type:"text",name:"authorName",value:r.authorName,onChange:N,placeholder:"Nhp tn ngi ng..."})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Avatar ngi ng"}),p.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[f&&p.jsx("img",{src:f,alt:"Avatar preview",style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover",border:"2px solid var(--color-border)"}}),p.jsxs("label",{className:"btn btn-secondary",style:{cursor:"pointer",margin:0},children:[p.jsx("input",{type:"file",accept:"image/*",onChange:x,style:{display:"none"}}),f?"i Avatar":"Ti Avatar"]})]}),p.jsx("small",{style:{display:"block",marginTop:"5px",color:"#888"},children:"nh i din ca ngi ng (Max 5MB)"})]}),p.jsxs("div",{className:"form-row",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tng mu"}),p.jsx("select",{name:"filter.colorTone",value:r.filters.colorTone,onChange:N,children:Yu.colorTone.map(F=>p.jsx("option",{value:F.value,children:F.label},F.value))})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Ngn sch"}),p.jsx("select",{name:"filter.budget",value:r.filters.budget,onChange:N,children:Yu.budget.map(F=>p.jsx("option",{value:F.value,children:F.label},F.value))})]})]}),p.jsxs("div",{className:"form-row",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Phong cch"}),p.jsx("select",{name:"filter.gender",value:r.filters.gender,onChange:N,children:Yu.gender.map(F=>p.jsx("option",{value:F.value,children:F.label},F.value))})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Mc ch"}),p.jsx("select",{name:"filter.purpose",value:r.filters.purpose,onChange:N,children:Yu.purpose.map(F=>p.jsx("option",{value:F.value,children:F.label},F.value))})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tags (ngn cch bi du phy)"}),p.jsx("input",{type:"text",name:"tags",value:r.tags,onChange:N,placeholder:"gaming, minimal, rgb..."})]})]}),p.jsxs("div",{className:"form-column",children:[p.jsx("label",{style:{marginBottom:"0.5rem",display:"block",fontWeight:"500"},children:y?y.type==="video"||y.type==="youtube"?"Xem Video (Khng h tr gn th)":"Gn Th Sn Phm (Click vo nh)":"Xem trc"}),p.jsx("div",{className:"image-tagging-area",children:y?y.type==="video"?p.jsx("video",{src:y.url,controls:!0,className:"tagging-image",style:{maxHeight:"100%"}}):y.type==="youtube"?p.jsx("iframe",{width:"100%",height:"100%",src:y.url,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{aspectRatio:"16/9",borderRadius:"8px"}}):p.jsxs("div",{className:"image-wrapper",ref:R,onClick:S,children:[p.jsx("img",{src:y.url,alt:"Tagging Area",className:"tagging-image"}),y.products.map(F=>p.jsx("div",{className:`tag-marker ${(v==null?void 0:v.id)===F.id?"active":""}`,style:{left:`${F.x}%`,top:`${F.y}%`},onClick:X=>A(X,F),children:"+"},F.id)),v&&!y.products.find(F=>F.id===v.id)&&p.jsx("div",{className:"tag-marker active",style:{left:`${v.x}%`,top:`${v.y}%`},children:" + "}),T&&v&&p.jsxs("div",{className:"tag-popup",style:{left:`${Math.min(v.x,60)}%`,top:`${Math.min(v.y+5,80)}%`},onClick:F=>F.stopPropagation(),children:[p.jsx("h4",{children:y.products.find(F=>F.id===v.id)?"Sa Sn Phm":"Thm Sn Phm"}),p.jsx("div",{className:"form-group",children:p.jsx("input",{autoFocus:!0,placeholder:"Tn sn phm",value:v.name,onChange:F=>w({...v,name:F.target.value})})}),p.jsx("div",{className:"form-group",children:p.jsx("input",{placeholder:"Gi",value:v.price,onChange:F=>w({...v,price:F.target.value})})}),p.jsx("div",{className:"form-group",children:p.jsx("input",{placeholder:"Link (ty chn)",value:v.link,onChange:F=>w({...v,link:F.target.value})})}),p.jsxs("div",{className:"popup-actions",children:[p.jsx("button",{type:"button",className:"btn-small btn-delete",onClick:()=>{y.products.find(F=>F.id===v.id)?I():(w(null),E(!1))},children:"Xa"}),p.jsx("button",{type:"button",className:"btn-small btn-submit",onClick:M,children:"Lu"})]})]})]}):p.jsx("div",{className:"placeholder-text",children:"Chn hoc ti ln media  bt u custom"})})]})]})}),p.jsxs("div",{className:"form-actions",children:[p.jsx("button",{type:"button",className:"btn-cancel",onClick:t,children:"Hy"}),p.jsx("button",{type:"submit",form:"setupForm",className:"btn-submit",disabled:c,children:c?"ang Upload...":"ng Setup"})]})]})})},ine=()=>{const{setups:t,blogs:e,getComments:n,currentUser:r,addSetup:s,updateSetup:i,deleteSetup:o,refreshData:a}=bn(),[l,c]=V.useState(null),[u,h]=V.useState(new Set),[d,f]=V.useState({startDate:"",endDate:""}),g=_=>{_.target.checked?h(new Set(t.map(x=>x.id))):h(new Set)},y=_=>{const x=new Set(u);x.has(_)?x.delete(_):x.add(_),h(x)},v=async()=>{if(u.size!==0&&confirm(`Bn c chc chn mun xa ${u.size} setup  chn khng?`))try{const _=Array.from(u).map(x=>o(x));await Promise.all(_),h(new Set),alert(" xa cc setup  chn!")}catch(_){console.error("Bulk delete failed:",_),alert("C li xy ra khi xa hng lot.")}},w=async(_,x)=>{if(x){const S=await i(_,x);S.success?(c(null),alert(" cp nht setup thnh cng!")):alert(S.message||"Li cp nht")}else{const S=await s(_);S.success?alert(" thm setup thnh cng!"):alert(S.message||"C li xy ra")}},T=_=>{c(_)},E=async(_,x)=>{if(window.confirm(`Bn c chc mun xa setup "${x}" khng?`)){const S=await o(_);S.success||alert(S.message||"Xa tht bi")}},R=_=>{if(!_)return!1;const x=new Date(_);if(d.startDate){const S=d.startDate.split("-"),A=new Date(S[0],S[1]-1,S[2],0,0,0,0);if(x<A)return!1}if(d.endDate){const S=d.endDate.split("-"),A=new Date(S[0],S[1]-1,S[2],23,59,59,999);if(x>A)return!1}return!0},P=V.useMemo(()=>{const _=t.filter(I=>R(I.createdAt)).length,x=e.filter(I=>R(I.publishedAt)).length;let S=0,A=0,M=0;return t.forEach(I=>{Array.isArray(I.likes)&&(S+=I.likes.filter(B=>typeof B=="object"?R(B.timestamp):!0).length),Array.isArray(I.saves)&&(A+=I.saves.filter(B=>typeof B=="object"?R(B.timestamp):!0).length);const j=n(I.id);M+=j.filter(B=>R(B.timestamp)).length}),{totalSetups:_,totalBlogs:x,totalLikes:S,totalSaves:A,totalComments:M}},[t,e,d,n]),N=V.useMemo(()=>t.map(_=>{const x=n(_.id),S=(_.likes||[]).filter(I=>typeof I=="object"?R(I.timestamp):!0).length,A=(_.saves||[]).filter(I=>typeof I=="object"?R(I.timestamp):!0).length,M=x.filter(I=>R(I.timestamp)).length;return{..._,rangeLikeCount:S,rangeSaveCount:A,rangeCommentCount:M,engagement:S*2+A*3+M*1}}).sort((_,x)=>x.engagement-_.engagement).slice(0,5),[t,d,n]),k=V.useMemo(()=>{const _={};return t.filter(S=>R(S.createdAt)).forEach(S=>{const A=S.filters.purpose||"Other";_[A]||(_[A]=0),_[A]++}),Object.entries(_).sort((S,A)=>A[1]-S[1])},[t,d]);return!r||r.role!=="admin"?p.jsx("div",{className:"admin-dashboard-error",children:"Access Denied"}):p.jsxs("div",{className:"admin-dashboard",children:[p.jsxs("header",{className:"dashboard-header",children:[p.jsxs("div",{children:[p.jsx("h1",{children:"Admin Dashboard"}),p.jsxs("p",{children:["Welcome back, ",r.displayName]})]}),p.jsxs("div",{className:"header-actions",style:{display:"flex",gap:"1rem",alignItems:"center"},children:[p.jsx("button",{className:"btn",onClick:async()=>{confirm("Ti li d liu t server/local?")&&(await a(),alert(" cp nht!"))},style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"0.5rem 1rem",borderRadius:"8px",border:"1px solid var(--border-color)",cursor:"pointer"},children:" Khi phc D liu"}),p.jsxs("div",{className:"dashboard-filter",children:[p.jsx("span",{className:"filter-label",children:"Lc:"}),p.jsx("input",{type:"date",className:"date-input",value:d.startDate,onChange:_=>f(x=>({...x,startDate:_.target.value}))}),p.jsx("span",{className:"filter-separator",children:"-"}),p.jsx("input",{type:"date",className:"date-input",value:d.endDate,onChange:_=>f(x=>({...x,endDate:_.target.value}))}),(d.startDate||d.endDate)&&p.jsx("button",{className:"btn-clear",onClick:()=>f({startDate:"",endDate:""}),children:""})]})]})]}),p.jsxs("div",{className:"stats-grid",children:[p.jsxs("div",{className:"stat-card",children:[p.jsx("h3",{children:"Tng Lt Thch"}),p.jsx("div",{className:"stat-value",children:P.totalLikes}),p.jsxs("div",{className:"stat-trend positive",children:[" ",d.startDate||d.endDate?"Trong khong":"Tt c"]})]}),p.jsxs("div",{className:"stat-card",children:[p.jsx("h3",{children:"Tng Lt Lu"}),p.jsx("div",{className:"stat-value",children:P.totalSaves}),p.jsxs("div",{className:"stat-trend positive",children:[" ",d.startDate||d.endDate?"Trong khong":"Tt c"]})]}),p.jsxs("div",{className:"stat-card",children:[p.jsx("h3",{children:"Tng Bnh Lun"}),p.jsx("div",{className:"stat-value",children:P.totalComments}),p.jsx("div",{className:"stat-trend",children:" Tho lun"})]}),p.jsxs("div",{className:"stat-card",children:[p.jsx("h3",{children:"Tng Setup Mi"}),p.jsx("div",{className:"stat-value",children:P.totalSetups}),p.jsx("div",{className:"stat-trend",children:" Bi ng"})]})]}),p.jsxs("div",{className:"dashboard-layout",children:[p.jsxs("div",{className:"dashboard-section manage-section",children:[p.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[p.jsxs("h2",{children:[" Qun L Tt C Setup (",t.length,")"]}),u.size>0&&p.jsxs("div",{className:"bulk-actions",style:{margin:0},children:[p.jsxs("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:[" chn ",u.size]}),p.jsxs("button",{onClick:v,className:"btn-bulk-delete",children:[" Xa ",u.size," Setup"]})]})]}),p.jsx("div",{className:"ranking-table-wrapper",style:{maxHeight:"400px",overflowY:"auto"},children:p.jsxs("table",{className:"ranking-table",children:[p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{className:"checkbox-col",children:p.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:t.length>0&&u.size===t.length,onChange:g})}),p.jsx("th",{children:"Setup"}),p.jsx("th",{children:"Ngy to"}),p.jsx("th",{children:"Thng k (Like/Save/Cmt)"}),p.jsx("th",{children:"Hnh ng"})]})}),p.jsx("tbody",{children:t.map(_=>{var x,S;return p.jsxs("tr",{style:{background:u.has(_.id)?"var(--bg-secondary)":"transparent"},children:[p.jsx("td",{className:"checkbox-col",children:p.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:u.has(_.id),onChange:()=>y(_.id)})}),p.jsx("td",{children:p.jsxs("div",{className:"setup-cell",children:[p.jsx("img",{src:_.mainImage,alt:"",className:"setup-thumb"}),p.jsx("span",{className:"setup-title",title:_.title,children:_.title})]})}),p.jsx("td",{children:new Date(_.createdAt).toLocaleDateString("vi-VN")}),p.jsxs("td",{children:[((x=_.likes)==null?void 0:x.length)||0," / ",((S=_.saves)==null?void 0:S.length)||0," / ",_.comments||0]}),p.jsxs("td",{children:[p.jsx("button",{className:"btn-edit",onClick:()=>T(_),title:"Sa setup ny",style:{marginRight:"0.5rem",background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem"},children:""}),p.jsx("button",{className:"btn-delete",onClick:()=>E(_.id,_.title),title:"Xa setup ny",children:""})]})]},_.id)})})]})})]}),p.jsxs("div",{className:"dashboard-section ranking-section",children:[p.jsx("h2",{children:" BXH Tng Tc Top 5"}),p.jsx("div",{className:"ranking-table-wrapper",children:p.jsxs("table",{className:"ranking-table",children:[p.jsx("thead",{children:p.jsxs("tr",{children:[p.jsx("th",{children:"Rank"}),p.jsx("th",{children:"Setup"}),p.jsx("th",{children:"im"})]})}),p.jsx("tbody",{children:N.map((_,x)=>p.jsxs("tr",{children:[p.jsx("td",{children:p.jsxs("span",{className:`rank-badge rank-${x+1}`,children:["#",x+1]})}),p.jsx("td",{children:p.jsxs("div",{className:"setup-cell",children:[p.jsx("img",{src:_.mainImage,alt:"",className:"setup-thumb"}),p.jsx("span",{className:"setup-title",children:_.title})]})}),p.jsx("td",{children:p.jsx("strong",{children:_.engagement})})]},_.id))})]})})]}),p.jsxs("div",{className:"dashboard-section insights-section",children:[p.jsx("h2",{children:" Xu Hng"}),p.jsxs("div",{className:"insights-card",children:[p.jsx("h3",{children:"Danh Mc Ph Bin"}),k.length>0?p.jsx("ul",{className:"category-list",children:k.map(([_,x])=>p.jsxs("li",{className:"category-item",children:[p.jsx("span",{className:"category-name",children:_.replace("-"," ")}),p.jsx("div",{className:"progress-bar",children:p.jsx("div",{className:"progress-fill",style:{width:`${x/P.totalSetups*100}%`}})}),p.jsx("span",{className:"category-count",children:x})]},_))}):p.jsx("p",{className:"no-data",children:"Khng c d liu."})]})]})]}),l&&p.jsx(C4,{initialData:l,onClose:()=>c(null),onSave:w})]})},one=()=>{const{showAuthModal:t,setShowAuthModal:e}=bn(),[n,r]=V.useState("login"),[s,i]=V.useState(""),[o,a]=V.useState(""),[l,c]=V.useState(""),[u,h]=V.useState(""),[d,f]=V.useState(""),[g,y]=V.useState(!1),[v,w]=V.useState("");if(!t)return null;const T=()=>{e(!1),f(""),i(""),a(""),c(""),h("")},E=async R=>{R.preventDefault(),f(""),w(""),y(!0);try{if(n==="login")await Qt.login(s,o),w("ng nhp thnh cng!"),setTimeout(()=>{T(),w(""),y(!1)},500);else{if(!l){f("Vui lng nhp tn hin th"),y(!1);return}await Qt.register({email:s,password:o,displayName:l,username:u}),w("ng k thnh cng!"),setTimeout(()=>{T(),w(""),y(!1)},500)}}catch(P){console.error(P),y(!1),P.code==="auth/wrong-password"||P.code==="auth/user-not-found"||P.code==="auth/invalid-credential"?f("Email hoc mt khu khng ng"):P.code==="auth/email-already-in-use"?f("Email  c s dng"):f(" c li xy ra: "+P.message)}};return p.jsx("div",{className:"modal-overlay",onClick:R=>R.target===R.currentTarget&&T(),children:p.jsxs("div",{className:"auth-modal modal-content",children:[p.jsx("button",{className:"modal-close-btn",onClick:T,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsxs("div",{className:"auth-content",children:[p.jsx("h2",{children:n==="login"?"ng Nhp":"ng K"}),p.jsx("p",{className:"auth-subtitle",children:n==="login"?"ng nhp  lu setup yu thch v vit bnh lun":"To ti khon mi  tham gia cng ng DeskHub"}),d&&p.jsx("div",{className:"auth-error",children:d}),v&&p.jsx("div",{className:"auth-error",style:{color:"#059669",borderColor:"#059669",backgroundColor:"#ecfdf5"},children:v}),p.jsxs("form",{onSubmit:E,className:"auth-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Email"}),p.jsx("input",{type:"email",className:"input",value:s,onChange:R=>i(R.target.value),placeholder:"name@example.com",required:!0})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Mt khu"}),p.jsx("input",{type:"password",className:"input",value:o,onChange:R=>a(R.target.value),placeholder:"",required:!0,minLength:6})]}),n==="register"&&p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tn hin th"}),p.jsx("input",{type:"text",className:"input",value:l,onChange:R=>c(R.target.value),placeholder:"Tn ca bn",required:!0})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Username"}),p.jsx("input",{type:"text",className:"input",value:u,onChange:R=>h(R.target.value),placeholder:"username",required:!0,pattern:"[a-zA-Z0-9_-]+",title:"Ch cha ch ci, s, gch ngang v gch di"})]})]}),p.jsx("button",{type:"submit",className:"btn btn-primary auth-submit",disabled:g,style:{opacity:g?.7:1,cursor:g?"wait":"pointer"},children:g?"ang x l...":n==="login"?"ng Nhp":"ng K"})]}),p.jsx("div",{className:"auth-switch",children:n==="login"?p.jsxs("p",{children:["Cha c ti khon?"," ",p.jsx("button",{onClick:()=>r("register"),className:"link-btn",children:"ng k ngay"})]}):p.jsxs("p",{children:[" c ti khon?"," ",p.jsx("button",{onClick:()=>r("login"),className:"link-btn",children:"ng nhp"})]})}),p.jsx("div",{className:"auth-divider",children:p.jsx("span",{children:"hoc"})}),p.jsx("button",{className:"btn btn-secondary",onClick:T,children:"Tip tc vi ti khon Khch"}),p.jsx("p",{className:"auth-note",children:p.jsx("small",{children:"Ti khon Khch s dng IP my  lu d liu. D liu s c gi trn thit b ny."})})]})]})})},ane=()=>{const{showProfileModal:t,setShowProfileModal:e,refreshUser:n,currentUser:r,logout:s}=bn(),[i,o]=V.useState((r==null?void 0:r.displayName)||""),[a,l]=V.useState((r==null?void 0:r.avatar)||""),[c,u]=V.useState("");if(!t)return null;const h=()=>{e(!1),u("")},d=async y=>{if(y.preventDefault(),u(""),r!=null&&r.isGuest)C6(i),n(),u(" cp nht tn hin th!"),setTimeout(()=>h(),1500);else try{const v=a&&a.startsWith("data:");if(dc.currentUser){const T={displayName:i};v||(T.photoURL=a),await IO(dc.currentUser,T)}const w=Qn(Jt,"users",r.id);await Vi(w,{displayName:i,avatar:a}),u("Cp nht thnh cng! ang ti li..."),setTimeout(()=>window.location.reload(),500)}catch(v){console.error(v),u("Li: "+v.message)}},f=y=>{const v=y.target.files[0];if(v){if(v.size>2e6)return alert("File qu ln (>2MB)");const w=new FileReader;w.onloadend=()=>{l(w.result)},w.readAsDataURL(v)}},g=async()=>{confirm("Bn c chc mun ng xut?")&&(await s(),h())};return p.jsx("div",{className:"modal-overlay",onClick:y=>y.target===y.currentTarget&&h(),children:p.jsxs("div",{className:"profile-modal modal-content",children:[p.jsx("button",{className:"modal-close-btn",onClick:h,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsxs("div",{className:"profile-content",children:[p.jsxs("div",{className:"profile-header",children:[p.jsx("img",{src:r==null?void 0:r.avatar,alt:r==null?void 0:r.displayName,className:"profile-avatar-large"}),p.jsx("h2",{children:r==null?void 0:r.displayName}),p.jsx("p",{className:"profile-role",children:r!=null&&r.isGuest?" Ti khon Khch":" Thnh vin"})]}),c&&p.jsx("div",{className:"profile-message success",children:c}),r!=null&&r.isGuest?p.jsxs("form",{onSubmit:d,className:"profile-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tn hin th"}),p.jsx("input",{type:"text",className:"input",value:i,onChange:y=>o(y.target.value),placeholder:"Tn ca bn",required:!0})]}),p.jsx("button",{type:"submit",className:"btn btn-primary",children:"Lu Thay i"})]}):p.jsxs("form",{onSubmit:d,className:"profile-form",children:[p.jsxs("div",{className:"form-group profile-avatar-edit",children:[p.jsx("label",{children:"nh i Din"}),p.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[p.jsx("img",{src:a||r.photoURL,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover",border:"2px solid var(--border-color)"},alt:"Avatar"}),p.jsxs("div",{children:[p.jsx("label",{htmlFor:"avatar-upload",className:"btn btn-primary",style:{padding:"0.4rem 0.8rem",fontSize:"0.85rem"},children:"Thay i"}),p.jsx("input",{id:"avatar-upload",type:"file",accept:"image/*",onChange:f,style:{display:"none"}})]})]})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tn hin th"}),p.jsx("input",{type:"text",className:"input",value:i,onChange:y=>o(y.target.value),placeholder:"Tn ca bn",required:!0})]}),p.jsxs("div",{className:"profile-info-readonly",style:{margin:"1rem 0",opacity:.8,fontSize:"0.9rem",background:"var(--bg-secondary)",padding:"0.75rem",borderRadius:"8px"},children:[p.jsxs("div",{style:{marginBottom:"0.5rem"},children:[p.jsx("strong",{children:"Email:"})," ",r.email]}),p.jsxs("div",{children:[p.jsx("strong",{children:"Vai tr:"})," ",(r==null?void 0:r.role)==="admin"?"Qun tr vin":"Thnh vin"]})]}),p.jsx("button",{type:"submit",className:"btn btn-primary",style:{width:"100%"},children:"Lu Thay i"})]}),!(r!=null&&r.isGuest)&&p.jsx("button",{className:"btn btn-secondary logout-btn",onClick:g,children:"ng Xut"}),p.jsx("div",{className:"profile-note",children:p.jsx("small",{children:r!=null&&r.isGuest?"D liu ca bn c lu trn thit b ny. To ti khon  ng b trn nhiu thit b.":"Ti khon ca bn  c ng k v c th s dng trn nhiu thit b."})})]})]})})},lne=()=>{const{showNewsletterModal:t,setShowNewsletterModal:e,subscribeNewsletter:n}=bn(),[r,s]=V.useState(""),[i,o]=V.useState(""),[a,l]=V.useState(""),[c,u]=V.useState(!1);if(!t)return null;const h=()=>{e(!1),s(""),o(""),l(""),u(!1)},d=async f=>{f.preventDefault();try{(await n({email:r,name:i})).success?(l("ng k thnh cng! Cm n bn."),u(!0),setTimeout(()=>{h()},2e3)):(l(" c li xy ra. Vui lng th li."),u(!1))}catch(g){l("Li: "+g.message),u(!1)}};return p.jsx("div",{className:"modal-overlay",onClick:f=>f.target===f.currentTarget&&h(),children:p.jsxs("div",{className:"newsletter-modal modal-content",children:[p.jsx("button",{className:"modal-close-btn",onClick:h,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsxs("div",{className:"newsletter-content",children:[p.jsx("div",{className:"newsletter-icon",children:p.jsxs("svg",{width:"64",height:"64",viewBox:"0 0 64 64",fill:"none",children:[p.jsx("circle",{cx:"32",cy:"32",r:"30",fill:"url(#newsletter-gradient)",opacity:"0.1"}),p.jsx("path",{d:"M16 24l16 12 16-12M16 24v24h32V24M16 24h32",stroke:"url(#newsletter-gradient)",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"}),p.jsx("defs",{children:p.jsxs("linearGradient",{id:"newsletter-gradient",x1:"0",y1:"0",x2:"64",y2:"64",children:[p.jsx("stop",{offset:"0%",stopColor:"hsl(220, 90%, 56%)"}),p.jsx("stop",{offset:"100%",stopColor:"hsl(280, 70%, 60%)"})]})})]})}),p.jsx("h2",{children:"ng K Newsletter"}),p.jsx("p",{className:"newsletter-subtitle",children:"Nhn nhng setup p nht mi tun v tips thit k workspace t DeskHub"}),a&&p.jsx("div",{className:`newsletter-message ${c?"success":"error"}`,children:a}),p.jsxs("form",{onSubmit:d,className:"newsletter-form",children:[p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Tn ca bn"}),p.jsx("input",{type:"text",className:"input",value:i,onChange:f=>o(f.target.value),placeholder:"Nguyn Vn A",required:!0})]}),p.jsxs("div",{className:"form-group",children:[p.jsx("label",{children:"Email"}),p.jsx("input",{type:"email",className:"input",value:r,onChange:f=>s(f.target.value),placeholder:"email@example.com",required:!0})]}),p.jsxs("button",{type:"submit",className:"btn btn-primary newsletter-submit",children:[p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:p.jsx("path",{d:"M18 2L9 11M18 2l-7 16-2-7-7-2 16-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"ng K Ngay"]})]}),p.jsx("p",{className:"newsletter-note",children:p.jsx("small",{children:"Chng ti s gi email mi tun v nhng setup c bnh chn p nht. Bn c th hy ng k bt c lc no."})})]})]})})},cne=()=>{const{showCollectionsModal:t,setShowCollectionsModal:e,getSavedSetups:n,setSelectedSetup:r}=bn();if(!t)return null;const s=n(),i=()=>{e(!1)},o=a=>{r(a),i()};return p.jsx("div",{className:"modal-overlay",onClick:a=>a.target===a.currentTarget&&i(),children:p.jsxs("div",{className:"collections-modal modal-content",children:[p.jsx("button",{className:"modal-close-btn",onClick:i,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),p.jsxs("div",{className:"collections-content",children:[p.jsxs("div",{className:"collections-header",children:[p.jsx("h2",{children:"Setup  Lu"}),p.jsxs("p",{className:"collections-count",children:[s.length," setup"]})]}),s.length===0?p.jsxs("div",{className:"collections-empty",children:[p.jsxs("svg",{width:"120",height:"120",viewBox:"0 0 120 120",fill:"none",children:[p.jsx("circle",{cx:"60",cy:"60",r:"50",stroke:"var(--color-border)",strokeWidth:"2"}),p.jsx("path",{d:"M50 40h20a5 5 0 015 5v40l-15-8-15 8V45a5 5 0 015-5z",stroke:"var(--color-text-tertiary)",strokeWidth:"2"})]}),p.jsx("h3",{children:"Cha c setup no"}),p.jsx("p",{children:"Bm vo biu tng  trn cc setup  lu vo b su tp ca bn"})]}):p.jsx("div",{className:"collections-grid",children:s.map(a=>{var l;return p.jsxs("div",{className:"collection-item",onClick:()=>o(a),children:[p.jsx("div",{className:"collection-item-image",children:p.jsx("img",{src:a.mainImage,alt:a.title})}),p.jsxs("div",{className:"collection-item-content",children:[p.jsx("h4",{children:a.title}),p.jsx("p",{children:a.caption}),p.jsxs("div",{className:"collection-item-meta",children:[p.jsxs("span",{children:[" ",((l=a.likes)==null?void 0:l.length)||0]}),p.jsxs("span",{children:[" ",a.comments||0]})]})]})]},a.id)})})]})]})})},une=({product:t,isActive:e,onActivate:n})=>{const[r,s]=V.useState(!1);V.useEffect(()=>{const o=()=>s(window.innerWidth<=768);return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const i=o=>{o.stopPropagation(),n(e?null:t)};return p.jsxs("div",{className:"product-marker",style:{left:`${t.x}%`,top:`${t.y}%`},onClick:i,children:[p.jsx("button",{className:`marker-btn ${e?"active":""}`,children:p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[p.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"var(--color-primary)"}),p.jsx("path",{d:"M10 6v8M6 10h8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),!r&&e&&p.jsxs("div",{className:"product-tooltip-desktop",style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%) translateY(-8px)",marginBottom:"8px",background:"white",color:"#333",padding:"16px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)",minWidth:"280px",maxWidth:"320px",zIndex:1e4,animation:"fadeIn 0.2s ease-out",border:"1px solid rgba(0, 0, 0, 0.08)"},onClick:o=>o.stopPropagation(),children:[p.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#333",margin:"0 0 8px 0",lineHeight:"1.4"},children:t.name}),p.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#ff6b35",margin:"0 0 12px 0",lineHeight:"1.2"},children:t.price}),t.link&&p.jsxs("a",{href:t.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"14px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"10px 20px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.3)",transition:"all 0.2s",border:"none"},children:[p.jsx("span",{children:"Xem sn phm"}),p.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",children:p.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),p.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"8px solid white"}})]})]})},hne=()=>{var ne,ce;const{setupId:t}=sy(),e=Xc(),{setups:n,toggleLike:r,toggleSave:s,addComment:i,getComments:o,fetchCommentsForSetup:a,hasUserLiked:l,hasUserSaved:c,getSimilarSetups:u,currentUser:h,setShowAuthModal:d,loading:f}=bn(),[g,y]=V.useState(0),[v,w]=V.useState(""),[T,E]=V.useState(!0),[R,P]=V.useState(null),[N,k]=V.useState(!1),[_,x]=V.useState(!1),[S,A]=V.useState(null),[M,I]=V.useState(null),[j,B]=V.useState(!1),[L,O]=V.useState(1),[$,U]=V.useState(!1),[F,X]=V.useState(null),H=V.useRef(null),J=50,z=n.find(G=>G.id===t),W=Xe.useMemo(()=>{var G;return((G=z==null?void 0:z.images)==null?void 0:G.length)>0?[...z.images.map(we=>({type:"image",url:we.url,products:we.products||[]})),...z.youtubeVideo?[{type:"youtube",url:z.youtubeVideo,poster:z.mainImage}]:[]]:z?[{type:"image",url:z.mainImage,products:z.products||[]},...(z.moreImages||[]).map(we=>({type:"image",url:we})),...z.youtubeVideo?[{type:"youtube",url:z.youtubeVideo,poster:z.mainImage}]:[]]:[]},[z]);V.useEffect(()=>{var tn,He,st;if(!W||W.length<=1)return;const G=tt=>{const Bt=new Image;Bt.src=tt},we=(g+1)%W.length,je=(g+2)%W.length,Ce=(g-1+W.length)%W.length;((tn=W[we])==null?void 0:tn.type)==="image"&&G(W[we].url),((He=W[je])==null?void 0:He.type)==="image"&&G(W[je].url),((st=W[Ce])==null?void 0:st.type)==="image"&&G(W[Ce].url)},[g,W]);const[de,Te]=V.useState(!0);if(V.useEffect(()=>{Te(!0)},[g]),V.useEffect(()=>{t&&a(t)},[t,a]),V.useEffect(()=>{const G=()=>k(window.innerWidth<=768);return G(),window.addEventListener("resize",G),()=>window.removeEventListener("resize",G)},[]),V.useEffect(()=>{N&&z&&W.length>1&&(localStorage.getItem("hasSeenSwipeHint")||(x(!0),setTimeout(()=>{x(!1),localStorage.setItem("hasSeenSwipeHint","true")},3e3)))},[N,z,W.length]),f||n.length===0&&!z)return p.jsx("div",{className:"setup-detail-page",style:{paddingTop:"100px",display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:p.jsx("div",{style:{color:"var(--color-text-primary)",fontSize:"18px"},children:"ang ti..."})});if(!f&&n.length>0&&!z)return p.jsxs("div",{className:"setup-not-found",style:{paddingTop:"100px",textAlign:"center"},children:[p.jsx("h2",{children:"Setup khng tn ti"}),p.jsx("button",{onClick:()=>e("/"),style:{marginTop:"20px",padding:"10px 20px",cursor:"pointer"},children:"Quay v trang ch"})]});if(!z)return p.jsx("div",{className:"setup-detail-page",style:{paddingTop:"100px",display:"flex",justifyContent:"center"},children:p.jsx("div",{style:{color:"var(--color-text-primary)"},children:"ang ti..."})});const Ie=W[g]||W[0],me=l(z.id),Ae=c(z.id),Re=o(z.id),Oe=u(z.id,16),jt=G=>{I(null),A(G.targetTouches[0].clientX)},xt=G=>{I(G.targetTouches[0].clientX)},Be=()=>{if(!S||!M)return;const G=S-M,we=G>J,je=G<-J;we&&g<W.length-1&&y(Ce=>Ce+1),je&&g>0&&y(Ce=>Ce-1)},Ke=()=>{if(!h){d(!0);return}r(z.id)},Fe=()=>{if(!h){d(!0);return}s(z.id)},Z=G=>{if(G.preventDefault(),!h){d(!0);return}if(v.trim()){const we=h.photoURL||h.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(h.displayName||"User")}&background=random`,je={text:v,author:h.displayName,userId:h.id,avatar:we};F&&(je.replyTo={commentId:F.id,author:F.author}),i(z.id,je),w(""),X(null)}},fe=G=>{var je,Ce;if(!h){d(!0);return}const we=typeof G.author=="string"?G.author:((je=G.author)==null?void 0:je.name)||((Ce=G.author)==null?void 0:Ce.displayName)||"n danh";X({id:G.id,author:we}),w(`@${we} `),H.current&&H.current.focus()},Ee=()=>{X(null),w("")},ee=()=>{R&&P(null)},re={"@context":"https://schema.org","@type":"Article",headline:z.title,image:z.mainImage,author:{"@type":"Person",name:z.author},datePublished:z.createdAt};return p.jsxs(p.Fragment,{children:[p.jsx(By,{title:`${z.title} | DeskHub`,description:z.caption,image:z.mainImage,type:"article",schema:re}),p.jsxs("div",{className:"setup-detail-page",children:[_&&N&&p.jsxs("div",{className:"swipe-hint-popup",children:[p.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",children:[p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),p.jsx("path",{d:"M9 18l6-6-6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),p.jsx("p",{children:"Vut  xem nh tip theo"})]}),p.jsxs("div",{className:"setup-content",children:[p.jsxs("div",{className:"setup-left-column",children:[p.jsx("div",{className:"setup-gallery-section",children:p.jsxs("div",{className:"setup-main-image-container",onTouchStart:N?jt:void 0,onTouchMove:N?xt:void 0,onTouchEnd:N?Be:void 0,onClick:ee,onMouseEnter:()=>!N&&U(!0),onMouseLeave:()=>!N&&U(!1),children:[p.jsx("button",{className:"back-btn",onClick:()=>e(-1),"aria-label":"Quay li",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),de&&p.jsx("div",{className:"image-loader"}),p.jsx("img",{src:Ie.url,alt:z.title,className:"setup-main-image",onLoad:()=>Te(!1),style:{transform:`scale(${L})`,transition:"transform 0.2s ease, opacity 0.3s ease",opacity:de?.5:1}}),T&&Ie.products&&Ie.products.map((G,we)=>p.jsx(une,{product:G,isActive:R===G,onActivate:P},we)),Ie.products&&Ie.products.length>0&&p.jsx("button",{className:"toggle-products-btn",onClick:G=>{G.stopPropagation(),E(!T)},children:p.jsx("div",{className:"toggle-content",children:p.jsx("span",{children:T?"n sn phm":"Hin sn phm"})})}),!N&&$&&p.jsxs("div",{className:"zoom-controls",children:[p.jsx("button",{className:"zoom-btn",onClick:G=>{G.stopPropagation(),O(we=>Math.min(we+.25,3))},title:"Phng to",children:p.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:[p.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),p.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})}),p.jsx("button",{className:"zoom-btn",onClick:G=>{G.stopPropagation(),O(we=>Math.max(we-.25,.5))},title:"Thu nh",children:p.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",children:p.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})})}),L!==1&&p.jsxs("button",{className:"zoom-btn zoom-reset",onClick:G=>{G.stopPropagation(),O(1)},title:"Reset",children:[Math.round(L*100),"%"]})]}),!N&&W.length>1&&p.jsxs(p.Fragment,{children:[p.jsx("button",{className:"nav-arrow prev",onClick:()=>y(G=>Math.max(0,G-1)),disabled:g===0,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),p.jsx("button",{className:"nav-arrow next",onClick:()=>y(G=>Math.min(W.length-1,G+1)),disabled:g===W.length-1,children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:p.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]}),W.length>1&&p.jsx("div",{className:"image-pagination-dots",children:W.map((G,we)=>p.jsx("button",{className:`pagination-dot ${we===g?"active":""}`,onClick:()=>y(we)},we))})]})}),p.jsxs("div",{className:"setup-details-section",children:[p.jsxs("div",{className:"setup-header-row",children:[p.jsxs("div",{className:"setup-author-simple",children:[p.jsx("img",{src:typeof z.author=="object"?z.author.avatar:z.avatar,alt:typeof z.author=="object"?z.author.name:z.author,className:"author-avatar-small"}),p.jsx("span",{className:"author-name-simple",children:typeof z.author=="object"?z.author.name:z.author})]}),p.jsxs("div",{className:"setup-actions-row",children:[p.jsxs("button",{className:`action-btn-icon ${me?"active":""}`,onClick:Ke,title:"Thch",children:[p.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:me?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:p.jsx("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),p.jsx("span",{className:"action-count",children:((ne=z.likes)==null?void 0:ne.length)||0})]}),p.jsxs("button",{className:`action-btn-icon ${Ae?"active":""}`,onClick:Fe,title:"Lu",children:[p.jsx("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:Ae?"currentColor":"none",stroke:"currentColor",strokeWidth:"2",children:p.jsx("path",{d:"M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"})}),p.jsx("span",{className:"action-count",children:((ce=z.saves)==null?void 0:ce.length)||0})]}),p.jsx("button",{className:"action-btn-icon",title:"Chia s",onClick:()=>{navigator.share?navigator.share({title:z.title,text:z.caption,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),alert(" copy link!"))},children:p.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[p.jsx("circle",{cx:"18",cy:"5",r:"3"}),p.jsx("circle",{cx:"6",cy:"12",r:"3"}),p.jsx("circle",{cx:"18",cy:"19",r:"3"}),p.jsx("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),p.jsx("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})})]})]}),p.jsx("p",{className:"setup-caption",children:z.caption}),z.tags&&z.tags.length>0&&p.jsx("div",{className:"setup-tags",children:z.tags.map((G,we)=>p.jsxs("span",{className:"setup-tag",children:["#",G]},we))}),p.jsxs("div",{className:"comments-section",children:[p.jsxs("h4",{children:["Bnh lun (",Re.length,")"]}),F&&p.jsxs("div",{className:"reply-indicator",children:[p.jsxs("span",{children:["ang tr li ",p.jsxs("strong",{children:["@",F.author]})]}),p.jsx("button",{type:"button",className:"cancel-reply-btn",onClick:Ee,children:p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:p.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),p.jsxs("form",{className:"comment-form",onSubmit:Z,children:[p.jsx("input",{ref:H,type:"text",placeholder:F?`Tr li @${F.author}...`:"Thm bnh lun...",value:v,onChange:G=>w(G.target.value),className:"comment-input"}),p.jsx("button",{type:"submit",className:"btn-primary",children:"Gi"})]}),p.jsx("div",{className:"comments-list",children:Re.length===0?p.jsx("p",{className:"no-comments",children:"Cha c bnh lun no"}):p.jsxs(p.Fragment,{children:[Re.slice(0,j?Re.length:2).map(G=>{var He,st,tt,Bt;const we=typeof G.text=="string"?G.text:((He=G.text)==null?void 0:He.text)||JSON.stringify(G.text)||"",je=typeof G.author=="string"?G.author:((st=G.author)==null?void 0:st.name)||((tt=G.author)==null?void 0:tt.displayName)||"n danh",Ce=typeof G.avatar=="string"?G.avatar:((Bt=G.avatar)==null?void 0:Bt.url)||"https://ui-avatars.com/api/?name=User&background=random",tn=Ut=>{const or=/@(\S+)/g,fn=[];let hs=0,Tn;for(;(Tn=or.exec(Ut))!==null;)Tn.index>hs&&fn.push(Ut.substring(hs,Tn.index)),fn.push(p.jsxs("span",{className:"mention-tag",children:["@",Tn[1]]},Tn.index)),hs=Tn.index+Tn[0].length;return hs<Ut.length&&fn.push(Ut.substring(hs)),fn.length>0?fn:Ut};return p.jsxs("div",{className:"comment",children:[p.jsx("img",{src:Ce,alt:je,className:"comment-avatar"}),p.jsxs("div",{className:"comment-content",children:[p.jsxs("div",{className:"comment-header",children:[p.jsx("p",{className:"comment-author",children:je}),p.jsx("button",{type:"button",className:"reply-btn",onClick:()=>fe(G),children:"Tr li"})]}),G.replyTo&&p.jsxs("p",{className:"reply-to-indicator",children:[" Tr li ",p.jsxs("span",{className:"mention-tag",children:["@",G.replyTo.author]})]}),p.jsx("p",{className:"comment-text",children:tn(we)})]})]},G.id)}),Re.length>2&&!j&&p.jsxs("button",{className:"show-more-comments",onClick:()=>B(!0),children:["Xem thm ",Re.length-2," bnh lun"]})]})})]}),N&&Oe.length>0&&p.jsx("div",{className:"similar-setups-section mobile-similar",children:p.jsx("div",{className:"similar-setups-grid",children:Oe.slice(0,6).map(G=>p.jsx("div",{className:"similar-setup-card",onClick:()=>e(`/setup/${G.id}`),children:p.jsx("img",{src:G.mainImage,alt:G.title})},G.id))})})]})]}),!N&&Oe.length>0&&p.jsx("div",{className:"setup-right-column",children:p.jsx("div",{className:"similar-setups-section-desktop",children:p.jsx("div",{className:"similar-setups-grid-desktop",children:Oe.map(G=>p.jsx("div",{className:"similar-setup-card",onClick:()=>e(`/setup/${G.id}`),children:p.jsx("img",{src:G.mainImage,alt:G.title})},G.id))})})})]})]}),N&&R&&ux.createPortal(p.jsxs("div",{className:"product-tooltip-portal",style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:"380px",background:"rgba(20, 20, 20, 0.95)",backdropFilter:"blur(12px)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"20px",zIndex:1e5,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",borderRadius:"16px",display:"flex",flexDirection:"column",gap:"12px",animation:"slideUpFade 0.3s ease-out"},onClick:G=>G.stopPropagation(),children:[p.jsx("button",{style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"20px",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>P(null),children:""}),p.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"white",margin:"0 24px 0 0",lineHeight:"1.4"},children:R.name}),p.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:"#ff6b35",margin:"4px 0",lineHeight:"1.2"},children:R.price}),R.link&&p.jsxs("a",{href:R.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"15px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"14px 24px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"8px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.4)"},children:[p.jsx("span",{children:"Xem sn phm"}),p.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",children:p.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),document.body)]})},q0=()=>p.jsxs("div",{className:"gallery-layout",children:[p.jsx("div",{className:"desktop-sidebar-wrapper",children:p.jsx(vD,{})}),p.jsx("div",{className:"gallery-content",children:p.jsx(NW,{})})]}),dne=()=>{const{subscribeNewsletter:t}=bn(),[e,n]=V.useState(""),[r,s]=V.useState("idle"),i=async o=>{o.preventDefault(),s("loading"),(await t({email:e})).success?(s("success"),n(""),setTimeout(()=>s("idle"),3e3)):(s("error"),setTimeout(()=>s("idle"),3e3))};return p.jsxs("div",{className:"footer-newsletter",children:[p.jsx("p",{className:"newsletter-label",children:" Nhn tin mi:"}),p.jsxs("form",{className:"newsletter-inline-form",onSubmit:i,children:[p.jsx("input",{type:"email",placeholder:"Email ca bn...",value:e,onChange:o=>n(o.target.value),required:!0,disabled:r==="loading"||r==="success"}),p.jsx("button",{type:"submit",className:`btn-newsletter-small ${r}`,disabled:r==="loading",children:r==="loading"?"...":r==="success"?"":"ng k"})]})]})},fne=()=>{const{selectedSetup:t,showAddSetupModal:e,setShowAddSetupModal:n,addSetup:r,setShowNewsletterModal:s}=bn(),i=_i();V.useEffect(()=>{window.scrollTo(0,0)},[i.pathname]);const o=async a=>{console.log(" App.handleSaveSetup called with:",a);const l=await r(a);console.log(" App.handleSaveSetup response:",l),l.success?(n(!1),alert(" thm setup thnh cng!")):alert(`Li: ${l.message||"C li xy ra"}`)};return p.jsxs("div",{className:"app",children:[p.jsx(IW,{}),p.jsx("main",{className:"main-content",children:p.jsxs(yF,{children:[p.jsx(Er,{path:"/",element:p.jsx(q0,{})}),p.jsx(Er,{path:"/gallery",element:p.jsx(q0,{})}),p.jsx(Er,{path:"/setup/:setupId",element:p.jsx(hne,{})}),p.jsx(Er,{path:"/blog",element:p.jsx(DW,{})}),p.jsx(Er,{path:"/blog/:slug",element:p.jsx(Cq,{})}),p.jsx(Er,{path:"/blog/seo-new",element:p.jsx(MA,{})}),p.jsx(Er,{path:"/blog/seo-edit/:id",element:p.jsx(MA,{})}),p.jsx(Er,{path:"/blog/new",element:p.jsx(HC,{})}),p.jsx(Er,{path:"/blog/edit/:id",element:p.jsx(HC,{})}),p.jsx(Er,{path:"/admin",element:p.jsx(ine,{})}),p.jsx(Er,{path:"*",element:p.jsx(q0,{})})]})}),p.jsx("div",{className:"mobile-filter-wrapper",children:p.jsx(vD,{})}),t&&p.jsx(PW,{}),e&&p.jsx(C4,{onClose:()=>n(!1),onSave:o}),p.jsx(one,{}),p.jsx(ane,{}),p.jsx(lne,{}),p.jsx(cne,{}),p.jsxs("footer",{className:"footer",children:[p.jsxs("div",{className:"container footer-content",children:[p.jsxs("div",{className:"footer-section",children:[p.jsx("h4",{children:"DeskHub"}),p.jsx("p",{children:"Khm ph v chia s nhng gc lm vic p nht t khp ni trn th gii."}),p.jsx(dne,{})]}),p.jsxs("div",{className:"footer-section",children:[p.jsx("h5",{children:"Lin Kt"}),p.jsxs("ul",{children:[p.jsx("li",{children:p.jsx("a",{href:"/",children:"B Su Tp"})}),p.jsx("li",{children:p.jsx("a",{href:"/blog",children:"Blog"})}),p.jsx("li",{children:p.jsx("a",{href:"#",children:"Gii Thiu"})}),p.jsx("li",{children:p.jsx("a",{href:"#",children:"Lin H"})})]})]}),p.jsxs("div",{className:"footer-section",children:[p.jsx("h5",{children:"Theo Di"}),p.jsxs("div",{className:"social-links",children:[p.jsx("a",{href:"#",className:"social-link","aria-label":"Facebook",children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M18 2h-3a5 5 0 00-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 011-1h3z"})})}),p.jsx("a",{href:"#",className:"social-link","aria-label":"Instagram",children:p.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("rect",{x:"2",y:"2",width:"20",height:"20",rx:"5",ry:"5"}),p.jsx("path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"}),p.jsx("line",{x1:"17.5",y1:"6.5",x2:"17.51",y2:"6.5"})]})}),p.jsx("a",{href:"#",className:"social-link","aria-label":"YouTube",children:p.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:p.jsx("path",{d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.33 29 29 0 0 0-.46-5.33zM9.75 15.02V8.5l5.75 3.26z"})})})]})]})]}),p.jsx("div",{className:"footer-bottom",children:p.jsx("div",{className:"container",children:p.jsx("p",{children:" 2026 DeskHub. Tt c quyn c bo lu."})})})]})]})};function pne(){return p.jsx(CW,{children:p.jsx(fne,{})})}G0.createRoot(document.getElementById("root")).render(p.jsx(Xe.StrictMode,{children:p.jsx(_2,{children:p.jsx(UF,{children:p.jsx(pne,{})})})}));
