import{j as e}from"./vendor-tiptap-CPIgDqZu.js";import{r as h}from"./vendor-react-BadUDqtX.js";import{u as E}from"./index-C0aebke8.js";import I from"./AddSetupModal-CUAYedAJ.js";import"./vendor-firebase-D65FIcPE.js";import"./cloudinary-CNrMDq67.js";const W=()=>{const{setups:c,blogs:v,getComments:g,currentUser:j,addSetup:k,updateSetup:S,deleteSetup:f,refreshData:D}=E(),[N,p]=h.useState(null),[i,u]=h.useState(new Set),[l,b]=h.useState({startDate:"",endDate:""}),C=s=>{s.target.checked?u(new Set(c.map(t=>t.id))):u(new Set)},w=s=>{const t=new Set(i);t.has(s)?t.delete(s):t.add(s),u(t)},T=async()=>{if(i.size!==0&&confirm(`Báº¡n cÃ³ cháº¯c cháº¯n muá»‘n xÃ³a ${i.size} setup Ä‘Ã£ chá»n khÃ´ng?`))try{const s=Array.from(i).map(t=>f(t));await Promise.all(s),u(new Set),alert("ÄÃ£ xÃ³a cÃ¡c setup Ä‘Ã£ chá»n!")}catch(s){console.error("Bulk delete failed:",s),alert("CÃ³ lá»—i xáº£y ra khi xÃ³a hÃ ng loáº¡t.")}},A=async(s,t)=>{if(t){const a=await S(s,t);a.success?(p(null),alert("ÄÃ£ cáº­p nháº­t setup thÃ nh cÃ´ng!")):alert(a.message||"Lá»—i cáº­p nháº­t")}else{const a=await k(s);a.success?alert("ÄÃ£ thÃªm setup thÃ nh cÃ´ng!"):alert(a.message||"CÃ³ lá»—i xáº£y ra")}},L=s=>{p(s)},B=async(s,t)=>{if(window.confirm(`Báº¡n cÃ³ cháº¯c muá»‘n xÃ³a setup "${t}" khÃ´ng?`)){const a=await f(s);a.success||alert(a.message||"XÃ³a tháº¥t báº¡i")}},d=s=>{if(!s)return!1;const t=new Date(s);if(l.startDate){const a=l.startDate.split("-"),r=new Date(a[0],a[1]-1,a[2],0,0,0,0);if(t<r)return!1}if(l.endDate){const a=l.endDate.split("-"),r=new Date(a[0],a[1]-1,a[2],23,59,59,999);if(t>r)return!1}return!0},m=h.useMemo(()=>{const s=c.filter(n=>d(n.createdAt)).length,t=v.filter(n=>d(n.publishedAt)).length;let a=0,r=0,x=0;return c.forEach(n=>{Array.isArray(n.likes)&&(a+=n.likes.filter(o=>typeof o=="object"?d(o.timestamp):!0).length),Array.isArray(n.saves)&&(r+=n.saves.filter(o=>typeof o=="object"?d(o.timestamp):!0).length);const z=g(n.id);x+=z.filter(o=>d(o.timestamp)).length}),{totalSetups:s,totalBlogs:t,totalLikes:a,totalSaves:r,totalComments:x}},[c,v,l,g]),R=h.useMemo(()=>c.map(s=>{const t=g(s.id),a=(s.likes||[]).filter(n=>typeof n=="object"?d(n.timestamp):!0).length,r=(s.saves||[]).filter(n=>typeof n=="object"?d(n.timestamp):!0).length,x=t.filter(n=>d(n.timestamp)).length;return{...s,rangeLikeCount:a,rangeSaveCount:r,rangeCommentCount:x,engagement:a*2+r*3+x*1}}).sort((s,t)=>t.engagement-s.engagement).slice(0,5),[c,l,g]),y=h.useMemo(()=>{const s={};return c.filter(a=>d(a.createdAt)).forEach(a=>{const r=a.filters.purpose||"Other";s[r]||(s[r]=0),s[r]++}),Object.entries(s).sort((a,r)=>r[1]-a[1])},[c,l]);return!j||j.role!=="admin"?e.jsx("div",{className:"admin-dashboard-error",children:"Access Denied"}):e.jsxs("div",{className:"admin-dashboard",children:[e.jsxs("header",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Admin Dashboard"}),e.jsxs("p",{children:["Welcome back, ",j.displayName]})]}),e.jsxs("div",{className:"header-actions",style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("button",{className:"btn",onClick:async()=>{confirm("Táº£i láº¡i dá»¯ liá»‡u tá»« server/local?")&&(await D(),alert("ÄÃ£ cáº­p nháº­t!"))},style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"0.5rem 1rem",borderRadius:"8px",border:"1px solid var(--border-color)",cursor:"pointer"},children:"ðŸ”„ KhÃ´i phá»¥c Dá»¯ liá»‡u"}),e.jsxs("div",{className:"dashboard-filter",children:[e.jsx("span",{className:"filter-label",children:"Lá»c:"}),e.jsx("input",{type:"date",className:"date-input",value:l.startDate,onChange:s=>b(t=>({...t,startDate:s.target.value}))}),e.jsx("span",{className:"filter-separator",children:"-"}),e.jsx("input",{type:"date",className:"date-input",value:l.endDate,onChange:s=>b(t=>({...t,endDate:s.target.value}))}),(l.startDate||l.endDate)&&e.jsx("button",{className:"btn-clear",onClick:()=>b({startDate:"",endDate:""}),children:"âœ•"})]})]})]}),e.jsxs("div",{className:"stats-grid",children:[e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Tá»•ng LÆ°á»£t ThÃ­ch"}),e.jsx("div",{className:"stat-value",children:m.totalLikes}),e.jsxs("div",{className:"stat-trend positive",children:["â¤ï¸ ",l.startDate||l.endDate?"Trong khoáº£ng":"Táº¥t cáº£"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Tá»•ng LÆ°á»£t LÆ°u"}),e.jsx("div",{className:"stat-value",children:m.totalSaves}),e.jsxs("div",{className:"stat-trend positive",children:["ðŸ“Œ ",l.startDate||l.endDate?"Trong khoáº£ng":"Táº¥t cáº£"]})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Tá»•ng BÃ¬nh Luáº­n"}),e.jsx("div",{className:"stat-value",children:m.totalComments}),e.jsx("div",{className:"stat-trend",children:"ðŸ’¬ Tháº£o luáº­n"})]}),e.jsxs("div",{className:"stat-card",children:[e.jsx("h3",{children:"Tá»•ng Setup Má»›i"}),e.jsx("div",{className:"stat-value",children:m.totalSetups}),e.jsx("div",{className:"stat-trend",children:"ðŸ–¥ï¸ BÃ i Ä‘Äƒng"})]})]}),e.jsxs("div",{className:"dashboard-layout",children:[e.jsxs("div",{className:"dashboard-section manage-section",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("h2",{children:["ðŸ“ Quáº£n LÃ½ Táº¥t Cáº£ Setup (",c.length,")"]}),i.size>0&&e.jsxs("div",{className:"bulk-actions",style:{margin:0},children:[e.jsxs("span",{style:{fontWeight:600,color:"var(--text-primary)"},children:["ÄÃ£ chá»n ",i.size]}),e.jsxs("button",{onClick:T,className:"btn-bulk-delete",children:["ðŸ—‘ï¸ XÃ³a ",i.size," Setup"]})]})]}),e.jsx("div",{className:"ranking-table-wrapper",style:{maxHeight:"400px",overflowY:"auto"},children:e.jsxs("table",{className:"ranking-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"checkbox-col",children:e.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:c.length>0&&i.size===c.length,onChange:C})}),e.jsx("th",{children:"Setup"}),e.jsx("th",{children:"NgÃ y táº¡o"}),e.jsx("th",{children:"Thá»‘ng kÃª (Like/Save/Cmt)"}),e.jsx("th",{children:"HÃ nh Ä‘á»™ng"})]})}),e.jsx("tbody",{children:c.map(s=>{var t,a;return e.jsxs("tr",{style:{background:i.has(s.id)?"var(--bg-secondary)":"transparent"},children:[e.jsx("td",{className:"checkbox-col",children:e.jsx("input",{type:"checkbox",className:"custom-checkbox",checked:i.has(s.id),onChange:()=>w(s.id)})}),e.jsx("td",{children:e.jsxs("div",{className:"setup-cell",children:[e.jsx("img",{src:s.mainImage,alt:"",className:"setup-thumb"}),e.jsx("span",{className:"setup-title",title:s.title,children:s.title})]})}),e.jsx("td",{children:new Date(s.createdAt).toLocaleDateString("vi-VN")}),e.jsxs("td",{children:[((t=s.likes)==null?void 0:t.length)||0," / ",((a=s.saves)==null?void 0:a.length)||0," / ",s.comments||0]}),e.jsxs("td",{children:[e.jsx("button",{className:"btn-edit",onClick:()=>L(s),title:"Sá»­a setup nÃ y",style:{marginRight:"0.5rem",background:"none",border:"none",cursor:"pointer",fontSize:"1.2rem"},children:"âœï¸"}),e.jsx("button",{className:"btn-delete",onClick:()=>B(s.id,s.title),title:"XÃ³a setup nÃ y",children:"ðŸ—‘ï¸"})]})]},s.id)})})]})})]}),e.jsxs("div",{className:"dashboard-section ranking-section",children:[e.jsx("h2",{children:"ðŸ† BXH TÆ°Æ¡ng TÃ¡c Top 5"}),e.jsx("div",{className:"ranking-table-wrapper",children:e.jsxs("table",{className:"ranking-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Rank"}),e.jsx("th",{children:"Setup"}),e.jsx("th",{children:"Äiá»ƒm"})]})}),e.jsx("tbody",{children:R.map((s,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("span",{className:`rank-badge rank-${t+1}`,children:["#",t+1]})}),e.jsx("td",{children:e.jsxs("div",{className:"setup-cell",children:[e.jsx("img",{src:s.mainImage,alt:"",className:"setup-thumb"}),e.jsx("span",{className:"setup-title",children:s.title})]})}),e.jsx("td",{children:e.jsx("strong",{children:s.engagement})})]},s.id))})]})})]}),e.jsxs("div",{className:"dashboard-section insights-section",children:[e.jsx("h2",{children:"ðŸ“Š Xu HÆ°á»›ng"}),e.jsxs("div",{className:"insights-card",children:[e.jsx("h3",{children:"Danh Má»¥c Phá»• Biáº¿n"}),y.length>0?e.jsx("ul",{className:"category-list",children:y.map(([s,t])=>e.jsxs("li",{className:"category-item",children:[e.jsx("span",{className:"category-name",children:s.replace("-"," ")}),e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:"progress-fill",style:{width:`${t/m.totalSetups*100}%`}})}),e.jsx("span",{className:"category-count",children:t})]},s))}):e.jsx("p",{className:"no-data",children:"KhÃ´ng cÃ³ dá»¯ liá»‡u."})]})]})]}),N&&e.jsx(I,{initialData:N,onClose:()=>p(null),onSave:A})]})};export{W as default};
