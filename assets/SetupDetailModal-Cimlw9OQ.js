import{j as e}from"./vendor-tiptap-CPIgDqZu.js";import{r as l,R as L,a as je}from"./vendor-react-BadUDqtX.js";import{u as be,S as fe}from"./index-C0aebke8.js";import"./vendor-firebase-D65FIcPE.js";const Le=()=>{var X,U,O;const{selectedSetup:a,setSelectedSetup:p,toggleLike:y,toggleSave:f,addComment:I,getComments:T,fetchCommentsForSetup:r,hasUserLiked:K,hasUserSaved:Q,getSimilarSetups:Z,currentUser:n,setups:ke,setShowAuthModal:k}=be(),[x,W]=l.useState(null),[m,g]=l.useState(0),[M,v]=l.useState(""),[w,ee]=l.useState(!0),[u,te]=l.useState(!1),[se,E]=l.useState(!1),[H,ie]=l.useState(null),[A,$]=l.useState(null),[j,R]=l.useState(null),P=l.useRef(null),D=50;if(L.useEffect(()=>{a!=null&&a.id&&r(a.id)},[a==null?void 0:a.id,r]),L.useEffect(()=>{const t=()=>te(window.innerWidth<=768);return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]),L.useEffect(()=>{u&&a&&c.length>1&&(localStorage.getItem("hasSeenSwipeHint")||(E(!0),setTimeout(()=>{E(!1),localStorage.setItem("hasSeenSwipeHint","true")},3e3)))},[u,a]),!a)return null;const s=a,c=((X=s.images)==null?void 0:X.length)>0?[...s.images.map(t=>({type:"image",url:t.url,products:t.products||[]})),...s.youtubeVideo?[{type:"youtube",url:s.youtubeVideo,poster:s.mainImage}]:[]]:[{type:"image",url:s.mainImage,products:s.products||[]},...(s.moreImages||[]).map(t=>({type:"image",url:t})),...s.youtubeVideo?[{type:"youtube",url:s.youtubeVideo,poster:s.mainImage}]:[]],d=c[m]||c[0],V=K(s.id),z=Q(s.id),B=T(s.id),F=Z(s.id),ae=()=>{x&&W(null)},Y=()=>{p(null),v("")},ne=()=>{if(!n){k(!0);return}y(s.id)},re=t=>{if(t.preventDefault(),!n){k(!0);return}if(M.trim()){const i=n.photoURL||n.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(n.displayName||"User")}&background=random`,o={text:M,author:n.displayName,userId:n.id,avatar:i};j&&(o.replyTo={commentId:j.id,author:j.author}),I(s.id,o),v(""),R(null)}},oe=t=>{var o,h;if(!n){k(!0);return}const i=typeof t.author=="string"?t.author:((o=t.author)==null?void 0:o.name)||((h=t.author)==null?void 0:h.displayName)||"Ẩn danh";R({id:t.id,author:i}),v(`@${i} `),P.current&&P.current.focus()},le=()=>{R(null),v("")},ce=t=>{t.target===t.currentTarget&&Y()},de={"@context":"https://schema.org","@type":"CreativeWork",name:s.title,image:s.mainImage,creator:{"@type":"Person",name:s.author.name},description:s.caption,interactionStatistic:[{"@type":"InteractionCounter",interactionType:"https://schema.org/LikeAction",userInteractionCount:((U=s.likes)==null?void 0:U.length)||0}]},he=t=>{$(null),ie(t.targetTouches[0].clientX)},pe=t=>{$(t.targetTouches[0].clientX)},ue=()=>{if(!H||!A)return;const t=H-A,i=t>D,o=t<-D;i&&m<c.length-1&&g(h=>h+1),o&&m>0&&g(h=>h-1)};return e.jsxs("div",{className:"modal-overlay",onClick:ce,children:[e.jsx(fe,{title:s.title,description:s.caption,image:s.mainImage,type:"article",schema:de}),e.jsxs("div",{className:"setup-detail-modal modal-content",children:[e.jsx("button",{className:"modal-close-btn",onClick:Y,children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),se&&u&&e.jsxs("div",{className:"swipe-hint-popup",children:[e.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"white",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("p",{children:"Vuốt để xem ảnh tiếp theo"})]}),e.jsxs("div",{className:"modal-layout",children:[e.jsxs("div",{className:"modal-gallery",children:[e.jsxs("div",{className:"main-image-container",onClick:ae,onTouchStart:u?he:void 0,onTouchMove:u?pe:void 0,onTouchEnd:u?ue:void 0,children:[d.type==="video"?e.jsx("video",{src:d.url,className:"main-image",controls:!0,autoPlay:!0,muted:!1,poster:d.poster,style:{objectFit:"contain",background:"#000"}}):d.type==="youtube"?e.jsx(ve,{url:d.url,poster:d.poster}):e.jsxs("div",{className:"image-wrapper-relative",children:[e.jsx("img",{src:d.url,alt:s.title,className:"main-image"}),w&&d.products&&Array.isArray(d.products)&&d.products.map((t,i)=>e.jsx(ye,{product:t,isActive:x===t,onActivate:W},i)),e.jsx("button",{className:"toggle-products-btn",onClick:t=>{t.stopPropagation(),ee(!w)},"aria-label":w?"Ẩn sản phẩm":"Hiện sản phẩm",children:u?w?e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}):e.jsxs("svg",{width:"22",height:"22",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"}),e.jsx("line",{x1:"1",y1:"1",x2:"23",y2:"23"})]}):w?"Ẩn sản phẩm":"Hiện sản phẩm"}),c.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"nav-arrow prev",onClick:t=>{t.stopPropagation(),g(i=>Math.max(0,i-1))},disabled:m===0,"aria-label":"Previous image",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M15 18l-6-6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),e.jsx("button",{className:"nav-arrow next",onClick:t=>{t.stopPropagation(),g(i=>Math.min(c.length-1,i+1))},disabled:m===c.length-1,"aria-label":"Next image",children:e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:e.jsx("path",{d:"M9 18l6-6-6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})})]})]}),c.length>1&&e.jsx("div",{className:"image-pagination-dots",children:c.slice(0,5).map((t,i)=>{let o="pagination-dot";return i===m&&(o+=" active"),i===3&&(o+=" dot-small"),i===4&&(o+=" dot-tiny"),e.jsx("button",{className:o,onClick:h=>{h.stopPropagation(),g(i)},"aria-label":`Go to image ${i+1}`},i)})})]}),c.length>1&&e.jsx("div",{className:"image-thumbnails",children:c.map((t,i)=>e.jsx("button",{className:`thumbnail ${i===m?"active":""}`,onClick:()=>g(i),children:t.type==="video"?e.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx("img",{src:t.poster,alt:"Video",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"white",children:e.jsx("path",{d:"M8 5v14l11-7z"})})})]}):t.type==="youtube"?e.jsxs("div",{className:"thumbnail-video-wrapper",style:{position:"relative",width:"100%",height:"100%"},children:[e.jsx("img",{src:t.poster,alt:"YouTube",style:{width:"100%",height:"100%",objectFit:"cover"}}),e.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.3)"},children:e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"red",children:e.jsx("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})})]}):e.jsx("img",{src:t.url,alt:`View ${i+1}`})},i))})]}),e.jsxs("div",{className:"modal-details",children:[e.jsxs("div",{className:"detail-header",children:[e.jsxs("div",{className:"author-info",children:[e.jsx("img",{src:s.author.avatar,alt:s.author.name,className:"author-avatar-large"}),e.jsxs("div",{children:[e.jsx("h2",{className:"detail-title",children:s.title}),e.jsx("p",{className:"author-name-large",children:s.author.name})]})]}),e.jsxs("div",{className:"detail-actions",children:[e.jsxs("button",{className:`action-btn-large ${V?"active":""}`,onClick:ne,children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:V?"currentColor":"none",children:e.jsx("path",{d:"M10 17.5l-1.45-1.32C4.4 12.36 2 10.28 2 7.5 2 5.42 3.42 4 5.5 4c1.74 0 3.41.81 4.5 2.09C11.09 4.81 12.76 4 14.5 4 16.58 4 18 5.42 18 7.5c0 2.78-2.4 4.86-6.55 8.68L10 17.5z",stroke:"currentColor",strokeWidth:"1.5"})}),e.jsx("span",{children:(((O=s.likes)==null?void 0:O.length)||0).toLocaleString()})]}),e.jsxs("button",{className:`action-btn-large ${z?"active":""}`,onClick:()=>f(s.id),children:[e.jsx("svg",{width:"24",height:"24",viewBox:"0 0 20 20",fill:z?"currentColor":"none",children:e.jsx("path",{d:"M5 3h10a2 2 0 012 2v14l-7-4-7 4V5a2 2 0 012-2z",stroke:"currentColor",strokeWidth:"1.5"})}),e.jsx("span",{children:z?"Đã Lưu":"Lưu"})]})]})]}),e.jsx("p",{className:"detail-caption",children:s.caption}),e.jsx("div",{className:"detail-tags",children:s.tags&&Array.isArray(s.tags)&&s.tags.map(t=>e.jsxs("span",{className:"detail-tag",children:["#",t]},t))}),e.jsxs("div",{className:"detail-filters",children:[e.jsx("h4",{children:"Chi Tiết Setup"}),e.jsx("div",{className:"filter-badges",children:Object.entries(s.filters).map(([t,i])=>e.jsx("span",{className:"filter-badge",children:i.replace("-"," ")},t))})]}),e.jsxs("div",{className:"comments-section",children:[e.jsxs("h4",{children:["Bình Luận (",B.length,")"]}),j&&e.jsxs("div",{className:"reply-indicator",children:[e.jsxs("span",{children:["Đang trả lời ",e.jsxs("strong",{children:["@",j.author]})]}),e.jsx("button",{type:"button",className:"cancel-reply-btn",onClick:le,children:e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})})})]}),e.jsxs("form",{className:"comment-form",onSubmit:re,children:[e.jsxs("div",{className:"comment-input-wrapper",children:[e.jsx("img",{src:(n==null?void 0:n.photoURL)||(n==null?void 0:n.avatar)||"https://ui-avatars.com/api/?name=User&background=random",alt:"Avatar",className:"comment-user-avatar"}),e.jsx("input",{ref:P,type:"text",className:"input comment-input",placeholder:j?`Trả lời @${j.author}...`:n?`Bình luận với tên ${n.displayName}...`:"Đăng nhập để bình luận...",value:M,onChange:t=>v(t.target.value),onClick:()=>!n&&k(!0)})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:!M.trim(),onClick:t=>{n||(t.preventDefault(),k(!0))},children:"Gửi"})]}),e.jsx("div",{className:"comments-list",children:B.length===0?e.jsx("p",{className:"no-comments",children:"Chưa có bình luận nào. Hãy là người đầu tiên!"}):B.map(t=>{var _,G,J,q;const i=typeof t.text=="string"?t.text:((_=t.text)==null?void 0:_.text)||JSON.stringify(t.text)||"",o=typeof t.author=="string"?t.author:((G=t.author)==null?void 0:G.name)||((J=t.author)==null?void 0:J.displayName)||"Ẩn danh",h=typeof t.avatar=="string"?t.avatar:((q=t.avatar)==null?void 0:q.url)||"https://ui-avatars.com/api/?name=User&background=random",xe=t.timestamp?new Date(t.timestamp).toLocaleDateString("vi-VN"):"",me=N=>{const ge=/@(\S+)/g,S=[];let C=0,b;for(;(b=ge.exec(N))!==null;)b.index>C&&S.push(N.substring(C,b.index)),S.push(e.jsxs("span",{className:"mention-tag",children:["@",b[1]]},b.index)),C=b.index+b[0].length;return C<N.length&&S.push(N.substring(C)),S.length>0?S:N};return e.jsxs("div",{className:"comment",children:[e.jsx("img",{src:h,alt:o,className:"comment-avatar"}),e.jsxs("div",{className:"comment-content",children:[e.jsxs("div",{className:"comment-header",children:[e.jsx("span",{className:"comment-author",children:o}),e.jsxs("div",{className:"comment-actions",children:[e.jsx("button",{type:"button",className:"reply-btn",onClick:()=>oe(t),children:"Trả lời"}),e.jsx("span",{className:"comment-time",children:xe})]})]}),t.replyTo&&e.jsxs("p",{className:"reply-to-indicator",children:["↳ Trả lời ",e.jsxs("span",{className:"mention-tag",children:["@",t.replyTo.author]})]}),e.jsx("p",{className:"comment-text",children:me(i)})]})]},t.id)})})]}),F.length>0&&e.jsxs("div",{className:"similar-setups",children:[e.jsx("h4",{children:"Setup Tương Tự"}),e.jsx("div",{className:"similar-grid",children:F.map(t=>e.jsxs("div",{className:"similar-card",onClick:()=>{p(t),g(0),v("")},children:[e.jsx("img",{src:t.mainImage,alt:t.title}),e.jsx("p",{className:"similar-title",children:t.title})]},t.id))})]})]})]})]}),u&&x&&je.createPortal(e.jsxs("div",{className:"product-tooltip-portal",style:{position:"fixed",bottom:"20px",left:"50%",transform:"translateX(-50%)",width:"90%",maxWidth:"380px",background:"rgba(20, 20, 20, 0.95)",backdropFilter:"blur(12px)",color:"white",border:"1px solid rgba(255, 255, 255, 0.1)",padding:"20px",zIndex:1e5,boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5), 0 2px 8px rgba(0, 0, 0, 0.3)",borderRadius:"16px",display:"flex",flexDirection:"column",gap:"12px",animation:"slideUpFade 0.3s ease-out"},onClick:t=>t.stopPropagation(),children:[e.jsx("button",{style:{position:"absolute",top:"12px",right:"12px",background:"rgba(255, 255, 255, 0.1)",border:"none",color:"rgba(255, 255, 255, 0.7)",fontSize:"20px",width:"32px",height:"32px",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s",lineHeight:"1"},onClick:t=>{t.stopPropagation(),W(null)},onMouseEnter:t=>{t.target.style.background="rgba(255, 255, 255, 0.2)"},onMouseLeave:t=>{t.target.style.background="rgba(255, 255, 255, 0.1)"},children:"×"}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,color:"white",margin:"0 24px 0 0",lineHeight:"1.4",paddingRight:"8px"},children:x.name}),e.jsx("div",{style:{fontSize:"28px",fontWeight:700,color:"#ff6b35",margin:"4px 0",lineHeight:"1.2"},children:x.price}),x.link&&e.jsxs("a",{href:x.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"15px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"14px 24px",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"8px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.4)",transition:"all 0.2s",border:"none"},onMouseEnter:t=>{t.target.style.transform="translateY(-2px)",t.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.5)"},onMouseLeave:t=>{t.target.style.transform="translateY(0)",t.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.4)"},children:[e.jsx("span",{children:"Xem sản phẩm"}),e.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",style:{marginTop:"1px"},children:e.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]}),document.body)]})},ve=({url:a,poster:p})=>{const[y,f]=l.useState(!1);return L.useEffect(()=>{f(!1)},[a]),y?e.jsx("iframe",{width:"100%",height:"100%",src:`${a}?autoplay=1&rel=0`,title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,style:{aspectRatio:"16/9",borderRadius:"8px",minHeight:"400px"}}):e.jsxs("div",{className:"youtube-placeholder",onClick:()=>f(!0),style:{position:"relative",width:"100%",height:"100%",minHeight:"400px",cursor:"pointer",backgroundImage:`url(${p})`,backgroundSize:"cover",backgroundPosition:"center",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center"},children:[e.jsx("div",{style:{background:"red",width:"60px",height:"40px",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx("div",{style:{width:0,height:0,borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"16px solid white"}})}),e.jsx("div",{style:{position:"absolute",bottom:"10px",left:"10px",color:"white",textShadow:"0 1px 2px rgba(0,0,0,0.8)"},children:"Click để phát video"})]})},ye=({product:a,isActive:p,onActivate:y})=>{const[f,I]=l.useState(!1);L.useEffect(()=>{const r=()=>I(window.innerWidth<=768);return r(),window.addEventListener("resize",r),()=>window.removeEventListener("resize",r)},[]);const T=r=>{r.stopPropagation(),y(p?null:a)};return e.jsxs("div",{className:"product-marker",style:{left:`${a.x}%`,top:`${a.y}%`},onClick:T,children:[e.jsx("button",{className:`marker-btn ${p?"active":""}`,children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[e.jsx("circle",{cx:"10",cy:"10",r:"8",fill:"var(--color-primary)"}),e.jsx("path",{d:"M10 6v8M6 10h8",stroke:"white",strokeWidth:"2",strokeLinecap:"round"})]})}),!f&&p&&e.jsxs("div",{className:"product-tooltip-desktop",style:{position:"absolute",left:"50%",bottom:"100%",transform:"translateX(-50%) translateY(-8px)",marginBottom:"8px",background:"white",color:"#333",padding:"16px",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15), 0 2px 8px rgba(0, 0, 0, 0.1)",minWidth:"280px",maxWidth:"320px",zIndex:1e4,animation:"fadeIn 0.2s ease-out",border:"1px solid rgba(0, 0, 0, 0.08)"},onClick:r=>r.stopPropagation(),children:[e.jsx("h3",{style:{fontSize:"15px",fontWeight:600,color:"#333",margin:"0 0 8px 0",lineHeight:"1.4"},children:a.name}),e.jsx("div",{style:{fontSize:"24px",fontWeight:700,color:"#ff6b35",margin:"0 0 12px 0",lineHeight:"1.2"},children:a.price}),a.link&&e.jsxs("a",{href:a.link,target:"_blank",rel:"noopener noreferrer",style:{fontSize:"14px",fontWeight:600,color:"white",textDecoration:"none",background:"linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%)",padding:"10px 20px",borderRadius:"8px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",boxShadow:"0 4px 12px rgba(255, 107, 53, 0.3)",transition:"all 0.2s",border:"none"},onMouseEnter:r=>{r.target.style.transform="translateY(-2px)",r.target.style.boxShadow="0 6px 16px rgba(255, 107, 53, 0.4)"},onMouseLeave:r=>{r.target.style.transform="translateY(0)",r.target.style.boxShadow="0 4px 12px rgba(255, 107, 53, 0.3)"},children:[e.jsx("span",{children:"Xem sản phẩm"}),e.jsx("svg",{width:"14",height:"14",viewBox:"0 0 16 16",fill:"none",children:e.jsx("path",{d:"M6 3L11 8L6 13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]}),e.jsx("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"8px solid transparent",borderRight:"8px solid transparent",borderTop:"8px solid white",filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.05))"}})]})]})};export{Le as default};
